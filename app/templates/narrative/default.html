<div class="">

	<div class="ancillaryNav">
		<a class="button" ng-if="user._id" href="/#/user">Home</a>
		<a class="button" ng-if="user._id" ng-click="logout()">Sign out</a>
	</div>

	<div ng-if="!loading">
		<div class="narrative">

			<!-- begin display -->
			<div ng-hide="isEditing">
				<h2 itt-edit-pencil can-access="canAccess" on-edit="toggleEditing()" ng-bind-html="narrative.name.en"></h2>
				<p ng-bind-html="narrative.description.en"></p>
				<p>Total Duration: {{totalNarrativeDuration | asTime}}</p>
			</div>

			<itt-narrative-editor
				ng-if="isEditing"
				narrative="narrative"
				on-done="toggleEditing()"
				on-update="updateNarrative(n)">
			</itt-narrative-editor>

			<!--
 		<div ng-if="narrative.user_id == user._id">You are the owner of this narrative</div>
 -->
				<button ng-click="addTmpTimeline(null, narrative.timelines)">add timeline</button>


			<itt-modal ng-if="showEpisodeList">
				<div itt-episode-list class="admin episodePicker">
					<!--Choose an episode: <button ng-click="toggleEpisodeList()">cancel</button>-->
					Choose an episode: <button ng-click="toggleEpisodeList(); doneEditingTimeline()">cancel</button>
					<ul
						ng-repeat="child in root.children"
						x-for-admin="true"
						itt-container-episodes="containers[child._id]"
						on-node-click="onEpisodeSelect(node)" root-context="onEpisodeSelect"
						depth="0"></ul>
				</div>
			</itt-modal>



			<div ui-tree="treeOpts" ng-if="narrative.timelines.length !== 0">
				<div ui-tree-nodes="" ng-model="narrative.timelines">

					<div class="storyTimeline" ui-tree-node
						 ng-repeat="timeline in narrative.timelines | filter:{hidden:!true}">

						<itt-timeline-editor
							ng-if="showTimelineEditor(timeline)"
							timeline="timeline"
							on-done="doneEditingTimeline()"
							on-update="editorAction(t, timeline)"
							on-delete="deleteTimeline(t)">
						</itt-timeline-editor>

						<div ng-hide="timelineUnderEdit === timeline || tmpTimeline === timeline">
							<div>
								<h3 itt-edit-pencil can-access="canAccess" on-edit="toggleEditingTimeline(timeline)">
									<a href="/#/story/{{narrative._id}}/{{timeline._id}}">{{timeline.name.en}}</a>
									<span ui-tree-handle>Handle ({{timeline.sort_order}})</span>
								</h3>
								<p>{{timeline.description.en}}</p>
								{{timeline.episode_segments[0].end_time | asTime}}
							</div>

						</div>

						<div ng-mouseenter="showLine = true" ng-mouseleave="showLine = false" style="height: 5px">
							<div ng-show="!!showLine">
							<!--+<hr>-->
								<button ng-click="addTmpTimeline(timeline, narrative.timelines)">add new timeline</button>
							</div>
						</div>
					</div>
					<!--end repeat-->
				</div>
			</div>
			<!--end ui-tree-->
		</div>
		<!-- end display -->


	</div>
</div>
<a ng-if="narrative.support_url" ng-href="{{narrative.support_url}}">Support</a>
</div>
