<!-- recursive template for admin episode list -->
<div class="container" ng-class="{
		isOpen: container.showChildren,
		isClosed: !container.showChildren,
		hoverIndicator: depth == 3
	}" ng-if="container._id">


	<itt-modal modal-class="narrative__modal" ng-if="showNarrativeModal">
		<itt-narrative-editor
			customers="customers"
			container-id="container._id"
			name="container.name"
			path="container.name"
			customer-id="container.customer_id"
			on-done="toggleNarrativeModal()"
			on-update="postNewNarrative(data)">
		</itt-narrative-editor>

		<itt-route-loading is-loading="resolvingNarrative"></itt-route-loading>
	</itt-modal>

	<div class="hoverIndicator">
		<span ng-if="!container.editingContainer">
			<itt-edit-pencil can-access="true" on-edit="container.editingContainer = true">
			<a ng-click="toggleChildren()">{{container.name.en}}</a>
			<span ng-if="depth==3" style="color:#999">({{container.status || Unpublished}})</span>
			<!--<a style="color:#666" ng-click="container.editingContainer = true">â–¾</a>-->
			</itt-edit-pencil>
		</span>
		<span ng-if="container.editingContainer">
			<label>Name:&nbsp;
				<input ng-model="container.newContainerName" ng-init="container.newContainerName = container.name.en" type="text" autofocus>&nbsp;
			</label>
			<button ng-click="container.editingContainer = false">Cancel</button>
			<button ng-disabled="!container.newContainerName || container.newContainerName == container.name.en" ng-click="renameContainer()">Save</button>
		</span>
		<span class="controls">
			<button class="danger" ng-if="appState.dangerousButtons && !container.children.length && !container.haveNotLoadedChildData" ng-click="deleteEpisodeAndContainer(container._id)">
				Delete
			</button>
		</span>
	</div>


	<div ng-if="container.showChildren">

		<div ng-if="depth === 0">
			<div ng-if="!container.addingContainer">
				<button ng-click="container.addingContainer = true">+Project</button>
			</div>

			<div ng-if="container.addingContainer">
				<label>Name:&nbsp;
					<input ng-model="container.newContainerTitle" type="text" autofocus>&nbsp;
				</label>
				<button ng-click="container.addingContainer = false">Cancel</button>
				<button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button>
			</div>
		</div>

		<div ng-if="depth === 1">
			<div ng-if="!container.addingContainer">
				<div ng-if="container.isActive">
					<button ng-click="container.addingContainer = true">+Module</button>
					<a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a>
					<a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a>
				</div>
			</div>

			<div ng-if="container.addingContainer">
				<label>Name:&nbsp;
					<input ng-model="container.newContainerTitle" type="text" autofocus>&nbsp;
				</label>
				<button ng-click="container.addingContainer = false">Cancel</button>
				<button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button>
			</div>
		</div>

		<div ng-if="depth === 2">
			<div ng-if="!container.addingContainer">
				<div ng-if="container.isActive">
					<button ng-click="container.addingContainer = true">+Episode</button>
					<a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a>
					<a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a>
				</div>
			</div>
			<div ng-if="container.addingContainer">
				<label>Name:&nbsp;
					<input ng-model="container.newContainerTitle" type="text" autofocus>&nbsp;
				</label>
				<button ng-click="container.addingContainer = false">Cancel</button>
				<button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button>
			</div>
		</div>

		<!--recur-->
		<div ng-if="depth < 3" ng-repeat="child in container.children | orderBy:'name.en'"
			 itt-container="containers[child._id]"
			 ng-class-even="'container__row--even'"
			 ng-class-odd="'container__row--odd'"
			 depth="depth+1"
			 on-container-click="rootContext($container)"
			 root-context="rootContext">
		</div>

		<div ng-if="depth == 3" class="container">
			<!--show kids{{container.showChildren}} is active{{container.isActive}}-->
			<!-- begin episode -->
			<a class="icon__button button__editor" ng-if="isDemoServer" href="#/editor/{{container.episodes[0]}}" title="Go to editor"></a>
			<a class="icon__button button__producer" href="#/producer/{{container.episodes[0]}}" title="Go to producer"></a>
			<a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a>
			<a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a>
			<!-- end episode -->
		</div>


	</div>

</div>
