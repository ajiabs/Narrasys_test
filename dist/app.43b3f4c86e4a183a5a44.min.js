webpackJsonp([0],{"+Pmc":function(e,t){e.exports=" <a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=\"itemTemplate imageFill\" ng-style=\"{'background-image': 'url(' + item.asset.cssBgUrl + ')'}\"> <img class=fillImg ng-src={{item.asset.url}}> </div> "},"+tHN":function(e,t){e.exports='<div itt-magnetized class="pane videoContainer"> <span ng-if="episode.swap && episode.replacingMasterAsset" style=visibility:hidden> <itt-video class="video contentLayer" media-src-arr=episode.swap.mediaSrcArr poster=episode.poster player-id=episode.swap._id main-player=true> </itt-video> </span> <span ng-if="episode.masterAsset && !episode.replacingMasterAsset"> <itt-video class="video contentLayer" media-src-arr=episode.masterAsset.mediaSrcArr poster=episode.poster player-id=episode.masterAsset._id main-player=true> </itt-video> </span> <div class="pane fill overlay fgLayer"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"> </div> </div> </div> '},"/w+Y":function(e,t,i){e.exports='<div class="landingscreen stretchToViewportShort"> <div> <div class="pane introtext"> <h1 ng-bind-html=episode.display_title></h1> <p id=episode--description ng-bind-html=episode.display_description></p> <br> </div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+"> </div> <div class=landingscreen-end></div> <div class=clear></div> </div> </div> "},"00PB":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class=item__title> <h2 class="item__title item__title--transmedia" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></h2> </div> </div> <div class="text item__text item__text--transmedia" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '},"0BWP":function(e,t,i){e.exports="<div ng-show=\"appState.viewMode == 'review'\" class=searchMode> <div itt-magnet id=searchVideoMagnet class=videoMagnet> <img src="+i("rXKF")+"> </div> <div itt-search-panel></div> </div> "},"0YuG":function(e,t){e.exports=angular},"1tPm":function(e,t){e.exports="<div class=errors> <div class=error> <h3>Error: no such route</h3> <p><i>404. File not found. Sorry!</i></p> </div> </div> "},"2AAL":function(e,t){e.exports='<div class=""> <np-modal wrapper-class=responsive-modal__wrapper modal-class=narrative__modal ng-if="$ctrl.narrativeSelect || $ctrl.narrativeToEdit"> <h3>{{$ctrl.narrativeSelect ? \'Add\' : \'Edit\'}} Narrative</h3> <np-narrative-editor customers=$ctrl.selectedCustomer narrative=$ctrl.narrativeToEdit hide-path-slug=$ctrl.narrativeSelect on-done=$ctrl.closeAddOrEditModal($undo) on-update=$ctrl.addOrUpdateNarrative($narrative)> </np-narrative-editor> </np-modal> <div ng-repeat="customer in $ctrl.customersData" ng-click="$ctrl.customerRowClick(customer, $event)" ng-class=$ctrl.setRowClasses(customer)> <span ng-click="$ctrl.toggleRow(customer, $event)" ng-class="customer.showNarratives ? \'isOpen\' : \'isClosed\'"> </span> <a>{{customer.name}}</a> <div ng-if="customer.isActive === true"> <div ng-if=$ctrl.canAccess style=padding-left:1em> <np-tooltip tip-text="Add Narrative"> <a class="icon__button button__add-inverted" ng-click=$ctrl.setSelectedNarrative(customer)></a> </np-tooltip> </div> </div> <div ng-repeat="narrative in customer.narratives" style=padding-left:2em ng-if="customer.showNarratives === true" ng-click="$ctrl.toggleNarrativeRow(narrative, $event)" ng-class="$ctrl.setNarrativeRowClasses(customer, narrative)"> <div> <np-edit-pencil can-access=true on-edit="$ctrl.setNarrativeToEdit($event, narrative, customer)"> <a>{{narrative.name.en}}</a> </np-edit-pencil> <p ng-if=narrative.description> <small>{{narrative.description.en}}</small> </p> <div ng-if="$ctrl.narrativeRow._id === narrative._id"> <np-tooltip tip-text="Go to Narrative"> <a ng-click="$ctrl.gotoNarrative(narrative._id, $event)" class="icon__button button__generateNarrative" title="Go to Narrative"></a> </np-tooltip> <a> <np-guest-accessible-url narrative=narrative clipboard-mode="Click to Copy"> </np-guest-accessible-url> </a> </div> </div> </div> </div> </div> '},"3/az":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="pullquote item__text item__text--pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> <div class=pullquoteSpeaker ng-if=item.display_annotator> â€” <span ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></span></div> </div> '},"5EdM":function(e,t){e.exports="<div class=\"itemEdit authoringForm\"> <form name=ittItemForm class=doValidate> <div ng-if=\"$ctrl.appState.product == 'sxs'\" class=authoringFormScrollContainer> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)></np-time-field> <div ng-switch on=$ctrl.item.component_name> <div ng-switch-when=item-sxs-annotation> <span class=\"eventIcon icon-comment\"></span> <div class=field> <div class=label>Comment </div> <np-input-i18n class=input field=$ctrl.item.annotation on-field-change=$ctrl.deriveEvent() np-autofocus inputtype=textarea> </np-input-i18n> </div> </div> <div ng-switch-when=item-sxs-file> <span class=\"eventIcon icon-file\"></span> <np-title-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-title-field> <np-producer-upload-field context=editor label=File on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> </div> <div ng-switch-when=item-sxs-link> <span class=\"eventIcon icon-link\"></span> <np-title-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-title-field> <np-url-field data=$ctrl.item context=editor on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-url-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> </div> <div ng-switch-when=item-sxs-image> <span class=\"eventIcon icon-image\"></span> <np-title-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-title-field> <np-producer-upload-field context=editor label=Image on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> </div> <div ng-switch-when=item-sxs-question> <span class=\"eventIcon icon-question\"></span> <np-title-field data=$ctrl.item do-validate=true itt-item-form=ittItemForm on-update=$ctrl.deriveEvent()> </np-title-field> <np-question-text-field data=$ctrl.item do-validate=false on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-question-text-field> <itt-question-type-select data=$ctrl.item> </itt-question-type-select> <np-producer-upload-field context=producer label=Image on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} validation-form=ittItemForm item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-question-options data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-question-options> </div> <div ng-switch-when=item-sxs-video> <span class=\"eventIcon icon-video\"></span> <np-url-field data=$ctrl.item label=\"Video url\" on-update=$ctrl.deriveEvent() context=editor-video itt-item-form=ittItemForm> </np-url-field> <np-title-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-title-field> <np-description-field on-update=$ctrl.deriveEvent() data=$ctrl.item> </np-description-field> </div> </div> </div> <div ng-if=\"$ctrl.appState.product == 'producer'\"> <div itt-tabs class=ittTabs> <div itt-tab class=ittTab ng-if=\"$ctrl.selectService.showTab($ctrl.item.producerItemType, 'Item')\" title=\"{{$ctrl.item.producerItemType | capitalize}}\"> <label ng-if=\"$ctrl.languages.length > 1\" style=float:right;padding-right:24px for=itemLangSelect>Current Language <select id=itemLangSelect size=1 ng-model=$ctrl.appState.lang ng-change=$ctrl.forcePreview() ng-options=\"language.code as ('['+language.code.toUpperCase()+']') for language in $ctrl.languages\"> </select> </label> <div ng-switch on=$ctrl.item.producerItemType> <div ng-switch-when=link> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field do-validate=true data=$ctrl.item itt-item-form=ittItemForm on-update=$ctrl.deriveEvent()> </np-title-field> <np-url-field data=$ctrl.item on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-url-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> <np-template-select data=$ctrl.item on-update=$ctrl.onTemplateChange($componentName) item-form=$ctrl.itemForm> </np-template-select> <np-producer-upload-field context=producer label=Image on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} validation-form=ittItemForm item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-flags data=$ctrl.item component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) flags=\"['required', 'stop', 'cosmetic']\"> </np-flags> </div> <div ng-switch-when=transcript> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-speaker-field data=$ctrl.item on-update=$ctrl.deriveEvent(true) annotators=$ctrl.annotators> </np-speaker-field> <np-annotation-field data=$ctrl.item label=Transcript on-update=$ctrl.deriveEvent($item) validation-form=ittItemForm> </np-annotation-field> <np-producer-upload-field context=producer on-update=$ctrl.deriveEvent() label=\"Speaker thumbnail\" episode-container-id={{$ctrl.episodeContainerId}} item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> </div> <div ng-switch-when=annotation> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-title-field> <np-annotation-field data=$ctrl.item label=\"Annotation Text\" on-update=$ctrl.deriveEvent($item) validation-form=ittItemForm> </np-annotation-field> <np-template-select data=$ctrl.item on-update=$ctrl.onTemplateChange($componentName) item-form=$ctrl.itemForm> </np-template-select> <np-speaker-field data=$ctrl.item on-update=$ctrl.deriveEvent(true) annotators=$ctrl.annotators> </np-speaker-field> <np-flags data=$ctrl.item component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) flags=\"['stop', 'cosmetic', 'chapter_marker', 'invertColor']\"> </np-flags> </div> <div ng-switch-when=file> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field do-validate=true data=$ctrl.item on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-title-field> <np-producer-upload-field context=producer label=File on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} validation-form=ittItemForm item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> <np-flags data=$ctrl.item component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) flags=\"['required', 'stop', 'cosmetic']\"> </np-flags> </div> <div ng-switch-when=image> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field do-validate=true data=$ctrl.item on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-title-field> <np-producer-upload-field context=producer label=Image on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} validation-form=ittItemForm item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-description-field data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-description-field> <np-template-select data=$ctrl.item on-update=$ctrl.onTemplateChange($componentName) item-form=$ctrl.itemForm> </np-template-select> <np-display-select data=$ctrl.item component-name={{$ctrl.item.component_name}} on-update=$ctrl.deriveEvent(true) item-form=$ctrl.itemForm> </np-display-select> <np-flags data=$ctrl.item component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) flags=\"['required', 'stop', 'cosmetic']\"> </np-flags> </div> <div ng-switch-when=question> <span class=\"eventIcon icon-question\"></span> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field data=$ctrl.item do-validate=true itt-item-form=ittItemForm on-update=$ctrl.deriveEvent()> </np-title-field> <np-question-text-field data=$ctrl.item do-validate=false on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-question-text-field> <itt-question-type-select data=$ctrl.item> </itt-question-type-select> <np-producer-upload-field context=producer label=Image on-update=$ctrl.deriveEvent() episode-container-id={{$ctrl.episodeContainerId}} validation-form=ittItemForm item-form=$ctrl.itemForm data=$ctrl.item> </np-producer-upload-field> <np-question-options data=$ctrl.item on-update=$ctrl.deriveEvent()> </np-question-options> </div> <div ng-switch-when=chapter> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-title-field do-validate=true data=$ctrl.item on-update=$ctrl.deriveEvent() itt-item-form=ittItemForm> </np-title-field> <np-description-field on-update=$ctrl.deriveEvent() data=$ctrl.item> </np-description-field> </div> <div ng-switch-when=video> <h4>{{$ctrl.item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> <div itt-tab class=ittTab ng-if=\"$ctrl.selectService.showTab($ctrl.item.producerItemType, 'Style')\" title=\"{{$ctrl.item.producerItemType === 'scene' ? 'Layout' : 'Style'}}\"> <div ng-switch on=$ctrl.item.producerItemType> <div ng-switch-when=link> </div> <div ng-switch-when=transcript> </div> <div ng-switch-when=annotation> <np-display-select component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) data=$ctrl.item> </np-display-select> </div> <div ng-switch-when=scene> <np-time-field data=$ctrl.item item-form=ittItemForm on-update=$ctrl.deriveEvent(true)> </np-time-field> <np-template-select data=$ctrl.item on-update=$ctrl.onTemplateChange($componentName) item-form=$ctrl.itemForm> </np-template-select> <np-video-position-select data=$ctrl.item on-update=$ctrl.deriveEvent(true)> </np-video-position-select> <np-display-select component-name={{$ctrl.item.component_name}} on-update=$ctrl.deriveEvent(true) item-form=$ctrl.itemForm data=$ctrl.item> </np-display-select> </div> <div ng-switch-when=question> <np-template-select data=$ctrl.item on-update=$ctrl.onTemplateChange($componentName) item-form=$ctrl.itemForm> </np-template-select> <np-display-select component-name={{$ctrl.item.component_name}} data=$ctrl.item on-update=$ctrl.deriveEvent(true) item-form=$ctrl.itemForm> </np-display-select> <np-flags data=$ctrl.item component-name={{$ctrl.item.component_name}} item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true) flags=\"['stop', 'cosmetic', 'chapter_marker', 'invertColor']\"> </np-flags> </div> <div ng-switch-when=chapter> <h4>{{$ctrl.item.producerItemType}}</h4> </div> <div ng-switch-when=video> <h4>{{$ctrl.item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> <div itt-tab class=ittTab ng-if=\"$ctrl.selectService.showTab($ctrl.item.producerItemType, 'Customize')\" title=Customize> <div ng-switch on=$ctrl.item.producerItemType> <div ng-switch-when=link> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=transcript> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=annotation> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=scene> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=file> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=image> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=question> <np-typography-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-typography-select> <np-color-select item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-color-select> <np-timestamp-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-timestamp-select> <np-highlight-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-highlight-select> <np-transition-select data=$ctrl.item item-form=$ctrl.itemForm on-update=$ctrl.deriveEvent(true)> </np-transition-select> </div> <div ng-switch-when=chapter> <h4>{{$ctrl.item.producerItemType}}</h4> </div> <div ng-switch-when=video> <h4>{{$ctrl.item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> </div> </div> <div class=ittTabFoot> <a ng-click=$ctrl.cancelEdit()>Cancel</a> &nbsp; &nbsp; <button ng-if=\"\n\t\t\t$ctrl.item._id != 'internal:editing' &&\n\t\t\t!($ctrl.item._type == 'Scene' && $ctrl.item.start_time <= 0.01)\n\t\t\" ng-click=\"$ctrl.episodeEdit.deleteEvent($ctrl.item._id, $ctrl.uneditedItem)\">Delete </button> <button ng-click=$ctrl.saveEvent() ng-disabled=\"$ctrl.blockDoubleClicks || ittItemForm.$invalid\">Save</button> </div> </form> </div> "},"5Ei1":function(e,t){e.exports='<div class=userHome> <div class=user__info> <div class=user__item> <div class=user__label>Role</div> <h4>{{user.role_description}}</h4> <hr> </div> <div clas=user__item> <div class=user__label>Name</div> <np-edit-pencil can-access=true on-edit=toggleEditing() ng-if=!isEditing> <p>{{user.name}}</p> </np-edit-pencil> <div ng-if=isEditing> <input class=userEditable ng-model=user.name> <button class=button ng-click="updateUser(); toggleEditing()">save</button> <button class=button ng-click=toggleEditing()>cancel</button> </div> <hr> </div> <div class=user__item ng-if=!isTrueGuest()> <div class=user__label>Email</div> <div>{{user.email}}</div> <hr> </div> <div class=user__item ng-if=!isTrueGuest()> <div class=user__avatar> <div class=user__label>Avatar</div> <div> <img ng-src="{{appState.user.avatar || appState.noAvatar }}"> </div> <div ng-if="showUploadField && !uploads"> <input type=file accept=image/* itt-files-handler on-selected=uploadAvatar(files)> </div> <button class=button ng-click=toggleUploadAvatar()>{{showUploadField ? \'cancel\' : \'replace\'}}</button> </div> </div> </div> </div> '},"5Tuk":function(e,t,i){e.exports=i.p+"images/Narrasys-Tree.cc1cd923afd67c6dc362c6aa5c3b5399.png"},"6/Qv":function(e,t,i){e.exports=i.p+"images/checkmark.80564877965f7d5b3ab0fccf3fde46c1.png"},"6mC1":function(e,t,i){e.exports='<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"> <div itt-magnet class=videoMagnet ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"> <img src='+i("rXKF")+'> </div> <div class=col> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (mainContentItems | isCurrent).length == 1\n\t\t\t\t\t: (mainContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},"7/ac":function(e,t,i){e.exports='<div class=toolbar> <div class="buttongroup nav-item scene-nav-btns"> <a ng-if="appState.productLoadedAs == \'narrative\' && !narrative.disable_navigation" class="button button-exitEpisode" href=/#/story/{{narrative.path_slug.en}}> <span>Exit</span> </a> <button tabindex=0 class="button button-nav" ng-click=toggleNavPanel();> <span>Chapters</span> </button> </div> <div class="nav-item toolbar-logos"> <img src='+i("teY+")+" id=toolbar-logo-big ng-if=\"episode.template.displayName === 'Narrasys Professional' && appState.windowWidth > 500\"> <img src="+i("5Tuk")+' id=toolbar-logo-small ng-if="episode.template.displayName === \'Narrasys Professional\' && appState.windowWidth <= 500"/> </div> <div class="nav-item new-window-btn"> <div ng-if="appState.isFramed && (appState.productLoadedAs == \'player\'\n\t \t\t\t|| (appState.productLoadedAs == \'narrative\'\n\t \t\t\t&& !narrative.disable_new_window ) )" class="escapegroup buttongroup"> <a class="button button-mainframeescape" ng-click=pause() ng-href={{calcNewWindowUrl()}} target=_blank> <span>New window</span> </a> </div> </div> <div class="nav-item searchgroup buttongroup" ng-class="{cur: show.searchPanel}"> <button tabindex=2 class="button button-search" ng-click=toggleSearchPanel() aria-label=Search aria-expanded={{show.searchPanel}}> <span>Search</span> </button> <label for=searchtext class=hidden>Search Text</label> <input tabindex=2 name=searchtext id=searchtext type=text ng-show=show.searchPanel ng-model=appState.searchText ng-model-options="{ debounce: 200 }"/> </div> <div class="nav-item socialshare social-buttongroup"> <itt-social-share ng-if=socialShareInfo subdomain={{socialShareInfo.subDomain}} paths="{narrative: socialShareInfo.narrative, timeline: socialShareInfo.timeline}" share-title={{socialShareInfo.tlTitle}} providers="[\'facebook\', \'linkedin\', \'twitter\', \'google\', \'reddit\', \'email\']"> </itt-social-share> </div> <div class="nav-item profilegroup buttongroup"> <a class="button button-preview" ng-if="appState.productLoadedAs==\'producer\' && (userHasRole(\'admin\') || userHasRole(\'customer admin\'))" ng-click=toggleProducerPreview()> <span ng-if="appState.product == \'producer\'">Preview</span> <span ng-if="appState.product == \'player\'">Edit</span> </a> <a class="button button-profile" ng-hide=isTrueGuest() ng-click="appState.show.profilePanel = !appState.show.profilePanel"> <span>Profile</span> </a> </div> </div> <div ng-cloak ng-show=show.navPanel class="navPanel topDrawer" ng-class=episode.styleCss> <div class=parent ng-repeat="parent in episode.parents" ng-bind-html=parent.display_name></div> <h2 ng-bind-html=episode.display_title class=fakeLink ng-click=seek(0)></h2> <div class=scene x-ng-if="chapter.display_annotation || chapter.display_title" x-ng-repeat="chapter in episode.chapters" x-ng-class="{currentScene: chapter.isCurrent}" x-ng-click=seek(chapter.start_time)> <span class=displayTime>{{chapter.displayStartTime}}</span> <p> <button class=fakeLink tabindex=0 ng-bind-html="chapter.display_annotation || chapter.display_title" x-ng-class="{sceneLink: !chapter.isCurrent}" ng-focus=showControls()></button> <br> <span ng-bind-html=chapter.display_description></span> </p> </div> </div> '},"8WnQ":function(e,t){e.exports="<div class=modal ng-style=modalStyle ng-click=dismiss();> <span ng-if=\"item._type == 'Link'\" ng-click=$event.stopPropagation()> <div class=modalmenu> <a href={{item.url}} target=_blank class=escapelink>(new window)</a> </div> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </span> <span ng-if=\"item._type == 'Upload'\"> <span ng-switch=\"item.asset.content_type.indexOf('image/')\"> <span ng-switch-when=-1> <div class=modalmenu> <a href={{item.asset.url}} target=_blank class=escapelink>(new window)</a> </div> <itt-iframe x-src={{item.asset.url}} item=item x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-default> <div class=modalimage ng-if=\"item._type == 'Upload'\"> <img ng-src={{item.asset.url}}> </div> </span> </span> </span> </div> "},"9DBX":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click=toggleDetailView()> <img ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class="text item__text"> <div class="title item__title item__title--image-thumbnail" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--image text--image-thumbnail" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '},"9Hwp":function(e,t){e.exports=' <div ng-if=$ctrl.showAssetPickerPoster class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets context=episode on-asset-select=$ctrl.attachPosterAsset($assetId) container-id={{$ctrl.episodeContainerId}}> </sxs-container-assets> </div> <div class=controlsContainer> <button ng-click="$ctrl.showAssetPickerPoster = false;">Cancel</button> </div> </div> <div> <div ng-if="$ctrl.episode.poster && !$ctrl.showUploadButtonsPoster"> {{$ctrl.episode.poster.display_name}} <button class=button ng-click="$ctrl.replaceAsset(\'Poster\')">Replace this</button> </div> <div ng-if="$ctrl.showUploadButtonsPoster || !$ctrl.episode.poster"> <span ng-if=$ctrl.showUploadFieldPoster> <itt-asset-uploader container-id={{$ctrl.episodeContainerId}} callback=$ctrl.posterUploaded(data)> </itt-asset-uploader> </span> <span ng-if=!showUploadFieldPoster> <button class=button ng-click="$ctrl.toggleAssetSelect(\'Poster\')">Browse uploaded</button> <button class=button ng-click="$ctrl.toggleUpload(\'Poster\')">Upload new</button> </span> </div> </div> '},AEnZ:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class=category> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="item__text--link text--description-first" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> <div class="title item__title item__title--link title--description-first"> <a tabindex=0 ng-if="handleOutgoingLinkDisplay() && !item.targetTop" class="escapelink item__escape-link item__link--escape-link escape-link--description-first" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex=0 ng-if="handleOutgoingLinkDisplay() && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex=0 ng-if=!handleOutgoingLinkDisplay() ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--description-first">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> </div> '},Ambl:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="item__text item__text--h2"> <h2 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h2> </div> </div> '},CKMt:function(e,t){e.exports=' <div class=np-video ng-if="$ctrl.mediaSrcArr.length > 0" ng-class="{\'np--embed\': $ctrl.mainPlayer === false}"> <div class=np-video__overlay-ui ng-if=$ctrl.showMask() ng-class=$ctrl.setCssClass() ng-click=$ctrl.videoClick()> </div> <div class=np-video__wrapper> <div class=np-video__element ng-bind-html=::$ctrl.playerElement></div> </div> <div class="poster overlay fill" ng-if="$ctrl.poster && $ctrl.playbackService.getMetaProp(\'time\') === 0" ng-style="{backgroundImage:\'url(\'+$ctrl.poster.url+\')\'}"> </div> </div> <div ng-if="$ctrl.mediaSrcArr.length < 1" class=np-video__empty> <div ng-if="$ctrl.isTranscoded === false"> <h3>Video is currently transcoding.</h3> <p>The page will refresh when the transcode is complete!</p> </div> <h1 ng-if="$ctrl.isTranscoded === true"> No video source available... </h1> </div> '},DC6m:function(e,t){e.exports='<div ng-class=episode.styleCss class=searchPanel__wrapper> <div aria-label="sort toggle" class=searchfilters aria-controls=sortableSearch> <div> Sorted by <button tabindex=0 class="fakeLink fake-link--search-results" ng-click=toggleSortBy(sortBy) aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button> </div> </div> <div class=scrollContainer> <div class="searchResults content" id=sortableSearch itt-width-watch ng-class="{isNarrow: isNarrow}"> <div ng-if="sortBy == \'startTime\'" class=sortByTime> <h1 ng-bind-html=episode.display_title></h1> <div ng-repeat="scene in episode.scenes"> <span ng-switch=appState.product> <div ng-switch-when=producer ng-repeat="item in scene.items" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> <div ng-switch-default ng-repeat="item in scene.items | filter: {cosmetic: false }" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> </span> </div> </div> <div ng-if="sortBy == \'type\'" class=sortByType> <div ng-repeat="category in typeCategories"> <h3 ng-if="matchedItems.length > 0" ng-bind-html=showTypes[category].name></h3> <div class="item animate" ng-repeat="item in matchedItems=(showTypes[category].items | orderBy:\'start_time\')" ng-show="([item.searchableText] | filter:appState.searchText).length" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> </div> <div ng-if="(episode.items | filter:{\'searchableText\': appState.searchText||\'\', \'cosmetic\': false}).length == 0"> (Nothing matched your search.) </div> </div> </div> </div> </div> '},DJti:function(e,t){},ETbY:function(e,t,i){e.exports=" <div ng-if=\"appState.viewMode == 'watch'\" style=padding-bottom:100%> <div class=watchMode> <div itt-magnet id=watchModeVideoMagnet class=videoMagnet> <img src="+i("rXKF")+'> </div> </div> <span class=watchModeCaptions ng-class="{padForBottomToolbar: appState.videoControlsActive}"> <div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class=item.state itt-item=item forcetemplate=caption> </div> </span> </div> '},Ec80:function(e,t,i){e.exports='<div class=ios-iframe-overlay ng-if=showIframeIOSOverlay ng-click=iframeIOSOverlayHandler()></div> <div ng-class="{\n\tisTouchDevice: appState.isTouchDevice,\n\tisFramed: appState.isFramed,\n\tisProducer: (appState.product == \'producer\'),\n\tisSxS: (appState.product == \'sxs\'),\n\n\tcanEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == \'producer\' || appState.product == \'sxs\')\n\t}"> <div class=player> <np-toolbar-story></np-toolbar-story> <np-loading ng-if=loading></np-loading> <div ng-show=!loading itt-episode ng-class="{\n\t\tpadForEditing: appState.editEvent || appState.editEpisode,\n\t\tshowBackgroundOnly: appState.producerEditLayer < 0,\n\t\tshowForegroundOnly: appState.producerEditLayer > 0,\n\t}"></div> <div class=toolbar-bottom itt-show-hide-visual-only=appState.videoControlsActive ng-mouseenter=showControls(); ng-click=showControls(); ng-mouseleave=allowControlsExit()> <div class=toolbar-bottom-fill> <div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"> <np-item-editor ng-if=appState.editEvent item=appState.editEvent></np-item-editor> <np-episode-editor ng-if=appState.editEpisode episode=appState.editEpisode default-language=episodeDefaultLanguage> </np-episode-editor> </div> <div itt-timeline></div> </div> </div> <div class=toolbar-bottom-controltrigger ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls()></div> </div> <np-add-content class="animate transitionFade" item=appState.editEvent ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls()> </np-add-content> <div class=autoscroll ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click=enableAutoscroll()> <img src='+i("WeeJ")+" width=32 height=32> </div> <div ng-show=show.navPanel class=modal-backdrop ng-click=\"hidePanel('navPanel')\"></div> <div ng-show=show.profilePanel class=modal-backdrop ng-click=\"hidePanel('profilePanel')\"></div> <div ng-show=appState.itemDetail class=modal-backdrop ng-click=\"appState.itemDetail=false\"></div> <div ng-if=appState.itemDetail itt-item-detail-modal=appState.itemDetail></div> <div ng-if=show.profilePanel> <np-modal modal-class=account__modal wrapper-class=account__modal--wrapper> <button ng-hide=\"appState.isFramed ||  !(userHasRole('admin') || userHasRole('customer admin'))\" class=button ng-click=\"editInfo = !editInfo\">{{editInfo ? 'Done Editing' : 'Edit Profile'}}</button> <a class=button ng-click=\"show.profilePanel = false\">close</a> <np-nav ng-if=\"!editInfo && ((userHasRole('admin') || userHasRole('customer admin')) && !appState.isFramed)\" on-logout=$parent.logout() in-player=true></np-nav> <div ng-if=\"editInfo || appState.isFramed ||  !(userHasRole('admin') || userHasRole('customer admin'))\"> <div itt-user></div> </div> </np-modal> </div> <div ng-cloak ng-if=\"show.wileyNag &&  (appState.productLoadedAs == 'player'\n\t \t\t\t|| (appState.productLoadedAs == 'narrative'\n\t \t\t\t&& !narrative.disable_new_window ) )\" class=\"wileyNag animate transitionFade\"> <div> <span style=float:right>â¤´</span> <span style=float:right;display:inline-block;padding:5px>Go here for best view</span> </div> <a class=goAway ng-click=noWileyNag()>Don't show this again</a> </div> </div> "},FUk5:function(e,t,i){e.exports=i.p+"images/checkmark-empty.eccafa854fceac6359bac2609d44e2ce.png"},GAbr:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser> <span>Edit item</span> </a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text> <div class=title ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-if=item.asset.url class=touchable style=float:right;max-width:50%;padding-right:.5em> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <np-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors plugin=item.data._plugin qid={{item._id}}> </np-mc-question> <div class=clear></div> </div> </div> '},"I/G4":function(e,t,i){e.exports='<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> <div ng-class="{padForBottomToolbar: appState.videoControlsActive}"> <div class=videoPositioner> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer showCurrent" ng-class="{\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> </div> <div class=clear></div> </div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> '},IiAB:function(e,t,i){e.exports=i.p+"images/no-avatar.e4daa1c7b6e99a9fdc715c3a34cff9b8.gif"},IrCW:function(e,t){e.exports="<span> <div ng-if=showPlayer> <itt-player-container></itt-player-container> </div> </span> "},KCjZ:function(e,t,i){e.exports=' <div class="scene centerVV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div class=static-bg__main ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> <div class=col> <div class=static-bg__alt ng-style="setBgImgUrl(scene.items, \'altCol\')"></div> <div class="pane altPane stretchToViewport"> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> </div> </div> </div> '},KIuG:function(e,t,i){e.exports=' <div class="scene centerVV-mondrian" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div class=static-bg__alt ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane altPane stretchToViewport"> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> <div class=col> <div class=static-bg__main ng-style="setBgImgUrl(scene.items, \'altCol\')"></div> <div class="pane mainPane"> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> </div> </div> </div> '},"L+g8":function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <a ng-click=outgoingLink(item.asset.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <div class=text ng-bind-html=item.description.en></div> <div class=clear></div> </div> '},LrgT:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <div class="title item__title item__title--link title--link-with-image"> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-with-image" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> <span ng-if=item.targetTop> <div class="title item__title item__title--link title--link-with-image"> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <div class="title item__title item__title--link title--link-with-image"> <a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class="fakeLink item__link--fake-link" tabindex=0 ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <img ng-if=item.asset.url ng-click=toggleDetailView() ng-src={{item.asset.url}}> </span> <div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},NEUm:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class=clear></div> </div> '},OklN:function(e,t){e.exports='<span ng-class="{\'sxs-item\': item.sxs}"> <a ng-if=item.editableByThisUser class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div ng-style="\n    item.sxs?{background:\'url(\'+item.avatar.url+\') no-repeat scroll right top / 40px 40px\',minHeight:\'40px\'}:{}\n    " ng-class="{isCosmetic: item.cosmetic}" class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" ng-if="item._type !== \'Chapter\' && !item.chapter_marker" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> <div ng-if="item.display_annotator && item.producerItemType !== \'annotation\' || item.isPq" class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> <div ng-if="item.producerItemType == \'annotation\' && item.display_title && !item.isHeader && !item.isPq" class=authorName ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <span ng-if="item._type != \'Annotation\' && item._type !== \'Chapter\'"> <a tabindex=0 ng-if=handleOutgoingLinkDisplay() class="fakeLink escapelink item__link--escape-link item__link--fake-link" ng-click=outgoingLink(item.url) ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText"></a> <a tabindex=0 role=button class="fakeLink item__link--fake-link" ng-if=!handleOutgoingLinkDisplay() x-ng-keypress=toggleDetailOnKeyPress($event) ng-click="item.showInlineDetail=!item.showInlineDetail" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a> </span> <span ng-if="item._type === \'Chapter\' || item.chapter_marker"> <h2 class=searchChapter ng-bind-html="(item.display_annotation || item.display_title) | highlightSubstring: appState.searchText"></h2> </span> </div> <div class="text item__text"> <div ng-class="{showAsHeader: item.showAsHeader}" ng-if=!item.chapter_marker ng-bind-html="item.display_annotation || item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <span ng-switch=item.producerItemType> <span ng-switch-when=file> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe ng-if="appState.viewMode == \'review\'" x-src={{item.asset.url}} x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-when=link> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe ng-if="!item.isVideoUrl && appState.viewMode == \'review\'" x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if="item.isVideoUrl && appState.viewMode == \'review\'" media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </span> <span ng-switch-when=video> <span ng-switch-when=file> <itt-video ng-if="item.isVideoUrl && appState.viewMode == \'review\'" media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> </span> </span> <span ng-switch-when=image> <div class=touchable style=position:relative> <img ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> </span> <span ng-switch-when=question> <div ng-if=item.asset.url class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <np-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors plugin=item.data._plugin qid={{item._id}}> </np-mc-question> </span> <span ng-switch-default> <span ng-if="item.data._pluginType == \'credlyBadge\'" np-item-usc-badges-inner-template></span> </span> </span> </div> </div> </span> '},Qgv7:function(e,t){e.exports=' <div class=container ng-if=$ctrl.container ng-class="{\n     hoverIndicator: $ctrl.depth === 3,\n     isActive: $ctrl.container.isActive,\n     \'container__row--odd\': $ctrl.container.evenOdd === false,\n     \'container__row--even\': $ctrl.container.evenOdd === true\n     }" ng-style="{\'text-indent\': 1 * $ctrl.depth + \'em\' }" ng-if=$ctrl.container._id> <span ng-class="{\n\tisOpen: $ctrl.container.showChildren && $ctrl.depth !== 3,\n\tisClosed: !$ctrl.container.showChildren && $ctrl.depth !== 3\n\t}" ng-click=$ctrl.onToggleChildren(false)> </span> <np-modal modal-class=narrative__modal ng-if=$ctrl.showNarrativeModal> <np-narrative-editor customers=$ctrl.customers container-info="{\n      containerId: $ctrl.container._id,\n      customerId: $ctrl.container.customer_id,\n      name: $ctrl.container.name\n      }" hide-path-slug=::true on-done=$ctrl.toggleNarrativeModal($undo) on-update=$ctrl.postNewNarrative($data)> </np-narrative-editor> <itt-route-loading is-loading=$ctrl.resolvingNarrative></itt-route-loading> </np-modal> <div ng-class="{hoverIndicator: $ctrl.depth !== 3, isActive: $ctrl.container.isActive && depth !== 3}"> <div ng-if="$ctrl.depth === 3"> <np-tooltip tip-text={{$ctrl.container.status}} class=published__state ng-style="$ctrl.container.isActive && { \'top\':\'17.5px\' }" style=text-indent:0> <span ng-class="{\n          isPublished: $ctrl.container.status === \'Published\',\n          isUnPublished: $ctrl.container.status !== \'Published\'\n          }"></span> </np-tooltip> </div> <div class=delete-button__container ng-style="$ctrl.depth != 3 && {\'padding-right\': \'5.5px\'}" ng-if="$ctrl.isAdmin && $ctrl.depth > 0 && $ctrl.container.isActive && !$ctrl.container.editingContainer"> <np-tooltip tip-text="Delete {{$ctrl.containerType}}?"> <a ng-click=$ctrl.deleteContainer($ctrl.container._id) class=delete__button></a> </np-tooltip> </div> <span ng-if=!$ctrl.container.editingContainer ng-style="$ctrl.depth === 3 ? {\'text-indent\': \'4em\'} : \'\'"> <np-edit-pencil ng-if="$ctrl.depth !== 0" can-access=true on-edit="$ctrl.container.editingContainer = true"> <a ng-click=$ctrl.onToggleChildren(true)>{{$ctrl.container.name.en}}</a> </np-edit-pencil> <a ng-if="$ctrl.depth === 0" ng-click=$ctrl.onToggleChildren(true)>{{$ctrl.container.name.en}}</a> </span> <div ng-if="$ctrl.depth === 0"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <div> <np-tooltip tip-text="Add Project"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Link Status Report"> <a ng-if=$ctrl.isAdmin class="icon__button button__link-status" ng-click=$ctrl.getLinkStatusReport($ctrl.container.customer_id)></a> </np-tooltip> </div> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text np-autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <div ng-if="$ctrl.depth === 1"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <div> <np-tooltip tip-text="Add Module"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text np-autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <div ng-if="$ctrl.depth === 2"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <np-tooltip tip-text="Add Episode"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text np-autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <span ng-if=$ctrl.container.editingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerName ng-init="$ctrl.container.newContainerName = $ctrl.container.name.en" type=text np-autofocus>&nbsp; </label> <button ng-click="$ctrl.container.editingContainer = false">Cancel</button> <button ng-disabled="!$ctrl.container.newContainerName || $ctrl.container.newContainerName == $ctrl.container.name.en" ng-click=$ctrl.renameContainer()>Save</button> </span> </div> <div ng-if="$ctrl.depth == 3 && $ctrl.container.isActive" class=container style=text-indent:4em> <div class=episode__button-row> <div class=episode__button> <np-tooltip tip-text="Go to editor"> <a class="icon__button button__editor" ng-if=$ctrl.isDemoServer href=#/editor/{{$ctrl.container.episodes[0]}}></a> </np-tooltip> <np-tooltip tip-text="Go to producer"> <a class="icon__button button__producer" href=#/producer/{{$ctrl.container.episodes[0]}}></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" title="Generate new narrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> </div> <np-container ng-if="$ctrl.depth < 3 && $ctrl.container.showChildren" ng-repeat="child in $ctrl.container.children" depth="$ctrl.depth + 1" container=$ctrl.containers[child._id] containers=$ctrl.modelSvc.containers on-container-remove="$ctrl.onContainerRemove({ $container })" on-container-click="$ctrl.onContainerClick({ $container })" on-container-add="$ctrl.onContainerAdd({ $container })"> </np-container> </div> '},S0MD:function(e,t,i){e.exports='<span> <img style=max-width:5em;float:left;margin-right:.5em ng-src={{plugin.credlyImageUrl}}> <b>{{plugin.achievement}}</b> <span ng-if=plugin.eligibleForBadges> <p>Complete the following requirements to earn a <a ng-href=https://credly.com/recipients/{{plugin.credlyBadgeId}} target=_blank>USC Scholar\'s Badge</a>:</p> <div style="clear:both;margin:1em 1.2em;font-size:90%"> <div ng-repeat="req in plugin.requirements"> <img ng-if=req.achieved style=width:1em;height:1em;margin-left:-1.2em src='+i("6/Qv")+"> <img ng-if=!req.achieved style=width:1em;height:1em;margin-left:-1.2em src="+i("FUk5")+'> <span style="">{{req.name}}</span> </div> </div> <p ng-if="plugin.totalAchieved != plugin.requirements.length"> You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement. </p> <div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"> <p>Congratulations! You are eligible for a USC Scholarâ€™s Badge. Enter your email address to claim it:</p> <input type=text ng-model=plugin.userEmail> <input type=button value=Go ng-click=badger()> <span ng-if=plugin.gettingBadge> <small>Getting your badge...</small> </span> <div ng-if=plugin.error> <small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small> </div> </div> <div ng-if=plugin.gotBadge> Your badge is in the mail. <span ng-if=plugin.alreadyHadBadge>(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span> </div> </span> <span ng-if=!plugin.eligibleForBadges> <p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p> </span> </span> '},Tc0T:function(e,t,i){e.exports=' <div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=col> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},Twex:function(e,t,i){e.exports='<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: (contentItems | isCurrent).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: contentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},UGDl:function(e,t){e.exports="<div class=iframeContainer> <np-loading ng-if=$ctrl.isLoading></np-loading> <iframe ng-if=!ctrl.isLoading ng-src={{$ctrl.src}} ng-attr-scrolling={{$ctrl.iOSScroll}} ng-style=$ctrl.styles ng-attr-sandbox={{$ctrl.sandbox}}> </iframe> </div> "},"V+JG":function(e,t){e.exports='<div class="itemEdit authoringForm"> <form name=ittEpisodeForm class=doValidate> <div ng-if="$ctrl.appState.product == \'producer\'"> <div class=ittTabs itt-tabs> <div class=ittTab itt-tab title=Episode> <div class=field ng-hide=!$ctrl.isAdmin> <div class=label>Master asset type</div> <div class=input> <select size=1 ng-model=$ctrl.masterAssetType> <option value=Video>Native Video</option> <option value=WebUrl>Youtube / Kaltura / Wistia</option> </select> </div> </div> <div class=field ng-if="$ctrl.masterAssetType == \'Video\' && $ctrl.isAdmin"> <div class=label>Video</div> <div class=input np-upload-masterasset-template></div> </div> <np-url-field label="Video URL" ng-if="$ctrl.masterAssetType === \'WebUrl\'" data=::$ctrl.masterAsset.mediaSrcArr[0] context=episode on-attach=$ctrl.attachMediaSrc($url)> </np-url-field> <div class=field ng-if=$ctrl.showmessage> <div class=input ng-bind-html=$ctrl.showmessage></div> </div> <np-title-field data=$ctrl.episode model-opts="{ debounce: 500 }" do-validate=true itt-item-form=ittEpisodeForm on-update=$ctrl.onTitleOrDescriptionChange()> </np-title-field> <np-description-field data=$ctrl.episode model-opts="{ debounce: 50 }" on-update=$ctrl.onTitleOrDescriptionChange()> </np-description-field> <div class=field ng-if=$ctrl.isAdmin> <div class=label>Poster image </div> <div class=input np-upload-poster-template> </div> </div> <div class=field> <div class=label>Status</div> <div class=input> <select size=1 ng-model=$ctrl.episode.status> <option value=Published>Published</option> <option value=Unpublished>Unpublished</option> </select> </div> </div> <np-language-flags lang-form=$ctrl.langForm on-langflag-change=$ctrl.onLangFlagChange()> </np-language-flags> <np-language-select ng-if="$ctrl.languageCount > 1" data=$ctrl.episode on-select-change=$ctrl.onLangFlagChange() lang-form=$ctrl.episodeEdit.episodeLangForm> </np-language-select> <div class=field ng-if="$ctrl.episode.languages.length > 1"> <div class=label>Current Language</div> <div class=input> <select size=1 ng-model=$ctrl.appState.lang ng-change=$ctrl.forcePreview() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in $ctrl.episode.languages"> </select> </div> </div> <div class=field ng-if="$ctrl.isAdmin && $ctrl.episode.languages.length > 1"> <div class=label>Translations</div> <div class=input ng-if="$ctrl.doCheckForTranslations == null"> {{$ctrl.translationMessage($ctrl.episode.languages)}} <button ng-click=$ctrl.beginBackgroundTranslations($ctrl.episode._id)>Begin translation</button> </div> <div ng-if="$ctrl.doCheckForTranslations === true"> {{$ctrl.afterTranslationAttempt}} </div> </div> <itt-upload-transcripts ng-if="$ctrl.episode.master_asset_id && !$ctrl.episode._master_asset_was_changed  && ($ctrl.isAdmin || $ctrl.isCustomerAdmin)" episode-id={{$ctrl.episode._id}}> </itt-upload-transcripts> </div> <div class=ittTab itt-tab title=Style> <np-template-select data=$ctrl.episode on-episode-edit=$ctrl.updateEpisodeTemplate($data)> </np-template-select> <np-timestamp-select data=$ctrl.episode item-form=$ctrl.itemForm on-update=$ctrl.updateItemForm()> </np-timestamp-select> <np-highlight-select data=$ctrl.episode item-form=$ctrl.itemForm on-update=$ctrl.updateItemForm()> </np-highlight-select> <np-transition-select data=$ctrl.episode item-form=$ctrl.itemForm on-update=$ctrl.updateItemForm()> </np-transition-select> </div> </div> </div> <div class=ittTabFoot> <a ng-click=$ctrl.cancelEpisodeEdit()>Cancel</a> &nbsp; &nbsp; <button ng-click=$ctrl.saveEpisode() ng-disabled=ittEpisodeForm.$invalid>Save</button> </div> </form> </div> '},VCZZ:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text item__text--question-mc"> <div class="title item__title item__title--question-mc" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-if=item.asset.url class=touchable style=float:right;max-width:50%;padding-right:.5em> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <np-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors plugin=item.data._plugin qid={{item._id}}> </np-mc-question> <div class=clear></div> </div> </div> '},WeeJ:function(e,t,i){e.exports=i.p+"images/autoscroll.417c83d1f0b2eb6bceb7e048e66ede9d.svg"},aqvw:function(e,t){e.exports=' <div ng-if=$ctrl.showAssetPicker class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets container-id={{$ctrl.episodeContainerId}} on-asset-select="$ctrl.attachChosenAsset($assetId, $ctrl.itemForm)" mime-key={{$ctrl.data.producerItemType}}> </sxs-container-assets> </div> <div class=controlsContainer> <button ng-click="$ctrl.showAssetPicker = false;">Cancel</button> </div> </div> <div> <ng-model ng-model=$ctrl.data.asset name=itemAsset asset=$ctrl.data.asset component-name={{$ctrl.data.component_name}} np-valid-asset> </ng-model> <div ng-if="$ctrl.data.asset && !$ctrl.showUploadButtons"> {{$ctrl.data.asset.display_name}} <button class=button ng-click=$ctrl.replaceAsset()>Replace</button> <button class=button ng-click=$ctrl.detachAsset()> Remove </button> </div> <div ng-if="$ctrl.showUploadButtons || !$ctrl.data.asset"> <span ng-if=$ctrl.showUploadField> <itt-asset-uploader container-id={{$ctrl.episodeContainerId}} ng-if=$ctrl.episodeEdit.canAccess callback=$ctrl.assetUploaded(data) mime-types={{$ctrl.mimes}}> </itt-asset-uploader> </span> <span ng-if=!$ctrl.showUploadField> <button class=button ng-click="$ctrl.showAssetPicker = true">Browse uploaded</button> <button class=button ng-click="$ctrl.showUploadField = true">Upload new</button> </span> </div> </div> '},bINW:function(e,t,i){e.exports=' <div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: altContentItems.length==1, isNarrow: isNarrow, isEmpty: altContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in altItems = (altContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=col> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (mainContentItems | isCurrent).length == 1\n\t\t\t\t\t: (mainContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},cKYu:function(e,t){e.exports='<div ng-if=$ctrl.showParent> <sxs-container-assets on-asset-select=$ctrl.assetClick($assetId) container-id={{$ctrl.container.parent_id}}> </sxs-container-assets> </div> <div class=containerAssets> <div ng-if="$ctrl.appState.product != \'sxs\' && $ctrl.container.parent_id && !$ctrl.showParent"> <a class=goUp ng-click=$ctrl.up()>Parent container</a> </div> <div class=title>{{$ctrl.container.display_name}} - Asset Library </div> <div class=controls> <a ng-click=$ctrl.toggleImages()> <span ng-if=$ctrl.onlyImages>Images</span> <span ng-if=!$ctrl.onlyImages>All</span> </a> &nbsp; <a ng-click=$ctrl.toggleGrid()> <span ng-if=$ctrl.gridView>â–¦</span> <span ng-if=!$ctrl.gridView>â˜°</span> </a> </div> <div class=scrollPane ng-if=!$ctrl.hideItems> <div ng-if=$ctrl.gridView> <div class=grid ng-repeat="asset in $ctrl.isCustAdmin ? ($ctrl.assets | vidsFromCustAdmins) : $ctrl.assets" ng-if="asset.container_id == $ctrl.containerId && !($ctrl.onlyImages && asset._type != \'Asset::Image\')" ng-click=$ctrl.assetClick(asset._id)> <div ng-if="asset._type == \'Asset::Image\'"> <img class=thumbnail ng-src={{asset.url}}> </div> <div ng-if="asset._type != \'Asset::Image\'"> <div class=thumbnail>{{asset._type}}</div> </div> {{asset.display_name}} <span ng-if=asset.tags[0]> - {{asset.tags[0] | tagName}}</span> </div> </div> <table ng-if=!$ctrl.gridView> <tr ng-repeat="asset in $ctrl.isCustAdmin ? ($ctrl.assets | vidsFromCustAdmins) : $ctrl.assets" ng-if="asset.container_id == $ctrl.containerId && !($ctrl.onlyImages && asset._type != \'Asset::Image\')" ng-click=$ctrl.assetClick(asset._id)> <td> <div ng-if="asset._type == \'Asset::Image\'"> <img class=thumbnail ng-src={{asset.url}}> </div> </td> <td>{{asset.size |asBytes}}</td> <td>{{asset.content_type}}</td> <td> {{asset.display_name}} </td> <td ng-if=asset.tags[0]>{{asset.tags[0] | tagName}}</td> <td ng-if=$ctrl.isAdmin class=delete-button__container> <np-tooltip tip-text="Delete Asset"> <a ng-click="$ctrl.requestDeleteAsset(asset, $event)" class=delete__button></a> </np-tooltip> </td> </tr> </table> </div> <br> <np-modal class=modal__center-center ng-if="$ctrl.assetToDelete != null"> <h4>Delete</h4> {{$ctrl.assetToDelete.display_name}}? <div> <button ng-click=$ctrl.deleteAsset($ctrl.assetToDelete._id)>Delete</button> <button ng-click="$ctrl.assetToDelete = null">cancel</button> </div> </np-modal> <itt-asset-uploader container-id={{$ctrl.container._id}} mime-types={{$ctrl.mimes}} multiple=true ng-if="$ctrl.canAccess && $ctrl.context !== \'narrative\'"> </itt-asset-uploader> </div> '},d3rl:function(e,t){e.exports='<div class="itemTemplate uscBadges"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> </div> <span np-item-usc-badges-inner-template></span> </div> '},eHBc:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate transcript"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> </div> <div class=icon style=float:left;margin-right:.5em> <img ng-if=item.asset.url ng-src={{item.asset.url}}> <div class=clear></div> </div> <div class="authorName item__title" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--transcript" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> <div class=clear></div> </div> '},es1d:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="captionContainer touchable"> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> <div class="caption slidingcaption"> <div class="title item__title item__title--image item__title--image-caption-sliding" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--image item__text--image-caption-sliding" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=clear></div> </div> '},foaR:function(e,t){e.exports=' <div> <div ng-if="($ctrl.data.asset) && !$ctrl.showUploadButtons"> {{$ctrl.data.asset.display_name}} <button class=button ng-click=$ctrl.replaceAsset($ctrl.data.asset._id)> Replace this asset </button> </div> <div ng-if="$ctrl.showUploadButtons || !($ctrl.data.asset)"> <itt-asset-uploader ng-if="$ctrl.data.producerItemType === \'image\'" callback=$ctrl.assetUploaded(data)></itt-asset-uploader> <itt-asset-uploader ng-if="$ctrl.data.producerItemType === \'file\'" callback=$ctrl.assetUploaded(data) mime-types="application/*, text/*, audio/*, model/*" instructions="We currently accept all non-image or non-video files." error-text="Please make sure you are not trying to upload an image or video file."> </itt-asset-uploader> </div> </div> '},g3Y4:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <a ng-if=handleOutgoingLinkDisplay() class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <h3 ng-if=!handleOutgoingLinkDisplay() ng-bind-html="item.title.en ||\'(Untitled)\'"></h3> <div class=text ng-bind-html=item.description.en></div> <div class=itemDetail ng-if="item.url && !handleOutgoingLinkDisplay() && item.url != \'https://\'"> <div class=modalmenu> <a ng-click=outgoingLink(item.url) class=escapelink>(new window)</a> </div> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> </div> '},"hY+2":function(e,t){e.exports='<span ng-if="$ctrl.errorSvc.errors.length || $ctrl.errorSvc.notifications.length" class=errors> <div class=error ng-repeat="error in $ctrl.errorSvc.errors" ng-click=$ctrl.dismiss(error)> <h3><i class="fa fa-exclamation-triangle error-red"></i>Error: <span ng-bind-html="error.cause || error.exception.data.error || error.exception.data.base[0] || error.exception.data || \'(unknown reason)\'"></span></h3> <p ng-if=error.exception.config.url> <i>(While trying to load {{error.exception.config.url}})</i> </p> <p ng-if="error.exception.status == 401"> Please <span ng-if=$ctrl.user.login_url> <a ng-if=$ctrl.user.login_via_top_window_only ng-click=$ctrl.logout(); ng-href={{$ctrl.user.login_url}} target=_top>click here</a> <a ng-if=!$ctrl.user.login_via_top_window_only ng-click=$ctrl.logout(); ng-href={{$ctrl.user.login_url}}>click here</a> to log back in. </span> <span ng-if=!$ctrl.user.login_url> <a ng-click=$ctrl.logout();>reset your session</a> and start over. </span> </p> </div> <div class=notification ng-repeat="notification in $ctrl.errorSvc.notifications"> <a style=float:right ng-click=$ctrl.dismiss(notification)>[x]</a> <p><i class="fa fa-info-circle info-blue"></i> <strong> Note: </strong> {{notification.text}}</p> </div> </span> '},"j+BF":function(e,t){e.exports=' <div class="itemTemplate itemCaption"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> <div class=clear></div> </div> '},j8FC:function(e,t){e.exports='<div class=timeline ng-show=!isSuppressed ng-cloak> <button tabindex=0 ng-focus=showControls() class=button ng-class=setBtnClass() ng-click=timelineBtnClick()> <span class=control-text>{{controlText}}</span> </button> <div class=progressbarBox> <div class=pbarTop> <span ng-if="appState.product == \'producer\'"> <a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click=zoomOut()> <span class=control-text>Zoom out</span> </a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click=zoomIn()> <span class=control-text>Zoom in</span> </a> </span> </div> <div class=pbarMain> <button ng-focus=showControls() ng-class="{invisible: playbackService.getMetaProp(\'time\') == 0}" class="button button-prev" ng-click=prevScene()> <span class=control-text>Previous</span> </button> <button ng-focus=showControls() tabindex=0 ng-class="{invisible: playbackService.getMetaProp(\'time\')>= playbackService.getMetaProp(\'duration\')- 0.1}" class="button button-next" ng-click=nextScene()> <span class=control-text>Next</span> </button> <div class=progressbar> <div class=mask> <div class=progressbarContainer style=width:{};> <div class=buffered ng-style="{width: playbackService.getMetaProp(\'bufferedPercent\')+\'%\'}"></div> <div class=played ng-style="{width: markerPercent(playbackService.getMetaProp(\'time\'))+\'%\'}"></div> </div> </div> <div class=progressbarContainer style=width:{};> <div class=handle ng-show=isSeeking ng-style="{left: markerPercent(willSeekTo)+\'%\'}"> <div class=tip ng-show=seekHandleVisible>{{willSeekTo | asTime}}</div> </div> <div class=tooltip ng-if=eventGroup.showTooltip ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}"> <span class=content ng-bind-html=eventGroup.toolTipText></span> </div> <div class="handle sxsHandle playhead" ng-show=appState.editEvent ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\'}"> <div class=tip ng-click="">{{appState.editEvent.start_time | asTime}}</div> </div> </div> <div class="playhead mask"> <div class=progressbarContainer ng-style="{width: zoomLevel+\'00%\'}"> <div class=marker ng-mouseover=showTooltip(eventGroup) ng-mouseout=hideTooltip(eventGroup) ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}" ng-if="eventGroup.stop || eventGroup.toolTipText || appState.product == \'producer\' && eventGroup.toolTipText != null" ng-class="{stop: eventGroup.stop && !eventGroup.multiStop, mini: eventGroup.layoutChange, multi: eventGroup.multiStop}"> </div> <div ng-if=appState.editEvent class=editingItem ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(playbackService.getMetaProp(\'duration\') - appState.editEvent.end_time)+\'%\'}"></div> </div> </div> </div> </div> <div class=pbarBottom> <span class=timedisplay> {{playbackService.getMetaProp(\'time\')| asTime}} / {{playbackService.getMetaProp(\'duration\') | asTime}} <span class=speedcontrol ng-if=!(appState.isIEOrEdge)> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(-0.25) aria-label="Slow down video"> <div ng-class="{arrowLeft: playbackService.getMetaProp(\'timeMultiplier\') > 0.5}"></div> </button> <span class=speeddisplay ng-click=resetSpeed()>{{playbackService.getMetaProp(\'timeMultiplier\')}}x</span> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(0.25) aria-label="Speed up video"> <div ng-class="{arrowRight: playbackService.getMetaProp(\'timeMultiplier\') < 1.5}"></div> </button> </span> </span> <span style=display:inline-block;height:1em;position:relative ng-if="episode.languages.length > 1"> <select size=1 ng-model=appState.lang class=languageSelector ng-change=setNewLanguage() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"> </select> </span> <button ng-focus=showControls() tabindex=0 ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"> <span class=control-text>Captions</span> </button> <a ng-if="appState.viewMode==\'watch\'" class="button button-fullscreen active" ng-click="viewMode(\'discover\')"> <span class=control-text>Exit fullscreen</span> </a> <a ng-if="appState.viewMode!=\'watch\'" class="button button-fullscreen" ng-click="viewMode(\'watch\')"> <span class=control-text>Fullscreen video</span> </a> <span ng-if=!appState.isTouchDevice> <button ng-focus=showControls() tabindex=0 class="button button-mute {{audioIcon()}}" ng-click=toggleMute()> <span class=control-text>Mute</span> </button> <itt-volume-slider></itt-volume-slider> </span> </div> </div> </div> '},jiyv:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text ng-bind-html=item.annotation.en></div> <div class=clear></div> </div> '},"k/N7":function(e,t,i){e.exports='<div class="scene centered-pro" ng-class="scene.styleCss + \' \'+ scene.state"> <div itt-item=item class="item animate banner-pull-quote" ng-class="item.styleCss + \' \' + item.state" ng-repeat="item in (contentItems | isCurrent | filter:{component_name: headerOneComponentTemplate} )"> </div> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: (contentItems | isCurrent).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: contentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in (contentItems | isCurrent | filter:centeredProTransmedia  )" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> </div> '},k5l5:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text> <div class=title ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <a class=escapelink ng-click=outgoingLink(item.url)>New window</a> <div ng-if=!handleOutgoingLinkDisplay()> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <div class=sxs-video> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> </div> <div class=clear></div> </div> '},k90U:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <div class="title item__title item__title--link title--link-modal"> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-modal" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> <span ng-if=item.targetTop> <div class="title item__title item__title--link title--link-modal"> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <div class="title item__title item__title--link title--link-modal"> <a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class="fakeLink item__link--fake-link" tabindex=0 ng-click=forceModal(false) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <img ng-if=item.asset.url ng-click=forceModal(false) ng-src={{item.asset.url}}> </span> <div class="item__text item__text--link text--link-modal" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if="item.showInlineDetail && appState.viewMode === \'review\'"> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-modal">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},kCnN:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="item__text item__text--h1"> <h1 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h1> </div> </div> '},kr2K:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-src={{item.asset.url}} class=img--link-with-image-no-title> </a> </span> <span ng-if=item.targetTop> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-src={{item.asset.url}} class=img--link-with-image-no-title> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <img ng-click=toggleDetailView() ng-src={{item.asset.url}} class=img--link-with-image-no-title> </span> <div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},l1Qu:function(e,t){},lvPu:function(e,t,i){e.exports='<div class="endingscreen stretchToViewport"> <div class="pane introtext"> <p>Thanks for watching:&nbsp; <span ng-bind-html=episode.display_title></span> </p> <br> </div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+"> </div> </div> "},lw8s:function(e,t){e.exports='<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"> <div class="content w-modal"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"> </div> <a ng-if=!appState.editEvent class=button-continue ng-click=continue()> <span>Continue</span> </a> </div> </div> '},mOi1:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="title item__title item__title--link title--link-embed" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="item__text--link text--link-embed" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-embed" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)>(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> <div class=clear></div> </div> '},oN2c:function(e,t){e.exports='<div class=discoverMode ng-if="appState.viewMode == \'discover\'"> <div class="fill windowBg bgLayer"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"> </div> </div> <div itt-scene=scene episode=episode class=scene__container></div> </div> '},olHH:function(e,t){e.exports='<div itt-login style=margin:2em> <a style="animation:delayedFadeIn 5s" href=/#/ >Home</a> </div> '},pkcl:function(e,t){e.exports=' <div ng-if=$ctrl.showAssetPickerMaster class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets on-asset-select=$ctrl.attachChosenAsset($assetId) container-id={{$ctrl.episodeContainerId}}> </sxs-container-assets> </div> <div class=controlsContainer> <button ng-click="$ctrl.showAssetPickerMaster = false;">Cancel</button> </div> </div> <div> <div ng-if="($ctrl.masterAsset.original_filename) && !$ctrl.showUploadButtonsMaster"> {{$ctrl.masterAsset.display_name}} <button class=button ng-click="$ctrl.replaceAsset(\'Master\')"> Replace</button> <button class=button ng-click=$ctrl.detachMasterAsset()>Remove</button> </div> <div ng-if="$ctrl.showUploadButtonsMaster || !($ctrl.masterAsset.original_filename)"> <span ng-if=$ctrl.showUploadFieldMaster> <itt-asset-uploader container-id={{$ctrl.episodeContainerId}} callback=$ctrl.assetUploaded(data)></itt-asset-uploader> </span> <span ng-if=!$ctrl.showUploadFieldMaster> <button class=button ng-click="$ctrl.toggleAssetSelect(\'Master\')">Browse uploaded assets</button> <button class=button ng-click="$ctrl.toggleUpload(\'Master\')">Upload new asset</button> </span> </div> </div> '},qBCb:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="title item__title item__title--image-inline-with-text" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class="item__text item__text--image text--inline-with-text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> <div class=clear></div> </div> </div> '},qMue:function(e,t){e.exports='<div class=narrative> <div> <np-edit-pencil can-access=$ctrl.canAccess on-edit=$ctrl.toggleEditNarrativeModal()> <h2 ng-bind-html=$ctrl.narrative.name.en></h2> </np-edit-pencil> <p ng-bind-html=$ctrl.narrative.description.en></p> <p>Total Duration: {{$ctrl.totalNarrativeDuration | asTime}}</p> </div> <div class=episode__button-row> <div ng-if=$ctrl.canAccess> <np-tooltip tip-text="Add Timeline" ng-class="{overlay: $ctrl.timelineUnderEdit || $ctrl.tmpTimeline}"> <a class="icon__button button__add-inverted" ng-click="$ctrl.addTmpTimeline(null, $ctrl.narrative.timelines)"></a> </np-tooltip> <np-tooltip tip-text="Export links to spreadsheet"> <a class="icon__button button__export-spreadsheet" ng-click=$ctrl.exportToSpreadsheet($ctrl.narrative._id)> </a> </np-tooltip> <np-guest-accessible-url narrative=$ctrl.narrative sub-domain={{$ctrl.narrative.narrative_subdomain}} clipboard-mode="Click to copy URL"> </np-guest-accessible-url> </div> </div> <np-modal ng-if=$ctrl.showEpisodeList> <np-episode-list depth=0 context=narrative class="admin episodePicker" on-episode-select=$ctrl.onEpisodeSelect(node) on-cancel="$ctrl.toggleEpisodeList(); $ctrl.doneEditingTimeline()"> </np-episode-list> </np-modal> <np-modal wrapper-class=responsive-modal__wrapper modal-class=narrative__modal ng-if="$ctrl.editingNarrative || $ctrl.timelineUnderEdit != null"> <div ng-if=$ctrl.editingNarrative> <np-narrative-editor narrative=$ctrl.narrative customers=$ctrl.customers on-done=$ctrl.toggleEditNarrativeModal($undo) on-update=$ctrl.updateNarrative($narrative)> </np-narrative-editor> </div> <div ng-if="$ctrl.timelineUnderEdit != null"> <np-timeline-editor class=tl__editor timeline=$ctrl.timelineUnderEdit narrative=$ctrl.narrative container-id={{$ctrl.customers[0].root_container_id}} on-done=$ctrl.doneEditingTimeline() on-update="$ctrl.editorAction($timeline, $ctrl.timelineUnderEdit)" on-delete=$ctrl.deleteTimeline($timeline)> </np-timeline-editor> </div> </np-modal> <div ui-tree=$ctrl.treeOpts ng-if="$ctrl.narrative.timelines.length !== 0"> <div ui-tree-nodes ng-model=$ctrl.narrative.timelines> <div class="storyTimeline hoverIndicator" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'" ng-mouseenter="rowHover = true" ng-mouseleave="rowHover = false" ui-tree-node ng-repeat="timeline in $ctrl.narrative.timelines |\n               filter: ($ctrl.canAccess === false || undefined) && {hidden: false}"> <div ng-class="{\'timeline--hidden\': timeline.hidden}"> <span ng-show="$ctrl.canAccess && rowHover" class=tlDrag__handle ui-tree-handle> <i class="fa fa-arrows"></i> </span> <div class=tl__wrapper> <np-edit-pencil can-access=$ctrl.canAccess force="rowHover && $ctrl.canAccess" on-edit=$ctrl.toggleEditingTimeline(timeline)> <h3> <i ng-if=timeline.hidden class="fa fa-eye-slash"></i> <a href=/#/story/{{$ctrl.narrative._id}}/{{timeline._id}}>{{timeline.name.en}}</a> </h3> </np-edit-pencil> <p>{{timeline.episode_segments[0].end_time | asTime}}</p> <p>{{timeline.description.en}}</p> <div class=tl__addButton> <div ng-if="rowHover && $ctrl.canAccess" class=episode__button-row> <div> <np-tooltip tip-text="Insert Timeline"> <a class="icon__button button__add-inverted" ng-click="$ctrl.addTmpTimeline(timeline, $ctrl.narrative.timelines)"></a> </np-tooltip> <np-guest-accessible-url narrative=$ctrl.narrative timeline=timeline clipboard-mode="Copy to Clipboard"> </np-guest-accessible-url> </div> </div> </div> </div> </div> </div> </div> </div> </div> <a ng-if=$ctrl.narrative.support_url target=_blank ng-href={{$ctrl.narrative.support_url}}>Support</a> '},rFfA:function(e,t,i){e.exports=i.p+"images/Narrasys_Banner.02a409f34b80c72134169a171c9c8852.svg"},rXKF:function(e,t,i){e.exports=i.p+"images/aspectratiopreserver-16x9.0e82d130dc83a6f89fcae6a6a60baaf4.gif"},rw5t:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div> <b ng-bind-html=item.title.en></b> <p style=text-align:center> </p><div ng-if=item.asset.url class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <p></p> </div> <div class=text ng-bind-html=item.description.en></div> <div class=clear></div> </div> '},sbOf:function(e,t,i){e.exports=' <div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=row> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane matchVideoHeight"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=row> <div class="pane altPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},"teY+":function(e,t,i){e.exports=i.p+"images/Narrasys_Logo.df561103178efc6ff2c87d7f47387f90.png"},wI96:function(e,t){e.exports='<div class="rootLogin standaloneAncillaryPage" itt-login> <np-nav on-logout=logout()></np-nav> <div class=inner> <div ng-if=appState.user._id> <div itt-user></div> </div> <div ng-if=!appState.user._id> <form ng-submit=adminLogin()> <h1>Sign in to Narrative Producer</h1> <label> <span>Username</span> <input type=email name=auth_key ng-model=loginForm.auth_key> </label> <label> <span>Password</span> <input type=password name=password ng-model=loginForm.password> </label> <input class="submit button" type=submit value="Sign in"> <span class=error ng-if=badlogin>Sorry, try again?</span> </form> </div> <br style=clear:both> </div> <small ng-if=!appState.user._id><a href={{apiDataBaseUrl}}/oauth2>OAuth</a></small> </div> '},"wJ/0":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text item__text--file"> <div class="title item__title item__title--file"> <a role=button tabindex=0 x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <div class="item__text item__text--file" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <span ng-switch="item.asset.content_type.indexOf(\'image/\')"> <span ng-switch-when=-1> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe x-src={{item.asset.url}} item=item x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-default> <img ng-src={{item.asset.url}}> </span> </span> </div> <div class=clear></div> </div> '},wZyx:function(e,t){e.exports='<span class=itt-socialshare> <span ng-if=!$ctrl.expanded> <a class="button button-facebook" ng-click="$ctrl.onShare(\'facebook\')"></a> <a class="button button-linkedin" ng-click="$ctrl.onShare(\'linkedin\')"></a> <a class="button button-share" ng-click=$ctrl.toggleExpanded()></a> </span> <div class=socialshare__row ng-if=$ctrl.expanded> <button class=socialshare__exit ng-click=$ctrl.toggleExpanded()> </button> <div class=socialshare__row--expanded> <div> <p>Share episode</p> <a ng-repeat="provider in $ctrl.providers" class=button ng-click=$ctrl.onShare(provider) ng-class="\'button-\' + provider"> </a> </div> <div> <p>Copy link</p> <div class=socialshare__clipboard> <np-clipboard light=true custom-notice=true on-copy=$ctrl.ontextCopied($event) source-text={{$ctrl.stubUrl}}> </np-clipboard> <div ng-if=$ctrl.textCopied> <span class="button button-text-copied"></span> <span class=text--notice>(Link copied to clipboard)</span> </div> </div> </div> <np-modal wrapper-class=email-modal__wrapper modal-class=email-modal__content ng-if=$ctrl.emailshareExpanded> <form name=emailshareForm> <div class=socialshare__email-row> <div class=socialshare__email-from> <span> <label for=ssFromName>From name</label> <input type=text id=ssFromName ng-model=email.from_name required/> </span> <span> <label for=ssFromEmail>From email</label> <input type=email id=ssFromEmail ng-model=email.from_email_address required/> </span> </div> <div class=socialshare__email-to> <span> <label for=ssToName>To name</label> <input id=ssToName type=text ng-model=email.to_name required/> </span> <span> <label for=ssToEmail>To email</label> <input type=email id=ssToEmail ng-model=email.to_email_address required/> </span> </div> <div class=socialshare__email-subject> <span> <label for=ssSubject>Subject</label> <input type=text id=ssSubject ng-init="email.subject = $ctrl.shareTitle" ng-model=email.subject required/> </span> </div> <div class=socialshare__email-message> <label for=ssMessage>Message</label> <textarea id=ssMessage ng-model=email.message required></textarea> </div> <div class=socialshare__email-sender-copy> <span> <input type=checkbox id=ssSenderCopy ng-init="email.sender_copy = true" ng-model=email.sender_copy /> <label for=ssSenderCopy>Send me a copy</label> </span> </div> <div class=socialshare__email-buttons> <button ng-click="$ctrl.handleEmailShare(email, emailshareForm)" type=submit>Send email</button> <button ng-click=$ctrl.toggleEmailshare()>Close</button> </div> </div> </form> </np-modal> </div> </div> </span> '},wmst:function(e,t){e.exports='<div class=assetUploader> <div ng-if=$ctrl.uploads.length> <div class=uploadList ng-repeat="upload in $ctrl.uploads"> <span class=uploadName> {{$ctrl.uploadStatus[$index].name}}: </span> <span class=uploadProgress> <span ng-if=$ctrl.uploadStatus[$index].done>Upload complete</span> <div ng-if=$ctrl.uploadStatus[$index].error>Error</div> <span ng-if="!$ctrl.uploadStatus[$index].done && !$ctrl.uploadStatus[$index].error"> <progress ng-attr-max={{$ctrl.uploadStatus[$index].bytesTotal}} ng-attr-value={{$ctrl.uploadStatus[$index].bytesSent}}> </progress> <span ng-switch=$ctrl.uploadStatus[$index].percent> <span ng-switch-when=100>...</span> <span ng-switch-default>{{$ctrl.uploadStatus[$index].percent}}%</span> </span> </span> </span> <div ng-if=$ctrl.uploadStatus[$index].error>{{$ctrl.uploadStatus[$index].error}}</div> </div> <span ng-if="$ctrl.uploadsinprogress > 0">{{$ctrl.uploadsinprogress}} files remaining <button ng-if=!$ctrl.paused ng-click=$ctrl.pauseUpload()>Pause</button> <button ng-if=$ctrl.paused ng-click=$ctrl.resumeUpload()>Resume</button> <button ng-click=$ctrl.cancelUpload()>Cancel</button> </span> </div> <div ng-if=$ctrl.errormessage class=error-red ng-bind-html=$ctrl.errormessage></div> <div class=uploadDropTarget> <a style=float:right ng-click="$ctrl.showInstructions = !$ctrl.showInstructions">(?)</a> Drag and drop <span ng-if=$ctrl.multiple>files</span> <span ng-if=!$ctrl.multiple>a file</span> here <br> <small> or choose <span ng-if=$ctrl.multiple>files</span> <span ng-if=!$ctrl.multiple>a file</span> to upload: <input class=uploadFileInput type=file multiple=true itt-files-handler on-selected=$ctrl.handleUploads(files)> </small> <div ng-if=$ctrl.showInstructions style=text-align:left> <small>{{$ctrl.manPage}}</small> </div> </div> </div> '},zMT9:function(e,t,i){"use strict";function authSvc_authSvc(e,t,i,n,a,s,o,l){function isTrueGuest(){var e=!0;return angular.forEach(s.user.roles,function(t){t.role!==d.GUEST&&(e=!1)}),e}var c={},d={ADMINISTRATOR:"admin",INSTRUCTOR:"instructor",STUDENT:"student",GUEST:"guest",CUSTOMER_ADMINISTRATOR:"customer admin"},p={CUSTOMER:"Customer"};c.isTrueGuest=isTrueGuest,c.userHasRole=function(e){if(s.user&&s.user.roles)for(var t=0;t<s.user.roles.length;t++)if(s.user.roles[t].role===e){if(e!==d.ADMINISTRATOR||!a.existy(s.user.roles[t].resource_id))return!0}else if(e===d.CUSTOMER_ADMINISTRATOR&&s.user.roles[t].role===d.ADMINISTRATOR&&a.existy(s.user.roles[t].resource_id)&&s.user.roles[t].resource_type===p.CUSTOMER)return!0;return!1},c.getCustomerIdsFromRoles=function(){if(s.user&&s.user.roles)return s.user.roles.reduce(function(e,t){return t.role===d.ADMINISTRATOR&&a.existy(t.resource_id)&&t.resource_type===p.CUSTOMER&&e.push(t.resource_id),e},[])},c.getRoleForNarrative=function(e,t){t=void 0!==t?t:s.user.roles;var i="",n=!1;if(t)for(var a=0;a<t.length;a++){switch(t[a].role){case d.ADMINISTRATOR:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="admin",n=!0;break;case d.INSTRUCTOR:if(t[a].resource_id&&t[a].resource_id!==e)continue;i=t[a].role;break;case d.STUDENT:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="instructor"===i?i:t[a].role;break;case d.GUEST:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="instructor"===i||"student"===i?i:t[a].role}if(n)break}return i},c.getDefaultProductForRole=function(e){var t="player";return"narrative"===s.productLoadedAs?e!==d.ADMINISTRATOR&&e!==d.INSTRUCTOR||(t="sxs"):l.error({data:"authSvc.getDefaultProductForRole should only be used within narratives for now"}),t},c.logout=function(){try{localStorage.removeItem(r.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(e){}s.user={},t({method:"GET",url:r.apiDataBaseUrl+"/logout"}).success(function(){delete t.defaults.headers.common.Authorization,n.path("/").search({logout:1})}).error(function(){delete t.defaults.headers.common.Authorization,n.path("/").search({logout:1})})},c.adminLogin=function(e,n){var a=i.defer();return t({method:"POST",url:r.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:e,password:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){t.defaults.headers.common.Authorization='Token token="'+e.access_token+'"',m(e),c.getCurrentUser().then(function(){a.resolve(e)})}).error(function(e){a.reject(e)}),a.promise};var u=i.defer();c.authenticate=function(i){if(t.defaults.headers.common.Authorization)s.user._id?u.resolve():c.getCurrentUser().then(function(){u.resolve()},function(){return c.authenticateViaNonce(i)});else{if(e.key){var a=e.key;return n.search("key",null),c.getAccessToken(a)}var o=c.getStoredToken();if(!o)return c.authenticateViaNonce(i);t.defaults.headers.common.Authorization='Token token="'+o+'"',c.getCurrentUser().then(function(){u.resolve()},function(){try{localStorage.removeItem(r.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(e){}return s.user={},c.authenticateViaNonce(i)})}return u.promise},c.authenticateViaNonce=function(e){var t=i.defer();return c.getNonce(e).then(function(e){c.getAccessToken(e).then(function(){t.resolve()})}),t.promise},c.getStoredToken=function(){var e={};try{if(!localStorage)return!1;localStorage.getItem(r.localStorageKey),e=angular.fromJson(localStorage.getItem(r.localStorageKey));var t=r.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];return e.customer!==t&&(localStorage.removeItem(r.localStorageKey),e={}),e.token||!1}catch(e){return!1}},c.getCurrentUser=function(){var e=i.defer();return t({method:"GET",url:r.apiDataBaseUrl+"/show_user"}).success(function(t){m(t),e.resolve()}).error(function(){e.reject()}),e.promise},c.updateUser=function(e){var n=i.defer();return t({method:"PUT",url:r.apiDataBaseUrl+"/users/"+e._id,data:e}).success(function(e){m(e),n.resolve()}).error(function(){n.reject()}),n.promise};var m=function(e){if(null!==e.roles&&void 0!==e.roles&&e.roles.length>0&&e.roles[0].constructor===String){for(var i=[],n=0;n<e.roles.length;n++){var a={role:e.roles[n]};i.push(a)}e.roles=i}var l={access_token:e.access_token||e.authentication_token,customer:r.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:e.roles};angular.forEach(["_id","name","email","track_event_actions","track_episode_metrics","avatar_id"],function(t){e[t]&&(l[t]=e[t])});var d=c.getStoredToken();l.avatar_id&&d&&(t.defaults.headers.common.Authorization='Token token="'+d+'"',t.get(r.apiDataBaseUrl+"/v1/assets/"+l.avatar_id).then(function(e){o.cache("asset",e.data),s.user.avatar=e.data.url})),e["track_episode_metrics:"]&&(l.track_episode_metrics=!0),l.roles&&(l.role_description=h(l.roles[0])),e.emails&&(l.email=e.emails[0]),s.user=l;try{localStorage.setItem(r.localStorageKey,JSON.stringify({token:l.access_token,customer:l.customer}))}catch(e){}},h=function(e){return void 0===e?"User":"admin"===e.role?"Administrator":void 0===e.role?"User":"guest"===e.role?"Guest user":e.role.match(/student/i)?"Student":e.role.match(/instructor/i)?"Instructor":e};return c.getNonce=function(e){var n=i.defer(),a=r.apiDataBaseUrl+"/v1/get_nonce";return e&&(a=a+"?"+e),t.get(a).success(function(e){e.nonce?n.resolve(e.nonce):e.login_url&&null!==e.login_url?(e.login_via_top_window_only?window.top.location.href=e.login_url:window.location.href=e.login_url,n.reject()):("#/"!==window.location.hash&&(window.location.href="/#/"),n.reject())}).error(function(){n.reject()}),n.promise},c.getAccessToken=function(e){var n=i.defer();return t.get(r.apiDataBaseUrl+"/v1/get_access_token/"+e).success(function(e){m(e),t.defaults.headers.common.Authorization='Token token="'+e.access_token+'"',c.getCurrentUser().then(function(){n.resolve(e)})}).error(function(){n.reject()}),n.promise},c}function ittUtils_ittUtils(e){function ngTimeout(t,i){return e(t,i||0)}function cancelNgTimeout(t){e.cancel(t)}return{getSubdomain:getSubdomain,existy:existy,truthy:truthy,generateUUID:generateUUID,isValidURL:isValidURL,stripHtmlTags:stripHtmlTags,pick:pick,bitwiseCeil:bitwiseCeil,setNgOpts:setNgOpts,intersection:intersection,parseTime:ittUtils_parseTime,renameKey:renameKey,ngTimeout:ngTimeout,cancelNgTimeout:cancelNgTimeout,capitalize:capitalize,slugify:slugify}}function capitalize(e){if(existy(e))return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}function bitwiseCeil(e){return e+(e<0?0:1)>>0}function pick(e,t){return t.reduce(function(t,i){return existy(e[i])&&(t[i]=angular.copy(e[i])),t},{})}function omit(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return Object.keys(e).reduce(function(i,n){return-1===t.indexOf(n)&&(i[n]=e[n]),i},{})}function stripHtmlTags(e){return String(e).replace(/<\/?[^>]*>/gm,"")}function getSubdomain(e){return e.indexOf(".")<0?null:e.split(".")[0]}function existy(e){return null!=e}function truthy(e){return 0!=e&&existy(e)}function generateUUID(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})}function isValidURL(e){return/^(((?:http)s?:\/\/)|(?:\/\/))(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i.test(e)}function setNgOpts(e){return"option.value as option.name for option in $ctrl.getSelectOpts('"+e+"')"}function intersection(e,t){for(var i=[],n=0;n<e.length;n++)for(var a=0;a<t.length;a++)if(e[n]==t[a]){i.push(n);break}return i}function ittUtils_parseTime(e){if(!isNaN(parseFloat(e))&&isFinite(e))return e;var t=e.match(/^(\d+)[m:]([\d\.]+)s?$/);return t?parseFloat(60*t[1])+parseFloat(t[2]):(t=e.match(/^([\d\.]+)s$/))?parseFloat(t[1]):(t=e.match(/^([\d\.]+)m$/),t?parseFloat(60*t[1]):void 0)}function renameKey(e,t,i){i.hasOwnProperty(e)&&!i.hasOwnProperty(t)&&e!==t&&(i[t]=i[e],delete i[e])}function slugify(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]/g,"")}function componentTemplateNameify(e){return"np"+e.split("-").map(function(e){return capitalize(e)}).join("")+"Template"}function mockSvc_mockSvc(e){var t={};return t.keepJsLintHappy=function(){e.episodes.noop},t.mockEpisode=function(t){e.cache("episode",{_id:t,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en",default:!0}],status:"Published",templateUrl:"templates/episode/gwsb.html",styles:["","",""]}),e.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var i={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:t,cur_episode_id:t,layouts:["",""],styles:["transitionSlideL"]},n=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/centered.html","templates/scene/onecol.html"],a=0;a<10;a++){var r=angular.copy(i);r._id="scene-"+a,r.title=a/2===Math.floor(a/2)?{en:"Scene "+(a+1)+" Title"}:{en:""},r.start_time=20*a,r.end_time=20*a+20,r.templateUrl=n[a%n.length],e.cache("event",r)}var s={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:t,cur_episode_id:t,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},o=["sidebarL","sidebarR","inline"],l=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(a=0;a<30;a++){var c=angular.copy(s);c._id="transcript-"+a,c.annotation={en:"Transcript block number "+(a+1)},c.start_time=5*a,c.end_time=5*a+5,c.layouts=[o[a%o.length]]}for(a=0;a<10;a++){var d=angular.copy(s);d._id="annotation-"+a,d.start_time=6*a,d.end_time=6*a+3,d.templateUrl=l[a%l.length],e.cache("event",d)}for(a=0;a<10;a++){var p=angular.copy(s);p._id="longtext-"+a,p.start_time=7*a,p.end_time=7*a+7,p.styles=["timestampNone"],p.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},p.templateUrl="templates/item/text-transmedia.html",e.cache("event",p)}e.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),e.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),e.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),e.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var u={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:t,cur_episode_id:t,layouts:["inline"],styles:["timestampNone"],isContent:!0};for(a=0;a<30;a++){var m=angular.copy(u);m._id="link-"+a,m.required=Math.random()>.5,m.start_time=3*a,m.end_time=3*a+3,m.layouts=[o[a%o.length]],e.cache("event",m)}var h={_id:"",_type:"Plugin",producerItemType:"question",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],title:{},data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",correct:!0,index:3},{text:"",index:4}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(a=0;a<10;a++){var g=angular.copy(h);g._id="question-"+a,g.required=Math.random()>.5,g.start_time=5*a,g.end_time=5*a+5,g.layouts=[o[a%o.length]],e.cache("event",g)}var v={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",index:3},{text:"",index:4}],_type:"question"}}};for(a=0;a<10;a++){var f=angular.copy(v);f._id="question-"+a,f.required=Math.random()>.5,f.start_time=6*a,f.end_time=6*a+6,f.layouts=[o[a%o.length]],e.cache("event",f)}var y={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(a=0;a<30;a++){var _=angular.copy(y);_._id="upload-"+a,_.asset_id="asset2",_.title={en:"Upload number "+(a%3+1)},_.start_time=4*a,_.end_time=4*a+4,_.layouts=[o[a%o.length]],e.cache("event",_)}var S=["mainFg","altFg","videoOverlay"];for(a=0;a<8;a++){var b=angular.copy(y);b.layouts=[S[a%S.length]],b._id="filltest-"+a,b.asset_id="asset2",b.start_time=2*a,b.end_time=2*a+2,b.templateUrl="templates/item/image-fill.html",b.styles.push("cover"),e.cache("event",b)}e.resolveEpisodeEvents(t),e.resolveEpisodeAssets(t)},t}function createInstance(e,t){var i;switch(e){case"Link":i=new H;break;case"Annotation":i=new q;break;case"Bookmark":i=new W;break;case"Chapter":i=new z;break;case"Image":i=new K;break;case"Plugin":i=new G;break;case"Scene":i=new Q;break;case"Text":i=new X;break;case"Upload":i=new Y;break;case"Narrative":i=new V;break;case"Asset":i=new R;break;case"Customer":i=new D;break;case"Timeline":i=new O;break;case"Episode":return i=new M,Object.assign(i,t),t.masterAsset&&(i.masterAsset=Object.assign(new U,t.masterAsset)),i;case"MasterAsset":i=new U;break;case"Container":i=new F;break;case"LayoutTemplate":i=new N;break;case"ItemTemplate":i=new L;break;case"EpisodeTemplate":return i=new x,Object.assign(i,t),t.css_configuration&&(i.css_configuration=Object.assign(new k,t.css_configuration)),t.fonts&&(i.fonts=Object.assign(new P,t.fonts)),i;case"Layout":i=new I;break;case"Style":i=new w}return Object.assign(i,t),i}function ittUser(e,t,i,n,a,r,s){return{restrict:"A",replace:!0,scope:{},template:oe.a,link:function(o,l,c){function toggleEditing(){o.isEditing=!o.isEditing}o.inPlayer=c.inPlayer,o.appState=t,o.loading=!0,o.logout=i.logout,o.canAccess=i.userHasRole("admin")||i.userHasRole("customer admin"),i.authenticate().then(function(){o.loading=!1,o.user=t.user,o.userHasRole=i.userHasRole}),o.isEditing=!1,o.toggleEditing=toggleEditing,o.uploadStatus=[],o.toggleUploadAvatar=function(){o.showUploadField=!o.showUploadField},o.uploadAvatar=function(i){function _resizeWithService(e){return s.resizeImg(e,60,60,!0).then(function(e){return e})}function _avatarFileFromImg(t){return e(function(e){e(s.createFileFromDataURL(t,i[0].name))})}function _postToAWS(e){a.uploadUserFiles(t.user._id,[e])[0].then(function(e){o.showUploadField=!1,r.cache("asset",e.file),t.user.avatar_id,t.user.avatar_id=e.file._id,o.updateUser(),delete o.uploads})}o.uploadStatus[0]={bytesSent:0,bytesTotal:1},s.readFileToImg(i[0]).then(_resizeWithService).then(_avatarFileFromImg).then(_postToAWS).catch(function(e){})},o.updateUser=function(){i.updateUser(t.user).then(function(){o.user=t.user})},o.getMyNarratives=function(){n.getUserNarratives(o.user._id).then(function(e){o.myPurchases=e,angular.forEach(o.myPurchases,function(e){e.daysUntilExpiration=Math.floor((new Date(e.expiration_date)-new Date)/864e5),n.getNarrativeOverview(e.narrative_id).then(function(e){angular.forEach(o.myPurchases,function(t){t.narrative_id===e._id&&(t.narrativeData=e)})})})})}}}}function ittRouteLoading(){return{restrict:"EA",template:['<div ng-if="routeLoadingCtrl.isLoading" class="loading routeLoading">','\t<div class="spinner">','\t\t<div class="rotating pie"></div>','\t\t<div class="filler pie"></div>','\t\t<div class="mask"></div>','\t</div><span class="loading__text">Loading</span>',"</div>"].join(" "),scope:{isLoading:"=?"},controller:["$rootScope","$scope","$timeout","errorSvc",function(e,t,i,n){var a=this;a.isLoading=a.isLoading||!1;var r;e.$on("$routeChangeStart",function(){r=i(function(){a.isLoading=!0},500)}),e.$on("$routeChangeSuccess",function(){i.cancel(r),a.isLoading=!1}),e.$on("$locationChangeSuccess",function(){i.cancel(r),a.isLoading=!1}),e.$on("$routeChangeError",function(){i.cancel(r),a.isLoading=!1}),t.$watch(function(){return n.errors.length},function(e,t){e!==t&&e>0&&(i.cancel(r),a.isLoading=!1)})}],controllerAs:"routeLoadingCtrl",bindToController:!0}}function ittValidationTip(){return{restrict:"EA",scope:{text:"@",doInfo:"=?"},template:['<span class="tooltip-static">',"\t<i class=\"fa fa-info-circle\" ng-class=\"{'error-red': !doInfo, 'info-blue': doInfo}\"></i>",'\t<span class="tooltip-text">{{text}}</span>',"</span>"].join("\n")}}function ittFilesHandler(){return{scope:{onSelected:"&"},restrict:"A",link:function(e,t){t.bind("change",function(){e.$apply(function(){e.onSelected({files:t[0].files})})})}}}function ittLogin(e,t,i,n,a){return{restrict:"A",replace:!1,link:function(s){s.userHasRole=i.userHasRole,s.appState=n,s.loginForm={auth_key:"",password:""},s.apiDataBaseUrl=r.apiDataBaseUrl,i.authenticate().then(function(){if(a.init(),t.key&&e.search("key",null),t.episode){var i=t.episode;e.search("episode",null),e.search("nonce",null),e.path("/episode/"+i)}else if(t.narrative){var n=t.narrative;if(e.search("narrative",null),e.search("nonce",null),t.timeline){var r=t.timeline;e.search("timeline",null),e.path("/story/"+n+"/"+r)}else e.path("/story/"+n)}else 0===Object.keys(t).length&&e.path("/account")},function(){}),s.adminLogin=function(){i.adminLogin(s.loginForm.auth_key,s.loginForm.password).then(function(){e.path("/projects")}).catch(function(e){s.badlogin=!0})},s.logout=function(){i.logout()}}}}function dataSvc_dataSvc(e,t,i,n,a,s,o,l,c,d,p,u,m){function sendSocialshareEmail(e,t){return w("/v3/timelines/"+e+"/share_via_email",t)}function beginBackgroundTranslations(e){return $("/v3/episodes/"+e+"/update_translations")}function batchUploadTranscripts(e,t,i){var n={transformRequest:angular.identity,headers:{"Content-type":void 0}};return s.existy(i)&&Object.keys(i).length>0&&Object.assign(n,{params:i}),w("/v3/episodes/"+e+"/events/import_subtitles",t,n)}function generateNewNarrative(e,t){return w("/v3/containers/"+e+"/narratives",t).then(function(e){return e.data}).catch(function(e){})}function getCustomerLinkStatusReportSpreadsheet(e){var t="/v3/customers/"+e+"/link_status.xlsx";window.open(t)}function getAssetsByAssetIds(e){var t=Object.create(null);return t.asset_ids=e,w("/v1/assets",t).then(function(e){return e.data.files})}function fetchAndCacheAssetsByIds(e){return getAssetsByAssetIds(e).then(function(t){return t.forEach(function(e){c.cache("asset",e)}),e.reduce(function(e,t){return e.push(c.assets[t]),e},[])})}function deleteContainer(e){return L("/v3/containers/"+e)}function readCache(e,t,i){return c.readDataCache(e,t,i)}function getEpisodeTemplatesAdmin(){if(o.userHasRole("admin"))return h.getTemplates().reduce(function(e,t){return t instanceof x&&e.push({id:t.id,name:t.displayName,customer_ids:t.customer_ids}),e},[])}function getEpisodeTemplatesByCustomerIds(e){return h.getTemplates().reduce(function(t,i){if(i instanceof x){intersection(e,i.customer_ids).length>0&&t.push({id:i.id,name:i.displayName,customer_ids:i.customer_ids})}return t},[])}function fetchTemplates(){return $("/v1/templates").then(function(e){return h.cache("templates",e)}).then(function(){return h.getTemplates()})}function getTemplate(e){return c.dataCache.template[e]}var h=Object.create(null);h.sendSocialshareEmail=sendSocialshareEmail,h.beginBackgroundTranslations=beginBackgroundTranslations,h.batchUploadTranscripts=batchUploadTranscripts,h.generateNewNarrative=generateNewNarrative,h.getNarrative=function(i){var n=e.defer(),l=c.narratives[i],d=s.getSubdomain(a.host()),p="";return s.existy(l)&&s.existy(l.narrative_subdomain)&&d!==l.narrative_subdomain&&(p="?customer="+l.narrative_subdomain),o.authenticate("narrative="+i).then(function(){t.get(r.apiDataBaseUrl+"/v3/narratives/"+i+"/resolve"+p).then(function(e){e.data.timelines.sort(function(e,t){return e.sort_order-t.sort_order}),c.cache("narrative",h.resolveIDs(e.data)),n.resolve(c.narratives[e.data._id])})}),n.promise},h.getNarrativeOverview=function(e){return C("/v3/narratives/"+e)},h.getNarrativeExportAsSpreadsheet=function(e){var t="/v3/narratives/"+e+".xlsx";window.open(t)},h.getCustomerLinkStatusReportSpreadsheet=getCustomerLinkStatusReportSpreadsheet;var g=!1;h.getUserNarratives=function(t){if(g){var i=e.defer();return i.resolve(g),i.promise}return C("/v3/users/"+t+"/narrative_purchases",function(e){return g=e,e})},h.getCustomerList=function(){return C("/v3/customers/",function(e){return angular.forEach(e,function(e){c.cache("customer",e)}),e})},h.getCustomer=function(t,i){return o.userHasRole("admin")||o.userHasRole("customer admin")?c.customers[t]?i?e(function(e){e(c.customers[t])}):void 0:$("/v3/customers/"+t).then(function(e){return c.cache("customer",e),c.customers[e._id]}).catch(function(e){}):e(function(e){e({})})},h.getEpisode=function(e,t){if(!e)throw"no episode ID supplied to dataSvc.getEpisode";c.cache("episode",{_id:e}),i.local?(p.mockEpisode(e),n.$emit("dataSvc.getEpisode.done")):o.authenticate().then(function(){return y()}).then(function(){return b(e,t)})},h.getEpisodeOverview=function(e){return C("/v3/episodes/"+e)},h.getNarrativeList=function(e){return s.existy(e)?C("/v3/narratives?customer_id="+e._id).then(function(t){c.assocNarrativesWithCustomer(e,t)}):C("/v3/narratives/")},h.createUserGroup=function(e){return P("/v3/groups",{group:{name:e}})},h.createNarrative=function(e){return w("/v3/narratives",e)},h.updateNarrative=function(e){return I("/v3/narratives/"+e._id,e)},h.createChildEpisode=function(e){return P("/v3/episodes",{episode:e})},h.createEpisodeSegment=function(e,t){return P("/v3/timelines/"+e+"/episode_segments",t)},h.storeTimeline=function(e,t){var i=["sort_order","path_slug","name","description","hidden","timeline_image_ids","narrative_id","_id"],n=s.pick(t,i);return n._id?k("/v3/timelines/"+n._id,n,function(e){return"string"==typeof e.name&&(e.name={en:e.name}),"string"==typeof e.description&&(e.description={en:e.description}),e}):P("/v3/narratives/"+e+"/timelines",n,function(e){return"string"==typeof e.name&&(e.name={en:e.name}),"string"==typeof e.description&&(e.description={en:e.description}),e})},h.deleteTimeline=function(e){return L("/v3/timelines/"+e).then(function(e){return e})},h.getSingleAsset=function(t){return t?C("/v1/assets/"+t):e(function(e){e(void 0)})};var v=!1,f=e.defer(),y=function(){return v?f.promise:(v=!0,e.all([t.get(r.apiDataBaseUrl+"/v1/templates"),t.get(r.apiDataBaseUrl+"/v1/layouts"),t.get(r.apiDataBaseUrl+"/v1/styles")]).then(function(e){h.cache("templates",e[0].data),h.cache("layouts",e[1].data),h.cache("styles",e[2].data),v=!0,f.resolve()},function(){v=!1,f.reject()}),f.promise)};h.getCommon=y,h.cache=function(e,t){angular.forEach(t,function(t){"templates"===e?t.applies_to_episodes?c.dataCache.template[t._id]=createInstance("EpisodeTemplate",{id:t._id,url:t.url,type:"Episode",displayName:t.name,customer_ids:t.customer_ids,css_configuration:t.css_configuration,fonts:t.fonts,pro_episode_template:t.pro_episode_template}):t.event_types&&t.event_types&&"Scene"===t.event_types[0]?c.dataCache.template[t._id]=createInstance("LayoutTemplate",{id:t._id,url:t.url,type:"Scene",displayName:t.name,component_name:t.component_name}):c.dataCache.template[t._id]=createInstance("ItemTemplate",{id:t._id,url:t.url,type:t.event_types&&t.event_types[0],displayName:t.name,component_name:t.component_name}):"layouts"===e?c.dataCache.layout[t._id]=createInstance("Layout",{id:t._id,css_name:t.css_name,displayName:t.display_name}):"styles"===e&&(c.dataCache.style[t._id]=createInstance("Style",{id:t._id,css_name:t.css_name,displayName:t.display_name}))})},h.createTemplate=function(e){return P("/v1/templates",e)},h.resolveIDs=function(e){if(e.layout_id){var t=[];"Scene"===e.type&&(t=["",""]),angular.forEach(e.layout_id,function(i){c.dataCache.layout[i]?"Scene"===e.type?"showCurrent"===c.dataCache.layout[i].css_name?t[1]=c.dataCache.layout[i].css_name:"splitRequired"===c.dataCache.layout[i].css_name?t[2]=c.dataCache.layout[i].css_name:t[0]=c.dataCache.layout[i].css_name:t.push(c.dataCache.layout[i].css_name):d.error({data:"Couldn't get layout for id "+i})}),t.length>0&&(e.layouts=t)}if(e.style_id){var i=[];angular.forEach(e.style_id,function(e){c.dataCache.style[e]?i.push(c.dataCache.style[e].css_name):d.error({data:"Couldn't get style for id "+e})}),i.length>0&&(e.styles=i)}return e};var _=function(e){return e.hasOwnProperty("asset_id")&&e.asset_id?e.asset_id:e.hasOwnProperty("annotation_image_id")&&e.annotation_image_id?e.annotation_image_id:e.hasOwnProperty("link_image_id")&&e.link_image_id?e.link_image_id:e.hasOwnProperty("avatar_id")&&e.avatar_id?e.avatar_id:void 0},S=function(e){for(var t={},i=0,n=e.length;i<n;i++){var a=_(e[i]);a&&(a in t||(t[a]=0))}return Object.keys(t)};h.getAssetsByAssetIds=getAssetsByAssetIds,h.fetchAndCacheAssetsByIds=fetchAndCacheAssetsByIds;var b=function(e,i){var a=i?"/v3/episode_segments/"+i+"/resolve":"/v3/episodes/"+e;t.get(r.apiDataBaseUrl+a).success(function(t){var a=Object.create(null);if(t&&(a=t.episode?t.episode:t),"Published"===a.status||o.userHasRole("admin")||o.userHasRole("customer admin")){var r=c.dataCache.template[a.template_id];a.template=r,c.cache("episode",h.resolveIDs(a)),r&&m.setTheme(r),T(e,i).success(function(t){t=t||[],E(t,"Plugin",e),angular.forEach(t,function(t){t.cur_episode_id=e,c.cache("event",h.resolveIDs(t))}),c.resolveEpisodeEvents(e);var i=S(t);i=void 0!==i&&i.length>0?i:[],i.push(a.master_asset_id),a.poster_frame_id&&i.push(a.poster_frame_id),getAssetsByAssetIds(i).then(function(t){t.forEach(function(e){c.cache("asset",e)}),c.resolveEpisodeAssets(e),n.$emit("dataSvc.getEpisode.done")})}).error(function(){d.error({data:"API call to get events failed."})})}else d.error({data:"This episode has not yet been published."})}).error(function(){d.error({data:"API call to /v3/episodes/"+e+" failed (bad episode ID?)"})})};h.getContainerAncestry=function(t,i,n){return n=n||e.defer(),h.getContainer(t,i).then(function(e){var t=c.containers[e];t.parent_id?h.getContainerAncestry(t.parent_id,i,n):n.resolve(e)}),n.promise};var T=function(e,i){var n=i?"/v3/episode_segments/"+i+"/events":"/v3/episodes/"+e+"/events";return t.get(r.apiDataBaseUrl+n)},E=function(e,t,i){angular.forEach(e,function(e){"Plugin"===e.type&&function(e){u.getUserAnswer(e._id,l.user._id).then(function(t){if(t.data){e.data._plugin.hasBeenAnswered=!0;var i=0,n=!0;angular.forEach(e.data._plugin.distractors,function(a){n&&(a.index===t.data.index&&(a.selected=!0,e.data._plugin.selectedDistractor=a.index,n=!1),i++)}),c.cache("event",h.resolveIDs(e))}})}(e)}),c.resolveEpisodeEvents(i)},C=function(i,n){var a=e.defer();return o.authenticate().then(function(){t.get(r.apiDataBaseUrl+i).then(function(e){var t=e.data;return n&&(t=n(t)),a.resolve(t)})}),a.promise},$=function(e){return o.authenticate().then(function(){return t.get(r.apiDataBaseUrl+e).then(function(e){return e.data})})},w=function(e,i,n){var a=r.apiDataBaseUrl+e;return n?t.post(a,i,n):t.post(a,i)},I=function(e,i){return t.put(r.apiDataBaseUrl+e,i)},k=function(i,n,a){var s=e.defer();return t({method:"PUT",url:r.apiDataBaseUrl+i,data:n}).success(function(e){var t=e;a&&(t=a(t)),s.resolve(t)}),s.promise},P=function(i,n,a){var s=e.defer();return t({method:"POST",url:r.apiDataBaseUrl+i,data:n}).success(function(e){var t=e;a&&(t=a(t)),s.resolve(t)}),s.promise},A=function(i){var n=e.defer();return t({method:"DELETE",url:r.apiDataBaseUrl+i}).success(function(e){return n.resolve(e)}),n.promise},L=function(e){return t({method:"DELETE",url:r.apiDataBaseUrl+e}).then(function(e){return e})};h.getContainerRoot=function(){return C("/v3/containers",function(e){var t=[];return angular.forEach(e,function(e){c.cache("container",e),t.push(e._id)}),t})},h.getContainer=function(e,t){return C("/v3/containers/"+e,function(i){c.cache("container",i[0]);var n=c.containers[i[0]._id];if(h.getContainerAssets(e,t),n.children){for(var a=0;a<n.children.length;a++)n.children[a]=c.containers[n.children[a]._id];var r=!1;t||(r=!0),r&&angular.forEach(n.children,function(e){e.episodes[0]&&h.getEpisodeOverview(e.episodes[0]).then(function(t){t&&(e.status=t.status,e.title=t.title,c.cache("container",e))})})}return i[0]._id})},h.getContainerAssets=function(e,i){return t.get(r.apiDataBaseUrl+"/v1/containers/"+e+"/assets").success(function(t){c.containers[e].assetsHaveLoaded=!0,angular.forEach(t.files,function(e){c.cache("asset",e)}),c.resolveEpisodeAssets(i)})},h.createContainer=function(t){var i=e.defer(),n={container:{customer_id:t.customer_id,name:t.name,parent_id:t.parent_id}};return P("/v3/containers",n).then(function(e){c.cache("container",e);var t=c.containers[e._id],n=t.parent_id;c.containers[n].children.push(t),i.resolve(t)}),i.promise},h.updateContainer=function(t){var i=e.defer();return t._id||i.reject(),k("/v3/containers/"+t._id,t,function(e){c.cache("container",e),i.resolve(e)}),i.promise},h.deleteContainer=deleteContainer,h.createEpisode=function(t){t.status="Unpublished";var i=e.defer();return P("/v3/episodes",t).then(function(e){c.containers[e.container_id].episodes=[e._id],c.containers[e.container_id].status=e.status,i.resolve(e)}),i.promise},h.storeEpisode=function(t){var i=U(t);return null!=i?k("/v3/episodes/"+i._id,i):e.reject(!1)},h.deleteItem=function(e){return A("/v3/events/"+e)},h.createAsset=function(t,i){var n=e.defer();return i.container_id=t,i._id&&i._id.match(/internal/)&&delete i._id,i=c.deriveAsset(i),P("/v1/containers/"+t+"/assets",i).then(function(e){c.containers[e.file.container_id].episodes=[e.file._id],c.cache("asset",e.file),n.resolve(e.file)}),n.promise},h.deleteAsset=function(e){return A("/v1/assets/"+e)},h.storeItem=function(t){return t=N(t),t?t&&t._id&&!t._id.match(/internal/)?k("/v3/events/"+t._id,{event:t}):P("/v3/episodes/"+t.episode_id+"/events",{event:t}):e.reject({})};var N=function(e){var t={};e._id&&e._id.match(/internal/)&&delete e._id;var i=["_id","start_time","end_time","episode_id","chapter_marker","template_id","stop","required","cosmetic","sxs","title","url","target","url_status","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id","avatar_id"];t.type=e._type;for(var n=0;n<i.length;n++)void 0!==e[i[n]]&&(t[i[n]]=angular.copy(e[i[n]]));if(t.start_time&&t.end_time){var a=parseFloat(t.start_time),r=parseFloat(t.end_time);if(isNaN(a)||isNaN(r))return d.error({data:"Tried to store an invalid start_time or end_time."}),!1;if(a>r)return d.error({data:"Tried to store a start_time that is after the end_time."}),!1}if(t.data&&(delete t.data._plugin.selectedDistractor,delete t.data._plugin.hasBeenAnswered,delete t.data._plugin._type,t.data._plugin.distractors.length))for(n=0;n<t.data._plugin.distractors.length;n++)delete t.data._plugin.distractors[n].selected;if(t.style_id=[],t.layout_id=[],t.style_id=M("style",e.styles),t.layout_id=M("layout",e.layouts),"Chapter"===e._type)return t;var s=h.readCache("template","component_name",e.component_name);return null!=s&&(t.template_id=s.id),t.template_id?t:(d.error({data:"Tried to store a template with no ID: "+e.templateUrl}),!1)};h.prepItemForStorage=N,h.detachMasterAsset=function(t){var i=U(t);return i.master_asset_id=null,i?k("/v3/episodes/"+i._id,i):e.reject(!1)},h.detachEventAsset=function(e,t){return!!(e=N(e))&&(e.asset_id===t&&(e.asset_id=null),e.link_image_id===t&&(e.link_image_id=null),e.annotation_image_id===t&&(e.annotation_image_id=null),e&&e._id&&!e._id.match(/internal/)?k("/v3/events/"+e._id,{event:e}):P("/v3/episodes/"+e.episode_id+"/events",{event:e}))};var U=function(e){e._id&&e._id.match(/internal/)&&delete e._id;var t=["_id","title","description","container_id","customer_id","master_asset_id","poster_frame_id","status","languages","template_id"],i=pick(e,t);i.style_id=M("style",e.styles);var n=h.readCache("template","id",e.template_id);return n&&n.id?(i.template_id=n.id,i):(d.error({data:"Tried to store a template with no ID: "+e.template_id}),null)};h.readCache=readCache,r.debugInBrowser,h.getTemplates=function(){return Object.keys(c.dataCache.template).map(function(e){return c.dataCache.template[e]})},h.getEpisodeTemplatesAdmin=getEpisodeTemplatesAdmin,h.getEpisodeTemplatesByCustomerIds=getEpisodeTemplatesByCustomerIds,h.fetchTemplates=fetchTemplates,h.getTemplate=getTemplate;var M=function(e,t){var i=[];return angular.forEach(t,function(t){if(t){var n=h.readCache(e,"css_name",t);if(null==n)return d.error({data:"Tried to store a "+e+" with no ID: "+t}),!1;i.push(n.id)}}),i};return h}function modelSvc_modelSvc(e,t,i,n,a,s){function readCache(e,t,i){var n=o.dataCache[e];for(var a in n)if(n.hasOwnProperty(a)&&n[a][t]===i)return n[a];return null}function mainVideoNewWindowUrl(e,t,i,n,a){void 0===a&&(a="episode");var s=r.apiDataBaseUrl+"/v1/new_window";return t&&i?s+"?narrative="+t+"&timeline="+i+"&access_token="+e+"&t="+(n||0):s+"?"+a+"="+t+"&access_token="+e+"&t="+(n||0)}function assocNarrativesWithCustomer(e,t){return t.forEach(function(e){o.cache("narrative",e)}),e.narratives=cachedNarrativesByCustomer(e),o.cache("customer",e),e}function cachedNarrativesByCustomer(e){return Object.keys(o.narratives).reduce(function(t,i){return o.narratives[i].customer_id===e._id&&t.push(o.narratives[i]),t},[])}function getCustomersAsArray(){return Object.keys(o.customers).map(function(e){return o.customers[e]})}function getNarrativesAsArray(){return Object.keys(o.narratives).map(function(e){return o.narratives[e]})}function _sortItems(e){return e.sort(function(e,t){return e.start_time===t.start_time?"chapter"===e.producerItemType?-1:"chapter"===t.producerItemType?1:!0===e.chapter_marker?-1:!0===t.chapter_marker?1:e.component_name===p.HEADER_ONE_TEMPLATE?-1:t.component_name===p.HEADER_ONE_TEMPLATE?1:e.component_name===p.HEADER_TWO_TEMPLATE?-1:t.component_name===p.HEADER_TWO_TEMPLATE?1:e.isTranscript?-1:t.isTranscript?1:"Link"===e._type?-1:"Link"===t._type?1:"Upload"===e._type?"file"===e.producerItemType||"Annotation"===t._type?-1:1:"Upload"===t._type?1:-1:e.start_time-t.start_time})}function isOnExistingSceneStart(e){return getEpisodeScenes().some(function(t){return t.start_time===i.parseTime(e)})}function getEpisodeScenes(){return Object.keys(o.events).reduce(function(e,t){return"Scene"===o.events[t]._type&&o.events[t].episode_id===n.episodeId&&e.push(o.events[t]),e},[])}function assocEventWithAsset(e,t){o.events[e]&&o.assets[t]&&(o.events[e].asset=o.assets[t])}var o=Object.create(null);o.episodes={},o.assets={},o.events={},o.containers={},o.narratives={},o.customers={},o.dataCache={template:{},layout:{},style:{}},o.readDataCache=readCache,o.mainVideoNewWindowUrl=mainVideoNewWindowUrl,o.getNarrativeByPathOrId=function(e){if(/^[0-9a-fA-F]{24}$/.test(e))return o.narratives[e];var t;for(t in o.narratives)if(o.narratives.hasOwnProperty(t)&&e===o.narratives[t].path_slug.en)return o.narratives[t]},o.assocNarrativesWithCustomer=assocNarrativesWithCustomer,o.cachedNarrativesByCustomer=cachedNarrativesByCustomer,o.getCustomersAsArray=getCustomersAsArray,o.getNarrativesAsArray=getNarrativesAsArray,o.cache=function(e,t){if("narrative"===e){var i=createInstance("Narrative",t);i.timelines&&i.timelines.length>0&&(i.timelines=i.timelines.map(function(e){return createInstance("Timeline",e)})),o.narratives[t._id]?angular.extend(o.narratives[t._id],i):o.narratives[t._id]=angular.copy(i)}if("customer"===e){var i=createInstance("Customer",t);o.customers[t._id]?angular.extend(o.customers[t._id],i):o.customers[t._id]=angular.copy(i)}if("episode"===e){var i=createInstance("Episode",t);o.episodes[t._id]?angular.extend(o.episodes[t._id],o.deriveEpisode(angular.copy(i))):o.episodes[t._id]=o.deriveEpisode(angular.copy(i))}else if("event"===e){var i=createInstance(t._type,t);i.title||(i.title={}),o.events[t._id]?angular.extend(o.events[t._id],o.deriveEvent(angular.copy(i))):o.events[t._id]=o.deriveEvent(angular.copy(i))}else if("asset"===e){var i=createInstance("Asset",t);o.assets[t._id]?angular.extend(o.assets[t._id],o.deriveAsset(angular.copy(i))):o.assets[t._id]=o.deriveAsset(angular.copy(i))}else if("container"===e){var i=createInstance("Container",t);o.containers[t._id]?angular.extend(o.containers[t._id],o.deriveContainer(angular.copy(i))):o.containers[t._id]=o.deriveContainer(angular.copy(i))}return o[e+"s"][t._id]},o.deriveEpisode=function(e){if(angular.forEach(e.languages,function(t){t.default&&(e.defaultLanguage=t.code)}),!1===e.defaultLanguage&&(e.defaultLanguage="en"),o.setLanguageStrings(),e.styles||(e.styles=[]),e.title&&o.events["internal:landingscreen:"+e._id]&&(o.events["internal:landingscreen:"+e._id].title=e.title,o.events["internal:landingscreen:"+e._id]=c(o.events["internal:landingscreen:"+e._id])),e.template){var t="Career Playbook"===e.template.displayName||"Narrasys Professional"===e.template.displayName;e.template&&t&&(n.resizeIframeReviewMode=!0)}return e=c(e)},o.deriveAsset=function(e){var t=Object.assign({},e);return"Asset::Video"===t._type&&(t=s.resolveVideo(t)),t.url&&(t.cssBgUrl=t.url.replace(/\"/g,'\\"')),t=c(t)},o.deriveContainer=function(e){if(e.haveNotLoadedChildData=!1,e.children&&e.children.length>0){e.children=e.children.sort(function(e,t){return e.name.en>t.name.en?1:-1}),e.children=e.children.sort(function(e,t){return e.sort_order-t.sort_order});var t=[];angular.forEach(e.children,function(e){var i=createInstance("Container",e);o.containers[e._id]?t.push(o.containers[e._id]):(i.haveNotLoadedChildData=!0,o.containers[e._id]=angular.copy(c(i)))}),e.loadedChildData=!0}else e.children=[];return c(e)};var l=function(e){if(void 0!==e)return"Annotation"===e._type&&e.component_name===p.TRANSCRIPT_TEMPLATE};o.deriveEvent=function(i){var a=i,r=readCache("template","id",a.template_id);if(null!=r&&(a.component_name=r.component_name),a=c(a),"Scene"!==a._type){a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator),a.cosmetic||(a.cosmetic=!1),a.sxs&&(a.cosmetic=!1),a.avatar_id&&(o.assets[a.avatar_id]||(o.assets[a.avatar_id]={}),a.avatar=o.assets[a.avatar_id]),o.episodes[a.cur_episode_id]&&"University of Southern California"===o.episodes[a.cur_episode_id].template.displayName&&(a instanceof G&&a.data&&"credlyBadge"===a.data._pluginType&&(a.component_name=p.USC_BADGES_TEMPLATE),"Link"===a._type&&(a.display_title.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youâ€™re finished - Come back to this page and click <b>Continue</b>).<br><br>If youâ€™d rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.display_title.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.display_title.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge"))),a.isContent=!1,a.isTranscript=!1,a.mixedContent=!1,a.targetTop=!1,a.isVideoUrl=!1,a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,l(a)&&(a.isTranscript=!0);var d="https"===t.protocol();"Link"===a._type&&a.url&&a.url.match(/^http:\/\//)&&d&&(a.mixedContent=!0,a.showInlineDetail=!1),"Link"===a._type&&s.isVideoUrl(a.url)&&(a.isVideoUrl=!0),"Link"===a._type&&a.url&&/mailto/.test(a.url)&&(a.target="_blank"),"annotation"!==a.producerItemType||"producer"!==n.product||a.cosmetic||(a.showAsHeader=!(a.component_name===p.TEXT_DEFINITION_TEMPLATE||a.component_name===p.TEXT_TRANSMEDIA_TEMPLATE))}switch(a.producerItemType){case"chapter":a.isContent=!1;break;case"annotation":a.isPq=a.isHeader=a.isLongText=a.isDef=!1,a.component_name===p.PULLQUOTE_TEMPLATE&&(a.isPq=!0),/header-two|header-one/.test(a.component_name)&&(a.isHeader=!0),a.component_name===p.TEXT_TRANSMEDIA_TEMPLATE&&(a.isLongText=!0),a.component_name===p.TEXT_DEFINITION_TEMPLATE&&(a.isDef=!0)}return a.displayStartTime=e("asTime")(a.start_time),a};var c=function(e){var t=n.lang?n.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(i){e[i]&&("string"==typeof e[i]?e["display_"+i]=e[i]:e[i][t]?e["display_"+i]=e[i][t]:e["display_"+i]=e[i].en)}),e};o.setLanguageStrings=function(){angular.forEach(o.events,function(e){e=c(e)}),angular.forEach(o.episodes,function(e){e=c(e)}),angular.forEach(o.containers,function(e){e=c(e)})},o.resolveEpisodeEvents=function(e){var t=[],n=[],a=[],r=o.episodes[e];angular.forEach(o.events,function(i){i.cur_episode_id===e&&("Scene"===i._type?t.push(i):"Chapter"===i._type?(a.push(i),n.push(i)):n.push(i))});var s={};angular.forEach(n,function(e){if("Annotation"===e._type&&!0===e.chapter_marker&&a.push(e),"Annotation"===e._type&&e.annotator){var t=r.defaultLanguage||"en",i=e.annotator[t];void 0===i&&(i=e.annotator[Object.keys(e.annotator).sort()[0]]),s[i]?(s[i].name=angular.extend(s[i].name,e.annotator),s[i].annotation_image_id||(s[i].annotation_image_id=e.annotation_image_id)):s[i]={name:e.annotator,annotation_image_id:e.annotation_image_id};for(var n=Object.keys(s[i].name).sort(),o=s[i].name[t]||"(untranslated)",l=0;l<n.length;l++)n[l]!==t&&(o=o+" / "+s[i].name[n[l]]);s[i].key=o}}),r.annotators=s,r.chapters=a;var c=0;r.masterAsset&&(c=r.masterAsset.duration,angular.forEach(r.scenes,function(e){e.start_time>c&&(e.start_time=c-.2)})),r.scenes=t.sort(function(e,t){return e._id.indexOf("internal:start")>-1||t._id.indexOf("internal:end")>-1?-1:t._id.indexOf("internal:start")>-1||e._id.indexOf("internal:end")>-1?1:e.start_time-t.start_time}),r.chapters=a.sort(function(e,t){return e.start_time-t.start_time}),angular.forEach(n,function(e){c>0&&e.start_time>c-.11&&(e.start_time=c-.2,e.end_time=c-.1),e.start_time<.01&&(e.start_time=.01,e.end_time<.01&&(e.end_time=.01)),e.start_time>e.end_time&&(e.end_time=e.start_time)}),r.items=_sortItems(n);for(var u=1,m=r.scenes.length;u<m;u++)u===m-1?0!==c&&(r.scenes[u].end_time=c):r.scenes[u].end_time=r.scenes[u+1].start_time;for(var h=0,g=t.length;h<g;h++){for(var v=t[h],f=[],y={},_=0,S=n.length;_<S;_++){var b=n[_];b.start_time>=v.start_time&&b.start_time<v.end_time&&(l(b)&&(y.end_time===v.end_time&&(y.end_time=b.start_time),y=b),b.end_time<=v.end_time?(o.events[b._id].scene_id=v._id,f.push(b)):v.end_time-.25<b.start_time&&h!==g-1?b.start_time=v.end_time:(b.end_time=v.end_time,b.scene_id=v._id,f.push(b)))}o.events[v._id].items=_sortItems(f)}return r.styleCss=d(r),r.templateCss=r.styleCss,r instanceof M&&r.template.pro_episode_template&&(r.templateCss="professional "+r.templateCss),r.template&&"Wiley"===r.template.displayName&&(r.templateCss+=" wiley-endscreentext "),angular.forEach(o.events,function(t){if(t.cur_episode_id===e){t.styleCss=d(t);var n,a=t.component_name===p.IMAGE_PLAIN_TEMPLATE,s=t.component_name===p.IMAGE_INLINE_WITHTEXT_TEMPLATE,l=t.component_name===p.SLIDING_CAPTION,c=t.component_name===p.IMAGE_THUMBNAIL_TEMPLATE,u=t.component_name===p.IMAGE_FILL_TEMPLATE,m=t.component_name===p.TEXT_TRANSMEDIA_TEMPLATE,h=t.component_name===p.TEXT_DEFINITION_TEMPLATE,g=t.component_name===p.HEADER_ONE_TEMPLATE,v=t.component_name===p.HEADER_TWO_TEMPLATE,f=t.component_name===p.PULLQUOTE_TEMPLATE,y=["highlightSolid","highlightBorder","highlightSide","highlightBloom","highlightTilt","highlightNone"],_=["transitionFade","transitionPop","transitionNone","transitionSlideL","transitionSlideR"];"Scene"!==t._type&&(n=o.scene(t.scene_id),-1!==r.styles.indexOf("timestampNone")||-1!==r.styles.indexOf("timestampInline")||i.existy(n)&&i.existy(n.styles)&&(-1!==n.styles.indexOf("timestampNone")||-1!==n.styles.indexOf("timestampInline"))||(a||m||h)&&(!i.existy(t.styles)||-1===t.styles.indexOf("timestampInline")&&-1===t.styles.indexOf("timestampNone"))&&(t.styleCss+=" timestampNone"),(g||v||f)&&(t.styleCss+=" timestampNone"),i.existy(t.layouts)&&-1!==t.layouts.indexOf("showCurrent")||0!==i.intersection(r.styles,y).length||i.existy(n)&&i.existy(n.styles)&&0!==i.intersection(n.styles,y).length||i.existy(t.styles)&&0!==i.intersection(t.styles,y).length||(t.styleCss+=" highlightSolid"),0!==i.intersection(r.styles,_).length||i.existy(n)&&i.existy(n.styles)&&0!==i.intersection(n.styles,_).length||i.existy(t.styles)&&0!==i.intersection(t.styles,_).length||(a||s||l||c||f||u?i.existy(t.layouts)&&-1===t.layouts.indexOf("videoOverlay")?t.styleCss+=" transitionPop":t.styleCss+=" transitionFade":t.styleCss+=" transitionSlideL")),t.layouts&&(t.styleCss=t.styleCss+" "+t.layouts.join(" ")),t.styleCss=t.styleCss.replace(/timestampInline/,"")}}),r},o.resolveEpisodeContainers=function(e){var t=o.episodes[e];t.parents=[],delete t.previousEpisodeContainer,delete t.nextEpisodeContainer,t.navigation_depth=0},o.episode=function(e){return o.episodes[e],o.episodes[e]},o.episodeEvents=function(e){var t=[];return angular.forEach(o.events,function(i){i.cur_episode_id===e&&t.push(i)}),t},o.isOnExistingSceneStart=isOnExistingSceneStart,o.getEpisodeScenes=getEpisodeScenes,o.sceneAtEpisodeTime=function(e,t){t=t||a.getMetaProp("time");for(var i=o.episodes[e].scenes,n=0;n<i.length;n++)if(i[n].start_time<=t&&i[n].end_time>t)return i[n]},o.scene=function(e){return o.events[e],o.events[e]};var d=function(e){var t={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},i=[];if(angular.forEach(e.styles,function(e){i.push(e),angular.forEach(t,function(i,n){0===e.indexOf(n)&&(t[n]=e)})}),e.scene_id){var n=o.events[e.scene_id].styles;angular.forEach(n,function(e){angular.forEach(t,function(n,a){t[a]||0!==e.indexOf(a)||(i.push(e),t[a]=e)})})}if(e.cur_episode_id){var a=o.episodes[e.cur_episode_id].styles;angular.forEach(a,function(e){angular.forEach(t,function(n,a){t[a]||0!==e.indexOf(a)||i.push(e)})})}if("Scene"!==e._type&&!e.isContent&&e.layouts&&e.layouts[0].match(/Bg/))for(var r=0;r<i.length;r++)i[r].match(/transition/)&&"transitionNone"!==i[r]&&(i[r]="transitionFade");return i.join(" ")};return o.assocEventWithAsset=assocEventWithAsset,o.resolveEpisodeAssets=function(e){if(angular.forEach(o.events,function(t){if(t.cur_episode_id===e){var i=t.asset_id||t.link_image_id||t.annotation_image_id;i&&o.assets[i]&&(o.events[t._id].asset=o.assets[i])}}),o.episodes[e]){var t=o.episodes[e].master_asset_id;t&&o.assets[t]&&(o.episodes[e].masterAsset=createInstance("MasterAsset",o.assets[t]));var i=o.episodes[e].poster_frame_id;i&&o.assets[i]&&(o.episodes[e].poster=o.assets[i])}},o.addLandingScreen=function(e){o.events["internal:landingscreen:"+e]=createInstance("Scene",{_id:"internal:landingscreen:"+e,_type:"Scene",_internal:!0,cur_episode_id:e,episode_id:e,start_time:-.01,end_time:.01,component_name:p.LANDINGSCREEN_TEMPLATE})},o.addEndingScreen=function(e){var t=o.episodes[e];if(t&&t.scenes&&t.masterAsset){t.scenes=t.scenes.sort(function(e,t){return e.start_time-t.start_time});var i=t.scenes[t.scenes.length-1];if(!i._id.match(/internal:endingscreen/)){var n=parseFloat(t.masterAsset.duration);i.end_time=n-.1,angular.forEach(i.items,function(e){e.end_time>n-.1&&(e.end_time=n-.1)}),o.events["internal:endingscreen:"+e]=createInstance("Scene",{_id:"internal:endingscreen:"+e,_type:"Scene",_internal:!0,cur_episode_id:e,start_time:n-.1,end_time:n,component_name:p.ENDINGSCREEN_TEMPLATE}),o.events["internal:endingscreen:"+e]=c(o.events["internal:endingscreen:"+e]),o.resolveEpisodeEvents(e)}}},o.isTranscoded=function(e){return e.mediaSrcArr.length>0},r.debugInBrowser,o}function ittNarrativeTimeline(){return{restrict:"A",replace:!0,template:Wt.a,controller:zt}}function ittPlayerContainer(){return{template:Gt.a,controller:"PlayerController"}}function PlayerController(e,t,i,n,a,r,s,o,l,c,d,p,m,h,g,v){function setupEpisodeEditor(t){e.defaultLanguage=t.defaultLanguage}function calcNewWindowUrl(){var e=s.narrativeId||s.episodeId,t=s.timelineId;return l.mainVideoNewWindowUrl(s.user.access_token,e,t,h.getMetaProp("time"))}function iframeIOSOverlayHandler(){window.open(calcNewWindowUrl())}e.episodeTheme=g,e.viewMode=function(t){s.viewMode=t,d.captureEpisodeActivity("modeChange",{mode:t}),s.producerEditLayer=0,"review"===t?(a(function(){i.$emit(u)}),s.autoscroll=!0,s.autoscrollBlocked=!1,w(),a(k)):s.autoscroll=!1,"watch"===t&&e.endSearch(),a(function(){$(window).trigger("resize")})},n.viewMode&&a(function(){e.viewMode(n.viewMode)}),e.episodeEdit=v,e.toggleProducerPreview=function(){s.product="producer"===s.product?"player":"producer"},n.epId?(s.init(),s.episodeId=n.epId):e.narrativeId=n.narrativeId,s.isFramed&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)<151&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:"650px"}),"*");var f=function(){if(s.isFramed&&-1!==l.episodes[s.episodeId].template.displayName.indexOf("Wiley")){var t=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(e){t=!1}if(t&&localStorage.removeItem("iCanHazStorage"),t&&!localStorage.getItem("noWileyNag")){s.show.wileyNag=!0;var i=e.$watch(function(){return h.getMetaProp("time")},function(e){e&&(s.show.wileyNag=!1,i())})}e.noWileyNag=function(){s.show.wileyNag=!1,localStorage.setItem("noWileyNag","1")}}},y=i.$on("dataSvc.getEpisode.done",function(){s.lang=n.lang?n.lang.toLowerCase():l.episodes[s.episodeId].defaultLanguage,l.setLanguageStrings(),f(),document.title=l.episodes[s.episodeId].display_title;var t=l.episodes[s.episodeId].container_id;o.getContainer(t,s.episodeId).then(function(){if(l.episodes[s.episodeId].master_asset_id)var n=e.$watch(function(){return l.assets[l.episodes[s.episodeId].master_asset_id]},function(t){t&&Object.keys(t).length>1&&(n(),l.addEndingScreen(s.episodeId),c.init(s.episodeId),e.loading=!1,i.$emit(u))});else{if(e.loading=!1,"producer"===s.product){s.editEpisode=l.episodes[s.episodeId];var a=l.containers[t].customer_id;s.editEpisode.templateOpts=m.getTemplates("episode",[a])}s.videoControlsActive=!0,s.videoControlsLocked=!0}setupEpisodeEditor(l.episodes[s.episodeId]),"producer"!==s.productLoadedAs||p.userHasRole("admin")||p.userHasRole("customer admin")||(s.product="player",s.productLoadedAs="player")})});if(l.episodes[s.episodeId]){if(s.lang=n.lang?n.lang.toLowerCase():l.episodes[s.episodeId].defaultLanguage,document.title=l.episodes[s.episodeId].display_title,l.episodes[s.episodeId].master_asset_id){c.init(s.episodeId);setupEpisodeEditor(l.episodes[s.episodeId])}else"producer"===s.product&&(s.editEpisode=l.episodes[s.episodeId]),s.videoControlsActive=!0,s.videoControlsLocked=!0;"producer"!==s.productLoadedAs||p.userHasRole("admin")||p.userHasRole("customer admin")||(s.product="player",s.productLoadedAs="player")}else e.loading=!0,l.addLandingScreen(s.episodeId),o.getEpisode(s.episodeId,s.episodeSegmentId);e.appState=s,e.playbackService=h,e.show=s.show,e.now=new Date,e.showIframeIOSOverlay=s.isIframedIOS(),e.iframeIOSOverlayHandler=iframeIOSOverlayHandler,e.calcNewWindowUrl=calcNewWindowUrl,s.videoControlsActive=!1;var _,S=e.$watch(function(){return s.videoControlsActive},function(e){e&&(a.cancel(_),_=a(function(){s.videoControlsActive=!1},5e3))});e.showControls=function(){a.cancel(_),s.videoControlsActive=!0,s.isTouchDevice&&e.allowControlsExit()},e.allowControlsExit=function(){a.cancel(_),_=a(function(){s.videoControlsLocked||(s.videoControlsActive=!1)},5e3)},e.toggleSearchPanel=function(){s.show.searchPanel=!s.show.searchPanel,s.windowWidth<480?e.viewMode("review"):e.viewMode(s.show.searchPanel?"review":"discover"),s.searchText="",s.show.searchPanel&&a(function(){document.getElementById("searchtext").focus()})},e.endSearch=function(){s.searchText="",s.show.searchPanel=!1},e.toggleNavPanel=function(){c.pause(),s.show.navPanel=!s.show.navPanel},e.seek=function(e){c.seek(e,"sceneMenu"),s.show.navPanel=!1},e.pause=function(){c.pause()};var b=i.$on("video.firstPlay",function(){c.play()});e.hidePanel=function(e){s.show[e]=!1},e.hidePanels=function(){s.show.navPanel=!1,s.show.profilePanel=!1,s.itemDetail=!1,i.$emit("player.dismissAllPanels")},e.play=function(){c.play()},e.continue=function(){l.episodes[s.episodeId].masterAsset.duration-h.getMetaProp("time")<.2?(c.pause(),c.seek(l.episodes[s.episodeId].masterAsset.duration-.01)):c.play()},e.userHasRole=p.userHasRole,e.logout=p.logout,e.isTrueGuest=p.isTrueGuest,s.isTouchDevice&&"review"===s.viewMode&&(s.autoscroll=!0);var T=$(window),E=$("html,body"),C=!1,w=function(){C||(C=r(k,400),T.bind("scroll",function(){E.stop(),I(),s.autoscrollBlocked=!0}))},I=function(){T.unbind("scroll"),r.cancel(C),C=!1};e.enableAutoscroll=function(){s.autoscrollBlocked&&(s.autoscrollBlocked=!1,w())};var k=function(){if(!s.autoscrollBlocked&&s.autoscroll){var e=1/0,t=T.scrollTop();if(angular.forEach($(".isCurrent:visible"),function(i){var n=i.getBoundingClientRect().top+t;n<e&&(e=n)}),e!==1/0){e>t+180&&e-t<document.documentElement.clientHeight-180||e<180&&t<180||(I(),E.animate({scrollTop:e-180},1500),a(function(){w()},1750))}}};w();var P=i.$on("userKeypress.ESC",e.hidePanels);e.$on("$destroy",function(){S(),y(),b(),P()})}function ittSearchPanel(e){return{restrict:"A",replace:!0,scope:!0,template:Xt.a,controller:"SearchPanelController",link:function(t){t.appState=e,t.indexEvents()}}}function SearchPanelController(e,t,i,n){e.sortBy="startTime",e.toggleSortBy=function(t){e.sortBy=a(t),n.autoscroll="startTime"===e.sortBy},e.getToggledValue=function(e){return a(e)};var a=function(e){return"startTime"===e?"type":"startTime"};e.getFriendlySortText=function(e){return"startTime"===e?"time":"type"},e.indexed=!1,e.indexEvents=function(){if(!e.episode.items)return i(function(){e.indexEvents()},300),!1;e.indexed=!0,e.typeCategories=["transcript","annotation","file","image","link","video","question","other"],e.showTypes={transcript:{name:"Transcript",items:[]},annotation:{name:"Annotations",items:[]},file:{name:"Files",items:[]},image:{name:"Images",items:[]},link:{name:"Links",items:[]},video:{name:"Videos",items:[]},question:{name:"Questions",items:[]},other:{name:"Other",items:[]}},angular.forEach(e.episode.items,function(t){"producer"!==n.product&&t.cosmetic||"Scene"!==t._type&&(t.producerItemType&&e.showTypes[t.producerItemType]?e.showTypes[t.producerItemType].items.push(t):e.showTypes.other.items.push(t),"annotation"===t.producerItemType&&(t.showAsHeader=!t.component_name.match(/(transmedia|definition)/)))})},t.$on("searchReindexNeeded",e.indexEvents)}function ittTab(){return{template:'<div ng-show="selected"><ng-transclude></ng-transclude></div>',require:"^^ittTabs",transclude:!0,scope:{title:"@"},link:function(e,t,i,n){n.addPane(e)}}}function ittTabs(){return{template:['<div class="">','\t<ul class="nav nav-tabs">','\t\t<li ng-repeat="pane in panes" class="tab-pane"><p class="ittTabLabel" ng-class="{cur:pane.selected}" ng-click="select(pane)">{{pane.title}}</p></li>',"\t</ul>",'\t<div class="tab-content"><ng-transclude></ng-transclude></div>',"</div>"].join(""),transclude:!0,restrict:"EA",scope:{},controller:["$scope",function(e){function select(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0}var t=e.panes=[];e.select=select,this.addPane=function(e){0===t.length&&select(e),t.push(e)}}]}}function ittVolumeSlider(e){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(t){function adjustHigh(e){return e>98?100:e}function adjustLow(e){return e<3?0:e}function incrementVolume(e){var i=t.currentVolume()+e;i=adjustHigh(i),"function"==typeof t.setVolume&&t.setVolume(i)}function decrementVolume(e){var i=t.currentVolume()-e;i=adjustLow(i),"function"==typeof t.setVolume&&t.setVolume(i)}t.userChangingVolume=function(e){var i=angular.element(e.currentTarget),n=function(e,n){var a=(e.clientX-i.offset().left)/i.width()*100;a>98&&(a=100),a<3&&(a=0),n?t.setVolume(a):t.$apply(t.setVolume(a))};n(e,!0),i.bind("mousemove.volume",n),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),i.unbind("mousemove.volume")})};var i={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};t.onVolumeKeyDown=function(e){var t=e,n=!0;switch(t.keyCode){case i.LEFTARROW:decrementVolume(1),n=!1;break;case i.RIGHTARROW:case i.UPARROW:incrementVolume(1),n=!1;break;case i.DOWNARROW:decrementVolume(1),n=!1;break;case i.PAGEUP:incrementVolume(10),n=!1;break;case i.PAGEDOWN:decrementVolume(10),n=!1;break;case i.HOME:decrementVolume(100),n=!1;break;case i.END:incrementVolume(100),n=!1;break;default:n=!0}n||(e.stopPropagation(),e.preventDefault())},t.currentVolume=function(){return e.getMetaProp("muted")?0:e.getMetaProp("volume")}}}}function ittShowHideVisualOnly(e){return{restrict:"A",multiElement:!0,link:function(t,i,n){t.$watch(n.ittShowHideVisualOnly,function(t){t?e.removeClass(i,"visual-hide"):e.addClass(i,"visual-hide")})}}}function visualHideAnimation(){return{addClass:function(e){e.fadeTo("slow",0,function(){})},removeClass:function(e){e.fadeTo("slow",1,function(){})}}}function ittWidthWatch(){return{restrict:"A",replace:!1,link:function(e,t){var i=e.$watch(function(){return t.width()},function(t){e.isNarrow=t<450});e.$on("$destroy",i)}}}function ittEpisode(){return{restrict:"EA",replace:!1,template:ni,controller:ai}}function ittItem(e,t,i,n,a,s,o,l,c,d,u,m,h){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(e,t){return'<div ng-if="item.renderTemplate" np-dynamic-event-template component-name="'+(t.forcetemplate?t.forcetemplate:"{{item.component_name}}")+'"></div>'},controller:"ItemController",link:function(c,g){function handleOutgoingLinkDisplay(){if(null!=c.item.url&&null!=c.item.url_status&&null!=c.item.target){var e=c.item,t=e.url,i=e.target,n=e.url_status,a=m.mixedContentUrl(t);return!m.urlIsEmbeddable(t,n)||"_blank"===i||a}}c.appState=a,c.userHasRole=n.userHasRole,c.item.avatar_id&&(c.item.avatar=l.assets[c.item.avatar_id]),"internal:editing"===c.item._id?g.addClass("noTransitions"):(n.userHasRole("admin")||n.userHasRole("customer admin")||c.item.user_id===a.user._id)&&(c.item.editableByThisUser=!0),c.handleOutgoingLinkDisplay=handleOutgoingLinkDisplay,c.toggleDetailView=function(){c.item.showInlineDetail?c.item.showInlineDetail=!1:(o.pause(),c.captureInteraction(),g.width()>450?c.item.showInlineDetail=!0:a.itemDetail={item:c.item,animate:!0})};var v={ENTER:13,SPACE:32};if(c.toggleDetailOnKeyPress=function(e){var t=e,i=!0;switch(t.keyCode){case v.ENTER:case v.SPACE:c.toggleDetailView(),i=!1;break;default:i=!0}i||(e.stopPropagation(),e.preventDefault())},c.forceModal=function(e){void 0===e&&(e=!0),o.pause(),a.itemDetail={item:c.item,animate:e}},c.outgoingLinkOnKeyPress=function(e,t){var i=t,n=!0;switch(i.keyCode){case v.ENTER:case v.SPACE:c.outgoingLink(e),n=!1;break;default:n=!0}n||(t.stopPropagation(),t.preventDefault())},c.outgoingLink=function(e){if(o.pause(),c.captureInteraction(),u.isVideoUrl(e)){d.pause(c.item._id);var i=Math.floor(d.getCurrentTime(c.item._id))||0;e=u.getOutgoingUrl(e,i)}c.item.targetTop?t(function(){window.location.href=e}):window.open(e)},c.editItem=function(){h.editEvent(c.item)},c.captureInteraction=function(){s.captureEventActivity("clicked",c.item._id)},c.item.component_name===p.LINK_EMBED_TEMPLATE)var f=c.$watch(function(){return d.getMetaProp("time")>c.item.start_time},function(e){e&&(c.captureInteraction(),f())});if(c.item.asset_id&&!c.item.asset&&(c.item.asset=l.assets[c.item.asset_id]),c.item.data&&(c.plugin=c.item.data._plugin,c.plugin._type=c.item.data._pluginType,"credlyBadge"===c.plugin._type)){s.captureEventActivity("viewed",c.item._id),a.user.roles&&1===a.user.roles.length&&"guest"===a.user.roles[0]?c.plugin.eligibleForBadges=!1:(c.plugin.eligibleForBadges=!0,a.user.emails?c.plugin.userEmail=a.user.emails[0]:c.plugin.userEmail="",c.plugin.totalAchieved=0),c.checkBadgeEligibility=function(){c.plugin.eligibleForBadges&&angular.forEach(c.plugin.requirements,function(e){e.achieved||s.readEventActivity(e.eventId,e.activity).then(function(t){e.achieved=t,c.countAchievements()}),c.countAchievements()})},c.countAchievements=function(){var e=0;angular.forEach(c.plugin.requirements,function(t){t.achieved&&(e+=1)}),c.plugin.totalAchieved=e,c.plugin.totalAchieved===c.plugin.requirements.length&&(l.episodes[a.episodeId].styleCss=l.episodes[a.episodeId].styleCss+" uscHackUserHasBadge")},c.checkBadgeEligibility();var y=0;c.badgePoll=i(function(){y++,(c.item.isCurrent||"review"===a.viewMode)&&c.checkBadgeEligibility(),y>60&&i.cancel(c.badgePoll)},1e4),c.$on("$destroy",function(){i.cancel(c.badgePoll)}),c.badger=function(){c.plugin.gettingBadge=!0,e({method:"GET",url:r.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+c.plugin.credlyBadgeId+"&email="+c.plugin.userEmail}).success(function(e){c.checkBadgeEligibility(),"Badge previously sent."===e.status&&(c.plugin.alreadyHadBadge=!0),c.plugin.gotBadge=!0}).error(function(){c.plugin.gettingBadge=!1,c.plugin.error=!0})}}}}}function ItemController(e,t){e.seek=function(i){t.seek(i,"clickedOnItem",e.item._id)};var i={ENTER:13,SPACE:32};e.seekOnKeyPress=function(t,n){var a=n,r=!0;switch(a.keyCode){case i.ENTER:case i.SPACE:e.seek(t),r=!1;break;default:r=!0}r||(n.stopPropagation(),n.preventDefault())}}function ittItemDetailModal(e){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},template:an.a,link:function(t){t.item=t.item.item,t.item.animate||(t.modalStyle={transition:"none"});var i={bottom:"0","padding-top":"5%"},n={"overflow-y":"auto",top:"40%",height:"85%","z-index":"11"};t.item.isVideoUrl?t.modalStyle=angular.extend(t.modalStyle,{"padding-top":"5%"}):"image"===t.item.producerItemType?t.modalStyle=angular.extend(t.modalStyle,n):t.modalStyle=angular.extend(t.modalStyle,i),t.dismiss=function(){e.itemDetail=!1}}}}function ittIframe(e){return{restrict:"E",scope:{src:"@",contenttype:"@",item:"&"},replace:!0,template:sn.a,controller:["$scope","ittUtils","appState",function(e,t,i){function validateFrameUrl(e){return t.isValidURL(e)?(n.isLoading=!1,!0):(n.isLoading=!0,!1)}var n=this,a="allow-forms allow-same-origin allow-scripts";n.isLoading=!0,n.isTouchDevice=i.isTouchDevice,n.isTouchDevice&&/inthetelling.com\/#/.test(n.src)&&(n.iOSScroll="no"),n.watcher=e.$watchGroup([function(){return n.src},function(){return n.contenttype}],function(){n.src&&validateFrameUrl(n.src)&&(n.contenttype?n.sandbox="text/html"===n.contenttype?a:void 0:(n.sandbox=a,n.src.match(/.pdf$/)&&delete n.sandbox,n.src.match(/inthetelling.com\/#/)&&(n.sandbox+=" allow-top-navigation allow-popups"),n.src.match(/inthetelling.com\/#/)&&-1===n.src.indexOf("?")&&(n.src+="?embed=1"),n.src.match(/amazonaws.com\/itt/i)&&delete n.sandbox))}),e.$on("$destroy",function(){n.watcher()})}],controllerAs:"$ctrl",bindToController:!0,link:function(t,i){var n=95,a=angular.noop,r=$(".w-modal"),s=$(".modal"),o=$(window).height()-220;s.length>0&&e.isTouchDevice&&(t.$ctrl.styles={height:o+"px"},i.css("height",o),t.$watch(function(){return i.height()},function(e,n){e!==n&&(t.$ctrl.styles={height:e+"px"},i.css("height",o))})),r.length>0?function(){var e=r.height()-n;i.css("height",e),r.css("overflow-y","hidden"),a=t.$watch(function(){return r.height()},function(e,t){if(e!==t){var a=e-n;i.css("height",a)}})}():function(){"discover"===e.viewMode&&e.resizeIframeReviewMode&&!e.isTouchDevice&&i.css("height",o)}(),t.$on("$destroy",function(){a()})}}}function ittValidEpisodeUrl(e,t,i){return{require:"?ngModel",scope:{onValidationNotice:"&"},link:function(n,a,r,s){function watchFields(){return c}function handleUpdates(e){n.onValidationNotice({$notice:e})}function episodeUrl(t){if(c={},s.$isEmpty(t))return c.error={showInfo:!0,message:"Field cannot be blank."},!1;if(e.isVideoUrl(t)){var n=e.checkUrl(t).type;return"html5"===n||"wistia"===n&&!i.userHasRole("admin")?(c[n]={showInfo:!0,message:o(n)+" video currently not supported"},!1):(c[n]={showInfo:!0,message:o(n)+" detected",doInfo:!0},!0)}return c.error={showInfo:!0,message:t+" is not a valid episode URL"},!1}var o=t.capitalize,l={showInfo:!1,message:"",doInfo:!1},c={kaltura:l,youtube:l,html5:l,error:l};s.$validators={episodeUrl:episodeUrl},n.$watch(watchFields,handleUpdates,!0)}}}function ittValidPathslug(e,t){return{require:["^ngModel","^npGuestAccessibleUrl"],restrict:"EA",link:function(i,n,a,r){function validPathslug(e){if(c[c.type].error=null,l.$isEmpty(e))return c[c.type].error="Slug cannot be empty",!0;var t=s(e);return-1!==_gatherPathSlugs(p,u).indexOf(t)&&(c[c.type].error=t+" is already taken."),!0}function _gatherPathSlugs(e,t){return e.reduce(function(e,i){if(i.path_slug&&i.path_slug.en)if(o(t)){if(t!==i._id)return e.push(i.path_slug.en),e}else e.push(i.path_slug.en);return e},[])}var s=t.slugify,o=t.existy,l=r[0],c=r[1],d=e.customers[c.narrative.customer_id]||c.customer,p="narrative"===c.type?e.cachedNarrativesByCustomer(d):c.narrative.timelines,u=c[c.type]._id;l&&(l.$validators={validPathslug:validPathslug})}}}function ittScene(e,t){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-if="scene.renderTemplate" np-dynamic-event-template component-name="{{scene.component_name}}"></span>',controller:"SceneController",link:function(i,n){function twiddleScene(){e(function(){n.find(".matchVideoHeight:visible").each(function(){$(this).css("height",n.find(".videoMagnet img").height())});var e=angular.element(window).height()-$("#CONTAINER").scrollTop();n.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",e-$(this).offset().top)}),n.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",e-$(this).offset().top-210)})},100)}"review"!==t.viewMode&&window.scrollTo(0,0),i.precalculateSceneValues(),i.appState=t,i.headerOneComponentTemplate=p.HEADER_ONE_TEMPLATE,window.addEventListener("resize",function(){return twiddleScene()}),twiddleScene(),i.unwatchEdits=i.$watch(function(){return t.editEvent},i.precalculateSceneValues,!0),i.$on("$destroy",function(){i.unwatchEdits()})}}}function SceneController(e,t,i){function precalculateSceneValues(){delete e.mainContentHasLeftSidebar,delete e.mainContentHasRightSidebar,delete e.mainContentHasBothSidebars,delete e.altContentHasLeftSidebar,delete e.altContentHasRightSidebar,delete e.altContentHasBothSidebars,e.showCurrent=$.inArray("showCurrent",e.scene.layouts)>-1,e.contentItems=t("isContent")(e.scene.items),e.mainFgItems=t("itemLayout")(e.scene.items,"mainFg"),e.mainBgItems=t("itemLayout")(e.scene.items,"mainBg"),e.altFgItems=t("itemLayout")(e.scene.items,"altFg"),e.altBgItems=t("itemLayout")(e.scene.items,"altBg"),$.inArray("splitRequired",e.scene.layouts)>-1?e.mainContentItems=t("transcriptandoptional")(e.contentItems):$.inArray("splitOptional",e.scene.layouts)>-1?e.mainContentItems=t("transcriptandrequired")(e.contentItems):e.mainContentItems=t("annotation")(e.contentItems),$.inArray("splitRequired",e.scene.layouts)>-1?e.altContentItems=t("required")(e.contentItems):$.inArray("splitOptional",e.scene.layouts)>-1?e.altContentItems=t("optional")(e.contentItems):e.altContentItems=t("transmedia")(e.contentItems);for(var i=0;i<e.mainContentItems.length;i++)($.inArray("burstL",e.mainContentItems[i].layouts)>-1||$.inArray("sidebarL",e.mainContentItems[i].layouts)>-1||$.inArray("burst",e.mainContentItems[i].layouts)>-1)&&(e.mainContentHasLeftSidebar=!0),($.inArray("burstR",e.mainContentItems[i].layouts)>-1||$.inArray("sidebarR",e.mainContentItems[i].layouts)>-1||$.inArray("burst",e.mainContentItems[i].layouts)>-1)&&(e.mainContentHasRightSidebar=!0),e.mainContentHasLeftSidebar&&e.mainContentHasRightSidebar&&(e.mainContentHasBothSidebars=!0,i=e.mainContentItems.length);for(i=0;i<e.altContentItems.length;i++)($.inArray("burstL",e.altContentItems[i].layouts)>-1||$.inArray("sidebarL",e.altContentItems[i].layouts)>-1||$.inArray("burst",e.altContentItems[i].layouts)>-1)&&(e.altContentHasLeftSidebar=!0),($.inArray("burstR",e.altContentItems[i].layouts)>-1||$.inArray("sidebarR",e.altContentItems[i].layouts)>-1||$.inArray("burst",e.altContentItems[i].layouts)>-1)&&(e.altContentHasRightSidebar=!0),e.altContentHasLeftSidebar&&e.altContentHasRightSidebar&&(e.altContentHasBothSidebars=!0,i=e.altContentItems.length)}function centeredProTransmedia(e){var t=e.component_name===p.PULLQUOTE_TEMPLATE,i=e.component_name===p.HEADER_TWO_TEMPLATE,n=e.component_name===p.TEXT_TRANSMEDIA_TEMPLATE,a=e.component_name===p.TEXT_DEFINITION_TEMPLATE;return!!(t||i||n||a)&&e}function byPullquoteOrH2(e){var t=e.component_name===p.PULLQUOTE_TEMPLATE,i=e.component_name===p.HEADER_TWO_TEMPLATE;return!(!t&&!i)&&e}function setBgImgUrl(e,n){var a,r,s,o=t("isCurrent")(e),l=t(n)(o),c=1;if(l.length>0&&i.existy(l[0].asset)){switch(s="url("+l[0].asset.cssBgUrl+")",/Bg/.test(l[0].layoutCss)&&(c=.25),l[0].styles[0]){case"cover":return a="cover",{"background-image":s,"background-size":a,opacity:c};case"contain":return a="contain",r="center",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"fill":return a="100% 100%",r="50% 50%",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"tl":return a="auto",r="top left",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"tr":return a="auto",r="top right",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"bl":return a="auto",r="bottom left",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"br":return a="auto",r="bottom right",{"background-image":s,"background-size":a,opacity:c,"background-position":r}}return""}}e.byPullquoteOrH2=byPullquoteOrH2,e.centeredProTransmedia=centeredProTransmedia,e.setBgImgUrl=setBgImgUrl,e.precalculateSceneValues=precalculateSceneValues}function timelineSvc_timelineSvc(e,t,i,n,a,s,o,l,c){function _onPlayerStateChange(t){if("ended"!==l.getTimelineState()||"unstarted"!==t&&"video cued"!==t)switch(l.setTimelineState(t),t){case"reset":_resetClocks(),l.resetPlaybackService();break;case"unstarted":break;case"ended":l.setMetaProp("time",l.getMetaProp("duration"));var i=a.episodes[s.episodeId],n=i.scenes[i.scenes.length-1];i.setCurrentScene(n);break;case"playing":var r=l.getCurrentTime(),c=l.getMetaProp("time"),p=l.getMetaProp("resetInProgress");Math.abs(c-r)>.75&&!1===p&&(l.setMetaProp("time",r),S(!0)),T(),y(),s.videoControlsActive=!0,s.show.navPanel=!1,e.parent!==e&&e.parent.postMessage("pauseEpisodePlayback","*"),o.captureEpisodeActivity("play");break;case"paused":case"buffering":_resetClocks();break;case"video cued":var u=l.getMetaProp("startAtTime"),m=l.getMetaProp("hasResumedFromStartAt");u>0&&!1===m&&d.startAtSpecificTime(u);break;case"player ready":d.updateEventStates()}}function _resetClocks(){i.cancel(p),s.videoControlsActive=!0,_(),p=void 0,f=void 0}function _doEndingSequence(){_resetClocks(),l.handleTimelineEnd(),o.captureEpisodeActivity("pause")}function restartEpisode(){d.seek(.01),d.play()}function nextScene(){for(var e=!1,t=l.getMetaProp("time"),i=l.getMetaProp("duration"),n=d.markedEvents.length,a=0;a<n;a++)if(d.markedEvents[a].start_time>t){handleScene(a,"nextScene"),e=!0;break}e||(d.pause(),d.seek(i-.01,"nextScene"))}function handleScene(e,t){var i=d.markedEvents[e],n=i.start_time;.01===n&&"prevScene"!==t&&(n+=.1),d.seek(n,t),!0===i.stop&&d.pause()}function prevScene(){var e=l.getMetaProp("time");"playing"===l.getTimelineState()&&(e-=3);for(var t=d.markedEvents.length-1,i=t;i>=0;i--)if(d.markedEvents[i].start_time<e){d.seek(d.markedEvents[i].start_time,"prevScene"),i===t&&--i,handleScene(i,"prevScene");break}}function groupByStartTime(e){return e.reduce(function(e,t){return e.hasOwnProperty(t.start_time)?e[t.start_time].push(t):e[t.start_time]=[t],e},{})}function prepGroupedEvents(e){var t=[];return angular.forEach(e,function(e,i){var n={events:e,stop:!1,multiStop:!1,start_time:i,toolTipText:null,layoutChange:!1},a=!1,r=[],s=!1,o=!1;angular.forEach(e,function(e){/internal:endingscreen|internal:landingscreen/.test(e._id)&&(o=!0),e.stop&&(a=!0),"Scene"===e.type&&(s=!0),"Chapter"!==e.type&&!0!==e.chapter_marker||r.push(e)}),0===r.length&&!s&&a&&(n.toolTipText="Stop item"),a&&(n.stop=!0),n.events.length>1&&a&&(n.multiStop=!0),s&&0===r.length&&(n.layoutChange=!0,n.toolTipText="(Layout Change)"),r.length>0&&(angular.forEach(r,function(e,t){0===t?n.toolTipText=e.display_annotation||e.display_title:n.toolTipText+=" / "+(e.display_annotation||e.display_title)}),s&&(n.toolTipText+=" (Layout Change)"),n.multiStop&&(n.toolTipText+=" / (Stop item)")),o||t.push(n)}),t}var d=Object.create(null);d.timelineEvents=[],d.markedEvents=[],d.enforceSingletonPauseListener||e.addEventListener("message",function(e){"pauseEpisodePlayback"===e.data&&d.pause()},!1),d.enforceSingletonPauseListener=!0;var p,u,m,h=c.parseTime;d.setSpeed=function(e){m=e,l.setMetaProp("timeMultiplier",m),l.setSpeed(m),S()},d.restartEpisode=restartEpisode,d.play=function(){var e=l.getMetaProp("duration");!e||e<.1||l.play()},d.pause=function(e){_resetClocks(),l.pause(),e||o.captureEpisodeActivity("pause")},d.startAtSpecificTime=function(e){s.isTouchDevice&&!1===l.getMetaProp("hasBeenPlayed")&&"youtube"===l.getMetaProp("videoType")||(e=h(e),e<0&&(e=0),e>l.getMetaProp("duration")&&l.setMetaProp("duration",e),l.setMetaProp("time",e),l.setMetaProp("hasResumedFromStartAt",!0),d.updateEventStates(),o.captureEpisodeActivity("seek",{method:"URLParameter"}))},d.seek=function(e,i,n){if(!0===l.getMetaProp("ready")){l.pauseOtherPlayers();var a=l.getMetaProp("duration");if("ended"===l.getTimelineState()&&l.setTimelineState("paused"),0===a)return void t(function(){d.seek(e)},300);var r={method:"",seekStart:l.getMetaProp("time")};e=h(e),e<0&&(e=0),e>a&&l.setMetaProp("duration",e),_(),l.setMetaProp("time",e),l.seek(e),d.updateEventStates(),c.existy(i)&&(r.method=i,c.existy(n)&&(r.event_id=n),o.captureEpisodeActivity("seek",r))}},d.nextScene=nextScene,d.handleScene=handleScene,d.prevScene=prevScene,d.toggleMute=function(){l.toggleMute()},d.setVolume=function(e){l.setVolume(e)};var g,v=function(){g={lastTimelineTime:0,lastVideoTime:0,running:!1}};v();var f,y=function(){g.running||(g.running=!0,g.lastTimelineTime=l.getMetaProp("time"),g.lastVideoTime=l.getMetaProp("time"),S())},_=function(){t.cancel(u),v()},S=function(e){t.cancel(u);for(var i=l.getCurrentTime(),n=l.getMetaProp("time"),a=0;a<d.timelineEvents.length;a++){var r=d.timelineEvents[a];if(r.t>=g.lastTimelineTime){if(r.t>n)break;if("pause"!==r.action||!e&&r.t!==g.lastTimelineTime){if(b(r),"pause"===r.action){a++;break}}else;}}var s=d.timelineEvents[a],o=d.timelineEvents[d.timelineEvents.length-1];if(!c.existy(s)&&c.existy(o)&&/internal:endingscreen/.test(o.id)&&_doEndingSequence(),g.lastVideoTime=i,g.lastTimelineTime=n,s&&"playing"===l.getTimelineState()){var p=1e3*(d.timelineEvents[a].t-n)/m;u=t(S,p+10)}},b=function(e){"timeline"===e.id?"pause"===e.action?(l.setMetaProp("time",e.t),d.pause()):d.play():"enter"===e.action?(a.events[e.id].state="isCurrent",a.events[e.id].isCurrent=!0):"exit"===e.action?(a.events[e.id].state="isPast",a.events[e.id].isCurrent=!1):"preload"===e.action&&w(a.events[e.id])},T=function(){f=void 0,i.cancel(p),p=i(E,20)},E=function(){var e=new Date,t=Number.isNaN(e-f)?0:e-f;g.running||y();var i=parseFloat(l.getMetaProp("time"))+t/1e3*m;i<0&&(i=0,d.pause());var n=l.getMetaProp("duration");i>n&&(i=n),l.setMetaProp("time",i),f=e};d.init=function(e){d.timelineEvents=[],d.markedEvents=[],d.displayMarkedEvents=[],m=1;var t=a.episode(e);l.seedPlayer(t.masterAsset.mediaSrcArr,t.masterAsset._id,!0),l.setTimelineState("unstarted"),l.setMetaProp("duration",0),d.injectEvents(a.episodeEvents(e),0),l.registerStateChangeListener(_onPlayerStateChange),i.cancel(p),_()},d.injectEvents=function(e,t){if(0!==e.length){t||(t=0),angular.forEach(e,function(e){if(e.start_time=Number(e.start_time),e.end_time=Number(e.end_time),"Scene"===e._type&&("producer"===s.product&&C(e),/internal:(landing|ending)screen/.test(e._id)&&C(e)),"Chapter"!==e._type&&!0!==e.chapter_marker||C(e),0!==e.start_time||e._id.match("internal")||(e.start_time=.01,a.events[e._id].start_time=.01),e.stop)C(e),d.timelineEvents.push({t:e.start_time+t,id:"timeline",eventId:e._id,action:"pause"}),d.timelineEvents.push({t:e.start_time+t,id:e._id,action:"enter"}),d.timelineEvents.push({t:e.start_time+t+.01,id:e._id,action:"exit"});else if(d.timelineEvents.push({t:e.start_time+t,id:e._id,action:"enter"}),e.end_time||0===e.end_time){if(/internal:endingscreen/.test(e._id))return;d.timelineEvents.push({t:e.end_time+t,id:e._id,action:"exit"})}(e.asset_id||e.annotation_image_id||e.link_image_id)&&d.timelineEvents.push({t:e.start_time<3?0:e.start_time-3,id:e._id,action:"preload"})}),d.sortTimeline();var i=groupByStartTime(d.markedEvents);d.displayMarkedEvents=prepGroupedEvents(i)}};var C=function(e){for(var t=!1,i=0;i<d.markedEvents.length;i++)d.markedEvents[i]._id===e._id&&(d.markedEvents[i]=angular.copy(e),t=!0);t||d.markedEvents.push(e)};d.removeEvent=function(e){d.timelineEvents=n("filter")(d.timelineEvents,function(t){return t.id!==e&&t.eventId!==e}),d.markedEvents=d.markedEvents.filter(function(t){return t._id!==e});var t=groupByStartTime(d.markedEvents);d.displayMarkedEvents=prepGroupedEvents(t),d.updateEventStates()},d.updateEventTimes=function(e){d.timelineEvents=n("filter")(d.timelineEvents,function(t){return t.id!==e._id&&t.eventId!==e._id}),d.injectEvents([e],0)},d.updateSceneTimes=function(e){angular.forEach(a.episodes[e].scenes,function(e){d.updateEventTimes(e)})},d.sortTimeline=function(){d.timelineEvents=d.timelineEvents.sort(function(e,t){if(e.t===t.t){if(e.action===t.action)return 0;if("enter"===e.action){if("pause"===t.action)return-1;if("exit"===t.action)return 1}return"exit"===e.action?-1:"pause"===e.action?1:0}return e.t-t.t}),d.markedEvents=d.markedEvents.sort(function(e,t){return e.start_time-t.start_time}),d.timelineEvents.length>0&&l.setMetaProp("duration",d.timelineEvents[d.timelineEvents.length-1].t),d.updateEventStates()},d.updateEventStates=function(){var e=l.getMetaProp("time");angular.forEach(d.timelineEvents,function(e){if("timeline"!==e.id){var t=a.events[e.id];t&&t.setFuture()}}),angular.forEach(d.timelineEvents,function(t){if(t.t<=e){var i=a.events[t.id];i&&("enter"===t.action?i.setCurrent():"exit"===t.action&&i.setPast())}})};var $={},w=function(e){e.asset&&"Asset::Image"===e.asset._type&&($[e.asset.url]||($[e.asset.url]=new Image,$[e.asset.url].src=e.asset.url))};return r.debugInBrowser,d}function ittTimeline(e,t,i,n,a){return{restrict:"A",replace:!0,scope:!0,template:Bo.a,controller:"TimelineController",link:function(r,s){function adjustHigh(e){return e>98?100:e}function adjustLow(e){return e<3?0:e}function incrementVolume(e){var t=r.currentVolume()+e;t=adjustHigh(t),"function"==typeof r.setVolume&&r.setVolume(t)}function decrementVolume(e){var t=r.currentVolume()-e;t=adjustLow(t),"function"==typeof r.setVolume&&r.setVolume(t)}r.appState=t,r.timeline=i,r.handlePosition=0,r.zoomLevel=1,r.zoomOffset=0,t.isTouchDevice&&!a.getMetaProp("hasBeenPlayed")&&(r.isSuppressed=!0);var o,l,c=r.$watch(function(){return a.getMetaProp("hasBeenPlayed")},function(e){!0===e&&(r.isSuppressed=!1,c())});e(function(){o=s.find(".progressbarContainer"),l=s.find(".progressbar"),f()}),r.autoZoom=function(e){r.savedZoomLevel=r.zoomLevel;var t=e.end_time-e.start_time,i=a.getMetaProp("duration")-e.end_time;r.zoomLevel=Math.min(Math.max(Math.round(.6*i/t),1),20),u()},r.endAutoZoom=function(){r.savedZoomLevel&&(r.zoomLevel=r.savedZoomLevel,u(),delete r.savedZoomLevel)};var d=r.$watch(function(){return t.editEvent},function(e,i){e!==i&&e._id!==i._id&&"producer"===t.product&&(e?r.autoZoom(e):r.endAutoZoom())});r.appState=t,r.setNewLanguage=function(){n.setLanguageStrings()},r.showSceneMenuTooltip=function(e){e&&!t.isTouchDevice?r.sceneMenuToolTip=!0:r.sceneMenuToolTip=!1},r.prevScene=function(){i.prevScene()},r.nextScene=function(){i.nextScene()},r.userChangingVolume=function(e){a.getMetaProp("muted")&&r.toggleMute();var t=angular.element(e.currentTarget),i=function(e,i){var n=(e.clientX-t.offset().left)/t.width()*100;n>98&&(n=100),n<3&&(n=0),i?r.setVolume(n):r.$apply(r.setVolume(n))};i(e,!0),t.bind("mousemove.volume",i),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),t.unbind("mousemove.volume")})};var p={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};r.onVolumeKeyDown=function(e){var t=e,i=!0;switch(t.keyCode){case p.LEFTARROW:decrementVolume(1),i=!1;break;case p.RIGHTARROW:case p.UPARROW:incrementVolume(1),i=!1;break;case p.DOWNARROW:decrementVolume(1),i=!1;break;case p.PAGEUP:incrementVolume(10),i=!1;break;case p.PAGEDOWN:decrementVolume(10),i=!1;break;case p.HOME:decrementVolume(100),i=!1;break;case p.END:incrementVolume(100),i=!1;break;default:i=!0}i||(e.stopPropagation(),e.preventDefault())},r.currentVolume=function(){return a.getMetaProp("muted")?0:a.getMetaProp("volume")},r.audioIcon=function(){return a.getMetaProp("muted")?"muted":"vol"+Math.floor(a.getMetaProp("volume")/34)},r.showTooltip=function(e){e.showTooltip=!0},r.hideTooltip=function(e){e.showTooltip=!1},r.zoomIn=function(){r.stopWatching=!0,r.zoomLevel=r.zoomLevel+1,u()},r.zoomOut=function(){r.stopWatching=!0,r.zoomLevel<=2?r.zoomLevel=1:r.zoomLevel<=3?r.zoomLevel=1.5:r.zoomLevel=r.zoomLevel/2,u()};var u=function(){r.zoomOffset=-(r.zoomLevel-1)*(a.getMetaProp("time")/a.getMetaProp("duration")),o.stop().animate({left:100*r.zoomOffset+"%",width:100*r.zoomLevel+"%"},1e3,function(){r.stopWatching=!1})};r.$watch(function(){return{t:a.getMetaProp("time"),d:a.getMetaProp("duration")}},function(){r.stopWatching||(r.zoomOffset=-(r.zoomLevel-1)*(a.getMetaProp("time")/a.getMetaProp("duration")),o&&o.css({left:100*r.zoomOffset+"%"}))},!0);var m=function(i){a.pauseOtherPlayers(),e(function(){r.seekHandleVisible=!0},250),r.isSeeking=!0;var n=t.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(n,function(){g()}),angular.element(document).bind(n,function(){v()}),h(i)};r.$watch(function(){return a.getMetaProp("time")},function(){t.editEvent&&(r.willSeekTo=a.getMetaProp("time"))});var h=function(e){if(r.isSeeking){var t=a.getMetaProp("duration");r.willSeekTo=(e.clientX-o.offset().left)/o.width()*t,r.willSeekTo<0&&(r.willSeekTo=0),r.willSeekTo>t&&(r.willSeekTo=t)}},g=function(){r.stopWatching=!0,r.enableAutoscroll(),i.seek(r.willSeekTo,"scrubTimeline"),u()},v=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),e(function(){r.isSeeking=!1,r.seekHandleVisible=!1})},f=function(){var e=$(s.find(".playhead"));t.isTouchDevice?(e.on("touchstart.timeline",function(e){m(e.originalEvent.targetTouches[0]),e.preventDefault()}),e.on("touchmove.timeline",function(e){h(e.originalEvent.targetTouches[0]),e.preventDefault()})):(e.on("mousedown.timeline",function(e){m(e),e.preventDefault()}),e.on("mousemove.timeline",function(e){h(e),e.preventDefault()}))};r.$on("$destroy",function(){v(),d()})}}}function TimelineController(e,t,i,n,a,r,s){function setBtnClass(){var t=_getTimelineState();return!0===n.allowPlayback(t)?(e.controlText="play","button-play"):(e.controlText="pause","button-pause")}function timelineBtnClick(){n.togglePlayback(null,i.restartEpisode,a.captureEpisodeActivity.bind(a))}function _getTimelineState(){return n.getTimelineState()}e.playbackService=n,e.timelineBtnClick=timelineBtnClick,e.setBtnClass=setBtnClass,t.$on("userKeypress.SPACE",timelineBtnClick),e.changeSpeed=function(e){var t=n.getMetaProp("timeMultiplier")+e;t<.5&&(t=.5),t>1.5&&(t=1.5),i.setSpeed(t)},e.resetSpeed=function(){i.setSpeed(1)},e.markerPercent=function(e){return void 0===e?0:e/n.getMetaProp("duration")*100},e.toggleMute=function(){i.toggleMute()},e.setVolume=function(e){i.setVolume(e)},e.$on("$destroy",function(){i.pause()})}function ittVideo(){return{replace:!1,template:qo.a,scope:{poster:"=?",mainPlayer:"=",mediaSrcArr:"=",playerId:"="},controller:["$scope","$timeout","$interval","$sce","$rootScope","$routeParams","playbackService","ittUtils","timelineSvc","modelSvc","dataSvc","appState","analyticsSvc",function(e,t,i,n,a,r,s,o,l,c,d,p,u){function onInit(){if(!h(m.mediaSrcArr)||0===m.mediaSrcArr.length)return void(m.transcodedInterval=i(checkTranscoded,1e4));s.seedPlayer(m.mediaSrcArr,m.playerId,m.mainPlayer),m.playerElement=n.trustAsHtml(s.getPlayerDiv(m.playerId)),t(function(){s.createInstance(m.playerId),!0===m.mainPlayer&&(r.t&&s.setMetaProp("startAtTime",o.parseTime(r.t),m.playerId),"true"===r.autoplay&&s.setMetaProp("autoplay",!0,m.playerId))},0)}function videoClick(){s.togglePlayback(m.playerId,l.restartEpisode,u.captureEpisodeActivity.bind(u))}function setCssClass(){var e={},t={"np--embed":!1===m.mainPlayer},i={play:playerIsPaused()},n={firstplay:showUnstartedOverlay()},a={rewind:showReplayOverlay()};return angular.extend(e,t,i,n,a),e}function showMask(){return!(h(p.iOSVersion)&&p.iOSVersion.length&&"youtube"===s.getMetaProp("videoType",m.playerId)&&showUnstartedOverlay())||p.iOSVersion[0]>9}function playerIsPaused(){return"paused"===s.getPlayerState(m.playerId)&&!showReplayOverlay()}function showUnstartedOverlay(){return!1===s.getMetaProp("hasBeenPlayed",m.playerId)}function showReplayOverlay(){var e=s.getMetaProp("time",m.playerId),t=s.getMetaProp("duration",m.playerId);return!0===m.mainPlayer&&e>0&&e>=t-.3}function onDestroy(){s.handle$Destroy(m.playerId)}function checkTranscoded(){var e=c.episodes[p.episodeId];e&&e.masterAsset&&!c.isTranscoded(e.masterAsset)?d.getSingleAsset(e.master_asset_id).then(function(e){c.cache("asset",e);var t=c.assets[e._id];c.isTranscoded(t)&&(m.isTranscoded=!0,i.cancel(m.transcodedInterval),m.mediaSrcArr=t.mediaSrcArr,a.$broadcast("dataSvc.getEpisode.done"),onInit())}):i.clear(m.transcodedInterval)}var m=this;m.isTranscoded=!1,m.transcodedInterval=angular.noop,m.playbackService=s,m.videoClick=videoClick,m.playerIsPaused=playerIsPaused,m.showUnstartedOverlay=showUnstartedOverlay,m.showReplayOverlay=showReplayOverlay,m.setCssClass=setCssClass,m.showMask=showMask,m.appState=p;var h=o.existy;e.$on("$destroy",onDestroy),onInit()}],bindToController:!0,controllerAs:"$ctrl"}}function playbackService_playbackService(e,t,i,n,a,r,s,o,l){function handleTimelineEnd(e){e=_setPid(e),v(u[e])&&u[e].handleTimelineEnd(e)}function seedPlayer(e,t,i){if(!0!==i||!v(u[t])){var n=s.parseMediaSrcArr(e),a=_getPlayerManagerFromMediaSrc(n);u[t]=a,p=!1,i&&(c=t,"wistia"!==a.type&&_pollBufferedPercent()),a.seedPlayerManager(t,i,n[0].mediaSrcArr)}}function createInstance(e){u[e].create(e)}function play(e){angular.forEach(h,function(t){t.pauseOtherPlayers(_setPid(e))}),!0===getMetaProp("ready",_setPid(e))&&u[_setPid(e)].play(_setPid(e))}function pause(e){!0===getMetaProp("ready",_setPid(e))&&u[_setPid(e)].pause(_setPid(e))}function seek(e,t){!0===getMetaProp("ready",_setPid(t))&&u[_setPid(t)].seekTo(_setPid(t),parseFloat(e))}function allowPlayback(e){return"paused"===e||"unstarted"===e||"video cued"===e||"ended"===e||"player ready"===e}function togglePlayback(e,t,i){e=_setPid(e);var n=getPlayerState(e);if(getMetaProp("time",e)>=getMetaProp("duration",e)&&e===c)return t();!0===allowPlayback(n)?play(e):(pause(e),i("pause"))}function pauseOtherPlayers(e){angular.forEach(h,function(t){t.pauseOtherPlayers(_setPid(e))}),angular.forEach(u,function(t,i){i!==e&&i!==c&&t.setMetaProp(i,"playerState","2")})}function registerStateChangeListener(e){for(var t=m.length;t--;)if(e.toString()===m[t].toString())return;m.push(e)}function unregisterStateChangeListener(e){m=m.filter(function(t){return t.toString()!==e.toString()})}function getCurrentTime(e){if(v(u[_setPid(e)]))return u[_setPid(e)].getCurrentTime(_setPid(e))}function getPlayerDiv(e){return u[_setPid(e)].getPlayerDiv(_setPid(e))}function getPlayerState(e){return u[_setPid(e)].getPlayerState(_setPid(e))}function setSpeed(e,t){return u[_setPid(t)].setSpeed(_setPid(t),e)}function toggleMute(e){return u[_setPid(e)].toggleMute(_setPid(e))}function setVolume(e,t){u[_setPid(t)].setVolume(_setPid(t),e)}function getMetaProp(e,t){var i=_setPid(t);if(v(u[i]))return u[i].getMetaProp(i,e)}function setMetaProp(e,t,i){var n=_setPid(i);v(u[n])&&u[n].setMetaProp(n,e,t)}function getTimelineState(){return g}function setTimelineState(e){g=e}function freezeMetaProps(e){u[_setPid(e)].freezeMetaProps(_setPid(e))}function unFreezeMetaProps(e){u[_setPid(e)].unFreezeMetaProps(_setPid(e))}function resetPlaybackService(){p=!0,u={},angular.forEach(h,function(e){e.resetPlayerManager()}),c="",g="",e.cancel(d)}function handle$Destroy(e){e!==c?!1===p&&_handleEmbedDestroy(e):_emitStateChange("reset")}function stop(e){u[_setPid(e)].stop(_setPid(e))}function renamePid(e,t){v(u[e])&&u[e].renamePid(e,t),e===c&&(c=t),r.renameKey(e,t,u)}function _getBufferedPercent(e){return e=_setPid(e),u[e].getBufferedPercent(e)}function _handleEmbedDestroy(e){setMetaProp("startAtTime",getCurrentTime(e),e),setMetaProp("hasResumedFromStartAt",!1,e),setMetaProp("ready",!1,e),freezeMetaProps(e)}function _setPid(e){return v(e)?e:c}function _emitStateChange(e){angular.forEach(m,function(t){t(e)})}function _onPlayerReady(e){var t=l[getMetaProp("playerState",e)],i=getMetaProp("startAtTime",e),n=getMetaProp("hasResumedFromStartAt",e),a=getMetaProp("resetInProgress",e);if(setMetaProp("ready",!0,e),e===c&&!1===a&&(setMetaProp("playerState","5",e),_emitStateChange("video cued")),0===i&&!0===getMetaProp("autoplay",e)&&(play(e),setMetaProp("autoplay",!1,e)),i>0&&!1===n){if(seek(i,e),!0===a)return play(e),void setMetaProp("resetInProgress",!1,e);!0===getMetaProp("autoplay",e)&&(play(e),setMetaProp("autoplay",!1,e)),e!==c&&(setMetaProp("hasResumedFromStartAt",!0,e),"playing"===t&&play(e))}}function _stateChangeCB(e){var t=e.state,i=e.emitterId;switch(t){case"unstarted":case"ended":break;case"playing":!1===getMetaProp("hasBeenPlayed",i)&&setMetaProp("hasBeenPlayed",!0,i);break;case"paused":case"buffering":case"video cued":break;case"player ready":_onPlayerReady(i)}"player ready"!==t&&setMetaProp("playerState",o[t],i),i===c&&_emitStateChange(t)}function _pollBufferedPercent(){d=e(function(){setMetaProp("bufferedPercent",_getBufferedPercent(c),c)},200)}function _getPlayerManagerFromMediaSrc(e){for(var t=h.length,i=null;t--;)if(e.length>0&&h[t].type===e[0].type){i=h[t];break}return i}var c,d,p,u={},m=[],h=[i,t,n,a],g="",v=r.existy;return angular.forEach(h,function(e){e.registerStateChangeListener(_stateChangeCB)}),{seedPlayer:seedPlayer,createInstance:createInstance,play:play,pause:pause,seek:seek,getCurrentTime:getCurrentTime,getPlayerState:getPlayerState,toggleMute:toggleMute,setVolume:setVolume,getPlayerDiv:getPlayerDiv,setSpeed:setSpeed,registerStateChangeListener:registerStateChangeListener,unregisterStateChangeListener:unregisterStateChangeListener,getMetaProp:getMetaProp,setMetaProp:setMetaProp,getTimelineState:getTimelineState,setTimelineState:setTimelineState,freezeMetaProps:freezeMetaProps,unFreezeMetaProps:unFreezeMetaProps,pauseOtherPlayers:pauseOtherPlayers,handle$Destroy:handle$Destroy,resetPlaybackService:resetPlaybackService,stop:stop,allowPlayback:allowPlayback,togglePlayback:togglePlayback,renamePid:renamePid,handleTimelineEnd:handleTimelineEnd}}function playerManagerCommons(e){var t=e.existy;return function(i){function getStateChangeListeners(){return a}function getPlayer(e){if(t(n[e]))return n[e]}function setInstance(e,t){getPlayer(e).instance=t}function setPlayer(e,t){n[e]=t}function getMetaProp(e,i){if(t(n[e])&&t(n[e].meta))return n[e].meta[i]}function setMetaProp(e){return function(i,a,s){if(-1===e.indexOf(a))throw new Error(a+" is not a valid prop for"+r+" meta info");if(t(n[i]&&n[i].meta))try{n[i].meta[a]=s}catch(e){}}}function getMetaObj(e){if(t(n[e])&&t(n[e].meta))return n[e].meta}function createMetaObj(e,t){var i=angular.copy(t);return i.meta=angular.extend(i.meta,e),i}function getPlayerDiv(e){return getMetaProp(e,"div")}function pauseOtherPlayers(e,i){return function(a){Object.keys(n).forEach(function(n){if(n!==a){var r=i(n);t(r)&&"playing"===r&&e(n)}})}}function getInstance(e){return function(t){if(!0===e(t))return getPlayer(t).instance}}function registerStateChangeListener(e){for(var t=a.length;t--;)if(e.toString()===a[t].toString())return;a.push(e)}function unregisterStateChangeListener(e){a=a.filter(function(t){return t.toString()!==e.toString()})}function resetPlayerManager(e){return function(){angular.forEach(_getPlayers(),function(t,i){_destroyInstance(i,!0,e)}),n={}}}function renamePid(t,i){e.renameKey(t,i,n)}function handleTimelineEnd(e){return function(t){return e(t)}}function _destroyInstance(e,i,n){t(i)||(i=!1),n(e),!0===i&&setPlayer(e,{})}function _getPlayers(){return n}var n=i.players,a=[],r=i.type;return{commonMetaProps:Wo,getPlayer:getPlayer,setPlayer:setPlayer,getMetaProp:getMetaProp,setInstance:setInstance,setMetaProp:setMetaProp,createMetaObj:createMetaObj,getMetaObj:getMetaObj,getPlayerDiv:getPlayerDiv,getInstance:getInstance,registerStateChangeListener:registerStateChangeListener,unregisterStateChangeListener:unregisterStateChangeListener,getStateChangeListeners:getStateChangeListeners,pauseOtherPlayers:pauseOtherPlayers,resetPlayerManager:resetPlayerManager,renamePid:renamePid,handleTimelineEnd:handleTimelineEnd}}}function urlService_urlService(e,t,i,n){function parseInput(e){var t=checkUrl(e).type;if(t.length>0)return a[t].parseInput(e)}function parseMediaSrcArr(e){return Object.keys(a).reduce(function(t,i){var n=a[i].parseMediaSrc(e);return n.mediaSrcArr.length>0&&t.push(n),t},[])}function isVideoUrl(e){return checkUrl(e).type.length>0}function checkUrl(e){return Object.keys(a).reduce(function(t,i){return a[i].canPlay(e)&&(t.type=i,t.mimeType=a[i].getMimeType(e)),t},{type:"",mimeType:""})}function getOutgoingUrl(e,t){var i=checkUrl(e).type;if(i.length>0)return a[i].getOutgoingUrl(e,t)}function resolveVideo(t){var a={youtube:[],mp4:[],webm:[],m3u8:[],kaltura:[],wistia:[]},s=/\.(\w+)$/;if(t.alternate_urls){for(var o=0;o<t.alternate_urls.length;o++)t.alternate_urls[o].match(/youtube/)?e.embeddableYoutubeUrl(t.alternate_urls[o])&&a.youtube.push(e.embeddableYoutubeUrl(t.alternate_urls[o])):a[t.alternate_urls[o].match(s)[1]].push(t.alternate_urls[o]);t.you_tube_url&&e.embeddableYoutubeUrl(t.you_tube_url)&&a.youtube.push(e.embeddableYoutubeUrl(t.you_tube_url));var l=/(\d+)x(\d+)\.\w+$/;angular.forEach(Object.keys(a),function(e){a[e]=a[e].sort(function(e,t){return(e.match(l)||[0,0])[1]-(t.match(l)||[0,0])[1]})})}if(0===a.youtube.length&&(t.url&&e.embeddableYoutubeUrl(t.url)&&(a.youtube=[e.embeddableYoutubeUrl(t.url)]),t.you_tube_url&&e.embeddableYoutubeUrl(t.you_tube_url)&&(a.youtube=[e.embeddableYoutubeUrl(t.you_tube_url)])),t.alternate_urls||angular.forEach(["mp4","webm","m3u8"],function(e){0!==a[e].length||t.url.match(/youtube/)||a[e].push(t.url.replace("mp4",e))}),r.youtube.disabled&&delete a.youtube,/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)||delete a.m3u8,/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)){var c,d="t="+(new Date).getTime();angular.forEach(["mp4","webm"],function(e){if(a[e].length>0)for(var t=0;t<a[e].length;t++)c=a[e][t].match(/\?/)?"&":"?",a[e][t]=a[e][t]+c+d})}return i.canPlay(t.url)&&a.kaltura.push(t.url),n.canPlay(t.url)&&a.wistia.push(t.url),t.urls=a,t.mediaSrcArr=_resolveMediaSrcArray(a),t}function _resolveMediaSrcArray(e){return Object.keys(e).reduce(function(t,i){return t=t.concat(e[i])},[])}var a={youtube:e,html5:t,kaltura:i,wistia:n};return{parseMediaSrcArr:parseMediaSrcArr,checkUrl:checkUrl,getOutgoingUrl:getOutgoingUrl,parseInput:parseInput,isVideoUrl:isVideoUrl,resolveVideo:resolveVideo}}function html5PlayerManager(e,t,i,n,a){function html5Ending(e){stop(e);var t=y(e);onEnded.call(t)}function create(e){Object.isFrozen(g(e).meta)&&unFreezeMetaProps(e);var t=document.getElementById(e);_attachEventListeners(t),t.onStateChange=_onStateChange,t.controls=!0,r===e&&(r=e,t.controls=!1),t.load(),g(e).instance=t}function freezeMetaProps(e){Object.freeze(S(e))}function unFreezeMetaProps(e){var t,i,n;n=S(e),t={};for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(o=!0),g(e).meta=t}function seedPlayerManager(e,t,i){if(!(l(g(e))&&b(e,"startAtTime")>0)){t&&(s={},r=e);var n=_initPlayerDiv(e,i),a={mainPlayer:t,videoObj:n.videoObj,div:n.videoElm};v(e,_(a,u))}}function onSeeked(e){var t=getPlayerState(this.id);("playing"===t||"buffering"===t&&!0===n.isIEOrEdge)&&onPlaying.call(this);var i=e.target,a=i.currentTime,r=i.duration;Math.floor(r-a)<=.5&&onEnded.call(this)}function onEnded(){var e=y(this.id);T(this.id,"playerState",0),_emitStateChange(e)}function onCanPlay(){var e=y(this.id);!1===b(this.id,"ready")&&(_emitStateChange(e,6),T(this.id,"duration",e.duration))}function onPlaying(){var e=y(this.id);T(this.id,"playerState",1),_emitStateChange(e)}function onPause(){var e=y(this.id);if(!0===o)return void(o=!1);T(this.id,"playerState",2),_emitStateChange(e)}function onBuffering(){var e=y(this.id);T(this.id,"playerState",3),_emitStateChange(e)}function play(t){var i=y(t),n=b(t,"time"),a=b(t,"ready"),s=e(function(){var o;l(i)&&4===i.readyState&&!0===a&&(o=b(t,"time"),t===r&&n<=o&&(i.currentTime=n),i.play(),e.cancel(s))},10)}function pause(e){y(e).pause()}function stop(e){T(e,"time",b(e,"duration")),pause(e)}function getCurrentTime(e){var t=y(e);if(void 0!==t)return t.currentTime}function getPlayerState(e){var i=g(e);if(l(i))return t[i.meta.playerState]}function seek(e,t){y(e).currentTime=t}function setSpeed(e,t){y(e).playbackRate=t}function toggleMute(e){var t=y(e);t.muted=!t.muted,T(e,"muted",t.muted)}function setVolume(e,t){y(e).volume=t/100,T(e,"volume",t)}function getBufferedPercent(e){var t=y(e);if(t&&-1!==b(e,"playerState")&&t.buffered.length>0){var i=t.buffered.length,n=t.buffered.start(i-1),a=t.buffered.end(i-1);return a<0&&(a-=n,n=0),a/b(e,"duration")*100}}function _initPlayerDiv(e,t){var i=_getHtml5VideoObject(t);return{videoObj:i,videoElm:_drawPlayerDiv(e,i,0)}}function _drawPlayerDiv(e,t,i){var n=document.createElement("video");n.id=e,Object.keys(t).forEach(function(e){var a,r,s,o;a=e,"mp4"===a&&(a="mpeg4"),r=t[e][i],l(r)&&(s="m3u8"===e?"application/x-mpegURL":"video/"+e,o=document.createElement("source"),o.setAttribute("type",s),o.setAttribute("src",r),o.setAttribute("class",a),n.appendChild(o))});var a=document.createElement("p");return a.innerText="Oh no! Your browser does not support the HTML5 Video element.",n.appendChild(a),n.outerHTML}function _formatPlayerStateChangeEvent(e,i){return{emitterId:i,state:t[e]}}function _emitStateChange(e,t){var i,n=g(e.id);i=t||n.meta.playerState,e.onStateChange(_formatPlayerStateChangeEvent(i,e.id))}function _onStateChange(e){angular.forEach(P(),function(t){t(e)})}function _getHtml5VideoObject(e){var t=/(mp4|m3u8|webm)/;return e.reduce(function(e,i){return e[i.match(t)[1]].push(i),e},{mp4:[],webm:[],m3u8:[]})}function _attachEventListeners(e){var t={pause:onPause,playing:onPlaying,waiting:onBuffering,seeked:onSeeked,canplay:onCanPlay,ended:onEnded};Object.keys(t).forEach(function(i){!function(i){e.addEventListener(i,t[i])}(i)})}function _removeEventListeners(e){var t,i=y(e);l(i)&&(t=i,t.removeEventListener("pause",onPause),t.removeEventListener("playing",onPlaying),t.removeEventListener("waiting",onBuffering),t.removeEventListener("seeked",onSeeked),t.removeEventListener("canplay",onCanPlay),t.removeEventListener("ended",onEnded))}var r,s={},o=!1,l=i.existy,c=a({players:s,type:"html5"}),d=c.commonMetaProps,p={videoObj:{},videoType:"html5"},u={instance:null,meta:{}};angular.extend(u.meta,p,d);var m=Object.keys(u.meta),h=function(e){return l(g(e))&&l(g(e).instance)},g=c.getPlayer,v=c.setPlayer,f=c.getPlayerDiv,y=c.getInstance(h),_=c.createMetaObj,S=c.getMetaObj,b=c.getMetaProp,T=c.setMetaProp(m),E=c.registerStateChangeListener,C=c.unregisterStateChangeListener,$=c.pauseOtherPlayers(pause,getPlayerState),w=c.resetPlayerManager(_removeEventListeners),I=c.renamePid,k=c.handleTimelineEnd(html5Ending),P=c.getStateChangeListeners;return{type:"html5",getMetaProp:b,setMetaProp:T,getMetaObj:S,getPlayerDiv:f,pauseOtherPlayers:$,registerStateChangeListener:E,unregisterStateChangeListener:C,resetPlayerManager:w,renamePid:I,seedPlayerManager:seedPlayerManager,create:create,getPlayerState:getPlayerState,play:play,pause:pause,seekTo:seek,getCurrentTime:getCurrentTime,getBufferedPercent:getBufferedPercent,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,freezeMetaProps:freezeMetaProps,unFreezeMetaProps:unFreezeMetaProps,stop:stop,handleTimelineEnd:k}}function html5UrlService_html5UrlService(e){function getMimeType(e){return"video/"+e.match(/(mp4|m3u8|webm)/)[0]}function getOutgoingUrl(e,t){return i(t)&&t>0&&(e+="#t="+t),e}function parseMediaSrc(e){return e.reduce(function(e,t){return isHTML5VideoUrl(t)&&e.mediaSrcArr.push(t),e},{type:t,mediaSrcArr:[]})}function isHTML5VideoUrl(e){return/(.mp4|.m3u8|.webm)/.test(e)}function parseInput(e){if(isHTML5VideoUrl(e))return e}var t="html5",i=e.existy;return{type:t,getMimeType:getMimeType,parseMediaSrc:parseMediaSrc,canPlay:isHTML5VideoUrl,parseInput:parseInput,getOutgoingUrl:getOutgoingUrl}}function youTubePlayerManager(e,t,i,n,a,r,s){function seedPlayerManager(e,t,i){if(!(_existy(f(e))&&T(e,"startAtTime")>0)){t&&(l={},o=e);var n={mainPlayer:t,div:_getPlayerDiv(e),ytId:r.extractYoutubeId(i[0])};y(e,S(n,u))}}function create(e){function handleSuccess(i){f(e).instance=i,E(e,"ytId",t)}function tryAgain(){return _createInstance(e,t,onPlayerStateChange,onPlayerQualityChange,onReady,onError).then(handleSuccess).catch(handleFail)}function handleFail(e){n.error({data:"Network timeout initializing video player. Please try again."},e)}function onPlayerStateChange(e){var t=_getPidFromInstance(e.target);E(t,"playerState",e.data);var i=_formatPlayerStateChangeEvent(e,t),n=T(t,"bufferInterval");e.data===YT.PlayerState.ENDED&&e.target.stopVideo(),e.data===YT.PlayerState.BUFFERING?(n=x(function(){e.target.getPlayerState()===YT.PlayerState.BUFFERING&&_reset(t)},7e3),E(t,"bufferInterval",n)):L(n),_emitStateChange(i)}function onReady(e){var t=_getPidFromInstance(e.target),i=_formatPlayerStateChangeEvent({data:"6"},t);E(t,"duration",e.target.getDuration()),_emitStateChange(i)}function onPlayerQualityChange(e){var t=_getPidFromInstance(e.target);"medium"===e.data&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&setPlaybackQuality(t,"large")}function onError(e){var t=_getPidFromInstance(e.target);5===e.data&&_reset(t)}var t=T(e,"ytId");_createInstance(e,t,onPlayerStateChange,onPlayerQualityChange,onReady,onError).then(handleSuccess).catch(tryAgain)}function setSpeed(e,t){var i=_(e);_existy(i)&&i.getAvailablePlaybackRates().length>1&&i.setPlaybackRate(t)}function getCurrentTime(e){var t=_(e);if(_existy(t))return _tryCommand(t,"getCurrentTime")}function playerState(e){var t=_(e);if(_existy(t))return a[_tryCommand(t,"getPlayerState")]}function play(e){var t=_(e);_existy(t)&&_tryCommand(t,"playVideo")}function pause(e){var t=_(e);_existy(t)&&_tryCommand(t,"pauseVideo")}function stop(e){var t=_(e);_existy(t)&&_tryCommand(t,"stopVideo")}function setPlaybackQuality(e,t){var i=_(e);_existy(i)&&i.setPlaybackQuality(t)}function getVideoLoadedFraction(e){var t=_(e);if(_existy(t))return 100*t.getVideoLoadedFraction()}function seekTo(e,t){var i=_(e),n=T(e,"ytId"),r=a[T(e,"playerState")],s=playerState(e);if(_existy(i))if("video cued"===s)switch(r){case"paused":case"playing":i.cueVideoById(n,t);break;case"video cued":e===o?(t>.1&&!1===T(e,"autoplay")&&C(_seekPauseListener),_tryCommand(i,"seekTo",t)):i.cueVideoById(n,t)}else _tryCommand(i,"seekTo",t,!0)}function toggleMute(e){var t=_(e);t.isMuted()?(t.unMute(),E(e,"muted",!1)):(t.mute(),E(e,"muted",!0))}function setVolume(e,t){var i=_(e);_existy(i)&&(i.setVolume(t),E(e,"volume",t))}function _seekPauseListener(e){"playing"===e.state&&($(_seekPauseListener),pause(e.emitterId))}function _reset(e){var t=_(e),i=T(e,"mainPlayer");if(_existy(t)){var n=t.getVideoData().video_id,a=t.getCurrentTime();!0===i?t.cueVideoById(n,a):t.loadVideoById(n,a)}}function _createInstance(t,n,a,r,s,l){var c=1;t===o&&(c=0);var d=e.host();return i.load().then(function(){return new YT.Player(t,{videoId:n,playerVars:{controls:c,fs:c,enablejsapi:1,modestbranding:1,showinfo:0,rel:0,iv_load_policy:3,origin:d,wmode:"transparent"},events:{onReady:s,onStateChange:a,onPlaybackQualityChange:r,onError:l}})})}function _existy(e){return null!=e}function _getPidFromInstance(e){return e.getIframe().id}function _formatPlayerStateChangeEvent(e,t){return{emitterId:t,state:a[e.data]}}function _emitStateChange(e){N().forEach(function(t){t(e)})}function _getPlayerDiv(e){return'<div id="'+e+'"></div>'}function _tryCommand(e,t,i,n){var a;try{_existy(i)&&_existy(n)?e[t](i,n):_existy(i)?e[t](i):a=e[t]()}catch(e){}if(_existy(a))return a}var o,l={},c=s({players:l,type:"youtube"}),d=c.commonMetaProps,p={ytId:"",videoType:"youtube",bufferInterval:null},u={instance:null,meta:{}};angular.extend(u.meta,p,d);var m=Object.keys(u.meta),h=function(e){return _existy(f(e))&&!0===T(e,"ready")},g=function(e){_tryCommand(_(e),"destroy")},v=function(e){E(e,"time",T(e,"duration")),t.ngTimeout(function(){"ended"!==playerState(e)&&stop(e)},500)},f=c.getPlayer,y=c.setPlayer,_=c.getInstance(h),S=c.createMetaObj,b=c.getMetaObj,T=c.getMetaProp,E=c.setMetaProp(m),C=c.registerStateChangeListener,$=c.unregisterStateChangeListener,w=c.pauseOtherPlayers(pause,playerState),I=c.getPlayerDiv,k=c.resetPlayerManager(g),P=c.renamePid,A=c.handleTimelineEnd(v),x=t.ngTimeout,L=t.cancelNgTimeout,N=c.getStateChangeListeners;return{type:"youtube",getMetaProp:T,setMetaProp:E,getMetaObj:b,getPlayerDiv:I,pauseOtherPlayers:w,registerStateChangeListener:C,unregisterStateChangeListener:$,resetPlayerManager:k,renamePid:P,seedPlayerManager:seedPlayerManager,create:create,play:play,pause:pause,seekTo:seekTo,getCurrentTime:getCurrentTime,getPlayerState:playerState,getBufferedPercent:getVideoLoadedFraction,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,setPlaybackQuality:setPlaybackQuality,freezeMetaProps:angular.noop,unFreezeMetaProps:angular.noop,stop:stop,handleTimelineEnd:A}}function YTScriptLoader(e,t){function load(){var n;return e(function(e,a){if(n=t(a,i),"undefined"==typeof YT||void 0===YT.Player){var r=document.createElement("script");r.src="//www.youtube.com/iframe_api",r.id="yt-iframe-api";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(r,s)}else t.cancel(n),e();window.onYouTubeIframeAPIReady=function(){t.cancel(n),e()}})}var i=2e3;return{load:load}}function youtubeUrlService_youtubeUrlService(e){function getMimeType(){return i}function getOutgoingUrl(e,i){return e=embeddableYoutubeUrl(e,!1),t(i)&&i>0&&(e+="&start="+i),e}function extractYoutubeId(e){if(!e)return!1;e=e.replace(/%3F/,"?"),e=e.replace(/%26/,"&");var t=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,i=e.match(t);return!(!i||!i[1])&&i[1]}function isYoutubeUrl(e){return!!e&&(e=e.replace(/%3F/,"?"),e=e.replace(/%26/,"&"),/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i.test(e))}function parseMediaSrc(e){return e.reduce(function(e,t){return isYoutubeUrl(t)&&e.mediaSrcArr.push(t),e},{type:"youtube",mediaSrcArr:[]})}function embedParams(e){return!1===e?"?controls=1&autoplay=1&modestbranding=1&showinfo=1&rel=0&iv_load_policy=3&wmode=transparent":"?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&rel=0&iv_load_policy=3&wmode=transparent"}function createEmbedLinkFromYoutubeId(e,t){return!!e&&"//www.youtube.com/embed/"+e+(t?"":embedParams(t))}function embeddableYoutubeUrl(e,t){return!!e&&createEmbedLinkFromYoutubeId(extractYoutubeId(e),t)}var t=e.existy,i="video/x-youtube";return{type:"youtube",getMimeType:getMimeType,extractYoutubeId:extractYoutubeId,isYoutubeUrl:isYoutubeUrl,canPlay:isYoutubeUrl,parseMediaSrc:parseMediaSrc,embedParams:embedParams,createEmbedLinkFromYoutubeId:createEmbedLinkFromYoutubeId,embeddableYoutubeUrl:embeddableYoutubeUrl,parseInput:embeddableYoutubeUrl,getOutgoingUrl:getOutgoingUrl}}function kalturaPlayerManager(e,t,i,n,a){function create(e){function handleSuccess(){}function readyCallback(e){var t=document.getElementById(e);g(e).instance=t,_attachEventListeners(t,e)}var t=b(e,"ktObj");_createKWidget(e,t.partnerId,t.entryId,t.uiconfId,readyCallback).then(handleSuccess)}function seedPlayerManager(e,t,i){if(!(o(g(e))&&b(e,"startAtTime")>0)){t&&(s={},r=e);var n=a.getKalturaObject(i[0]),l={mainPlayer:t,div:_getPlayerDiv(e),ktObj:n};v(e,_(l,p))}}function onMediaReady(e){_emitStateChange(e,6),T(e,"duration",_kdpEval(e,"duration"))}function onPlaying(e){T(e,"playerState",1),!0===b(e,"ready")&&_emitStateChange(e)}function onPaused(e){T(e,"playerState",2),_emitStateChange(e)}function onBufferEnd(e){var i=t[b(this.id,"playerState")],n=b(this.id,"bufferTimeout");o(n)&&A(n),"buffering"===i&&play(this.id)}function onBufferStart(){var e=this.id,t=P(function(){_reset(e)},15e3);T(this.id,"bufferTimeout",t),T(this.id,"playerState",3),_emitStateChange(this.id)}function onPlayerPlayEnd(e){T(e,"playerState",0),_emitStateChange(e)}function onMediaError(e){}function onUpdatedPlaybackRate(e){}function onPlayerUpdatePlayhead(e){T(this.id,"time",e)}function play(e){_sendKdpNotice(e,"doPlay")}function pause(e){_sendKdpNotice(e,"doPause")}function seekTo(e,t){t>60&&t%10==0&&(t-=.5),_sendKdpNotice(e,"doSeek",t)}function stop(e){_sendKdpNotice(e,"doStop")}function getPlayerState(e){return t[b(e,"playerState")]}function getCurrentTime(e){return _kdpEval(e,"video.player.currentTime")||0}function getBufferedPercent(e){if(!0===b(e,"ready"))return 100*_kdpEval(e,"video.buffer.percent")}function toggleMute(e){var t=b(e,"muted");!1===t?(T(e,"lastVol",b(e,"volume")),setVolume(e,0)):setVolume(e,b(e,"lastVol")),T(e,"muted",!t)}function setSpeed(e,t){_sendKdpNotice(e,"playbackRateChangeSpeed",t)}function setVolume(e,t){_sendKdpNotice(e,"changeVolume",t/100),T(e,"volume",t)}function _reset(e,t){var i=t||b(e,"time");T(e,"startAtTime",i),T(e,"hasResumedFromStartAt",!1),T(e,"resetInProgress",!0),_sendKdpNotice(e,"changeMedia",{entryId:b(e,"ktObj").entryId}),T(e,"ready",!1)}function _sendKdpNotice(e,t,i){var n=y(e);try{o(i)?n.sendNotification(t,i):n.sendNotification(t)}catch(e){}}function _createKWidget(e,t,i,a,s){var o={targetId:e,wid:"_"+t,uiconf_id:a,readyCallback:s,entry_id:i,flashvars:{"playbackRateSelector.plugin":!0,"controlBarContainer.plugin":!1,"largePlayBtn.plugin":!1,"loadingSpinner.plugin":!0,"closedCaptions.displayCaptions":!1}},l={"EmbedPlayer.NativeControls":!0,"EmbedPlayer.DisableHTML5FlashFallback":!0};return e!==r&&angular.extend(o.flashvars,l),n.load(t,a).then(function(){KWidget.embed(o)})}function _getPlayerDiv(e){return'<div id="'+e+'"></div>'}function _attachEventListeners(e,t){var i={playerPlayed:onPlaying,playerPaused:onPaused,bufferStartEvent:onBufferStart,bufferEndEvent:onBufferEnd,playerPlayEnd:onPlayerPlayEnd,mediaError:onMediaError,mediaReady:onMediaReady,updatedPlaybackRate:onUpdatedPlaybackRate,playerUpdatePlayhead:onPlayerUpdatePlayhead};Object.keys(i).forEach(function(n){!function(n){e.kBind(n+"."+t,i[n])}(n)})}function _removeEventListeners(e){y(e).kUnbind("."+e)}function _emitStateChange(e,t){var i;i=t||b(e,"playerState"),x().forEach(function(t){t(_formatPlayerStateChangeEvent(i,e))})}function _kdpEval(e,t){var i=y(e);if(o(i))return i.evaluate("{"+t+"}")}function _formatPlayerStateChangeEvent(e,i){return{emitterId:i,state:t[e]}}var r,s={},o=e.existy,l=i({players:s,type:"kaltura"}),c=l.commonMetaProps,d={ktObj:{},videoType:"kaltura",bufferTimeout:null,seekTimeout:null,lastVol:100},p={instance:null,meta:{}};angular.extend(p.meta,d,c);var u=Object.keys(p.meta),m=function(e){return o(g(e))&&!0===b(e,"ready")},h=function(e){},g=l.getPlayer,v=l.setPlayer,f=l.getPlayerDiv,y=l.getInstance(m),_=l.createMetaObj,S=l.getMetaObj,b=l.getMetaProp,T=l.setMetaProp(u),E=l.registerStateChangeListener,C=l.unregisterStateChangeListener,$=l.pauseOtherPlayers(pause,getPlayerState),w=l.resetPlayerManager(_removeEventListeners),I=l.renamePid,k=l.handleTimelineEnd(h),P=e.ngTimeout,A=e.cancelNgTimeout,x=l.getStateChangeListeners;return{type:"kaltura",getMetaProp:b,setMetaProp:T,getMetaObj:S,getPlayerDiv:f,pauseOtherPlayers:$,registerStateChangeListener:E,unregisterStateChangeListener:C,resetPlayerManager:w,renamePid:I,seedPlayerManager:seedPlayerManager,create:create,getPlayerState:getPlayerState,play:play,pause:pause,seekTo:seekTo,getCurrentTime:getCurrentTime,getBufferedPercent:getBufferedPercent,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,freezeMetaProps:angular.noop,unFreezeMetaProps:angular.noop,stop:stop,handleTimelineEnd:k}}function kalturaScriptLoader(e,t){function load(t,a){return e(function(e){var r=a+t;n(i[r])||(i[r]="ready"),"undefined"==typeof KWidget?_loadScript(t,a,i,e):"ready"===i[r]?_loadScript(t,a,i,e):e()})}function _loadScript(e,t,i,n){var a=_getScriptTagSrc(e,t),r=_appendScript(a,e);r.onload=n,i[t+e]=r}function _getScriptTagSrc(e,t){return"https://cdnapisec.kaltura.com/p/"+e+"/sp/"+e+"00/embedIframeJs/uiconf_id/"+t+"/partner_id/"+e}function _appendScript(e,t){var i=document.createElement("script");i.src=e,i.id=t;var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(i,n),i}var i={},n=t.existy;return{load:load}}function kalturaUrlService_kalturaUrlService(){function getMimeType(){return t}function parseInput(e){return buildAutoEmbedURLFromKalturaObject(getKalturaObject(e),1024,768)}function parseMediaSrc(t){return t.reduce(function(e,t){return isKalturaUrl(t)&&e.mediaSrcArr.push(t),e},{type:e,mediaSrcArr:[]})}function isKalturaUrl(e){var t=["partnerId","uiconfId","entryId","uniqueObjId"],i=getKalturaObject(e);return t.every(function(e){return i.hasOwnProperty(e)&&null!=i[e]})}function getKalturaObject(e){var t,i={},n=[];return null==e?{partnerId:null,uiconfId:null,entryId:null,uniqueObjId:null}:("<script"===e.substring(0,7)?(n=/^.*?src\=.https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*?)\".*/g.exec(e),null!=n?(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.entryId=t.entry_id,i.uniqueObjId=t.playerId):i=getKalturaObjectFromDynamicEmbedCode(e)):"<div"===e.substring(0,4)?i=getKalturaObjectFromDynamicEmbedCode(e):"<iframe"===e.substring(0,7)?null!=(n=/^.*?src\=.https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*?)\".*/g.exec(e))&&(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.uniqueObjId=t.playerId,i.entryId=t.entry_id):"<object"===e.substring(0,7)?null!=(n=/^.*\n*?.*?id\=.(.*?)\"(.*?\n*)*?data\=.*?https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/kwidget\/wid\/_(.*?)\/uiconf_id\/(.*?)\/entry_id\/(.*?)\".*/g.exec(e))&&(i.uniqueObjId=n[1],i.partnerId=n[3],i.uiconfId=n[4],i.entryId=n[5]):"http"===e.substring(0,4)&&null!=(n=/^https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*)/g.exec(decodeURIComponent(e)))&&(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.entryId=t.entry_id,i.uniqueObjId=t.playerId),i)}function buildAutoEmbedURLFromKalturaObject(e,t,i){return"https://cdnapisec.kaltura.com/p/"+e.partnerId+"/sp/"+e.partnerId+"00/embedIframeJs/uiconf_id/"+e.uiconfId+"/partner_id/"+e.partnerId+"?entry_id="+e.entryId+"&playerId="+e.uniqueObjId+"&autoembed=true&width="+t+"&height="+i}function parseUrlParams(e){return"&"==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),JSON.parse('{"'+e.replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}function getKalturaObjectFromDynamicEmbedCode(e){var t={},i=/^(?:.|\n|\r)*?kWidget\..*?mbed\(({(?:.|\n|\r)*})\).*?/g.exec(e);if(null!=i){var n=JSON.parse(i[1]);t.uniqueObjId=n.targetId,t.partnerId=n.wid.substring(1),t.uiconfId=n.uiconf_id,t.entryId=n.entry_id}return t}var e="kaltura",t="video/x-"+e;return{type:e,getMimeType:getMimeType,canPlay:isKalturaUrl,parseMediaSrc:parseMediaSrc,getKalturaObject:getKalturaObject,buildAutoEmbedURLFromKalturaObject:buildAutoEmbedURLFromKalturaObject,parseInput:parseInput,getOutgoingUrl:function(){}}}function questionAnswersSvc_questionAnswersSvc(e,t,i){var n={};return n.saveAnswer=function(e,i,n){return t.forceCaptureEventActivityWithPromise(e,i,n)},n.getAnswers=function(n){var a=e.defer();return t.readEventActivity(n).then(function(e){var t=e.filter(function(e){return("question-answered"===e.name||"question-answered-updated"===e.name)&&e.episode_id===i.episodeId});a.resolve(t)}),a.promise},n.getUserAnswer=function(t,i){var a=e.defer();return n.getAnswers(t).then(function(e){if(!e)return a.reject();var t=e.filter(function(e){return e.user_id===i});t.length>0?a.resolve(t[0]):a.reject()}),a.promise},n.calculateCounts=function(e){var t;return angular.forEach(e,function(e){t[e.data.index]++}),t},n.incrementAnswerCount=function(e,t){e[t]=(e[t]||0)+1},n}function ittFlotr2Chart(){var e=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:'<div class="flotContainer"><div class="chartContainer" id="chartContainer" aria-label="{{chartLabel}}"></div><div class="legendContainer" id="legendContainer"></div></div>',link:function(t,i,n){var a=function(e,i,n){t.chartLabel=d(i),$.plot(e,i,n),e.show()},r=$("#chartContainer");r.attr("id","chartContainer"+e);var s=$("#legendContainer");s.attr("id","legendContainer"+e++);var o=function(e,t){return Math.round(t.percent)+"% ("+t.data[0][1]+"): "+e},l=function(e,t){return'<div style="padding: 3px; font-size: 80%">'+Math.round(t.percent)+"%</div>"};t.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.7},formatter:l}}},legend:{show:!0,labelFormatter:o,noColumns:1,position:"sw",margin:0,backgroundColor:null,backgroundOpacity:1,sorted:"descending",container:s},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}},t.$watch(function(){return r.width()},function(e){e>0&&(r.css({height:e}),a(r,JSON.parse(t.data),t.chartOptions),t.observeData=n.$observe("data",function(e){t.data=JSON.parse(e),a(r,t.data,t.chartOptions)}),t.$on("$destroy",t.observeData))});var c=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].data;for(var n=0;n<e.length;n++)e[n].percent=e[n].data/t*100;return e},d=function(e){var t="";e=c(e);for(var i=0;i<e.length;i++)t+=Math.round(e[i].percent)+"% of users totaling "+e[i].data+" choose '"+e[i].label+"'. ";return t}}}}function ittQuestionTypeSelect(){return{restrict:"EA",scope:{data:"="},template:['<div class="field">','\t<div class="label">Template</div>','\t<div class="input">','\t<select ng-model="$ctrl.data.data._plugin.questiontype" ng-options="{{$ctrl.setNgOpts(\'questionType\')}}"></select>',"\t</div>","</div>"].join(" "),controller:["selectService","ittUtils",function(e,t){var i=this;i.setNgOpts=t.setNgOpts,i.getSelectOpts=e.getSelectOpts,function(){e.onSelectChange(i.data,{})}()}],controllerAs:"$ctrl",bindToController:!0}}function textAngularConfig(e){e.decorator("taOptions",["taRegisterTool","$delegate",function(e,t){return t.defaultFileDropHandler=function(e,t){},t.toolbar=[["h1","h2","h3"],["bold","italics","underline","strikeThrough"],["ul","ol"],["undo","redo","clear"]],t}])}function routerConfig(e){e.when("/",{title:"Narrative Producer",template:"<np-root-template></np-root-template>"}).when("/auth",{template:"<np-auth-template></np-auth-template>",reloadOnSearch:!1}).when("/account",{template:['<div class="standaloneAncillaryPage">','\t<np-nav on-logout="logout()"></np-nav>',"\t<h1>My Account</h1>","\t<div itt-user></div>","</div>"].join(""),controller:["$scope","authSvc",function(e,t){e.authSvc=t,e.logout=e.authSvc.logout}]}).when("/stories",{title:"Available Narratives",template:"<np-narratives-container></np-narratives-container>"}).when("/story/:narrativePath",{title:"Narrative",template:"<np-narrative-container></np-narrative-container>",resolve:{narrativeResolve:["$route","$q","authSvc","dataSvc","modelSvc","ittUtils",function(e,t,i,n,a,r){var s,o=e.current.params.narrativePath,l=a.getNarrativeByPathOrId(o);return r.existy(l)&&r.existy(l.path_slug)&&r.existy(l.timelines)&&(l.path_slug.en===o||l._id===o)?(s=a.customers[l.customer_id],t(function(e){return e({n:l,c:[s]})})):n.getNarrative(o).then(function(e){return n.getCustomer(e.customer_id,!0).then(function(t){return{n:e,c:[t]}})})}]}}).when("/story/:narrativePath/:timelinePath",{template:"<div itt-narrative-timeline></div>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="narrative"}]}}).when("/projects",{title:"Available projects",template:"<np-projects-container></np-projects-container>"}).when("/episode/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="player"}]}}).when("/episode/:epId/:viewMode",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="player"}]}}).when("/sxs/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="sxs",e.productLoadedAs="sxs"}]}}).when("/editor/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="sxs",e.productLoadedAs="sxs"}]}}).when("/producer/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["$route","appState",function(e,t){t.init(),t.episodeId=t.episodeId=e.current.params.epId,t.product="producer",t.productLoadedAs="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",template:"<np-assets-resolve></np-assets-resolve>"}).otherwise({title:"Narrative Producer: Error",controller:"ErrorController",template:"<np-error-404-template></np-error-404-template>"})}function xDomainConfig(e){e.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}function authInterceptorConfig(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"],e.interceptors.push(["$q","errorSvc",function(e,t){return{responseError:function(i){return i.data&&i.data.path_slug?e(function(e,t){return t(i)}):(t.error(i),e.reject(i))}}}])}function debugInfoConfig(e){var t=!1,i=window.location.hostname;0!==i.indexOf("localhost")&&0!==i.indexOf("api-dev")&&0!==i.indexOf("np-dev")||(t=!0),!1===t&&e.debugInfoEnabled(!1)}function runFunction(e,t){e.$on("$routeChangeSuccess",function(e,i){document.title=i.title?i.title:"Narrative Producer",t.init()});var i=!1;$(document).on("keydown",function(t){i||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.attributes.contenteditable||(i=!0,27===t.keyCode&&(e.$emit("userKeypress.ESC"),t.preventDefault()),32===t.which&&(e.$emit("userKeypress.SPACE"),t.preventDefault()))}),$(document).on("keyup",function(){i=!1})}Object.defineProperty(t,"__esModule",{value:!0});var n=(i("l1Qu"),i("DJti"),i("oXgf"),i("oTj3"),i("wdTO"),i("ihzJ"),{prod:!0}),a=n.prod?"//"+window.location.host:"//np-dev.narrasys.com",r={localStorageKey:"storyToken",apiDataBaseUrl:a,youtube:{domain:"//gdata.youtube.com/",timeout:5e3},disableAnalytics:!1,debugInBrowser:!0};authSvc_authSvc.$inject=["$routeParams","$http","$q","$location","ittUtils","appState","modelSvc","errorSvc"];var s=i("IiAB"),o={noAvatarImg:s,user:{},episodeId:!1,episodeSegmentId:!1,narrativeId:!1,timelineId:!1,resizeIframeReviewMode:!1,isFramed:window.parent!=window,isTouchDevice:/iPad|iPod|iPhone/.test(navigator.platform)||/Android/.test(navigator.userAgent),isIEOrEdge:/Trident|Edge/.test(navigator.userAgent)||/Trident|Edge/.test(navigator.platform),isIPhone:/iPod|iPhone/.test(navigator.platform),iOSVersion:"",windowWidth:0,windowHeight:0,viewMode:$(window).width()>480?"discover":"review",producerEditLayer:0,hideCaptions:!1,show:{searchPanel:!1,navPanel:!1},videoControlsActive:!1,videoControlsLocked:!1,itemDetail:!1,autoscroll:!1,autoscrollBlocked:!1,crossEpisodePath:"",product:"",productLoadedAs:"",editEvent:!1,editEpisode:!1,lang:!1},l=function(){function AppState(e){this.$interval=e,this.initService()}return AppState.getIOSVersion=function(e){var t=/iP(hone|od|ad)/,i=/OS (\d+)_(\d+)_?(\d+)?/;if(t.test(e.platform)||t.test(e.userAgent)){var n=e.appVersion.match(i);return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3]||0,10)]}},AppState.prototype.init=function(){var e;e="sxs"===this.product||"producer"===this.product?this.product:"episode";var t={crossEpisodePath:e,iOSVersion:AppState.getIOSVersion(navigator),product:this.product,productLoadedAs:this.productLoadedAs,user:this.user||{}};Object.assign(this,o,t)},AppState.prototype.initService=function(){this.init(),this.watchWidth()},AppState.prototype.watchWidth=function(){var e=this;this.$interval(function(){e.windowHeight=angular.element(window).height(),e.windowWidth=angular.element(window).width()},50,0,!1),r.debugInBrowser},AppState.prototype.isIframedIOS=function(){return this.isFramed&&this.isIOS()},AppState.prototype.isIOS=function(){return this.iOSVersion&&this.iOSVersion[0]&&this.iOSVersion[0]>0},AppState.Name="appState",AppState.$inject=["$interval"],AppState}(),c=function(){function awsSvc(e,t,i){this.$http=e,this.$q=t,this.AWS=i,this.MAX_CHUNKS=1e3,this.MAX_RETRIES=4,this.MAX_SIMUL_PARTS_UPLOADING=3,this.REQUEST_TIMEOUT=3e4,this.PUBLIC_READ="public-read",this.PENDING="pending",this.UPLOADING="uploading",this.FAILED="failed",this.COMPLETE="complete",this.svc={},this._awsCache={s3:{}},this.fiveMB=5242880,this.chunkSize=0,this.chunkCount=0,this.chunksUploaded=0,this.chunks=[],this.chunkSearchIndex=0,this.files=[],this.fileMeta={},this.fileIndex=0,this.bytesUploaded=0,this.deferredUploads=[],this.uploadPaused=!1,this.createAssetSuccess=function(e,t){this.deferredUploads[this.fileIndex].resolve(e),this.fileBeingUploaded=null,this.fileIndex++,this.startNextUpload(t)},this.createAsset=function(e){var t=this,i=this.$q.defer(),n={url:"https://s3.amazonaws.com/"+this._awsCache.s3.config.params.Bucket+"/"+this._awsCache.s3.config.params.Prefix+this.fileBeingUploaded.uniqueName,type:this.fileBeingUploaded.type,size:this.fileBeingUploaded.size,original_filename:this.fileBeingUploaded.name};return this.fileMeta[this.fileBeingUploaded.name]&&(Object.assign(n,{tags:this.fileMeta[this.fileBeingUploaded.name]}),this.fileMeta[this.fileBeingUploaded.name]=null),this.$http.post(r.apiDataBaseUrl+e,n).success(function(i){return t.createAssetSuccess(i,e)}).error(function(){t.deferredUploads[t.fileIndex].reject(),t.fileBeingUploaded=null,t.fileIndex++,t.startNextUpload(e)}),i.promise}}return awsSvc.prototype.awsCache=function(){return this._awsCache},awsSvc.prototype.getBucketListing=function(){var e=this,t=this.$q.defer();return this.getUploadSession().then(function(){e._awsCache.s3.listObjects(function(e,i){e?t.reject():t.resolve(i)})}),t.promise},awsSvc.prototype.uploadContainerFiles=function(e,t,i){return this.uploadFiles("/v1/containers/"+e+"/assets",t,i)},awsSvc.prototype.uploadUserFiles=function(e,t){return this.uploadFiles("/v1/users/"+e+"/assets",t)},awsSvc.prototype.uploadFiles=function(e,t,i){for(var n=[],a=0;a<t.length;a++){this.files.push(t[a]),null!=i&&(this.fileMeta[t[a].name]=[i]);var r=this.$q.defer();this.deferredUploads.push(r),n.push(r.promise)}return this.startNextUpload(e),n},awsSvc.prototype.pauseUpload=function(){if(this.fileBeingUploaded&&!this.uploadPaused){if(this.uploadPaused=!0,this.cancelCurrentUploadRequests(),this.isSmallUpload())this.bytesUploaded=0;else{var e=0;for(this.bytesUploaded=0;e<this.chunkCount;){var t=this.chunks[e];t.status===this.COMPLETE&&(this.bytesUploaded+=t.uploaded),e++}}this.deferredUpload.notify({bytesSent:this.bytesUploaded,bytesTotal:this.fileBeingUploaded.size})}},awsSvc.prototype.resumeUpload=function(){if(this.fileBeingUploaded&&this.uploadPaused)if(this.uploadPaused=!1,this.isSmallUpload())this.putObject();else for(var e=0;e<this.MAX_SIMUL_PARTS_UPLOADING;e++)this.startNextUploadPart()},awsSvc.prototype.cancelUpload=function(){this.fileBeingUploaded&&(this.uploadPaused=!1,this.bytesUploaded=0,this.cancelCurrentUploadRequests(),this.isSmallUpload()||(this.cancelMultipartUpload(this.multipartUpload),this.multipartUpload=null),this.fileBeingUploaded=null,this.deferredUploads[this.fileIndex].reject("Canceled by user"));for(var e=this.fileIndex+1;e<this.files.length;e++)this.deferredUploads[e].reject("Canceled by user");this.fileIndex=this.files.length},awsSvc.prototype.networkError=function(){this.fileBeingUploaded&&this.cancelCurrentUploadRequests()},awsSvc.prototype.deleteObject=function(e){var t=this,i=this.$q.defer();return this.getUploadSession().then(function(){var n={Bucket:e.bucket,Key:e.Key};t._awsCache.s3.deleteObject(n,function(e,t){e?i.reject():i.resolve(t)})}),i.promise},awsSvc.prototype.getMultipartUploads=function(){var e=this,t=this.$q.defer();return this.getUploadSession().then(function(){e._awsCache.s3.listMultipartUploads(function(e,i){e?t.reject():t.resolve(i)})}),t.promise},awsSvc.prototype.getMultipartUploadParts=function(e,t){var i=this,n=this.$q.defer();return this.getUploadSession().then(function(){var a={Bucket:t.bucket,Key:t.Key,UploadId:t.UploadId};i._awsCache.s3.listParts(a,function(t,i){t?n.reject():n.resolve({i:e,parts:i})})}),n.promise},awsSvc.prototype.cancelMultipartUpload=function(e){var t=this,i=this.$q.defer();return this.getUploadSession().then(function(){var n={Bucket:e.bucket,Key:e.Key,UploadId:e.UploadId};t._awsCache.s3.abortMultipartUpload(n,function(e,t){e?i.reject():i.resolve(t)})}),i.promise},awsSvc.prototype.uploadSuccess=function(e){if(e.access_key_id){AWS.config.update({accessKeyId:e.access_key_id,secretAccessKey:e.secret_access_key,sessionToken:e.session_token,region:r.awsRegion});var t={maxRetries:0,httpOptions:{timeout:this.REQUEST_TIMEOUT},params:{Bucket:e.bucket,Prefix:e.key_base}};this._awsCache.s3=new AWS.S3(t),this._awsCache.sessionDeferred.resolve(e)}else this._awsCache.sessionDeferred.reject()},awsSvc.prototype.getUploadSession=function(){var e=this;return this._awsCache.hasOwnProperty("sessionDeferred")?this._awsCache.sessionDeferred.promise:(this._awsCache.sessionDeferred=this.$q.defer(),this.$http.get(r.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(t){return e.uploadSuccess(t)}).error(function(){this._awsCache.sessionDeferred.reject()}),this._awsCache.sessionDeferred.promise)},awsSvc.prototype.startNextUpload=function(e){if(this.files.length>this.fileIndex&&!this.fileBeingUploaded){if(this.fileBeingUploaded=this.files[this.fileIndex],""===this.fileBeingUploaded.type)return this.deferredUploads[this.fileIndex].reject("Could not determine file type for file '"+this.fileBeingUploaded.name+"'"),this.fileBeingUploaded=null,this.fileIndex++,void this.startNextUpload(e);var t=this;this.ensureUniqueFilename(this.$q.deferred).then(function(){var i;i=t.isSmallUpload()?t.uploadSmallFile():t.uploadBigFile(),i.then(function(){t.createAsset(e)},function(e){t.deferredUploads[t.fileIndex].reject(e)},function(e){t.deferredUploads[t.fileIndex].notify(e)})})}},awsSvc.prototype.ensureUniqueFilename=function(e){e=e||this.$q.defer(),this.fileBeingUploaded.uniqueName=this.generateUUID();var t=this;return this.getUploadSession().then(function(){var i={Key:t._awsCache.s3.config.params.Prefix+t.fileBeingUploaded.uniqueName};t._awsCache.s3.headObject(i,function(i){i?404!==i.statusCode?e.reject(i):t.isSmallUpload()?e.resolve():t.getMultipartUploads().then(function(i){var n=function(e){for(var a=0;a<i.Uploads.length;a++)if(i.Uploads[a].Key===t._awsCache.s3.config.params.Prefix+e)return n(t.generateUUID());return e};t.fileBeingUploaded.uniqueName=n(t.fileBeingUploaded.uniqueName),e.resolve()}):(t.fileBeingUploaded.uniqueName=this.generateUUID(),t.ensureUniqueFilename(e))})}),e.promise},awsSvc.prototype.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})},awsSvc.prototype.isSmallUpload=function(){return this.fileBeingUploaded.size<=this.fiveMB},awsSvc.prototype.uploadSmallFile=function(){return this.deferredUpload=this.$q.defer(),this.putObject().then(function(e){},function(e){},function(e){}),this.deferredUpload.promise},awsSvc.prototype.putObject=function(){var e=this.$q.defer(),t=this;return this.getUploadSession().then(function(){t.getMD5ForFileOrBlob(t.fileBeingUploaded,"base64").then(function(e){var i={Key:t._awsCache.s3.config.params.Prefix+t.fileBeingUploaded.uniqueName,ContentType:t.fileBeingUploaded.type,Body:t.fileBeingUploaded,ContentMD5:e,ACL:t.PUBLIC_READ};t.currentRequest=t._awsCache.s3.putObject(i,function(e,i){e?t.deferredUpload.reject():t.deferredUpload.resolve(i)}),t.currentRequest.on("httpUploadProgress",function(e){t.deferredUpload.notify({bytesSent:e.loaded,bytesTotal:e.total})}).on("error",function(e,i){t.deferredUpload.reject("An error occured while uploading the file, please try again.")})})},function(e){},function(e){}),e.promise},awsSvc.prototype.uploadBigFile=function(){this.deferredUpload=this.$q.defer();var e=this;return this.createMultipartUpload().then(function(t){return e.prepareUploadParts(t)}).then(function(){for(var t=0;t<e.MAX_SIMUL_PARTS_UPLOADING;t++)e.startNextUploadPart()}),this.deferredUpload.promise},awsSvc.prototype.createMultipartUpload=function(){var e=this.$q.defer(),t=this;return this.getUploadSession().then(function(){var i={Key:t._awsCache.s3.config.params.Prefix+t.fileBeingUploaded.uniqueName,ContentType:t.fileBeingUploaded.type,ACL:t.PUBLIC_READ};t._awsCache.s3.createMultipartUpload(i,function(t,i){t?e.reject():e.resolve(i)})}),e.promise},awsSvc.prototype.prepareUploadParts=function(e){var t=this.$q.defer();this.multipartUpload=e,this.chunks=[],this.chunkCount=0,this.chunksUploaded=0,this.chunkSearchIndex=0,this.chunkSize=this.fiveMB,this.bytesUploaded=0,this.fileBeingUploaded.size>this.chunkSize*this.MAX_CHUNKS&&(this.chunkSize=Math.ceil(this.fileBeingUploaded.size/this.MAX_CHUNKS)),this.chunkCount=Math.ceil(this.fileBeingUploaded.size/this.chunkSize);for(var i=0;i<this.chunkCount;i++){var n={};n.start=i*this.chunkSize,n.end=n.start+this.chunkSize,n.uploaded=0,n.end>this.fileBeingUploaded.size&&(n.end=this.fileBeingUploaded.size),n.status=this.PENDING,n.retries=0,this.chunks.push(n)}return t.resolve(),t.promise},awsSvc.prototype.startNextUploadPart=function(){var e=this,t=this.$q.defer(),i=this.chunkSearchIndex,n=!1;if(this.uploadPaused)t.reject("Upload paused");else{for(;!n&&i<this.chunkCount;){var a=this.chunks[i];if(a.status===this.PENDING){n=!0,a.status=this.UPLOADING;var r=this.fileBeingUploaded.slice(a.start,a.end);a.cancel=function(){a.request.abort(),a.status=this.PENDING,a.uploaded=0},this.$q.all({partNumber:this.$q.when(i+1),eTag:this.uploadPart(i+1,r)}).then(function(t){return e.completePart(t)},function(t){return e.handleFailedPart(t)}).then(function(e){t.resolve(e)},function(e){t.reject(e)},function(e){t.update(e)})}else a.status===this.COMPLETE&&i===this.chunkSearchIndex&&this.chunkSearchIndex++;i++}n||t.reject("All chunks uploaded")}return t.promise},awsSvc.prototype.getMD5ForFileOrBlob=function(e,t){var i=this.$q.defer(),n=new FileReader;return n.onload=function(){var e=n.result;i.resolve(AWS.util.crypto.md5(new Uint8Array(e),t))},n.readAsArrayBuffer(e),i.promise},awsSvc.prototype.uploadPart=function(e,t,i){var n=this;return i||(i=this.$q.defer()),this.getUploadSession().then(function(){n.getMD5ForFileOrBlob(t,"base64").then(function(a){var r={Bucket:n.multipartUpload.Bucket,Key:n.multipartUpload.Key,UploadId:n.multipartUpload.UploadId,PartNumber:e,ContentMD5:a,Body:t};n.chunks[e-1].request=n._awsCache.s3.uploadPart(r,function(a,r){a?n.chunks[e-1].retries<n.MAX_RETRIES?(n.chunks[e-1].request.abort(),n.chunks[e-1].retries++,n.uploadPart(e,t,i)):(n.chunks[e-1].status=n.FAILED,i.reject(a)):i.resolve(r.ETag)}),n.chunks[e-1].request.on("httpUploadProgress",function(t){n.bytesUploaded+=t.loaded-n.chunks[e-1].uploaded,n.chunks[e-1].uploaded=t.loaded,n.deferredUpload.notify({bytesSent:n.bytesUploaded,bytesTotal:n.fileBeingUploaded.size})}).on("error",function(e,t){})})}),i.promise},awsSvc.prototype.completePart=function(e){var t=this,i=this.$q.defer();if(this.chunks[e.partNumber-1].status=this.COMPLETE,this.chunks[e.partNumber-1].part={ETag:e.eTag,PartNumber:e.partNumber},++this.chunksUploaded===this.chunkCount){for(var n=[],a=0;a<this.chunkCount;a++)n.push(this.chunks[a].part);var r={Bucket:this.multipartUpload.Bucket,Key:this.multipartUpload.Key,UploadId:this.multipartUpload.UploadId,MultipartUpload:{Parts:n}};this._awsCache.s3.completeMultipartUpload(r,function(e,n){e?(t.deferredUpload.reject(e),i.reject(e)):(t.deferredUpload.resolve(n),i.resolve(n))})}else this.startNextUploadPart();return i.promise},awsSvc.prototype.handleFailedPart=function(e){this.cancelMultipartUpload(this.multipartUpload),this.deferredUpload.reject(e)},awsSvc.prototype.cancelCurrentUploadRequests=function(){if(this.isSmallUpload())this.currentRequest.abort();else for(var e=this.chunkSearchIndex,t=!1;!t&&e<this.chunkCount;){var i=this.chunks[e];i.status===this.UPLOADING?i.cancel():i.status===this.PENDING&&(t=!0),e++}},awsSvc.Name="awsSvc",awsSvc.$inject=["$http","$q"],awsSvc}(),d=function(){function ErrorSvc(e){this.$location=e,this.errors=[],this.notifications=[]}return ErrorSvc.prototype.init=function(){this.errors=[],this.notifications=[]},ErrorSvc.prototype.error=function(e,t){return!e||401!==e.status&&403!==e.status||"/"===this.$location.path()&&(e=void 0),e&&e.data&&("string"==typeof e.data?(e.data=e.data.replace(/\n/g,"").replace(/==/g,"").replace(/-----.*/g,""),this.errors.push({exception:e})):this.errors.push({exception:e})),this.errors},ErrorSvc.prototype.notify=function(e){return this.notifications.push({text:e}),this.notifications},ErrorSvc.Name="errorSvc",ErrorSvc.$inject=["$location"],ErrorSvc}();ittUtils_ittUtils.$inject=["$timeout"];var p,u=(function(){function StopWatchUtil(){}StopWatchUtil.of=function(){return new StopWatchUtil},StopWatchUtil.prototype.start=function(e){this._label=e,this._start=window.performance.now()},StopWatchUtil.prototype.stop=function(){window.performance.now(),null!=this._label&&this._label}}(),"magnet.updateMagnet"),m={assetLib:"image/*,text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf",file:"text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf",default:"image/*",image:"image/png,image/jpg,image/jpeg",transcripts:"text/vtt,text/srt"};!function(e){e.LANDINGSCREEN_TEMPLATE="layout-landingscreen",e.ENDINGSCREEN_TEMPLATE="layout-endingscreen",e.CENTERED_TEMPLATE="layout-centered",e.ONECOL_TEMPLATE="layout-onecol",e.CORNER_H_TEMPLATE="layout-corner-h",e.CORNER_V_TEMPLATE="layout-corner-v",e.PIP_TEMPLATE="layout-pip",e.MIRRORED_TWOCOL_TEMPLATE="layout-mirrored-twocol",e.CENTERED_PRO_TEMPLATE="layout-centered-pro",e.CENTER_VV_TEMPLATE="layout-center-vv",e.CENTER_VV_MONDRIAN_TEMPLATE="layout-center-vv-mondrian",e.FILE_TEMPLATE="item-file",e.IMAGE_THUMBNAIL_TEMPLATE="item-image-thumbnail",e.SLIDING_CAPTION="item-image-caption-sliding",e.IMAGE_FILL_TEMPLATE="item-image-fill",e.IMAGE_INLINE_WITHTEXT_TEMPLATE="item-image-inline-withtext",e.IMAGE_PLAIN_TEMPLATE="item-image-plain",e.LINK_TEMPLATE="item-link",e.LINK_DESCRIPTION_FIRST_TEMPLATE="item-link-descriptionfirst",e.LINK_EMBED_TEMPLATE="item-link-embed",e.LINK_MODAL_THUMB_TEMPLATE="item-link-modal-thumb",e.LINK_WITHIMAGE_NOTITLE_TEMPLATE="item-link-withimage-notitle",e.PULLQUOTE_TEMPLATE="item-pullquote",e.QUESTION_TEMPLATE="item-question-mc",e.SXS_ANNOTAITON_TEMPLATE="item-sxs-annotation",e.SXS_FILE_TEMPLATE="item-sxs-file",e.SXS_LINK_TEMPLATE="item-sxs-link",e.SXS_QUESTION_TEMPLATE="item-sxs-question",e.SXS_VIDEO_TEMPLATE="item-sxs-video",e.SXS_IMAGE_TEMPLATE="item-sxs-image",e.TEXT_DEFINITION_TEMPLATE="item-text-definition",e.TEXT_TRANSMEDIA_TEMPLATE="item-text-transmedia",e.HEADER_ONE_TEMPLATE="item-header-one",e.HEADER_TWO_TEMPLATE="item-header-two",e.TRANSCRIPT_TEMPLATE="item-transcript",e.USC_BADGES_TEMPLATE="item-usc-badges",e.USC_BADGES_INNER_TEMPLATE="item-usc-badges-inner"}(p||(p={}));var h=function(){function ImageResize(e){this.$q=e}return ImageResize.prototype.createFileFromDataURL=function(e,t){var i=this._dataURLToBlob(e);return i.name="resized"+t,i.lastModifiedDate=new Date,i},ImageResize.prototype.readFileToImg=function(e){var t=this,i=new Image;return this.readFileToDataURI(e).then(function(e){return i.src=e,t.$q(function(e,t){i.onload=function(){e(i)},i.onerror=function(){t("Error Loading Image")}}).then(function(e){return e})})},ImageResize.prototype.readFileToDataURI=function(e){var t=new FileReader;return this.$q(function(i,n){t.onloadend=function(){i(t.result)},t.onerror=function(){n(t.error)},t.readAsDataURL(e)}).then(function(e){return e})},ImageResize.prototype.resizeImg=function(e,t,i,n){var a=this;return this.$q(function(r){var s=document.createElement("canvas"),o=a._getContext(s),l=0,c=0,d=e.width,p=e.height;for(a._setCanvasWH(s,d,p),o.drawImage(e,0,0,d,p);(d>t||p>i)&&!(.5*d<t||.5*p<i);)e.width=.5*e.width,e.height=.5*e.height,d=e.width,p=e.height,s=a._resizeImgWithCanvas(s,d,p);var u=a._calculateNewDimensions(s.width,s.height,t,i);return n&&(u.height<i&&(c=(i-u.height)/2),u.width<t&&(l=(t-u.width)/2)),s=a._resizeImgWithCanvas(s,u.width,u.height,t,i,l,c),r(s.toDataURL("image/png",1))})},ImageResize.prototype.calcAspectRatio=function(e,t){return e/t},ImageResize.prototype.getImageTagType=function(e,t){return this.calcAspectRatio(e,t)>1.25?"social_image_wide":"social_image_square"},ImageResize.prototype._setCanvasWH=function(e,t,i){e.width=t,e.height=i},ImageResize.prototype._resizeImgWithCanvas=function(e,t,i,n,a,r,s){void 0===n&&(n=t),void 0===a&&(a=i),void 0===r&&(r=0),void 0===s&&(s=0);var o=document.createElement("canvas"),l=this._getContext(o);return o.width=n,o.height=a,l.drawImage(e,r,s,t,i),o},ImageResize.prototype._getContext=function(e){var t=e.getContext("2d");return t.imageSmoothingEnabled=!0,t.mozImageSmoothingEnabled=!0,t.oImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t},ImageResize.prototype._dataURLToBlob=function(e){if(-1==e.indexOf(";base64,")){var t=e.split(","),i=t[0].split(":")[1],n=decodeURIComponent(t[1]);return new Blob([n],{type:i})}for(var a=e.split(";base64,"),r=a[0].split(":")[1],s=window.atob(a[1]),o=s.length,l=new Uint8Array(o),c=0;c<o;++c)l[c]=s.charCodeAt(c);return new Blob([l],{type:r})},ImageResize.prototype._calculateNewDimensions=function(e,t,i,n){var a=Math.min(i/e,n/t);return{width:Math.floor(e*a),height:Math.floor(t*a)}},ImageResize.Name="imageResize",ImageResize.$inject=["$q"],ImageResize}();mockSvc_mockSvc.$inject=["modelSvc"];var g=function(){function UploadsService(e,t){this.$q=e,this.awsSvc=t,this.uploadsDisplay={social_image_square:null,social_image_wide:null},this.uploadQueue=[]}return UploadsService.prototype.uploadTaggedFiles=function(e,t){var i=this;return this.$q(function(n,a){for(var r=0,s=e;r<s.length;r++){var o=s[r],l=o.file,c=o.tag;i.uploadsDisplay[c]={bytesSent:0,bytesTotal:1,percent:0,name:l[0].name},i.uploadQueue.push(i.uploadToAws(t,l,c))}return i.$q.all(i.uploadQueue).then(function(e){return n(e)}).catch(function(e){return a(e)})})},UploadsService.prototype.resetUploads=function(){this.uploadsDisplay={social_image_square:null,social_image_wide:null},this.uploadQueue=[]},UploadsService.prototype.uploadToAws=function(e,t,i){var n=this;return this.awsSvc.uploadContainerFiles(e,t,i)[0].then(function(e){return e}).catch(function(e){}).finally(null,function(e){n.uploadsDisplay[i].bytesSent=e.bytesSent,n.uploadsDisplay[i].bytesTotal=e.bytesTotal,n.uploadsDisplay[i].percent=Math.ceil(e.bytesSent/e.bytesTotal*100)})},UploadsService.Name="uploadsService",UploadsService.$inject=["$q","awsSvc"],UploadsService}(),v='\n<div class="field">\n  <div class="label">Batch Upload Transcripts\n  </div>\n  <div class="input">\n    <div ng-if="!$ctrl.showUploader">\n      <span><button ng-click="$ctrl.showUploader = true">Batch Upload Transcripts</button></span>\n    </div>\n\n\n    <itt-asset-uploader\n      ng-if="$ctrl.showUploader"\n      episode-id="{{$ctrl.episodeId}}"\n      mime-types="{{$ctrl.mimes}}"\n      on-filedrop="$ctrl.handleTranscriptFiles(data)"\n      file-receive="$ctrl.transcripts"\n      callback="$ctrl.onUploadComplete()">\n    </itt-asset-uploader>\n\n    <np-modal\n      wrapper-class="responsive-modal__wrapper"\n      modal-class="responsive-modal__content"\n      ng-if="$ctrl.showOptions">\n      <div class="smart-sentences__wrapper">\n        <div><p>\n          Thank you for using this new feature currently in Beta! Are you sure you want to proceed? Once saved,\n          transcript entries must be individually edited or deleted. This page will automatically refresh after\n          transcripts have successfully uploaded.</p>\n        </div>\n        <div class="smart-sentences__input">\n          <div>\n            <input class="smart-sentences__input" id="groupParam" type="checkbox" ng-model="$ctrl.selectedParam"\n                   ng-false-value="\'none\'"\n                   ng-true-value="\'group_into_sentences\'"/>\n          </div>\n          <div>\n            <label class="smart-sentences__input"\n                   for="groupParam">Group transcript segments into complete sentences (recommended for closed caption\n              transcripts)</label>\n          </div>\n        </div>\n        <div>\n          <button ng-click="$ctrl.commenseUpload()">upload transcripts</button>\n          <button ng-click="$ctrl.cancelUpload()">cancel</button>\n        </div>\n      </div>\n\n    </np-modal>\n  </div>\n</div>',f=function(){function UploadTranscriptsController(e,t,i){this.modelSvc=e,this.dataSvc=t,this.timelineSvc=i,this.showOptions=!1,this.showUploader=!1,this.selectedParam="none",this.maxDuration=null,this.transcripts={},this._maxDurParam="max_subtitle_duration"}return UploadTranscriptsController.prototype.$onInit=function(){this.mimes=m.transcripts},UploadTranscriptsController.prototype.cancelUpload=function(){this.files=null,this.showUploader=!1,this.showOptions=!1},UploadTranscriptsController.prototype.handleTranscriptFiles=function(e){this.showOptions=!0,this.files=e},UploadTranscriptsController.prototype.commenseUpload=function(){var e=this.formatParams(),t=this.files,i=this._handleTranscripts(this.episodeId,t[0],e);this.transcripts={payload:{promises:i,files:t,type:"TRANSCRIPT_UPLOAD"}}},UploadTranscriptsController.prototype.onUploadComplete=function(){this.cancelUpload(),window.location.reload()},UploadTranscriptsController.prototype.formatParams=function(){var e={};return"none"!==this.selectedParam&&(e[this.selectedParam]=!0),existy(this.maxDuration)&&(e[this._maxDurParam]=this.maxDuration),e},UploadTranscriptsController.prototype._handleTranscripts=function(e,t,i){var n=new FormData;return n.append("subtitles",t),this.dataSvc.batchUploadTranscripts(e,n,i)},UploadTranscriptsController.$inject=["modelSvc","dataSvc","timelineSvc"],UploadTranscriptsController}(),y=function(){function UploadTranscripts(){this.bindings={episodeId:"@"},this.template=v,this.controller=f}return UploadTranscripts.Name="ittUploadTranscripts",UploadTranscripts}(),_=i("wmst"),S=i.n(_),b=function(){function AssetUploaderController(e,t,i,n,a,r){this.$timeout=e,this.$element=t,this.awsSvc=i,this.appState=n,this.modelSvc=a,this.dataSvc=r,this.multiple=!1,this.uploadsinprogress=0,this.paused=!1,this.uploadStatus=[],this.uploads=[]}return AssetUploaderController.prototype.$onInit=function(){void 0===this.instructions?this.manPage="We support uploads of most common file formats, \n      including .doc, .docx, .jpeg, .jpg, .pdf, .png, .ppt, .pptx, .rtf, .txt, and .zip.":this.manPage=this.instructions,null==this.mimeTypes?this.mimeTypesArr=["application/*","image/*","video/*","text/*","audio/*","model/*"]:this.mimeTypesArr=this.mimeTypes.split(","),void 0===this.errorText&&(this.errorText="Whoops! You may want to try that again!"),this.mimeTypesArr=this.mimeTypesArr.map(function(e){return e.trim()})},AssetUploaderController.prototype.$postLink=function(){var e=this;this.$timeout(function(){e.droptarget=e.$element.find(".uploadDropTarget"),e.fileinput=e.$element.find(".uploadFileInput"),e.uploadsinprogress=0,e.droptarget[0].addEventListener("drop",function(t){return e.handleDrop(t)}),e.droptarget[0].addEventListener("dragover",function(t){return e.handleDragOver(t)}),e.droptarget[0].addEventListener("dragenter",function(t){return e.handleDragEnter(t)}),e.droptarget[0].addEventListener("dragleave",function(t){return e.handleDragLeave(t)})})},AssetUploaderController.prototype.$onChanges=function(e){if(e.fileReceive){var t=e.fileReceive.currentValue,i=t.payload;if(null!=i)switch(i.type){case"TRANSCRIPT_UPLOAD":var n=i.promises,a=i.files;this.commenseUploads(a,n)}}},AssetUploaderController.prototype.pauseUpload=function(){this.awsSvc.pauseUpload(),this.paused=!0},AssetUploaderController.prototype.resumeUpload=function(){this.awsSvc.resumeUpload(),this.paused=!1},AssetUploaderController.prototype.cancelUpload=function(){this.awsSvc.cancelUpload()},AssetUploaderController.strStartsWith=function(e,t){return 0===e.indexOf(t)},AssetUploaderController.strEndsWith=function(e,t){return e.substring(e.length-t.length,e.length)===t},AssetUploaderController.prototype.handleUploads=function(e){return this.multiple&&(e.length>1||this.uploads.length>0)?(this.errormessage="You may only upload one file at a time here.",!1):this.checkMimeType(e)?this.onFiledrop?void this.onFiledrop({data:e}):void this.commenseUploads(e):void(this.errormessage=this.errorText)},AssetUploaderController.prototype.commenseUploads=function(e,t){var i=this.setupUploadDisplay(e,t),n=i.oldstack,a=i.newstack;this.processUploads(n,a,e)},AssetUploaderController.prototype.setupUploadDisplay=function(e,t){var i=this.uploads.length,n=this.uploads.length+e.length;return this.uploadsinprogress=this.uploadsinprogress+e.length,this.uploadStatus.push({bytesSent:0,bytesTotal:1,percent:0,name:e[0].name}),this.containerId?this.uploads=this.uploads.concat(this.awsSvc.uploadContainerFiles(this.containerId,e)):this.episodeId?this.uploads=this.uploads.concat(t):this.uploads=this.uploads.concat(this.awsSvc.uploadUserFiles(this.appState.user._id,e)),{oldstack:i,newstack:n}},AssetUploaderController.prototype.checkMimeType=function(e){var t=this,i=!1;return Array.from(e).forEach(function(e){var n=e.type;if(t.episodeId){var a=e.name.match(/(vtt|srt)/);a&&a.length&&(n="text/"+a[0])}t.mimeTypesArr.forEach(function(e){if(AssetUploaderController.strEndsWith(e,"*")){var a=e.slice(0,-1);AssetUploaderController.strStartsWith(n,a)&&(i=!0)}else n===e&&(i=!0);t.errorText=n+" uploads are not allowed here."})}),i},AssetUploaderController.prototype.processUploads=function(e,t,i){for(var n=this,a=e;a<t;a+=1)!function(t){n.uploadStatus[t]={bytesSent:0,bytesTotal:1,percent:0,name:i[t-e].name},n.uploads[t].then(function(e){if(n.episodeId&&n.callback)return n.callback({data:e}),n.uploadStatus[t].done=!0,void n.oneDone();n.modelSvc.cache("asset",e.file),n.callback&&n.callback({data:e.file._id}),n.uploadStatus[t].done=!0,n.oneDone()}).catch(function(e){n.uploadStatus[t].error=e}).finally(null,function(e){n.uploadStatus[t].bytesSent=e.bytesSent,n.uploadStatus[t].bytesTotal=e.bytesTotal,n.uploadStatus[t].percent=Math.ceil(e.bytesSent/e.bytesTotal*100)})}(a)},AssetUploaderController.prototype.oneDone=function(){this.uploadsinprogress=this.uploadsinprogress-1,0===this.uploadsinprogress&&(this.fileinput.value="",this.paused=!1)},AssetUploaderController.prototype.handleDrop=function(e){e.preventDefault(),e.stopPropagation(),this.handleDragLeave(e),this.handleUploads(e.dataTransfer.files)},AssetUploaderController.prototype.handleDragOver=function(e){return e.preventDefault(),e.dataTransfer.dropEffect="move",this.handleDragEnter(e),!1},AssetUploaderController.prototype.handleDragEnter=function(e){this.droptarget.addClass("droppable")},AssetUploaderController.prototype.handleDragLeave=function(e){this.droptarget.removeClass("droppable")},AssetUploaderController.$inject=["$timeout","$element","awsSvc","appState","modelSvc","dataSvc"],AssetUploaderController}(),T=function(){function AssetUploader(){this.bindings={containerId:"@?",episodeId:"@?",callback:"&?",onFiledrop:"&?",fileReceive:"<?",mimeTypes:"@?",instructions:"@?",errorText:"@?",multiple:"<?"},this.template=S.a,this.controller=b}return AssetUploader.Name="ittAssetUploader",AssetUploader}(),E=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function __(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)}}(),C=function(){function UIAsset(){}return UIAsset}(),w=(function(){function NpComponentTemplateDirective(){this.restrict="A"}NpComponentTemplateDirective.factory=function(){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(NpComponentTemplateDirective.bind.apply(NpComponentTemplateDirective,[void 0].concat(e)))};return e.$inject=NpComponentTemplateDirective.$inject,e},NpComponentTemplateDirective.$inject=[]}(),function(e){function IStyle(){return null!==e&&e.apply(this,arguments)||this}return E(IStyle,e),IStyle}(C)),I=function(e){function ILayout(){return null!==e&&e.apply(this,arguments)||this}return E(ILayout,e),ILayout}(C),k=(function(){function ITemplateImage(){}}(),function(){function ICssConfiguration(){}return ICssConfiguration}()),P=function(){function IFont(){}return IFont}(),A=function(){function ITemplate(){}return ITemplate}(),x=function(e){function IEpisodeTemplate(){return null!==e&&e.apply(this,arguments)||this}return E(IEpisodeTemplate,e),IEpisodeTemplate}(A),L=function(e){function IItemTemplate(){return null!==e&&e.apply(this,arguments)||this}return E(IItemTemplate,e),IItemTemplate}(A),N=function(e){function ILayoutTemplate(){return null!==e&&e.apply(this,arguments)||this}return E(ILayoutTemplate,e),ILayoutTemplate}(A),U=function(){function IMasterAsset(){}return IMasterAsset}(),M=function(){function IEpisode(){}return Object.defineProperty(IEpisode.prototype,"producerItemType",{get:function(){return"episode"},enumerable:!0,configurable:!0}),IEpisode.prototype.setCurrentScene=function(e){if(this.scenes&&this.scenes.length){var t=this.scenes.indexOf(e),i=this.scenes.slice(0,t),n=this.scenes.slice(t+1);e.setCurrent(),i.length>0&&i.forEach(function(e){return e.setPast()}),n.length>0&&n.forEach(function(e){return e.setFuture()}),this.scenes=i.concat([e],n)}},IEpisode}(),F=function(){function IContainer(){}return IContainer}(),O=function(){function ITimeline(){this.timeline_image_ids=[]}return ITimeline}(),D=(function(e){function ITempTimeline(){return null!==e&&e.apply(this,arguments)||this}E(ITempTimeline,e)}(O),function(){function ICustomer(){}return ICustomer}()),V=function(){function INarrative(){this.narrative_image_ids=[]}return INarrative}(),R=function(){function IAsset(){}return IAsset}(),B=function(){function IEvent(){this.layouts=["inline"],this.renderTemplate=!0}return IEvent.prototype.setFuture=function(){this.state="isFuture",this.isCurrent=!1},IEvent.prototype.setPast=function(){this.state="isPast",this.isCurrent=!1},IEvent.prototype.setCurrent=function(){this.isCurrent=!0,this.state="isCurrent"},IEvent}(),j=function(){function ILinkStatus(){}return ILinkStatus}(),H=function(e){function ILink(){return null!==e&&e.apply(this,arguments)||this}return E(ILink,e),Object.defineProperty(ILink.prototype,"producerItemType",{get:function(){return"link"},enumerable:!0,configurable:!0}),ILink}(B),q=function(e){function IAnnotation(){var t=null!==e&&e.apply(this,arguments)||this;return t.chapter_marker=!1,t}return E(IAnnotation,e),Object.defineProperty(IAnnotation.prototype,"producerItemType",{get:function(){if(this.component_name)return this.component_name===p.TRANSCRIPT_TEMPLATE?"transcript":"annotation"},enumerable:!0,configurable:!0}),IAnnotation}(B),W=function(e){function IBookmark(){return null!==e&&e.apply(this,arguments)||this}return E(IBookmark,e),IBookmark}(B),z=function(e){function IChapter(){return null!==e&&e.apply(this,arguments)||this}return E(IChapter,e),Object.defineProperty(IChapter.prototype,"producerItemType",{get:function(){return"chapter"},enumerable:!0,configurable:!0}),IChapter}(B),K=function(e){function IImage(){return null!==e&&e.apply(this,arguments)||this}return E(IImage,e),IImage}(B),G=(function(){function IPluginData(){}}(),function(e){function IPlugin(){return null!==e&&e.apply(this,arguments)||this}return E(IPlugin,e),Object.defineProperty(IPlugin.prototype,"producerItemType",{get:function(){if(this.component_name&&/question/.test(this.component_name))return"question"},enumerable:!0,configurable:!0}),IPlugin}(B)),Q=function(e){function IScene(){return null!==e&&e.apply(this,arguments)||this}return E(IScene,e),Object.defineProperty(IScene.prototype,"producerItemType",{get:function(){return"scene"},enumerable:!0,configurable:!0}),IScene}(B),X=function(e){function IText(){return null!==e&&e.apply(this,arguments)||this}return E(IText,e),IText}(B),Y=function(e){function IUpload(){return null!==e&&e.apply(this,arguments)||this}return E(IUpload,e),Object.defineProperty(IUpload.prototype,"producerItemType",{get:function(){if(this.component_name)return this.component_name===p.FILE_TEMPLATE?"file":"image"},enumerable:!0,configurable:!0}),IUpload}(B),J=i("Qgv7"),Z=i.n(J),ee=function(){function ContainerController(e,t,i,n,a,r,s){this.$timeout=e,this.$location=t,this.appState=i,this.modelSvc=n,this.dataSvc=a,this.authSvc=r,this.episodeEdit=s,this.containerTypes=["customer","project","module","episode"]}return Object.defineProperty(ContainerController.prototype,"isAdmin",{get:function(){return this.authSvc.userHasRole("admin")},enumerable:!0,configurable:!0}),Object.defineProperty(ContainerController.prototype,"canAccess",{get:function(){return this.isAdmin||this.authSvc.userHasRole("customer admin")},enumerable:!0,configurable:!0}),Object.defineProperty(ContainerController.prototype,"containerType",{get:function(){if(this.depth>0)return capitalize(this.containerTypes[this.depth])},enumerable:!0,configurable:!0}),ContainerController.prototype.$onInit=function(){this.customers=this.modelSvc.getCustomersAsArray()},ContainerController.prototype.toggleNarrativeModal=function(){this.showNarrativeModal=!this.showNarrativeModal},ContainerController.prototype.postNewNarrative=function(e){var t=this,i=e.narrative,n=e.containerId;this.resolvingNarrative=!0,this.dataSvc.generateNewNarrative(n,i).then(function(e){t.modelSvc.cache("narrative",e),t.$location.path("/story/"+e._id),t.resolvingNarrative=!1})},ContainerController.prototype.getLinkStatusReport=function(e){this.dataSvc.getCustomerLinkStatusReportSpreadsheet(e)},ContainerController.prototype.selectText=function(e){e.target.select()},ContainerController.prototype.onToggleChildren=function(e){var t=this.container;this.onContainerClick({$container:{container:t,bool:e}})},ContainerController.prototype.renameContainer=function(){var e=this,t=createInstance("Container",pick(this.container,["_id","customer_id","episodes","keywords","parent_id","sort_order"]));t.name={en:this.container.newContainerName},this.dataSvc.updateContainer(t).then(function(){e.container.editingContainer=!1})},ContainerController.prototype.addContainer=function(e){var t=this,i={customer_id:this.container.customer_id,parent_id:this.container._id,name:{en:angular.copy(this.container.newContainerTitle)}};this.dataSvc.createContainer(i).then(function(i){if(2===t.depth)return t.episodeEdit.addEpisodeToContainer(i).then(function(e){return t.onContainerAdd({$container:e})}).catch(function(e){});t.onContainerAdd({$container:e})}),this.container.newContainerTitle="",this.container.addingContainer=!1,existy(e.showChildren)&&!1!==e.showChildren||this.onToggleChildren(!1)},ContainerController.prototype.deleteContainer=function(){this.onContainerRemove({$container:this.container})},ContainerController.$inject=["$timeout","$location","appState","modelSvc","dataSvc","authSvc","episodeEdit"],ContainerController}(),te=function(){function Container(){this.bindings={container:"<",containers:"<",depth:"<",onContainerClick:"&",onContainerAdd:"&",onContainerRemove:"&"},this.template=Z.a,this.controller=ee}return Container.Name="npContainer",Container}(),ie='\n<div ng-if="$ctrl.context === \'episode\' && $ctrl.userHasRole(\'admin\') || $ctrl.userHasRole(\'customer admin\')">\n  <np-loading ng-if="$ctrl.loading"></np-loading>\n\n  <np-container\n    ng-repeat="child in $ctrl.root.children"\n    depth="0"\n    container="child"\n    containers="$ctrl.modelSvc.containers"\n    on-container-remove="$ctrl.onRequestContainerRemove($container)"\n    on-container-click="$ctrl.onContainerClick($container)"\n    on-container-add="$ctrl.onContainerAdd($container)">\n  </np-container>\n  \n  <np-modal class="modal__center-center" ng-if="$ctrl.containerToDelete != null">\n    <h4>Delete</h4>\n    {{$ctrl.containerToDelete.name.en}}?\n    <div>\n      <button ng-click="$ctrl.removeContainer($ctrl.containerToDelete)">Delete</button>\n      <button ng-click="$ctrl.containerToDelete = null">cancel</button>\n    </div>\n  </np-modal>\n  \n  <div ng-if="$ctrl.showAdmin">\n    Looks like you aren\'t logged in as an admin -- <a ng-click="logout();">try again</a>.\n  </div>\n</div>\n\n\x3c!--for the add timeline modal in /story/:id--\x3e\n<div ng-if="$ctrl.context === \'narrative\'">\n      Choose an episode:\n      <button ng-click="$ctrl.onCancel()">cancel</button>\n      <np-container-episodes\n        ng-repeat="child in $ctrl.root.children"\n        depth="0"\n        on-node-click="$ctrl.selectEpisode(node)"\n        for-admin="true"\n        container="$ctrl.containers[child._id]">\n      </np-container-episodes>\n</div>\n',ne=function(e,t){return void 0===t&&(t=[]),t.push(e._id),e.children&&e.children.length>0&&e.children.forEach(function(e){ne(e,t)}),t},ae=function(){function EpisodeListController(e,t,i,n,a){this.$location=e,this.$timeout=t,this.authSvc=i,this.dataSvc=n,this.modelSvc=a}return Object.defineProperty(EpisodeListController.prototype,"showAdmin",{get:function(){return!(this.userHasRole("admin")||this.userHasRole("customer admin")||!this.loading&&(this.failedLogin||0===this.root.children.length))},enumerable:!0,configurable:!0}),EpisodeListController.prototype.$onInit=function(){var e=this;this.loading=!0,this.containers=this.modelSvc.containers,this.dataSvc.getCustomerList(),this.dataSvc.getContainerRoot().then(function(t){e.root={children:[]},t.forEach(function(t){e.root.children.push(e.modelSvc.containers[t])}),e.walkContainers(e.root.children,!0,!0),e.loading=!1}).catch(function(t){e.failedLogin=!0,e.loading=!1})},EpisodeListController.prototype.selectEpisode=function(e){this.onEpisodeSelect({node:e})},EpisodeListController.prototype.logout=function(){this.authSvc.logout()},EpisodeListController.prototype.userHasRole=function(e){return this.authSvc.userHasRole(e)},EpisodeListController.prototype.onContainerAdd=function(e){this.walkContainers(this.root.children,!e.evenOdd,!1)},EpisodeListController.prototype.onRequestContainerRemove=function(e){this.containerToDelete=e},EpisodeListController.prototype.removeContainer=function(e){var t=this;this.dataSvc.deleteContainer(e._id).then(function(){return t.removeContainerSuccess(e)}).catch(function(e){}).finally(function(){return t.containerToDelete=null})},EpisodeListController.prototype.removeContainerSuccess=function(e){this.modelSvc.containers=omit.apply(void 0,[this.modelSvc.containers].concat(ne(e))),this.walkContainers(this.root.children,!e.evenOdd,!0)},EpisodeListController.prototype.walkContainers=function(e,t,i){var n=this,a=t;return e.sort(function(e,t){return e.name.en.toLowerCase()<t.name.en.toLowerCase()?-1:e.name.en.toLowerCase()>t.name.en.toLowerCase()?1:0}),e.forEach(function(e){var t=n.modelSvc.containers[e._id];null!=t&&(t.evenOdd=a,a=!a,t.isActive&&i&&(n.lastClickedContainer={container:t,bool:!1}),t.showChildren&&t.children&&(a=n.walkContainers(t.children,a,i)))}),a},EpisodeListController.prototype.onContainerClick=function(e){var t=this;e.container.children?(!1===e.bool&&(e.container.showChildren=!e.container.showChildren),this.walkContainers(this.root.children,!0,!1)):this.dataSvc.getContainer(e.container._id).then(function(i){e.container=t.modelSvc.containers[i],!1===e.bool&&(e.container.showChildren=!0),t.walkContainers(t.root.children,!0,!1)}),!0===e.bool&&(existy(this.lastClickedContainer)?this.lastClickedContainer.container!==e.container?(this.lastClickedContainer.container.isActive=!1,this.lastClickedContainer=e,this.lastClickedContainer.container.isActive=!0):this.lastClickedContainer.container.isActive=!this.lastClickedContainer.container.isActive:(this.lastClickedContainer=e,this.lastClickedContainer.container.isActive=!0))},EpisodeListController.$inject=["$location","$timeout","authSvc","dataSvc","modelSvc"],EpisodeListController}(),re=function(){function EpisodeList(){this.bindings={context:"@",onCancel:"&?",onEpisodeSelect:"&?"},this.template=ie,this.controller=ae}return EpisodeList.Name="npEpisodeList",EpisodeList}(),se=i("5Ei1"),oe=i.n(se);i("IiAB");ittUser.$inject=["$q","appState","authSvc","dataSvc","awsSvc","modelSvc","imageResize"];var le='\n\x3c!-- consider breaking these into separate templates altogether, since they have different purposes --\x3e\n\x3c!-- used in narrative creation --\x3e\n<div ng-style="{\'text-indent\': 1 * $ctrl.depth + \'em\'}">\n  <div ng-if="!$ctrl.container.episodes.length"\n      class="container"\n      ng-class="{isOpen: $ctrl.container.wasClicked, isClosed: !$ctrl.container.wasClicked}"\n      ng-click="$ctrl.toggle();$ctrl.loadChildren()"\n      ng-bind-html="$ctrl.container.display_name">\n  </div>\n  <div ng-if="$ctrl.container.episodes.length" ng-style="{\'text-indent\': $ctrl.depth === 3 ? \'4em\' : \'\'}">\n    <span class="hoverIndicator">\n      <a\n        ng-click="$ctrl.onNodeClick({node: $ctrl.container.episodes[0]})"\n        ng-bind-html="$ctrl.containers[$ctrl.container._id].display_name"></a>({{$ctrl.container.status}})\n    </span>\n  </div>\n</div>\n<np-container-episodes\n  ng-if="$ctrl.container.wasClicked"\n  ng-repeat="child in $ctrl.container.children" \n  container="$ctrl.containers[child._id]"\n  for-admin="true"\n  depth="$ctrl.depth + 1"\n  on-node-click="$ctrl.onNodeClick({ node: node })">\n</np-container-episodes>\n',ce=function(){function ContainerEpisodesController(e,t,i){this.modelSvc=e,this.appState=t,this.dataSvc=i}return ContainerEpisodesController.prototype.$onInit=function(){this.containers=this.modelSvc.containers,this.crossEpisodePath=this.appState.crossEpisodePath,this.episodeId=this.appState.episodeId},ContainerEpisodesController.prototype.loadChildren=function(){this.containers[this.container._id].haveNotLoadedChildData&&this.dataSvc.getContainer(this.container._id)},ContainerEpisodesController.prototype.toggle=function(){this.container.wasClicked=!this.container.wasClicked},ContainerEpisodesController.$inject=["modelSvc","appState","dataSvc"],ContainerEpisodesController}(),de=function(){function ContainerEpisodes(){this.bindings={container:"<",forAdmin:"<",depth:"<",onNodeClick:"&"},this.template=le,this.controller=ce}return ContainerEpisodes.Name="npContainerEpisodes",ContainerEpisodes}(),pe='\n<div ng-mouseenter="$ctrl.mouseEvent(true)" ng-mouseleave="$ctrl.mouseEvent(false)">\n\t<span class="pencil__content" ng-transclude></span>\n\t<span style="text-indent: 0">\n\t\t<span class="edit-pencil" ng-click="$ctrl.sendEdit($event)" ng-if="$ctrl.showPencil || $ctrl.force"></span>\n\t</span>\n</div>\n',ue=function(){function EditPencilController(){this.showPencil=!1}return EditPencilController.prototype.sendEdit=function(e){this.showPencil=!1,this.onEdit({$event:e})},EditPencilController.prototype.mouseEvent=function(e){this.canAccess&&(this.showPencil=e)},EditPencilController.$inject=[],EditPencilController}(),me=function(){function EditPencil(){this.transclude=!0,this.bindings={canAccess:"<?",force:"<?",onEdit:"&"},this.template=pe,this.controller=ue}return EditPencil.Name="npEditPencil",EditPencil}(),he='\n<div ng-class="$ctrl.wrapperClass">\n  <div ng-class="$ctrl.modalClass">\n    <ng-transclude></ng-transclude>\n  </div>\n</div>\n',ge=function(){function ModalController(){}return ModalController.prototype.$onInit=function(){null==this.wrapperClass&&(this.wrapperClass="itt__modal")},ModalController}(),ve=function(){function Modal(){this.transclude=!0,this.bindings={modalClass:"@?",wrapperClass:"@?"},this.template=he,this.controller=ge}return Modal.Name="npModal",Modal}(),fe=i("rFfA"),ye=i("5Tuk"),_e='\n<div>\n\t<header class="nav__header">\n\t\t<div class="nav__item">\n\t\t\t<img ng-if="!$ctrl.inPlayer" ng-src="{{::$ctrl.bannerImg}}"/>\n\t\t\t<img ng-if="$ctrl.inPlayer" ng-src="{{::$ctrl.logo}}"/>\n\t\t</div>\n\t\t<div class="nav__item" ng-if="$ctrl.appState.user._id">\n\t\t\t<div class="nav__controls">\n\t\t\t\t<div class="navControls__item item--left">\n\t\t\t\t\t<div class="nav__user" ng-click="$ctrl.goToAccounts()">\n\t\t\t\t\t\t<img ng-src="{{$ctrl.appState.user.avatar || $ctrl.noAvatar}}">\n\t\t\t\t\t\t<a class="nav__button" ng-if="$ctrl.appState.user">{{$ctrl.appState.user.name}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class="nav__button"\n\t\t\t\t\t  ng-if="$ctrl.currentPath !== \'/projects\' && $ctrl.canAccess" href="/#/projects">My Projects</a>\n\t\t\t\t\t<a class="nav__button"\n\t\t\t\t\t  ng-if="$ctrl.currentPath !== \'/stories\' && $ctrl.canAccess" href="/#/stories">My Narratives</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="navControls__item item--right">\n\t\t\t\t\t<a class="nav__button" ng-click="$ctrl.onLogout()">Log out</a>\n\t\t\t\t\t<a class="nav__button" \n\t\t\t\t\t  ng-if="$ctrl.canAccess" target="_blank" rel="noopener noreferrer" href="https://support.narrasys.com">Help</a>\n\t\t\t\t<div>\n\t\t\t</div>\n\t\t</div>\n\t</header>\n</div>\n',Se=function(){function NavController(e,t,i){this.$location=e,this.appState=t,this.authSvc=i,this.bannerImg=fe,this.logo=ye}return Object.defineProperty(NavController.prototype,"currentPath",{get:function(){return this.$location.path()},enumerable:!0,configurable:!0}),Object.defineProperty(NavController.prototype,"noAvatar",{get:function(){return this.appState.noAvatarImg},enumerable:!0,configurable:!0}),NavController.prototype.$onInit=function(){var e=this;this.authSvc.authenticate().then(function(){e.canAccess=e.authSvc.userHasRole("admin")||e.authSvc.userHasRole("customer admin")||e.authSvc.userHasRole("instructor")})},NavController.prototype.goToAccounts=function(){this.canAccess&&this.$location.url("/account")},NavController.$inject=["$location","appState","authSvc"],NavController}(),be=function(){function Nav(){this.bindings={inPlayer:"<?",onLogout:"&?"},this.template=_e,this.controller=Se}return Nav.Name="npNav",Nav}(),Te='\n<span class="ittTooltip" ng-mouseenter="$ctrl.mouseAction(true)" ng-mouseleave="$ctrl.mouseAction(false)">\n\t<ng-transclude></ng-transclude>\n\t<span\n\t  ng-if="$ctrl.showTip" ng-class="$ctrl.css" style="text-indent: 0;">{{$ctrl.tipText}}</span>\n</span>\n',Ee=function(){function TooltipController(){}return TooltipController.prototype.$onInit=function(){null==this.css&&(this.css="ittTooltip__text")},TooltipController.prototype.mouseAction=function(e){this.showTip=e},TooltipController}(),Ce=function(){function Tooltip(){this.transclude=!0,this.bindings={tipText:"@",css:"@?"},this.template=Te,this.controller=Ee}return Tooltip.Name="npTooltip",Tooltip}();ittLogin.$inject=["$location","$routeParams","authSvc","appState","errorSvc"],dataSvc_dataSvc.$inject=["$q","$http","$routeParams","$rootScope","$location","ittUtils","authSvc","appState","modelSvc","errorSvc","mockSvc","questionAnswersSvc","episodeTheme"],modelSvc_modelSvc.$inject=["$filter","$location","ittUtils","appState","playbackService","urlService"];var $e='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\t<div>\n\t\t<sxs-container-assets container-id="{{$ctrl.containerId}}" mime-key="assetLib"></sxs-container-assets>\n\t</div>\n</div>\n',we=function(){function AssetsResolveController(e,t){this.$routeParams=e,this.authSvc=t}return AssetsResolveController.prototype.$onInit=function(){this.containerId=this.$routeParams.containerId},AssetsResolveController.prototype.logout=function(){this.authSvc.logout()},AssetsResolveController.$inject=["$routeParams","authSvc"],AssetsResolveController}(),Ie=function(){function AssetsResolve(){this.bindings={},this.template=$e,this.controller=we}return AssetsResolve.Name="npAssetsResolve",AssetsResolve}(),ke=i("hY+2"),Pe=i.n(ke),Ae=function(){function ErrorNoticeController(e,t,i){this.errorSvc=e,this.appState=t,this.authSvc=i}return Object.defineProperty(ErrorNoticeController.prototype,"user",{get:function(){return this.appState.user},enumerable:!0,configurable:!0}),ErrorNoticeController.prototype.$onInit=function(){},ErrorNoticeController.prototype.logout=function(){this.authSvc.logout()},ErrorNoticeController.prototype.dismiss=function(e){for(var t=0;t<this.errorSvc.errors.length;t+=1)this.errorSvc.errors[t]===e&&(this.errorSvc.errors.splice(t,1),t=this.errorSvc.errors.length);for(var t=0;t<this.errorSvc.notifications.length;t+=1)this.errorSvc.notifications[t]===e&&(this.errorSvc.notifications.splice(t,1),t=this.errorSvc.notifications.length)},ErrorNoticeController.$inject=["errorSvc","appState","authSvc"],ErrorNoticeController}(),xe=function(){function ErrorNotice(){this.bindings={},this.template=Pe.a,this.controller=Ae}return ErrorNotice.Name="npErrorNotice",ErrorNotice}(),Le=(i("0YuG"),angular.module("np.filters",[]).filter("itemLayout",function(){return function(e,t){var i=[];return angular.forEach(e,function(e){e.layouts&&e.layouts[0]===t&&i.push(e)}),i}}).filter("mainCol",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.layouts||"mainBg"!==e.layouts[0]&&"mainFg"!==e.layouts[0]||t.push(e)}),t}}).filter("altCol",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.layouts||"altBg"!==e.layouts[0]&&"altFg"!==e.layouts[0]||t.push(e)}),t}}).filter("annotation",function(){return function(e){var t=[];return angular.forEach(e,function(e){"Annotation"!==e._type||e.component_name.match(/(transmedia|definition)/)||t.push(e)}),t}}).filter("transmedia",function(){return function(e){var t=[];return angular.forEach(e,function(e){("Annotation"!==e._type||e.component_name.match(/(transmedia|definition)/))&&t.push(e)}),t}}).filter("transcript",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isTranscript&&t.push(e)}),t}}).filter("isCurrent",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isCurrent&&t.push(e)}),t}}).filter("isContent",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isContent&&t.push(e)}),t}}).filter("reviewMode",["appState",function(e){return function(t){var i=[],n="producer"===e.product;return angular.forEach(t,function(e){(n||!e.cosmetic&&(e.isContent||e.layouts.indexOf("windowFg")>-1))&&i.push(e)}),i}}]).filter("transcriptandrequired",function(){return function(e){var t=[];return angular.forEach(e,function(e){(e.isTranscript||e.required)&&t.push(e)}),t}}).filter("transcriptandoptional",function(){return function(e){var t=[];return angular.forEach(e,function(e){(e.isTranscript||!e.isTranscript&&!e.required)&&t.push(e)}),t}}).filter("required",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.isTranscript&&e.required&&t.push(e)}),t}}).filter("optional",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isTranscript||e.required||t.push(e)}),t}}).filter("highlightSubstring",function(){return function(e,t){if(e)return t||angular.isNumber(t)?e.toString().replace(new RegExp(t.toString(),"gi"),'<span class="ui-match">$&</span>'):e}}).filter("pretty",function(){return function(e){return JSON.stringify(e,void 0,2)}}).filter("i18n",["appState",function(e){return function(t){return t?"object"==typeof t?t[e.lang]||t.en||"":t:""}}]).filter("asBytes",function(){return function(e){if(!e)return"";var t=Math.floor(e/1024);return t<1024?t+"Kb":Math.floor(t/10.24)/100+"Mb"}}).filter("asPercent",function(){return function(e){return isNaN(e)?Math.floor(100*e)+"%":"0%"}}).filter("stripParams",function(){return function(e){return e.substr(0,e.indexOf("?"))}}).filter("asTime",function(){return function(e){return isNaN(e)?"0:00":e<0?"0:00":Math.floor(e/60)+":"+("0"+Math.floor(e)%60).slice(-2)}}).filter("alpha",function(){return function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[e%26]}}).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLocaleLowerCase():""}}).filter("vidsFromCustAdmins",function(){return function(e){var t=[];return angular.forEach(e,function(e){/video/.test(e.content_type)||t.push(e)}),t}}).filter("langDisplay",["ittUtils",function(e){var t=e.existy,i={en:"English",es:"Spanish",zh:"Chinese",pt:"Portuguese",fr:"French",de:"German",it:"Latin"};return function(e){return t(e)?i[e]:""}}]).filter("slugify",["ittUtils",function(e){return function(t){return e.existy(t)?e.slugify(t):""}}]).filter("tagName",[function(){var e=(t={},t.social_image_square="Square",t.social_image_wide="Wide",t);return function(t){if(t&&e.hasOwnProperty(t))return e[t]};var t}]),'\n<div class="loading">\n\t<div class="spinner">\n\t\t<div class="rotating pie"></div>\n\t\t<div class="filler pie"></div>\n\t\t<div class="mask"></div>\n\t</div>\n\tLoading\n</div>\n\n'),Ne=function(){function Loading(){this.template=Le}return Loading.Name="npLoading",Loading}(),Ue=function(){function DynamicEventTemplate(e){this.$compile=e,this.restrict="A"}return DynamicEventTemplate.factory=function(){var e=function(e){return new DynamicEventTemplate(e)};return e.$inject=DynamicEventTemplate.$inject,e},DynamicEventTemplate.prototype.link=function(e,t,i){var n="<span np-"+i.componentName+"-template></span>",a=this.$compile(n)(e);t.append(a)},DynamicEventTemplate.Name="npDynamicEventTemplate",DynamicEventTemplate.$inject=["$compile"],DynamicEventTemplate}(),Me=i("olHH"),Fe=i.n(Me),Oe=function(){function AuthTemplate(){this.restrict="EA",this.template=Fe.a,this.scope=!0}return AuthTemplate.factory=function(){return function(){return new AuthTemplate}},AuthTemplate.Name="npAuthTemplate",AuthTemplate}(),De=i("1tPm"),Ve=i.n(De),Re=function(){function Error404Template(){this.restrict="EA",this.template=Ve.a,this.scope=!0}return Error404Template.factory=function(){return function(){return new Error404Template}},Error404Template.Name="npError404Template",Error404Template}(),Be=i("wI96"),je=i.n(Be),He=function(){function RootTemplate(){this.restrict="EA",this.template=je.a,this.scope=!0}return RootTemplate.factory=function(){return function(){return new RootTemplate}},RootTemplate.Name="npRootTemplate",RootTemplate}(),qe=i("cKYu"),We=i.n(qe),ze=function(){function SxsContainerAssetsController(e,t,i,n,a,r){this.$q=e,this.dataSvc=t,this.modelSvc=i,this.awsSvc=n,this.appState=a,this.authSvc=r}return SxsContainerAssetsController.prototype.$onInit=function(){var e=this;this.$q(function(t,i){e.modelSvc.containers[e.containerId]?(e.container=e.modelSvc.containers[e.containerId],e.container.assetsHaveLoaded?t():e.dataSvc.getContainerAssets(e.containerId).then(t)):e.dataSvc.getContainer(e.containerId).then(function(){e.container=e.modelSvc.containers[e.containerId],e.dataSvc.getContainerAssets(e.containerId).then(t)})}).then(function(t){"narrative"===e.context?e.assets=Object.keys(e.modelSvc.assets).reduce(function(t,i){var n=e.modelSvc.assets[i];return(n.tags&&"social_image_square"===n.tags[0]||"social_image_wide"===n.tags[0])&&(t[i]=n),t},{}):e.assets=e.modelSvc.assets,e.isCustAdmin=e.authSvc.userHasRole("customer admin"),e.isAdmin=e.authSvc.userHasRole("admin"),e.canAccess=e.isCustAdmin||e.isAdmin,m[e.mimeKey]?(e.mimes=m[e.mimeKey],e.isAdmin&&(e.mimes+=",video/*")):e.mimes=m.default})},SxsContainerAssetsController.prototype.up=function(){this.showParent=!0},SxsContainerAssetsController.prototype.toggleImages=function(){this.onlyImages=!this.onlyImages},SxsContainerAssetsController.prototype.toggleGrid=function(){this.gridView=!this.gridView},SxsContainerAssetsController.prototype.assetClick=function(e){this.onAssetSelect({$assetId:e})},SxsContainerAssetsController.prototype.requestDeleteAsset=function(e,t){t.stopPropagation(),this.assetToDelete=e},SxsContainerAssetsController.prototype.deleteAsset=function(e){var t=this;this.dataSvc.deleteAsset(e).then(function(){t.assets=omit(t.assets,e),t.modelSvc.assets=omit(t.modelSvc.assets,e)}).catch(function(e){}).finally(function(){return t.assetToDelete=null})},SxsContainerAssetsController.$inject=["$q","dataSvc","modelSvc","awsSvc","appState","authSvc"],SxsContainerAssetsController}(),Ke=function(){function SxsContainerAssets(){this.bindings={containerId:"@",mimeKey:"@?",context:"@?",onAssetSelect:"&?"},this.template=We.a,this.controller=ze}return SxsContainerAssets.Name="sxsContainerAssets",SxsContainerAssets}(),Ge=angular.module("np.shared",["np.filters"]);[Oe,Re,He].forEach(function(e){Ge.directive(e.Name,e.factory())}),Ge.service(l.Name,l).service(g.Name,g).service(h.Name,h).service(d.Name,d).service("authSvc",authSvc_authSvc).service(c.Name,c).service("dataSvc",dataSvc_dataSvc).factory("mockSvc",mockSvc_mockSvc).service("modelSvc",modelSvc_modelSvc).factory("ittUtils",ittUtils_ittUtils).component(Ke.Name,new Ke).component(T.Name,new T).component(te.Name,new te).component(re.Name,new re).directive("ittUser",ittUser).component(de.Name,new de).component(me.Name,new me).component(ve.Name,new ve).component(be.Name,new be).directive("ittRouteLoading",ittRouteLoading).component(Ce.Name,new Ce).directive("ittValidationTip",ittValidationTip).directive("ittFilesHandler",ittFilesHandler).directive("ittLogin",ittLogin).directive(Ue.Name,Ue.factory()).component(Ne.Name,new Ne).component(Ie.Name,new Ie).component(xe.Name,new xe);var Qe='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\n\t<h1>Projects</h1>\n  <np-episode-list class="np-container" context="episode"></np-episode-list>\n</div>\n',Xe=function(){function ProjectsContainerController(e){this.authSvc=e}return ProjectsContainerController.prototype.$onInit=function(){},ProjectsContainerController.prototype.logout=function(){this.authSvc.logout()},ProjectsContainerController.$inject=["authSvc"],ProjectsContainerController}(),Ye=function(){function ProjectsContainer(){this.template=Qe,this.controller=Xe}return ProjectsContainer.Name="npProjectsContainer",ProjectsContainer}(),Je=angular.module("np.projects",[]);[Ye].forEach(function(e){Je.component(e.Name,new e)});var Ze='\n<div ng-if="$ctrl.narrative.enable_social_sharing" class="socialshare-filedrop">\n\n  <div ng-repeat="(tag, imgObj) in $ctrl.images" ng-class="\'itt-filedrop__\' + tag">\n    <itt-filedrop\n      on-error="$ctrl.display[tag].error"\n      on-drop="$ctrl.handleImage(files, tag)">\n      \n      <itt-filedrop-target>\n        <div class="itt-filedrop__wrapper" ng-if="imgObj.path == null">\n          <span class="itt-filedrop__placeholder --default-image-opacity" ng-class="tag + \'--default\'"></span>\n        </div>\n      </itt-filedrop-target>\n\n      <itt-filedrop-preview>\n        <div ng-if="imgObj.path">\n          <div class="socialshare__img">\n            <itt-upload-progress upload="$ctrl.uploadsService.uploadsDisplay[tag]"></itt-upload-progress>\n            <img\n              ng-class="{\n                \'--drop-error\': $ctrl.display[tag].error,\n                \'--default-image-opacity\': $ctrl.display[tag].defaultFromNarrative\n              }"\n              ng-src="{{imgObj.path}}"/>\n          </div>\n        </div>\n      </itt-filedrop-preview> \n\n    </itt-filedrop> \n    <div>{{$ctrl.display[tag].text}}</div>\n  </div>\n\n  \x3c!--begin social controls--\x3e\n  <div class="socialshare__controls">\n    <button\n      ng-disabled="$ctrl.isUsingDefaultImages()"\n      ng-click="$ctrl.resetImgs()">\n      {{$ctrl.isUsingDefaultImages() ? \'Default images in use\' : \'Use default images\'}}\n    </button>\n    <button ng-click="$ctrl.toggleBrowseUploaded()">Browse uploaded</button>\n    <label class="button" for="fileBtn">Upload new</label>\n\n    <input id="fileBtn" type="file" accept="image/*" itt-files-handler on-selected="$ctrl.handleImage(files)"/>\n  </div>\n  \x3c!--end social controls--\x3e\n\n  \x3c!--begin browse uploaded--\x3e\n  <np-modal wrapper-class="responsive-modal__wrapper" modal-class="narrative__modal" ng-if="$ctrl.browseUploaded">\n    <div class="scrollContainer">\n      <sxs-container-assets\n        container-id="{{$ctrl.containerId}}"\n        on-asset-select="$ctrl.uploadedAssetSelected($assetId)"\n        context="narrative">\n      </sxs-container-assets>\n    </div>\n    <div class="controlsContainer">\n      <button ng-click="$ctrl.toggleBrowseUploaded()">Cancel</button>\n    </div>\n  </np-modal>\n  \x3c!--end browse uploaded--\x3e\n</div>\n',et={social_image_square:"Recommend 576 x 576",social_image_wide:"Recommend 1200 x 630"},tt={social_image_square:{file:null,path:null},social_image_wide:{file:null,path:null}},it={social_image_square:{text:et.social_image_square,error:!1,defaultFromNarrative:!1},social_image_wide:{text:et.social_image_wide,error:!1,defaultFromNarrative:!1}},nt=function(){function EnableSocialshareController(e,t,i,n,a,r){this.$q=e,this.$timeout=t,this.uploadsService=i,this.imageResize=n,this.dataSvc=a,this.modelSvc=r,this.browseUploaded=!1,this.files={social_image_square:{file:null},social_image_wide:{file:null}}}return EnableSocialshareController.prototype.$onInit=function(){null==this.timeline?this.type="narrative":this.type="timeline",this.model=this[this.type],this.setInitialDisplay(),this.fetchAssetsOnInit()},EnableSocialshareController.prototype.resetImgs=function(){var e=this;if("timeline"===this.type)return this.narrative.narrative_image_ids&&2===this.narrative.narrative_image_ids.length?this.narrative.narrative_image_ids.forEach(function(t){var i=e.modelSvc.assets[t],n=i.tags[0];e.images[n]={assetId:i._id,path:i.url},e.display[n].defaultFromNarrative=!0}):this.setInitialDisplay(),void(this.timeline.timeline_image_ids=[]);this.narrative.narrative_image_ids=[],this.images=Object.assign({},tt)},EnableSocialshareController.prototype.isUsingDefaultImages=function(){var e=!0===this.display.social_image_square.defaultFromNarrative&&!0===this.display.social_image_wide.defaultFromNarrative,t=null==this.images.social_image_square.path&&null==this.images.social_image_wide.path;return e||t},EnableSocialshareController.prototype.toggleBrowseUploaded=function(){this.browseUploaded=!this.browseUploaded},EnableSocialshareController.prototype.uploadedAssetSelected=function(e){var t=this.modelSvc.assets[e];this.setImageFromAsset(t,!1),this.browseUploaded=!1},EnableSocialshareController.prototype.handleImage=function(e,t){var i=this;this.checkAspectRatio(e[0]).then(function(n){var a=n.images,r=n.tag;if(null!=t&&t!==r)return i.$q.reject({currTag:t,tag:r,errorType:"TAG_MISMATCH"});i.files[r].file=e,i.images=Object.assign({},i.images,a),i.model[r]={file:e},i.setValidity()}).catch(function(e){return i.handleTagmismatchError(e.errorType,e.currTag,e.tag)})},EnableSocialshareController.prototype.setInitialDisplay=function(){this.display=angular.copy(it),this.images=angular.copy(tt)},EnableSocialshareController.prototype.fetchAssetsOnInit=function(){"narrative"===this.type&&this.fetchNarrativeImageAssets(),"timeline"===this.type&&this.fetchImageAssetsTimeline()},EnableSocialshareController.prototype.fetchNarrativeImageAssets=function(){this.narrative&&this.narrative.narrative_image_ids&&this.narrative.narrative_image_ids.length>0&&this.getImageAssets("narrative").then(function(){})},EnableSocialshareController.prototype.fetchImageAssetsTimeline=function(){var e=this,t={narrative:[],timeline:[]};this.timeline.timeline_image_ids&&this.timeline.timeline_image_ids.length>0?(t.timeline=this.timeline.timeline_image_ids.slice(),t.use="timeline"):t.use="narrative",this.narrative.narrative_image_ids&&this.narrative.narrative_image_ids.length>0&&(t.narrative=this.narrative.narrative_image_ids.slice());var i=t.narrative.concat(t.timeline),n=i.reduce(function(t,i){return e.modelSvc.assets[i]||t.push(i),t},[]),a=function(){t[t.use].forEach(function(i){e.setImageFromAsset(e.modelSvc.assets[i],"narrative"===t.use)})};n.length>0?this.dataSvc.fetchAndCacheAssetsByIds(n).then(a):a()},EnableSocialshareController.prototype.getImageAssets=function(e,t){var i=this;return void 0===t&&(t=!1),this.$q(function(n){var a=[];return i[e][e+"_image_ids"].forEach(function(e){e&&i.modelSvc.assets[e]?i.setImageFromAsset(i.modelSvc.assets[e],t):a.push(e)}),a.length>0&&i.dataSvc.fetchAndCacheAssetsByIds(a).then(function(e){return e.forEach(function(e){return i.setImageFromAsset(e,t)}),n()}),n()})},EnableSocialshareController.prototype.handleTagmismatchError=function(e,t,i){var n=this;this.display[t].error=!0,this.display[t].text="The aspect ratio is not correct.",this.$timeout(function(){n.display[t].error=!1,n.display[t].text=et[t]},3e3)},EnableSocialshareController.prototype.checkAspectRatio=function(e){var t=this;return this.imageResize.readFileToImg(e).then(function(i){var n=t.imageResize.getImageTagType(i.width,i.height);return{images:(a={},a[n]={name:e.name,path:i.src},a),tag:n};var a})},EnableSocialshareController.prototype.setImageFromAsset=function(e,t){void 0===t&&(t=!1);var i=e.tags[0],n=this.images[i];if(this.images[i]={assetId:e._id,path:e.url},this.display[i].defaultFromNarrative=!1,t)return this.display[i].defaultFromNarrative=!0,void this.setValidity();n&&n.assetId&&this.removeImageId(n.assetId),this.addImageId(e._id),this.setValidity()},EnableSocialshareController.prototype.setValidity=function(){var e=this.images,t=e.social_image_square,i=e.social_image_wide,n=this.display.social_image_square.defaultFromNarrative!==this.display.social_image_wide.defaultFromNarrative,a="string"==typeof t.path&&"string"==typeof i.path,r=null==t.path&&null==i.path,s=!n&&(a||r);this.editorForm.$setValidity(this.editorForm.$name,s,this.editorForm)},EnableSocialshareController.prototype.removeImageId=function(e){this.model[this.type+"_image_ids"]=this.model[this.type+"_image_ids"].filter(function(t){return e!==t})},EnableSocialshareController.prototype.addImageId=function(e){this.model[this.type+"_image_ids"].includes(e)||this.model[this.type+"_image_ids"].push(e)},EnableSocialshareController.$inject=["$q","$timeout","uploadsService","imageResize","dataSvc","modelSvc"],EnableSocialshareController}(),at=function(){function EnableSocialshare(){this.bindings={containerId:"@?",narrative:"<",timeline:"<?",editorForm:"<"},this.template=Ze,this.controller=nt}return EnableSocialshare.Name="ittEnableSocialshare",EnableSocialshare}(),rt='\n<div ng-if="!$ctrl.clipboardMode">\n  <div ng-if="$ctrl.narrative.guest_access_allowed === true">\n    <label for="{{$ctrl.display.id[$ctrl.type]}}">Guest Accessible URL:\n      <itt-validation-tip ng-if="$ctrl[$ctrl.type].error" text="{{$ctrl[$ctrl.type].error}}"></itt-validation-tip>\n      <p class="--break-word">\n        <small ng-class="{ \'error-red\': $ctrl[$ctrl.type].error, unselectable: $ctrl[$ctrl.type].error }">\n          {{$ctrl.formatGuestAccessibleUrl()}}\n        </small>\n      </p>\n    </label>\n    <input\n      id="{{$ctrl.display.id[$ctrl.type]}}"\n      type="text"\n      name="path"\n      placeholder="{{$ctrl.display.placeholder}}"\n      np-valid-path-slug\n      narrative-id="{{$ctrl.narrative._id}}"\n      ng-model="$ctrl[$ctrl.type].path_slug.en">\n  </div>\n</div>\n<np-clipboard\n  ng-if="$ctrl.clipboardMode"\n  source-text="{{$ctrl.formatUrlToCopy()}}"\n  on-copy="$event.stopPropagation()">\n</np-clipboard>\n',st=function(){function GuestAccessibleUrlController(){this.protocol="https://",this.domain=".narrasys.com/"}return GuestAccessibleUrlController.prototype.$onInit=function(){this.type=existy(this.timeline)?"timeline":"narrative",this.display={id:{timeline:"tlPath",narrative:"nPath"},placeholder:"human-friendly-link-to "+this.type};var e=existy(this.subDomain)&&this.subDomain||existy(this.narrative.narrative_subdomain)&&this.narrative.narrative_subdomain;this.pathPrefix=this.protocol+e+this.domain},GuestAccessibleUrlController.prototype.formatLTIUrl=function(){if(existy(this.narrative))return"timeline"===this.type?this.pathPrefix+"auth/lti?narrative="+this.narrative._id+"&timeline="+this.timeline._id:this.pathPrefix+"auth/lti?narrative="+this.narrative._id},GuestAccessibleUrlController.prototype.formatGuestAccessibleUrl=function(){var e=existy(this.narrative),t=e&&existy(this.narrative.path_slug)&&existy(this.narrative.path_slug.en),i=existy(this.timeline),n=i&&existy(this.timeline.path_slug)&&existy(this.timeline.path_slug.en);return"timeline"===this.type&&n?this.pathPrefix+"#/story/"+this.narrative.path_slug.en+"/"+slugify(this.timeline.path_slug.en):t?this.pathPrefix+"#/story/"+slugify(this.narrative.path_slug.en):void 0},GuestAccessibleUrlController.prototype.formatUrlToCopy=function(){return existy(this.narrative)&&!1===this.narrative.guest_access_allowed?this.formatLTIUrl():this.formatGuestAccessibleUrl()},GuestAccessibleUrlController.$inject=[],GuestAccessibleUrlController}(),ot=function(){function GuestAccessibleUrl(){this.bindings={narrative:"<",timeline:"<?",customer:"<?",clipboardMode:"@?",subDomain:"@?"},this.template=rt,this.controller=st}return GuestAccessibleUrl.Name="npGuestAccessibleUrl",GuestAccessibleUrl}(),lt=i("wZyx"),ct=i.n(lt),dt=function(){function SocialShareController(e,t){this.Socialshare=e,this.dataSvc=t,this.stubUrl="https://thecareerplaybook.narrasys.com/narratives/jim-citrin",this.expanded=!1,this.emailshareExpanded=!1,this.textCopied=!1,this.email={}}return SocialShareController.prototype.$onInit=function(){this.subdomain&&this.paths&&this.paths.narrative&&this.paths.timeline&&(this.stubUrl=SocialShareController.formatShareUrl(this.subdomain,this.paths.narrative,this.paths.timeline.url))},SocialShareController.prototype.onShare=function(e){var t={provider:e,attrs:{}};switch(e){case"email":return void this.toggleEmailshare();case"linkedin":case"twitter":case"reddit":Object.assign(t.attrs,{socialshareText:this.shareTitle},{socialshareUrl:this.stubUrl});break;default:Object.assign(t.attrs,{socialshareUrl:this.stubUrl})}this.Socialshare.share(t),this.closeAll()},SocialShareController.prototype.toggleExpanded=function(){this.expanded=!this.expanded,this.textCopied=!1,this.emailshareExpanded=!1},SocialShareController.prototype.ontextCopied=function(e){this.textCopied=!0},SocialShareController.prototype.handleEmailShare=function(e,t){var i=this;if(t.$invalid)return void t.$error.required.forEach(function(e){e.$setTouched()});this.dataSvc.sendSocialshareEmail(this.paths.timeline.id,e).then(function(e){return i.closeAll()}).catch(function(e){})},SocialShareController.formatShareUrl=function(e,t,i){return"https://"+e+".narrasys.com/narratives/"+t+"/"+i},SocialShareController.prototype.closeAll=function(){this.expanded=!1,this.textCopied=!1,this.emailshareExpanded=!1},SocialShareController.prototype.toggleEmailshare=function(){this.emailshareExpanded=!this.emailshareExpanded},SocialShareController.$inject=["Socialshare","dataSvc"],SocialShareController}(),pt=function(){function SocialShare(){this.bindings={providers:"<",subdomain:"@",shareTitle:"@",paths:"<"},this.template=ct.a,this.controller=dt}return SocialShare.Name="ittSocialShare",SocialShare}(),ut='\n<np-tooltip tip-text="{{$ctrl.tipText}}" ng-click="$ctrl.bubbleEvent($event)">\n   <a class="icon__button" ng-class="$ctrl.light ? \'button__clipboard--light\' : \'button__clipboard\'"></a>\n</np-tooltip>\n',mt=function(){function ClipboardController(e){this.$timeout=e}return ClipboardController.copyText=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},ClipboardController.prototype.$onInit=function(){null==this.tipText&&(this.tipText="Click to copy URL"),this._defaultText=this.tipText},ClipboardController.prototype.bubbleEvent=function(e){var t=this;ClipboardController.copyText(this.sourceText),this.onCopy({$event:e}),null==this.customNotice&&(this.tipText="Copied",this.$timeout(function(){t.tipText=t._defaultText},1500))},ClipboardController.$inject=["$timeout"],ClipboardController}(),ht=function(){function Clipboard(){this.transclude=!0,this.bindings={sourceText:"@",tipText:"@?",light:"<?",customNotice:"<?",onCopy:"&"},this.template=ut,this.controller=mt}return Clipboard.Name="npClipboard",Clipboard}(),gt='\n<div class="itt-filedrop itt-filedrop--border" ng-class="{\'--drop-error\': $ctrl.onError}"> \n  <div ng-transclude="target"></div>\n  \n   <div class="itt-filedrop__wrapper" ng-if="$ctrl.onError">\n    <span class="itt-filedrop__placeholder --drop-error"></span>\n   </div>\n  \n  <div ng-if="!$ctrl.error" ng-transclude="preview"></div>\n</div>\n',vt=function(){function FiledropController(e){this.$element=e}return FiledropController.prototype.$postLink=function(){this.attachListeners()},FiledropController.prototype.$onDestroy=function(){this.removeListeners()},FiledropController.prototype.attachListeners=function(){var e=this;this.$element[0].addEventListener("drop",function(t){return e.handleDrop(t)}),this.$element[0].addEventListener("dragover",function(t){return e.handleDragOver(t)}),this.$element[0].addEventListener("dragenter",function(t){return e.handleDragEnter(t)}),this.$element[0].addEventListener("dragleave",function(t){return e.handleDragLeave(t)})},FiledropController.prototype.removeListeners=function(){var e=this;this.$element[0].removeEventListener("drop",function(t){return e.handleDrop(t)}),this.$element[0].removeEventListener("dragover",function(t){return e.handleDragOver(t)}),this.$element[0].removeEventListener("dragenter",function(t){return e.handleDragEnter(t)}),this.$element[0].removeEventListener("dragleave",function(t){return e.handleDragLeave(t)})},FiledropController.prototype.handleDrop=function(e){e.preventDefault(),e.stopPropagation(),this.handleDragLeave(e),this.onDrop({files:e.dataTransfer.files})},FiledropController.prototype.handleDragOver=function(e){return e.preventDefault(),e.dataTransfer.dropEffect="move",this.handleDragEnter(e),!1},FiledropController.prototype.handleDragEnter=function(e){this.$element.children().addClass("itt-filedrop--droppable")},FiledropController.prototype.handleDragLeave=function(e){this.$element.children().removeClass("itt-filedrop--droppable")},FiledropController.$inject=["$element"],FiledropController}(),ft=function(){function Filedrop(){this.transclude={target:"ittFiledropTarget",preview:"ittFiledropPreview"},this.bindings={onError:"<",onDrop:"&"},this.template=gt,this.controller=vt}return Filedrop.Name="ittFiledrop",Filedrop}(),yt='\n\n<div class="upload-progress" ng-if="$ctrl.upload != null">\n  <h5>{{$ctrl.upload.name}} - {{$ctrl.upload.percent}}%</h5>\n  <progress\n    ng-attr-max="{{$ctrl.upload.bytesTotal}}"\n    ng-attr-value="{{$ctrl.upload.bytesSent}}">\n  </progress>\n</div>\n\n',_t=function(){function UploadProgress(){this.bindings={upload:"<"},this.template=yt}return UploadProgress.Name="ittUploadProgress",UploadProgress}(),St='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n  <np-loading ng-if="$ctrl.narrative == null && $ctrl.customers == null"></np-loading>\n  <np-narrative-detail\n    ng-if="$ctrl.narrative && $ctrl.customers"\n    class="np-narrative-container"\n    narrative="$ctrl.narrative"\n    customers="$ctrl.customers">\n  </np-narrative-detail> \n</div>\n',bt=function(){function NarrativeContainerController(e,t,i,n,a){this.$q=e,this.$routeParams=t,this.modelSvc=i,this.dataSvc=n,this.authSvc=a}return NarrativeContainerController.prototype.$onInit=function(){var e=this;this._resolveNarrative().then(function(t){var i=t.n,n=t.c;e.narrative=i,e.customers=n})},NarrativeContainerController.prototype.logout=function(){this.authSvc.logout()},NarrativeContainerController.prototype._resolveNarrative=function(){var e,t=this,i=this.$routeParams.narrativePath,n=this.modelSvc.getNarrativeByPathOrId(i);return existy(n)&&existy(n.path_slug)&&existy(n.timelines)&&(n.path_slug.en===i||n._id===i)?(e=this.modelSvc.customers[n.customer_id],this.$q.resolve({n:n,c:[e]})):this.dataSvc.getNarrative(i).then(function(e){return t.dataSvc.getCustomer(e.customer_id,!0).then(function(t){return{n:e,c:[t]}})})},NarrativeContainerController.$inject=["$q","$routeParams","modelSvc","dataSvc","authSvc"],NarrativeContainerController}(),Tt=function(){function NarrativeContainer(){this.template=St,this.controller=bt}return NarrativeContainer.Name="npNarrativeContainer",NarrativeContainer}(),Et=i("qMue"),Ct=i.n(Et),$t=function(){function NarrativeDetailController(e,t,i,n,a){var r=this;this.$routeParams=e,this.authSvc=t,this.appState=i,this.dataSvc=n,this.modelSvc=a,this.treeOpts={accept:function(){return!0},dropped:function(e){var t=e.dest.index;t!==e.source.index&&(r.narrative.timelines=NarrativeDetailController._updateSortOrder(t,r.narrative.timelines),r._persistTimelineSortUpdate(r.narrative.timelines[t]))}}}return NarrativeDetailController.prototype.$onInit=function(){this.isOwner=!1,this.user=this.appState.user,(this.authSvc.userHasRole("admin")||this.authSvc.userHasRole("customer admin"))&&(this.canAccess=!0),this._setTotalNarrativeDuration(this.narrative.timelines)},NarrativeDetailController.prototype.logout=function(){this.authSvc.logout()},NarrativeDetailController.prototype.toggleEditNarrativeModal=function(e){var t=this;existy(this.customers[0])&&existy(this.customers[0].narratives)&&this.customers[0].narratives.length>1?this.editingNarrative=!this.editingNarrative:this.dataSvc.getNarrativeList(this.customers[0]).then(function(){t.editingNarrative=!t.editingNarrative}),null!=e&&(this.narrative=e)},NarrativeDetailController.prototype.toggleEditingTimeline=function(e){this.timelineUnderEdit=e},NarrativeDetailController.prototype.doneEditingTimeline=function(){var e=this;this.timelineUnderEdit=null,this.narrative.timelines=this.narrative.timelines.filter(function(t){return t!==e.tmpTimeline}),this.tmpTimeline=null},NarrativeDetailController.prototype.toggleOwnership=function(){this.isOwner=!this.isOwner},NarrativeDetailController.prototype.toggleEpisodeList=function(){this.showEpisodeList=!this.showEpisodeList},NarrativeDetailController.prototype.updateNarrative=function(e){var t=this;this.dataSvc.updateNarrative(e).then(function(e){t.editingNarrative=!1,angular.extend(t.narrative,e.data);var i=t.modelSvc.customers[e.data.customer_id];t.modelSvc.assocNarrativesWithCustomer(i,[e.data])})},NarrativeDetailController.prototype.updateTimeline=function(e,t){var i=this;this.dataSvc.storeTimeline(this.narrative._id,e).then(function(e){angular.extend(t,e),i.doneEditingTimeline()})},NarrativeDetailController.prototype.addTmpTimeline=function(e,t){var i,n,a,r,s;existy(e)?(r=t.indexOf(e),s=r+1,n=t[r],i=n.sort_order,t.slice(-1)[0]===n?i+=100:(a=t[r+1].sort_order,i=bitwiseCeil((a+i)/2))):(i=0,s=0);var o=createInstance("Timeline",{name:{en:""},description:{en:""},hidden:!1,sort_order:i,isTemp:!0,index:s}),l=t.slice(0,s),c=t.slice(s,t.length);l.push(o),this.narrative.timelines=l.concat(c),this.tmpTimeline=o,this.toggleEpisodeList()},NarrativeDetailController.prototype.onEpisodeSelect=function(e){var t=this;this.dataSvc.getEpisodeOverview(e).then(function(e){return t.tmpTimeline.parent_episode=e,existy(e.description)&&(t.tmpTimeline.description.en=stripHtmlTags(e.description.en)),t.tmpTimeline.name.en=stripHtmlTags(e.title.en),e}).then(function(e){t.dataSvc.getSingleAsset(e.master_asset_id).then(function(e){t.tmpTimeline.duration=e?e.duration:0,t.toggleEpisodeList(),t.persistTmpTimeline(t.tmpTimeline)})})},NarrativeDetailController.prototype.persistTmpTimeline=function(e){var t=this;this.narrative.timelines=NarrativeDetailController._updateSortOrder(e.index,this.narrative.timelines);var i=function(i){return t.dataSvc.storeTimeline(t.narrative._id,e).then(function(e){return{d:e,e:i}})},n=function(i){var n=i.d,a=i.e;t.dataSvc.createEpisodeSegment(n._id,{episode_id:a._id,start_time:0,end_time:e.duration,sort_order:0,timeline_id:n._id}).then(function(e){n.episode_segments=[e],angular.forEach(t.narrative.timelines,function(e){e.sort_order===n.sort_order&&angular.extend(e,n,{isTemp:!1})}),t.tmpTimeline=null,t.doneEditingTimeline(),t._setTotalNarrativeDuration(t.narrative.timelines)})},a=function(e){};this.dataSvc.createChildEpisode({parent_id:e.parent_episode._id}).then(i).then(n).catch(a)},NarrativeDetailController.prototype.editorAction=function(e,t){!0===e.isTemp?this.persistTmpTimeline(e):this.updateTimeline(e,t)},NarrativeDetailController.prototype.deleteTimeline=function(e){var t=this;this.dataSvc.deleteTimeline(e._id).then(function(){t.narrative.timelines=t.narrative.timelines.filter(function(t){return e._id!==t._id}),t.doneEditingTimeline(),t._setTotalNarrativeDuration(t.narrative.timelines)})},NarrativeDetailController.prototype.exportToSpreadsheet=function(e){this.dataSvc.getNarrativeExportAsSpreadsheet(e)},NarrativeDetailController._updateSortOrder=function(e,t){var i=t.slice(),n=i.length,a=0;e>0&&(a=e===n-1?i[e-1].sort_order+100:bitwiseCeil((i[e-1].sort_order+i[e+1].sort_order)/2));var r=a;i[e].sort_order=a;var s=e+1;for(a+=1;s<n;s+=1)r>=i[s].sort_order&&(i[s].sort_order=a),r=a,a+=1;return i},NarrativeDetailController.prototype._setTotalNarrativeDuration=function(e){this.totalNarrativeDuration=e.map(function(e){return e.episode_segments.map(function(e){return e.end_time})[0]}).reduce(function(e,t){return e+t},0)},NarrativeDetailController.prototype._persistTimelineSortUpdate=function(e){this.dataSvc.storeTimeline(this.narrative._id,e).then(function(t){angular.extend(e,t)})},NarrativeDetailController.$inject=["$routeParams","authSvc","appState","dataSvc","modelSvc"],NarrativeDetailController}(),wt=function(){function NarrativeDetail(){this.bindings={narrative:"<",customers:"<"},this.template=Ct.a,this.controller=$t}return NarrativeDetail.Name="npNarrativeDetail",NarrativeDetail}(),It='\n<div class="narrative__edit">\n  <h2>Narrative Settings</h2>\n  <form name="nEditForm">\n    <div ng-show="$ctrl.containerInfo && $ctrl.canAccess">\n      <label for="nCustomer">Customer\n        <itt-validation-tip ng-if="nEditForm.customer.$invalid" text="A customer must be set"></itt-validation-tip>\n      </label>\n      <select id="nCustomer" name="customer" required ng-model="$ctrl.selectedCustomer"\n              ng-change="$ctrl.selectCustomer($ctrl.selectedCustomer)"\n              ng-options="cust.name for cust in $ctrl.customers track by cust._id"></select></br>\n    </div>\n    <div ng-if="$ctrl.selectedCustomer && $ctrl.containerInfo == null">\n      <h5>{{$ctrl.selectedCustomer.name}}</h5>\n    </div>\n    <label id="nName">Narrative Title\n      <itt-validation-tip ng-if="nEditForm.name.$invalid" text="Title is required"></itt-validation-tip>\n    </label>\n    <input for="nName" type="text" name="name" placeholder="Add Narrative Title"\n           ng-model="$ctrl.narrative.name.en" required>\n    <label for="nDescription">Description</label>\n    <textarea id="nDescription" name="description" placeholder="Add a Description"\n              ng-model="$ctrl.narrative.description.en"></textarea>\n    <div ng-if="!$ctrl.hidePathSlug">\n      <np-guest-accessible-url\n        narrative="$ctrl.narrative"\n        sub-domain="{{$ctrl.narrative.narrative_subdomain}}"\n        customer="$ctrl.selectedCustomer">\n      </np-guest-accessible-url>\n    </div>\n    <label for="nSupportUrl">Support Url\n      <itt-validation-tip ng-if="nEditForm.supportUrl.$invalid" text="Not a valid URL"></itt-validation-tip>\n    </label>\n    <input id="nSupportUrl" type="text" name="supportUrl" np-valid-url placeholder="link for support"\n           ng-model="$ctrl.narrative.support_url"/>\n    <div class="narrative-flags">\n      <div>\n        <input id="nNewWindow" type="checkbox" ng-model="$ctrl.narrative.disable_new_window"/>\n        <label for="nNewWindow">Disable New Window</label>\n      </div>\n      <div>\n        <input id="nDisableNav" type="checkbox" ng-model="$ctrl.narrative.disable_navigation"/>\n        <label for="nDisableNav">Disable Navigation</label>\n      </div>\n      <div>\n        <input\n          id="nGuestAccess"\n          type="checkbox"\n          ng-change="$ctrl.guestAccessEffects()"\n          ng-model="$ctrl.narrative.guest_access_allowed"/>\n        <label for="nGuestAccess">Enable Guest Access</label>\n      </div>\n      <div ng-if="$ctrl.trueAdmin && $ctrl.narrative._id">\n        <input\n          id="socialshare-checkbox"\n          type="checkbox"\n          ng-disabled="$ctrl.narrative.disableSocialshare"\n          ng-model="$ctrl.narrative.enable_social_sharing"/>\n        <label for="socialshare-checkbox">Enable Socialshare</label>\n      </div>\n    </div>\n    <itt-enable-socialshare\n      ng-if="$ctrl.trueAdmin && $ctrl.narrative._id"\n      container-id="{{$ctrl.selectedCustomer.root_container_id}}"\n      editor-form="nEditForm"\n      narrative="$ctrl.narrative">\n    </itt-enable-socialshare>\n    <div class="ancillaryNav">\n      <button class="done" ng-click="$ctrl.handleUpdate($ctrl.narrative)"\n              ng-disabled="nEditForm.$invalid || $ctrl.narrative.error">Save\n      </button>\n      <button class="done" ng-click="$ctrl.cancel()">Cancel</button>\n    </div>\n  </form>\n</div>\n',kt=function(){function NarrativeEditorController(e,t){this.authSvc=e,this.uploadsService=t}return NarrativeEditorController.prototype.$onInit=function(){this.narrative&&(null==this.narrative.social_image_square&&null==this.narrative.social_image_wide||(this.narrative.social_image_wide=null,this.narrative.social_image_square=null)),this._narrative=angular.copy(this.narrative),this._setNameFromContainer(),this._setCustomer(),this.guestAccessEffects()},NarrativeEditorController.prototype.cancel=function(){this.narrative=angular.copy(this._narrative),this.onDone({$undo:this.narrative})},NarrativeEditorController.prototype.trueAdmin=function(){return this.authSvc.userHasRole("admin")},NarrativeEditorController.prototype.canAccess=function(){return this.trueAdmin()||this.authSvc.userHasRole("customer admin")},NarrativeEditorController.prototype.guestAccessEffects=function(){null!=this.narrative&&(!1===this.narrative.guest_access_allowed?(this.narrative.enable_social_sharing=!1,this.narrative.disableSocialshare=!0):this.narrative.disableSocialshare=!1)},NarrativeEditorController.prototype.selectCustomer=function(e){this.selectedCustomer=e},NarrativeEditorController.prototype.handleUpdate=function(e){var t=this;existy(this.selectedCustomer)&&(e.customer_id=this.selectedCustomer._id);var i=["name","description","customer_id","guest_access_allowed","enable_social_sharing","narrative_image_ids","path_slug","support_url","disable_navigation","disable_new_window","_id"],n=createInstance("Narrative",pick(e,i)),a=[];if(e.social_image_square&&a.push({file:e.social_image_square.file,tag:"social_image_square"}),e.social_image_wide&&a.push({file:e.social_image_wide.file,tag:"social_image_wide"}),a.length>0)this.uploadsService.uploadTaggedFiles(a,this.selectedCustomer.root_container_id).then(function(e){e.forEach(function(e){return n.narrative_image_ids.push(e.file._id)}),t.uploadsService.resetUploads(),t.onUpdate({$narrative:n})});else if(existy(this.containerInfo)){var r=this.containerInfo.containerId;this.onUpdate({$data:{narrative:n,containerId:r}})}else this.onUpdate({$narrative:n})},NarrativeEditorController.prototype._setNameFromContainer=function(){existy(this.containerInfo)&&(existy(this.narrative)?this.narrative.name=this.containerInfo.name:this.narrative={name:this.containerInfo.name})},NarrativeEditorController.prototype._setCustomer=function(){if(this.customers&&1===this.customers.length)this.selectCustomer(this.customers[0]);else if(existy(this.narrative)||existy(this.containerInfo)){var e=existy(this.containerInfo)&&this.containerInfo.customerId||this.narrative.customer_id;this.selectCustomer(this.customers.filter(function(t){return t._id===e})[0])}else this.customers.unshift({name:"Select a Customer"})},NarrativeEditorController.$inject=["authSvc","uploadsService"],NarrativeEditorController}(),Pt=function(){function NarrativeEditor(){this.bindings={narrative:"<?",customers:"<",containerInfo:"<?",hidePathSlug:"<?",onDone:"&",onUpdate:"&"},this.template=It,this.controller=kt}return NarrativeEditor.Name="npNarrativeEditor",NarrativeEditor}(),At=i("2AAL"),xt=i.n(At),Lt=function(){function NarrativeListController(e,t,i,n,a){this.$location=e,this.authSvc=t,this.appState=i,this.dataSvc=n,this.modelSvc=a,this.narrativeSelect=!1,this.user=null,this.canAccess=!1}return NarrativeListController.prototype.$onInit=function(){this.user=this.appState.user,(this.authSvc.userHasRole("admin")||this.authSvc.userHasRole("customer admin"))&&(this.canAccess=!0),this._updateAllEvenOdd()},NarrativeListController.prototype.logout=function(){this.authSvc.logout()},NarrativeListController.prototype.setSelectedNarrative=function(e){var t=this,i=existy(e.narratives)&&e.narratives.length>1;this.selectedCustomer=[e],i?this.narrativeSelect=!this.narrativeSelect:this.dataSvc.getNarrativeList(e).then(function(){t.narrativeSelect=!t.narrativeSelect})},NarrativeListController.prototype.customerRowClick=function(e,t){t.stopPropagation(),e.isActive=!e.isActive,this.narrativeRow=null,this.customersData.forEach(function(t){e._id!==t._id&&(t.isActive=!1)})},NarrativeListController.prototype.gotoNarrative=function(e,t){t.stopPropagation(),this.$location.path("/story/"+e)},NarrativeListController.prototype.toggleRow=function(e,t){t.stopPropagation(),e.showNarratives=!e.showNarratives,e.showNarratives?this._toggleNarrativesOpened(e):(e.showNarratives=!1,this._toggleNarrativesClosed())},NarrativeListController.prototype.setRowClasses=function(e){return{hoverIndicator:!e.showNarratives,"container__row--even":!1===e.evenOdd,"container__row--odd":!0===e.evenOdd,isActive:e.isActive}},NarrativeListController.prototype.setNarrativeRowClasses=function(e,t){return{hoverIndicator:e.showNarratives,"container__row--even":!1===t.evenOdd,"container__row--odd":!0===t.evenOdd,isActive:t===this.narrativeRow}},NarrativeListController.prototype.setNarrativeToEdit=function(e,t,i){e.stopPropagation(),this.narrativeToEdit=t,this.selectedCustomer=[i]},NarrativeListController.prototype.closeAddOrEditModal=function(e,t){if(this.narrativeSelect=!1,this.selectedCustomer=[],this.narrativeToEdit=null,e&&t)return void this.$location.path("/story/"+e._id);if(e)for(var i=0;i<this.customersData.length;i+=1)if(this.customersData[i]._id===e.customer_id)for(var n=0;n<this.customersData[i].narratives.length;n+=1)if(this.customersData[i].narratives[n]._id===e._id){this.customersData[i].narratives[n]=e;break}},NarrativeListController.prototype.addOrUpdateNarrative=function(e){var t=this,i=null==e._id?"createNarrative":"updateNarrative";this._addOrUpdateNarr(e,i).then(function(e){return t.closeAddOrEditModal(e,!0)}).catch(function(e){return t._handleErr(e)})},NarrativeListController.prototype.toggleNarrativeRow=function(e,t){t.stopPropagation(),null===this.narrativeRow?this.narrativeRow=e:e===this.narrativeRow?this.narrativeRow=null:this.narrativeRow=e,this.customersData.forEach(function(e){e.isActive=!1})},NarrativeListController.prototype._toggleNarrativesOpened=function(e){existy(e.narratives)&&0!==e.narratives.length||this._fetchAndCacheNarratives(e),existy(e.narratives)&&e.narratives.length>=1&&this._updateAllEvenOdd()},NarrativeListController.prototype._fetchAndCacheNarratives=function(e){var t=this;this.dataSvc.getNarrativeList(e).then(function(){t._updateAllEvenOdd()})},NarrativeListController.prototype._updateAllEvenOdd=function(){for(var e=1,t=this.customersData.length;e<=t;e+=1){e-1==0&&(this.customersData[0].evenOdd=!1);var i=this.customersData[e],n=this.customersData[e-1],a=null;if(existy(n.narratives)&&n.narratives.length>0&&!0===n.showNarratives&&(this._updateNarrativeEvenOdd(n),a=n.narratives[n.narratives.length-1]),!existy(i))return;existy(a)?i.evenOdd=!a.evenOdd:i.evenOdd=!n.evenOdd}},NarrativeListController.prototype._updateNarrativeEvenOdd=function(e){e.narratives=e.narratives.sort(function(e,t){var i=e.name.en.toLowerCase(),n=t.name.en.toLowerCase();return i<n?-1:i>n?1:0}).reduce(function(t,i,n){return 0===n?(i.evenOdd=!e.evenOdd,t.push(i),t):(i.evenOdd=!t[n-1].evenOdd,t.push(i),t)},[])},NarrativeListController.prototype._toggleNarrativesClosed=function(){this._updateAllEvenOdd()},NarrativeListController.prototype._addOrUpdateNarr=function(e,t){var i=this;return this.dataSvc[t](e).then(function(e){var n=e.data,a=i.modelSvc.customers[n.customer_id];a=i.modelSvc.assocNarrativesWithCustomer(a,[n]);var r=i.customersData.filter(function(e){return e._id===a._id});if(1===r.length&&(i._updateNarrativeEvenOdd(a),r[0]=a,"createNarrative"===t))return n})},NarrativeListController.prototype._handleErr=function(e){e.data.path_slug&&(this.narrativeToEdit.error="path slug is already taken")},NarrativeListController.$inject=["$location","authSvc","appState","dataSvc","modelSvc","ittUtils"],NarrativeListController}(),Nt=function(){function NarrativeList(){this.bindings={customersData:"<"},this.template=xt.a,this.controller=Lt}return NarrativeList.Name="npNarrativeList",NarrativeList}(),Ut='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\t<h1>Narratives</h1>\n\t<np-loading ng-if="$ctrl.customersData == null"></np-loading>\n\t<np-narrative-list\n\t  ng-if="$ctrl.customersData"\n\t  class="np-narrative-container"\n\t  customers-data="$ctrl.customersData">\n\t</np-narrative-list>\n</div>\n',Mt=function(){function NarrativesContainerController(e,t,i,n){this.$q=e,this.authSvc=t,this.dataSvc=i,this.modelSvc=n}return NarrativesContainerController.prototype.$onInit=function(){var e=this;this._resolveCustomers().then(function(t){return e.customersData=e.modelSvc.getCustomersAsArray()})},NarrativesContainerController.prototype.logout=function(){this.authSvc.logout()},NarrativesContainerController.prototype._resolveCustomers=function(){var e=this,t=this.modelSvc.getCustomersAsArray();return Object.keys(t).length>0?this.$q.resolve(t):this.authSvc.authenticate().then(function(){return e.dataSvc.getCustomerList()}).then(function(e){return e})},NarrativesContainerController.$inject=["$q","authSvc","dataSvc","modelSvc"],NarrativesContainerController}(),Ft=function(){function NarrativesContainer(){this.bindings={},this.template=Ut,this.controller=Mt}return NarrativesContainer.Name="npNarrativesContainer",NarrativesContainer}(),Ot='\n<div class="timeline__edit">\n  <form name="tlEditForm">\n    <label for="tlName">Name\n      <itt-validation-tip ng-if="tlEditForm.name.$invalid" text="Name is required"></itt-validation-tip>\n    </label>\n    <input type="text" name="name" ng-model="$ctrl._timeline.name.en" id="tlName" required>\n    <label for="tlDescription">Description</label>\n    <textarea id="tlDescription" name="description" placeholder="Insert Description..."\n              ng-model="$ctrl._timeline.description.en"></textarea>\n    <np-guest-accessible-url narrative="$ctrl.narrative" timeline="$ctrl._timeline"></np-guest-accessible-url>\n    <label>Hidden</label>\n    <input type="checkbox" ng-model="$ctrl._timeline.hidden"/>\n    <itt-enable-socialshare\n      ng-if="$ctrl.trueAdmin"\n      narrative="$ctrl.narrative"\n      container-id="{{$ctrl.containerId}}"\n      editor-form="tlEditForm"\n      timeline="$ctrl._timeline">\n    </itt-enable-socialshare>\n    <div class="ancillaryNav">\n      <button class="button" ng-disabled="tlEditForm.$invalid || $ctrl._timeline.error"\n              ng-click="$ctrl.handleUpdate($ctrl._timeline)">Save\n      </button>\n      <button class="button" ng-click="$ctrl.confirmDelete()">Delete</button>\n      <button class="button" ng-click="$ctrl.onDone()">Cancel</button>\n    </div>\n  </form>\n</div>\n<np-modal modal-class="modal__center-center" ng-if="$ctrl.underDelete">\n  <h2>Are you sure?</h2>\n  <p>delete: </p>\n  <p class="under__delete"><strong>{{$ctrl._timeline.name.en}}?</strong></p>\n  <button ng-click="$ctrl.onDelete({ $timeline: $ctrl._timeline })">yes</button>\n  <button ng-click="$ctrl.underDelete = false">no</button>\n</np-modal>\n',Dt=function(){function TimelineEditorController(e,t,i){this.$location=e,this.uploadsService=t,this.authSvc=i,this.underDelete=!1}return TimelineEditorController.prototype.$onInit=function(){this.host=this.$location.protocol()+":"+r.apiDataBaseUrl,this.trueAdmin=this.authSvc.userHasRole("admin"),existy(this.timeline)&&!0===this.timeline.isTemp?this._timeline=this.timeline:this._timeline=angular.copy(this.timeline)},TimelineEditorController.prototype.handleUpdate=function(e){var t=this,i=["_id","name","description","hidden","sort_order","path_slug","episode_segments","timeline_image_ids"],n=pick(e,i),a=[];e.social_image_square&&a.push({file:e.social_image_square.file,tag:"social_image_square"}),e.social_image_wide&&a.push({file:e.social_image_wide.file,tag:"social_image_wide"}),a.length>0?this.uploadsService.uploadTaggedFiles(a,this.containerId).then(function(e){e.forEach(function(e){return n.timeline_image_ids.push(e.file._id)}),t.uploadsService.resetUploads(),t.onUpdate({$timeline:n})}):this.onUpdate({$timeline:n})},TimelineEditorController.prototype.confirmDelete=function(){this.underDelete=!0},TimelineEditorController.$inject=["$location","uploadsService","authSvc"],TimelineEditorController}(),Vt=function(){function TimelineEditor(){this.bindings={timeline:"<",narrative:"<",containerId:"@?",onUpdate:"&",onDelete:"&",onDone:"&"},this.template=Ot,this.controller=Dt}return TimelineEditor.Name="npTimelineEditor",TimelineEditor}(),Rt=angular.module("np.stories",[]);[at,ot,pt,ht,ft,_t,Tt,wt,Pt,Nt,Ft,Vt].forEach(function(e){Rt.component(e.Name,new e)});var Bt=function(){function AnalyticsService(e,t,i,n,a,r){this.$q=e,this.$http=t,this.$routeParams=i,this.$interval=n,this.appState=a,this.playbackService=r,this.activityQueue=[],this.pollLength=1e4}return AnalyticsService.prototype.startPolling=function(){var e=this;this.pollInterval=this.$interval(function(){return e.flushActivityQueue()},this.pollLength)},AnalyticsService.prototype.stopPolling=function(){this.flushActivityQueue(),this.$interval.cancel(this.pollInterval)},AnalyticsService.prototype.captureEpisodeActivity=function(e,t){if(!this.appState.user||!this.appState.user._id||this.appState.user.track_episode_metrics){var i={name:e,walltime:new Date,timestamp:this.playbackService.getMetaProp("time")||0};t&&(i.data=t),this.activityQueue.push(i)}},AnalyticsService.prototype.captureEventActivity=function(e,t,i,n){!n&&(r.disableAnalytics||this.appState.user._id&&!this.appState.user.track_event_actions)||this.activityQueue.push({name:e,event_id:t,walltime:new Date,data:i})},AnalyticsService.prototype.readEpisodeActivity=function(e){return this.$http.get(r.apiDataBaseUrl+"/v2/episodes/"+e+"/episode_user_metrics").then(function(e){return e}).catch(function(e){})},AnalyticsService.prototype.readEventActivity=function(e,t){return this.$http.get(r.apiDataBaseUrl+"/v2/events/"+e+"/event_user_actions").then(function(e){return e.data}).then(function(e){if(!t)return e;for(var i=0;i<e.length;i++){if(e[i].name===t)return!0}})},AnalyticsService.prototype.forceCaptureEventActivityWithPromise=function(e,t,i){return this.captureEventActivity(e,t,i,!0),this.flushActivityQueue()},AnalyticsService.prototype.flushActivityQueue=function(){var e=this;return this.$q(function(t){if(0===e.activityQueue.length)return t("");e.appState.episodeId||t();var i=angular.copy(e.activityQueue);e.activityQueue=[];var n=new Date,a=[],s=[];angular.forEach(i,function(e){e.age=(+n-+e.walltime)/1e3,delete e.walltime,e.event_id?s.push(e):a.push(e)}),a=e.dejitter(a);var o=[];if(s.length>0){var l=r.apiDataBaseUrl+"/v2/episodes/"+e.appState.episodeId+"/event_user_actions";o.push(e.$http.post(l,{event_user_actions:s}))}return a.length>0&&o.push(e.$http.post(r.apiDataBaseUrl+"/v2/episodes/"+e.appState.episodeId+"/episode_user_metrics",{episode_user_metrics:a})),e.$q.all(o).then(function(e){return t(e)})})},AnalyticsService.prototype.dejitter=function(e){if(0===e.length)return[];for(var t=[],i=0;i<e.length-1;i++){var n=e[i],a=e[i+1];"seek"===n.name&&"seek"===a.name&&n.timestamp===a.data.seekStart?a.data.seekStart=n.data.seekStart:t.push(e[i])}return t.push(e[e.length-1]),t},AnalyticsService.Name="analyticsSvc",AnalyticsService.$inject=["$q","$http","$routeParams","$interval","appState","playbackService"],AnalyticsService}(),jt=function(){function ValidationService(e,t,i,n,a,r){this.$http=e,this.$location=t,this.$q=i,this.authSvc=n,this.ittUtils=a,this.urlService=r}return ValidationService.parseCSP=function(e){if(null!=e)return e.split(";").reduce(function(e,t){var i=t.trim().split(/\s+/g),n=i.shift();return n&&(e[n]=i),e},{})},ValidationService.prototype.checkXFrameOpts=function(e){var t=this,i=encodeURIComponent(e);return this.SANE_GET("/x_frame_options_proxy?url="+i).then(function(e){return t.handleSuccess(e)}).then(function(i){return t.canEmbed(i,e)}).catch(function(e){return ValidationService.handleErrors(e)})},ValidationService.prototype.urlIsEmbeddable=function(e,t){var i=this.xFrameHeaderCanEmbed(e,t.x_frame_options),n=this.cspCanEmbed(e,t.content_security_policy);return i&&n},ValidationService.prototype.mixedContent=function(e,t){return this.mixedContentUrl(e)?(t.validatedFields.mixedContent={message:"Mixed Content Detected",showInfo:!0},!0):(t.validatedFields.mixedContent={message:"",showInfo:!1},!1)},ValidationService.prototype.mixedContentUrl=function(e){return this.ittUtils.existy(e)&&/^http:\/\//.test(e)},ValidationService.prototype.validateUrl=function(e,t){var i=this.urlService.isVideoUrl(e)||this.ittUtils.isValidURL(e)||ValidationService.emailOrPlaceholder(e);return""!==e||ValidationService.emailOrPlaceholder(e)?i?(t.validatedFields.url={showInfo:!1},!0):(t.validatedFields.url={showInfo:!0,message:e+" is not a valid URL"},!1):(t.validatedFields.url={showInfo:!0,message:"Url cannot be blank"},!1)},ValidationService.prototype.inspectHeadersAsync=function(e,t,i,n){var a=this;return null!=i?this.$q(function(n){var r={canEmbed:a.urlIsEmbeddable(e,i),location:i.location,urlStatus:{content_security_policy:i.content_security_policy,x_frame_options:i.x_frame_options,response_code:i.response_code,err:i.err}};return n(a.handleXframeOptsObj(e,r,t))}):""===e||this.urlService.isVideoUrl(e)||ValidationService.emailOrPlaceholder(e)?this.$q(function(i){t.validatedFields.iframeHeaders={showInfo:!1};var n={canEmbed:!0,location:null,urlStatus:{content_security_policy:null,x_frame_options:null,response_code:null,err:null}};return"kaltura"===a.urlService.checkUrl(e).type&&(n.location=a.urlService.parseInput(e)),i(n)}):this.checkXFrameOpts(e).then(function(i){return a.handleXframeOptsObj(e,i,t)})},ValidationService.emailOrPlaceholder=function(e){return/mailto:/.test(e)||"https://"===e},ValidationService.handleErrors=function(e){return{canEmbed:!1}},ValidationService.prototype.cspCanEmbed=function(e,t){if(null==t)return!0;var i=ValidationService.parseCSP(t),n=i["frame-ancestors"];if(null==n||0===n.length)return!0;var a=this.$location.host();if(1===n.length){var r=n[0];if("'self'"===r&&e.includes(a)||r.includes(a))return!0;if("'none'"===r)return!1}for(var s=0,o=n;s<o.length;s++){if(o[s].includes(a))return!0}return!1},ValidationService.prototype.xFrameHeaderCanEmbed=function(e,t){var i=!1;if(null==t||"null"===t)return!0;switch(!0){case/SAMEORIGIN/i.test(t):var n=this.$location.host(),a=document.createElement("a");a.href=e,n===a.hostname&&(i=!0);break;case/ALLOW-FROM/i.test(t):var r=t.split(",");n=this.$location.host(),angular.forEach(r,function(e){var t=e.trim().split(" ")[1],a=document.createElement("a");a.href=t,n===a.hostname&&(i=!0)});break;case/DENY/i.test(t):}return i},ValidationService.prototype.handleXframeOptsObj=function(e,t,i){var n="";return this.ittUtils.existy(t.location)&&(n=e+" redirected to "+t.location,i.validatedFields[301]={showInfo:!0,message:n,doInfo:!0}),this.ittUtils.existy(t.urlStatus.response_code)&&422===t.urlStatus.response_code?(n=e+" cannot be found",i.validatedFields[404]={showInfo:!0,message:n},this.$q.reject("404")):(null!=t.urlStatus.err&&999!==t.urlStatus.response_code?i.validatedFields.iframeHeaders={showInfo:!0,message:e+" cannot be embedded: "+t.urlStatus.err}:t.canEmbed||this.mixedContentUrl(e)?i.validatedFields.iframeHeaders={showInfo:!1}:(n="Embedded link template is disabled because "+e+" does not allow iframing",t.location&&(n+=". "+i.validatedFields[301].message,i.validatedFields[301]={}),i.validatedFields.iframeHeaders={showInfo:!0,message:n,doInfo:!0}),t)},ValidationService.prototype.handleSuccess=function(e){return this.ittUtils.existy(e.x_frame_options)&&(e.x_frame_options=e.x_frame_options.toUpperCase()),e},ValidationService.prototype.canEmbed=function(e,t){var i={content_security_policy:e.content_security_policy,x_frame_options:e.x_frame_options,err:e.err,response_code:e.response_code},n=Object.create(null),a=e.location;return 999===e.response_code?n.canEmbed=!1:n.canEmbed=this.urlIsEmbeddable(t,e),Object.assign(n,{location:a},{urlStatus:i}),n},ValidationService.prototype.SANE_GET=function(e){var t=this;return this.authSvc.authenticate().then(function(){return t.$http.get(r.apiDataBaseUrl+e).then(function(e){return e.data})})},ValidationService.Name="validationSvc",ValidationService.$inject=["$http","$location","$q","authSvc","ittUtils","urlService"],ValidationService}(),Ht=function(){function SelectService(e,t,i,n){this.authSvc=e,this.modelSvc=t,this.dataSvc=i,this.ittUtils=n,this._userHasRole=this.authSvc.userHasRole,this._existy=this.ittUtils.existy,this._langOpts=[{value:"en",name:"English",isDisabled:!1},{value:"es",name:"Spanish",isDisabled:!1},{value:"zh",name:"Chinese",isDisabled:!1},{value:"pt",name:"Portuguese",isDisabled:!1},{value:"fr",name:"French",isDisabled:!1},{value:"de",name:"German",isDisabled:!1},{value:"it",name:"Italian",isDisabled:!1}],this._select={video:[],display:[],imagePosition:[],imagePin:[],questionType:[],language:this._langOpts},this._visibility={templateSelect:!0,imageUpload:!1,display:!1,videoPosition:!1,bgImagePosition:!1,titleField:!0,speakerField:!0},this._scenes={centered:p.CENTERED_TEMPLATE,centeredPro:p.CENTERED_PRO_TEMPLATE,"1col":p.ONECOL_TEMPLATE,mirroredTwoCol:p.MIRRORED_TWOCOL_TEMPLATE,cornerV:p.CORNER_V_TEMPLATE,centerVV:p.CENTER_VV_TEMPLATE,centerVVMondrian:p.CENTER_VV_MONDRIAN_TEMPLATE,cornerH:p.CORNER_H_TEMPLATE,pip:p.PIP_TEMPLATE},this._bgImageTitles={windowBg:"Full window background",videoOverlay:"Video overlay (16:9)",textBg:"Text pane background",textFg:"Text pane foreground",transmediaBg:"Transmedia pane background",transmediaFg:"Transmedia pane foreground"},this._D1={a:{value:"showCurrent",name:"show only current transmedia items"},b:{value:"",name:"Show all transmedia items, highlight current ones"}},this._D2={a:{value:"showCurrent",name:"Show only current text items"},b:{value:"",name:"Show all text items, highlight current ones"}},this._D3={a:{value:"showCurrent",name:"Show only current items"},b:{value:"",name:"Show all items, highlight current ones"}},this._imageFieldVisibility=this._partialVis("imageUpload"),this._displaySelectVisibility=this._partialVis("display"),this._videoPositionSelectVisibility=this._partialVis("videoPosition"),this._titleFieldVisibility=this._partialVis("titleField"),this._speakerFieldVisibility=this._partialVis("speakerField"),this._templateSelectVisibility=this._partialVis("templateSelect"),this._bgImagePositionSelectVisibility=this._partialVis("bgImagePosition")}return SelectService.prototype._setVisibility=function(e,t){this._visibility[e]=t},SelectService.prototype._partialVis=function(e){return function(t){return this._setVisibility(e,t)}},SelectService.prototype._setAvailableImageOptsForLayout=function(e,t,i){var n="inline"===t.layouts[0];switch(-1!==t.layouts.indexOf("videoOverlay")&&(this._bgImagePositionSelectVisibility(!1),i.position="fill"),e){case"centeredPro":this._displaySelectVisibility(!0),this._videoPositionSelectVisibility(!0),this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!1},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!0},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!0},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!0},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!0}],n&&(t.layouts=["windowBg"]),t.layouts=t.layouts||["windowBg"],i.position=i.position||"fill";break;case"1col":case"centered":var a=this._userHasRole("admin");this._displaySelectVisibility(!0),this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!1},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!a},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!a},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!0},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!0}],n&&(t.layouts=["windowBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["windowBg"];break;case"mirroredTwoCol":this._displaySelectVisibility(!0),this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!1},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!1},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!1},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!1},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!1}],n&&(t.layouts=["mainBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["mainBg"];break;case"cornerV":case"centerVV":case"cornerH":this._displaySelectVisibility(!0),this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!1},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!1},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!1},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!1},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!1}],n&&(t.layouts=["altBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["altBg"];break;case"pip":this._displaySelectVisibility(!0),this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!0},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!0},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!0},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!1},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!1}],n&&(t.layouts=["altBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["altBg"];break;case"centerVVMondrian":this._select.display=[{value:"windowBg",name:this._bgImageTitles.windowBg,isDisabled:!0},{value:"videoOverlay",name:this._bgImageTitles.videoOverlay,isDisabled:!1},{value:"mainBg",name:this._bgImageTitles.textBg,isDisabled:!1},{value:"mainFg",name:this._bgImageTitles.textFg,isDisabled:!1},{value:"altBg",name:this._bgImageTitles.transmediaBg,isDisabled:!0},{value:"altFg",name:this._bgImageTitles.transmediaFg,isDisabled:!0}],n&&(t.layouts=["mainBg"]),t.layouts=t.layouts||["mainBg"],i.position=i.position||"fill"}i.position&&(t.styles=[i.position])},SelectService.prototype.getSceneName=function(e){return Object.keys(this._scenes).filter(function(t){return this._scenes[t]===e.component_name})[0]},SelectService.prototype.getSelectOpts=function(e){return this._select[e]},SelectService.prototype.getVisibility=function(e){return this._visibility[e]},SelectService.prototype.setupItemForm=function(e,t){var i={transition:"",highlight:"",color:"",typography:"",timestamp:""},n={position:""};if("item"===t&&(i=angular.extend(n,i)),!this._existy(e))return i;for(var a in i)for(var r=0;r<e.length;r++)e[r].substr(0,a.length)===a&&(i[a]=e[r].substr(a.length));if("episode"===t)return i;for(var s=0;s<e.length;s++)"contain"!==e[s]&&"cover"!==e[s]&&"center"!==e[s]&&"fill"!==e[s]&&"tl"!==e[s]&&"tr"!==e[s]&&"bl"!==e[s]&&"br"!==e[s]||(i.position=e[s]);return i},SelectService.prototype.handleEpisodeItemFormUpdates=function(e){return Object.keys(e).reduce(function(t,i){return e[i]&&t.push(i+e[i]),t},[])},SelectService.prototype.handleEventItemFormUpdate=function(e){return Object.keys(e).reduce(function(t,i){return e[i]&&("position"===i?t.push(e[i]):t.push(i+e[i])),t},[])},SelectService.prototype.getTemplates=function(e,t){var i=this,n=function(e){return e.reduce(function(e,t){var n=i.modelSvc.readDataCache("template","component_name",t.component_name);return null!=n&&(Object.assign(t,{template_id:n.id,name:n.displayName}),e.push(t)),e},[])};switch(e){case"episode":var a=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0};return this._titleFieldVisibility(!0),this.dataSvc.getEpisodeTemplatesByCustomerIds(t).sort(a);case"scene":this._displaySelectVisibility(!1),this._videoPositionSelectVisibility(!1),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1);return n([{component_name:this._scenes.centered},{component_name:this._scenes.centeredPro},{component_name:this._scenes["1col"]},{component_name:this._scenes.cornerV},{component_name:this._scenes.mirroredTwoCol},{component_name:this._scenes.centerVV},{component_name:this._scenes.centerVVMondrian},{component_name:this._scenes.cornerH},{component_name:this._scenes.pip}]);case"transcript":return this._speakerFieldVisibility(!0),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1),n([{component_name:p.TRANSCRIPT_TEMPLATE}]);case"annotation":this._speakerFieldVisibility(!1),this._titleFieldVisibility(!1),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1);return n([{component_name:p.HEADER_ONE_TEMPLATE},{component_name:p.HEADER_TWO_TEMPLATE},{component_name:p.PULLQUOTE_TEMPLATE},{component_name:p.TEXT_TRANSMEDIA_TEMPLATE},{component_name:p.TEXT_DEFINITION_TEMPLATE}]);case"link":this._displaySelectVisibility(!0),this._videoPositionSelectVisibility(!1),this._imageFieldVisibility(!0),this._titleFieldVisibility(!0),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1);var r=[{component_name:p.LINK_TEMPLATE},{component_name:p.LINK_WITHIMAGE_NOTITLE_TEMPLATE},{component_name:p.LINK_MODAL_THUMB_TEMPLATE},{component_name:p.LINK_EMBED_TEMPLATE}];return this._userHasRole("admin")&&r.splice(3,0,{component_name:p.LINK_DESCRIPTION_FIRST_TEMPLATE}),n(r);case"image":this._imageFieldVisibility(!0),this._displaySelectVisibility(!1),this._videoPositionSelectVisibility(!1),this._titleFieldVisibility(!0),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1);return n([{component_name:p.IMAGE_PLAIN_TEMPLATE},{component_name:p.IMAGE_INLINE_WITHTEXT_TEMPLATE},{component_name:p.SLIDING_CAPTION},{component_name:p.IMAGE_THUMBNAIL_TEMPLATE},{component_name:p.IMAGE_FILL_TEMPLATE}]);case"file":return this._titleFieldVisibility(!0),this._templateSelectVisibility(!1),this._bgImagePositionSelectVisibility(!1),n([{component_name:p.FILE_TEMPLATE}]);case"question":return this._displaySelectVisibility(!0),this._imageFieldVisibility(!0),this._titleFieldVisibility(!0),this._templateSelectVisibility(!0),this._bgImagePositionSelectVisibility(!1),n([{component_name:p.QUESTION_TEMPLATE}]);case"chapter":this._titleFieldVisibility(!0)}},SelectService.prototype.onSelectChange=function(e,t){switch(this._displaySelectVisibility(!1),e.producerItemType){case"scene":var i="inline"===e.layouts[0];switch(e.component_name){case p.CENTERED_TEMPLATE:case p.CENTERED_PRO_TEMPLATE:this._videoPositionSelectVisibility(!1),this._displaySelectVisibility(!1),e.layouts[0]="",e.layouts[1]=this._D1.a.value;break;case p.CENTER_VV_TEMPLATE:case p.CENTER_VV_MONDRIAN_TEMPLATE:this._displaySelectVisibility(!1),this._videoPositionSelectVisibility(!0),this._select.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],e.layouts[1]=this._D1.a.value,(i||""===e.layouts[0])&&(e.layouts[0]="videoLeft");break;case p.CORNER_V_TEMPLATE:case p.CORNER_H_TEMPLATE:case p.PIP_TEMPLATE:this._displaySelectVisibility(!0),this._videoPositionSelectVisibility(!0),this._select.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],this._select.display=[{value:this._D1.a.value,name:this._D1.a.name},{value:this._D1.b.value,name:this._D1.b.name}],(i||""===e.layouts[0])&&(e.layouts[0]="videoLeft",e.layouts[1]=this._D1.a.value);break;case p.MIRRORED_TWOCOL_TEMPLATE:this._displaySelectVisibility(!0),this._videoPositionSelectVisibility(!0),this._select.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],this._select.display=[{value:this._D2.a.value,name:this._D2.a.name},{value:this._D2.b.value,name:this._D2.b.name}],(i||""===e.layouts[0])&&(e.layouts[0]="videoLeft",e.layouts[1]=this._D2.b.value);break;case p.ONECOL_TEMPLATE:this._displaySelectVisibility(!0),this._videoPositionSelectVisibility(!1),this._select.display=[{value:this._D3.a.value,name:this._D3.a.name},{value:this._D3.b.value,name:this._D3.b.name}],e.layouts[0]="",i&&(e.layouts[1]=this._D3.b.value)}break;case"link":switch(this._displaySelectVisibility(!0),this._imageFieldVisibility(!0),this._templateSelectVisibility(!0),!0===e.stop?(e.layouts[0]="windowFg",e.component_name===p.LINK_MODAL_THUMB_TEMPLATE&&(e.component_name=p.LINK_EMBED_TEMPLATE)):e.layouts[0]="inline",e.component_name){case p.LINK_TEMPLATE:case p.LINK_WITHIMAGE_NOTITLE_TEMPLATE:case p.LINK_MODAL_THUMB_TEMPLATE:this._imageFieldVisibility(!0);break;case p.LINK_DESCRIPTION_FIRST_TEMPLATE:case p.LINK_EMBED_TEMPLATE:this._imageFieldVisibility(!1)}break;case"transcript":this._displaySelectVisibility(!1),e.layouts[0]="inline";break;case"annotation":switch(e.layouts[0]="inline",e.component_name){case p.HEADER_ONE_TEMPLATE:case p.HEADER_TWO_TEMPLATE:this._speakerFieldVisibility(!1),this._titleFieldVisibility(!1);break;case p.PULLQUOTE_TEMPLATE:this._speakerFieldVisibility(!0),this._titleFieldVisibility(!1);break;case p.TEXT_TRANSMEDIA_TEMPLATE:case p.TEXT_DEFINITION_TEMPLATE:this._speakerFieldVisibility(!1),this._titleFieldVisibility(!0)}!0===e.stop&&(e.layouts[0]="windowFg");break;case"question":this._select.questionType=[{value:"mc-poll",name:"Poll"},{value:"mc-formative",name:"Formative"}],e.layouts[0]="windowFg",e.stop=!0;break;case"image":this._displaySelectVisibility(!1);var n=this.getSceneName(this.modelSvc.scene(e.scene_id));switch(e.component_name){case p.IMAGE_PLAIN_TEMPLATE:case p.IMAGE_INLINE_WITHTEXT_TEMPLATE:case p.SLIDING_CAPTION:case p.IMAGE_THUMBNAIL_TEMPLATE:t.pin=t.position="",e.layouts[0]="inline";break;case p.IMAGE_FILL_TEMPLATE:e.cosmetic=!0,this._displaySelectVisibility(!0),this._bgImagePositionSelectVisibility(!0),this._select.imagePosition=[{value:"fill",name:"Fill and stretch"},{value:"contain",name:"Contain"},{value:"cover",name:"Cover and crop"},{value:"tl",name:"Top Left"},{value:"tr",name:"Top Right"},{value:"bl",name:"Bottom Left"},{value:"br",name:"Bottom Right"}],this._setAvailableImageOptsForLayout(n,e,t)}!0===e.stop&&(e.layouts[0]="windowFg");break;case"file":switch(e.showInlineDetail=!1,e.component_name){case p.LINK_TEMPLATE:e.showInlineDetail=!0;break;case p.FILE_TEMPLATE:case p.LINK_DESCRIPTION_FIRST_TEMPLATE:case p.LINK_MODAL_THUMB_TEMPLATE:}!0===e.stop&&(e.layouts[0]="windowFg")}},SelectService.prototype.showTab=function(e,t){switch(e){case"scene":switch(t){case"Item":return!1;case"Style":return!0;case"Customize":return this._userHasRole("admin")}break;case"transcript":case"annotation":case"link":case"image":case"file":case"question":switch(t){case"Item":return!0;case"Style":return!1;case"Customize":return this._userHasRole("admin")}break;case"chapter":switch(t){case"Item":return!0;case"Style":case"Customize":return!1}}},SelectService.Name="selectService",SelectService.$inject=["authSvc","modelSvc","dataSvc","ittUtils"],SelectService}(),qt=i("IrCW"),Wt=i.n(qt),zt=function(){function NarrativeTimelineCtrl(e,t,i,n,a,r,s){this.$scope=e,this.$routeParams=t,this.$location=i,this.dataSvc=n,this.appState=a,this.authSvc=r,this.errorSvc=s}return NarrativeTimelineCtrl.prototype.$onInit=function(){var e=this;this.disableSocialShareOnDev(),this.dataSvc.getNarrative(this.$routeParams.narrativePath).then(function(t){e.appState.narrativeId=t._id,e.$scope.narrative=t;var i=e.authSvc.getRoleForNarrative(t._id),n=e.authSvc.getDefaultProductForRole(i),a=Object.create(null),r="",s="";e.appState.product=n,angular.forEach(t.timelines,function(t){t._id!==e.$routeParams.timelinePath&&t.path_slug.en!==e.$routeParams.timelinePath||(a=t,r=t.name.en,s=t._id,e.appState.timelineId=t._id,t.episode_segments[0]&&(e.appState.episodeId=t.episode_segments[0].episode_id,e.appState.episodeSegmentId=t.episode_segments[0]._id,e.$scope.showPlayer=!0))});var o=t.path_slug.en,l=a.path_slug.en,c=t.narrative_subdomain;!0===t.enable_social_sharing&&!0===e.$scope.enableSocialSharing&&(e.$scope.socialShareInfo={subDomain:c,tlTitle:r,narrative:o,timeline:{url:l,id:s}}),e.appState.episodeId||e.errorSvc.error({data:"Sorry, no episode was found in this timeline."})})},NarrativeTimelineCtrl.prototype.disableSocialShareOnDev=function(){this.$scope.enableSocialSharing=!/api-dev|np-dev|demo/.test(this.$location.host())},NarrativeTimelineCtrl.$inject=["$scope","$routeParams","$location","dataSvc","appState","authSvc","errorSvc"],NarrativeTimelineCtrl}(),Kt=i("Ec80"),Gt=i.n(Kt);PlayerController.$inject=["$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","authSvc","selectService","playbackService","episodeTheme","episodeEdit"];var Qt=i("DC6m"),Xt=i.n(Qt);ittSearchPanel.$inject=["appState"],SearchPanelController.$inject=["$scope","$rootScope","$timeout","appState"];var Yt=i("7/ac"),Jt=i.n(Yt),Zt=function(){function ToolbarStory(){this.restrict="EA",this.template=Jt.a,this.scope=!0}return ToolbarStory.factory=function(){return function(){return new ToolbarStory}},ToolbarStory.Name="npToolbarStory",ToolbarStory}();ittVolumeSlider.$inject=["playbackService"];var ei=function(){function MagnetStore(e){this._bcr=e}return MagnetStore.of=function(e){return new MagnetStore(e)},Object.defineProperty(MagnetStore.prototype,"bcr",{get:function(){return this._bcr},enumerable:!0,configurable:!0}),MagnetStore}(),ti=function(){function Magnet(e,t,i,n){this.$rootScope=e,this.$timeout=t,this.appState=i,this.playbackService=n,this.restrict="A"}return Magnet.factory=function(){var e=function(e,t,i,n){return new Magnet(e,t,i,n)};return e.$inject=Magnet.$inject,e},Magnet.prototype.link=function(e,t,i){var n=this,a={magnetBoundingClientRect:null,size:null,appState:null},r=function(e){return e+(void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)},s=function(){var e=t[0].getBoundingClientRect(),i=e.top,a=e.left,s=e.width,o=i;return"review"!==n.appState.viewMode&&(o=r(i)),{left:a,width:s,top:o}},o=function(){return{viewMode:n.appState.viewMode,videoPosition:n.appState.editEvent.styleCss}},l=function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:t.is(":visible")}},c=function(e){if(e){var t=ei.of(e);return 0===n.playbackService.getMetaProp("time")?void n.$rootScope.$emit("magnet.jumpToMagnet",t.bcr):void n.$rootScope.$emit("magnet.changeMagnet",t.bcr)}p().then(function(e){var t=Object.assign({},e);"review"!==n.appState.viewMode&&(t.top=r(t.top));var i=ei.of(t);if(0===n.playbackService.getMetaProp("time"))return void n.$rootScope.$emit("magnet.jumpToMagnet",i.bcr);n.$rootScope.$emit("magnet.changeMagnet",i.bcr)})},d=function(){var e=angular.element(window),i=e.height()-46;e.width()/i>16/9?t.width(16/9*i):t.width(e.width()),c()},p=function(e){return void 0===e&&(e=100),n.$timeout(function(){var e=t[0].getBoundingClientRect();return{top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width}},e).then(function(e){return e})},m=function(e){e&&c(e)},h=function(){n.appState.isIOS()&&"review"===n.appState.viewMode||c()},g=function(){window.removeEventListener("resize",h),Object.keys(a).forEach(function(e){a[e]&&a[e]()})};this.$rootScope.$on(u,function(){return c()}),function(){window.addEventListener("resize",h),n.appState.isIOS()?(p(500).then(function(e){return c(e)}),a.appState=e.$watchCollection(o,function(e,t){if(e.videoPosition!==t.videoPosition)return void n.$timeout(function(){return c()},500);e.viewMode&&c()})):a.magnetBoundingClientRect=e.$watchCollection(s,m),"watchModeVideoMagnet"===t.attr("id")&&(a.size=e.$watch(l,d,!0))}(),e.$on("$destroy",g)},Magnet.Name="ittMagnet",Magnet.$inject=["$rootScope","$timeout","appState","playbackService"],Magnet}(),ii=function(){function Magnetized(e,t){this.$rootScope=e,this.appState=t,this.restrict="A"}return Magnetized.factory=function(){var e=function(e,t){return new Magnetized(e,t)};return e.$inject=Magnetized.$inject,e},Magnetized.prototype.link=function(e,t,i){var n=this,a=function(e,i){if(null!=e){"review"===n.appState.viewMode?t.css("position","fixed"):t.css("position","absolute");var a=e.top,r=e.left,s=e.width;!0===i?(t.css("transition-timing-function","cubic-bezier(0.4, 0, 1, 1)"),t.css("transition-duration","0.25s")):(t.css("transition-duration","unset"),t.css("transition-timing-function","unset"));var o=s/854;0!==o&&t.css("transform","translate("+Math.abs(r)+"px, "+Math.abs(a)+"px) scale("+o+")")}};this.$rootScope.$on("magnet.changeMagnet",function(e,t){return a(t,!0)}),this.$rootScope.$on("magnet.jumpToMagnet",function(e,t){return a(t,!1)})},Magnetized.Name="ittMagnetized",Magnetized.$inject=["$rootScope","appState"],Magnetized}();ittShowHideVisualOnly.$inject=["$animate"];var ni=(i("5Nri"),i("VUCL"),i("mcSx"),i("cs5V"),'\n<div class="episode episode-template" ng-class="episode.templateCss" ng-hide="episodeTheme.sheetLoading">\n\n  <div\n    class="fill"\n    ng-if="episode.template.css_configuration.fill_class != null"\n    ng-class="episode.template.css_configuration.fill_class">\n    \n    <div ng-if="episode.template.css_configuration.fill_class === \'gwsb-seal\'" class="fill"></div>\n  </div>\n  <span np-reviewmode-template></span>\n  <span np-watchmode-template></span>\n  <span\n    np-discovermode-template\n    ng-class="{\'colorInvert DiscoverModeOnly\': episode.template.displayName === \'Middlebury\'}"\n    ng-repeat="scene in episode.scenes | isCurrent">\n  </span>\n  <span np-video-template></span>\n  <span np-windowfg-template></span>\n  <np-episode-footer template-data="episode.template"></np-episode-footer>\n</div>\n'),ai=function(){function EpisodeController(e,t,i,n,a,r,s){this.$scope=e,this.$interval=t,this.analyticsSvc=i,this.modelSvc=n,this.appState=a,this.dataSvc=r,this.timelineSvc=s}return EpisodeController.prototype.$onInit=function(){var e=this;this.$scope.episode=this.modelSvc.episodes[this.appState.episodeId],this.loadEpisodeForPlayer();var t=function(){e.$scope.episode=e.modelSvc.episodes[e.appState.episodeId]};this.$interval(t,457)},EpisodeController.prototype.$onDestroy=function(){this.analyticsSvc.captureEpisodeActivity("episodeUnload"),this.analyticsSvc.stopPolling()},EpisodeController.prototype.loadEpisodeForPlayer=function(){this.analyticsSvc.startPolling(),this.analyticsSvc.captureEpisodeActivity("episodeLoad")},EpisodeController.$inject=["$scope","$interval","analyticsSvc","modelSvc","appState","dataSvc","timelineSvc"],EpisodeController}(),ri=i("V+JG"),si=i.n(ri),oi=function(e){return e._id&&/internal/.test(e._id)},li=function(e,t){for(var i=[],n=0,a=e.length;n<a;n+=1)oi(e[n])||(t<e[n].start_time||t<e[n].end_time)&&i.push(e[n]);return i},ci=function(){function EpisodeEditorController(e,t,i,n,a,r,s,o,l){this.$timeout=e,this.dataSvc=t,this.modelSvc=i,this.appState=n,this.selectService=a,this.authSvc=r,this.playbackService=s,this.urlService=o,this.episodeEdit=l}return Object.defineProperty(EpisodeEditorController.prototype,"isAdmin",{get:function(){return this.authSvc.userHasRole("admin")},enumerable:!0,configurable:!0}),Object.defineProperty(EpisodeEditorController.prototype,"isCustomerAdmin",{get:function(){return this.authSvc.userHasRole("customer admin")},enumerable:!0,configurable:!0}),EpisodeEditorController.prototype.$onInit=function(){this.episodeContainerId=this.modelSvc.episodes[this.appState.episodeId].container_id,this.container=this.modelSvc.containers[this.episodeContainerId],this.customer=this.modelSvc.customers[this.container.customer_id],this.episode.master_asset_id&&""!==this.episode.master_asset_id&&(this.masterAsset=createInstance("MasterAsset",this.modelSvc.assets[this.episode.master_asset_id])),this.uneditedEpisode=angular.copy(this.episode),this.itemForm=this.selectService.setupItemForm(this.episode.styles,"episode"),this.langForm=this.episodeEdit.episodeLangForm;for(var e=0;e<this.episode.languages.length;e+=1)this.episodeEdit.episodeLangForm[this.episode.languages[e].code]=!0;this.onLangFlagChange(),!this.authSvc.userHasRole("admin")||this.masterAsset&&/video\/x-/.test(this.masterAsset.content_type)?this.masterAssetType="WebUrl":this.masterAssetType="Video",this.episode&&null==this.episode.description&&(this.episode.description=(t={},t[this.episode.defaultLanguage||"en"]="",t));var t},EpisodeEditorController.prototype.forcePreview=function(){},EpisodeEditorController.prototype.toggleUpload=function(e){void 0===e&&(e=""),this["showUploadField"+e]=!this["showUploadField"+e]},EpisodeEditorController.prototype.toggleAssetSelect=function(e){this["showAssetPicker"+e]=!this["showAssetPicker"+e]},EpisodeEditorController.prototype.translationMessage=function(e){var t="",i=e.filter(function(e){return void 0==e.default||(t="Translate from "+e.code+" to: ",!1)}).map(function(e){return e.code}).join(", ");return t+i},EpisodeEditorController.prototype.beginBackgroundTranslations=function(e){var t=this,i=function(e){"Request for translations queued"===e.status?t.afterTranslationAttempt=e.status+", check back later!":t.afterTranslationAttempt="Something went wrong...",t.doCheckForTranslations=!0},n=function(e){};this.dataSvc.beginBackgroundTranslations(e).then(i).catch(n)},EpisodeEditorController.prototype.updateItemForm=function(){this.episode.styles=this.selectService.handleEpisodeItemFormUpdates(this.itemForm),this.modelSvc.deriveEpisode(this.episode),this.modelSvc.resolveEpisodeEvents(this.episode._id)},EpisodeEditorController.prototype.attachChosenAsset=function(e){this.episode.replacingMasterAsset=!1;var t=this.modelSvc.assets[e],i=this.modelSvc.assets[this.episode.master_asset_id];if(this.showmessage="New video attached.",i&&t.duration<i.duration){li(this.episode.items.concat(this.episode.scenes),t.duration).length&&(this.showmessage="Warning: this new video is shorter than the current video and we've detected that some \n        existing content items will be impacted. If you save this edit, these events will have their start and end \n        times adjusted to the new episode end. (If this isn't what you want, choose a different video or hit 'cancel'.)\n        ")}this.episode._master_asset_was_changed=!0,this.episode.master_asset_id=t._id,this.masterAsset=t,this.episode.masterAsset=createInstance("MasterAsset",t),this.modelSvc.deriveEpisode(this.episode),this.showAssetPickerMaster=!1},EpisodeEditorController.prototype.attachPosterAsset=function(e){var t=this.modelSvc.assets[e];this.episode.poster_frame_id=e,this.episode.poster=t,this.modelSvc.deriveEpisode(this.episode),this.showAssetPicker=!1,this.showUploadButtonsPoster=!1,this.showAssetPickerPoster=!1},EpisodeEditorController.prototype.assetUploaded=function(e){this.showUploadButtons=!1,this.showUploadField=!1,this.attachChosenAsset(e)},EpisodeEditorController.prototype.posterUploaded=function(e){this.showUploadButtonsPoster=!1,this.showUploadFieldPoster=!1,this.attachPosterAsset(e)},EpisodeEditorController.prototype.attachMediaSrc=function(e){var t,i=this.urlService.checkUrl(e),n=i.type;if(("wistia"!==n||this.authSvc.userHasRole("admin"))&&n.length>0){t=i.mimeType,this.episode.replacingMasterAsset=!0,this.showmessage="Getting "+n+" video...";var a=this.urlService.parseInput(e);this.episode.swap={_id:"replaceMe",mediaSrcArr:[a]};var r=this.waitForDuration(this.createAssetFromTmp.bind(this),a,t);this.playbackService.registerStateChangeListener(r)}},EpisodeEditorController.prototype.replaceAsset=function(e){var t=e||"";this["showUploadButtons"+t]=!0,this["showUploadField"+t]=!1},EpisodeEditorController.prototype.detachMasterAsset=function(){this.episode.masterAsset=null,this.appState.editEpisode.masterAsset=null,this.appState.editEpisode._master_asset_was_changed=!0,this.episodeEdit.detatchMasterAsset(this.episode)},EpisodeEditorController.prototype.saveEpisode=function(){this.episodeEdit.saveEpisode(this.episode)},EpisodeEditorController.prototype.selectText=function(e){e.target.select()},EpisodeEditorController.prototype.updateEpisodeTemplate=function(e){var t=this;this.episodeEdit.updateEpisodeTemplate(e.episode,e.templateId).then(function(e){return t.episode=e})},EpisodeEditorController.prototype.cancelEpisodeEdit=function(e){this.episodeEdit.cancelEpisodeEdit(this.uneditedEpisode)},EpisodeEditorController.prototype.onTitleOrDescriptionChange=function(){this.modelSvc.deriveEpisode(this.episode),this.modelSvc.resolveEpisodeEvents(this.episode._id)},EpisodeEditorController.prototype.onLangFlagChange=function(){var e,t=this,i=0,n=[];for(var a in this.langForm)this.langForm[a]?(i+=1,e=a,n.push({code:a})):this.episode.defaultLanguage===a&&(this.episode.defaultLanguage=!1);this.languageCount=i,!1===this.episode.defaultLanguage&&(this.episode.defaultLanguage=e),angular.forEach(n,function(e){e.code===t.episode.defaultLanguage&&(e.default=!0)}),this.episode.languages=angular.copy(n)},EpisodeEditorController.prototype.waitForDuration=function(e,t,i){var n=this;return function(a){"player ready"===a&&(n.playbackService.unregisterStateChangeListener(n.waitForDuration),n.$timeout(function(){e({url:t,type:i,duration:n.playbackService.getMetaProp("duration","replaceMe")}),n.episode.swap={}},0))}},EpisodeEditorController.prototype.createAssetFromTmp=function(e){var t=this,i=Object.create(null);i.content_type=e.type,i.duration=e.duration,i.url=e.url,i.name=this.episode.title,i.description=this.episode.description,this.dataSvc.createAsset(this.episodeContainerId,i).then(function(e){t.modelSvc.cache("asset",e),t.playbackService.renamePid("replaceMe",e._id),t.attachChosenAsset(e._id)}).catch(function(e){})},EpisodeEditorController.$inject=["$timeout","dataSvc","modelSvc","appState","selectService","authSvc","playbackService","urlService","episodeEdit"],EpisodeEditorController}(),di=function(){function EpisodeEditor(){this.bindings={episode:"<",langForm:"<",defaultLanguage:"<"},this.template=si.a,this.controller=ci}return EpisodeEditor.Name="npEpisodeEditor",EpisodeEditor}(),pi=i("01M/"),ui=function(){function EpisodeTheme(e){this.$q=e,this.linkId="np-template-theme",this._sheetLoading=!1}return Object.defineProperty(EpisodeTheme.prototype,"sheetLoading",{get:function(){return this._sheetLoading},set:function(e){this._sheetLoading=e},enumerable:!0,configurable:!0}),EpisodeTheme.prototype.setTheme=function(e){var t=this;return this.loadThemeStyleSheet(e.id).then(function(){return t.loadFontFamily(e.fonts)})},EpisodeTheme.prototype.loadThemeStyleSheet=function(e){return null!=this.linkTag?this._changeHref(e):this._appendLinkTag(e),this._imgLoadEvtHack()},EpisodeTheme.prototype.loadFontFamily=function(e){null!=e&&pi.load(e)},EpisodeTheme._getHrefPath=function(e){return"https:"+r.apiDataBaseUrl+"/v1/templates/"+e+".css"},EpisodeTheme.prototype._imgLoadEvtHack=function(){var e=this;return this.sheetLoading=!0,this.$q(function(t){e.imgElm=document.createElement("img"),e.imgElm.src=e.linkTag.href,document.body.appendChild(e.imgElm),e.imgElm.onerror=function(){return document.body.removeChild(e.imgElm),e.sheetLoading=!1,t(void 0)}})},EpisodeTheme.prototype._changeHref=function(e){this.linkTag.setAttribute("href",EpisodeTheme._getHrefPath(e))},EpisodeTheme.prototype._appendLinkTag=function(e){var t=document.createElement("link");t.setAttribute("id",this.linkId),t.setAttribute("rel","stylesheet"),t.setAttribute("href",EpisodeTheme._getHrefPath(e)),this.linkTag=t,document.head.appendChild(this.linkTag)},EpisodeTheme.Name="episodeTheme",EpisodeTheme.$inject=["$q"],EpisodeTheme}(),mi=function(e,t){return e.start_time-t.start_time},hi=function(e,t){for(var i=1,n=e.length;i<n;i++)i===n-1?e[i].end_time=t:e[i].end_time!==e[i+1].start_time&&(e[i].end_time=e[i+1].start_time)},gi=function(e,t){for(var i=!1,n=0,a=e.length;n<a;n++)if(e[n]._id===t._id){i=!0;break}i||e.push(t)},vi=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]._id===t){e.splice(i,1);break}},fi=function(e,t){for(var i=0;i<e.length;i+=1){if(void 0===e[i]._id||"internal:editing"===e[i]._id){e.splice(i,1);break}if(t&&e[i]._id===t._id){e[i]=t;break}}return e},yi=function(e){return"Annotation"===e._type&&e.component_name===p.TRANSCRIPT_TEMPLATE},_i=function(e){return e._id&&/internal/.test(e._id)},Si=function(e,t){for(var i=0,n=0,a=e.length;n<a;n++)if(e[n]._id===t._id){i=n;break}return i},bi=function(e,t){var i=e.sort(mi),n=Si(i,t),a=[];return 0===n?a:(n<i.length-1&&n>=1&&(_i(i[n-1])||a.push(i[n-1])),a)},Ti=function(e,t){var i=e.sort(mi),n=Si(i,t),a=[];return 0===n?n<i.length-1&&(_i(i[n+1])||a.push(i[n+1])):n<i.length-1&&(_i(i[n+1])||a.push(i[n+1]),n>=1&&(_i(i[n-1])||a.push(i[n-1]))),a},Ei=function(){function EpisodeEditService(e,t,i,n,a,r,s,o,l,c){this.$timeout=e,this.$rootScope=t,this.appState=i,this.authSvc=n,this.selectService=a,this.modelSvc=r,this.dataSvc=s,this.episodeTheme=o,this.playbackService=l,this.timelineSvc=c,this.episodeLangForm={en:!0,es:!1,zh:!1,pt:!1,fr:!1,de:!1,it:!1}}return Object.defineProperty(EpisodeEditService.prototype,"canAccess",{get:function(){return this.userHasRole("admin")||this.authSvc.userHasRole("customer admin")},enumerable:!0,configurable:!0}),EpisodeEditService.prototype.replaceAsset=function(){this.appState.editEvent.sxs&&(this.appState.editEvent.removedAssets=this.appState.editEvent.removedAssets||[],"Link"===this.appState.editEvent._type?this.appState.editEvent.removedAssets.push(this.appState.editEvent.link_image_id):"Annotation"===this.appState.editEvent._type?this.appState.editEvent.removedAssets.push(this.appState.editEvent.annotation_image_id):this.appState.editEvent.removedAssets.push(this.appState.editEvent.asset_id))},EpisodeEditService.prototype.detachAsset=function(){if(this.appState.editEvent.asset)switch(this.appState.editEvent.producerItemType){case"link":this.appState.editEvent.asset=null,this.appState.editEvent.link_image_id=null,this.appState.editEvent.asset_id=null,this.appState.editEvent.annotation_image_id=null;break;case"transcript":this.appState.editEvent.asset=null,this.appState.editEvent.annotation_image_id=null;break;case"image":case"question":case"file":this.appState.editEvent.asset=null,this.appState.editEvent.asset_id=null}},EpisodeEditService.prototype.attachChosenAsset=function(e,t){var i=this.modelSvc.assets[e];this.appState.editEvent&&(this.appState.editEvent.asset=i,this.selectService.onSelectChange(this.appState.editEvent,t),"Upload"===this.appState.editEvent._type||"Plugin"===this.appState.editEvent._type?this.appState.editEvent.asset_id=e:"Link"===this.appState.editEvent._type?(this.appState.editEvent.link_image_id=e,this.appState.editEvent.asset_id=e):"Annotation"===this.appState.editEvent._type&&(this.appState.editEvent.asset_id=e,this.appState.editEvent.annotation_image_id=e))},EpisodeEditService.prototype.assetUploaded=function(e){this.appState.editEvent.asset=this.modelSvc.assets[e],"Link"===this.appState.editEvent._type?this.appState.editEvent.link_image_id=e:"Annotation"===this.appState.editEvent._type?this.appState.editEvent.annotation_image_id=e:this.appState.editEvent.asset_id=e},EpisodeEditService.prototype.userHasRole=function(e){return this.authSvc.userHasRole(e)},EpisodeEditService.prototype.updateEpisodeTemplate=function(e,t){var i=this.dataSvc.getTemplate(t),n=createInstance("Episode",e);n.template=i,n.template_id=i.id;var a=this.modelSvc.deriveEpisode(n);this.modelSvc.cache("episode",a);var r=this.modelSvc.resolveEpisodeEvents(a._id);return this.episodeTheme.setTheme(i).then(function(){return r})},EpisodeEditService.prototype.addEpisodeToContainer=function(e){var t=this,i={container_id:e._id,title:angular.copy(e.name)};return this.dataSvc.fetchTemplates().then(function(){return t.dataSvc.getEpisodeTemplatesByCustomerIds([e.customer_id])}).then(function(e){if(1===e.length)i.template_id=e[0].id;else{var t=e.filter(function(e){return"Unbranded"!==e.name});i.template_id=t[0].id}}).then(function(){return t.dataSvc.createEpisode(i).then(function(e){return{_type:"Scene",title:{},description:{},templateUrl:"templates/scene/onecol.html",component_name:p.ONECOL_TEMPLATE,start_time:0,end_time:0,episode_id:e._id}}).then(function(e){return t.dataSvc.storeItem(e)}).then(function(){return e})})},EpisodeEditService.prototype.setEpisodeToEdit=function(){var e=this.modelSvc.episodes[this.appState.episodeId],t=this.modelSvc.containers[e.container_id].customer_id;this.appState.editEpisode=e,this.appState.editEpisode.templateOpts=this.selectService.getTemplates("episode",[t]),this.appState.videoControlsActive=!0,this.appState.videoControlsLocked=!0},EpisodeEditService.prototype.cancelEpisodeEdit=function(e){this.modelSvc.episodes[this.appState.episodeId]=e,this.modelSvc.deriveEpisode(this.modelSvc.episodes[e._id]),this.modelSvc.resolveEpisodeContainers(e._id),this.modelSvc.resolveEpisodeEvents(e._id),this.episodeTheme.setTheme(e.template),this.appState.editEpisode=!1,this.appState.videoControlsLocked=!1},EpisodeEditService.prototype.detatchMasterAsset=function(e){this.dataSvc.detachMasterAsset(e).then(function(e){window.location.reload()})},EpisodeEditService.prototype.saveEpisode=function(e){var t=this,i=angular.copy(this.appState.editEpisode);this.dataSvc.storeEpisode(i).then(function(n){if(t.modelSvc.cache("episode",t.dataSvc.resolveIDs(n)),t.appState.editEpisode._master_asset_was_changed){delete t.modelSvc.episodes[n._id]._master_asset_was_changed;var a=t.modelSvc.assets[n.master_asset_id].duration,r=a-.01;t.modelSvc.episodes[t.appState.episodeId].masterAsset=createInstance("MasterAsset",t.modelSvc.assets[e.master_asset_id]),t.modelSvc.episodes[t.appState.episodeId].master_asset_id=n.master_asset_id;var s=[],o=[],l=t.modelSvc.episodes[i._id];angular.forEach(l.scenes,function(e){e.start_time>a?o.push(e):e.end_time>a&&(e.end_time=r,s.push(e))}),angular.forEach(l.items,function(e){e.start_time>a&&(e.start_time=r),e.end_time>a&&(e.end_time=r),s.push(e)});var c=t.modelSvc.events["internal:endingscreen:"+i._id];c?(c.start_time=r,c.end_time=r):t.modelSvc.addEndingScreen(i._id),t.modelSvc.resolveEpisodeEvents(t.appState.episodeId),t.modelSvc.resolveEpisodeAssets(t.appState.episodeId),t.playbackService.setMetaProp("duration",a),t.appState.editEpisode=!1,t.appState.videoControlsLocked=!1,t.timelineSvc.init(t.appState.episodeId),angular.forEach(s,function(e){e._id.indexOf("internal")<0&&t.dataSvc.storeItem(e)}),angular.forEach(o,function(e){e._id.indexOf("internal")<0&&t.dataSvc.deleteItem(e._id)}),t.$timeout(function(){window.location.reload()},500)}else t.modelSvc.resolveEpisodeEvents(t.appState.episodeId),t.modelSvc.resolveEpisodeAssets(t.appState.episodeId),t.appState.editEpisode=!1,t.appState.videoControlsLocked=!1}).catch(function(e){})},EpisodeEditService.prototype.addEvent=function(e){if("scene"===e){var t=Math.round(100*this.playbackService.getMetaProp("time"))/100;if(this.modelSvc.isOnExistingSceneStart(t))return this.editCurrentScene(t)}var i=this.generateEmptyItem(e);i.cur_episode_id=this.appState.episodeId,i.episode_id=this.appState.episodeId,this.appState.user&&this.appState.user.avatar_id&&(i.avatar_id=this.appState.user.avatar_id),this.modelSvc.cache("event",i),this.appState.editEvent=this.modelSvc.events["internal:editing"],this.appState.videoControlsActive=!0,this.appState.videoControlsLocked=!0,this.modelSvc.resolveEpisodeEvents(this.appState.episodeId),this.timelineSvc.injectEvents([this.modelSvc.events["internal:editing"]]),"scene"===e&&(this.selectService.onSelectChange(this.appState.editEvent),this.timelineSvc.updateSceneTimes(this.appState.episodeId)),this.$rootScope.$emit("searchReindexNeeded")},EpisodeEditService.prototype.editEvent=function(e){this.appState.editEvent=e,this.appState.editEvent.templateOpts=this.selectService.getTemplates(e.producerItemType);var t=this.selectService.setupItemForm(this.appState.editEvent.styles,"item");this.selectService.onSelectChange(this.appState.editEvent,t),this.appState.videoControlsActive=!0,this.appState.videoControlsLocked=!0},EpisodeEditService.prototype.editCurrentScene=function(e){var t=this.modelSvc.sceneAtEpisodeTime(this.appState.episodeId,e);this.appState.editEvent=this.modelSvc.events[t._id],this.appState.editEvent.templateOpts=this.selectService.getTemplates("scene"),this.appState.editEvent.cur_episode_id=this.appState.episodeId,this.appState.editEvent.episode_id=this.appState.episodeId,this.appState.editEvent=createInstance("Scene",this.appState.editEvent),this.appState.videoControlsActive=!0,this.appState.videoControlsLocked=!0,this.selectService.onSelectChange(this.appState.editEvent)},EpisodeEditService.prototype.cancelEventEdit=function(e){var t=e.cur_episode_id?e.cur_episode_id:e.episode_id;"internal:editing"===this.appState.editEvent._id?(delete this.modelSvc.events["internal:editing"],this.timelineSvc.removeEvent("internal:editing")):(e.renderTemplate=!0,this.modelSvc.events[this.appState.editEvent._id]=e),this.modelSvc.resolveEpisodeEvents(t),"Scene"===e._type?this.timelineSvc.updateSceneTimes(t):this.timelineSvc.updateEventTimes(e),this.appState.editEvent=!1,this.appState.videoControlsLocked=!1},EpisodeEditService.prototype.saveEvent=function(e,t){var i=this;if(e.cur_episode_id=this.appState.episodeId,"Scene"===e._type){var n=this.adjustScenes(e,!1,t);angular.forEach(n,function(e){i.dataSvc.storeItem(e).then(function(){},function(e){})})}return this.dataSvc.storeItem(e).then(function(t){t.cur_episode_id=i.appState.episodeId;var n="update";if("internal:editing"===i.appState.editEvent._id){i.timelineSvc.removeEvent("internal:editing"),delete i.modelSvc.events["internal:editing"],i.modelSvc.cache("event",i.dataSvc.resolveIDs(t)),i.modelSvc.resolveEpisodeEvents(i.appState.episodeId),n="create";var a=t.asset_id||t.link_image_id||t.annotation_image_id;a&&e.asset&&e.asset._id===a&&i.modelSvc.assocEventWithAsset(t._id,a)}"Scene"===t._type?(i.timelineSvc.timelineEvents=[],i.timelineSvc.injectEvents(i.modelSvc.episodeEvents(i.appState.episodeId),0),i.modelSvc.episodes[i.appState.episodeId].setCurrentScene(i.modelSvc.events[t._id])):(i.modelSvc.resolveEpisodeEvents(i.appState.episodeId),i.timelineSvc.updateEventTimes(i.modelSvc.events[t._id])),i.saveAdjustedEvents(t,n),angular.forEach(e.removedAssets,function(e){i.dataSvc.deleteAsset(e)}),i.appState.editEvent=!1,i.$rootScope.$emit("searchReindexNeeded")},function(e){})},EpisodeEditService.prototype.deleteEvent=function(e,t){var i=this;if(window.confirm("Are you sure you wish to delete this item?")){var n=Object.create(null);n._id=e;var a=this.modelSvc.events[e]._type;if("Scene"===a){var r=this.adjustScenes(n,!0,t);angular.forEach(r,function(e){i.dataSvc.storeItem(e).then(function(){},function(e){})})}this.dataSvc.deleteItem(e).then(function(){"sxs"===i.appState.product&&i.modelSvc.events[e].asset&&i.dataSvc.deleteAsset(i.modelSvc.events[e].asset._id),i.timelineSvc.removeEvent(e),delete i.modelSvc.events[e],i.modelSvc.resolveEpisodeEvents(i.appState.episodeId),"Scene"!==a&&"Chapter"!==a||i.timelineSvc.updateSceneTimes(i.appState.episodeId),i.saveAdjustedEvents(n,"delete"),i.appState.editEvent=!1,i.appState.videoControlsLocked=!1},function(e){})}},EpisodeEditService.prototype.getTranscriptItems=function(){return this.modelSvc.episodes[this.appState.episodeId].items.filter(yi)},EpisodeEditService.prototype.saveAdjustedEvents=function(e,t,i){var n=this;if(yi(e)){var a=[],r=this.getTranscriptItems();switch(t){case"create":a=Ti(r,e);break;case"delete":a=bi(r,e);break;case"update":i&&this.saveAdjustedEvents(i,"delete"),this.saveAdjustedEvents(e,"create")}angular.forEach(a,function(e){n.dataSvc.storeItem(e).then(function(){},function(e){})})}},EpisodeEditService.prototype.adjustScenes=function(e,t,i){var n=this.playbackService.getMetaProp("duration"),a=angular.copy(this.modelSvc.getEpisodeScenes()),r=[];t?gi(a,i):fi(a,i),a=a.sort(mi),hi(a,n),vi(a,e._id),t||a.push(e),a=a.sort(mi);for(var s=1,o=a.length;s<o;s+=1)s===o-1?a[s].end_time!==n&&(a[s].end_time=n,r.push(a[s])):a[s].end_time!==a[s+1].start_time&&(a[s].end_time=a[s+1].start_time,r.push(a[s]));return r},EpisodeEditService.prototype.generateEmptyItem=function(e){var t={_id:"internal:editing",start_time:this.playbackService.getMetaProp("time"),episode_id:this.appState.episodeId,isCurrent:!0,layouts:["inline"],styles:[]},i=Object.create(null);"scene"===e&&(i={_type:"Scene",title:{},description:{}}),"chapter"===e&&(i={_type:"Chapter",title:{},description:{}}),"video"===e&&(i={_type:"Link",link_image_id:"",url:"",title:{},description:{}}),"comment"!==e&&"transcript"!==e&&"annotation"!==e||(i={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:""}),"file"!==e&&"image"!==e||(i={_type:"Upload",asset_id:"",title:{},description:{}}),"link"===e&&(i={_type:"Link",link_image_id:"",url:"https://",title:{},target:"_self",description:{},url_status:{}}),"question"===e&&(i={_type:"Plugin",title:{},data:{_pluginType:"question",_version:2,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{index:1,text:null},{index:2,text:null},{index:3,text:null},{index:4,text:null}],correctfeedback:"",incorrectfeedback:""}}},i.plugin=i.data._plugin);var n={};"sxs"===this.appState.product?(i.sxs=!0,i.annotator={en:this.appState.user.name},i.layouts=["windowFg"],i.end_time=this.appState.time,i.stop=!0,n={annotation:p.SXS_ANNOTAITON_TEMPLATE,link:p.SXS_LINK_TEMPLATE,question:p.SXS_QUESTION_TEMPLATE,image:p.SXS_IMAGE_TEMPLATE,file:p.SXS_FILE_TEMPLATE,video:p.SXS_VIDEO_TEMPLATE}):n={scene:p.CENTERED_TEMPLATE,transcript:p.TRANSCRIPT_TEMPLATE,annotation:p.HEADER_TWO_TEMPLATE,link:p.LINK_TEMPLATE,image:p.IMAGE_PLAIN_TEMPLATE,file:p.FILE_TEMPLATE,question:p.QUESTION_TEMPLATE,video:"TODO:VIDEO"};var a=this.modelSvc.readDataCache("template","component_name",n[e]);return i.templateOpts=this.selectService.getTemplates(e),i.template_id=a.id,i.component_name=n[e],angular.extend(t,i),createInstance(i._type,t)},EpisodeEditService.Name="episodeEdit",EpisodeEditService.$inject=["$timeout","$rootScope","appState","authSvc","selectService","modelSvc","dataSvc","episodeTheme","playbackService","timelineSvc"],EpisodeEditService}(),Ci='\n{{$ctrl.copyrightOrg}} player &#169;\n<span ng-bind-html="$ctrl.now | date:\'yyyy\'"></span>\n<a\n  ng-href="//{{$ctrl.orgLinkUrl}}"\n  target="_blank"\n  rel="noopener noreferrer">{{$ctrl.orgLinkText}}</a>. All rights reserved.\n<br>\n<a href="/privacy.html" target="_blank">Privacy</a>\n<span ng-if="$ctrl.supportUrl"> -\n\t<a ng-href="{{$ctrl.supportUrl}}">Support</a>\n</span>\n',$i=function(){function CopyrightController(){this.now=new Date,this.itt={copyrightOrg:"TELLING STORY",orgLinkUrl:"inthetelling.com",orgLinkText:"IN THE TELLING"},this.np={copyrightOrg:"Narrative",orgLinkUrl:"narrasys.com",orgLinkText:"Narrasys"}}return Object.defineProperty(CopyrightController.prototype,"copyrightOrg",{get:function(){return this[this.org].copyrightOrg},enumerable:!0,configurable:!0}),Object.defineProperty(CopyrightController.prototype,"orgLinkUrl",{get:function(){return this[this.org].orgLinkUrl},enumerable:!0,configurable:!0}),Object.defineProperty(CopyrightController.prototype,"orgLinkText",{get:function(){return this[this.org].orgLinkText},enumerable:!0,configurable:!0}),CopyrightController}(),wi=function(){function Copyright(){this.bindings={org:"@",supportUrl:"@"},this.template=Ci,this.controller=$i}return Copyright.Name="npCopyright",Copyright}(),Ii='\n<div ng-if="$ctrl.appState.viewMode != \'watch\'" ng-class="$ctrl.brandingDivClass">\n\n  <div ng-if="$ctrl.proTemplate" class="branding--content">\n    <np-copyright org="np" class="professional__copyright"></np-copyright>  \n    <div class="professional__logo"></div>\n  </div>\n  \n  <a\n    ng-if="!$ctrl.proTemplate"\n    ng-repeat="logoImg in $ctrl.logos"\n    ng-class="logoImg.css_class"\n    ng-href="{{logoImg.url}}"\n    target="_blank"\n    rel="noopener noreferrer">\n      <img ng-src="{{logoImg.src}}" alt="{{logoImg.alt_text}}"/>\n  </a>\n  <np-copyright ng-if="!$ctrl.proTemplate" class="copyright" org="np"></np-copyright>\n</div>\n\n<div ng-if="$ctrl.bannerLogo != null" ng-class="$ctrl.bannerLogo.css_class">\n  <img\n    ng-if="$ctrl.bannerLogo.src"\n    ng-src="{{$ctrl.bannerLogo.src}}"\n    alt="{{ctrl.bannerLogo.alt_text}}"/>\n</div>\n',ki=function(){function EpisodeFooterController(e){this.appState=e}return Object.defineProperty(EpisodeFooterController.prototype,"proTemplate",{get:function(){if(this.templateData)return this.templateData.pro_episode_template},enumerable:!0,configurable:!0}),Object.defineProperty(EpisodeFooterController.prototype,"bannerLogo",{get:function(){if(this.templateData&&null!=this.templateData.css_configuration)return this.templateData.css_configuration.legacy_banner_logo},enumerable:!0,configurable:!0}),Object.defineProperty(EpisodeFooterController.prototype,"logos",{get:function(){if(this.templateData&&null!=this.templateData.css_configuration)return this.templateData.css_configuration.legacy_logos},enumerable:!0,configurable:!0}),EpisodeFooterController.prototype.$onChanges=function(e){e.templateData.isFirstChange()||(this.templateData.pro_episode_template?this.brandingDivClass="professional__branding":this.brandingDivClass="branding footer")},EpisodeFooterController.$inject=["appState"],EpisodeFooterController}(),Pi=function(){function EpisodeFooter(){this.bindings={templateData:"<"},this.template=Ii,this.controller=ki}return EpisodeFooter.Name="npEpisodeFooter",EpisodeFooter}(),Ai=angular.module("np.episode",[]),xi=[ui,Ei],Li=[wi,Pi,di];xi.forEach(function(e){Ai.service(e.Name,e)}),Li.forEach(function(e){Ai.component(e.Name,new e)}),Ai.directive("ittEpisode",ittEpisode);var Ni=i("oN2c"),Ui=i.n(Ni),Mi=function(){function DiscovermodeTemplate(){this.restrict="EA",this.template=Ui.a,this.scope=!0}return DiscovermodeTemplate.factory=function(){return function(){return new DiscovermodeTemplate}},DiscovermodeTemplate.Name="npDiscovermodeTemplate",DiscovermodeTemplate}(),Fi=i("0BWP"),Oi=i.n(Fi),Di=function(){function ReviewmodeTemplate(){this.restrict="EA",this.template=Oi.a,this.scope=!0}return ReviewmodeTemplate.factory=function(){return function(){return new ReviewmodeTemplate}},ReviewmodeTemplate.Name="npReviewmodeTemplate",ReviewmodeTemplate}(),Vi=i("+tHN"),Ri=i.n(Vi),Bi=function(){function VideoTemplate(){this.restrict="EA",this.template=Ri.a,this.scope=!0}return VideoTemplate.factory=function(){return function(){return new VideoTemplate}},VideoTemplate.Name="npVideoTemplate",VideoTemplate}(),ji=i("ETbY"),Hi=i.n(ji),qi=function(){function WatchmodeTemplate(){this.restrict="EA",this.template=Hi.a,this.scope=!0}return WatchmodeTemplate.factory=function(){return function(){return new WatchmodeTemplate}},WatchmodeTemplate.Name="npWatchmodeTemplate",WatchmodeTemplate}(),Wi=i("lw8s"),zi=i.n(Wi),Ki=function(){function WindowfgTemplate(){this.restrict="EA",this.template=zi.a,this.scope=!0}return WindowfgTemplate.factory=function(){return function(){return new WindowfgTemplate}},WindowfgTemplate.Name="npWindowfgTemplate",WindowfgTemplate}(),Gi=angular.module("np.viewModes",[]);[Mi,Di,Bi,qi,Ki].forEach(function(e){Gi.directive(e.Name,e.factory())}),ittItem.$inject=["$http","$timeout","$interval","authSvc","appState","analyticsSvc","timelineSvc","modelSvc","selectService","playbackService","urlService","validationSvc","episodeEdit"],ItemController.$inject=["$scope","timelineSvc"];var Qi=i("5EdM"),Xi=i.n(Qi),Yi=function(e){return"Annotation"===e._type&&e.component_name===p.TRANSCRIPT_TEMPLATE},Ji=function(e,t){return e.start_time-t.start_time},Zi=function(e,t,i){if("Chapter"===t._type)return!1;if(!e)return!1;for(var n,a=e.end_time,r=i.sort(Ji),s=0,o=r.length;s<o;s+=1)if(r[s]._id===t._id){n=r[s+1];break}return n&&n.start_time<e.end_time&&(a=n.start_time),a},en=function(){function ItemEditorController(e,t,i,n,a,r,s,o,l){this.$rootScope=e,this.$timeout=t,this.errorSvc=i,this.appState=n,this.modelSvc=a,this.timelineSvc=r,this.selectService=s,this.episodeEdit=o,this.authSvc=l,this.uploadStatus=[]}return Object.defineProperty(ItemEditorController.prototype,"customEndTime",{get:function(){return this.isAutoEndTime()},enumerable:!0,configurable:!0}),Object.defineProperty(ItemEditorController.prototype,"canAccess",{get:function(){return this.authSvc.userHasRole("admin")||this.authSvc.userHasRole("customer admin")},enumerable:!0,configurable:!0}),ItemEditorController.prototype.$onInit=function(){this.timelineSvc.pause(),this.timelineSvc.seek(this.item.start_time),this.uploadStatus=[];var e=this.modelSvc.episodes[this.appState.episodeId];this.annotators=e.annotators,this.episodeContainerId=e.container_id,this.languages=e.languages,this.itemForm=this.selectService.setupItemForm(this.item.styles,"item"),this.item.layouts||(this.item.layouts=["inline"]),this.dismissalWatcher=this.$rootScope.$on("player.dismissAllPanels",this.cancelEdit.bind(this)),this.sxsItemComponentFieldName=this.appState.product+"-"+this.item.producerItemType+"-field",this.uneditedItem=angular.copy(this.item)},ItemEditorController.prototype.userHasRole=function(e){return this.authSvc.userHasRole(e)},ItemEditorController.prototype.forcePreview=function(){this.appState.editEvent.fnord=this.appState.editEvent.fnord?"":"fnord"},ItemEditorController.prototype.isAutoEndTime=function(){var e=Yi(this.item)?this.episodeEdit.getTranscriptItems():[],t=Zi(this.getCurrentScene(this.item),this.item,e);return this.item.end_time===t},ItemEditorController.prototype.cancelEdit=function(){this.episodeEdit.cancelEventEdit(this.uneditedItem)},ItemEditorController.prototype.saveEvent=function(){var e=this;this.blockDoubleClicks=!0;var t=angular.copy(this.appState.editEvent),i=this.uneditedItem;this.episodeEdit.saveEvent(t,i).finally(function(){return e.blockDoubleClicks=!1})},ItemEditorController.prototype.resolveEvents=function(){this.modelSvc.resolveEpisodeEvents(this.appState.episodeId)},ItemEditorController.prototype.deriveEvent=function(e){var t;t=null!=e&&"boolean"!=typeof e?e:this.appState.editEvent;var i=this.modelSvc.cache("event",t);return i.styles=this.selectService.handleEventItemFormUpdate(this.itemForm),null!=e&&("boolean"==typeof e&&!0===e||"object"==typeof e)&&this.resolveEvents(),i},ItemEditorController.prototype.onTemplateChange=function(e){this.item.component_name=e,this.selectService.onSelectChange(this.item,this.itemForm),this.updateEventTemplate(this.deriveEvent(this.item))},ItemEditorController.prototype.updateEventTemplate=function(e){this.item instanceof Q?(this.updateLayoutTemplate(e),this.updateItemTemplate()):this.updateItemTemplate()},ItemEditorController.prototype.updateItemTemplate=function(){var e=this;this.item.renderTemplate=!1,this.$timeout(function(){e.item.renderTemplate=!0})},ItemEditorController.prototype.updateLayoutTemplate=function(e){var t=this;this.appState.editEvent=e,this.appState.editEvent.renderTemplate=!1,this.$timeout(function(){t.appState.editEvent.renderTemplate=!0,t.appState.editEvent=angular.copy(e)},10)},ItemEditorController.prototype.getCurrentScene=function(e){return"Scene"===e._type?e:this.modelSvc.events[this.item.scene_id]},ItemEditorController.$inject=["$rootScope","$timeout","errorSvc","appState","modelSvc","timelineSvc","selectService","episodeEdit","authSvc"],ItemEditorController}(),tn=function(){function ItemEditor(){this.bindings={item:"<"},this.template=Xi.a,this.controller=en}return ItemEditor.Name="npItemEditor",ItemEditor}(),nn=i("8WnQ"),an=i.n(nn);ittItemDetailModal.$inject=["appState"];var rn=i("UGDl"),sn=i.n(rn);ittIframe.$inject=["appState"];var on=i("wJ/0"),ln=i.n(on),cn=componentTemplateNameify(p.FILE_TEMPLATE),dn=function(){function FileTemplate(){this.restrict="EA",this.template=ln.a,this.scope=!0}return FileTemplate.factory=function(){return function(){return new FileTemplate}},FileTemplate.Name=cn,FileTemplate}(),pn=i("kCnN"),un=i.n(pn),mn=componentTemplateNameify(p.HEADER_ONE_TEMPLATE),hn=function(){function HeaderOneTemplate(){this.restrict="EA",this.template=un.a,this.scope=!0}return HeaderOneTemplate.factory=function(){return function(){return new HeaderOneTemplate}},HeaderOneTemplate.Name=mn,HeaderOneTemplate}(),gn=i("Ambl"),vn=i.n(gn),fn=componentTemplateNameify(p.HEADER_TWO_TEMPLATE),yn=function(){function HeaderTwoTemplate(){this.restrict="EA",this.template=vn.a,this.scope=!0}return HeaderTwoTemplate.factory=function(){return function(){return new HeaderTwoTemplate}},HeaderTwoTemplate.Name=fn,HeaderTwoTemplate}(),_n=i("9DBX"),Sn=i.n(_n),bn=componentTemplateNameify(p.IMAGE_THUMBNAIL_TEMPLATE),Tn=function(){function ImageThumbnailTemplate(){this.restrict="EA",this.template=Sn.a,this.scope=!0}return ImageThumbnailTemplate.factory=function(){return function(){return new ImageThumbnailTemplate}},ImageThumbnailTemplate.Name=bn,ImageThumbnailTemplate}(),En=i("es1d"),Cn=i.n(En),$n=componentTemplateNameify(p.SLIDING_CAPTION),wn=function(){function ImageCaptionSlidingTemplate(){this.restrict="EA",this.template=Cn.a,this.scope=!0}return ImageCaptionSlidingTemplate.factory=function(){return function(){return new ImageCaptionSlidingTemplate}},ImageCaptionSlidingTemplate.Name=$n,ImageCaptionSlidingTemplate}(),In=i("+Pmc"),kn=i.n(In),Pn=componentTemplateNameify(p.IMAGE_FILL_TEMPLATE),An=function(){function ImageFillTemplate(){this.restrict="EA",this.template=kn.a,this.scope=!0}return ImageFillTemplate.factory=function(){return function(){return new ImageFillTemplate}},ImageFillTemplate.Name=Pn,ImageFillTemplate}(),xn=i("qBCb"),Ln=i.n(xn),Nn=componentTemplateNameify(p.IMAGE_INLINE_WITHTEXT_TEMPLATE),Un=function(){function ImageInlineWithtextTemplate(){this.restrict="EA",this.template=Ln.a,this.scope=!0}return ImageInlineWithtextTemplate.factory=function(){return function(){return new ImageInlineWithtextTemplate}},ImageInlineWithtextTemplate.Name=Nn,ImageInlineWithtextTemplate}(),Mn=i("NEUm"),Fn=i.n(Mn),On=componentTemplateNameify(p.IMAGE_PLAIN_TEMPLATE),Dn=function(){function ImagePlainTemplate(){this.restrict="EA",this.template=Fn.a,this.scope=!0}return ImagePlainTemplate.factory=function(){return function(){return new ImagePlainTemplate}},ImagePlainTemplate.Name=On,ImagePlainTemplate}(),Vn=i("LrgT"),Rn=i.n(Vn),Bn=componentTemplateNameify(p.LINK_TEMPLATE),jn=function(){function LinkTemplate(){this.restrict="EA",this.template=Rn.a,this.scope=!0}return LinkTemplate.factory=function(){return function(){return new LinkTemplate}},LinkTemplate.Name=Bn,LinkTemplate}(),Hn=i("AEnZ"),qn=i.n(Hn),Wn=componentTemplateNameify(p.LINK_DESCRIPTION_FIRST_TEMPLATE),zn=function(){function LinkDescriptionfirstTemplate(){this.restrict="EA",this.template=qn.a,this.scope=!0}return LinkDescriptionfirstTemplate.factory=function(){return function(){return new LinkDescriptionfirstTemplate}},LinkDescriptionfirstTemplate.Name=Wn,LinkDescriptionfirstTemplate}(),Kn=i("mOi1"),Gn=i.n(Kn),Qn=componentTemplateNameify(p.LINK_EMBED_TEMPLATE),Xn=function(){function LinkEmbedTemplate(){this.restrict="EA",this.template=Gn.a,this.scope=!0}return LinkEmbedTemplate.factory=function(){return function(){return new LinkEmbedTemplate}},LinkEmbedTemplate.Name=Qn,LinkEmbedTemplate}(),Yn=i("k90U"),Jn=i.n(Yn),Zn=componentTemplateNameify(p.LINK_MODAL_THUMB_TEMPLATE),ea=function(){function LinkModalThumbTemplate(){this.restrict="EA",this.template=Jn.a,this.scope=!0}return LinkModalThumbTemplate.factory=function(){return function(){return new LinkModalThumbTemplate}},LinkModalThumbTemplate.Name=Zn,LinkModalThumbTemplate}(),ta=i("kr2K"),ia=i.n(ta),na=componentTemplateNameify(p.LINK_WITHIMAGE_NOTITLE_TEMPLATE),aa=function(){function LinkWithimageNotitleTemplate(){this.restrict="EA",this.template=ia.a,this.scope=!0}return LinkWithimageNotitleTemplate.factory=function(){return function(){return new LinkWithimageNotitleTemplate}},LinkWithimageNotitleTemplate.Name=na,LinkWithimageNotitleTemplate}(),ra=i("3/az"),sa=i.n(ra),oa=componentTemplateNameify(p.PULLQUOTE_TEMPLATE),la=function(){function PullquoteTemplate(){this.restrict="EA",this.template=sa.a,this.scope=!0}return PullquoteTemplate.factory=function(){return function(){return new PullquoteTemplate}},PullquoteTemplate.Name=oa,PullquoteTemplate}(),ca=i("VCZZ"),da=i.n(ca),pa=componentTemplateNameify(p.QUESTION_TEMPLATE),ua=function(){function QuestionMcTemplate(){this.restrict="EA",this.template=da.a,this.scope=!0}return QuestionMcTemplate.factory=function(){return function(){return new QuestionMcTemplate}},QuestionMcTemplate.Name=pa,QuestionMcTemplate}(),ma=i("jiyv"),ha=i.n(ma),ga=componentTemplateNameify(p.SXS_ANNOTAITON_TEMPLATE),va=function(){function SxsAnnotationTemplate(){this.restrict="EA",this.template=ha.a,this.scope=!0}return SxsAnnotationTemplate.factory=function(){return function(){return new SxsAnnotationTemplate}},SxsAnnotationTemplate.Name=ga,SxsAnnotationTemplate}(),fa=i("L+g8"),ya=i.n(fa),_a=componentTemplateNameify(p.SXS_FILE_TEMPLATE),Sa=function(){function SxsFileTemplate(){this.restrict="EA",this.template=ya.a,this.scope=!0}return SxsFileTemplate.factory=function(){return function(){return new SxsFileTemplate}},SxsFileTemplate.Name=_a,SxsFileTemplate}(),ba=i("rw5t"),Ta=i.n(ba),Ea=componentTemplateNameify(p.SXS_IMAGE_TEMPLATE),Ca=function(){function SxsImageTemplate(){this.restrict="EA",this.template=Ta.a,this.scope=!0}return SxsImageTemplate.factory=function(){return function(){return new SxsImageTemplate}},SxsImageTemplate.Name=Ea,SxsImageTemplate}(),$a=i("g3Y4"),wa=i.n($a),Ia=componentTemplateNameify(p.SXS_LINK_TEMPLATE),ka=function(){function SxsLinkTemplate(){this.restrict="EA",this.template=wa.a,this.scope=!0}return SxsLinkTemplate.factory=function(){return function(){return new SxsLinkTemplate}},SxsLinkTemplate.Name=Ia,SxsLinkTemplate}(),Pa=i("GAbr"),Aa=i.n(Pa),xa=componentTemplateNameify(p.SXS_QUESTION_TEMPLATE),La=function(){function SxsQuestionTemplate(){this.restrict="EA",this.template=Aa.a,this.scope=!0}return SxsQuestionTemplate.factory=function(){return function(){return new SxsQuestionTemplate}},SxsQuestionTemplate.Name=xa,SxsQuestionTemplate}(),Na=i("k5l5"),Ua=i.n(Na),Ma=componentTemplateNameify(p.SXS_VIDEO_TEMPLATE),Fa=function(){function SxsVideoTemplate(){this.restrict="EA",this.template=Ua.a,this.scope=!0}return SxsVideoTemplate.factory=function(){return function(){return new SxsVideoTemplate}},SxsVideoTemplate.Name=Ma,SxsVideoTemplate}(),Oa=i("zSN1"),Da=i.n(Oa),Va=componentTemplateNameify(p.TEXT_DEFINITION_TEMPLATE),Ra=function(){function TextDefinitionTemplate(){this.restrict="EA",this.template=Da.a,this.scope=!0}return TextDefinitionTemplate.factory=function(){return function(){return new TextDefinitionTemplate}},TextDefinitionTemplate.Name=Va,TextDefinitionTemplate}(),Ba=i("00PB"),ja=i.n(Ba),Ha=componentTemplateNameify(p.TEXT_TRANSMEDIA_TEMPLATE),qa=function(){function TextTransmediaTemplate(){this.restrict="EA",this.template=ja.a,this.scope=!0}return TextTransmediaTemplate.factory=function(){return function(){return new TextTransmediaTemplate}},TextTransmediaTemplate.Name=Ha,TextTransmediaTemplate}(),Wa=i("eHBc"),za=i.n(Wa),Ka=componentTemplateNameify(p.TRANSCRIPT_TEMPLATE),Ga=function(){function TranscriptTemplate(){this.restrict="EA",this.template=za.a,this.scope=!0}return TranscriptTemplate.factory=function(){return function(){return new TranscriptTemplate}},TranscriptTemplate.Name=Ka,TranscriptTemplate}(),Qa=i("OklN"),Xa=i.n(Qa),Ya=function(){function SearchresultsAllTemplate(){this.restrict="EA",this.template=Xa.a,this.scope=!0}return SearchresultsAllTemplate.factory=function(){return function(){return new SearchresultsAllTemplate}},SearchresultsAllTemplate.Name="npSearchresultsAllTemplate",SearchresultsAllTemplate}(),Ja=i("d3rl"),Za=i.n(Ja),er=componentTemplateNameify(p.USC_BADGES_TEMPLATE),tr=function(){function UscBadgesTemplate(){this.restrict="EA",this.template=Za.a,this.scope=!0}return UscBadgesTemplate.factory=function(){return function(){return new UscBadgesTemplate}},UscBadgesTemplate.Name=er,UscBadgesTemplate}(),ir=i("S0MD"),nr=i.n(ir),ar=componentTemplateNameify(p.USC_BADGES_INNER_TEMPLATE),rr=function(){function UscBadgesInnerTemplate(){this.restrict="EA",this.template=nr.a,this.scope=!0}return UscBadgesInnerTemplate.factory=function(){return function(){return new UscBadgesInnerTemplate}},UscBadgesInnerTemplate.Name=ar,UscBadgesInnerTemplate}(),sr=i("j+BF"),or=i.n(sr),lr=function(){function CaptionTemplate(){this.restrict="EA",this.template=or.a,this.scope=!0}return CaptionTemplate.factory=function(){return function(){return new CaptionTemplate}},CaptionTemplate.Name="npCaptionTemplate",CaptionTemplate}(),cr=angular.module("np.item",[]),dr=[dn,hn,yn,wn,An,Un,Dn,Tn,jn,zn,Xn,ea,aa,la,ua,va,Sa,Ca,ka,La,Fa,Ra,qa,Ga,Ya,tr,rr,lr];cr.directive("ittItem",ittItem).controller("ItemController",ItemController).component(tn.Name,new tn).directive("ittItemDetailModal",ittItemDetailModal).directive("ittIframe",ittIframe),dr.forEach(function(e){cr.directive(e.Name,e.factory())});var pr=function(){function Autofocus(e){this.$timeout=e,this.restrict="A"}return Autofocus.factory=function(){var e=function(e){return new Autofocus(e)};return e.$inject=Autofocus.$inject,e},Autofocus.prototype.link=function(e,t,i){this.$timeout(function(){"TEXTAREA"===t[0].tagName||"INPUT"===t[0].tagName?t[0].focus():t.find("input,textarea")[0].focus()})},Autofocus.Name="npAutofocus",Autofocus.$inject=["$timeout"],Autofocus}(),ur='\n<div class="field">\n\t<div class="label">{{$ctrl.label}} [{{$ctrl.appState.lang}}]\n\t\t<itt-validation-tip\n\t\t  ng-if="$ctrl.validationForm[$ctrl.textAreaName].$invalid"\n\t\t  text="Annotation Text is a required field">\n    </itt-validation-tip>\n\t</div>\n\t<np-input-i18n \n\t  class="input"\n\t  field="$ctrl.data.annotation"\n\t  on-field-change="$ctrl.dispatchUpdate($field)"\n\t  do-validate="true"\n\t  inputtype="textarea"\n\t  on-emit-name="$ctrl.onName($taName)"\n\t  np-autofocus>\n  </np-input-i18n>\n</div>\'\n',mr=function(){function AnnotationFieldController(e){this.appState=e}return AnnotationFieldController.prototype.$onInit=function(){this.textAreaName=""},AnnotationFieldController.prototype.onName=function(e){this.textAreaName=e},AnnotationFieldController.prototype.dispatchUpdate=function(e){this.data.annotation=e,this.onUpdate({$item:this.data})},AnnotationFieldController.$inject=["appState"],AnnotationFieldController}(),hr=function(){function AnnotationField(){this.bindings={data:"<",label:"@",validationForm:"<",onUpdate:"&"},this.template=ur,this.controller=mr}return AnnotationField.Name="npAnnotationField",AnnotationField}(),gr='\n<div class="field">\n\t<div class="label">Color</div>\n\t<div class="input">\n\t\t<select size="1" ng-model="$ctrl.itemForm.color" ng-change="$ctrl.onUpdate()">\n\t\t\t<option value="">(Default)</option>\n\t\t\t<option value="Invert">Invert</option>\n\t\t\t<option value="Sepia">Sepia</option>\n\t\t\t<option value="Solarized">Solarized</option>\n\t\t\t<option value="Vivid">Vivid</option>\n\t\t</select>\n\t</div>\n</div>\n',vr=function(){function ColorSelect(){this.bindings={itemForm:"<",onUpdate:"&"},this.template=gr}return ColorSelect.Name="npColorSelect",ColorSelect}(),fr='\n<div class="field">\n\t<div class="label">Description [{{$ctrl.lang}}]</div>\n\t<np-input-i18n\n\t\tng-model-options="$ctrl.modelOpts"\n\t  class="input"\n\t  field="$ctrl.data.description"\n\t  on-field-change="$ctrl.emitUpdate($field)"\n\t  inputtype="textarea">\n  </np-input-i18n>\n</div>\n',yr=function(){function DescriptionFieldController(e){this.appState=e}return Object.defineProperty(DescriptionFieldController.prototype,"lang",{get:function(){return this.appState.lang},enumerable:!0,configurable:!0}),DescriptionFieldController.prototype.emitUpdate=function(e){this.data.description=e,this.onUpdate()},DescriptionFieldController.prototype.$onInit=function(){existy(this.modelOpts)||(this.modelOpts={updateOn:"default"})},DescriptionFieldController.$inject=["appState"],DescriptionFieldController}(),_r=function(){function DescriptionField(){this.bindings={data:"<",modelOpts:"<?",onUpdate:"&?"},this.template=fr,this.controller=yr}return DescriptionField.Name="npDescriptionField",DescriptionField}(),Sr='\n<div class="field" ng-if="$ctrl.displayVisibility">\n\t<div class="label">Display</div>\n\t<div class="input">\n\t\t<select ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)"\n\t\t\tng-model="$ctrl.data.layouts[$ctrl.layoutIndex]"\n\t\t\tng-options="{{::$ctrl.setNgOpts(\'display\')}}">\n\t\t</select>\n\t</div>\n</div>\n<div class="field" ng-if="$ctrl.bgImagePositionVisibility">\n\t<div class="label">Position</div>\n\t\t<div class="input">\n\t\t<select\n\t\t  ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)"\n\t\t  ng-model="$ctrl.itemForm.position"\n\t\t  ng-options="{{$ctrl.setNgOpts(\'imagePosition\')}}">\n  </select>\n\t</div>\n</div>\n',br=function(){function DisplaySelectController(e){this.selectService=e}return Object.defineProperty(DisplaySelectController.prototype,"displayVisibility",{get:function(){return this.selectService.getVisibility("display")},enumerable:!0,configurable:!0}),Object.defineProperty(DisplaySelectController.prototype,"bgImagePositionVisibility",{get:function(){return this.selectService.getVisibility("bgImagePosition")},enumerable:!0,configurable:!0}),DisplaySelectController.prototype.getSelectOpts=function(e){return this.selectService.getSelectOpts(e)},DisplaySelectController.prototype.setNgOpts=function(e){return"option.value as option.name \n        disable when option.isDisabled\n        for option in $ctrl.getSelectOpts('"+e+"')"},DisplaySelectController.prototype.onItemFormUpdate=function(e,t){this.selectService.onSelectChange(e,t),this.data.styles=this.selectService.handleEventItemFormUpdate(t),this.onUpdate()},DisplaySelectController.prototype.$onInit=function(){this.layoutIndex="image"===this.data.producerItemType?0:1},DisplaySelectController.prototype.$onChanges=function(e){if(e&&e.componentName&&!e.componentName.isFirstChange()){var t=e.componentName.currentValue;this.isImageFillTemplate=t&&t===p.IMAGE_FILL_TEMPLATE}},DisplaySelectController.$inject=["selectService"],DisplaySelectController}(),Tr=function(){function DisplaySelect(){this.bindings={data:"<",itemForm:"<",componentName:"@",onUpdate:"&"},this.template=Sr,this.controller=br}return DisplaySelect.Name="npDisplaySelect",DisplaySelect}(),Er=function(){function DynamicModel(e,t){this.$compile=e,this.$parse=t,this.restrict="A",this.terminal=!0,this.priority=1e5}return DynamicModel.factory=function(){var e=function(e,t){return new DynamicModel(e,t)};return e.$inject=DynamicModel.$inject,e},DynamicModel.prototype.link=function(e,t){var i=this.$parse(t.attr("np-dynamic-model"))(e);t.removeAttr("np-dynamic-model"),t.attr("ng-model",i),this.$compile(t)(e)},DynamicModel.Name="npDynamicModel",DynamicModel.$inject=["$compile","$parse"],DynamicModel}(),Cr='\n<div class="field">\n  <div class="label">Flags</div>\n  <div class="input">\n    <span ng-repeat="flag in $ctrl._flags">\n      <span ng-if="flag !== \'invertColor\'">\n        <label for="{{$ctrl._ids[flag]}}"></label>\n        <input id="{{$ctrl._ids[flag]}}"\n          type="checkbox"\n          np-dynamic-model="\'$ctrl.data.\' + flag"\n          ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}}\n      </span>\n      <span ng-if="flag === \'invertColor\'">\n        <label for="{{$ctrl._ids[flag]}}"></label>\n        <input id="{{$ctrl._ids[flag]}}"\n          type="checkbox"\n          ng-model="$ctrl.itemForm.color"\n          ng-true-value="\'Invert\'"\n          ng-false-value="\'\'"\n          ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}}\n      </span>\n    </span>\n  </div>\n</div>\n',$r=function(){function FlagsController(e,t){this.$timeout=e,this.selectService=t,this._displays={required:"Required",stop:"Stop item",cosmetic:"Cosmetic",chapter_marker:"Chapter Event",invertColor:"Invert Color"},this._ids={required:"itemRequired",stop:"itemStop",cosmetic:"itemCosmetic",chapter_marker:"itemChapter",invertColor:"Invert"}}return FlagsController.prototype.$onInit=function(){this._flags=angular.copy(this.flags)},FlagsController.prototype.$onChanges=function(e){var t=this;if(e.componentName){var i=e.componentName,n=i.previousValue,a=i.currentValue;this.$timeout(function(){return t.setFlags(a,n)})}},FlagsController.prototype.handleChange=function(){this.data.hasOwnProperty("stop")&&this.selectService.onSelectChange(this.data,this.itemForm),this.emitUpdate()},FlagsController.prototype.setFlags=function(e,t){e!==t&&typeof e==typeof t&&(this.itemForm.color=""),e&&(e===p.IMAGE_FILL_TEMPLATE?this._flags=this._flags.filter(function(e){return"stop"!==e}):this._flags=this.flags,FlagsController._h1OrH2(e)?(this._flags=this.flags,this._isEditingItemForm()&&(this.itemForm.color="Invert")):(this._isEditingItemForm()&&(this.itemForm.color=""),this._flags=this._flags.filter(function(e){return"chapter_marker"!==e})),this.emitUpdate())},FlagsController._h1OrH2=function(e){return e===p.HEADER_TWO_TEMPLATE||e===p.HEADER_ONE_TEMPLATE},FlagsController.prototype.emitUpdate=function(){var e=this;this.$timeout(function(){e.onUpdate()})},FlagsController.prototype._isEditingItemForm=function(){return existy(this.itemForm)&&"internal:editing"===this.data._id},FlagsController.$inject=["$timeout","selectService"],FlagsController}(),wr=function(){function Flags(){this.bindings={flags:"<",data:"<",componentName:"@",itemForm:"<?",onUpdate:"&"},this.template=Cr,this.controller=$r}return Flags.Name="npFlags",Flags}(),Ir='\n<div class="field">\n\t<div class="label">Highlight<span ng-if="$ctrl.isEpisode"> Style</span></div>\n\t<div class="input">\n\t\t<select size="1" ng-model="$ctrl.itemForm.highlight" ng-change="$ctrl.onUpdate()">\n\t\t\t<option ng-if="$ctrl.isEpisode" value="">(Default)</option>\n\t\t\t<option ng-if="$ctrl.isScene" value="">(Inherit from episode)</option>\n\t\t\t<option ng-if="!($ctrl.isScene || $ctrl.isEpisode)" value="">(Inherit from layout)</option>\n\t\t\t<option value="None">No highlight</option>\n\t\t\t<option value="Solid">Solid</option>\n\t\t\t<option value="Border">Border</option>\n\t\t\t<option value="Side">Side</option>\n\t\t\t<option value="Bloom">Translucent</option>\n\t\t\t<option value="Tilt">Tilt</option>\n\t\t</select>\n\t</div>\n</div>\n',kr=function(){function HighlightSelectController(){}return Object.defineProperty(HighlightSelectController.prototype,"isEpisode",{get:function(){return!!this.data&&this.data instanceof M},enumerable:!0,configurable:!0}),Object.defineProperty(HighlightSelectController.prototype,"isScene",{get:function(){return!!this.data&&this.data instanceof Q},enumerable:!0,configurable:!0}),HighlightSelectController}(),Pr=function(){function HighlightSelect(){this.bindings={data:"<",itemForm:"<",onUpdate:"&"},this.template=Ir,this.controller=kr}return HighlightSelect.Name="npHighlightSelect",HighlightSelect}(),Ar='\n<div class="field">\n\t<div class="label">Languages</div>\n\t<div class="input">\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.en" ng-change="$ctrl.onLangflagChange()">English\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.es" ng-change="$ctrl.onLangflagChange()">Spanish\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.zh" ng-change="$ctrl.onLangflagChange()">Chinese\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.pt" ng-change="$ctrl.onLangflagChange()">Portuguese\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.fr" ng-change="$ctrl.onLangflagChange()">French\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.de" ng-change="$ctrl.onLangflagChange()">German\n\t</label>\n\t<label>\n\t\t<input type="checkbox" ng-model="$ctrl.langForm.it" ng-change="$ctrl.onLangflagChange()">Italian\n\t</label>\n\t</div>\n</div>\n',xr=function(){function LanguageFlagsController(){}return LanguageFlagsController.prototype.$onInit=function(){},LanguageFlagsController.$inject=[],LanguageFlagsController}(),Lr=function(){function LanguageFlags(){this.bindings={langForm:"<",onLangflagChange:"&"},this.template=Ar,this.controller=xr}return LanguageFlags.Name="npLanguageFlags",LanguageFlags}(),Nr='\n<div class="field">\n\t<div class="label">Default Language</div>\n\t<div class="input">\n\t\t<select\n\t\t  ng-change="$ctrl.onSelectChange()"\n\t\t  ng-model="$ctrl.data.defaultLanguage"\n\t\t  ng-options="{{$ctrl.ngOpts}}">\n    </select>\n\t</div>\n</div>\n',Ur=function(){function LanguageSelectController(e){this.selectService=e}return Object.defineProperty(LanguageSelectController.prototype,"langOpts",{get:function(){return this._langOpts?this._langOpts:this.selectService.getSelectOpts("language")},set:function(e){this._langOpts=e},enumerable:!0,configurable:!0}),Object.defineProperty(LanguageSelectController.prototype,"ngOpts",{get:function(){return"option.value as option.name disable when option.isDisabled for option in $ctrl.langOpts"},enumerable:!0,configurable:!0}),LanguageSelectController.prototype.$onInit=function(){this.langOpts=this.selectService.getSelectOpts("language")},LanguageSelectController.prototype.$onChanges=function(e){if(e&&e.langForm){var t=e.langForm.currentValue;this.langOpts=this.langOpts.map(function(e){return Object.entries(t).forEach(function(t){var i=t[0],n=t[1];e.value===i&&(e.isDisabled=!n)}),e})}},LanguageSelectController.$inject=["selectService"],LanguageSelectController}(),Mr=function(){function LanguageSelect(){this.bindings={data:"<",langForm:"<?",onSelectChange:"&"},this.template=Nr,this.controller=Ur}return LanguageSelect.Name="npLanguageSelect",LanguageSelect}(),Fr='\n<div class="field" ng-if="$ctrl.speakerFieldVisibility">\n\t<div class="label">Speaker [{{$ctrl.appState.lang}}]</div>\n\t<div class="input">\n\t\n    <np-annotator-autocomplete\n    \tng-model="$ctrl.data.annotator"\n    \tng-change="$ctrl.onUpdate()"\n    \titem="$ctrl.data"\n    \ton-update="$ctrl.onUpdate()"\n      annotators="$ctrl.annotators">\n    </np-annotator-autocomplete>\n\t</div>\n</div>\n',Or=function(){function SpeakerFieldController(e,t){this.selectService=e,this.appState=t}return Object.defineProperty(SpeakerFieldController.prototype,"speakerFieldVisibility",{get:function(){return this.selectService.getVisibility("speakerField")},enumerable:!0,configurable:!0}),SpeakerFieldController.prototype.$onInit=function(){},SpeakerFieldController.$inject=["selectService","appState"],SpeakerFieldController}(),Dr=function(){function SpeakerField(){this.bindings={data:"<",annotators:"<",onUpdate:"&"},this.template=Fr,this.controller=Or}return SpeakerField.Name="npSpeakerField",SpeakerField}(),Vr='\n<div class="field" ng-if="$ctrl.isVisible">\n\t<div class="label">{{$ctrl.labelText}}</div>\n\t<div class="input" ng-class="{layouts: $ctrl.labelText === \'Template\' && $ctrl.data.producerItemType === \'scene\'}">\n\t\t<select\n\t\t  ng-if="$ctrl.context === \'event\'"\n\t\t  ng-model="$ctrl.data.template_id"\n\t\t  ng-change="$ctrl.onSelectChange($ctrl.data, $ctrl.itemForm)"\n\t\t  ng-options="option.template_id as option.name disable when option.isDisabled for option in $ctrl.data.templateOpts">\n    </select>\n    \n    <select\n      ng-if="$ctrl.context === \'episode\'"\n\t\t  ng-model="$ctrl.data.template_id"\n\t\t  ng-change="$ctrl.onEpisodeTemplateChange()"\n\t\t  ng-options="option.id as option.name for option in $ctrl.data.templateOpts">\n    </select>\n\t</div>\n</div>',Rr=function(){function TemplateSelectController(e,t){this.selectService=e,this.modelSvc=t,this.labelText="Template",this.context="event"}return TemplateSelectController.prototype.$onInit=function(){if(this.isAnnotation=this.data instanceof q,this.isEpisode=this.data instanceof M,this.data instanceof M&&(this.context="episode",this.labelText="Theme"),this.isAnnotation){var e=this.selectService.getSceneName(this.modelSvc.scene(this.data.scene_id)),t="centerVV"===e,i="centerVVMondrian"===e;(t||i)&&this.data.templateOpts.forEach(function(e){"Header 1"===e.name&&(e.isDisabled=!0)})}},Object.defineProperty(TemplateSelectController.prototype,"isVisible",{get:function(){return this.selectService.getVisibility("templateSelect")},enumerable:!0,configurable:!0}),TemplateSelectController.prototype.onSelectChange=function(e,t){var i=this.modelSvc.deriveEvent(createInstance(e._type,e));this.onUpdate({$componentName:i.component_name})},TemplateSelectController.prototype.onEpisodeTemplateChange=function(){var e={$data:{episode:this.data,templateId:this.data.template_id}};this.onEpisodeEdit(e)},TemplateSelectController.$inject=["selectService","modelSvc"],TemplateSelectController}(),Br=function(){function TemplateSelect(){this.bindings={data:"<",itemForm:"<?",onEpisodeEdit:"&",onUpdate:"&"},this.template=Vr,this.controller=Rr}return TemplateSelect.Name="npTemplateSelect",TemplateSelect}(),jr='\n<div class="field" ng-if="$ctrl.hideTime">\n\t<div class="label">Start</div>\n\t<div class="input">\n  <itt-validation-tip\n    ng-if="$ctrl.ittItemForm.time.$invalid"\n    text="{{$ctrl.data.validationMessage}}">\n  </itt-validation-tip>\n\t\t<np-input-time\n\t\t  item="$ctrl.data"\n\t\t  on-field-change="$ctrl.onUpdate()"\n\t\t  input-field="start_time">\n    </np-input-time>\n\t\t<span ng-if="!($ctrl.stop || $ctrl.isScene || $ctrl.isChapter)">\n\t\t\t<span class="label"> &nbsp; &nbsp; &nbsp; End</span>\n\t\t\t<np-input-time\n\t\t\t  item="$ctrl.data" on-field-change="$ctrl.onUpdate()" input-field="end_time"></np-input-time>\n\t\t</span>\n\t</div>\n</div>\n',Hr=function(){function TimeFieldController(){}return Object.defineProperty(TimeFieldController.prototype,"hideTime",{get:function(){return this.data&&!(this.data instanceof Q&&this.data.start_time<=.1)},enumerable:!0,configurable:!0}),Object.defineProperty(TimeFieldController.prototype,"isScene",{get:function(){return this.data&&this.data instanceof Q},enumerable:!0,configurable:!0}),Object.defineProperty(TimeFieldController.prototype,"isChapter",{get:function(){return this.data&&this.data instanceof z},enumerable:!0,configurable:!0}),TimeFieldController.prototype.$onInit=function(){},TimeFieldController.$inject=[],TimeFieldController}(),qr=function(){function TimeField(){this.bindings={data:"<",itemForm:"<",onUpdate:"&"},this.template=jr,this.controller=Hr}return TimeField.Name="npTimeField",TimeField}(),Wr='\n<div class="field">\n\t<div class="label"><span ng-if="$ctrl.isEpisode">Display </span>Timestamp</div>\n\t<div class="input">\n\t\t<select size="1" ng-model="$ctrl.itemForm.timestamp" ng-change="$ctrl.onUpdate()">\n\t\t\t<option ng-if="$ctrl.isEpisode" value="">(Default)</option>\n\t\t\t<option ng-if="$ctrl.isScene" value="">(Inherit from episode)</option>\n\t\t\t<option ng-if="!$ctrl.isScene" value="">(Inherit from layout)</option>\n\t\t\t<option value="None">Off</option>\n\t\t\t<option value="Inline">On</option>\n\t\t</select>\n\t</div>\n</div>\n',zr=function(){function TimestampSelectController(){}return Object.defineProperty(TimestampSelectController.prototype,"isEpisode",{get:function(){return!!this.data&&this.data instanceof M},enumerable:!0,configurable:!0}),Object.defineProperty(TimestampSelectController.prototype,"isScene",{get:function(){return!!this.data&&this.data instanceof Q},enumerable:!0,configurable:!0}),TimestampSelectController.$inject=[],TimestampSelectController}(),Kr=function(){function TimestampSelect(){this.bindings={data:"<",itemForm:"<",onUpdate:"&"},this.template=Wr,this.controller=zr}return TimestampSelect.Name="npTimestampSelect",TimestampSelect}(),Gr='\n<div class="field" ng-if="$ctrl.isVisible">\n\t<div class="label">Title [{{$ctrl.appState.lang}}]\n\t\t<itt-validation-tip\n\t\t  ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid"\n\t\t  text="Title is a required field">\n    </itt-validation-tip>\n\t</div>\n\t<np-input-i18n\n\t  class="input"\n\t  ng-model-options="$ctrl.modelOpts"\n\t  do-validate="$ctrl.doValidate"\n\t  field="$ctrl.data.title"\n\t  on-emit-name="$ctrl.onName($taName)"\n\t  on-field-change="$ctrl.onUpdate()"\n\t  inputtype="input"\n\t  np-autofocus>\n  </np-input-i18n>\n</div>\n',Qr=function(){function TitleFieldController(e,t){this.appState=e,this.selectService=t}return Object.defineProperty(TitleFieldController.prototype,"isVisible",{get:function(){return this.selectService.getVisibility("titleField")},enumerable:!0,configurable:!0}),TitleFieldController.prototype.$onInit=function(){existy(this.modelOpts)||(this.modelOpts={updateOn:"default"})},TitleFieldController.prototype.onName=function(e){this.textAreaName=e},TitleFieldController.$inject=["appState","selectService"],TitleFieldController}(),Xr=function(){function TitleField(){this.bindings={data:"<",modelOpts:"<?",doValidate:"<?",ittItemForm:"<?",onUpdate:"&?"},this.template=Gr,this.controller=Qr}return TitleField.Name="npTitleField",TitleField}(),Yr='\n<div class="field">\n\t<div class="label">Transition</div>\n\t<div class="input">\n\t\t<select size="1" ng-model="$ctrl.itemForm.transition" ng-change="$ctrl.onUpdate()">\n\t\t\t<option ng-if="$ctrl.isEpisode" value="">(Default)</option>\n\t\t\t<option ng-if="$ctrl.isScene" value="">(Inherit from episode)</option>\n\t\t\t<option ng-if="!($ctrl.isScene || $ctrl.isEpisode)" value="">(Inherit from layout)</option>\n\t\t\t<option value="None">No transition</option>\n\t\t\t<option value="Fade">Fade</option>\n\t\t\t<option value="SlideL">Slide left</option>\n\t\t\t<option value="SlideR">Slide right</option>\n\t\t\t<option value="Pop">Pop</option>\n\t\t</select>\n\t</div>\n</div>\n',Jr=function(){function TransitionSelectController(){}return Object.defineProperty(TransitionSelectController.prototype,"isEpisode",{get:function(){return!!this.data&&this.data instanceof M},enumerable:!0,configurable:!0}),Object.defineProperty(TransitionSelectController.prototype,"isScene",{get:function(){return!!this.data&&this.data instanceof Q},enumerable:!0,configurable:!0}),TransitionSelectController.$inject=[],TransitionSelectController}(),Zr=function(){function TransitionSelect(){this.bindings={data:"<",itemForm:"<",onUpdate:"&"},this.template=Yr,this.controller=Jr}return TransitionSelect.Name="npTransitionSelect",TransitionSelect}(),es='\n<div class="field">\n\t<div class="label">Typography</div>\n\t<div class="input">\n\t\t<select size="1" ng-model="$ctrl.itemForm.typography" ng-change="$ctrl.onUpdate()">\n\t\t\t<option value="">(Default)</option>\n\t\t\t<option value="Sans">Sans</option>\n\t\t\t<option value="Serif">Serif</option>\n\t\t\t<option value="Book">Book</option>\n\t\t\t<option value="Swiss">Swiss</option>\n\t\t</select>\n\t</div>\n</div>\n',ts=function(){function TypographySelectController(){}return TypographySelectController.$inject=[],TypographySelectController}(),is=function(){function TypographySelect(){this.bindings={itemForm:"<",onUpdate:"&"},this.template=es,this.controller=ts}return TypographySelect.Name="npTypographySelect",TypographySelect}(),ns=function(){function ValidAsset(){this.restrict="A",this.require={ngModel:"^ngModel"},this.scope={asset:"<",componentName:"@"},this.bindToController=!0,this.controller=function(){function ValidAssetController(){}return ValidAssetController.prototype.$onChanges=function(e){if(e&&null!=this.ngModel){var t=e.componentName,i=e.asset,n=void 0;n=null==t?this.componentName:t.currentValue,this.handleNameChanges(n,i.currentValue)}},ValidAssetController.prototype.handleNameChanges=function(e,t){switch(e){case p.FILE_TEMPLATE:case p.IMAGE_PLAIN_TEMPLATE:case p.IMAGE_INLINE_WITHTEXT_TEMPLATE:case p.SLIDING_CAPTION:case p.IMAGE_FILL_TEMPLATE:case p.LINK_WITHIMAGE_NOTITLE_TEMPLATE:null!=t?this.ngModel.$setValidity("itemAsset",!0):this.ngModel.$setValidity("itemAsset",!1);break;case p.LINK_TEMPLATE:case p.LINK_MODAL_THUMB_TEMPLATE:case p.LINK_DESCRIPTION_FIRST_TEMPLATE:case p.LINK_EMBED_TEMPLATE:this.ngModel.$setValidity("itemAsset",!0)}},ValidAssetController}()}return ValidAsset.factory=function(){var e=function(){return new ValidAsset};return e.$inject=ValidAsset.$inject,e},ValidAsset.prototype.link=function(e,t,i,n){},ValidAsset.Name="npValidAsset",ValidAsset.$inject=[],ValidAsset}(),as=function(){function ValidEpisodeUrl(e,t){this.urlService=e,this.authSvc=t,this.restrict="A",this.require="?ngModel",this.scope={onValidationNotice:"&"}}return ValidEpisodeUrl.factory=function(){var e=function(e,t){return new ValidEpisodeUrl(e,t)};return e.$inject=ValidEpisodeUrl.$inject,e},ValidEpisodeUrl.prototype.link=function(e,t,i,n){function watchFields(){return s}function handleUpdates(t){e.onValidationNotice({$notice:t})}var a=this,r={showInfo:!1,message:"",doInfo:!1},s={kaltura:r,youtube:r,html5:r,error:r},o=function(e){if(s={},n.$isEmpty(e))return s.error={showInfo:!0,message:"Field cannot be blank."},!1;if(a.urlService.isVideoUrl(e)){var t=a.urlService.checkUrl(e).type;return"html5"===t||"wistia"===t&&!a.authSvc.userHasRole("admin")?(s[t]={showInfo:!0,message:capitalize(t)+" video currently not supported"},!1):(s[t]={showInfo:!0,message:capitalize(t)+" detected",doInfo:!0},!0)}return s.error={showInfo:!0,message:e+" is not a valid episode URL"},!1};n.$validators={episodeUrl:o},e.$watch(watchFields,handleUpdates,!0)},ValidEpisodeUrl.Name="npValidEpisodeUrl",ValidEpisodeUrl.$inject=["urlService","authSvc"],ValidEpisodeUrl}();ittValidEpisodeUrl.$inject=["urlService","ittUtils","authSvc"];var rs=function(){function ValidPathSlug(e){this.modelSvc=e,this.restrict="A",this.require=["^ngModel","^npGuestAccessibleUrl"]}return ValidPathSlug.factory=function(){var e=function(e){return new ValidPathSlug(e)};return e.$inject=ValidPathSlug.$inject,e},ValidPathSlug.prototype.link=function(e,t,i,n){function validPathslug(e){if(r[r.type].error=null,a.$isEmpty(e))return r[r.type].error="Slug cannot be empty",!0;var t=slugify(e);return-1!==_gatherPathSlugs(o,l).indexOf(t)&&(r[r.type].error=t+" is already taken."),!0}function _gatherPathSlugs(e,t){return e.reduce(function(e,i){if(i.path_slug&&i.path_slug.en)if(existy(t)){if(t!==i._id)return e.push(i.path_slug.en),e}else e.push(i.path_slug.en);return e},[])}var a=n[0],r=n[1],s=this.modelSvc.customers[r.narrative.customer_id]||r.customer,o="narrative"===r.type?this.modelSvc.cachedNarrativesByCustomer(s):r.narrative.timelines,l=r[r.type]._id;a&&(a.$validators={validPathslug:validPathslug})},ValidPathSlug.Name="npValidPathSlug",ValidPathSlug.$inject=["modelSvc"],ValidPathSlug}();ittValidPathslug.$inject=["modelSvc","ittUtils"];var ss=function(){function ValidUrl(){this.restrict="A",this.require="?ngModel"}return ValidUrl.factory=function(){var e=function(){return new ValidUrl};return e.$inject=ValidUrl.$inject,e},ValidUrl.prototype.link=function(e,t,i,n){n&&(n.$validators.supportUrl=function(e){return n.$isEmpty(e)||isValidURL(e)})},ValidUrl.Name="npValidUrl",ValidUrl}(),os='\n<div class="field" ng-if="$ctrl.selectService.getVisibility(\'videoPosition\')">\n  <div class="label">Video Position</div>\n  <div class="input">\n    <select\n      ng-change="$ctrl.onUpdate()"\n      ng-model="$ctrl.data.layouts[0]"\n      ng-options="option.value as option.name for option in $ctrl.selectService.getSelectOpts(\'video\')">\n    </select>\n  </div>\n</div>\n',ls=function(){function VideoPositionSelectController(e){this.selectService=e}return VideoPositionSelectController.$inject=["selectService"],VideoPositionSelectController}(),cs=function(){function VideoPositionSelect(){this.bindings={data:"<",onUpdate:"&"},this.template=os,this.controller=ls}return VideoPositionSelect.Name="npVideoPositionSelect",VideoPositionSelect}(),ds=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function fulfilled(e){try{step(n.next(e))}catch(e){r(e)}}function rejected(e){try{step(n.throw(e))}catch(e){r(e)}}function step(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})},ps=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(a=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){s.label=r[1];break}if(6===r[0]&&s.label<a[1]){s.label=a[1],a=r;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(r);break}a[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,n,a,r,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},us='\n<div class="field">\n  <div class="label">{{$ctrl.label || "URL"}}\n    <span ng-repeat="(field, val) in $ctrl.validatedFields">\n      <itt-validation-tip ng-if="val.showInfo" text="{{val.message}}" do-info="val.doInfo"></itt-validation-tip>\n     </span>\n  </div>\n  <div class="input" ng-if="$ctrl.context !== \'episode\'">\n    <div  class="ittUrl__escapeLink">\n      <input\n        id="urlEscapeLink"\n        type="checkbox"\n        ng-change="$ctrl.onForceNewTabChange()"\n        ng-true-value="\'_blank\'"\n        ng-false-value="\'_self\'"\n        ng-disabled="!$ctrl.canEmbed"\n        ng-model="$ctrl.data.target"/>\n      <span class="escapelink"></span>\n      <label for="urlEscapeLink">Force new tab</label>\n\n    </div>\n    <input\n      type="text"\n      name="itemUrl"\n      ng-blur="$ctrl.onUrlFieldChange($ctrl.eventUrl)"\n      ng-focus="$ctrl.onFocused()"\n      ng-model="$ctrl.eventUrl"/>\n  </div>\n  <div class="input" ng-if="$ctrl.context === \'episode\'">\n    <input\n      type="text"\n      ng-model="$ctrl.data"\n      np-valid-episode-url\n      on-validation-notice="$ctrl.handleEpisodeValidationMessage($notice)"/>\n    <button ng-if="$ctrl.data" ng-click="$ctrl.onAttach({$url: $ctrl.data})">Attach Video</button>\n  </div>\n</div>\n',ms=function(){function UrlFieldController(e,t){this.$timeout=e,this.validationSvc=t,this.validatedFields={url:null,iframeHeaders:null,404:null,301:null,mixedContent:null},this.message={showInfo:!1,message:"",doInfo:!1}}return UrlFieldController.prototype.$onInit=function(){this.data&&this.data.url&&(this.eventUrl=this.data.url,null==this.context&&(this.context="producer"),"episode"!==this.context&&this.onUrlFieldChange(this.eventUrl,this.data.url_status))},UrlFieldController.prototype.updateTemplateOpts=function(){this.data.templateOpts=this._disableTemplateOpts("_blank"===this.data.target)},UrlFieldController.prototype.onFocused=function(){this._setValidity(!1)},UrlFieldController.prototype.onForceNewTabChange=function(){this.updateTemplateOpts(),this.onUpdate()},UrlFieldController.prototype.onUrlFieldChange=function(e,t){if("https://"===e)return void this._setValidity(!1);this._itemUrlValidationPipeline(e,t,this.context)},UrlFieldController.prototype.handleEpisodeValidationMessage=function(e){this.validatedFields={kaltura:null,youtube:null,html5:null,error:null},Object.assign(this.validatedFields,e)},UrlFieldController.prototype._inspectHeaders=function(e,t,i){return ds(this,void 0,void 0,function(){var n,a,r,s,o,l;return ps(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.validationSvc.inspectHeadersAsync(e,this,t,i)];case 1:return n=c.sent(),a=n.canEmbed,r=n.location,s=n.urlStatus,this._setValidity(!0),o=this.validationSvc.mixedContent(r||e,this),this.canEmbed=a&&!o,this.canEmbed||(this.data.target="_blank"),this.updateTemplateOpts(),this.data.url_status=Object.assign(new j,s),this.data.url=r||e,this.eventUrl=this.data.url,[3,3];case 2:return l=c.sent(),this._setValidity(!1),[3,3];case 3:return[2]}})})},UrlFieldController.prototype._itemUrlValidationPipeline=function(e,t,i){var n=this;this._resetFields(),this._setValidity(this.validationSvc.validateUrl(e,this))?this._inspectHeaders(e,t,i).then(function(){return n.onUpdate()}):this.onUpdate()},UrlFieldController.prototype._disableTemplateOpts=function(e){if(!0===e&&(this.data.showInlineDetail=!1),"editor"!==this.context&&"editor-video"!==this.context)return this.data.templateOpts.map(function(t){return t.component_name!==p.LINK_EMBED_TEMPLATE&&t.component_name!==p.LINK_MODAL_THUMB_TEMPLATE||(t.isDisabled=e),t})},UrlFieldController.prototype._setValidity=function(e,t){return void 0===t&&(t="itemUrl"),null!=this.ittItemForm&&this.ittItemForm.$setValidity(t,e,null),e},UrlFieldController.prototype._resetFields=function(){var e=this;Object.keys(this.validatedFields).forEach(function(t){return e.validatedFields[t]=e.message})},UrlFieldController.$inject=["$timeout","validationSvc"],UrlFieldController}(),hs=function(){function UrlField(){this.bindings={data:"<",context:"@?",label:"@",onAttach:"&",ittItemForm:"<?",onUpdate:"&?"},this.template=us,this.controller=ms}return UrlField.Name="npUrlField",UrlField}(),gs='\n<div ng-show="!$ctrl.appState.editEvent && !$ctrl.appState.editEpisode" class="controlPanel" ng-class="{\n\tisProducer: $ctrl.appState.product == \'producer\',\n\tisSxS: $ctrl.appState.product == \'sxs\'\n}">\n\n\t<div ng-if="$ctrl.appState.product == \'producer\'" class="editButtonPanel">\n\t\t<a class="button button-episode" ng-click="$ctrl.editEpisode()">Edit episode</a>\n\t\t<a\n\t\t  class="button button-scene"\n\t\t  ng-if="$ctrl.renderAddLayoutButton"\n\t\t  ng-click="$ctrl.episodeEdit.editCurrentScene()">Edit Layout</a>\n\t</div>\n\n\t<div class="producer addButtonPanel" ng-show="$ctrl.showAddEventButton">\n\t\t<span ng-if="$ctrl.expanded" style="padding: 0 1em" class="animate transitionExpandW">\n\t\t\t<span ng-if="$ctrl.appState.product == \'sxs\'">\n\t\t\t\t<a class="button button-comment" ng-click="$ctrl.addEvent(\'annotation\')">Comment</a>\n\t\t\t\t<a class="button button-link" ng-click="$ctrl.addEvent(\'link\')">Link</a>\n\t\t\t\t<a class="button button-question" ng-click="$ctrl.addEvent(\'question\')">Question</a>\n\t\t\t\t<a class="button button-image" ng-click="$ctrl.addEvent(\'image\')">Image</a>\n\t\t\t\t<a class="button button-file" ng-click="$ctrl.addEvent(\'file\')">File</a>\n\t\t\t\t<a class="button button-video" ng-click="$ctrl.addEvent(\'video\')">Video</a>\n\t\t\t</span>\n\t\t\t<span ng-if="$ctrl.appState.product == \'producer\'">\n\t\t\t\t<a class="button button-scene" ng-click="$ctrl.addEvent(\'scene\')">Layout</a>\n\t\t\t\t<a class="button button-comment" ng-click="$ctrl.addEvent(\'transcript\')">Transcript</a>\n\t\t\t\t<a class="button button-comment" ng-click="$ctrl.addEvent(\'annotation\')">Annotation</a>\n\t\t\t\t<a class="button button-link" ng-click="$ctrl.addEvent(\'link\')">Link</a>\n\t\t\t\t<a class="button button-image" ng-click="$ctrl.addEvent(\'image\')">Image</a>\n\t\t\t\t<a\n\t\t\t\t  class="button button-file"\n\t\t\t\t  ng-click="$ctrl.addEvent(\'file\')"\n\t\t\t\t  ng-if="$ctrl.userHasRole(\'admin\') || $ctrl.userHasRole(\'customer admin\')">File</a>\n\t\t\t\t<a class="button button-question" ng-click="$ctrl.addEvent(\'question\')">Question</a>\n\t\t\t\t<a class="button button-chapter" ng-click="$ctrl.addEvent(\'chapter\')">Chapter</a>\n\t\t\t</span>\n\t\t</span>\n\t\t<span ng-if="!$ctrl.expanded">\n\t\t\t<a class="button button-add" ng-click="$ctrl.expand()">Add</a>\n\t\t</span>\n\t</div>\n</div>\n\n',vs=function(){function AddContentController(e,t,i,n){this.appState=e,this.playbackService=t,this.episodeEdit=i,this.authSvc=n}return Object.defineProperty(AddContentController.prototype,"renderAddLayoutButton",{get:function(){return this.playbackService.getMetaProp("time")>0&&this.playbackService.getMetaProp("time")<this.playbackService.getMetaProp("duration")-.1&&"discover"===this.appState.viewMode},enumerable:!0,configurable:!0}),Object.defineProperty(AddContentController.prototype,"showAddEventButton",{get:function(){return!this.item&&this.playbackService.getMetaProp("time")>0&&this.playbackService.getMetaProp("time")<this.playbackService.getMetaProp("duration")-.1},enumerable:!0,configurable:!0}),AddContentController.prototype.userHasRole=function(e){return this.authSvc.userHasRole(e)},AddContentController.prototype.expand=function(){var e=this;this.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){e.collapse()})},AddContentController.prototype.collapse=function(){this.expanded=!1},AddContentController.prototype.editEpisode=function(){this.episodeEdit.setEpisodeToEdit()},AddContentController.prototype.addEvent=function(e){this.episodeEdit.addEvent(e)},AddContentController.$inject=["appState","playbackService","episodeEdit","authSvc"],AddContentController}(),fs=function(){function AddContent(){this.bindings={},this.template=gs,this.controller=vs}return AddContent.Name="npAddContent",AddContent}(),ys=function(e){var t=Object.keys(e).map(function(t){return e[t]}),i=t.pop(),n=t.sort(function(e,t){return e.key.toLowerCase()<t.key.toLowerCase()?-1:e.key.toLowerCase()>t.key.toLowerCase()?1:0});return n.push(i),n.reduce(function(e,t){return e[t.key]=t,e},{})},_s='\n<div style="position:relative;" ng-show="!$ctrl.hasAnnotator()">\n\n\t<input\n\t  class="annotatorChooser"\n\t  type="text"\n\t  ng-model="$ctrl.searchText"\n\t  ng-focus="$ctrl.showAutocomplete()"\n\t  ng-blur="$ctrl.hideAutocomplete()"\n\t  ng-change="$ctrl.handleAutocomplete()">\n\n\t<div class="autocompleteList animate transitionFade" ng-if="$ctrl.autoCompleting">\n\t\t<div class="autocompleteItem"\n\t\t  ng-repeat="annotator in $ctrl.filteredAnnotators"\n\t\t  ng-click="$ctrl.select(annotator)"\n\t\t  ng-class="{selected: ($index == $ctrl.preselectedItem)}"\n\t\t  style="white-space: nowrap">\n\t\t\t<img ng-src="{{annotator.imageUrl}}">\n\t\t\t<span ng-bind-html="(annotator.key | highlightSubstring: $ctrl.searchText) || \'(New speaker)\'"></span>\n\t\t</div>\n\t</div>\n</div>\n<div style="position:relative;" ng-show="$ctrl.hasAnnotator()">\n\t<np-input-i18n\n\t  on-field-change="$ctrl.onUpdate()"\n\t  field="$ctrl.item.annotator"\n\t  inputtype="input">\n</np-input-i18n>\n\t<a style="position: absolute; top: 3px; right: 10px" ng-click="$ctrl.item.annotator={}">(x)</a>\n</div>\n',Ss=function(){function AnnotatorAutocompleteController(e,t,i,n){this.$element=e,this.$timeout=t,this.modelSvc=i,this.appState=n}return AnnotatorAutocompleteController.prototype.$onInit=function(){var e=this;angular.forEach(this.annotators,function(t){t.annotation_image_id&&(t.imageUrl=e.modelSvc.assets[t.annotation_image_id].url)}),this.annotator={name:this.item.annotator},this.item.annotator&&this.item.annotator.name&&this.annotators[this.item.annotator.name]&&this.annotators[this.item.annotator.name].annotation_image_id&&(this.annotator.imageUrl=this.modelSvc.assets[this.annotators[this.item.annotator.name].annotation_image_id].url),this.filteredAnnotators=ys(angular.copy(this.annotators)),this.preselectedItem=-1},AnnotatorAutocompleteController.prototype.$postLink=function(){var e=this;this.$element.find(".annotatorChooser").bind("keydown",function(t){switch(t.which){case 40:e.preselectedItem=(e.preselectedItem+1)%Object.keys(e.filteredAnnotators).length;break;case 38:e.preselectedItem=(e.preselectedItem-1)%Object.keys(e.filteredAnnotators).length;break;case 13:t.preventDefault(),e.preselectedItem>-1&&e.selectByIndex(e.preselectedItem)}})},AnnotatorAutocompleteController.prototype.hasAnnotator=function(){if(this.item&&this.item.annotator)return Object.keys(this.item.annotator).length>0},AnnotatorAutocompleteController.prototype.selectByIndex=function(e){if(!(e<0)){var t=Object.keys(this.filteredAnnotators).sort();this.select(this.filteredAnnotators[t[e]])}},AnnotatorAutocompleteController.prototype.select=function(e){this.preselectedItem=-1,e.annotation_image_id?(this.item.annotation_image_id=e.annotation_image_id,this.item.asset=this.modelSvc.assets[e.annotation_image_id],this.annotator.imageUrl=this.item.asset.url):(delete this.annotator.imageUrl,delete this.item.asset),this.ngModelController.$setViewValue(e.name),this.searchText=""},AnnotatorAutocompleteController.prototype.showAutocomplete=function(){var e=this.$element.find(".annotatorChooser")[0];e.setSelectionRange(0,e.value.length),this.autoCompleting=!0},AnnotatorAutocompleteController.prototype.handleAutocomplete=function(){var e=this;if(this.annotator.name="",this.searchText){this.preselectedItem=-1;var t={};angular.forEach(this.annotators,function(i){i.key.toLowerCase().indexOf(e.searchText.toLowerCase())>-1&&(t[i.key]=i)}),this.filteredAnnotators=t,1===Object.keys(this.filteredAnnotators).length&&(this.preselectedItem=0)}else this.filteredAnnotators=angular.copy(this.annotators),this.preselectedItem=-1;this.onUpdate()},AnnotatorAutocompleteController.prototype.hideAutocomplete=function(){var e=this;this.$timeout(function(){e.preselectedItem>-1?e.selectByIndex(e.preselectedItem):""!==e.searchText&&e.addNewAnnotator(),e.autoCompleting=!1},300)},AnnotatorAutocompleteController.prototype.addNewAnnotator=function(){var e=this.searchText;this.item.annotator={},this.item.annotator[this.appState.lang]=e,this.searchText="",this.handleAutocomplete()},AnnotatorAutocompleteController.$inject=["$element","$timeout","modelSvc","appState"],AnnotatorAutocompleteController}(),bs=function(){function AnnotatorAutocomplete(){this.require={ngModelController:"ngModel"},this.bindings={annotators:"<",item:"<",onUpdate:"&"},this.template=_s,this.controller=Ss}return AnnotatorAutocomplete.Name="npAnnotatorAutocomplete",AnnotatorAutocomplete}(),Ts='\n<input\n  ng-if="$ctrl.inputtype==\'input\'"\n  ng-change="$ctrl.emitUpdate()"\n  ng-model="$ctrl.field[$ctrl.appState.lang]"\n  name="{{$ctrl.textangularname}}"\n  ng-required="$ctrl.doValidate">\n<text-angular\n  ng-if="$ctrl.inputtype == \'textarea\'"\n  name="{{$ctrl.textangularname}}"\n  ng-required="$ctrl.doValidate"\n  ng-model="$ctrl.field[$ctrl.appState.lang]"\n  ta-paste="$ctrl.sanitizePastedHtml($html)"\n  ta-default-wrap="span"\n  ng-change="$ctrl.emitUpdate()"\n  ng-blur="$ctrl.trim()">\n</text-angular>\n\n',Es=function(){function InputI18nController(e,t,i,n){this.$timeout=e,this.$attrs=t,this.appState=i,this.textAngularManager=n}return InputI18nController.prototype.$onInit=function(){var e=this;null==this.field&&(this.field={}),null==this.field[this.appState.lang]&&(this.field={en:""}),this.textangularname="ta"+(new Date).getUTCMilliseconds()+"y"+Math.random().toString(16),this.onEmitName({$taName:this.textangularname}),"textarea"===this.inputtype&&this.$timeout(function(){if(void 0!==e.$attrs.npAutofocus){e.textAngularManager.retrieveEditor(e.textangularname).scope.displayElements.text.trigger("focus")}})},InputI18nController.prototype.emitUpdate=function(){this.onFieldChange({$field:this.field})},InputI18nController.prototype.trim=function(){var e=this.field[this.appState.lang];e&&(e=e.replace(/<br\/>/g,"<br>"),e=e.replace(/<div>/g,"<br>"),e=e.replace(/<\/?(span|div)>/g,""),e=e.replace(/(<br>)*$/,""),this.field[this.appState.lang]=e.trim())},InputI18nController.prototype.sanitizePastedHtml=function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent},InputI18nController.$inject=["$timeout","$attrs","appState","textAngularManager"],InputI18nController}(),Cs=function(){function InputI18n(){this.bindings={field:"<",inputtype:"@",doValidate:"<",onEmitName:"&",onFieldChange:"&?"},this.template=Ts,this.controller=Es}return InputI18n.Name="npInputI18n",InputI18n}(),$s='\n<span class="floaterContainer">\n\t<input\n\t  class="inputfield"\n\t  ng-model="$ctrl.model"\n\t  ng-change="$ctrl.handleUpdates()"\n\t  name="time"\n\t  ng-focus="$ctrl.showTools(true)"\n\t  ng-blur="$ctrl.showTools(false)"\n\t  ng-model-options="{ updateOn: \'blur\' }"\n\t  style="max-width: 150px"\n\t  ng-class="{invalid: ($ctrl.fieldname == \'end_time\' && $ctrl.item.invalid_end_time)}">\n\t<div class="floater" ng-if="$ctrl.tooltip">\n\n\t\t<ul style="list-style:none; white-space:nowrap">\n\t\t\t<li style="text-align:center; font-size: 150%">\n\t\t\t\t<a ng-click="$ctrl.nudge(-5)">Â«</a>\n\t\t\t\t<a ng-click="$ctrl.nudge(-1)">â€¹</a>\n\t\t\t\t<span> &nbsp;&nbsp; </span>\n\t\t\t\t<a ng-click="$ctrl.nudge(1)">â€º</a>\n\t\t\t\t<a ng-click="$ctrl.nudge(5)">Â»</a>\n\t\t\t</li>\n\t\t\t<li ng-click="$ctrl.setTime($ctrl.playbackService.getMetaProp(\'time\'))">\n\t\t\t\t<a>Set to current time ({{::$ctrl.format($ctrl.playbackService.getMetaProp(\'time\'))}})</a>\n\t\t\t</li>\n\t\t\t<span ng-if="$ctrl.item._type != \'Scene\' && $ctrl.scene().start_time > 0">\n\t\t\t\t<li ng-if="$ctrl.fieldname==\'start_time\'" ng-click="$ctrl.setTime($ctrl.scene().start_time)">\n\t\t\t\t\t<a>Beginning of layout ({{$ctrl.format($ctrl.scene().start_time)}})</a>\n\t\t\t\t</li>\n\t\t\t\t<li ng-if="$ctrl.fieldname==\'end_time\'" ng-click="$ctrl.setTime($ctrl.scene().end_time)">\n\t\t\t\t\t<a>End of layout ({{$ctrl.format($ctrl.scene().end_time)}})</a>\n\t\t\t\t</li>\n\t\t\t\t<li ng-if="$ctrl.fieldname==\'end_time\' && $ctrl.isTranscript()" ng-click="TODO">\n\t\t\t\t\t<a>Auto (TODO)</a>\n\t\t\t\t</li>\n\t\t\t</span>\n\t\t</ul>\n\t</div>\n</span>\n\n',ws=function(e){return existy(e)&&e>.1},Is=function(){function InputTimeController(e,t,i,n,a,r,s){this.$attrs=e,this.$rootScope=t,this.$timeout=i,this.appState=n,this.modelSvc=a,this.timelineSvc=r,this.playbackService=s}return InputTimeController.prototype.$onInit=function(){var e=this;this.item instanceof Q?this.scene=function(){return e.item}:this.scene=function(){return e.modelSvc.sceneAtEpisodeTime(e.item.cur_episode_id,e.playbackService.getMetaProp("time"))},this.fieldname=angular.copy(this.$attrs.inputField),this.realValue=angular.copy(this.item[this.$attrs.inputField]),this.model=this.format(angular.copy(this.item[this.$attrs.inputField])),this.episodeDuration=this.modelSvc.episodes[this.item.cur_episode_id].masterAsset.duration},InputTimeController.prototype.parse=function(e){var t;if(void 0===e||""===e)t=this.playbackService.getMetaProp("time");else if(isNaN(e)){var i=e.split(":");2===i.length?(isNaN(i[0])&&(i[0]=0),isNaN(i[1])&&(i[1]=0),t=60*Number(i[0])+Number(i[1])):t=this.playbackService.getMetaProp("time")}else t=e;return t<.01&&(t=.01),this.$rootScope.$emit("searchReindexNeeded"),t},InputTimeController.prototype.format=function(e){var t=Math.floor(e/60),i=Math.round(e%60*100)/100;return i<10&&(i="0"+i),t+":"+i},InputTimeController.prototype.nudge=function(e){this.$timeout.cancel(this.tooltipHider);var t=e/30;this.setTime(this.item[this.$attrs.inputField]+t),"start_time"===this.$attrs.inputField&&this.timelineSvc.seek(this.item[this.$attrs.inputField]+t)},InputTimeController.prototype.setTime=function(e){!1!==this.handelValidation(e)&&(e>this.episodeDuration&&(e=this.episodeDuration),this.item.stop&&(this.item.end_time=e),this.realValue=e,this.item[this.$attrs.inputField]=this.realValue,this.model=this.format(e),this.item.invalid_end_time=this.item.start_time>this.item.end_time,this.onFieldChange())},InputTimeController.prototype.showTools=function(e){var t=this;e?this.tooltip=!0:this.tooltipHider=this.$timeout(function(){t.tooltip=!1},300)},InputTimeController.prototype.isTranscript=function(){return!1},InputTimeController.prototype.handleUpdates=function(){var e=this.parse(this.model);this.setTime(e),"start_time"===this.$attrs.inputField&&this.item.stop&&(this.item.end_time=e),this.onFieldChange()},InputTimeController.prototype.handelValidation=function(e){if(this.item.validationMessage=null,this.ngForm.time.$setValidity("time",!0),"Scene"!==this.item._type)return!0;var t=!1,i=ws(e),n=this.validateSceneStartTime(e);return t=i&&n,t||this.ngForm&&(this.ngForm.time.$setValidity("time",!1),this.ngForm.time.$setViewValue(this.format(e)),this.ngForm.time.$render(),n||(this.item.validationMessage="Scenes cannot share the same start time."),i||(this.item.validationMessage="For a start time <=0:00.1, please edit the first layout")),t},InputTimeController.prototype.validateSceneStartTime=function(e){var t,i=!0;return this.item.start_time!==e&&(t=this.modelSvc.isOnExistingSceneStart(e),i=!t),i},InputTimeController.$inject=["$attrs","$rootScope","$timeout","appState","modelSvc","timelineSvc","playbackService","ittUtils"],InputTimeController}(),ks=function(){function InputTime(){this.require={ngForm:"?^^form"},this.bindings={item:"<",onFieldChange:"&"},this.template=$s,this.controller=Is}return InputTime.Name="npInputTime",InputTime}(),Ps=i("pkcl"),As=i.n(Ps),xs=function(){function UploadMasterassetTemplate(){this.restrict="EA",this.template=As.a,this.scope=!0}return UploadMasterassetTemplate.factory=function(){return function(){return new UploadMasterassetTemplate}},UploadMasterassetTemplate.Name="npUploadMasterassetTemplate",UploadMasterassetTemplate}(),Ls=i("9Hwp"),Ns=i.n(Ls),Us=function(){function UploadPosterTemplate(){this.restrict="EA",this.template=Ns.a,this.scope=!0}return UploadPosterTemplate.factory=function(){return function(){return new UploadPosterTemplate}},UploadPosterTemplate.Name="npUploadPosterTemplate",UploadPosterTemplate}(),Ms=i("aqvw"),Fs=i.n(Ms),Os=function(){function UploadProducerTemplate(){this.restrict="EA",this.template=Fs.a,this.scope=!0}return UploadProducerTemplate.factory=function(){return function(){return new UploadProducerTemplate}},UploadProducerTemplate.Name="npUploadProducerTemplate",UploadProducerTemplate}(),Ds=i("foaR"),Vs=i.n(Ds),Rs=function(){function UploadSxsTemplate(){this.restrict="EA",this.template=Vs.a,this.scope=!0}return UploadSxsTemplate.factory=function(){return function(){return new UploadSxsTemplate}},UploadSxsTemplate.Name="npUploadSxsTemplate",UploadSxsTemplate}(),Bs='\n<div class="field" ng-show="$ctrl.visibility">\n\t<div class="label">{{$ctrl.label}}\n\t\t<itt-validation-tip ng-if="$ctrl.showValidationTip" text="{{$ctrl.label}} is required"></itt-validation-tip>\n\t</div>\n\t<div ng-if="$ctrl.context === \'producer\'" class="input" np-upload-producer-template></div>\n\t<div ng-if="$ctrl.context === \'editor\'" class="input" np-upload-sxs-template></div>\n</div>\n',js=function(){function ProducerUploadFieldController(e,t){this.selectSerivce=e,this.episodeEdit=t}return Object.defineProperty(ProducerUploadFieldController.prototype,"visibility",{get:function(){return"Image"!==this.label||this.selectSerivce.getVisibility("imageUpload")},enumerable:!0,configurable:!0}),Object.defineProperty(ProducerUploadFieldController.prototype,"showValidationTip",{get:function(){return null!=this.validationForm&&this.validationForm.itemAsset&&this.validationForm.itemAsset.$invalid},enumerable:!0,configurable:!0}),ProducerUploadFieldController.prototype.$onInit=function(){m[this.data.producerItemType]?this.mimes=m[this.data.producerItemType]:this.mimes=m.default},ProducerUploadFieldController.prototype.replaceAsset=function(){this.showUploadButtons=!0,this.episodeEdit.replaceAsset(),this.onUpdate()},ProducerUploadFieldController.prototype.attachChosenAsset=function(e,t){this.showAssetPicker=!1,this.showUploadButtons=!1,this.episodeEdit.attachChosenAsset(e,t),this.onUpdate()},ProducerUploadFieldController.prototype.assetUploaded=function(e){this.episodeEdit.assetUploaded(e),this.showUploadButtons=!1,this.showUploadField=!1,this.onUpdate()},ProducerUploadFieldController.prototype.detachAsset=function(){this.episodeEdit.detachAsset(),this.selectSerivce.onSelectChange(this.data,this.itemForm),this.onUpdate()},ProducerUploadFieldController.$inject=["selectService","episodeEdit"],ProducerUploadFieldController}(),Hs=function(){function ProducerUploadField(){this.bindings={context:"@",label:"@",data:"<",validationForm:"<?",itemForm:"<",episodeContainerId:"@",onUpdate:"&?"},this.template=Bs,this.controller=js}return ProducerUploadField.Name="npProducerUploadField",ProducerUploadField}(),qs=angular.module("np.inputFields",[]),Ws=[pr,xs,Us,Os,Rs,ns,ss,rs,as,Er],zs=[pr,hr,vr,_r,Tr,wr,Pr,Lr,Mr,Dr,Br,qr,Kr,Xr,Zr,is,y,cs,hs,fs,bs,Cs,ks,Hs];Ws.forEach(function(e){qs.directive(e.Name,e.factory())}),zs.forEach(function(e){qs.component(e.Name,new e)});ittScene.$inject=["$timeout","appState"],SceneController.$inject=["$scope","$filter","ittUtils"];var Ks=i("KCjZ"),Gs=i.n(Ks),Qs=componentTemplateNameify(p.CENTER_VV_TEMPLATE),Xs=function(){function CenterVvTemplate(){this.restrict="EA",this.template=Gs.a,this.scope=!0}return CenterVvTemplate.factory=function(){return function(){return new CenterVvTemplate}},CenterVvTemplate.Name=Qs,CenterVvTemplate}(),Ys=i("KIuG"),Js=i.n(Ys),Zs=componentTemplateNameify(p.CENTER_VV_MONDRIAN_TEMPLATE),eo=function(){function CenterVvMondrianTemplate(){this.restrict="EA",this.template=Js.a,this.scope=!0}return CenterVvMondrianTemplate.factory=function(){return function(){return new CenterVvMondrianTemplate}},CenterVvMondrianTemplate.Name=Zs,CenterVvMondrianTemplate}(),to=i("Twex"),io=i.n(to),no=componentTemplateNameify(p.CENTERED_TEMPLATE),ao=function(){function CenteredTemplate(){this.restrict="EA",this.template=io.a,this.scope=!0}return CenteredTemplate.factory=function(){return function(){return new CenteredTemplate}},CenteredTemplate.Name=no,CenteredTemplate}(),ro=i("k/N7"),so=i.n(ro),oo=componentTemplateNameify(p.CENTERED_PRO_TEMPLATE),lo=function(){function CenteredProTemplate(){this.restrict="EA",this.template=so.a,this.scope=!0}return CenteredProTemplate.factory=function(){return function(){return new CenteredProTemplate}},CenteredProTemplate.Name=oo,CenteredProTemplate}(),co=i("sbOf"),po=i.n(co),uo=componentTemplateNameify(p.CORNER_H_TEMPLATE),mo=function(){function CornerHTemplate(){this.restrict="EA",this.template=po.a,this.scope=!0}return CornerHTemplate.factory=function(){return function(){return new CornerHTemplate}},CornerHTemplate.Name=uo,CornerHTemplate}(),ho=i("Tc0T"),go=i.n(ho),vo=componentTemplateNameify(p.CORNER_V_TEMPLATE),fo=function(){function CornerVTemplate(){this.restrict="EA",this.template=go.a,this.scope=!0}return CornerVTemplate.factory=function(){return function(){return new CornerVTemplate}},CornerVTemplate.Name=vo,CornerVTemplate}(),yo=i("lvPu"),_o=i.n(yo),So=componentTemplateNameify(p.ENDINGSCREEN_TEMPLATE),bo=function(){function EndingscreenTemplate(){this.restrict="EA",this.template=_o.a,this.scope=!0}return EndingscreenTemplate.factory=function(){return function(){return new EndingscreenTemplate}},EndingscreenTemplate.Name=So,EndingscreenTemplate}(),To=i("/w+Y"),Eo=i.n(To),Co=componentTemplateNameify(p.LANDINGSCREEN_TEMPLATE),$o=function(){function LandingscreenTemplate(){this.restrict="EA",this.template=Eo.a,this.scope=!0}return LandingscreenTemplate.factory=function(){return function(){return new LandingscreenTemplate}},LandingscreenTemplate.Name=Co,LandingscreenTemplate}(),wo=i("bINW"),Io=i.n(wo),ko=componentTemplateNameify(p.MIRRORED_TWOCOL_TEMPLATE),Po=function(){function MirroredTwocolTemplate(){this.restrict="EA",this.template=Io.a,this.scope=!0}return MirroredTwocolTemplate.factory=function(){return function(){return new MirroredTwocolTemplate}},MirroredTwocolTemplate.Name=ko,MirroredTwocolTemplate}(),Ao=i("6mC1"),xo=i.n(Ao),Lo=componentTemplateNameify(p.ONECOL_TEMPLATE),No=function(){function OnecolTemplate(){this.restrict="EA",this.template=xo.a,this.scope=!0}return OnecolTemplate.factory=function(){return function(){return new OnecolTemplate}},OnecolTemplate.Name=Lo,OnecolTemplate}(),Uo=i("I/G4"),Mo=i.n(Uo),Fo=componentTemplateNameify(p.PIP_TEMPLATE),Oo=function(){function PipTemplate(){this.restrict="EA",this.template=Mo.a,this.scope=!0}return PipTemplate.factory=function(){return function(){return new PipTemplate}},PipTemplate.Name=Fo,PipTemplate}(),Do=angular.module("np.scenes",[]),Vo=[Xs,eo,ao,lo,mo,fo,bo,$o,Po,No,Oo];Do.directive("ittScene",ittScene).controller("SceneController",SceneController),Vo.forEach(function(e){Do.directive(e.Name,e.factory())});timelineSvc_timelineSvc.$inject=["$window","$timeout","$interval","$filter","modelSvc","appState","analyticsSvc","playbackService","ittUtils"];var Ro=i("j8FC"),Bo=i.n(Ro);ittTimeline.$inject=["$timeout","appState","timelineSvc","modelSvc","playbackService"],TimelineController.$inject=["$scope","$rootScope","timelineSvc","playbackService","analyticsSvc","appState","modelSvc"];var jo=angular.module("np.timeline",[]);jo.factory("timelineSvc",timelineSvc_timelineSvc).directive("ittTimeline",ittTimeline).controller("TimelineController",TimelineController);var Ho=i("CKMt"),qo=i.n(Ho);playbackService_playbackService.$inject=["$interval","youTubePlayerManager","html5PlayerManager","kalturaPlayerManager","wistiaPlayerManager","ittUtils","urlService","PLAYERSTATES_WORD","PLAYERSTATES"];var Wo={mainPlayer:!1,playerState:"-1",div:"",ready:!1,startAtTime:0,hasResumedFromStartAt:!1,duration:0,time:0,hasBeenPlayed:!1,bufferedPercent:0,timeMultiplier:1,resetInProgress:!1,autoplay:!1,volume:100,muted:!1};playerManagerCommons.$inject=["ittUtils"],urlService_urlService.$inject=["youtubeUrlService","html5UrlService","kalturaUrlService","wistiaUrlService"],html5PlayerManager.$inject=["$interval","PLAYERSTATES","ittUtils","appState","playerManagerCommons"],html5UrlService_html5UrlService.$inject=["ittUtils"];var zo=angular.module("np.html5",[]);zo.factory("html5UrlService",html5UrlService_html5UrlService).factory("html5PlayerManager",html5PlayerManager);youTubePlayerManager.$inject=["$location","ittUtils","YTScriptLoader","errorSvc","PLAYERSTATES","youtubeUrlService","playerManagerCommons"],YTScriptLoader.$inject=["$q","$timeout"],youtubeUrlService_youtubeUrlService.$inject=["ittUtils"];angular.module("np.youtube",[]).factory("youTubePlayerManager",youTubePlayerManager).factory("YTScriptLoader",YTScriptLoader).factory("youtubeUrlService",youtubeUrlService_youtubeUrlService);kalturaPlayerManager.$inject=["ittUtils","PLAYERSTATES","playerManagerCommons","kalturaScriptLoader","kalturaUrlService"],kalturaScriptLoader.$inject=["$q","ittUtils"],kalturaUrlService_kalturaUrlService.$inject=[];var Ko=angular.module("np.kaltura",[]);Ko.factory("kalturaPlayerManager",kalturaPlayerManager).factory("kalturaScriptLoader",kalturaScriptLoader).factory("kalturaUrlService",kalturaUrlService_kalturaUrlService);var Go=function(){function BasePlayerManager(){this.players={},this.statechangeCallbacks=[]}return BasePlayerManager.createMetaObj=function(e){var t={instance:null,meta:Object.assign({},Wo)};return Object.assign(Wo,e),Object.assign(t.meta,Wo),t},BasePlayerManager.prototype.getPlayer=function(e){if(existy(this.players[e]))return this.players[e]},BasePlayerManager.prototype.setInstance=function(e,t){var i=this.getPlayer(e);existy(i)&&(i.instance=t)},BasePlayerManager.prototype.setPlayer=function(e,t){this.players[e]=t},BasePlayerManager.prototype.getMetaProp=function(e,t){var i=this.getPlayer(e);if(existy(i)&&existy(i.meta))return i.meta[t]},BasePlayerManager.prototype.setMetaProp=function(e,t,i){if(existy(this.players[e])&&this.players[e].meta)try{this.players[e].meta[t]=i}catch(e){}},BasePlayerManager.prototype.getPlayerDiv=function(e){return this.getMetaProp(e,"div")},BasePlayerManager.prototype.getPlayerState=function(e){return""},BasePlayerManager.prototype.pause=function(e){},BasePlayerManager.prototype.stop=function(e){},BasePlayerManager.prototype.freezeMetaProps=function(e){},BasePlayerManager.prototype.unFreezeMetaProps=function(e){},BasePlayerManager.prototype.pauseOtherPlayers=function(e){var t=this;Object.keys(this.players).forEach(function(i){if(i!==e){var n=t.getPlayerState(i);existy(n)&&"playing"===n&&t.pause(i)}})},BasePlayerManager.prototype.registerStateChangeListener=function(e){this.statechangeCallbacks.find(function(t){return e.toString()===t.toString()})||this.statechangeCallbacks.push(e)},BasePlayerManager.prototype.unregisterStateChangeListener=function(e){this.statechangeCallbacks=this.statechangeCallbacks.filter(function(t){return t.toString!==e.toString()})},BasePlayerManager.prototype.renamePid=function(e,t){renameKey(e,t,this.players)},BasePlayerManager.prototype.handleTimelineEnd=function(e){},BasePlayerManager.prototype.resetPlayerManager=function(){var e=this;Object.keys(this.players).forEach(function(t){e.destroyInstance(t,!0)}),this.players={}},BasePlayerManager.prototype.destroyInstance=function(e,t){existy(t)||(t=!1),this.destroySideEffects(e),!0===t&&this.setPlayer(e,{})},BasePlayerManager.prototype.destroySideEffects=function(e){},BasePlayerManager}(),Qo={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued",4:"quality changed",6:"player ready"},Xo=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function __(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)}}(),Yo=this&&this.__assign||Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Jo={playing:"playing",paused:"paused",beforeplay:"unstarted",ended:"ended"},Zo={videoType:"wistia",lastVol:100,bufferingInterval:null,lastVideoTime:0},el=function(e){function WistiaPlayerManager(t,i,n){var a=e.call(this)||this;return a.$interval=t,a.wistiaScriptLoader=i,a.wistiaUrlService=n,a.type="wistia",a._bufferCheckIntervalLength=100,a}return Xo(WistiaPlayerManager,e),WistiaPlayerManager.setPlayerDiv=function(e,t){return'\n<div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;">\n  <div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;">\n    <div id="'+e+'" class="wistia_embed wistia_async_'+t+'" style="height:100%;width:100%">&nbsp;</div>\n  </div>\n</div>\n'},WistiaPlayerManager.formatStateChangeEvent=function(e,t){return{emitterId:t,state:Qo[e]}},WistiaPlayerManager.prototype.seedPlayerManager=function(e,t,i){if(!(existy(this.getPlayer(e))&&this.getMetaProp(e,"startAtTime")>0)){t&&(this.players={},this.mainPlayerId=e);var n=this.wistiaUrlService.extractId(i[0]),a=Yo({mainPlayer:t,div:WistiaPlayerManager.setPlayerDiv(e,n),wistiaId:n},Zo);this.setPlayer(e,WistiaPlayerManager.createMetaObj(a))}},WistiaPlayerManager.prototype.create=function(e){var t=this;this.createWpInstance(e).then(function(i){var n=t.$interval(function(){var i=t.getMetaProp(e,"lastVideoTime"),n=t.getMetaProp(e,"time"),a=n-i;a>=1&&a<=2&&(t.setMetaProp(e,"playerState",3),t.setMetaProp(e,"time",i),t.emitStateChange(e))},t._bufferCheckIntervalLength);t.setMetaProp(e,"bufferingInterval",n)})},WistiaPlayerManager.prototype.getPlayerState=function(e){var t=this.getInstance(e);if(t)return Jo[t.state()]},WistiaPlayerManager.prototype.getBufferedPercent=function(e){return 0},WistiaPlayerManager.prototype.getCurrentTime=function(e){return this.invokeMethod(e,"time")},WistiaPlayerManager.prototype.play=function(e){this.invokeMethod(e,"play")},WistiaPlayerManager.prototype.pause=function(e){this.invokeMethod(e,"pause")},WistiaPlayerManager.prototype.seekTo=function(e,t){this.invokeMethod(e,"time",t)},WistiaPlayerManager.prototype.setSpeed=function(e,t){this.invokeMethod(e,"playbackRate",t)},WistiaPlayerManager.prototype.toggleMute=function(e){var t=this.getMetaProp(e,"muted");!1===t?(this.setMetaProp(e,"lastVol",this.getMetaProp(e,"volume")),this.setVolume(e,0)):this.setVolume(e,this.getMetaProp(e,"lastVol")),this.setMetaProp(e,"muted",!t)},WistiaPlayerManager.prototype.setVolume=function(e,t){this.invokeMethod(e,"volume",t/100),this.setMetaProp(e,"volume",t)},WistiaPlayerManager.prototype.destroySideEffects=function(e){this.$interval.cancel(this.getMetaProp(e,"bufferingInterval"))},WistiaPlayerManager.prototype.invokeMethod=function(e,t,i){var n=this.getInstance(e);if(existy(n))try{return existy(i)?n[t](i):n[t]()}catch(e){}},WistiaPlayerManager.prototype.getInstance=function(e){if(existy(this.getPlayer(e))&&!0===this.getMetaProp(e,"ready"))return this.getPlayer(e).instance},WistiaPlayerManager.prototype.createWpInstance=function(e){var t=this,i=this.mainPlayerId!==e,n={playbar:i,videoFoam:!1,fullscreenButton:i,controlsVisibleOnLoad:i,playbackRateControl:i,playButton:i,settingsControl:i,qualityControl:i,smallPlayButton:i,volumeControl:i};return this.wistiaScriptLoader.load(e).then(function(i){window.wistiaInitQueue=window.wistiaInitQueue||[],window.wistiaInitQueue.push({id:e,options:n,onReady:function(i){return t.onReady(e,i)}})})},WistiaPlayerManager.prototype.onReady=function(e,t){this.setInstance(e,t),this.attachEventListeners(t,e),this.emitStateChange(e,6),this.setMetaProp(e,"duration",t.duration())},WistiaPlayerManager.prototype.attachEventListeners=function(e,t){var i=this,n=function(e){return function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return t.call.apply(t,[i,e].concat(n))}}(t),a={play:function(e){return n(i.onPlay)},pause:function(e){return n(i.onPause)},seek:function(e,t){return n(i.onSeek,e,t)},timechange:function(e){return n(i.onTimechange,e)}};Object.entries(a).forEach(function(t){var i=t[0],n=t[1];e.bind(i,n)})},WistiaPlayerManager.prototype.onTimechange=function(e,t){var i=this.getMetaProp(e,"time");this.setMetaProp(e,"lastVideoTime",t),i>t&&this.setMetaProp(e,"time",t)},WistiaPlayerManager.prototype.onSeek=function(e,t,i){var n=this.getMetaProp(e,"duration");if(this.setMetaProp(e,"time",t),this.setMetaProp(e,"lastVideoTime",t),Math.floor(n-t)<.3)return this.setMetaProp(e,"playerState",0),void this.emitStateChange(e)},WistiaPlayerManager.prototype.onPlay=function(e){this.setMetaProp(e,"playerState",1),this.emitStateChange(e),e!==this.mainPlayerId&&"unstarted"!==this.getPlayerState(e)&&this.pauseOtherPlayers(e)},WistiaPlayerManager.prototype.onPause=function(e){this.setMetaProp(e,"playerState",2),this.emitStateChange(e)},WistiaPlayerManager.prototype.emitStateChange=function(e,t){var i;i=existy(t)?t:this.getMetaProp(e,"playerState"),this.statechangeCallbacks.forEach(function(t){t(WistiaPlayerManager.formatStateChangeEvent(i,e))})},WistiaPlayerManager.Name="wistiaPlayerManager",WistiaPlayerManager.$inject=["$interval","wistiaScriptLoader","wistiaUrlService"],WistiaPlayerManager}(Go),tl=function(){function WistiaScriptLoader(e){this.$q=e,this.WISTIA_HREF="https://fast.wistia.com/assets/external/E-v1.js"}return WistiaScriptLoader.prototype.load=function(e){var t=this;return this.$q(function(i){"undefined"==typeof Wistia?t._appendScript(e,i):i()})},WistiaScriptLoader.prototype._appendScript=function(e,t){var i=document.createElement("script");i.setAttribute("src",this.WISTIA_HREF),i.setAttribute("type","text/javascript"),i.setAttribute("async",""),i.id=e;var n=document.getElementsByTagName("script")[0];n.parentElement.insertBefore(i,n),i.onload=t},WistiaScriptLoader.Name="wistiaScriptLoader",WistiaScriptLoader.$inject=["$q"],WistiaScriptLoader}(),il=function(){function WistiaUrlService(){this.type="wistia",this.mimetype="video/x-"+this.type,this.embedUrl="http://fast.wistia.net/embed/iframe/"}return WistiaUrlService.prototype.getMimeType=function(){return this.mimetype},WistiaUrlService.prototype.parseMediaSrc=function(e){return e.reduce(function(e,t){return WistiaUrlService.isWistia(t)&&e.mediaSrcArr.push(t),e},{type:this.type,mediaSrcArr:[]})},WistiaUrlService.prototype.parseInput=function(e){if(WistiaUrlService.isWistia(e)&&!WistiaUrlService.isEmbed(e))return e},WistiaUrlService.prototype.extractId=function(e){if(WistiaUrlService.isWistia(e))return WistiaUrlService.parseIdfromUrl(e)},WistiaUrlService.prototype.canPlay=function(e){return WistiaUrlService.isWistia(e)},WistiaUrlService.prototype.getOutgoingUrl=function(e,t){var i="?autoplay=true&time="+t,n=WistiaUrlService.parseIdfromUrl(e),a=""+n+i;return this.embedUrl+a},WistiaUrlService.isWistia=function(e){return/https?:\/\/(.+)?(wistia\.com|wi\.st)\/.*/.test(e)},WistiaUrlService.isEmbed=function(e){return/<script/i.test(e)},WistiaUrlService.parseIdfromUrl=function(e){var t=e.split("/");return t[t.length-1]},WistiaUrlService.Name="wistiaUrlService",WistiaUrlService}(),nl=angular.module("np.wistia",[]);[el,tl,il].forEach(function(e){nl.service(e.Name,e)});var al=angular.module("np.playback",["np.html5","np.youtube","np.kaltura","np.wistia"]);al.directive("ittVideo",ittVideo).factory("playbackService",playbackService_playbackService).factory("playerManagerCommons",playerManagerCommons).factory("urlService",urlService_urlService);questionAnswersSvc_questionAnswersSvc.$inject=["$q","analyticsSvc","appState"];var rl='\n<div class="field">\n  <div class="label">Answers</div>\n</div>\n<div class="field" ng-repeat="distractor in $ctrl.data.data._plugin.distractors track by $index">\n  <div class="label">\n    {{$index | alpha}} &nbsp;\n    <input type="checkbox" ng-model="distractor.correct" ng-change="$ctrl.onFormativeChecked(distractor)"\n           ng-if="$ctrl.data.data._plugin.questiontype == \'mc-formative\'">\n  </div>\n  <np-input-i18n\n    class="input"\n    field="distractor.text"\n    on-field-change="$ctrl.updateDistractor($field, distractor)"\n    inputtype="textarea">\n  </np-input-i18n>\n</div>\n<div class="field">\n  <div class="input">\n    <button ng-click="$ctrl.addDistractor()">Add distractor</button>\n  </div>\n</div>\n<div class="field" ng-if="$ctrl.data.data._plugin.questiontype == \'mc-formative\'">\n  <div class="label">Feedback when correct</div>\n  <np-input-i18n\n    class="input"\n    field="$ctrl.data.data._plugin.correctfeedback"\n    on-field-change="$ctrl.updateField($field, \'correctfeedback\')"\n    inputtype="textarea">\n  </np-input-i18n>\n</div>\n<div class="field" ng-if="$ctrl.data.data._plugin.questiontype == \'mc-formative\'">\n  <div class="label">Feedback when incorrect</div>\n  <np-input-i18n\n    class="input"\n    field="$ctrl.data.data._plugin.incorrectfeedback"\n    on-field-change="$ctrl.updateField($field, \'incorrectfeedback\')"\n    inputtype="textarea">\n  </np-input-i18n>\n</div>\n',sl=function(){function QuestionOptionsController(e){this.$timeout=e}return QuestionOptionsController.prototype.$onInit=function(){},QuestionOptionsController.prototype.emitUpdate=function(){var e=this;this.$timeout(function(){e.onUpdate()})},QuestionOptionsController.prototype.updateDistractor=function(e,t){t.text=e,this.emitUpdate()},QuestionOptionsController.prototype.updateField=function(e,t){this.data.data._plugin[t]=e,this.emitUpdate()},QuestionOptionsController.prototype.addDistractor=function(){this.data.data._plugin.distractors.push({text:"",index:this.data.data._plugin.distractors.length+1})},QuestionOptionsController.prototype.onFormativeChecked=function(e){this.data.data._plugin.distractors.forEach(function(t){t!==e&&(t.correct=void 0)})},QuestionOptionsController.$inject=["$timeout"],QuestionOptionsController}(),ol=function(){function QuestionOptions(){this.bindings={data:"<",onUpdate:"&"},this.template=rl,this.controller=sl}return QuestionOptions.Name="npQuestionOptions",QuestionOptions}(),ll='\n<div class="field">\n\t<div class="label">Question text\n\t\t<itt-validation-tip\n\t\t  ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid"\n\t\t  text="Question Text is a required field">\n    </itt-validation-tip>\n\t</div>\n\t<np-input-i18n\n\t  class="input"\n\t  do-validate="$ctrl.doValidate"\n\t  on-emit-name="$ctrl.onName($taName)"\n\t  on-field-change="$ctrl.emitUpdate($field)"\n\t  field="$ctrl.data.data._plugin.questiontext"\n\t  inputtype="textarea">\n  </np-input-i18n>\n</div>\n',cl=function(){function QuestionTextFieldController(e){this.$timeout=e}return QuestionTextFieldController.prototype.onName=function(e){this.textAreaName=e},QuestionTextFieldController.prototype.emitUpdate=function(e){var t=this;this.$timeout(function(){t.data.data._plugin.questiontext=e,t.onUpdate()})},QuestionTextFieldController.$inject=["$timeout"],QuestionTextFieldController}(),dl=function(){function QuestionTextField(){this.bindings={data:"<",doValidate:"<",ittItemForm:"<",onUpdate:"&"},this.template=ll,this.controller=cl}return QuestionTextField.Name="npQuestionTextField",QuestionTextField}(),pl='\n<div class="question item__text">\n\n  <p ng-bind-html="$ctrl.plugin.questiontext | i18n"></p>\n  <div ng-if="!$ctrl.showChart">\n\n    <div ng-repeat="distractor in $ctrl.choices">\n      <div ng-if="(distractor.text | i18n) != \'\'">\n        <label ng-class="{\n\t\t\t\t\tcorrect: $ctrl.plugin.hasBeenAnswered && distractor.correct,\n\t\t\t\t\tincorrect: $ctrl.plugin.hasBeenAnswered && !distractor.correct\n\t\t\t\t}">\n          <input ng-change="$ctrl.scoreQuiz($index)" type="radio" name="fnord" ng-model="index"\n                 ng-disabled="$ctrl.plugin.hasBeenAnswered" value="{{$index}}" ng-checked="distractor.selected">\n          <span ng-bind-html="distractor.text | i18n"></span>\n        </label>\n      </div>\n    </div>\n    <div ng-if="$ctrl.plugin.hasBeenAnswered" ng-bind-html="$ctrl.feedback() | i18n"></div>\n  </div>\n\n  <div ng-if="$ctrl.showChart">\n    <div ng-if="!$ctrl.plugin.hasBeenAnswered" ng-repeat="distractor in $ctrl.plugin.distractors">\n      <div ng-if="(distractor.text | i18n) != \'\'">\n        <label>\n          <input ng-change="$ctrl.scorePoll($index)" type="radio" name="fnord"\n            ng-disabled="$ctrl.plugin.hasBeenAnswered"\n            ng-model="$ctrl.plugin.selectedDistractor" value="{{$index}}">\n          <span ng-bind-html="distractor.text | i18n"></span>\n        </label>\n      </div>\n    </div>\n    <br>\n    <div ng-if="$ctrl.plugin.hasBeenAnswered">\n      <p ng-if="$ctrl.plugin.selectedDistractor">Here\'s how others answered this question. (Your choice was:\n        <b ng-repeat="distractor in $ctrl.plugin.distractors | filter:{ index: $ctrl.plugin.selectedDistractor }"\n           ng-bind-html="distractor.text | i18n"></b>)\n      </p>\n\n      <itt-flotr2-chart type="{{$ctrl.chartType}}" title="" data="{{$ctrl.chartData}}"\n                        options="{{$ctrl.chartOptions}}"></itt-flotr2-chart>\n    </div>\n  </div>\n</div>\n\n',ul=function(){function McQuestionController(e,t,i){this.questionAnswersSvc=e,this.analyticsSvc=t,this.appState=i}return McQuestionController.prototype.$onInit=function(){if(this.chartOptions={},!0===this.plugin.hasBeenAnswered){void 0===this.plugin.answer_counts&&(this.plugin.answer_counts={});var e=this.plugin.answer_counts,t=this.formatAnswersForFlotPieChart(e);this.chartData=t}},McQuestionController.prototype.scoreQuiz=function(e){this.plugin.distractors[e].selected=!0,this.plugin.hasBeenAnswered=!0,this.plugin.selectedDistractor=this.plugin.distractors[e].index,this.analyticsSvc.captureEventActivity("question-answered",this.qid,{answer:this.plugin.distractors[e].text,index:this.plugin.distractors[e].index,correct:!!this.plugin.distractors[e].correct})},McQuestionController.prototype.feedback=function(){for(var e=0;e<this.plugin.distractors.length;e+=1)if(this.plugin.distractors[e].index===this.plugin.selectedDistractor)return this.plugin.distractors[e].correct?this.plugin.correctfeedback:this.plugin.incorrectfeedback},McQuestionController.prototype.scorePoll=function(e){var t=this;this.questionAnswersSvc.saveAnswer("question-answered",this.qid,{answer:this.plugin.distractors[e].text,index:this.plugin.distractors[e].index,correct:!!this.plugin.distractors[e].correct}).then(function(){t.plugin.answer_counts=void 0===t.plugin.answer_counts?{}:t.plugin.answer_counts,t.questionAnswersSvc.incrementAnswerCount(t.plugin.answer_counts,t.plugin.distractors[e].index);var i=t.plugin.answer_counts,n=t.formatAnswersForFlotPieChart(i);t.chartData=n,t.plugin.distractors[e].selected=!0,t.plugin.hasBeenAnswered=!0,t.plugin.selectedDistractor=t.plugin.distractors[e].index})},McQuestionController.prototype.formatAnswersForFlotPieChart=function(e){var t=this,i=[],n=this;for(var a in e)!function(a){e.hasOwnProperty(a)&&angular.forEach(n.plugin.distractors,function(n){if(n.index+""==a+""){var r=n.text;"object"==typeof r&&(r=r[t.appState.lang]||r.en||""),i.push({label:r,data:e[a]})}})}(a);return i},McQuestionController.$inject=["questionAnswersSvc","analyticsSvc","appState"],McQuestionController}(),ml=function(){function McQuestion(){this.bindings={showChart:"<",choices:"<",plugin:"<",qid:"@"},this.template=pl,this.controller=ul}return McQuestion.Name="npMcQuestion",McQuestion}(),hl=angular.module("np.question",[]);hl.factory("questionAnswersSvc",questionAnswersSvc_questionAnswersSvc).directive("ittFlotr2Chart",ittFlotr2Chart).component(ol.Name,new ol).component(dl.Name,new dl).directive("ittQuestionTypeSelect",ittQuestionTypeSelect).component(ml.Name,new ml);var gl=angular.module("np.player",["textAngular","ngSanitize","np.episode","np.viewModes","np.item","np.inputFields","np.scenes","np.timeline","np.playback","np.question"]),vl=[Bt,jt];gl.service(Ht.Name,Ht).directive("ittNarrativeTimeline",ittNarrativeTimeline).directive("ittPlayerContainer",ittPlayerContainer).controller("PlayerController",PlayerController).directive("ittSearchPanel",ittSearchPanel).controller("SearchPanelController",SearchPanelController).directive(Zt.Name,Zt.factory()).directive("ittTab",ittTab).directive("ittTabs",ittTabs).directive("ittVolumeSlider",ittVolumeSlider).directive(ti.Name,ti.factory()).directive(ii.Name,ii.factory()).directive("ittShowHideVisualOnly",ittShowHideVisualOnly).animation(".visualHideAnimation",visualHideAnimation).directive("ittWidthWatch",ittWidthWatch),vl.forEach(function(e){gl.service(e.Name,e)}),gl.config(["$provide",textAngularConfig]);angular.module("np.client",["ngRoute","ngAnimate","ui.tree","720kb.socialshare","np.shared","np.projects","np.stories","np.player"]).constant("PLAYERSTATES",{"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued",4:"quality changed",6:"player ready"}).constant("PLAYERSTATES_WORD",{unstarted:"-1",ended:"0",playing:"1",paused:"2",buffering:"3","quality changed":"4","video cued":"5","player ready":"6"}).config(["$routeProvider",routerConfig]).config(["$sceDelegateProvider",xDomainConfig]).config(["$httpProvider",authInterceptorConfig]).config(["$compileProvider",debugInfoConfig]).run(["$rootScope","errorSvc",runFunction])},zSN1:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div> <div class="itemTemplate definition"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="item__title item__title--definition"> <span ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></span> </div> </div> <div class="text item__text item__text--definition" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '}},["zMT9"]);
//# sourceMappingURL=https://localhost.inthetelling.com/sourcemaps/app.43b3f4c86e4a183a5a44.min.js.map