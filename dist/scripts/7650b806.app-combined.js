"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate","pasvaz.bindonce"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/error",{controller:"UIErrorController",templateUrl:"templates/error.html"}).when("/episode/:epId",{controller:"EpisodeController",templateUrl:"templates/player.html"}).when("/episode/:epId/:authKey",{controller:"EpisodeController",templateUrl:"templates/player.html"}).otherwise({redirectTo:"/error"}),b.html5Mode(!1)}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/danielbeck.net/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"]}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/contentpane.html",'<!-- \n	TODO:  item.styles is on both the ng-repeat and on the item. Harmless, but redundant.\n	Need it on the ng-repeat for animations; check to see if we can remove it from the item\n	(will definitely require edits to item.css, maybe elsewhere?)\n\n-->\n\n<div class="content" x-ng-class=\'{"noSidebars": noSidebars, "hasLeftSidebar": hasLeftSidebar, "hasRightSidebar": hasRightSidebar}\'>\n	<h2 x-ng-if="pane == \'main\'" class="sceneTitle">{{scene.title}}</h2>\n	<div x-ng-repeat="item in itemlist | itemList:showCurrent" class="item-animate" x-ng-class="item.styles" data-force-item-template="{{forceItemTemplate}}" x-itt-item="item">\n	</div>\n</div>\n'),a.put("templates/episode-default.html",'<div class="{{episode.styles}}" x-ng-class="{isFramed: isFramed, isIPhone: isIPhone}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n</div>\n<div class="branding">\n	<a class="itt logo" href="http://inthetelling.com">\n		<img src="images/itt.svg" alt="In The Telling logo">\n	</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n</div>\n'),a.put("templates/episode-eliterate.html",'<div class="{{episode.styles}} episode-eliterate" x-ng-class="{isFramed: isFramed}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="banner-logo">\n		<img src="images/eliterate-logo.svg">\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n	<div class="branding">\n		<a class="eliterate logo" href="http://www.mindwires.com">\n			<img src="images/mindwires.svg" alt="Mindwires logo">\n		</a>\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n	</div>\n</div>\n'),a.put("templates/episode-ewb.html",'<div class="{{episode.styles}} episode-ewb" x-ng-class="{isFramed: isFramed}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="banner-logo">\n		<img src="images/ewb-logo.svg">\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n	<div class="branding">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n	</div>\n</div>\n'),a.put("templates/episode-gw.html",'<div class="{{episode.styles}} episode-gw" x-ng-class="{isFramed: isFramed}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="banner-logo">\n		<img src="images/gw-logo.svg">\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n	<div class="branding">\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n	</div>\n</div>\n'),a.put("templates/episode-tellingstory.html",'<div class="{{episode.styles}}" x-ng-class="{isFramed: isFramed, isIPhone: isIPhone}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="banner-logo">\n		<img src="images/tellingstory-logo.svg">\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n</div>\n<div class="branding">\n	<a class="itt logo" href="http://inthetelling.com">\n		<img src="images/itt.svg" alt="In The Telling logo">\n	</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n</div>\n'),a.put("templates/error.html",'<div x-ng-if="error" class="error">\n	<h2>Error</h2>\n	<p>Sorry, but something went wrong and we weren\'t able to continue:</p>\n\n	<p ng-if"error.message">{{error.message}}</p>\n	<p ng-if="!error.message">(Unknown error)</p>\n<!--\n	<span style="color:#FFF">\n		<pre>{{error.details}}</pre>\n	</span>\n-->\n</div>'),a.put("templates/modal-image-default.html",'<div style="text-align: center">\n	<img  x-ng-src="{{item.source}}" style="max-width:100%;">\n</div>\n'),a.put("templates/modal-link-default.html",'<div x-ng-class="{isIDevice: item.isIDevice}">\n	<div class="modalmenu dontCloseModal"><a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n	</div>\n	<div class="modalIframeContainer dontCloseModal">\n		<iframe x-ng-src="{{item.source}}"></iframe>\n	</div>\n</div>\n'),a.put("templates/player.html",'<div ng-include="episode.templateUrl">Loading episode...</div>\n<div x-ng-controller="UIErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/scene-1col.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-1col" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="matchVideoHeight"></div>\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-2colL.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-2col scene-2colL" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="padLeftColumn matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="padRightColumn matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-2colR.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-2col scene-2colR" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="padRightColumn matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="padLeftColumn matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-animatetest.html",'<!-- \n\nThis is an equivalent of scene-1col which allows animated transitions on Fg, Bg, and videoOverlay elements. \nMost of the transitions don\'t play nicely with those items\' positioning, however!  transitionFade is the only \ncurrently trustworthy one.  \n\nTODO: decide whether to support that transtion (only)?\n\nTODO: does filter:{isActive:true} mean a performance hit?\n\n-->\n<div \n	bindonce="scene" \n	class="sceneContainer scene-1col" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\' | filter:{isActive:true}" x-itt-item="item"></div>\n			</div>\n			<div x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\' | filter:{isActive:true}" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div class="item-animate" x-ng-repeat="item in scene.items | layout: \'videoOverlay\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-centered.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-centered" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-no-sidebars="true" data-show-current="true" data-content="content" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerH.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-cornerH" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n\n\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane smallPane contentMain matchVideoHeight">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<br>\n			<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerV.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-cornerV" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="scene-cornerV-column stretchToViewportBottom">\n			<div class="pane videoContainer">\n				<div class="fillPane video">\n					<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n				</div>\n			</div>\n			<div class="pane smallPane contentMain stretchToViewportBottom">\n				<div class="fillPane paneBg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n				</div>\n				<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n				<div class="fillPane paneFg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n				</div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-explore.html",'<!-- TODO: on enter need to scroll directly to current scene if it\'s not scene 1 -->\n\n<div \n	bindonce="scene" \n	class="clear sceneContainer scene-explore" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive, "nonNavigable": scene.nonNavigable}\'>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain highlightSide">\n			<div class="content noSidebars">\n				<h2 class="sceneTitle" x-ng-if="scene.title">{{scene.title}}</h2>\n				<div x-ng-repeat="item in scene.items | layout: scene.mainPaneContents | filter:{cosmetic: false}" class="item-animate" data-autoscroll="true" data-force-item-template="default" x-itt-explore-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt">\n			<div x-ng-if="scene.startTime == 0" class="matchVideoHeight">\n				<!-- in explore view, need to pad the first scene to make room for the video -->\n			</div>\n			<div class="content noSidebars">\n				<div x-ng-repeat="item in scene.items | layout: scene.altPaneContents | filter:{cosmetic: false}" class="item-animate" data-force-item-template="default" data-autoscroll="true" x-itt-explore-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-video.html",'<div \n	bindonce="scene" \n	class="sceneContainer scene-video" \n	x-bo-class=\'scene.boCSS\'\n	x-ng-class=\'{"currentScene": scene.isActive}\'>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene stretchToViewportBottom">\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n	</div>\n	<div x-ng-show="!scene.hideCaptions" class="pane contentMain videoOverlay">\n		<div class="content showCurrent noSidebars">\n			<!-- may not need to filter by layout here... -->\n			<div class="item-animate transitionFade" data-force-item-template="closedcaption" x-ng-repeat="item in scene.items | layout: scene.mainPaneContents | transcript" x-itt-watch-item="item"></div>\n		</div>\n	</div>\n	<div class="pane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/text-h1.html",'<div \n	bindonce="item" \n	class="item timestampNone headerItem" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<h1 bo-html="item.annotation"></h1>\n</div>\n'),a.put("templates/text-h2.html",'<div \n	bindonce="item" \n	class="item timestampNone headerItem" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<h2 bo-html="item.annotation"></h2>\n</div>\n'),a.put("templates/text-pullquote-noattrib.html",'<div \n	bindonce="item" \n	class="item timestampNone headerItem" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="pullquote" bo-html="item.annotation"></div>\n</div>\n'),a.put("templates/text-pullquote.html",'<div \n	bindonce="item" \n	class="item timestampNone headerItem" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="pullquote" bo-html="item.annotation"></div>\n	<div class="pullquoteSpeaker" bo-html="item.authorName"></div>\n</div>\n'),a.put("templates/toolbar/toolbar.html",'<span>\n	<div class="toolbar" x-ng-class="{isFramed: isFramed, nobg: !show.playerPanel}">\n\n		<div x-ng-show="show.playerPanel" class="modegroup buttongroup">\n			<a class="button button-video" x-ng-class="{cur: currentSceneTemplateIs(\'video\')}" x-ng-click="setSceneTemplate(\'video\');">\n				<span>Watch</span>\n			</a>\n			<a class="button button-directed" x-ng-class="{cur: currentSceneTemplateIs()}" x-ng-click="setSceneTemplate();">\n				<span>Discover</span>\n			</a>\n			<a class="button button-explore" x-ng-class="{cur: currentSceneTemplateIs(\'explore\')}" x-ng-click="setSceneTemplate(\'explore\');">\n				<span>Review</span>\n			</a>\n		</div>\n\n		<div x-ng-if="isFramed" class="escapegroup buttongroup" style="float:right;">\n			<a x-ng-click="mainframeescape();" class="button button-mainframeescape">\n				<span>New window</span>\n			</a>\n		</div>\n\n		<div x-ng-show="show.playerPanel" class="searchgroup buttongroup" x-ng-class="{cur: show.searchPanel}" style="float:right; z-index:10">\n			<a class="button button-search" href="javascript: void 1;" x-ng-click="toggleSearchPanel()">\n				<span>Search</span>\n			</a>\n			<input id="searchtext" type="text" x-ng-model="searchText" />\n		</div>\n\n		<div class="autoscroll" x-ng-show="exploreMode && !autoscrollEnabled" x-ng-click="enableAutoscroll()">\n			<img src="/images/autoscroll.svg" width="32" height="32">\n		</div>\n\n	</div>\n	<div class="threedee">\n		<div class="modal-backdrop" x-ng-click="hidePanels()" x-ng-show="show.navigationPanel"></div>\n		<div class="modal-backdrop search-backdrop" x-ng-click="hidePanels()" x-ng-show="show.searchPanel"></div>\n		<div class="modal-backdrop help-backdrop" x-ng-click="hidePanels()" x-ng-show="show.playerPanel && show.helpPanel"></div>\n		<div x-ng-if="show.playerPanel && show.helpPanel" class="helpPanel">\n			<div class="arrow-up"></div>\n			<p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p>\n			<ul>\n				<li class="video">\n					<h3>Watch</h3>\n					<p>Just the video, no frills.</p>\n				</li>\n				<li class="directed">\n					<h3>Discover</h3>\n					<p>The guided, synchronized view of the video and related content.</p>\n				</li>\n				<li class="explore">\n					<h3>Review</h3>\n					<p>Read the full transcript and all the related transmedia in one convenient list.</p>\n				</li>\n			</ul>\n			<a class="goAway" x-ng-click="noMoreHelp()" href="javascript:void 1;">Don\'t show this again</a>\n\n\n\n		</div>\n		<div x-ng-show="show.navigationPanel" class="sidePanel navigationPanel">\n			<div x-ng-controller="NavigationPanelController">\n				<h2>{{episode.title}}</h2>\n				<div class="scene" x-ng-if="scene.title" x-ng-repeat="scene in scenes" x-ng-class="{currentScene: scene.isActive}" x-ng-click="gotoScene(scene.startTime)">\n					<span class="displayTime">{{scene.displayTime}}</span>\n					<p>\n						<a href="javascript:void 1;">{{scene.title}}</a>\n						<br>{{scene.description}}\n					</p>\n				</div>\n			</div>\n		</div>\n		<div x-ng-show="show.searchPanel" class="sidePanel searchPanel">\n			<div x-ng-if="show.searchPanelInternals" x-ng-controller="SearchPanelController">\n\n				<div class="searchfilters">\n					<label x-ng-show="sortBy!==\'startTime\'">\n						<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="startTime">Sorted by\n						<span class="fakelink">type</span>\n					</label>\n					<label x-ng-show="sortBy===\'startTime\'">\n						<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="type">Sorted by\n						<span class="fakelink">time</span>\n					</label>\n				</div>\n				<div class="scrollContainer">\n					<div class="searchResults">\n						<!-- TODO:\n					- Wire up all types checkbox\n					- Check ordering in items by type\n					- Hide type header when no child items are visible\n				-->\n						<!-- sorted by start time -->\n						<div x-ng-if="sortBy == \'startTime\'">\n							<div x-ng-repeat="scene in scenes">\n								<h3 x-ng-if="scene.title">{{scene.title}}</h3>\n								<div class="item" x-ng-repeat="item in scene.items | orderBy:\'startTime\' | filter:{\'searchableText\': searchText, \'cosmetic\': false} | type:searchTypes">\n									<span class="displayTime"><a href="javascript:void 1" x-ng-click="gotoItem(item)">{{item.displayTime}}</a>\n									</span>\n									<span x-ng-if="item.type===\'annotation\'" class="type">{{item.authorName}}</span>\n									<span x-ng-if="item.type!==\'annotation\'" class="type">({{prettyTypeMap[item.type]}})</span>\n									<div class="description" ng-bind-html="item.trustedDisplayText | highlight: searchText"></div>\n								</div>\n							</div>\n						</div>\n\n						<!-- sorted by type -->\n						<div x-ng-if="sortBy == \'type\'">\n							<div class="sortedbytype" x-ng-repeat="(type, items) in allItemsByType | orderBy:\'type\'" x-ng-if="searchTypes[type]">\n								<h3>{{prettyTypeMap[type]}}</h3>\n								<div class="item" x-ng-repeat="item in items | orderBy:\'startTime\' | type:searchTypes | filter:{\'searchableText\': searchText, \'cosmetic\': false}">\n									<span class="displayTime"><a href="javascript:void 1" x-ng-click="gotoItem(item)">{{item.displayTime}}</a>\n									</span>\n									<span x-ng-if="item.type===\'annotation\'" class="type">{{item.authorName}}</span>\n									<span x-ng-if="item.type!==\'annotation\'" class="type">({{prettyTypeMap[item.type]}})</span>\n									<div class="description" ng-bind-html="item.trustedDisplayText | highlight: searchText"></div>\n								</div>\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<!-- TODO ARIA markup on all clickables -->\n	<div class="injectedvideocontrols vjs-story-skin">\n		<div x-ng-click="showSceneMenu()" class="video-scenemenu vjs-control">\n			<a href="javascript: void 1;">\n				<span class="vjs-control-text">Scene list</span>\n			</a>\n		</div>\n\n		<div x-ng-if="curScene.prevSceneStart || curScene.prevSceneStart === 0" class="video-prevscene vjs-control">\n			<a x-ng-click="gotoTime(curScene.prevSceneStart + 0.1)">\n				<span class="vjs-control-text">Previous scene</span>\n			</a>\n		</div>\n		<div x-ng-if="curScene.startTime == 0" class="video-prevscene vjs-control">\n			<a x-ng-click="gotoTime(0)">\n				<span class="vjs-control-text">Previous scene</span>\n			</a>\n		</div>\n		<div x-ng-if="curScene.nextSceneStart" class="video-nextscene vjs-control">\n			<a x-ng-click="gotoTime(curScene.nextSceneStart)">\n				<span class="vjs-control-text">Next scene</span>\n			</a>\n		</div>\n		<div x-ng-click="toggleCaptions()" x-ng-if="currentSceneTemplateIs(\'video\')" x-ng-class="{active: !hideCaptions}" class="video-captions vjs-control">\n			<a>\n				<span class="vjs-control-text">Captions</span>\n			</a>\n		</div>\n\n\n	</div>\n\n\n	<div x-ng-show="show.introPanel" class="intropanel">\n	<div class="gwlogohack"><!--don\'t ask --></div>\n		<div class="pane introtext">\n			<h1>\n				{{episode.title}}\n			</h1>\n			<p>\n				{{episode.description}}\n			</p>\n		</div>\n		<div class="pane videoContainer">\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n	</div>\n\n	<div x-ng-if="forcedEscape" x-itt-magnetized class="videoOverlay" style="pointer-events: auto;">\n		<div x-ng-click="mainframeescape();" class="escapelink forcedEscape"></div>\n	</div>\n	<div id="footertrigger" x-ng-mouseenter="showVideoControls()"></div>\n\n</span>\n'),a.put("templates/transcript-closedcaption.html",'<div \n	bindonce="item" \n	class="item timestampNone" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="authorName" bo-html="item.authorName"></div>\n	</div>\n	<div class="text" bo-html="item.annotation"></div>\n</div>\n'),a.put("templates/transcript-default.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="authorName" bo-html="item.authorName"></div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.authorThumbSrc"><div class="clear"></div></div> -->\n	<div class="text" bo-html="item.annotation"></div>\n</div>\n'),a.put("templates/transcript-withthumbnail-alt.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="icon" style="float:right">\n			<img x-ng-src="{{item.authorThumbSrc}}">\n			<div class="clear"></div>\n		</div>\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="authorName" bo-html="item.authorName"></div>\n	</div>\n	<div class="text" bo-html="item.annotation"></div>\n</div>\n'),a.put("templates/transcript-withthumbnail.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n	</div>\n	<div class="icon" style="float:left; margin-right: 1em;">\n		<img bo-src="item.authorThumbSrc">\n		<div class="clear"></div>\n	</div>\n	<div class="authorName" bo-html="item.authorName"></div>\n	<div class="text" bo-html="item.annotation"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/transmedia-caption.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n	<div class="captioncontainer">\n		<img bo-src="item.source" style="width:100%">\n		<div class="caption">\n			<div class="title" bo-html="item.title"></div>\n			<div class="text" bo-html="item.description"></div>\n		</div>\n	</div>\n'),a.put("templates/transmedia-embed-youtube.html",'<!-- TODO: clean up the YT url, add our own params, probably use their player API so we can hook into play/pause events -->\n<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n	<div class="detail" style="width: 100%;position: relative;padding-bottom: 56.25%;height: 0;">\n		<iframe bo-src="item.source" style="position:absolute; width: 100%; height: 100%; "></iframe>\n	</div>\n\n	<div class="text" bo-html="item.description"></div>\n\n</div>\n'),a.put("templates/transmedia-image-default.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title">\n			<a href="javascript:void 1;" x-ng-click="toggleDetailView()" bo-html="item.title || \'(no title)\'"></a>\n		</div>\n		<div class="text" bo-html="item.description"></div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail">\n		<img bo-src="item.source" style="width: 100%">\n	</div>\n</div>\n'),a.put("templates/transmedia-image-fill.html",'<div \n	bindonce="item" \n	class="item nopadding" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div x-ng-if="item.asBackgroundImage"  class="backgroundImage" x-ng-style="{\'background-image\': \'url(\' + item.source + \')\'}"></div>\n	<img x-ng-if="!item.asBackgroundImage" bo-src="item.source">\n</div>\n'),a.put("templates/transmedia-image-plain.html",'<!-- only in content panes.  Fg/Bg/Overlay items will be coerced to transmedia-image-fill -->\n<div \n	bindonce="item" \n	class="item timestampNone" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="touchable" style="position:relative">\n		<img x-ng-click="showModal()" bo-src="item.source">\n		<div class="touchableIndicator" ></div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-default.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title"><a href="javascript:void 1;" x-ng-click="toggleDetailView()" bo-html="item.title || \'(no title)\'"></a>\n		</div>\n		<div bo-html="item.description"></div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail">\n		<a bo-href="item.source" target="_blank" class="escapelink">(new window)</a>\n		<div class="iframeContainer">\n			<iframe bo-src="item.source"></iframe>\n		</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-embed.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title" bo-html="item.title"></div>\n		<div bo-html="item.description"></div>\n	</div>\n		<div class="iframeContainer">\n			<iframe bo-src="item.source" width="100%"></iframe>\n		</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-frameicide.html",'<!--  Targets window.top.  Primarily for use at the end of an episode, when linking back to the host LMS -->\n<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title"><a x-ng-click="pause()" bo-href="item.source" class="" target="_top" bo-html="item.title"></a>\n		</div>\n		<div bo-html="item.description"></div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-icon.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="icon">\n		<a x-ng-click="pause()" bo-href="item.source" target="_blank">\n			<img bo-src="item.thumbSrc">\n		</a>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-noembed.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title"><a x-ng-click="pause()" bo-href="item.source" class="escapelink" target="_blank" bo-html="item.title"></a>\n		</div>\n		<div bo-html="item.description"></div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-youtube.html",'<!-- TODO: clean up the YT url, add our own params, probably use their player API so we can hook into play/pause events -->\n<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title"><a href="javascript:void 1;" x-ng-click="toggleDetailView()" bo-html="item.title"></a>\n		</div>\n		<div bo-html="item.description"></div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail">\n		<div class="iframeContainer">\n			<iframe bo-src="item.source"></iframe>\n		</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-linkonly.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img bo-src="item.thumbSrc"></div> -->\n	<div class="text">\n		<div class="title"><a x-ng-click="pause()" bo-href="item.source" class="escapelink" target="_blank" bo-html="item.title"></a>\n		</div>\n		<div bo-html="item.description"></div>\n	</div>\n</div>\n'),a.put("templates/transmedia-slidingcaption.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span bo-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n	<div class="captioncontainer">\n		<img bo-src="item.source" style="width:100%">\n		<div class="caption slidingcaption">\n			<div class="title" bo-html="item.title"></div>\n			<div class="text" bo-html="item.description"></div>\n		</div>\n	</div>\n'),a.put("templates/transmedia-thumbnail.html",'<div \n	bindonce="item" \n	class="item" \n	x-ng-class=\'{"currentItem": item.isActive}\' \n	x-bo-class=\'item.boCSS\'\n>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<!--<span bo-if="item.required">(Required viewing)</span>-->\n		</div>\n	</div>\n	<div class="thumbnail" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()">\n		<img bo-src="item.source">\n	</div>\n	<div class="text">\n		<div class="title" bo-html="item.title"></div>\n		<span bo-html="item.description"></span>\n	</div>\n</div>\n</div>\n')
}]),angular.module("com.inthetelling.player").controller("UIErrorController",["$scope","$rootScope","$location","$timeout",function(a,b,c,d){b.$on("error",function(b,c){c&&c.message?d(function(){a.error=c},2e3):console.error("UIErrorController got triggered with no error message!")}),"/error"===c.url()&&b.$emit("error",{message:"Requested rote doesn't exist."})}]),angular.module("com.inthetelling.player").controller("EpisodeController",["$interval","dataSvc","modelFactory","cuePointScheduler","$scope","$rootScope","$location","$routeParams","videojs","$window",function(a,b,c,d,e,f,g,h,i,j){if(i.player&&j.location.reload(),f.isFramed=window.parent!=window,f.isIPad=navigator.platform.indexOf("iPad")>-1,f.isIPhone=navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,a(function(){f.windowHeight=angular.element(window).height(),f.windowWidth=angular.element(window).width()},250,0,!1),(f.isIPad||f.isIPod||f.isIPhone)&&f.isFramed){var k=angular.element(window);angular.element("#CONTAINER").height(k.height()).width(k.width()).addClass("iosScrollFix"),e.$watch(function(){return f.windowWidth},function(a,b){void 0!==b&&(a>b?angular.element("#CONTAINER").height(e.windowHeight-1).width(f.windowWidth-1):(angular.element("#CONTAINER").height(1).width(1),f.windowHeight=angular.element(window).height(),f.windowWidth=angular.element(window).width(),angular.element("#CONTAINER").height(f.windowHeight-1).width(f.windowWidth-1)))}),window.devicePixelRatio<2&&(e.forcedEscape=!0)}e.now=new Date,b.get(h,function(a){var b,f;for(e.episodeID=h.epId,e.authKey=h.authKey,e.episode=c.createEpisodeModel(a.episode),e.scenes=[],a.events.sort(function(a,b){return a.start_time-b.start_time}),b=a.events.length-1;b>0;b--)if("scene"===a.events[b].type){a.events[b].end_time=1/0;break}for(b=0;b<a.events.length;b++)if("scene"===a.events[b].type){var g=c.createSceneModel(a.events[b]);!function(a){d.subscribe({begin:a.startTime,end:a.endTime},function(b,c){e.$apply(function(){c===d.ENTER?a.isActive=!0:c===d.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(g),e.scenes.push(g)}for(b=0;b<a.events.length;b++)if("scene"!==a.events[b].type){var i=c.createItemModel(a.events[b]);for(function(a){a.adjustedEndTime="annotation"===a.type&&a.startTime+1<a.endTime?a.endTime-1:a.endTime,a.adjustedEndTime-.5<a.startTime&&(a.adjustedEndTime=a.startTime+.5),d.subscribe({begin:a.startTime,end:a.adjustedEndTime},function(b,c){e.$apply(function(){c===d.ENTER?a.isActive=!0:c===d.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(i),f=0;f<e.scenes.length;f++)if(i.startTime>=e.scenes[f].startTime&&i.startTime<e.scenes[f].endTime){e.scenes[f].items.push(i);break}}for(b=1;b<e.scenes.length;b++)for(f=b-1;f>-1;f-=1)if(e.scenes[f].title){e.scenes[b].prevSceneStart=e.scenes[f].startTime;break}for(b=0;b<e.scenes.length-1;b++)for(f=b+1;f<e.scenes.length;f++)if(e.scenes[f].title){e.scenes[b].nextSceneStart=e.scenes[f].startTime;break}},function(a){f.$emit("error",{uiErrorMsg:"Wasn't able to load episode data.",uiErrorDetails:JSON.stringify(a)})})}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","$timeout","videojs","modalMgr",function(a,b,c,d){a.gotoItem=function(){c.player.currentTime(a.item.startTime)},a.pause=function(){c.player.pause()},a.showModal=function(e){c.player.pause(),d.createItemDetailOverlay(a),e&&b(function(){$(".modal").css("top",e)})}}]),angular.module("com.inthetelling.player").controller("ToolbarController",["$scope",function(){}]),angular.module("com.inthetelling.player").controller("NavigationPanelController",["$scope","videojs",function(a,b){a.gotoScene=function(c){b.player.currentTime(c),a.hidePanels()}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","videojs","$sce",function(a,b,c){a.searchTypes={annotation:!0,link:!0,slide:!0,indepth:!0,project:!0,discussion:!0},a.sortBy="startTime",a.prettyTypeMap={annotation:"Transcript",link:"Link",slide:"Slide",indepth:"In Depth",project:"Project",discussion:"Discussion"},a.allItemsByType={};var d,e;for(d=0;d<a.scenes.length;d++)for(e=0;e<a.scenes[d].items.length;e++)a.allItemsByType[a.scenes[d].items[e].type]||(a.allItemsByType[a.scenes[d].items[e].type]=[]),a.scenes[d].items[e].searchableText=a.scenes[d].items[e].annotation||a.scenes[d].items[e].description,a.scenes[d].items[e].trustedDisplayText=c.trustAsHtml(a.scenes[d].items[e].searchableText),a.allItemsByType[a.scenes[d].items[e].type].push(a.scenes[d].items[e]);a.gotoItem=function(a){b.player.currentTime(a.startTime)}}]),angular.module("com.inthetelling.player").factory("dataSvc",["config","$route","$location","$http","$q","_","$rootScope",function(a,b,c,d,e,f,g){var h,i={};return i.get=function(b,c,e){var f=b.epId,j=b.authKey;if(h={},h.assets=[],a.localData||"local"===j)d({method:"GET",url:a.localDataBaseUrl+"/"+f+".json"}).success(function(a){c(a)}).error(function(a){e(a)});else{var k="";a.apiAuthToken?d.defaults.headers.get={Authorization:a.apiAuthToken}:k=j?"?access_token="+j:"",d.get(a.apiDataBaseUrl+"/v1/check_signed_in"+k).success(function(f){f.signed_in===!0?d.get(a.apiDataBaseUrl+"/v1/is_authenticated"+k).success(function(d){d.has_cookie===!0?i.batchAPIcalls(b,c,e):b.return_to?window.top.location.href=a.apiDataBaseUrl+"/v1/get_authenticated?return_to="+b.return_to:g.$emit("error",{message:"Authentication failed (couldn't set authentication cookie; no return_to url)",details:JSON.stringify(d)})}).error(function(a){g.$emit("error",{message:"Authentication failed (is_cookie_set didn't return, or returned something other than true or false)",details:JSON.stringify(a)})}):g.$emit("error",{message:"Authentication failed (check_signed_in returned false)",details:JSON.stringify(f)})}).error(function(a){g.$emit("error",{message:"Authentication failed (check_signed_in didn't return, or returned something other than true or false)",details:JSON.stringify(a)})})}},i.batchAPIcalls=function(b,c,f){var g=b.epId,i=b.authKey,j="";a.apiAuthToken?d.defaults.headers.get={Authorization:a.apiAuthToken}:j=i?"?access_token="+i:"";var k=d.get(a.apiDataBaseUrl+"/v1/episodes/"+g+j).then(function(b){return h.episode=b.data,console.log(b.config.url+":",b.data),e.all([d.get(a.apiDataBaseUrl+"/v1/containers/"+b.data.container_id+"/assets"+j),d.get(a.apiDataBaseUrl+"/v1/containers/"+b.data.container_id+j)])}).then(function(b){return console.log(b[0].config.url+":",b[0].data),console.log(b[1].config.url+":",b[1].data),b[0].data&&b[0].data.files&&(h.assets=b[0].data.files),e.all([d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+"/assets"+j),d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+j)])}).then(function(b){return console.log(b[0].config.url+":",b[0].data),console.log(b[1].config.url+":",b[1].data),b[0].data&&b[0].data.files&&(h.assets=h.assets.concat(b[0].data.files)),d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+"/assets"+j)}).then(function(a){console.log(a.config.url+":",a.data),a.data&&a.data.files&&(h.assets=h.assets.concat(a.data.files))}),l=e.all([d.get(a.apiDataBaseUrl+"/v2/episodes/"+g+"/events"+j),d.get(a.apiDataBaseUrl+"/v1/templates"+j),d.get(a.apiDataBaseUrl+"/v1/layouts"+j),d.get(a.apiDataBaseUrl+"/v1/styles"+j)]).then(function(a){h.events=a[0].data,h.templates=a[1].data,h.layouts=a[2].data,h.styles=a[3].data});e.all([k,l]).then(function(){for(var a=0;a<h.events.length;a++)h.events[a].type=h.events[a].type.toLowerCase(),h.events[a]._type=h.events[a]._type.toLowerCase();c(h)},function(a){f(a)})},i.getAssetById=function(a){if(f.isArray(h.assets)){var b;for(b=0;b<h.assets.length;b++)if(h.assets[b]._id===a)return h.assets[b]}},i.getTemplateById=function(a){if(f.isArray(h.templates)){var b;for(b=0;b<h.templates.length;b++)if(h.templates[b]._id===a)return h.templates[b]}},i.getLayoutById=function(a){if(f.isArray(h.layouts)){var b;for(b=0;b<h.layouts.length;b++)if(h.layouts[b]._id===a)return h.layouts[b]}},i.getStyleById=function(a){if(f.isArray(h.styles)){var b;for(b=0;b<h.styles.length;b++)if(h.styles[b]._id===a)return h.styles[b]}},i}]),angular.module("com.inthetelling.player").factory("modelFactory",["dataSvc","_",function(a,b){var c=function(a){return b.isString(a)&&a.match(/^[0-9a-fA-F]{24}$/)?!0:!1},d=function(b){if(c(b)){var d=a.getTemplateById(b);if(d)return d.url;console.error("Template lookup failed for:",b)}return b},e=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getLayoutById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Layout lookup failed for:",c[d]);return f}return c},f=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getStyleById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Style lookup failed for:",c[d]);return f}return c},g=function(b){var d=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;if(c(b)){var e=a.getAssetById(b);if(e){var f={};if(e.alternate_urls){for(var g=/\.(\w+)$/,i=0;i<e.alternate_urls.length;i++)if(e.alternate_urls[i].match(/youtube/)){var j=e.alternate_urls[i].match(d)[1];f.youtube="//youtube.com/embed/"+j}else switch(e.alternate_urls[i].match(g)[1]){case"mp4":f.mpeg4=h(f.mpeg4,e.alternate_urls[i]);break;case"m3u8":f.m3u8=h(f.m3u8,e.alternate_urls[i]);break;case"webm":f.webm=h(f.webm,e.alternate_urls[i])}if(e.you_tube_url){var j=e.you_tube_url.match(d)[1];f.youtube="//youtube.com/embed/"+j}}else if(f={mpeg4:e.url.replace(".mp4",".m3u8"),webm:e.url.replace(".mp4",".webm")},e.you_tube_url){var j=e.you_tube_url.match(d)[1];f.youtube="//youtube.com/embed/"+j}var k=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);k&&f.m3u8&&(f.mpeg4=f.m3u8),(k||navigator.platform.indexOf("iPad")>-1)&&f.mpeg4&&delete f.youtube;var l=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);l&&!f.youtube&&f.webm&&f.mpeg4&&(window.parent!==window?delete f.mpeg4:delete f.webm),f.duration=e.duration;for(var m in f)f[m]&&(f[m]=f[m].replace(/ /g,"%20").replace(/\?/g,"%3F").replace(/\&/g,"%26"));return f}console.error("Master Asset lookup failed for:",b)}return b},h=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,d=a.match(c)||[0,0],e=b.match(c)||[0,0];return Math.floor(d[1])<Math.floor(e[1])?b:a},i=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d.url.replace(/ /g,"%20");console.error("Asset lookup failed for:",b)}return b?b.replace(/ /g,"%20"):(console.error("Asset lookup failed (undefined assetId)"),void 0)},j=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d._type;console.error("Asset lookup failed for:",b)}return b},k={};return k.createEpisodeModel=function(a){var b={};return b.title=a.title,b.description=a.description,b.category="Fnord",b.templateUrl=d(a.template_id)||"templates/episode-default.html",b.coverUrl="/images/coverlogo.png","templates/episode-gw.html"===b.templateUrl&&(b.coverUrl="/images/aspectratiopreserver-16x9.gif"),b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.videos=g(a.master_asset_id),b._id=a._id,b},k.createSceneModel=function(a){var b={};return b.type=a.type,b.title=a.title,b.title||(b.nonNavigable=!0),b.description=a.description,b.startTime=a.start_time,b.endTime=a.end_time,b.templateUrl=d(a.template_id)||"templates/scene-1col.html",b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),b.isActive=!1,b.wasActive=!1,b.items=[],b.layout.match(/splitOptional/)?(b.mainPaneContents="transcript+required",b.altPaneContents="optional"):b.layout.match(/splitRequired/)?(b.mainPaneContents="transcript+optional",b.altPaneContents="required"):(b.mainPaneContents="transcript",b.altPaneContents="transmedia"),b.layout.match(/showCurrent/)&&(b.showCurrent=!0),b._id=a._id,b.boCSS=b.layout+" "+b.styles,b},k.createItemModel=function(a){var b={};switch(b.type=a.type,b.startTime=a.start_time,b.endTime=a.end_time,b.layout=e(a.layout_id)||"inline",b.styles=f(a.style_id)||"",b.required=a.required||!1,b.cosmetic=a.cosmetic||!1,b.stop=a.stop||!1,b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),("inline"===b.layout||b.layout.match(/sidebar/)||b.layout.match(/burst/))&&(b.inContentPane=!0),a.type){case"annotation":b.templateUrl=d(a.template_id)||"templates/transcript-default.html",b.authorName=a.annotator,b.authorThumbSrc=i(a.annotation_image_id),b.annotation=a.annotation;break;case"link":b.templateUrl=d(a.template_id)||"templates/transmedia-link-default.html",b.itemDetailTemplateUrl="templates/modal-link-default.html",b.category="links",b.title=a.title,b.description=a.description,b.thumbSrc=i(a.link_image_id),b.source=a.url.indexOf("youtube.com/embed/")>-1?-1===a.url.indexOf("?")?a.url+"?wmode=transparent":(a.url.replace(/wmode=[^&]*&?/g,"")+"&wmode=transparent").replace(/&+/g,"&"):a.url;break;case"upload":var c=a.mimeType||j(a.asset_id);c&&c.match(/image/)&&(b.type="image"),b.templateUrl=d(a.template_id)||"templates/transmedia-image-default.html",b.inContentPane||"templates/transmedia-image-plain.html"!==b.templateUrl||(b.templateUrl="templates/transmedia-image-fill.html"),b.itemDetailTemplateUrl="templates/modal-image-default.html",b.title=a.title,b.description=a.description,b.source=i(a.asset_id)||"",b.source=b.source.replace(/ /g,"%20").replace(/\?/g,"%3F").replace(/\&/g,"%26")}if(b._id=a._id,b.templateUrl.indexOf("transmedia-image")>-1&&b.source&&b.source.match(/\.[mp4|mpeg4|webm|m3u8]$/i)&&(console.error("Somebody put a video in an image template... blanking it out"),b.source=""),b.exploreTemplateUrl=b.templateUrl,"annotation"===b.type?-1===b.templateUrl.indexOf("templates/text-")&&(b.exploreTemplateUrl="templates/transcript-default.html",b.watchTemplateUrl="templates/transcript-closedcaption.html"):"upload"===b.type||"image"===b.type?b.exploreTemplateUrl="templates/transmedia-image-default.html":"link"===b.type&&"templates/transmedia-link-noembed.html"!==b.templateUrl&&"templates/transmedia-link-frameicide.html"!==b.templateUrl&&(b.exploreTemplateUrl="templates/transmedia-link-default.html"),b.templateUrl.indexOf("transmedia-image-fill")>-1)for(var g=b.styles.split(/ /),h=0;h<g.length;h++)("center"===g[h]||"contain"===g[h]||"cover"===g[h]||"fill"===g[h])&&(b.asBackgroundImage=!0);var k=[];return b.stop&&k.push("isStop"),b.required&&k.push("isRequired"),b.cosmetic&&k.push("isCosmetic"),b.essentialCSS=k.join(" "),b.layout&&k.push(b.layout),b.styles&&k.push(b.styles),b.styleCSS=k.join(" "),b},k}]),angular.module("com.inthetelling.player").factory("modalMgr",["videojs","$modal","_",function(a,b){var c={};return c.createItemDetailOverlay=function(c){c.item.isIDevice=navigator.platform.indexOf("iPad")>-1||navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,c.videoWasPlaying=!a.player.paused(),a.player.pause();var d=function(){c.videoWasPlaying&&a.player.play()},e=b.open({keyboard:!0,backdrop:!0,templateUrl:c.item.itemDetailTemplateUrl,windowClass:"itemDetailModal",scope:c});e.result.then(function(){d()},function(){d()})},c}]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b===a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b===a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(a,b){return{restrict:"EA",replace:!0,template:'<div class="modal-backdrop" x-ng-click="close($event)"></div>',link:function(c){b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!==c.value.backdrop&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,template:'<div class="modal {{windowClass}}" x-ng-click="close($event)" x-ng-transclude></div>',link:function(c,d,e){c.windowClass=e.windowClass||"",b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&0===$(b.target).closest(".dontCloseModal").length&&a.dismiss(c.key,"foreground click")}}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(a){var b=k.get(a).value;k.remove(a),b.modalDomEl.remove(),-1===e()&&(h.remove(),h=void 0),b.modalScope.$destroy()}var g,h,i=c.$new(!0),j=a.find("body").eq(0),k=d.createNew(),l={};return c.$watch(e,function(a){i.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(a,c){k.add(a,{deferred:c.deferred,modalScope:c.scope,backdrop:c.backdrop,keyboard:c.keyboard});var d=angular.element("<div modal-window></div>");d.attr("window-class",c.windowClass),d.attr("index",k.length()-1),d.html(c.content);var f=b(d)(c.scope);k.top().value.modalDomEl=f,j.append(f),e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(i),j.append(h))},l.close=function(a,b){var c=k.get(a);c&&(c.value.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",["$injector",function(a){var b={options:{backdrop:!0,keyboard:!0},$get:["$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(b){var c=[];return angular.forEach(b,function(b){(angular.isFunction(b)||angular.isArray(b))&&c.push(d.when(a.invoke(b)))}),c}var k={};return k.open=function(a){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(a=angular.extend({},b.options,a),a.resolve=a.resolve||{},!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(a)].concat(j(a.resolve)));return l.then(function(b){var d=(a.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;a.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(a.resolve,function(a,c){i[c]=b[j++]}),f=g(a.controller,i)),h.open(k,{scope:d,deferred:e,content:b[0],backdrop:a.backdrop,keyboard:a.keyboard,windowClass:a.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return b}]),angular.module("com.inthetelling.player").factory("cuePointScheduler",["$window",function(a){var b={};b.ENTER="enter",b.EXIT="exit";var c,d,e,f=[],g={},h=!1,i=function(a){return a.begin+"-"+a.end},j=function(a){d=a,h=!0},k=function(){if(h){var a,c,e=f.length;for(a=0;e>a;a++)c=f[a],c.isActive?(d<c.begin||d>=c.end)&&(c.isActive=!1,c.callback.call(void 0,{begin:c.begin,end:c.end},b.EXIT,d)):c.isActive||d>=c.begin&&d<c.end&&(c.isActive=!0,c.callback.call(void 0,{begin:c.begin,end:c.end},b.ENTER,d));h=!1}};return b.subscribe=function(a,b){return g[i(a)]=!0,f.push({begin:a.begin,end:a.end,callback:b,isActive:!1}),!0},b.unsubscribe=function(a){delete g[i(a)];var b,c=f.length;for(b=0;c>b;b++)if(f[b].begin===a.begin&&f[b].end===a.end){f.splice(b,1);break}return!0},b.registerProvider=function(b,d){return c?!1:(c=b,e=a.setInterval(k,d||1e3),j)},b.unregisterProvider=function(b){return c!==b?!1:(c=null,a.clearInterval(e),!0)},b}]),angular.module("com.inthetelling.player").factory("_",function(){return window._}),angular.module("com.inthetelling.player").factory("videojs",["config","$rootScope",function(a){var b={};return b.player=null,b.init=function(c,d){if(!b.player){var e={controls:!0,preload:!0,nativeControlsForTouch:!1};return e.techOrder=c.youtube?["youtube"]:["html5","flash"],videojs(a.videoJSElementId,e,function(){b.player=this,d&&d(b.player)}),!0}return!1},b}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.player").directive("ittScene",["$rootScope","$timeout","$window",function(a,b,c){return{restrict:"A",replace:!1,template:'<div ng-include="scene.templateUrl">Loading Scene...</div>',scope:{scene:"=ittScene"},link:function(d,e){var f=function(){b(function(){(d.scene.isActive||0===d.scene.startTime&&d.scene.templateUrl.indexOf("scene-explore.html")>-1)&&g(),h()},0)},g=function(){var a=e.find(".videoContainer"),b=16/9;if(d.scene.templateUrl.indexOf("scene-video.html")>-1){var f=angular.element(window).height()-110;angular.element(window).width()/f>b?a.width(b*f):a.width(angular.element(window).width())}if(d.scene.templateUrl.indexOf("scene-centered.html")>-1){var g=(angular.element(c).height()-a.width())/2;0>g&&(g=0),e.find(".scene-centered").css("paddingTop",g)}a.height(a.width()/b),e.find(".matchVideoHeight:visible").height(a.height()),e.find(".stretchToViewportBottom:visible").each(function(){$(this).css("min-height",angular.element(c).height()-this.offsetTop-45)})},h=function(){-1===d.scene.templateUrl.indexOf("scene-explore")&&d.scene.isActive&&$("body,html").stop().animate({scrollTop:0},500)};a.isFramed&&(a.isIPad||a.isIPhone)?d.$watch(function(){return a.windowWidth},f):angular.element(c).bind("resize",f),d.$watch("scene.isActive",function(c,d){c&&(f(),b(function(){a.$emit("magnet.changeMagnet",e.find(".videoContainer"))},0))}),a.$on("toolbar.changedSceneTemplate",function(){f(),d.scene.isActive&&b(function(){a.$emit("magnet.changeMagnet",e.find(".videoContainer"))},0)})}}}]),angular.module("com.inthetelling.player").directive("ittItem",["videojs","$rootScope","$timeout",function(a,b,c){return{restrict:"A",replace:!1,template:'<div ng-include="item.templateUrl">Loading Item...</div>',scope:{item:"=ittItem"},link:function(d,e,f){d.item.boCSS=d.item.essentialCSS+" "+d.item.styleCSS,d.$watch("item.isActive",function(e,g){e&&(d.item.stop&&a.player.pause(),f.autoscroll&&c(function(){b.$emit("item.autoscroll")}))}),d.toggleDetailView=function(){d.item.showInlineDetail?d.item.showInlineDetail=!1:(a.player.pause(),e.closest(".content").width()>500?d.item.showInlineDetail=!d.item.showInlineDetail:d.showModal())}},controller:"ItemController"}}]),angular.module("com.inthetelling.player").directive("ittExploreItem",["videojs","$rootScope","$timeout",function(a,b,c){return{restrict:"A",replace:!1,template:'<div ng-include="item.exploreTemplateUrl">Loading Item...</div>',scope:{item:"=ittExploreItem"},link:function(d,e,f){d.item.boCSS=d.item.essentialCSS,d.$watch("item.isActive",function(e,g){e&&(d.item.stop&&a.player.pause(),f.autoscroll&&c(function(){b.$emit("item.autoscroll")}))}),d.toggleDetailView=function(){if(d.item.showInlineDetail){d.item.showInlineDetail=!1;var b=$(e).closest(".scene");b.hide(),c(function(){b.show()})}else if(a.player.pause(),e.closest(".content").width()>500)d.item.showInlineDetail=!d.item.showInlineDetail;else{var f=$(e).offset().top;d.showModal(f)}}},controller:"ItemController"}}]),angular.module("com.inthetelling.player").directive("ittWatchItem",["videojs","$rootScope","$timeout",function(a,b,c){return{restrict:"A",replace:!1,template:'<div ng-include="item.watchTemplateUrl">Loading Item...</div>',scope:{item:"=ittWatchItem"},link:function(d,e,f){d.item.boCSS=d.item.essentialCSS,d.$watch("item.isActive",function(e,g){e&&(d.item.stop&&a.player.pause(),f.autoscroll&&c(function(){b.$emit("item.autoscroll")}))}),d.toggleDetailView=function(){d.item.showInlineDetail?d.item.showInlineDetail=!1:(a.player.pause(),e.closest(".content").width()>500?d.item.showInlineDetail=!d.item.showInlineDetail:d.showModal())}},controller:"ItemController"}}]),angular.module("com.inthetelling.player").directive("ittVideo",["cuePointScheduler","videojs","$timeout","config","$rootScope",function(a,b,c,d,e){return{restrict:"A",replace:!1,template:'<div class="video"></div>',link:function(c,f){f.find(".video").html(function(){var a='<video id="'+d.videoJSElementId+'" class="video-js vjs-story-skin" poster="'+c.episode.coverUrl+'">';return c.episode.videos.youtube?a+='<source type="video/youtube" src="'+c.episode.videos.youtube+'" />':(c.episode.videos.webm&&(a+='<source type="video/webm" src="'+c.episode.videos.webm+'" />'),a+='<source type="video/mp4" src="'+c.episode.videos.mpeg4+'" />'),a+=" </video>"}),c.setPlayhead=a.registerProvider(d.videoJSElementId,d.cuePointScanInterval),b.init(c.episode.videos,function(a){a.on("play",function(){a.hasPlayed||(a.hasPlayed=!0,e.$emit("toolbar.videoFirstPlay"),a.on("timeupdate",function(){c.setPlayhead(a.currentTime())}))});for(var b={duration:c.episode.videos.duration,setting:{},marker_breaks:[],marker_text:[]},d=0;d<c.scenes.length;d++)c.scenes[d].title&&(b.marker_breaks.push(c.scenes[d].startTime),b.marker_text.push(c.scenes[d].title));a.markers(b),a.trigger("loadedmetadata")})}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.reposition=function(a){if(b.magnet){var d=16/9;c.css("position","fixed"===b.magnet.css("position")?"fixed":"absolute"),c.offset(b.magnet.offset()),c.width(b.magnet.width()),c.height(b.magnet.width()/d)}},a.$on("magnet.changeMagnet",function(a,c){b.magnet=c,b.reposition(!0)});var d=a.$on("magnet.reposition",function(){b.reposition(!0)}),e=a.$on("magnet.repositionImmediately",function(){b.reposition(!1)});b.$on("$destroy",function(){d(),e()})}}}]),angular.module("com.inthetelling.player").directive("ittToolbar",["$timeout","$rootScope","videojs","$window","$location",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/toolbar/toolbar.html",link:function(f,g){f.show={navigationPanel:!1,searchPanel:!1,searchPanelInternals:!1,introPanel:!0,playerPanel:!1,helpPanel:!1},a(function(){b.$emit("magnet.changeMagnet",g.find(".videoContainer"))},0),b.isFramed&&(b.isIPad||b.isIPhone)?f.$watch(function(){return b.windowWidth},function(){b.$emit("magnet.repositionImmediately")}):angular.element(d).bind("resize",function(){b.$emit("magnet.repositionImmediately")});var h=function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}var f="."+document.location.host.match(/[^\.]*\.\w*$/)[0];document.cookie=a+"="+b+d+";domain="+f+";path=/"},i=function(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++)if(0===b[c].indexOf(a+"="))return b[c].substring(a.length+1);return!1};if(h("canSetCookie",!0,1),i("canSetCookie")&&(document.cookie="canSetCookie=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",!i("noMoreHelp"))){f.show.helpPanel=!0;var j=f.$watch(function(){return f.show.playerPanel},function(a){console.log("plyaerpanel cahnged",a),a&&(c.player.pause(),j())})}f.noMoreHelp=function(){f.show.helpPanel=!1,h("noMoreHelp","1",3650),c.player.play()},f.setSceneTemplate=function(a){f.currentSceneTemplate=a,f.autoscrollEnabled="explore"===a,f.exploreMode=f.autoscrollEnabled;for(var c=0;c<f.scenes.length;c++){var d=f.scenes[c];a?(void 0===d.origTemplateUrl&&(d.origTemplateUrl=d.templateUrl),d.templateUrl="templates/scene-"+a+".html"):d.origTemplateUrl&&(d.templateUrl=d.origTemplateUrl)}b.$emit("toolbar.changedSceneTemplate")},f.currentSceneTemplateIs=function(a){return f.currentSceneTemplate===a},f.mainframeescape=function(){c.player.pause(),window.open(e.absUrl()).focus()},f.showNavigationPanel=function(){c.player.pause(),c.player.controls(!1),f.show.navigationPanel=!0},f.showSearchPanel=function(){c.player.pause(),c.player.controls(!1),f.show.searchPanel=!0,f.currentSceneTemplateIs("explore")&&f.enableAutoscroll(),a(function(){f.show.searchPanelInternals=!0},0)},f.toggleSearchPanel=function(){f.show.searchPanel?f.hidePanels():(f.showSearchPanel(),document.getElementById("searchtext").focus())},f.showSceneMenu=function(){f.show.navigationPanel?f.hidePanels():f.showNavigationPanel()},f.showVideoControls=function(){c.player&&c.player.userActive(!0)},f.toggleCaptions=function(){f.hideCaptions=!f.hideCaptions;for(var a=0;a<f.scenes.length;a++)f.scenes[a].hideCaptions=f.hideCaptions},f.hidePanels=function(){f.show.navigationPanel=!1,f.show.searchPanel=!1,f.show.helpPanel=!1,f.searchText="",c.player.controls(!0)},f.gotoTime=function(a){c.player.currentTime(a)},f.firstPlayWatcher=b.$on("toolbar.videoFirstPlay",function(){$(".injectedvideocontrols").appendTo($(".vjs-control-bar")).show(),angular.element(window).width()<481&&f.setSceneTemplate("explore"),f.show.introPanel=!1,f.show.playerPanel=!0,b.$emit("toolbar.changedSceneTemplate"),f.firstPlayWatcher(),f.curSceneWatcher=f.$watch(function(){for(var a=c.player.currentTime(),b=0;b<f.scenes.length;b++)if(f.scenes[b].startTime>a)return f.scenes[b-1];return f.scenes[f.scenes.length-1]},function(a){f.curScene=a})}),f.captureScrollEvents=!0,b.$on("item.autoscroll",function(){if(f.captureScrollEvents&&f.autoscrollEnabled){var b=1/0;angular.forEach($(".content .item.currentItem"),function(a){var c=$(a).offset().top;b>c&&(b=c)});var c=45+$(".videoContainer:visible").height();1/0>b&&(f.captureScrollEvents=!1,$("body,html").stop().animate({scrollTop:b-c},1e3,"swing",function(){a(function(){f.captureScrollEvents=!0},50)}))}}),angular.element(d).bind("scroll",function(){f.captureScrollEvents&&f.autoscrollEnabled&&(f.autoscrollEnabled=!1)}),f.enableAutoscroll=function(){f.autoscrollEnabled=!0,b.$emit("item.autoscroll")}},controller:"ToolbarController"}}]),angular.module("com.inthetelling.player").directive("ittContentPane",["$filter",function(a){return{restrict:"A",replace:!1,scope:!0,templateUrl:"templates/contentpane.html",link:function(b,c,d){b.pane=d.pane||"main",b.contentLayout=d.content||"content",b.itemlist=a("layout")(b.scene.items,b.contentLayout),b.showCurrent=b.scene.showCurrent||d.showCurrent,"templates/scene-explore.html"===b.scene.templateUrl&&(b.showCurrent=!1),b.forceItemTemplate=d.forceItemTemplate;var e=function(){if(d.noSidebars)return b.noSidebars=!0,void 0;for(var a=0;a<b.itemlist.length;a++){var c=b.itemlist[a].layout;"burst"===c?(b.hasLeftSidebar=!0,b.hasRightSidebar=!0):"sidebarL"===c||"burstL"===c?b.hasLeftSidebar=!0:("sidebarR"===c||"burstR"===c)&&(b.hasRightSidebar=!0)}};b.$watch(function(){return c.width()},function(a){a>0&&450>a?(b.noSidebars=!0,b.hasLeftSidebar=!1,b.hasRightSidebar=!1):e()},!0)}}}]),angular.module("com.inthetelling.player").filter("type",function(){return function(a,b){if(b){var c,d=[];for(c=0;c<a.length;c++)b[a[c].type]&&d.push(a[c]);return d}return[]}}),angular.module("com.inthetelling.player").filter("layout",function(){return function(a,b){if(!a||!b)return[];var c,d=[];for(c=0;c<a.length;c++)switch(b){case"transcript":a[c].inContentPane&&"annotation"===a[c].type&&d.push(a[c]);break;case"transmedia":a[c].inContentPane&&"annotation"!==a[c].type&&d.push(a[c]);break;case"required":a[c].inContentPane&&a[c].required&&"annotation"!==a[c].type&&d.push(a[c]);break;case"optional":a[c].inContentPane&&!a[c].required&&"annotation"!==a[c].type&&d.push(a[c]);break;case"transcript+required":(a[c].inContentPane&&a[c].required||"annotation"===a[c].type)&&d.push(a[c]);break;case"transcript+optional":(a[c].inContentPane&&!a[c].required||"annotation"===a[c].type)&&d.push(a[c]);break;case"content":a[c].inContentPane&&d.push(a[c]);break;default:a[c].layout===b&&d.push(a[c])}return d}}),angular.module("com.inthetelling.player").filter("itemList",function(){return function(a,b){if(b){var c,d=[];for(c=0;c<a.length;c++)a[c].isActive&&d.push(a[c]);return d}return a}}),angular.module("com.inthetelling.player").filter("highlight",["$sce",function(a){return function(b,c){return c||angular.isNumber(c)?a.trustAsHtml(b.toString().replace(new RegExp(c.toString(),"gi"),'<span class="ui-match">$&</span>')):b
}}]),angular.module("com.inthetelling.player").filter("transcript",function(){return function(a){for(var b=[],c=0;c<a.length;c++)"annotation"===a[c].type&&a[c].isActive&&!a[c].cosmetic&&a[c].templateUrl.indexOf("/transcript-")>-1&&b.push(a[c]);return b}});