"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate"]).config(["$routeProvider",function(a){a.when("/episodes",{title:"Telling STORY: All episodes",templateUrl:"templates/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"}),$(document).on("keypress",function(b){"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&(0===b.which&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.responseInterceptors.push(["$q",function(){function a(a){return a}function b(a){var b=a.status;if(401===b){if(localStorage.storyAuth){var c=angular.fromJson(localStorage.storyAuth);localStorage.removeItem("storyAuth"),c.login_url&&(c.login_via_top_window_only?window.top.location.href=c.login_url:window.location.href=c.login_url)}return window.location.reload(),!1}}return function(c){return c.then(a,b)}}])}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/episode/episode.html",'<div class="episode">\n\n	<!-- begin review mode -->\n	<div class="reviewMode" ng-show="appState.viewMode == \'review\'">\n		<div itt-magnet id="reviewModeVideoMagnet" class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="scene" ng-class="{navigable: scene.title}" ng-repeat="scene in episode.scenes" ng-if="!scene._internal">\n			<div class="pane mainPane">\n				<div class="content allowHighlights">\n					<h2 ng-if="scene.title">{{scene.title}}</h2>\n					<div class="item animate" ng-repeat="item in scene.items | isContent | annotation | filter:{cosmetic:false} | orderBy:\'start_time\'" ng-class="item.styleCss + \' \' + item.state" itt-item="item" forceTemplate="review-annotation">\n					</div>\n				</div>\n			</div>\n			<div class="pane altPane">\n				<div class="content allowHighlights">\n					<img ng-if="$index == 1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding">\n					<!-- contentAlt -->\n					<div class="item animate" ng-repeat="item in scene.items | \n					                                  isContent | \n					                                  transmedia | \n					                                  filter:{cosmetic:false}" ng-class="item.styleCss + \' \' + item.state" itt-item="item" forceTemplate="review-transmedia">\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n	<!-- end review mode -->\n\n	<!-- just the video magnet for watch mode -->\n	<div class="watchMode" ng-show="appState.viewMode == \'watch\'">\n		<div itt-magnet id="watchModeVideoMagnet" class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n\n	<!-- everything except review mode needs only the current scene: -->\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n\n		<div class="discoverMode" ng-show="appState.viewMode == \'discover\'">\n			<div class="fill bgLayer">\n				<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items |\n				                                                isCurrent | \n				                                                itemLayout:\'windowBg\'">\n				</div>\n			</div>\n			<div itt-scene="scene" episode="episode"></div>\n		</div>\n\n		<span ng-if="appState.viewMode == \'watch\' && !appState.hideCaptions">\n			<div class="item watchModeCaption animate" ng-repeat="item in scene.items  | \n			                                                     transcript | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item" forceTemplate="caption">\n			</div>\n		</span>\n\n		<div class="fill overlay windowFg fgLayer" ng-show="appState.viewMode == \'discover\'">\n			<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowFg\'">\n			</div>\n		</div>\n	</span>\n\n	<div itt-magnetized class="pane videoContainer">\n		<div class="video contentLayer" itt-video="episode.masterAsset.video"></div>\n		<div class="pane fill overlay fgLayer">\n			<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in episode.items | \n				                                                itemLayout:\'videoOverlay\' | \n				                                                isCurrent">\n			</div>\n		</div>\n	</div>\n\n\n	<div ng-if="loading" class="loading">\n		<div class="spinner">\n			<div class="rotating pie"></div>\n			<div class="filler pie"></div>\n			<div class="mask"></div>\n		</div>\n		Loading\n	</div>\n\n	<div class="autoscroll" ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click="enableAutoscroll()">\n		<img src="/images/autoscroll.svg" width="32" height="32">\n	</div>\n</div>\n'),a.put("templates/episodelist.html",'Episode list\n\n<div ng-controller="EpisodeListController">\n	<div ng-repeat="episode in episodes">\n		({{episode._id}}) {{episode.title}} -\n		<a href="#episode/{{episode._id}}">Episode</a> -\n		<a ng-click="authenticate(episode._id)">OAuth</a>\n		<br>\n	</div>\n</div>\n\n<div x-ng-controller="ErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/error.html",'<div x-ng-if="error" class="error">\n	<h2>Error</h2>\n	<p>Sorry, but something went wrong and we weren\'t able to continue:<br>{{error.message}}</p>\n	<span style="color:#FFF">\n		<pre>{{error.details}}</pre>\n	</span>\n</div>'),a.put("templates/item/caption.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n	<div class="text">{{item.annotation}}</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/edit.html",'<div ng-if="item" class="itemEdit">\n\n	<ul class="tabs">\n		<li><a ng-class="{active: !visibleTab || visibleTab == 0}" ng-click="visibleTab=0">Edit item content</a>\n		</li>\n		<li><a ng-class="{active: visibleTab ==1}" ng-click="visibleTab=1">Edit item appearance</a>\n		</li>\n	</ul>\n\n	<div class="tabcontents" ng-if="!visibleTab || visibleTab ==0">\n		<span ng-if="item.type==\'Annotation\'">\n			<label class="labelrow">\n				<span class="label">Speaker</span>\n				<span class="field">\n					<input type="text" ng-model="item.annotator">\n				</span>\n			</label>\n			<label class="labelrow">\n				<span class="label">Transcript</span>\n				<span class="field">\n					<textarea rows="5" ng-model="item.annotation"></textarea>\n				</span>\n			</label>\n		</span>\n\n		<span ng-if="item.type!=\'Annotation\'">\n			<label class="labelrow">\n				<span class="label">Title</span>\n				<span class="field">\n					<input type="text" ng-model="item.title">\n				</span>\n			</label>\n			<label class="labelrow">\n				<span class="label">Description</span>\n				<span class="field">\n					<textarea rows="5" ng-model="item.description"></textarea>\n				</span>\n			</label>\n			<div class="labelrow">\n				<span class="label"></span>\n				<label class="field">\n					<input type="checkbox" ng-model="item.required">Students are\n					<span ng-if="!item.required">not</span>\n					required to view this item\n				</label>\n			</div>\n		</span>\n\n		<span ng-if="item.type == \'Link\'">\n			<label class="labelrow">\n				<span class="label">Link</span>\n				<span class="field">\n					<input type="text" ng-model="item.url">\n				</span>\n			</label>\n		</span>\n\n		<span ng-if="item.type == \'Upload\'">\n			<label class="labelrow">[TODO: select from asset container / upload new asset]\n				<br>{{item.asset.url}}</label>\n		</span>\n\n\n		<label class="labelrow">\n			<span class="label">Start time</span>\n			<span class="field">\n				<input type="text" ng-model="item.start_time">\n			</span>\n		</label>\n		<div class="labelrow">\n			<span class="label">End time</span>\n			<label style="float:left;">\n				<input type="checkbox" ng-init="item.noEndTime = true" ng-model="item.noEndTime">\n				<span ng-if="item.noEndTime">Automatic</span>\n			</label>\n			<span class="field">\n				<input ng-if="!item.noEndTime" type="text" ng-model="item.end_time">\n			</span>\n		</div>\n		<div class="labelrow">\n			<span class="label">Stop item</span>\n			<label class="field">\n				<input type="checkbox" ng-model="item.stop">Timeline will\n				<span ng-if="!item.stop">not</span>\n				pause when this item enters\n			</label>\n		</div>\n	</div>\n\n	<div class="tabcontents" ng-if="visibleTab == 1">\n\n		<fieldset>\n			<legend>Item preview</legend>\n			<div class="itemPreview" ng-include="item.templateUrl"></div>\n		</fieldset>\n		<div>\n			TODO: improve editor UI(!); include remaining templates; style, layout options\n		</div>\n		<div class="labelrow">\n			<span class="label">Template</span>\n			<span class="field">\n				<select ng-model="item.templateUrl">\n					<option value="templates/item/item.html">Generic item</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/pullquote-noattrib.html">Pullquote (without attribution)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/pullquote.html">Pullquote (with attribution)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/text-h1.html">Primary header</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/text-h2.html">Secondary header</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript.html">Transcript</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript-withthumbnail.html">Transcript (with thumbnail)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript-withthumbnail-alt.html">Transcript (with thumbnail / alt)</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/link.html">Default link</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/image-fill.html">Plain image</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload.html">Upload (generic)</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-inline.html">Inline image</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-thumbnail.html">Image thumbnail</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-caption.html">Image with caption</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-caption-sliding.html">Image with sliding caption</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-linkonly.html">External link, no inline framing</option>\n				</select>\n			</span>\n		</div>\n\n		<div class="labelrow">\n			<span class="label">Cosmetic</span>\n			<label class="field">\n				<input type="checkbox" ng-model="item.cosmetic">\n				<span ng-if="item.cosmetic">This is a decorative item, not to be included in search, bibliography, etc.</span>\n				<span ng-if="!item.cosmetic">This is a content item.</span>\n\n			</label>\n		</div>\n\n\n		<div class="labelrow">\n			<span class="label">Layout</span>\n			<label class="field">\n				<select size="1" ng-model="item.layouts[0]">\n					<option value="" disabled>Content layouts:</option>\n\n					<option value="inline">Inline</option>\n					<option value="sidebarL">TODO Left sidebar</option>\n					<option value="sidebarR">TODO Right sidebar</option>\n					<option value="burstL">TODO Burst left margin</option>\n					<option value="burstR">TODO Burst right margin</option>\n					<option value="burst">TODO Burst both margins</option>\n					<option value="windowFg">Full screen</option>\n					<option value="" disabled>Decorative layouts:</option>\n					<option value="windowBg">Full screen background</option>\n					<option value="mainBg">Background of main content pane</option>\n					<option value="altBg">Background of secondary content pane</option>\n					<option value="mainFg">Foreground of main content pane</option>\n					<option value="altFg">Foreground of secondary content pane</option>\n					<option value="videoOverlay">Overlay video</option>\n				</select>\n			</label>\n		</div>\n\n		<div class="labelrow">\n			<span class="label">Styles</span>\n			<div class="field">\n				<label>\n					<input type="checkbox" ng-model="item.customstyles">\n					<span ng-if="item.customstyles">Customize the appearance of this item</span>\n					<span ng-if="!item.customstyles">Use this episode\'s default item styles</span>\n				</label>\n\n				<div ng-if="item.customstyles">\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTransition">\n						<option value="">Default transition</option>\n						<option value="transitionNone">No transition</option>\n						<option value="transitionFade">Fade in / fade out</option>\n						<option value="transitionSlideL">Slide to left</option>\n						<option value="transitionSlideR">Slide to right</option>\n						<option value="transitionPop">"Pop" in and out</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTypography">\n						<option value="">Default typography</option>\n						<option value="typographySerif">Serif</option>\n						<option value="typographySans">Sans</option>\n						<option value="typographyBook">Book</option>\n						<option value="typographySwiss">Swiss</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customColor">\n						<option value="">Default colors</option>\n						<option value="colorInvert">Invert colors</option>\n						<option value="colorSepia">Sepia colors</option>\n						<option value="colorSolarized">Solarized colors</option>\n						<option value="colorVivid">Vivid colors</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTimestamp">\n						<option value="">Default timestamp</option>\n						<option value="timestampNone">No timestamp</option>\n						<option value="timestampSmall">Small timestamp</option>\n						<option value="timestampInline">Inline timestamp</option>\n						<option value="timestampSidebar">Sidebar timestamp</option>\n\n					</select>\n\n\n				</div>\n\n\n				<!-- \n		<br>styleCss:\n		<input type="text" ng-model="item.styleCss">\n		<br>layoutCss: -->\n			</div>\n		</div>\n\n\n	</div>\n\n\n	<input type="button" ng-click="save()" value="Save">\n	<input type="button" ng-click="cancelEdit()" value="Cancel">\n	<a ng-click="itemEditDebug=!itemEditDebug">Debug</a>\n	<pre style="max-height: 200px; overflow-y: scroll" ng-if="itemEditDebug">{{item | pretty}}</pre>\n\n</div>\n'),a.put("templates/item/image-fill.html",'<!-- one or the other of .item background-image and fillImg will be made invisible, depending on fill type -->\n<div class="imageFill" ng-style="{\'background-image\': \'url(\' + item.asset.url + \')\'}">\n	<img class="fillImg" ng-src="{{item.asset.url}}">\n</div>\n'),a.put("templates/item/image-plain.html",'<div class="touchable">\n	<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n	<div class="touchableIndicator"></div>\n</div>\n'),a.put("templates/item/item.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n\n	<div class="text">{{item.annotation}} {{item.description}}</div>\n\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/link.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="toggleDetailView()">{{item.title || \'(Untitled)\'}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="itemDetail" x-ng-if="item.showInlineDetail">\n		<a ng-href="{{item.url}}" target="_blank" class="escapelink">(new window)</a>\n		<div class="iframeContainer">\n			<iframe ng-src="{{item.url}}"></iframe>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/modal.html",'<div class="modal">\n	<div ng-if="item._type == \'Link\'" class="modalmenu">\n		<a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a>\n	</div>\n	<div ng-if="item._type == \'Link\'" class="iframeContainer">\n		<iframe x-ng-src="{{item.url}}"></iframe>\n	</div>\n	<div ng-click="dismiss();" class="modalimage" ng-if="item._type == \'Upload\'">\n		<img ng-src="{{item.asset.url}}">\n	</div>\n</div>\n'),a.put("templates/item/multiplechoice.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n\n	<div class="multipleChoiceQuestion">\n		<!-- begin plugin.  TODO make this its own directive -->\n		<p>{{plugin.question}}</p>\n\n		<div ng-repeat="distractor in plugin.distractors">\n			<label ng-click="setChoice($index)" ng-class="{\n				correct: plugin.hasBeenAnswered && distractor.correct,\n				incorrect: plugin.hasBeenAnswered && !distractor.correct\n			}">\n				<input type="radio" name="fnord" ng-disabled="plugin.hasBeenAnswered" ng-model="$parent.plugin.selectedDistractor" value="{{$index}}">{{distractor.text}}\n			</label>\n		</div>\n\n		<input type="button" ng-disabled="plugin.hasBeenAnswered" value="Check your answer" ng-click="scoreQuiz()">\n		<!-- end plugin -->\n\n		<p ng-repeat="distractor in plugin.distractors" ng-if="distractor.selected">{{distractor.feedback}}</p>\n	</div>\n\n	<div class="clear"></div>\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<a ng-if="itemDebug" ng-click="resetQuestion()">(Reset question)</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/pullquote-noattrib.html",'<div class="headerItem">\n	<div class="pullquote">{{item.annotation}}</div>\n</div>\n'),a.put("templates/item/pullquote.html",'<div class="headerItem">\n	<div class="pullquote">{{item.annotation}}</div>\n	<div class="pullquoteSpeaker">{{item.annotator}}</div>\n</div>\n'),a.put("templates/item/review-annotation.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n	<div class="text">{{item.annotation}}</div>\n	<!-- {{item.templateUrl}} -->\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/review-transmedia.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n\n	<div class="text">{{item.annotation}} {{item.description}}</div>\n\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/searchresults.html",'<div>\n	<span class="displayTime">\n		<a href="javascript:void 1" x-ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</a>\n	</span>\n	<span class="type" ng-bind-html="item.trustedDisplayTitle | highlightSubstring: searchText"></span>\n	<div class="description" ng-bind-html="item.trustedDisplayText | highlightSubstring: searchText"></div>\n\n</div>\n'),a.put("templates/item/text-h1.html",'<div class="headerItem">\n	<h1>{{item.annotation}}</h1>\n</div>\n'),a.put("templates/item/text-h2.html",'<div class="headerItem">\n	<h2>{{item.annotation}}</h2>\n</div>\n'),a.put("templates/item/transcript-withthumbnail-alt.html",'<div>\n	<div class="icon" style="float:right; margin-right: 0.5em;">\n		<img ng-src="{{item.asset.url}}">\n	</div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n	</div>\n	<div class="authorName">{{item.annotator}}</div>\n	<div class="text">{{item.annotation}}</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/transcript-withthumbnail.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n	</div>\n	<div class="icon" style="float:left; margin-right: 0.5em;">\n		<img ng-src="{{item.asset.url}}">\n		<div class="clear"></div>\n	</div>\n	<div class="authorName">{{item.annotator}}</div>\n	<div class="text">{{item.annotation}}</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/transcript.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n	<div class="text">{{item.annotation}}</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload-caption-sliding.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="captionContainer touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n		<div class="caption slidingcaption">\n			<div class="title">{{item.title}}</div>\n			<div class="text">{{item.description}}</div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload-caption.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="captionContainer touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n		<div class="caption">\n			<div class="title">{{item.title}}</div>\n			<div class="text">{{item.description}}</div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload-inline.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload-linkonly.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="outgoingLink(item.asset.url)">{{item.title || \'(Untitled)\'}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload-thumbnail.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n\n	<div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()">\n		<img ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n\n	</div>\n	<div class="text">\n		<div class="title">{{item.title}}</div>\n		<div class="text">{{item.description}}</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/upload.html",'<div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="toggleDetailView()">{{item.title || \'(Untitled)\'}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="itemDetail" x-ng-if="item.showInlineDetail">\n		<!-- TODO handle videos here by checking item.asset._type -->\n		<div class="touchable" style="position:relative">\n			<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n			<div class="touchableIndicator"></div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/usc-badges.html",'<div ng-if="true || plugin.eligibleForBadges">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		This is for testing the credly badge.\n	</div>\n\n\n	<h3>{{plugin.achievement}}</h3>\n\n	<div ng-repeat="req in plugin.requirements">\n		{{req.name}}:\n		<i ng-if="req.achieved">Complete</i>\n		<i ng-if="!req.achieved">Incomplete</i>\n	</div>\n\n\n	<p ng-if="plugin.totalAchieved != plugin.requirements.length">\n		You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement\n	</p>\n\n	<div ng-if="plugin.totalAchieved == plugin.requirements.length && ! plugin.gotBadge">\n		<p>YOU WIN THE INTERNETS</p>\n\n		You\'re eligible for a badge from credly.com. Enter your email address to claim it:\n		<input type="text" ng-model="plugin.userEmail">\n		<input type="button" value="Go" ng-click="badger()">\n\n		<span ng-if="plugin.gettingBadge">Getting your badge...</span>\n\n	</div>\n	<div ng-if="plugin.gotBadge">\n		Your badge is in the mail.\n		<span ng-if="plugin.alreadyHadBadge">(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span>\n	</div>\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/player.html",'<div class="player" ng-class="{\n	isFramed: appState.isFramed,\n	producer: appState.producer,\n	editBgLayer: editLayer.bgLayer,\n	editFgLayer: editLayer.fgLayer,\n	editContentLayer: editLayer.contentLayer,\n	editScene: editLayer.scene\n	}">\n	<div class="toolbar">\n		<div class="modegroup buttongroup">\n			<a class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')">\n				<span>Watch</span>\n			</a>\n			<a class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')">\n				<span>Discover</span>\n			</a>\n			<a class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')">\n				<span>Review</span>\n			</a>\n		</div>\n		<!-- <div ng-if="appState.producer && appState.viewMode == \'discover\'" class="buttongroup">\n			<a class="button" ng-click="editLayer(\'scene\');">Scene<span>Edit the scene layout (TODO)</span></a>\n			<a class="button" ng-click="editLayer(\'bgLayer\');">BG<span>Edit the background layer</span></a>\n			<a class="button" ng-click="editLayer(\'contentLayer\');">C<span>Edit the content layer</span></a>\n			<a class="button" ng-click="editLayer(\'fgLayer\');">FG<span>Edit the foreground layer</span></a>\n			<a class="button" ng-click="editLayer(\'\');">All<span>Show everything</span></a>\n		</div> -->\n		<div ng-if="appState.isFramed" class="escapegroup buttongroup">\n			<a ng-click="mainframeescape();" class="button button-mainframeescape">\n				<span>New window</span>\n			</a>\n		</div>\n		<div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}">\n			<a class="button button-search" ng-click="toggleSearchPanel()">\n				<span>Search</span>\n			</a>\n			<input id="searchtext" type="text" ng-model="searchText" />\n		</div>\n	</div>\n	<div itt-episode></div>\n	<div ng-if="appState.viewMode != \'watch\'" class="branding">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n	</div>\n\n	<div class="toolbar-bottom" ng-mouseenter="showControls();keepControls()" ng-mouseleave="allowControlsExit()" ng-class="{hidden: !appState.videoControlsActive}">\n		<div class="toolbar-bottom-fill">\n			<div ng-show="show.navPanel" class="navPanel">\n				<h2>{{episode.title}}</h2>\n				<div class="scene" x-ng-if="scene.title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)">\n					<span class="displayTime">{{scene.displayTime}}</span>\n					<p>\n						<a href="javascript:void 1;">{{scene.title}}</a>\n						<br>{{scene.description}}\n					</p>\n				</div>\n			</div>\n\n			<!-- <div ng-if="appState.editing" itt-item-editor="appState.editing"></div> -->\n			<div itt-timeline></div>\n		</div>\n	</div>\n	<div class="toolbar-bottom-controltrigger" ng-mouseenter="showControls();keepControls()"></div>\n</div>\n\n\n<div ng-show="show.navPanel || show.searchPanel || show.helpPanel" class="modal-backdrop" ng-click="hidePanels()"></div>\n\n<!-- ITEM DETAIL -->\n<div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div>\n<div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div>\n\n<!-- SEARCH -->\n<div ng-show="show.searchPanel" class="searchPanel">\n	<div ng-if="show.searchPanel" itt-search-panel>This will be the search panel</div>\n</div>\n\n<!-- HELP -->\n<div ng-if="show.helpPanel" class="helpPanel">\n	<div class="arrow-up"></div>\n	<p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p>\n	<ul>\n		<li class="video">\n			<h3>Watch</h3>\n			<p>Just the video, no frills.</p>\n		</li>\n		<li class="directed">\n			<h3>Discover</h3>\n			<p>The guided, synchronized view of the video and related content.</p>\n		</li>\n		<li class="explore">\n			<h3>Review</h3>\n			<p>Read the full transcript and all the related transmedia in one convenient list.</p>\n		</li>\n	</ul>\n	<a class="goAway" x-ng-click="noMoreHelp()" href="javascript:void 1;">Don\'t show this again</a>\n</div>\n\n\n\n<!-- <div ng-controller="ErrorController" ng-include="\'templates/error.html\'"></div> -->\n<!-- \n<a href="javascript:void 1;" ng-click="showDebug=!showDebug">DEBUG:</a>\n<pre ng-if="showDebug === true">{{appState | pretty }}</pre>\n<pre ng-if="showDebug === true">{{episode | pretty}}</pre>\n -->\n'),a.put("templates/producer/episode.html",'<div class="producer">\n\n	TODO?\n</div>\n'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div itt-magnet class="videoMagnet" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}">\n		<img src=" images/aspectratiopreserver-16x9.gif">\n	</div>\n	<div class="col" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{ singleitem: showCurrent ? (contentItems | isCurrent).length==1 : (contentItems).length==1 , allowHighlights: !showCurrent }">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item"\n				></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n			</div>\n			<div class="clear "></div>\n		</div>\n		<div class="fill fgLayer overlay">\n			<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif " class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent\n			}">\n				<div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerH.html",'<!--\nVideo, Main, Alt:\n___________\n|V/M |M/V |\n|____|____|\n|A        |\n|         |\n|_________|\nshowCurrent is forced in Main.\n-->\n\n<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="row">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane matchVideoHeight">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="row">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerV.html",'<!--\nVideo, Main, Alt:\n___________    ___________\n|V   |A   |    |A   |V   |\n|____|    |    |    |____|\n|M   |    |    |    |M   |\n|    |    |    |    |    |\n|____|____|    |____|____|\nshowCurrent is forced in main.\n-->\n\n<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent\n			}">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/debug.html","\n<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/landingscreen.html",'<div>\n	<div style="width:40%; margin: 0 30%">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	This is the landing screen. So far it is just a stub.\n	<h3>{{episode.title}}</h3>\n	<p>{{episode.description}}</p>\n\n	<label><input type="checkbox">testing</label>\n	<input type="text">\n	<textarea>foo<b>nar</b> baz</textarea>\n</div>\n'),a.put("templates/scene/scene.html","\n"),a.put("templates/searchpanel.html",'<div>\n	<div class="searchfilters">\n		<label x-ng-show="sortBy!==\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="startTime">Sorted by type\n		</label>\n		<label x-ng-show="sortBy===\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="type">Sorted by time\n		</label>\n	</div>\n	<div class="scrollContainer">\n		<div class="searchResults">\n			<div x-ng-if="sortBy == \'startTime\'">\n				<div x-ng-repeat="scene in episode.scenes">\n					<h3 x-ng-if="sceneItems.length > 0 && scene.title">{{scene.title}}</h3>\n					<div x-ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText, \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'">\n					</div>\n				</div>\n			</div>\n\n			<!-- sorted by type -->\n			<div x-ng-if="sortBy == \'type\'">\n				<div x-ng-repeat="(typeID,showType) in searchTypes" x-ng-if="showType">\n					<h3 x-ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3>\n					<div x-ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\">\n					</div>\n				</div>\n			</div>\n			<div x-ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">\n				(Nothing matched your search.)\n			</div>\n		</div>\n	</div>\n</div>\n"),a.put("templates/timeline.html",'<div class="timeline">\n\n	<div class="progressbarBox">\n		<div class="pbarTop">\n			<a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()">\n				<span class="control-text">Zoom out</span>\n			</a>\n			<a class="button button-zoomin" ng-click="zoomIn()">\n				<span class="control-text">Zoom in</span>\n			</a>\n		</div>\n		<div class="pbarMain">\n			<div class="progressbar">\n				<div class="mask">\n					<div class="progressbarContainer" style="width: {{zoomLevel}}00%">\n						<div class="played" style="width: {{markerPercent(appState.time)}}%"></div>\n						<div class="buffered" style="width: {{0}}%"></div>\n					</div>\n				</div>\n				<!-- unmasked parts of timeline -->\n				<div class="progressbarContainer" style="width: {{zoomLevel}}00%;">\n					<div class="handle" ng-show="isSeeking " style="left: {{markerPercent(willSeekTo)}}% ">\n						<div class="tip">{{willSeekTo | asTime}}</div>\n					</div>\n					<div class="tooltip" ng-if="event.showTooltip" ng-repeat="event in timeline.markedEvents " style="left: {{markerPercent(event.start_time)}}% ">\n						<span class="content">{{event.title}}</span>\n						<div class="tooltip-arrow"></div>\n					</div>\n				</div>\n				<div id="playhead" class="mask">\n					<!-- interactive parts of timeline -->\n					<div class="progressbarContainer " style="width: {{zoomLevel}}00%">\n						<div class="marker" ng-mouseover="showTooltip(event);" ng-mouseout="hideTooltip(event)" ng-repeat="event in timeline.markedEvents" style="left: {{markerPercent(event.start_time)}}% "></div>\n					</div>\n				</div>\n			</div>\n			<a ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click="prevScene()">\n				<span class="control-text">Previous</span>\n			</a>\n			<div class="tooltip sceneMenuTooltip" ng-if="tooltip.sceneMenu">\n				<span class="content">Scene-by-scene navigation</span>\n				<div class="tooltip-arrow"></div>\n			</div>\n\n			<a class="button-scenemenu" ng-click="toggleNavPanel()" ng-mouseover="tooltip.sceneMenu=true" ng-mouseout="tooltip.sceneMenu=false">\n				<span class="control-text">Scenes</span>\n			</a>\n			<a ng-class="{invisible: appState.time == appState.duration}" class="button button-next" ng-click="nextScene()">\n				<span class="control-text">Next</span>\n			</a>\n		</div>\n		<div class="pbarBottom">\n			<span class="small" style="float:left;">\n				{{appState.time | asTime}} / {{appState.duration | asTime}}\n				<span ng-if="appState.videoType == \'video\'">\n					<a class="button button-speedcontrol" ng-if="appState.timeMultiplier == 1" ng-click="setSpeed(1.25)">&nbsp;</a>\n					<a class="button button-speedcontrol" ng-if="appState.timeMultiplier == 1.25" ng-click="setSpeed(1.5)">x1.25</a>\n					<a class="button button-speedcontrol" ng-if="appState.timeMultiplier == 1.5" ng-click="setSpeed(2)">x1.5</a>\n					<a class="button button-speedcontrol" ng-if="appState.timeMultiplier == 2" ng-click="setSpeed(0.75)">x2</a>\n					<a class="button button-speedcontrol" ng-if="appState.timeMultiplier == 0.75" ng-click="setSpeed(1)">x0.75</a>\n				</span>\n			</span>\n\n			<a ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}">\n				<span class="control-text">Captions</span>\n			</a>\n\n			<a ng-if="!appState.isTouchDevice" class="button button-fullscreen" ng-class="{active: appState.isInFullscreenMode}" ng-click="toggleFullscreen()">\n				<span class="control-text">Fullscreen</span>\n			</a>\n\n			<span ng-if="!appState.isTouchDevice">\n				<a class="button button-mute {{audioIcon()}}" ng-click="toggleMute()">\n					<span class="control-text">Mute</span>\n				</a>\n				<div class="volumebar">\n					<div class="volume" style="width: {{currentVolume()}}%"></div>\n				</div>\n			</span>\n		</div>\n	</div>\n\n	<a class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()">\n		<span class="control-text">Play</span>\n	</a>\n	<a class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()">\n		<span class="control-text">Pause</span>\n	</a>\n\n\n</div>\n'),a.put("templates/video.html",'<div class="video">\n	<iframe id="ytplayer{{uid}}" ng-if="video.youtube" ng-src="{{video.youtube + \'?enablejsapi=1&controls=0&modestbranding=1&showinfo=0\'}}"></iframe>\n	<video ng-if="!video.youtube">\n		<source class="mpeg4" ng-if="video.mpeg4" ng-src="{{video.mpeg4}}" type="video/mp4" />\n		<source class="webm" ng-if="video.webm" ng-src="{{video.webm}}" type="video/webm" />\n		<p>Oh no! Your browser does not support the HTML5 Video element.</p>\n	</video>\n	<div ng-click="videoClick()" class="videoMask" ng-class="{\n		play: appState.timelineState == \'paused\',\n		firstplay: !appState.hasBeenPlayed\n	}">\n</div>\n')
}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.player").factory("authSvc",["config","$routeParams","$http","$q","$location","modelSvc",function(a,b,c,d,e,f){var g={};g.roles=[],g.userHasRole=function(a){for(var b=0;b<g.roles.length;b++)if(g.roles[b]===a)return!0;return!1},g.authenticate=function(){var a=d.defer();if(b.key){var g=b.key;e.search("key",null),i(g).then(function(){a.resolve()})}else if(c.defaults.headers.common.Authorization)a.resolve();else if(localStorage&&localStorage.storyAuth){var j=angular.fromJson(localStorage.storyAuth);f.appState.user=j,c.defaults.headers.common.Authorization='Token token="'+j.access_token+'"',a.resolve()}else h().then(function(b){i(b).then(function(){a.resolve()})});return a.promise};var h=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url&&(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url)}).error(function(){b.reject()}),b.promise},i=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){f.appState.user=a;try{localStorage.setItem("storyAuth",JSON.stringify(a))}catch(b){}g.roles=a.roles,c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',e.resolve(a)}).error(function(){e.reject()}),e.promise};return g}]),angular.module("com.inthetelling.player").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc",function(a,b,c,d,e,f,g){var h={};h.getEpisodeList=function(){var c=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+"/v1/episodes").success(function(a){c.resolve(a)}).error(function(){})}),c.promise},h.getEpisode=function(a){g.episodes[a]||(g.cache("episode",{_id:a}),c.local?r(a):f.authenticate().then(function(){l().then(function(){o(a)},function(){})},function(){}))};var i={template:{},layout:{},style:{}},j=!1,k=a.defer(),l=function(){if(j===!0)k.resolve();else{if("in progress"===j)return k.promise;j="in progress",a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){m("templates",a[0].data),m("layouts",a[1].data),m("styles",a[2].data),j=!0,k.resolve()},function(){j=!1,k.reject()})}return k.promise},m=function(a,b){angular.forEach(b,function(b){"templates"===a?i.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?i.layout[b._id]={id:b._id,css:b.css_name,displayName:b.display_name}:"styles"===a&&(i.style[b._id]={id:b._id,css:b.css_name,displayName:b.display_name})})},n=function(a){if(a.template_id&&i.template[a.template_id]&&(a.templateUrl=i.template[a.template_id].url,delete a.template_id),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){i.layout[a]&&b.push(i.layout[a].css)}),b.length>0&&(a.layouts=b),delete a.layout_id}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){i.style[a]&&c.push(i.style[a].css)}),c.length>0&&(a.styles=c),delete a.style_id}return a},o=function(a){b.get(e.apiDataBaseUrl+"/v1/episodes/"+a).success(function(b){("Published"===b.status||f.userHasRole("admin"))&&(g.cache("episode",n(b)),p(a),q(b.container_id,a))}).error(function(){})},p=function(a){b.get(e.apiDataBaseUrl+"/v2/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",n(a))}),g.resolveEpisodeEvents(a)}).error(function(){})},q=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&q(a[0].parent_id,c)}).error(function(){}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)}).error(function(){})},r=function(a){g.cache("episode",{_id:a,created_at:"2014-04-10T02:02:15Z",description:"The Business Case for Sustainability",master_asset_id:"masterasset",title:"Test Episode",status:"Published",templateUrl:"templates/episode/episode.html",styles:["transitionPop","highlightBorder"]}),g.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/embed/sRS36lDiDvk","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var b={_id:"-",_type:"Scene",title:"Scene title",description:"Scene Description",keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:a,layouts:["videoLeft",""],styles:["transitionSlideL"]},c=["templates/scene/cornerV.html","templates/scene/1col.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/cornerH.html"],d=0;10>d;d++){var e=angular.copy(b);e._id="scene-"+d,e.title=d/2===Math.floor(d/2)?"Scene "+(d+1)+" Title":"",e.title="Scene "+(d+1)+" Title",e.start_time=20*d,e.end_time=20*d+20,e.templateUrl=c[d%c.length],g.cache("event",e)}var f={_id:"",_type:"Annotation",annotation:"Transcript text",annotation_image_id:"asset3",annotator:"Speaker Name",cosmetic:!1,episode_id:a,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:[]},h=["inline","inline","burstL","inline","inline","burstR","inline","inline","burst","inline","inline","sidebarL","inline","inline","sidebarR","inline","inline"];for(d=0;30>d;d++){var i=angular.copy(f);i._id="transcript-"+d,i.annotation="Transcript block number "+(d+1),i.start_time=5*d,i.end_time=5*d+5,i.layouts=[h[d%h.length]],g.cache("event",i)}g.resolveEpisodeEvents(a),g.resolveEpisodeAssets(a)};return h}]),angular.module("com.inthetelling.player").factory("modelSvc",["$interval","$filter","config",function(a,b,c){var d={};d.appState={user:{},episodeId:!1,isFramed:window.parent!=window,isIDevice:navigator.platform.indexOf("iPad")>-1||navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,isTouchDevice:"ontouchstart"in window||"onmsgesturechange"in window,windowWidth:0,windowHeight:0,viewMode:"discover",time:0,timeMultiplier:1,duration:0,timelineState:"paused",hasBeenPlayed:!1,volume:100,muted:!1,hideCaptions:!1,videoControlsActive:!1,show:{searchPanel:!1,helpPanel:!1,navPanel:!1},itemDetail:!1,editing:!1,blerg:"fnord"},a(function(){d.appState.windowHeight=angular.element(window).height(),d.appState.windowWidth=angular.element(window).width()},50,0,!1),d.appState.isIDevice&&(document.getElementById("CONTAINER").className="iDevice"),d.episodes={},d.assets={},d.events={},d.containers={},d.cache=function(a,b){"episode"===a?d.episodes[b._id]?angular.extend(d.episodes[b._id],d.deriveEpisode(angular.copy(b))):d.episodes[b._id]=d.deriveEpisode(angular.copy(b)):"event"===a?d.events[b._id]?angular.extend(d.events[b._id],d.deriveEvent(angular.copy(b))):d.events[b._id]=d.deriveEvent(angular.copy(b)):"asset"===a?d.assets[b._id]?angular.extend(d.assets[b._id],d.deriveAsset(angular.copy(b))):d.assets[b._id]=d.deriveAsset(angular.copy(b)):"container"===a&&(d.containers[b._id]?angular.extend(d.containers[b._id],angular.copy(b)):d.containers[b._id]=angular.copy(b))},d.deriveEpisode=function(a){return a},d.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=g(a)),a};var e={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/episode.html","templates/episode-ewb.html":"templates/episode/episode.html","templates/episode-gw.html":"templates/episode/episode.html","templates/episode-tellingstory.html":"templates/episode/episode.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/upload-caption.html","templates/transmedia-image-default.html":"templates/item/upload.html","templates/transmedia-slidingcaption.html":"templates/item/upload-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/upload-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/upload-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/item.html","templates/upload-demo.html":"templates/item/item.html"};d.deriveEvent=function(a){return"Scene"!==a._type&&(a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0)),e[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=e[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])),a.displayStartTime=b("asTime")(a.start_time),a},d.resolveEpisodeEvents=function(a){var b=[],c=[];angular.forEach(d.events,function(d){d.episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))}),d.episodes[a].scenes=b.sort(function(a,b){return a.start_time-b.start_time}),d.episodes[a].items=c.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(b,function(a){var b=[];angular.forEach(c,function(c){c.start_time>=a.start_time&&c.start_time<a.end_time&&(d.events[c._id].scene_id=a._id,b.push(c))}),d.events[a._id].items=b.sort(function(a,b){return a.start_time-b.start_time})}),d.episodes[a].styleCss=f(d.episodes[a]),angular.forEach(d.events,function(b){b.episode_id===a&&(b.styleCss=f(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},d.episode=function(a){return!d.episodes[a],d.episodes[a]},d.episodeEvents=function(a){var b=[];return angular.forEach(d.events,function(c){c.episode_id===a&&b.push(c)}),b},d.scene=function(a){return!d.events[a],d.events[a]};var f=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var e=d.events[a.scene_id].styles;angular.forEach(e,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.episode_id){var f=d.episodes[a.episode_id].styles;angular.forEach(f,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}return c.join(" ")};d.resolveEpisodeAssets=function(a){angular.forEach(d.events,function(b){if(b.episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&d.assets[c]&&(d.events[b._id].asset=d.assets[c])}}),d.episodes[a].masterAsset=d.assets[d.episodes[a].master_asset_id]},d.addLandingScreen=function(a){d.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:.001}};var g=function(a){var b={};if(a.alternate_urls){for(var d=/\.(\w+)$/,e=0;e<a.alternate_urls.length;e++)if(a.alternate_urls[e].match(/youtube/))b.youtube=a.alternate_urls[e];else switch(a.alternate_urls[e].match(d)[1]){case"mp4":b.mpeg4=h(b.mpeg4,a.alternate_urls[e]);break;case"m3u8":b.m3u8=h(b.m3u8,a.alternate_urls[e]);break;case"webm":b.webm=h(b.webm,a.alternate_urls[e])}a.you_tube_url&&(b.youtube=a.you_tube_url)}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:a.you_tube_url};return/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),b.youtube=b.youtube.replace(/https?:\/\//,"//"),c.disableYoutube&&(b.youtube=void 0),a.video=b,a},h=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,d=a.match(c)||[0,0],e=b.match(c)||[0,0];return Math.floor(d[1])<Math.floor(e[1])?b:a};return d}]),angular.module("com.inthetelling.player").factory("timelineSvc",["$timeout","$interval","$rootScope","modelSvc","analyticsSvc",function(a,b,c,d,e){var f={};f.timelineEvents=[],f.markedEvents=[];var g,h,i,j;f.registerVideo=function(b){void 0!==i&&a(function(){f.seek(d.appState.time)}),i=b},f.setSpeed=function(a){j=a,d.appState.timeMultiplier=j,i.setSpeed(a)},f.play=function(){return d.appState.hasBeenPlayed?void(angular.isDefined(g)||i.play().then(function(){d.appState.timelineState="playing",r(),g=b(r,20),n(),e.captureEpisodeActivity("play")})):(d.appState.hasBeenPlayed=!0,void c.$emit("video.firstPlay"))},f.pause=function(c){b.cancel(g),o(),g=void 0,m=void 0,d.appState.timelineState="paused",i.pause(),c&&a(f.play,1e3*c*Math.abs(j)),e.captureEpisodeActivity("pause")},f.seek=function(b,c,g){if(!i||0===d.appState.duration)return void a(function(){f.seek(b)},300);o();var h=d.appState.time;if(b=s(b),0>b&&(b=0),b>d.appState.duration&&(b=d.appState.duration),d.appState.time=b,f.updateEventStates(),i.seek(b),"playing"===d.appState.timelineState&&(f.pause(),f.play()),c){var j={method:c,seekStart:h};g&&(j.event_id=g),e.captureEpisodeActivity("seek",j)}},f.toggleMute=function(){d.appState.muted=!d.appState.muted,i.toggleMute()},f.setVolume=function(a){d.appState.volume=a,i.setVolume(a)};var k,l=function(){k={lastTimelineTime:0,lastVideoTime:0}};l();var m,n=function(){k.lastTimelineTime=d.appState.time,k.lastVideoTime=d.appState.time,p()},o=function(){a.cancel(h),l()},p=function(){if(a.cancel(h),"playing"===d.appState.timelineState){for(var b=i.currentTime(),c=d.appState.time,e=0;e<f.timelineEvents.length;e++){var g=f.timelineEvents[e];if(g.t>=k.lastTimelineTime){if(g.t>c)break;if("pause"===g.action&&g.t===k.lastTimelineTime);else if(q(g),"pause"===g.action){e++;break}}}var j=f.timelineEvents[e];if(k.lastVideoTime=b,k.lastTimelineTime=c,j&&"playing"===d.appState.timelineState){var l=1e3*(f.timelineEvents[e].t-c);h=a(p,l+10)}}},q=function(a){"timeline"===a.id?"pause"===a.action?(d.appState.time=a.t,f.pause()):f.play():"enter"===a.action?(d.events[a.id].state="isCurrent",d.events[a.id].isCurrent=!0):(d.events[a.id].state="isPast",d.events[a.id].isCurrent=!1)},r=function(){var a=new Date,b=isNaN(a-m)?0:a-m,c=parseFloat(d.appState.time)+b/1e3*j;0>c&&(c=0,f.pause()),c>d.appState.duration&&(c=d.appState.duration,f.pause()),d.appState.time=c,m=a};f.init=function(a){f.timelineEvents=[],j=1,d.appState.duration=0,d.appState.timelineState="paused",f.injectEvents(d.episodeEvents(a),0)},f.injectEvents=function(a,b){0!==a.length&&(angular.forEach(a,function(a){"Scene"===a._type&&a.title&&f.markedEvents.push(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,d.events[a._id].start_time=.01),a.stop?(f.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),f.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),f.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(f.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&f.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"}))}),f.timelineEvents=f.timelineEvents.sort(function(a,b){return a.t===b.t?"enter"===b.action?1:"exit"===b.action?-1:0:a.t-b.t}),d.appState.duration=f.timelineEvents[f.timelineEvents.length-1].t,f.updateEventStates())},f.updateEventStates=function(){var a=d.appState.time;angular.forEach(f.timelineEvents,function(a){if("timeline"!==a.id){var b=d.events[a.id];b.state="isFuture",b.isCurrent=!1}}),angular.forEach(f.timelineEvents,function(b){if(b.t<=a){var c=d.events[b.id];"enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1)}})};var s=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return f}]),angular.module("com.inthetelling.player").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","modelSvc",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},5e3);c.local&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(f.appState.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.appState.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b){f.appState.user.track_event_actions&&g.activityQueue.push({name:a,event_id:b,walltime:new Date})},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){if(0!==g.activityQueue.length){var a=angular.copy(g.activityQueue);g.activityQueue=[];var b=new Date,c=[],d=[];angular.forEach(a,function(a){a.age=(b-a.walltime)/1e3,delete a.walltime,a.event_id?d.push(a):c.push(a)}),d.length&&i("event_user_actions",{event_user_actions:d}),c.length&&i("episode_user_metrics",{episode_user_metrics:c})}};var i=function(a,c){b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.appState.episodeId+"/"+a,data:c}).success(function(){}).error(function(){})};return g}]),angular.module("com.inthetelling.player").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"===a._type&&b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("trustAsHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("highlightSubstring",["$sce",function(a){return function(b,c){return c||angular.isNumber(c)?a.trustAsHtml((""+b).replace(RegExp(""+c,"gi"),'<span class="ui-match">$&</span>')):b}}]).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}),angular.module("com.inthetelling.player").controller("ErrorController",["$scope","$rootScope","$location",function(a,b){b.$on("error",function(b,c){a.error=c})}]),angular.module("com.inthetelling.player").controller("EpisodeListController",["$scope","config","dataSvc",function(a,b,c){c.getEpisodeList().then(function(b){a.episodes=b}),a.authenticate=function(a){localStorage&&localStorage.removeItem("storyAuth"),window.location=b.apiDataBaseUrl+"/pages/launch_oauth2?episode="+a}}]),angular.module("com.inthetelling.player").controller("EpisodeEditorController",["$scope","$injector","modelSvc",function(a,b,c){b.invoke(PlayerController,this,{$scope:a}),c.appState.producer=!0,c.appState.HELLODOLLY="fantastic"}]),angular.module("com.inthetelling.player").controller("TimelineController",["$scope","timelineSvc","modelSvc",function(a,b,c){a.play=b.play,a.pause=b.pause,a.setSpeed=function(a){b.setSpeed(a)},a.markerPercent=function(a){return a/c.appState.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.toggleFullscreen=function(){d()?e():f()};var d=function(){return document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen};a.$watch(function(){return d()},function(a){c.appState.isInFullscreenMode=a});var e=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},f=function(){var a=document.getElementById("CONTAINER");a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.player").controller("PlayerController",["$scope","$rootScope","$routeParams","$timeout","$interval","dataSvc","modelSvc","timelineSvc","analyticsSvc",function(a,b,c,d,e,f,g,h,i){a.viewMode=function(a){g.appState.viewMode=a,i.captureEpisodeActivity("modeChange",{mode:a}),"review"===a?(g.appState.autoscroll=!0,d(u)):g.appState.autoscroll=!1},c.viewMode&&a.viewMode(c.viewMode),c.t&&h.seek(c.t,"URLParameter"),c.producer&&(g.appState.producer=!0),g.appState.episodeId=c.epId,g.addLandingScreen(g.appState.episodeId),f.getEpisode(g.appState.episodeId);var j=a.$watch(function(){return g.episodes[g.appState.episodeId].title},function(a,b){a!==b&&(document.title="STORY: "+a,j())});a.loading=!0;var k=a.$watch(function(){return g.episodes[g.appState.episodeId].items},function(b){b&&(h.init(g.appState.episodeId),a.loading=!1,k())});a.episode=g.episode(g.appState.episodeId),a.appState=g.appState,a.show=g.appState.show,a.now=new Date,g.appState.videoControlsActive=!0,g.appState.videoControlsActive=!1;var l,m;a.$watch(function(){return g.appState.videoControlsActive},function(a){a&&(m=d(function(){l||(g.appState.videoControlsActive=!1)},3e3))}),a.showControls=function(){d.cancel(m),g.appState.videoControlsActive=!0},a.keepControls=function(){l=!0},a.allowControlsExit=function(){l=!1,d.cancel(m),m=d(function(){g.appState.videoControlsActive=!1},3e3)},a.toggleSearchPanel=function(){g.appState.show.searchPanel=!g.appState.show.searchPanel},a.toggleNavPanel=function(){g.appState.show.navPanel=!g.appState.show.navPanel},a.seek=function(a){h.seek(a,"sceneMenu")};var n=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(o){n=!1}n&&localStorage.removeItem("iCanHazStorage"),b.$on("video.firstPlay",function(){n&&!localStorage.getItem("noMoreHelp")?g.appState.show.helpPanel=!0:h.play()}),a.hidePanels=function(){g.appState.show.helpPanel=!1,g.appState.show.navPanel=!1,g.appState.show.searchPanel=!1},a.noMoreHelp=function(){g.appState.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),h.play()};var p,q=$(g.appState.isIDevice?window:"#CONTAINER"),r=$(g.appState.isIDevice?"html":"#CONTAINER"),s=function(){p=e(u,400),q.bind("scroll",function(){r.stop(),t(),g.appState.autoscrollBlocked=!0}),u()},t=function(){q.unbind("scroll"),e.cancel(p)};a.enableAutoscroll=function(){g.appState.autoscrollBlocked=!1,s()};var u=function(){if(!g.appState.autoscrollBlocked&&g.appState.autoscroll){var a=1/0,b=q.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),1/0!==a){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(t(),r.animate({scrollTop:a-c},1500,"swing",function(){d(function(){s()},100)}))}}};s(),b.$on("userKeypress.ESC",function(){g.appState.show.searchPanel=!1,g.appState.show.helpPanel=!1,g.appState.show.navPanel=!1,g.appState.itemDetail=!1})}]),angular.module("com.inthetelling.player").controller("EpisodeController",["$scope","modelSvc","$routeParams",function(a,b){a.episode=b.episode(b.appState.episodeId),a.appState=b.appState}]),angular.module("com.inthetelling.player").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){$.inArray("showCurrent",a.scene.layouts)>-1&&(a.showCurrent=!0),a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)if(($.inArray("burstL",a.mainContentItems[c].layouts)||$.inArray("sidebarL",a.mainContentItems[c].layouts)||$.inArray("burst",a.mainContentItems[c].layouts))&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)||$.inArray("sidebarR",a.mainContentItems[c].layouts)||$.inArray("burst",a.mainContentItems[c].layouts))&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar){a.mainContentHasBothSidebars=!0;break}for(c=0;c<a.altContentItems.length;c++)if(($.inArray("burstL",a.altContentItems[c].layouts)||$.inArray("sidebarL",a.altContentItems[c].layouts)||$.inArray("burst",a.altContentItems[c].layouts))&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)||$.inArray("sidebarR",a.altContentItems[c].layouts)||$.inArray("burst",a.altContentItems[c].layouts))&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar){a.altContentHasBothSidebars=!0;break}}}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","modelSvc","timelineSvc",function(a,b,c){a.seek=function(b){c.seek(b,"clickedOnItem",a.item._id)},a.editItem=function(c){b.appState.producer&&(b.appState.videoControlsActive=!0,b.appState.editing=angular.copy(a.item)),c.preventDefault()}}]),angular.module("com.inthetelling.player").controller("VideoController",["$q","$scope","$timeout","$window","$document","modelSvc","timelineSvc",function(a,b,c,d,e,f,g){var h=document.createElement("script");h.src="//www.youtube.com/iframe_api",angular.element(e[0].head).append(h),d.onYouTubeIframeAPIReady=function(){b.youtubeIsReady=!0},b.$on("$destroy",function(){b.YTPlayer=void 0}),b.initVideo=function(a){if(b.video.youtube)if(b.videoType="youtube",b.videoNode=a.find("iframe")[0],b.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return b.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",b.videoNode=a.find("video")[0],g.registerVideo(b),b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("waiting",function(){b.playerState="waiting"},!1),b.videoNode.addEventListener("stalled",function(){b.playerState="stalled"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1);f.appState.videoType=b.videoType},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data]}}}),g.registerVideo(b)},b.play=function(){var c=a.defer();if("youtube"===b.videoType){b.YTPlayer.playVideo();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())})}else b.videoNode.play(),c.resolve();return c.promise},b.pause=function(){"youtube"===b.videoType?(b.YTPlayer.seekTo(f.appState.time,!0),b.YTPlayer.pauseVideo()):(b.videoNode.currentTime=f.appState.time,b.videoNode.pause())},b.seek=function(a){try{"youtube"===b.videoType?(b.YTPlayer.seekTo(a,!0),"paused"===f.appState.timelineState&&b.pause()):b.videoNode.currentTime=a}catch(d){c(function(){b.seek(a)},100)}},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","$sce","timelineSvc",function(a,b,c){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.seek=function(a,b){c.seek(a,"clickedOnEventInSearch",b)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){a.searchableText=(a.annotation||a.description)+" "+(a.title||a.annotator),a.trustedDisplayText=b.trustAsHtml(a.annotation||a.description),a.trustedDisplayTitle=b.trustAsHtml(a.title||a.annotator)
})}}]),angular.module("com.inthetelling.player").directive("ittTimeline",["modelSvc","timelineSvc",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(c,d){c.appState=a.appState,c.timeline=b,c.handlePosition=0,c.zoomLevel=1,c.zoomOffset=0;var e=d.find(".progressbarContainer"),f=d.find(".progressbar");c.prevScene=function(){for(var c=b.markedEvents.length-1;c>=0;c--)if(b.markedEvents[c].start_time<a.appState.time){b.seek(b.markedEvents[c].start_time,"prevScene");break}},c.nextScene=function(){for(var c=!1,d=0;d<b.markedEvents.length;d++)if(b.markedEvents[d].start_time>a.appState.time){b.seek(b.markedEvents[d].start_time,"nextScene"),c=!0;break}c||b.seek(a.appState.duration,"nextScene")},c.userChangingVolume=function(b){a.appState.muted&&c.toggleMute();var d=angular.element(b.currentTarget),e=function(a,b){var e=(a.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),b?c.setVolume(e):c.$apply(c.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})},c.currentVolume=function(){return a.appState.muted?0:a.appState.volume},c.audioIcon=function(){return a.appState.muted?"muted":"vol"+Math.floor(a.appState.volume/34)},c.showTooltip=function(a){a.showTooltip=!0},c.hideTooltip=function(a){a.showTooltip=!1},c.zoomIn=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel+1,g()},c.zoomOut=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel-1,c.zoomLevel<1&&(c.zoomLevel=1),g()};var g=function(){c.zoomOffset=-((c.zoomLevel-1)*(a.appState.time/a.appState.duration)),e.animate({left:100*c.zoomOffset+"%",width:100*c.zoomLevel+"%"},1e3,function(){c.stopWatching=!1})};c.$watch(function(){return{t:a.appState.time,d:a.appState.duration}},function(){c.stopWatching||(c.zoomOffset=-((c.zoomLevel-1)*(a.appState.time/a.appState.duration)),e.css({left:100*c.zoomOffset+"%"}))},!0);var h=function(b){c.isSeeking=!0;var d=a.appState.isTouchDevice?"touchend.timeline":"mouseup.timeline";f.bind(d,function(){j()}),angular.element(document).bind(d,function(){k()}),i(b)},i=function(b){c.isSeeking&&(c.willSeekTo=(b.clientX-e.offset().left)/e.width()*a.appState.duration)},j=function(){c.stopWatching=!0,b.seek(c.willSeekTo,"scrubTimeline"),g()},k=function(){angular.element(document).unbind("mouseup.timeline"),angular.element(document).unbind("touchend.timeline"),f.unbind("mouseup.timeline"),f.unbind("touchend.timeline"),c.$apply(function(){c.isSeeking=!1})},l=angular.element("#playhead");a.appState.isTouchDevice?(l.bind("touchstart.timeline",function(a){h(a.originalEvent.targetTouches[0]),a.preventDefault()}),l.bind("touchmove.timeline",function(a){i(a.originalEvent.targetTouches[0]),a.preventDefault()})):(l.bind("mousedown.timeline",function(a){h(a),a.preventDefault()}),l.bind("mousemove.timeline",function(a){i(a),a.preventDefault()}))}}}]),angular.module("com.inthetelling.player").directive("ittEpisode",["modelSvc","analyticsSvc",function(a,b){return{restrict:"A",replace:!0,templateUrl:"templates/episode/episode.html",controller:"EpisodeController",link:function(){b.captureEpisodeActivity("episodeLoad")}}}]),angular.module("com.inthetelling.player").directive("ittScene",["$timeout","modelSvc",function(a,b){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl">Loading Item...</span>',controller:"SceneController",link:function(a,c){a.precalculateSceneValues();var d=function(){var b=c.find(".videoMagnet img");if(null===b.height())var e=a.$watch(function(){return c.find(".videoMagnet img").height()},function(a){a>0&&(e(),d())});else c.find(".matchVideoHeight:visible").each(function(){$(this).css("height",c.find(".videoMagnet img").height())}),c.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",angular.element(window).height()-$(this).offset().top)})};a.unwatch=a.$watch(function(){return{winWidth:b.appState.windowWidth,winHeight:b.appState.windowHeight,newMode:b.appState.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&d()},!0),a.$on("$destroy",function(){a.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittItem",["$http","config","modelSvc","analyticsSvc","timelineSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(f,g){if(f.item.data&&(f.plugin=f.item.data._plugin,f.plugin._type=f.item.data._pluginType,"multiplechoice"===f.plugin._type&&(f.setChoice=function(a){f.plugin.hasBeenAnswered||(f.plugin.selectedDistractor=a)},f.scoreQuiz=function(){f.plugin.distractors[f.plugin.selectedDistractor].selected=!0,f.plugin.hasBeenAnswered=!0,d.captureEventActivity("question-answered",f.item._id)},f.resetQuestion=function(){f.plugin.selectedDistractor=void 0,f.plugin.hasBeenAnswered=!1;for(var a=0;a<f.plugin.distractors.length;a++)f.plugin.distractors[a].selected=!1}),"credlyBadge"===f.plugin._type)){var h=c.appState.user;h.roles.length&&"guest"!==h.roles[0]&&(f.plugin.eligibleForBadges=!0,f.plugin.userEmail=h.emails[0],f.plugin.totalAchieved=0,angular.forEach(f.plugin.requirements,function(a){d.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,b&&f.plugin.totalAchieved++})})),f.badger=function(){f.plugin.gettingBadge=!0,a({method:"GET",url:b.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+f.plugin.credlyBadgeId+"&email="+f.plugin.userEmail}).success(function(a){"Badge previously sent."===a.status&&(f.plugin.alreadyHadBadge=!0),f.plugin.gotBadge=!0}).error(function(){})}}f.toggleDetailView=function(){f.item.showInlineDetail?f.item.showInlineDetail=!1:(f.captureInteraction(),g.closest(".content").width()>500?f.item.showInlineDetail=!0:(e.pause(),c.appState.itemDetail=f.item))},f.forceModal=function(){e.pause(),c.appState.itemDetail=f.item},f.outgoingLink=function(a){e.pause(),f.captureInteraction(),window.open(a)},f.captureInteraction=function(){d.captureEventActivity("clicked",f.item._id)}}}}]),angular.module("com.inthetelling.player").directive("ittItemDetailModal",["modelSvc","timelineSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.appState.itemDetail=!1}}}}]),angular.module("com.inthetelling.player").directive("ittItemEditor",["modelSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/item/edit.html",controller:"ItemController",link:function(b){b.item.layouts||(b.item.layouts=[]),b.$watch(function(){return b.item.end_time},function(a){b.item.noEndTime=""===a}),b.save=function(){b.item=a.deriveEvent(b.item);for(var c in b.item)b.item.hasOwnProperty(c)&&(a.events[b.item._id][c]=angular.copy(b.item[c]));a.resolveEpisodeEvents(b.item.episode_id),a.appState.editing=!1},b.updateStyles=function(){b.item.styles=[],angular.forEach([b.item.customTransition,b.item.customTypography,b.item.customColor,b.item.customTimestamp],function(a){a&&b.item.styles.push(a)}),b.item.styleCss=b.item.styles.join(" ")},b.cancelEdit=function(){a.appState.editing=!1}}}}]),angular.module("com.inthetelling.player").directive("ittVideo",["$timeout","$rootScope","modelSvc","timelineSvc",function(a,b,c,d){var e=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(f,g){f.appState=c.appState,f.uid=++e,a(function(){if(f.video)f.initVideo(g);else var a=f.$watch(function(){return f.video},function(b){b&&(f.initVideo(g),a())})}),f.videoClick=function(){"paused"===c.appState.timelineState?d.play():d.pause(),c.appState.videoControlsActive=!0},b.$on("userKeypress.SPACE",f.videoClick)}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope","$timeout","modelSvc",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.appState.windowWidth,winHeight:c.appState.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.abs(c)>2?e.width()+c/4:d.magnet.width()),e.height(d.magnet.width()/f)})};a.$on("magnet.changeMagnet",function(a,b){g(b)}),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittMagnet",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),b.$on("$destroy",function(){b.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittSearchPanel",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.indexEvents()}}});