"use strict";angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/episodes",{title:"Telling STORY: All available episodes",templateUrl:"templates/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"});var b=!1;$(document).on("keydown",function(c){b||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||(b=!0,27===c.keyCode&&(a.$emit("userKeypress.ESC"),c.preventDefault()),32===c.which&&(a.$emit("userKeypress.SPACE"),c.preventDefault()))}),$(document).on("keyup",function(){b=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.responseInterceptors.push(["$q",function(){return function(a){return a.then(function(a){return a},function(a){throw a})}}])}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){return function(c,d){a(c,d);var e=b.get("errorSvc");e.error(c,d)}}])}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/copyright.html","TELLING STORY player &#169; {{now | date:'yyyy'}} <a href=http://inthetelling.com>IN THE TELLING</a>. All rights reserved. <a href=/privacy.html target=_new>Privacy Policy</a>"),a.put("templates/episode/components/discovermode.html",'<div class=discoverMode ng-show="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene=scene episode=episode></div><div ng-if="(scene.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="fill overlay windowFg fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowFg\'"></div></div></div>'),a.put("templates/episode/components/reviewmode.html",'<div class=reviewMode ng-show="appState.viewMode == \'review\'"><div itt-magnet="" id=reviewModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class=scene ng-class="{navigable: scene.title}" ng-repeat="scene in episode.scenes" ng-if=!scene._internal><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class=sceneTitle ng-if=scene.title>{{scene.title}}</h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items | isContent | filter:{cosmetic:false} | orderBy:\'start_time\'" ng-class=item.state itt-item=item forcetemplate=review-all></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | isContent | annotation | filter:{cosmetic:false} | orderBy:\'start_time\'" ng-class=item.state itt-item=item forcetemplate=review-annotation></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src=images/aspectratiopreserver-16x9.gif class=videoPadding> <div class="item animate" ng-repeat="item in scene.items | isContent | transmedia | filter:{cosmetic:false}" ng-class="item.state " itt-item=item forcetemplate=review-transmedia></div></div></div></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><div class="video contentLayer" itt-video=episode.masterAsset></div><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<span ng-if="appState.viewMode == \'watch\'"><div class=watchMode><div itt-magnet="" id=watchModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><span ng-if=!appState.hideCaptions class=watchModeCaptions ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption animate" ng-repeat="item in episode.items | transcript | isCurrent" ng-class=item.state itt-item=item forcetemplate=caption></div></span></span>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href=http://www.mindwires.com><img src=images/customer/eliterate-mindwires.svg alt="Mindwires logo"></a> <a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/eliterate-logo.svg alt=E-Literate></div></div>'),a.put("templates/episode/episode.html",'<div class=episode ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/ewb-logo.svg alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/gw-logo.svg alt="George Washington"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/purdue-logo.svg alt=Purdue></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/tellingstory-logo.svg alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent"><span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-include="\'templates/episode/components/discovermode.html\'"></span></span> <span ng-include="\'templates/episode/components/video.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/usc-logo.svg alt=USC></div></div>'),a.put("templates/episodelist.html",'Episode list<div ng-controller=EpisodeListController><div ng-repeat="episode in episodes">({{episode._id}}) {{episode.title}} - <a href=#episode/{{episode._id}}>Episode</a> - <a ng-click=authenticate(episode._id)>OAuth</a><br></div></div><div x-ng-controller=ErrorController x-ng-include="\'templates/error.html\'"></div>'),a.put("templates/error-404.html","<div class=errors><div class=error><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>"),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class=errors><div class=error ng-repeat="error in errorSvc.errors"><a style="float: right" ng-click=dismiss(error)>[x]</a><h3>Error: {{error.cause || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if=error.exception.config.url><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if=user.login_url><a ng-if=user.login_via_top_window_only ng-click=resetAuth(); ng-href={{user.login_url}} target=_top>click here</a> <a ng-if=!user.login_via_top_window_only ng-click=resetAuth(); ng-href={{user.login_url}}>click here</a> to log back in.</span> <span ng-if=!user.login_url><a ng-click="resetAuth(); reload();">reset your session</a> and start over.</span></p><a style="font-size: small" ng-click="showDetails= !showDetails">(show details)</a><pre ng-if=showDetails style="font-size: small" ng-bind="error | pretty"></pre></div><div class=notification ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click=dismiss(notification)>[x]</a><p>{{notification.text}}</p></div></span>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=authorName ng-bind-html=item.annotator></div></div><div class=text ng-bind-html=item.annotation></div><div class=clear></div></div>'),a.put("templates/item/debug.html","<div class=itemTemplate><pre ng-if=itemDebug>{{item | pretty}}</pre></div>"),a.put("templates/item/edit.html",'<input type=button ng-click=save() value=Save><input type=button ng-click=cancelEdit() value=Cancel><a ng-click="itemEditDebug=!itemEditDebug">Debug</a><pre style="max-height: 200px; overflow-y: scroll" ng-if=itemEditDebug>{{item | pretty}}</pre>-->'),a.put("templates/item/image-caption-sliding.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div><div class="caption slidingcaption"><div class=title ng-bind-html=item.title></div><div class=text ng-bind-html=item.description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-caption.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div><div class=caption><div class=title ng-bind-html=item.title></div><div class=text ng-bind-html=item.description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-fill.html",'<div class="itemTemplate imageFill" style={{item.backgroundImage}}><img class=fillImg ng-src={{item.asset.url}}></div>'),a.put("templates/item/image-inline.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div class=clear></div></div>'),a.put("templates/item/image-linkonly.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-click=outgoingLink(item.asset.url) ng-bind-html="item.title || \'(Untitled)\'"></a></div><div class=text ng-bind-html=item.description></div></div><div class=clear></div></div>'),a.put("templates/item/image-plain.html",'<div class="itemTemplate imagePlain"><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div>'),a.put("templates/item/image-thumbnail.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click=toggleDetailView()><img ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div class=text><div class=title ng-bind-html=item.title></div><div class=text ng-bind-html=item.description></div></div><div class=clear></div></div>'),a.put("templates/item/image.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-click=toggleDetailView() ng-bind-html="item.title || \'(Untitled)\'"></a></div><div ng-bind-html=item.description></div></div><div class=itemDetail x-ng-if=item.showInlineDetail><div class=touchable style=position:relative><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div><div class=clear></div></div>'),a.put("templates/item/link-embed.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title ng-bind-html=item.title></div><div ng-bind-html=item.description></div></div><div class=iframeContainer><iframe ng-src={{item.url}}></iframe></div><div class=clear></div></div>'),a.put("templates/item/link.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-if=item.noEmbed class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title ||\'(Untitled)\'"></a> <a ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.title ||\'(Untitled)\'"></a></div><div ng-bind-html=item.description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a ng-if=!item.noExternalLink ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/modal.html","<div class=modal ng-click=dismiss();><div ng-if=\"item._type == 'Link'\" class=modalmenu><a href={{item.url}} target=_blank class=escapelink>(new window)</a></div><div ng-if=\"item._type == 'Link'\" class=iframeContainer><iframe x-ng-src={{item.url}}></iframe></div><div class=modalimage ng-if=\"item._type == 'Upload'\"><img ng-src={{item.asset.url}}></div></div>"),a.put("templates/item/multiplechoice.html",'<div class="itemTemplate multipleChoice"><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=authorName ng-bind-html=item.annotator></div></div><div class=multipleChoiceQuestion><p>{{plugin.question}}</p><div ng-repeat="distractor in plugin.distractors"><label ng-click=setChoice($index) ng-class="{\n				correct: plugin.hasBeenAnswered && distractor.correct,\n				incorrect: plugin.hasBeenAnswered && !distractor.correct\n			}"><input type=radio name=fnord ng-disabled=plugin.hasBeenAnswered ng-model=$parent.plugin.selectedDistractor value={{$index}}>{{distractor.text}}</label></div><input type=button ng-disabled=plugin.hasBeenAnswered value="Check your answer" ng-click=scoreQuiz()><p ng-repeat="distractor in plugin.distractors" ng-if=distractor.selected>{{distractor.feedback}}</p></div><div class=clear></div><a ng-click="itemDebug=!itemDebug">Debug</a> <a ng-if=itemDebug ng-click=resetQuestion()>(Reset question)</a><pre ng-if=itemDebug>{{item | pretty}}</pre></div>'),a.put("templates/item/pullquote-noattrib.html",'<div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.annotation></div></div>'),a.put("templates/item/pullquote.html",'<div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.annotation></div><div class=pullquoteSpeaker ng-bind-html=item.annotator></div></div>'),a.put("templates/item/review-all.html","<span><div ng-if=\"item._type == 'Annotation'\" ng-include=\"'templates/item/review-annotation.html'\"></div><div ng-if=\"item._type != 'Annotation'\" ng-include=\"'templates/item/review-transmedia.html'\"></div></span>"),a.put("templates/item/review-annotation.html",'<div><div ng-if=item.isTranscript class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=authorName ng-bind-html=item.annotator></div></div><div class=text ng-bind-html=item.annotation></div></div><div ng-if=!item.isTranscript ng-include=item.templateUrl></div><div class=clear></div></div>'),a.put("templates/item/review-transmedia.html",'<div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-if=item.noEmbed class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title || \'(Untitled)\'"></a> <a ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.title || \'(Untitled)\'"></a></div><div ng-bind-html=item.description></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type == \'Link\'"><a ng-if=!item.noExternalLink ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><iframe ng-src={{item.url}}></iframe></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type != \'Link\'"><div class=touchable style=position:relative><img ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div><div class=clear></div></div>'),a.put("templates/item/searchresults.html",'<div><span class=displayTime><a ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</a></span> <span class=type ng-bind-html="(item.title || item.annotator) | highlightSubstring: searchText"></span><div class=description ng-bind-html="(item.description || item.annotation) | highlightSubstring: searchText"></div></div>'),a.put("templates/item/text-h1.html",'<div class="itemTemplate headerItem"><h1 ng-bind-html=item.annotation></h1></div>'),a.put("templates/item/text-h2.html",'<div class="itemTemplate headerItem"><h2 ng-bind-html=item.annotation></h2></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<div class="itemTemplate transcriptWithThumbnail"><div class=icon style="float:right; margin-right: 0.5em"><img ng-src={{item.asset.url}}></div><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div></div><div class=authorName ng-bind-html=item.annotator></div><div class=text ng-bind-html=item.annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<div class="itemTemplate transcriptWithThumbnail"><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div></div><div class=icon style="float:left; margin-right: 0.5em"><img ng-src={{item.asset.url}}><div class=clear></div></div><div class=authorName ng-bind-html=item.annotator></div><div class=text ng-bind-html=item.annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript.html",'<div class="itemTemplate transcript"><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=authorName ng-bind-html=item.annotator></div></div><div class=text ng-bind-html=item.annotation></div><div class=clear></div></div>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges" ng-if="true || plugin.eligibleForBadges"><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div>This is for testing the credly badge.</div><h3>{{plugin.achievement}}</h3><div ng-repeat="req in plugin.requirements">{{req.name}}: <i ng-if=req.achieved>Complete</i> <i ng-if=!req.achieved>Incomplete</i></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && ! plugin.gotBadge"><p>YOU WIN THE INTERNETS</p>You\'re eligible for a badge from credly.com. Enter your email address to claim it:<input ng-model=plugin.userEmail><input type=button value=Go ng-click=badger()><span ng-if=plugin.gettingBadge>Getting your badge...</span></div><div ng-if=plugin.gotBadge>Your badge is in the mail. <span ng-if=plugin.alreadyHadBadge>(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div><a ng-click="itemDebug=!itemDebug">Debug</a><pre ng-if=itemDebug>{{item | pretty}}</pre></div>'),a.put("templates/player.html",'<div class=player ng-class="{\n	isFramed: appState.isFramed,\n	producer: appState.producer,\n	editBgLayer: editLayer.bgLayer,\n	editFgLayer: editLayer.fgLayer,\n	editContentLayer: editLayer.contentLayer,\n	editScene: editLayer.scene\n	}"><div class=toolbar><div class="modegroup buttongroup"><a class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')"><span>Watch</span></a> <a class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')"><span>Discover</span></a> <a class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')"><span>Review</span></a></div><div ng-if=appState.isFramed class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-href=/v1/new_window/{{appState.episodeId}} target=_new><span>New window</span></a></div><div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><a class="button button-search" ng-click=toggleSearchPanel()><span>Search</span></a><input id=searchtext ng-model=searchText></div></div><div itt-episode=""></div><div class=toolbar-bottom ng-mouseenter=showControls(); ng-click=showControls(); ng-mouseleave=allowControlsExit() ng-show=appState.videoControlsActive><div class=toolbar-bottom-fill><div ng-show=show.navPanel class=navPanel ng-class=episode.styleCss><div class=scene x-ng-if=scene.title x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click=seek(scene.start_time)><span class=displayTime>{{scene.displayTime}}</span><p><a ng-bind-html=scene.title></a><br><span ng-bind-html=scene.description></span></p></div></div><div itt-timeline=""></div></div></div><div class=toolbar-bottom-controltrigger ng-mouseenter=showControls(); ng-click=showControls();></div></div><div class=autoscroll ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click=enableAutoscroll()><img src=/images/autoscroll.svg width=32 height=32></div><div ng-show="show.navPanel || show.searchPanel || show.helpPanel" class=modal-backdrop ng-click=hidePanels()></div><div ng-show=appState.itemDetail class=modal-backdrop ng-click="appState.itemDetail=false"></div><div ng-if=appState.itemDetail itt-item-detail-modal=appState.itemDetail></div><div ng-show=show.searchPanel class=searchPanel><div ng-if=show.searchPanel itt-search-panel="">This will be the search panel</div></div><div ng-if=show.helpPanel class=helpPanel><div class=arrow-up></div><p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p><ul><li class=video><h3>Watch</h3><p>Just the video, no frills.</p></li><li class=directed><h3>Discover</h3><p>The guided, synchronized view of the video and related content.</p></li><li class=explore><h3>Review</h3><p>Read the full transcript and all the related transmedia in one convenient list.</p></li></ul><a class=goAway x-ng-click=noMoreHelp() href="javascript:void 1;">Don\'t show this again</a></div><div ng-if=loading class=loading><div class=spinner><div class="rotating pie"></div><div class="filler pie"></div><div class=mask></div></div>Loading</div><div ng-controller=ErrorController ng-include="\'templates/error.html\'"></div>'),a.put("templates/producer/episode.html","<div class=producer>TODO?</div>"),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class=videoMagnet ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src=images/aspectratiopreserver-16x9.gif></div><div class=col><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><div class="col col1"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div><div class="col col2"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><div class="col col1"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class="col col2"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class=row><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=row><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=col><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewport"><div class="pane introtext"><h1 ng-bind-html=episode.title></h1><p ng-bind-html=episode.description></p></div><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class=clear></div></div>'),a.put("templates/searchpanel.html","<div ng-class=episode.styleCss><div class=searchfilters><label ng-show=\"sortBy!=='startTime'\"><input type=radio name=searchsort id=searchsort ng-model=sortBy value=startTime>Sorted by type</label><label ng-show=\"sortBy==='startTime'\"><input type=radio name=searchsort id=searchsort ng-model=sortBy value=type>Sorted by time</label></div><div class=scrollContainer><div class=searchResults><div ng-if=\"sortBy == 'startTime'\"><div ng-repeat=\"scene in episode.scenes\"><h3 ng-if=\"sceneItems.length > 0 && scene.title\" ng-bind-html=scene.title></h3><div class=item ng-repeat=\"item in sceneItems=\n						(scene.items \n						| orderBy:'startTime' \n						| filter:{'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\"></div></div></div><div ng-if=\"sortBy == 'type'\"><div ng-repeat=\"(typeID,showType) in searchTypes\" ng-if=showType><h3 ng-if=\"typeItems.length > 0\">{{searchTypeNames[typeID]}}</h3><div class=item ng-repeat=\"item in typeItems=\n						(episode.items \n						| orderBy:'startTime' \n						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\"></div></div></div><div ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">(Nothing matched your search.)</div></div></div></div>"),a.put("templates/timeline.html",'<div class=timeline><div class=progressbarBox><div class=pbarTop></div><div class=pbarMain><div class=progressbar><div class=mask><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=played ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=handle ng-show="isSeeking " ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class=tip>{{willSeekTo | asTime}}</div></div><div class=tooltip ng-if=event.showTooltip ng-repeat="event in timeline.markedEvents " ng-style="{left: markerPercent(event.start_time)+\'%\'}"><span class=content ng-bind-html=event.title></span><div class=tooltip-arrow></div></div></div><div class="playhead mask"><div class=progressbarContainer ng-style="{width: zoomLevel+\'00%\'}"><div class=marker ng-mouseover=showTooltip(event); ng-mouseout=hideTooltip(event) ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"></div></div></div></div><a ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click=prevScene()><span class=control-text>Previous</span></a><div class="tooltip sceneMenuTooltip" ng-if=sceneMenuToolTip><span class=content>Scene-by-scene navigation</span><div class=tooltip-arrow></div></div><a class=button-scenemenu ng-click=toggleNavPanel(); ng-mouseover=showSceneMenuTooltip(true) ng-mouseout=showSceneMenuTooltip(false)><span class=control-text>Scenes</span></a> <a ng-class="{invisible: appState.time == appState.duration}" class="button button-next" ng-click=nextScene()><span class=control-text>Next</span></a></div><div class=pbarBottom><span class=timedisplay>{{appState.time | asTime}} / {{appState.duration | asTime}} <span ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><a class=button-speedcontrol ng-if="appState.timeMultiplier == 1" ng-click=setSpeed(1.25)>&nbsp;</a> <a class=button-speedcontrol ng-if="appState.timeMultiplier == 1.25" ng-click=setSpeed(1.5)>x1.25</a> <a class=button-speedcontrol ng-if="appState.timeMultiplier == 1.5" ng-click=setSpeed(2)>x1.5</a> <a class=button-speedcontrol ng-if="appState.timeMultiplier == 2" ng-click=setSpeed(0.75)>x2</a> <a class=button-speedcontrol ng-if="appState.timeMultiplier == 0.75" ng-click=setSpeed(1)>x0.75</a></span></span> <a ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class=control-text>Captions</span></a>  <span ng-if=!appState.isTouchDevice><a class="button button-mute {{audioIcon()}}" ng-click=toggleMute()><span class=control-text>Mute</span></a><div class=volumebar ng-mousedown=userChangingVolume($event)><div class=volume ng-style="{width: currentVolume()+\'%\'}"></div></div></span></div></div><a class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click=play()><span class=control-text>Play</span></a> <a class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click=pause()><span class=control-text>Pause</span></a></div>'),a.put("templates/video.html","<div class=video><iframe id=ytplayer{{uid}} ng-if=video.urls.youtube ng-src=\"{{video.urls.youtube + '?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&wmode=opaque&rel=0'}}\"></iframe><video ng-if=!video.urls.youtube><source class=mpeg4 ng-if=video.urls.mpeg4 ng-src={{video.urls.mpeg4}} type=video/mp4><source class=webm ng-if=video.urls.webm ng-src={{video.urls.webm}} type=video/webm><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-click=videoClick() class=videoMask ng-class=\"{\n		play: appState.timelineState == 'paused',\n		buffering: appState.timelineState == 'buffering',\n		firstplay: !appState.hasBeenPlayed,\n		noicon: appState.time > video.duration - 1\n	}\"></div></div>")
}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","$filter","config",function(a){var b={};return b.init=function(){b.user={},b.episodeId=!1,b.isFramed=window.parent!=window,b.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),b.windowWidth=0,b.windowHeight=0,b.viewMode=angular.element(window).width()>480?"discover":"review",b.time=0,b.timeMultiplier=1,b.duration=0,b.timelineState="paused",b.hasBeenPlayed=!1,b.volume=100,b.muted=!1,b.hideCaptions=!1,b.show={searchPanel:!1,helpPanel:!1,navPanel:!1},b.videoControlsActive=!1,b.itemDetail=!1,b.autoscroll=!1,b.autoscrollBlocked=!1,b.editing=!1},b.init(),a(function(){b.windowHeight=angular.element(window).height(),b.windowWidth=angular.element(window).width()},50,0,!1),b.isTouchDevice&&(document.getElementById("CONTAINER").className="touchDevice"),b}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","appState",function(a,b,c,d,e,f){var g={};return g.roles=[],g.userHasRole=function(a){for(var b=0;b<g.roles.length;b++)if(g.roles[b]===a)return!0;return!1},g.authenticate=function(){var h=d.defer();if(b.key){var i=b.key;e.search("key",null),g.getAccessToken(i).then(function(){h.resolve()})}else if(c.defaults.headers.common.Authorization)h.resolve();else{var j;if(localStorage&&localStorage.getItem(a.localStorageKey)){var k=localStorage.getItem(a.localStorageKey),l=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];k.customer===l?j=k:localStorage.removeItem(a.localStorageKey)}j?(f.user=j,c.defaults.headers.common.Authorization='Token token="'+j.access_token+'"',h.resolve()):g.getNonce().then(function(a){g.getAccessToken(a).then(function(){h.resolve()})})}return h.promise},g.getNonce=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url?a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url:b.reject()}).error(function(){b.reject()}),b.promise},g.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(b){b.customer=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],f.user=b;try{localStorage.setItem(a.localStorageKey,JSON.stringify(b))}catch(d){}g.roles=b.roles,c.defaults.headers.common.Authorization='Token token="'+b.access_token+'"',e.resolve(b)}).error(function(){e.reject()}),e.promise},g}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc","errorSvc",function(a,b,c,d,e,f,g,h){var i={};i.getEpisodeList=function(){var c=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+"/v1/episodes").success(function(a){c.resolve(a)}).error(function(){})}),c.promise},i.getEpisode=function(a){g.episodes[a]||(g.cache("episode",{_id:a}),c.local?s(a):f.authenticate().then(function(){m().then(function(){p(a)},function(){})},function(){}))};var j={template:{},layout:{},style:{}},k=!1,l=a.defer(),m=function(){if(k===!0)l.resolve();else{if("in progress"===k)return l.promise;k="in progress",a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){n("templates",a[0].data),n("layouts",a[1].data),n("styles",a[2].data),k=!0,l.resolve()},function(){k=!1,l.reject()})}return l.promise},n=function(a,b){angular.forEach(b,function(b){"templates"===a?j.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?j.layout[b._id]={id:b._id,css:b.css_name,displayName:b.display_name}:"styles"===a&&(j.style[b._id]={id:b._id,css:b.css_name,displayName:b.display_name})})},o=function(a){if(a.template_id&&(j.template[a.template_id]?(a.templateUrl=j.template[a.template_id].url,delete a.template_id):h.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){j.layout[a]?b.push(j.layout[a].css):h.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b),delete a.layout_id}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){j.style[a]?c.push(j.style[a].css):h.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c),delete a.style_id}return a},p=function(a){b.get(e.apiDataBaseUrl+"/v1/episodes/"+a).success(function(b){"Published"===b.status||f.userHasRole("admin")?(g.cache("episode",o(b)),q(a),r(b.container_id,a)):h.error({data:"This episode has not yet been published."})}).error(function(){h.error({data:"API call to /v1/episodes/"+a+" failed (bad episode ID?)"})})},q=function(a){b.get(e.apiDataBaseUrl+"/v2/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",o(a))}),g.resolveEpisodeEvents(a)})},r=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&r(a[0].parent_id,c)}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)})},s=function(a){g.cache("episode",{_id:a,created_at:"2014-04-10T02:02:15Z",description:"The Business Case for Sustainability",master_asset_id:"masterasset",title:"Test Episode",status:"Published",templateUrl:"templates/episode/purdue.html",styles:["","",""]}),g.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var b={_id:"-",_type:"Scene",title:"Scene title",description:"Scene Description",keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:a,layouts:["",""],styles:["transitionSlideL"]},c=["templates/scene/1col.html","templates/scene/1col.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/cornerH.html"],d=0;10>d;d++){var e=angular.copy(b);e._id="scene-"+d,e.title=d/2===Math.floor(d/2)?"Scene "+(d+1)+" Title":"",e.title="Scene "+(d+1)+" Title",e.start_time=20*d,e.end_time=20*d+20,e.templateUrl=c[d%c.length],g.cache("event",e)}var f={_id:"",_type:"Annotation",annotation:"Transcript text: <b>html</b> included!",annotation_image_id:"asset3",annotator:"Speaker Name",cosmetic:!1,episode_id:a,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},h=["sidebarR","burstR","burstR","inline","burstR","sidebarR","inline","sidebarR","inline","inline"],i=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(d=0;30>d;d++){var j=angular.copy(f);j._id="transcript-"+d,j.annotation="Transcript block number "+(d+1),j.start_time=5*d,j.end_time=5*d+5,j.layouts=[h[d%h.length]],g.cache("event",j)}for(d=0;10>d;d++){var k=angular.copy(f);k._id="annotation-"+d,k.start_time=6*d,k.end_time=6*d+3,k.templateUrl=i[d%i.length],g.cache("event",k)}g.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),g.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),g.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),g.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var l={_id:"",_type:"Link",link_image_id:"asset1",url:"http://www.inthetelling.com",title:"Link Title",description:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy",cosmetic:!1,stop:!1,type:"Link",episode_id:a,templateUrl:"templates/item/link.html",layouts:["inline"],styles:[""],isContent:!0};for(d=0;30>d;d++){var m=angular.copy(l);m._id="link-"+d,m.required=Math.random()>.5,m.start_time=3*d,m.end_time=3*d+3,m.layouts=[h[d%h.length]],Math.random()>.5?(m.title="NO EMBED link",m.templateUrl="templates/transmedia-link-noembed.html"):Math.random()<.7&&(m.title="FRAMEICIDE link",m.templateUrl="templates/transmedia-link-frameicide.html"),g.cache("event",m)}var n={_type:"Upload",description:"Description of an upload item",required:!1,cosmetic:!1,stop:!1,type:"Upload",episode_id:a,templateUrl:"templates/item/image-thumbnail.html",styles:["transitionFade"],layouts:["inline"]};for(d=0;30>d;d++){var o=angular.copy(n);o._id="upload-"+d,o.asset_id="asset"+(d%3+2),o.title="Upload number "+(d%3+1),o.start_time=4*d,o.end_time=4*d+4,g.cache("event",o)}var p=["windowBg","mainBg","altBg","videoOverlay","mainFg","altFg","windowFg"];for(d=0;7>d;d++){var q=angular.copy(n);q.layouts=[p[d]],q._id="filltest-"+d,q.asset_id="asset2",q.start_time=5*d,q.end_time=5*d+5,q.templateUrl="templates/item/image-fill.html",q.styles.push("fill"),g.cache("event",q)}g.resolveEpisodeEvents(a),g.resolveEpisodeAssets(a)};return i}]),angular.module("com.inthetelling.story").factory("errorSvc",function(){var a={};return a.init=function(){a.errors=[],a.notifications=[]},a.init(),a.error=function(b){b&&b.data&&a.errors.push({exception:b,cause:b.data.error})},a.notify=function(b){a.notifications.push({text:b})},a}),angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","config","appState",function(a,b,c,d){var e={};e.episodes={},e.assets={},e.events={},e.containers={},e.cache=function(a,b){"episode"===a?e.episodes[b._id]?angular.extend(e.episodes[b._id],e.deriveEpisode(angular.copy(b))):e.episodes[b._id]=e.deriveEpisode(angular.copy(b)):"event"===a?e.events[b._id]?angular.extend(e.events[b._id],e.deriveEvent(angular.copy(b))):e.events[b._id]=e.deriveEvent(angular.copy(b)):"asset"===a?e.assets[b._id]?angular.extend(e.assets[b._id],e.deriveAsset(angular.copy(b))):e.assets[b._id]=e.deriveAsset(angular.copy(b)):"container"===a&&(e.containers[b._id]?angular.extend(e.containers[b._id],angular.copy(b)):e.containers[b._id]=angular.copy(b))};var f={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/debug.html","templates/upload-demo.html":"templates/item/debug.html"};e.deriveEpisode=function(a){return f[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl]),e.events["internal:landingscreen:"+a._id].title=a.title,a},e.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=h(a)),a},e.deriveEvent=function(a){return"Scene"!==a._type&&(a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0)),f[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])),a.displayStartTime=b("asTime")(a.start_time),a},e.resolveEpisodeEvents=function(a){var b=[],c=[];angular.forEach(e.events,function(d){d.episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))}),e.episodes[a].scenes=b.sort(function(a,b){return a.start_time-b.start_time}),e.episodes[a].items=c.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(b,function(a){var b=[];angular.forEach(c,function(c){c.start_time>=a.start_time&&c.start_time<a.end_time&&(e.events[c._id].scene_id=a._id,b.push(c))}),e.events[a._id].items=b.sort(function(a,b){return a.start_time-b.start_time})}),e.episodes[a].styleCss=g(e.episodes[a]),angular.forEach(e.events,function(b){b.episode_id===a&&(b.styleCss=g(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},e.episode=function(a){return!e.episodes[a],e.episodes[a]},e.episodeEvents=function(a){var b=[];return angular.forEach(e.events,function(c){c.episode_id===a&&b.push(c)}),b},e.scene=function(a){return!e.events[a],e.events[a]};var g=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=e.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.episode_id){var f=e.episodes[a.episode_id].styles;angular.forEach(f,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}return c.join(" ")};e.resolveEpisodeAssets=function(a){angular.forEach(e.events,function(b){if(b.episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&e.assets[c]&&(e.events[b._id].asset=e.assets[c])}}),e.episodes[a].masterAsset=e.assets[e.episodes[a].master_asset_id]},e.addLandingScreen=function(a){e.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:.001}};var h=function(a){var b={};if(a.alternate_urls){for(var e=/\.(\w+)$/,f=0;f<a.alternate_urls.length;f++)if(a.alternate_urls[f].match(/youtube/))b.youtube=i(a.alternate_urls[f]);else switch(a.alternate_urls[f].match(e)[1]){case"mp4":b.mpeg4=j(b.mpeg4,a.alternate_urls[f]);break;case"m3u8":b.m3u8=j(b.m3u8,a.alternate_urls[f]);break;case"webm":b.webm=j(b.webm,a.alternate_urls[f])}a.you_tube_url&&(b.youtube=i(a.you_tube_url))}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:i(a.you_tube_url)};var g=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);return(d.isTouchDevice||g)&&(b.youtube=void 0),c.disableYoutube&&(b.youtube=void 0),a.urls=b,a},i=function(a){if(!a)return void 0;var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b)[1];return"//www.youtube.com/embed/"+c},j=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,e=a.match(c)||[0,0],f=b.match(c)||[0,0];return d.isTouchDevice||d.isFramed?Math.floor(e[1])>Math.floor(f[1])?b:a:Math.floor(e[1])<Math.floor(f[1])?b:a};return e}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$timeout","$interval","$rootScope","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f){var g={};g.timelineEvents=[],g.markedEvents=[];var h,i,j,k;g.registerVideo=function(b){void 0!==j&&a(function(){g.seek(e.time)}),j=b},g.setSpeed=function(a){k=a,e.timeMultiplier=k,j.setSpeed(a)},g.play=function(a){if(!e.hasBeenPlayed)return e.hasBeenPlayed=!0,void c.$emit("video.firstPlay");if(void 0!==j)e.videoControlsActive=!0,e.show.navPanel=!1,e.timelineState="buffering",j.play().then(function(){e.timelineState="playing",s(),b.cancel(h),h=b(s,20),o(),a||f.captureEpisodeActivity("play")});else var d=c.$watch(function(){return void 0!==j},function(a){a&&(d(),g.play())})},g.pause=function(a){e.videoControlsActive=!0,b.cancel(h),p(),h=void 0,n=void 0,e.timelineState="paused",j.pause(),a||f.captureEpisodeActivity("pause")},g.seek=function(b,c,d){if(!j||0===e.duration)return void a(function(){g.seek(b)},300);p();var h=e.time;b=t(b),0>b&&(b=0),b>e.duration&&(b=e.duration),e.time=b,g.updateEventStates();var i="playing"===e.timelineState;if(g.pause(!0),j.seek(b),i&&g.play(!0),c){var k={method:c,seekStart:h};d&&(k.event_id=d),f.captureEpisodeActivity("seek",k)}},g.toggleMute=function(){e.muted=!e.muted,j.toggleMute()},g.setVolume=function(a){e.volume=a,j.setVolume(a)};var l,m=function(){l={lastTimelineTime:0,lastVideoTime:0}};m();var n,o=function(){l.lastTimelineTime=e.time,l.lastVideoTime=e.time,q()},p=function(){a.cancel(i),m()},q=function(){if(a.cancel(i),"playing"===e.timelineState){for(var b=j.currentTime(),c=e.time,d=0;d<g.timelineEvents.length;d++){var f=g.timelineEvents[d];if(f.t>=l.lastTimelineTime){if(f.t>c)break;if("pause"===f.action&&f.t===l.lastTimelineTime);else if(r(f),"pause"===f.action){d++;break}}}var h=g.timelineEvents[d];if(l.lastVideoTime=b,l.lastTimelineTime=c,h&&"playing"===e.timelineState){var k=1e3*(g.timelineEvents[d].t-c);i=a(q,k+10)}}},r=function(a){"timeline"===a.id?"pause"===a.action?(e.time=a.t,g.pause()):g.play():"enter"===a.action?(d.events[a.id].state="isCurrent",d.events[a.id].isCurrent=!0):(d.events[a.id].state="isPast",d.events[a.id].isCurrent=!1)},s=function(){var a=new Date,b=isNaN(a-n)?0:a-n,c=parseFloat(e.time)+b/1e3*k;0>c&&(c=0,g.pause()),c>e.duration&&(c=e.duration,g.pause()),e.time=c,n=a};g.init=function(a){g.timelineEvents=[],g.markedEvents=[],k=1,e.duration=0,e.timelineState="paused",g.injectEvents(d.episodeEvents(a),0),b.cancel(h),p()},g.injectEvents=function(a,b){0!==a.length&&(angular.forEach(a,function(a){"Scene"===a._type&&a.title&&g.markedEvents.push(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,d.events[a._id].start_time=.01),a.stop?(g.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),g.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),g.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(g.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&g.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"}))}),g.timelineEvents=g.timelineEvents.sort(function(a,b){return a.t===b.t?"enter"===b.action?1:"exit"===b.action?-1:0:a.t-b.t}),g.markedEvents=g.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),e.duration=g.timelineEvents[g.timelineEvents.length-1].t,g.updateEventStates())},g.updateEventStates=function(){var a=e.time;angular.forEach(g.timelineEvents,function(a){if("timeline"!==a.id){var b=d.events[a.id];b.state="isFuture",b.isCurrent=!1}}),angular.forEach(g.timelineEvents,function(b){if(b.t<=a){var c=d.events[b.id];"enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1)}})};var t=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return g}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(f.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b){f.user.track_event_actions&&g.activityQueue.push({name:a,event_id:b,walltime:new Date})},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){if(0!==g.activityQueue.length){var a=angular.copy(g.activityQueue);g.activityQueue=[];var b=new Date,c=[],d=[];angular.forEach(a,function(a){a.age=(b-a.walltime)/1e3,delete a.walltime,a.event_id?d.push(a):c.push(a)}),d.length&&i("event_user_actions",{event_user_actions:d}),c.length&&i("episode_user_metrics",{episode_user_metrics:c})}};var i=function(a,c){b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/"+a,data:c})};return g}]),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"===a._type&&b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","config","errorSvc","appState",function(a,b,c,d){a.errorSvc=c,a.user=d.user,a.dismiss=function(a){for(var b=0;b<c.errors.length;b++)c.errors[b]===a&&(c.errors.splice(b,1),b=c.errors.length);for(b=0;b<c.notifications.length;b++)c.notifications[b]===a&&(c.notifications.splice(b,1),b=c.notifications.length)},a.resetAuth=function(){localStorage.removeItem(b.localStorageKey)},a.reload=function(){window.location.reload(!0)}}]),angular.module("com.inthetelling.story").controller("EpisodeListController",["$scope","config","dataSvc","appState",function(a,b,c,d){c.getEpisodeList().then(function(b){a.episodes=b}),a.authenticate=function(a){localStorage&&localStorage.removeItem(b.localStorageKey),d.user={},window.location=b.apiDataBaseUrl+"/pages/launch_oauth2?episode="+a}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.setSpeed=function(a){b.setSpeed(a)},a.markerPercent=function(a){return a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.toggleFullscreen=function(){e()?f():g()};var e=function(){return document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen};a.$watch(function(){return e()},function(a){d.isInFullscreenMode=a});var f=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},g=function(){var a=document.getElementById("CONTAINER");a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc",function(a,b,c,d,e,f,g,h,i,j,k,l){a.viewMode=function(a){g.viewMode=a,k.captureEpisodeActivity("modeChange",{mode:a}),"review"===a?(g.autoscroll=!0,g.autoscrollBlocked=!1,e(x)):g.autoscroll=!1},d.viewMode&&e(function(){a.viewMode(d.viewMode)}),d.t&&j.seek(d.t,"URLParameter"),g.init(),l.init(),g.episodeId=d.epId,i.addLandingScreen(g.episodeId),h.getEpisode(g.episodeId);var m=a.$watch(function(){return i.episodes[g.episodeId].title},function(a,b){a!==b&&(document.title="STORY: "+a,m())});a.loading=!0;var n=a.$watch(function(){return i.episodes[g.episodeId].items},function(b){b&&(j.init(g.episodeId),a.loading=!1,n())});a.episode=i.episode(g.episodeId),a.appState=g,a.show=g.show,a.now=new Date,g.videoControlsActive=!1;var o,p;a.$watch(function(){return g.videoControlsActive},function(a){a&&(p=e(function(){o||(g.videoControlsActive=!1)},5e3))}),a.showControls=function(){e.cancel(p),g.videoControlsActive=!0,g.isTouchDevice&&a.allowControlsExit()},a.keepControls=function(){o=!0},a.allowControlsExit=function(){o=!1,e.cancel(p),p=e(function(){g.show.navPanel||(g.videoControlsActive=!1)},5e3)},a.toggleSearchPanel=function(){g.show.searchPanel=!g.show.searchPanel},a.toggleNavPanel=function(){j.pause(),g.show.navPanel=!g.show.navPanel},a.seek=function(a){j.seek(a,"sceneMenu"),g.show.navPanel=!1};var q=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(r){q=!1}q&&localStorage.removeItem("iCanHazStorage"),c.$on("video.firstPlay",function(){q&&!localStorage.getItem("noMoreHelp")?g.show.helpPanel=!0:j.play()}),a.hidePanels=function(){g.show.helpPanel=!1,g.show.navPanel=!1,g.show.searchPanel=!1},a.noMoreHelp=function(){g.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),j.play()};var s,t=$(window),u=$("html,body"),v=function(){s=f(x,400),t.bind("scroll",function(){u.stop(),w(),g.autoscrollBlocked=!0})},w=function(){t.unbind("scroll"),f.cancel(s)};a.enableAutoscroll=function(){g.autoscrollBlocked&&(g.autoscrollBlocked=!1,v())};var x=function(){if(!g.autoscrollBlocked&&g.autoscroll){var a=1/0,b=t.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),1/0!==a){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(w(),u.animate({scrollTop:a-c},1500),e(function(){v()},1750))}}};v(),c.$on("userKeypress.ESC",function(){g.show.searchPanel=!1,g.show.helpPanel=!1,g.show.navPanel=!1,g.itemDetail=!1})}]),angular.module("com.inthetelling.story").controller("EpisodeController",["$scope","$routeParams","modelSvc","appState",function(a,b,c,d){a.episode=c.episode(d.episodeId),a.appState=d}]),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){$.inArray("showCurrent",a.scene.layouts)>-1&&(a.showCurrent=!0),a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);
for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$timeout","$window","$document","appState","timelineSvc",function(a,b,c,d,e,f,g){var h=document.createElement("script");h.src="//www.youtube.com/iframe_api",angular.element(e[0].head).append(h),d.onYouTubeIframeAPIReady=function(){b.youtubeIsReady=!0},b.$on("$destroy",function(){b.YTPlayer=void 0}),b.initVideo=function(a){if(b.video.urls.youtube)if(b.videoType="youtube",f.videoType=b.videoType,b.videoNode=a.find("iframe")[0],b.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return b.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",f.videoType=b.videoType,b.videoNode=a.find("video")[0],b.initHTML5Video()},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data]}}});var c=b.$watch(function(){return void 0!==b.YTPlayer.playVideo},function(a){a&&(c(),g.registerVideo(b))})},b.initHTML5Video=function(){b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("waiting",function(){b.playerState="waiting"},!1),b.videoNode.addEventListener("stalled",function(){b.playerState="stalled"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),g.registerVideo(b)},b.play=function(){var c=a.defer();"youtube"===b.videoType?b.YTPlayer.playVideo():b.videoNode.play();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise},b.pause=function(){"youtube"===b.videoType?(b.YTPlayer.seekTo(f.time,!0),b.YTPlayer.pauseVideo()):b.videoNode.pause();try{b.videoNode.currentTime=f.time}catch(a){}},b.seek=function(a){try{"youtube"===b.videoType?(b.YTPlayer.seekTo(a,!0),b.YTPlayer.pauseVideo()):b.videoNode.currentTime=a}catch(d){c(function(){b.seek(a)},100)}},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.seek=function(c,d){a.enableAutoscroll(),b.seek(c,"clickedOnEventInSearch",d)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){a.searchableText=(a.annotation||a.description)+" "+(a.title||a.annotator)})}}]),angular.module("com.inthetelling.story").directive("ittTimeline",["appState","timelineSvc",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(c,d){c.appState=a,c.timeline=b,c.handlePosition=0,c.zoomLevel=1,c.zoomOffset=0;var e=d.find(".progressbarContainer"),f=d.find(".progressbar");c.showSceneMenuTooltip=function(b){c.sceneMenuToolTip=b&&!a.isTouchDevice?!0:!1},c.prevScene=function(){for(var c=b.markedEvents.length-1;c>=0;c--){var d=a.time;if("playing"===a.timelineState&&(d-=3),b.markedEvents[c].start_time<d){b.seek(b.markedEvents[c].start_time,"prevScene");break}}},c.nextScene=function(){for(var c=!1,d=0;d<b.markedEvents.length;d++)if(b.markedEvents[d].start_time>a.time){b.seek(b.markedEvents[d].start_time,"nextScene"),c=!0;break}c||b.seek(a.duration,"nextScene")},c.userChangingVolume=function(b){a.muted&&c.toggleMute();var d=angular.element(b.currentTarget),e=function(a,b){var e=(a.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),b?c.setVolume(e):c.$apply(c.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})},c.currentVolume=function(){return a.muted?0:a.volume},c.audioIcon=function(){return a.muted?"muted":"vol"+Math.floor(a.volume/34)},c.showTooltip=function(a){a.showTooltip=!0},c.hideTooltip=function(a){a.showTooltip=!1},c.zoomIn=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel+1,g()},c.zoomOut=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel-1,c.zoomLevel<1&&(c.zoomLevel=1),g()};var g=function(){c.zoomOffset=-((c.zoomLevel-1)*(a.time/a.duration)),e.animate({left:100*c.zoomOffset+"%",width:100*c.zoomLevel+"%"},1e3,function(){c.stopWatching=!1})};c.$watch(function(){return{t:a.time,d:a.duration}},function(){c.stopWatching||(c.zoomOffset=-((c.zoomLevel-1)*(a.time/a.duration)),e.css({left:100*c.zoomOffset+"%"}))},!0);var h=function(b){c.isSeeking=!0;var d=a.isTouchDevice?"touchend.timeline":"mouseup.timeline";f.bind(d,function(){j()}),angular.element(document).bind(d,function(){k()}),i(b)},i=function(b){c.isSeeking&&(c.willSeekTo=(b.clientX-e.offset().left)/e.width()*a.duration,c.willSeekTo<0&&(c.willSeekTo=0),c.willSeekTo>a.duration&&(c.willSeekTo=a.duration))},j=function(){c.stopWatching=!0,b.seek(c.willSeekTo,"scrubTimeline"),g()},k=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),f.off("mouseup.timeline"),f.off("touchend.timeline"),c.$apply(function(){c.isSeeking=!1})},l=function(){var b=$(d.find(".playhead"));a.isTouchDevice?(b.on("touchstart.timeline",function(a){h(a.originalEvent.targetTouches[0]),a.preventDefault()}),b.on("touchmove.timeline",function(a){i(a.originalEvent.targetTouches[0]),a.preventDefault()})):(b.on("mousedown.timeline",function(a){h(a),a.preventDefault()}),b.on("mousemove.timeline",function(a){i(a),a.preventDefault()}))};l(),c.$on("$destroy",function(){k()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["analyticsSvc",function(a){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(){a.captureEpisodeActivity("episodeLoad")}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl">Loading Item...</span>',controller:"SceneController",link:function(a,d){a.precalculateSceneValues();var e=function(){var b=d.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return d.find(".videoMagnet img").height()},function(a){a>0&&(c(),e())});else{d.find(".matchVideoHeight:visible").each(function(){$(this).css("height",d.find(".videoMagnet img").height())});var f=angular.element(window).height()-$("#CONTAINER").scrollTop();d.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",f-$(this).offset().top)})}d.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&e()},!0),a.safetyBelt=b(e,1300),a.$on("$destroy",function(){a.unwatch(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=400>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","config","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(h,i){if(h.item.asset_id&&!h.item.asset&&(h.item.asset=g.assets[h.item.asset_id]),h.item.styleCss.match(/fill|contain|cover/)&&(h.item.backgroundImage="background-image: url('"+h.item.asset.url+"');"),h.item.data&&(h.plugin=h.item.data._plugin,h.plugin._type=h.item.data._pluginType,"multiplechoice"===h.plugin._type&&(h.setChoice=function(a){h.plugin.hasBeenAnswered||(h.plugin.selectedDistractor=a)},h.scoreQuiz=function(){h.plugin.distractors[h.plugin.selectedDistractor].selected=!0,h.plugin.hasBeenAnswered=!0,e.captureEventActivity("question-answered",h.item._id)},h.resetQuestion=function(){h.plugin.selectedDistractor=void 0,h.plugin.hasBeenAnswered=!1;for(var a=0;a<h.plugin.distractors.length;a++)h.plugin.distractors[a].selected=!1}),"credlyBadge"===h.plugin._type)){var j=d.user;j.roles.length&&"guest"!==j.roles[0]&&(h.plugin.eligibleForBadges=!0,h.plugin.userEmail=j.emails[0],h.plugin.totalAchieved=0,angular.forEach(h.plugin.requirements,function(a){e.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,b&&h.plugin.totalAchieved++})})),h.badger=function(){h.plugin.gettingBadge=!0,a({method:"GET",url:c.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+h.plugin.credlyBadgeId+"&email="+h.plugin.userEmail}).success(function(a){"Badge previously sent."===a.status&&(h.plugin.alreadyHadBadge=!0),h.plugin.gotBadge=!0}).error(function(){})}}h.toggleDetailView=function(){h.item.showInlineDetail?h.item.showInlineDetail=!1:(f.pause(),h.captureInteraction(),i.closest(".content").width()>400?h.item.showInlineDetail=!0:d.itemDetail=h.item)},h.forceModal=function(){f.pause(),d.itemDetail=h.item},h.outgoingLink=function(a){f.pause(),h.captureInteraction(),h.item.targetTop?b(function(){window.location.href=a}):window.open(a)},h.captureInteraction=function(){e.captureEventActivity("clicked",h.item._id)}}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",["appState","timelineSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.story").directive("ittItemEditor",["modelSvc","appState",function(a,b){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/item/edit.html",controller:"ItemController",link:function(c){c.item.layouts||(c.item.layouts=[]),c.$watch(function(){return c.item.end_time},function(a){c.item.noEndTime=""===a}),c.save=function(){c.item=a.deriveEvent(c.item);for(var d in c.item)c.item.hasOwnProperty(d)&&(a.events[c.item._id][d]=angular.copy(c.item[d]));a.resolveEpisodeEvents(c.item.episode_id),b.editing=!1},c.updateStyles=function(){c.item.styles=[],angular.forEach([c.item.customTransition,c.item.customTypography,c.item.customColor,c.item.customTimestamp],function(a){a&&c.item.styles.push(a)}),c.item.styleCss=c.item.styles.join(" ")},c.cancelEdit=function(){b.editing=!1}}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$rootScope","appState","timelineSvc",function(a,b,c,d){var e=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(f,g){f.appState=c,f.uid=++e,a(function(){if(f.video)f.initVideo(g);else var a=f.$watch(function(){return f.video},function(b){b&&(a(),f.initVideo(g))})}),f.videoClick=function(){"paused"===c.timelineState?d.play():d.pause()},b.$on("userKeypress.SPACE",f.videoClick)}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.abs(c)>4?e.width()+c/4:d.magnet.width()),e.height(d.magnet.width()/f)})};a.$on("magnet.changeMagnet",function(a,b){g(b)}),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.unwatchVisibility=b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),"watchModeVideoMagnet"===c.attr("id")&&(b.unwatchSize=b.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:c.is(":visible")}},function(){var b=angular.element(window),d=b.height()-45;c.width(b.width()/d>16/9?16/9*d:b.width()),a.$emit("magnet.changeMagnet",c)},!0)),b.$on("$destroy",function(){b.unwatchVisibility(),b.unwatchSize&&b.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.indexEvents()}}});