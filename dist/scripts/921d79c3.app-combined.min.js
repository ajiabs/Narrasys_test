"use strict";angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{title:"Telling STORY",templateUrl:"templates/root.html"}).when("/auth",{templateUrl:"templates/auth.html",reloadOnSearch:!1}).when("/episodes",{title:"Available episodes",templateUrl:"templates/producer/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player"}]}}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player"}]}}).when("/sxs/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs"}]}}).when("/editor/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs"}]}}).when("/producer/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",controller:"ContainerAssetsTestController",template:'<div style="margin:1em" class="admin"><a class="goUp" href="#episodes">Episodes</a><div sxs-container-assets="containerId"></div></div>'}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope","errorSvc",function(a,b){a.$on("$routeChangeSuccess",function(a,c){b.init(),document.title=c.title?c.title:"Telling STORY"});var c=!1;$(document).on("keydown",function(b){c||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||(c=!0,27===b.keyCode&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))}),$(document).on("keyup",function(){c=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","errorSvc",function(a,b){return{responseError:function(c){return b.error(c),a.reject(c)}}}])}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/auth.html",'<div itt-login=""><a style="margin:1em; font-size: 80%" href="/">Home</a><div ng-controller=ErrorController ng-include="\'templates/error.html\'"></div></div>'),a.put("templates/container.html",'<div class="container {{containerTypes[depth]}}" ng-class="{isOpen: container.showChildren, isClosed: !container.showChildren}" ng-if=container._id><div class=hoverIndicator><button class=danger ng-if="appState.dangerousButtons && !container.children && !container.haveNotLoadedChildData" ng-click=deleteEpisodeAndContainer(container._id)>Delete</button> <a ng-click=toggleChildren()>{{container.name.en}}</a> <small><a ng-href=#/assets/{{container._id}}>[Assets]</a></small></div><div ng-if=container.showChildren ng-repeat="child in container.children"><span ng-if="depth == 2" class="container hoverIndicator"><a href=#/episode/{{child.episodes[0]}}>[Player]</a> <a ng-if=isDemoServer href=#/editor/{{child.episodes[0]}}>[Editor]</a> <a href=#/producer/{{child.episodes[0]}}>[Producer]</a> <button class=danger ng-if=appState.dangerousButtons ng-click=deleteEpisodeAndContainer(child._id)>Delete</button> {{child.name.en}} <small><a ng-href=#/assets/{{child._id}}>[Assets]</a></small></span> <span ng-if="depth < 2" itt-container=containers[child._id] depth=depth+1></span></div><div ng-if="container.showChildren && !container.addingEpisode" class=controls><button ng-if="depth==2" ng-click="container.addingEpisode = true;">Add episode to {{container.name.en}}</button> <button ng-if="depth !== 2" ng-disabled=true>TODO add {{containerTypes[depth+1]}} to {{container.name.en}}</button></div><div class=controls ng-if=container.addingEpisode><label>Name:<input ng-model=container.newEpisodeTitle ng-focus=""></label><button ng-click="container.addingEpisode = false">Cancel</button> <button ng-disabled=!container.newEpisodeTitle ng-click=addEpisode(container)>Add</button></div></div>'),a.put("templates/containerepisodes.html",'<li ng-if=!container.episodes.length ng-bind-html=container.display_name></li><li ng-if=container.episodes.length><span ng-if="container.episodes[0] == episodeId"><b ng-bind-html=containers[container._id].display_name></b></span> <span ng-if="container.episodes[0] != episodeId"><a ng-href=/#/{{crossEpisodePath}}/{{container.episodes[0]}} ng-bind-html=containers[container._id].display_name></a></span></li><ul class=crossEpisodeNav><li ng-repeat="child in container.children" itt-container-episodes=containers[child._id]></li></ul>'),a.put("templates/copyright.html","TELLING STORY player &#169; <span ng-bind-html=\"now | date:'yyyy'\"></span> <a href=https://inthetelling.com>IN THE TELLING</a>. All rights reserved. <a href=/privacy.html target=_new>Privacy Policy</a>"),a.put("templates/episode/columbia.html",'<div class="episode episode-columbia" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/columbia.svg alt="Columbia University"></div></div>'),a.put("templates/episode/columbiabusiness.html",'<div class="episode episode-columbiabusiness" ng-class=episode.styleCss><div class="fill trident"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/cbs-logo.svg alt="Columbia Business School"></div></div>'),a.put("templates/episode/components/discovermode.html",'<div class=discoverMode ng-if="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene=scene episode=episode></div></div>'),a.put("templates/episode/components/reviewmode-scenes.html",'<div class="scene animate transitionFade" ng-class="{navigable: scene.display_title}" ng-repeat="scene in scenes" ng-if=!scene._internal><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class=sceneTitle ng-if=scene.display_title ng-bind-html=scene.display_title></h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items| reviewMode | orderBy:\'start_time\'" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item=item forcetemplate=review-all></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | reviewMode | annotation | orderBy:\'start_time\'" ng-class=item.state itt-item=item forcetemplate=review-annotation></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src=images/aspectratiopreserver-16x9.gif class=videoPadding> <div class="item animate" ng-repeat="item in scene.items | reviewMode | transmedia" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item=item forcetemplate=review-transmedia></div></div></div></div><div ng-if=isLoading ng-include="\'templates/loading.html\'"></div>'),a.put("templates/episode/components/reviewmode.html",'<div class=reviewMode ng-show="appState.viewMode == \'review\'"><div itt-magnet="" id=reviewModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div ng-if="appState.viewMode == \'review\'" itt-review-mode=episode.scenes></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><div class="video contentLayer" itt-video=episode.masterAsset></div><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<div ng-if="appState.viewMode == \'watch\'" style="padding-bottom: 100%"><div class=watchMode><div itt-magnet="" id=watchModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><span class=watchModeCaptions ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class=item.state itt-item=item forcetemplate=caption></div></span></div>'),a.put("templates/episode/components/windowfg.html",'<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"><div class=content><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div><a ng-if="!appState.editEvent && appState.timelineState == \'paused\'" class=button-continue ng-click=play()><span>Continue</span></a></div></div>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href=http://www.mindwires.com><img src=images/customer/eliterate-mindwires.svg alt="Mindwires logo"></a> <a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/eliterate-logo.svg alt=E-Literate></div></div>'),a.put("templates/episode/episode.html",'<div class=episode ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/ewb-logo.svg alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/gw-logo.svg alt="George Washington"></div></div>'),a.put("templates/episode/gwlaw.html",'<div class="episode episode-gw" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/gw-law.jpg alt="GW Law"></div></div>'),a.put("templates/episode/middlebury.html",'<div class="episode episode-middlebury" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span class="colorInvert DiscoverModeOnly" ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt-incolor.svg alt="In The Telling logo"></a> <a class=logo href=http://middlebury.edu><img src=images/customer/middlebury-shield.svg alt="Middlebury logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/middlebury-logo.svg alt=Middlebury></div></div>'),a.put("templates/episode/prolotherapy.html",'<div class="episode episode-prolotherapy" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/prolotherapy-text.svg alt="American Association of Musculoskeletal Medicine"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/purdue-logo.svg alt=Purdue></div></div>'),a.put("templates/episode/schoolclimatesolutions.html",'<div class="episode episode-schoolclimatesolutions" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/schoolclimatesolutions.svg alt="SCS: School Climate Solutions"></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/tellingstory-logo.svg alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/usc-logo.svg alt=USC></div></div>'),a.put("templates/error-404.html","<div class=errors><div class=error><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>"),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class=errors><div class=error ng-repeat="error in errorSvc.errors" ng-click=dismiss(error)><h3>Error: {{error.cause || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if=error.exception.config.url><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if=user.login_url><a ng-if=user.login_via_top_window_only ng-click=logout(); ng-href={{user.login_url}} target=_top>click here</a> <a ng-if=!user.login_via_top_window_only ng-click=logout(); ng-href={{user.login_url}}>click here</a> to log back in.</span> <span ng-if=!user.login_url><a ng-click=logout();>reset your session</a> and start over.</span></p></div><div class=notification ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click=dismiss(notification)>[x]</a><p>{{notification.text}}</p></div></span>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/debug.html","<div class=itemTemplate><pre ng-if=itemDebug>{{item | pretty}}</pre></div>"),a.put("templates/item/file-withimage.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-if="item.noEmbed && !item.targetTop" class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title ||\'(Untitled)\'"></a> <a ng-if="item.noEmbed && item.targetTop" target=_top ng-click=outgoingLink(item.url) ng-bind-html="item.title ||\'(Untitled)\'"></a> <a ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.title ||\'(Untitled)\'"></a></div><img ng-if=item.asset.url ng-click=toggleDetailView() ng-src={{item.asset.url}} style="cursor:pointer;cursor:hand; margin: 0.25em 0"><div ng-bind-html=item.description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a ng-if=!item.noExternalLink ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/file.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><div class="startTime displayTime" x-ng-click=seek(item.start_time)>{{item.displayStartTime}}</div><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a ng-if="item.noEmbed && !item.targetTop" class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title ||\'(Untitled)\'"></a> <a ng-if="item.noEmbed && item.targetTop" target=_top ng-click=outgoingLink(item.url) ng-bind-html="item.title ||\'(Untitled)\'"></a> <a ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.title ||\'(Untitled)\'"></a></div><div ng-bind-html=item.description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a ng-if=!item.noExternalLink ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/image-caption-sliding.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div><div class="caption slidingcaption"><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-caption.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div><div class=caption><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-fill.html",' <a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate imageFill" style={{item.backgroundImageStyle}} ng-style="{\'backgroundImage\':item.asset.cssUrl}"><img class=fillImg ng-src={{item.asset.url}}></div>'),a.put("templates/item/image-inline-withtext.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title ng-if=item.display_title ng-bind-html=item.display_title></div><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div ng-bind-html=item.display_description></div><div class=clear></div></div></div>'),a.put("templates/item/image-inline.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div class=clear></div></div>'),a.put("templates/item/image-linkonly.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div class=text ng-bind-html=item.display_description></div></div><div class=clear></div></div>'),a.put("templates/item/image-plain.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate imagePlain"><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div>'),a.put("templates/item/image-thumbnail.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click=toggleDetailView()><img ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div class=text><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div><div class=clear></div></div>'),a.put("templates/item/image.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a class=fakeLink role=button tabindex=0 ng-click=toggleDetailView() x-ng-keypress=toggleDetailOnKeyPress($event) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail x-ng-if=item.showInlineDetail><div class=touchable style=position:relative><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div><div class=clear></div></div>'),a.put("templates/item/link-descriptionfirst.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div ng-bind-html=item.display_description></div><div class=title><a tabindex=0 ng-if="item.noEmbed && !item.targetTop" class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if="item.noEmbed && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/link-embed.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title ng-bind-html=item.display_title></div><div ng-bind-html=item.display_description></div></div><a tabindex=0 class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div><div class=clear></div></div>'),a.put("templates/item/link-withimage.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><span ng-if=item.noEmbed><span ng-if=!item.targetTop><div class=title><a tabindex=0 class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)><img ng-src={{item.asset.url}}></a></span> <span ng-if=item.targetTop><div class=title><a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)><img ng-src={{item.asset.url}}></a></span></span> <span ng-if=!item.noEmbed><div class=title><a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class=fakeLink tabindex=0 ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><img ng-click=toggleDetailView() ng-src={{item.asset.url}}></span></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div>'),a.put("templates/item/link.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 ng-if="item.noEmbed && !item.targetTop" class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if="item.noEmbed && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a role=button tabindex=0 ng-if=!item.noEmbed x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/modal.html","<div class=modal ng-click=dismiss();><div ng-if=\"item._type == 'Link'\" class=modalmenu><a href={{item.url}} target=_blank class=escapelink>(new window)</a></div><div ng-if=\"item._type == 'Link'\" class=iframeContainer><div ng-include=\"'templates/loading.html'\"></div><iframe ng-src={{item.url}}></iframe></div><div class=modalimage ng-if=\"item._type == 'Upload'\"><img ng-src={{item.asset.url}}></div></div>"),a.put("templates/item/pullquote-noattrib.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.display_annotation></div></div>'),a.put("templates/item/pullquote.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.display_annotation></div><div class=pullquoteSpeaker ng-bind-html=item.display_annotator></div></div>'),a.put("templates/item/question-mc-image-left.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate multipleChoiceQuestion" ng-class="{\'itemQuestionWrapper\': item.asset.url}"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div ng-if=item.asset.url class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div ng-class="{\'itemQuestionRight\': item.asset.url}"><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question></div></div>'),a.put("templates/item/question-mc-image-right.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate multipleChoiceQuestion" ng-class="{\'itemQuestionWrapper\': item.asset.url}"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div ng-class="{\'itemQuestionLeft\': item.asset.url}"><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question></div><div ng-if=item.asset.url class=touchable ng-class="{\'itemQuestionImageRight\': item.asset.url}"><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div>'),a.put("templates/item/question-mc-inner.html",'<div class=question><p ng-bind-html=plugin.questiontext></p><div ng-if=!showChart><div ng-repeat="distractor in choices"><div ng-if="distractor.text != \'\'"><label ng-class="{\n					correct: plugin.hasBeenAnswered && distractor.correct,\n					incorrect: plugin.hasBeenAnswered && !distractor.correct\n				}"><input ng-change=scoreQuiz($index) type=radio name=fnord ng-model=index ng-disabled=plugin.hasBeenAnswered value={{$index}}><span ng-bind-html=distractor.text></span></label></div></div><div ng-if=plugin.hasBeenAnswered><div ng-if=plugin.distractors[plugin.selectedDistractor].correct ng-bind-html=plugin.correctfeedback></div><div ng-if=!plugin.distractors[plugin.selectedDistractor].correct ng-bind-html=plugin.incorrectfeedback></div></div></div><div ng-if=showChart><div ng-if=!plugin.hasBeenAnswered ng-repeat="distractor in plugin.distractors"><div ng-if="distractor.text != \'\'"><label><input ng-change=scorePoll($index) type=radio name=fnord ng-disabled=plugin.hasBeenAnswered ng-model=$parent.plugin.selectedDistractor value={{$index}}><span ng-bind-html=distractor.text></span></label></div></div><br><div ng-if=plugin.hasBeenAnswered><p>Here\'s how others answered this question: (your choice was <b ng-bind-html=plugin.distractors[plugin.selectedDistractor].text></b>)</p><itt-flotr2-chart type={{chartType}} data={{chartData}} options={{chartOptions}}></itt-flotr2-chart></div></div></div>'),a.put("templates/item/question-mc.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate multipleChoiceQuestion"><div ng-if=item.asset.url class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question></div>'),a.put("templates/item/review-all.html","<span><div ng-if=\"item._type == 'Annotation'\" ng-include=\"'templates/item/review-annotation.html'\"></div><div ng-if=\"item._type != 'Annotation'\" ng-include=\"'templates/item/review-transmedia.html'\"></div></span>"),a.put("templates/item/review-annotation.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div ng-class="{isCosmetic: item.cosmetic}"><div ng-if=item.isTranscript class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div></div><div ng-if=!item.isTranscript ng-include=item.templateUrl></div><div class=clear></div></div>'),a.put("templates/item/review-transmedia.html",'<span><div ng-if=item.sxs ng-include=item.templateUrl ng-class="{isCosmetic: item.cosmetic}"></div><span ng-if=!item.sxs ng-class="{isCosmetic: item.cosmetic}"><a class=edit-event ng-click=editItem()><span>Edit item</span></a><div ng-if="item.data._pluginType == \'credlyBadge\'" ng-include="\'templates/item/usc-badges.html\'"></div><div ng-if="item.data._pluginType != \'credlyBadge\'" class=itemTemplate><div class=itemHead><a role=button tabindex=0 class="startTime displayTime" aria-label="Seek video to {{item.displayStartTime}}" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 ng-if=item.noEmbed class="fakeLink escapelink" ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 role=button class=fakeLink ng-if=!item.noEmbed x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'" aria-label="Toggle detail display of {{item.display_title}}"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type == \'Link\'"><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type != \'Link\'"><div class=touchable style=position:relative><img ng-click=forceModal() ng-src={{item.asset.url}}><div class=touchableIndicator></div></div></div><div class=clear></div></div><div class=clear></div></span></span>'),a.put("templates/item/searchresults.html",'<div ng-class="{isSxS: item.sxs}"><span class=displayTime><button class=fakeLink tabindex=2 ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</button></span> <span class=type ng-bind-html="(item.display_title || item.display_annotator) | highlightSubstring: searchText"></span><div class=description ng-bind-html="(item.display_description || item.display_annotation) | highlightSubstring: searchText"></div></div>'),a.put("templates/item/sxs-comment.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.annotation.en></div><div class=clear></div></div>'),a.put("templates/item/sxs-file.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.display_annotator></div></div><a ng-click=outgoingLink(item.asset.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class=text ng-bind-html=item.description.en></div><div class=clear></div></div>'),a.put("templates/item/sxs-image.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.annotator.en></div></div><div><b ng-bind-html=item.title.en></b><p style=text-align:center><img ng-if=item.asset.url ng-src={{item.asset.url}}></p></div><div class=text ng-bind-html=item.description.en></div><div class=clear></div></div>'),a.put("templates/item/sxs-link.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.display_annotator></div></div><a ng-if=item.noEmbed class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <a ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class=text ng-bind-html=item.description.en></div><div class=itemDetail ng-if=item.showInlineDetail><a ng-if=!item.noExternalLink ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/sxs-question.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.display_annotator></div></div><itt-mc-question choices=item.data._plugin.distractors data=item.data._plugin qid=item._id></itt-mc-question></div>'),a.put("templates/item/sxs-video.html",'<div class="itemTemplate sxs-item"><a class=edit-event ng-click=editItem() ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class=sxs-profile src=/images/customer/tmp-userprofile.png><div class=itemHead><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text><div class=title ng-bind-html=item.display_title></div><div ng-bind-html=item.display_description></div></div><div class=iframeContainer ng-if=item.url><iframe ng-src={{item.url}}></iframe></div><div class=clear></div></div>'),a.put("templates/item/text-h1.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate headerItem"><h1 ng-bind-html=item.display_annotation></h1></div>'),a.put("templates/item/text-h2.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate headerItem"><h2 ng-bind-html=item.display_annotation></h2></div>'),a.put("templates/item/text-transmedia.html",'<div><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><h2 ng-if=item.display_title ng-bind-html=item.display_title></h2></div><div class=text ng-bind-html=item.display_annotation></div></div><div class=clear></div></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class=icon style="float:right; margin-right: 0.5em"><img ng-src={{item.asset.url}}></div><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class=authorName ng-bind-html=item.display_annotator></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class=icon style="float:left; margin-right: 0.5em"><img ng-src={{item.asset.url}}><div class=clear></div></div><div class=authorName ng-bind-html=item.display_annotator></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript.html",'<a class=edit-event ng-click=editItem()><span>Edit item</span></a><div class="itemTemplate transcript"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><img style="max-width: 5em; float:left; margin-right: 0.5em" ng-src={{plugin.credlyImageUrl}}> <b>{{plugin.achievement}}</b> <span ng-if=plugin.eligibleForBadges><p>Complete the following requirements to earn a <a ng-href=https://credly.com/recipients/{{plugin.credlyBadgeId}} target=_new>USC Scholar\'s Badge</a>:</p><div style="clear:both; margin: 1em 1.2em; font-size:90%"><div ng-repeat="req in plugin.requirements"><img ng-if=req.achieved style="width: 1em; height: 1em; margin-left: -1.2em" src=/images/checkmark.png> <img ng-if=!req.achieved style="width: 1em; height: 1em; margin-left: -1.2em" src=/images/checkmark-empty.png> <span>{{req.name}}</span></div></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement.</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"><p>Congratulations! You are eligible for a USC Scholars Badge. Enter your email address to claim it:</p><input ng-model=plugin.userEmail><input type=button value=Go ng-click=badger()><span ng-if=plugin.gettingBadge><small>Getting your badge...</small></span><div ng-if=plugin.error><small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small></div></div><div ng-if=plugin.gotBadge>Your badge is in the mail. <span ng-if=plugin.alreadyHadBadge>(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div></span> <span ng-if=!plugin.eligibleForBadges><p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p></span><br><br></div>'),a.put("templates/loading.html",'<div class=loading><div class=spinner><div class="rotating pie"></div><div class="filler pie"></div><div class=mask></div></div>Loading</div>'),a.put("templates/player.html","<div class=player ng-class=\"{\n	isFramed: appState.isFramed,\n	guestUser: appState.user.isGuestUser,\n	isProducer: (appState.product == 'producer'),\n	isSxS: (appState.product == 'sxs'),\n	canEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == 'producer' || appState.product == 'sxs')\n"+'	}"><div class=toolbar><div class="modegroup buttongroup"><nav role=navigation><button tabindex=0 class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')" aria-label=Watch><span>Watch</span></button> <span ng-switch="appState.product != \'producer\' || appState.viewMode != \'discover\' || appState.time == 0"><button ng-switch-when=true tabindex=0 class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')" aria-label=Discover><span>Discover</span></button> <span ng-switch-when=false class=producerEditLayers ng-class="{\n				bg: appState.producerEditLayer < 0,\n				fg: appState.producerEditLayer > 0\n			}"><a ng-click=changeProducerEditLayer(-1) class=button>&nbsp;&nbsp; <span>Discover</span></a> <a ng-click=changeProducerEditLayer(+1) class=button>&nbsp;&nbsp; <span>Discover</span></a></span> <button tabindex=0 class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')" aria-label=Review><span>Review</span></button></span></nav></div><div ng-if="1 || appState.isFramed" class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-click=pause() ng-href="{{apiDataBaseUrl}}/v1/new_window/{{appState.episodeId}}?access_token={{appState.user.access_token}}&t={{appState.time}}" target=_new><span>New window</span></a></div><div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><button tabindex=2 class="button button-search" ng-click=toggleSearchPanel() aria-label=Search aria-expanded={{show.searchPanel}}><span>Search</span></button><label for=searchtext class=hidden>Search Text</label><input tabindex=2 name=searchtext id=searchtext ng-show=show.searchPanel ng-model=searchText></div><div class="profilegroup buttongroup" ng-if="appState.product == \'sxs\'"><a class="button button-profile" ng-click="appState.show.profilePanel = true"><span>Profile</span></a></div></div><div ng-if=loading ng-include="\'templates/loading.html\'"></div><div itt-episode="" ng-class="{\n		padForEditing: appState.editEvent || appState.editEpisode,\n		showBackgroundOnly: appState.producerEditLayer < 0,\n		showForegroundOnly: appState.producerEditLayer > 0,\n	}"></div><div class=toolbar-bottom itt-show-hide-visual-only=appState.videoControlsActive ng-mouseenter=showControls(); ng-click=showControls(); ng-mouseleave=allowControlsExit()><div class=toolbar-bottom-fill><div ng-show=show.navPanel class=navPanel ng-class=episode.styleCss><div class=parent ng-repeat="parent in episode.parents" ng-bind-html=parent.display_name></div><div class=scene x-ng-if=scene.display_title x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click=seek(scene.start_time)><span class=displayTime>{{scene.displayStartTime}}</span><p><button class=fakeLink tabindex=0 ng-bind-html=scene.display_title x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus=showControls()></button><br><span ng-bind-html=scene.display_description></span></p></div><div class=crossEpisode><a class=prevEpisode ng-if=episode.previousEpisodeContainer ng-href=/#/{{appState.crossEpisodePath}}/{{episode.previousEpisodeContainer.episodes[0]}} title={{episode.previousEpisodeContainer.display_name}}>Previous episode</a> <a class=nextEpisode ng-if=episode.nextEpisodeContainer ng-href=/#/{{appState.crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}} title={{episode.nextEpisodeContainer.display_name}}>Next Episode</a></div></div><div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"><div ng-if=appState.editEvent itt-item-editor=appState.editEvent></div><div ng-if=appState.editEpisode itt-episode-editor=appState.editEpisode></div></div><div itt-timeline=""></div></div></div><div class=toolbar-bottom-controltrigger ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls()></div></div><div class="animate transitionFade" ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls() sxs-add-content=""></div><div ng-controller=ErrorController ng-include="\'templates/error.html\'"></div><div class=autoscroll ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click=enableAutoscroll()><img src=/images/autoscroll.svg width=32 height=32></div><div ng-show="show.navPanel || show.searchPanel || show.helpPanel || show.profilePanel" class=modal-backdrop ng-click=hidePanels()></div><div ng-show=appState.itemDetail class=modal-backdrop ng-click="appState.itemDetail=false"></div><div ng-if=appState.itemDetail itt-item-detail-modal=appState.itemDetail></div><div ng-show=show.searchPanel class=searchPanel><div ng-if=show.searchPanel itt-search-panel="">This will be the search panel</div></div><div ng-if=show.helpPanel class=helpPanel><div class=arrow-up></div><p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p><ul><li class=video><h3>Watch</h3><p>Just the video, no frills.</p></li><li class=directed><h3>Discover</h3><p>The guided, synchronized view of the video and related content.</p></li><li class=explore><h3>Review</h3><p>Read the full transcript and all the related transmedia in one convenient list.</p></li></ul><a class=goAway x-ng-click=noMoreHelp() href="javascript:void 1;">Don\'t show this again</a></div><div ng-if=show.profilePanel class=profilePanel><div class=arrow-up></div><div ng-if="userHasRole(\'admin\')"><img src=/images/customer/tmp-userprofile.png style="float:left; border: 5px solid #FFF"><div class=authoringForm><div class=field><div class=label>Name</div><div class=input><input value="Professor Smith"></div></div><div class=field><div class=label>Email</div><div class=input><input value=example@this-is-todo.com></div></div><br><br><div class=field><div style=text-align:right><a ng-click=logout()>Log out</a></div></div></div><div ng-if="!(userHasRole(\'admin\'))"><a ng-href="/pages/launch_oauth2?episode={{appState.episodeId}}" target=_new>Log in</a></div></div></div>'),a.put("templates/producer/addcontent.html",'<div ng-show="!appState.editEvent && !appState.editEpisode" class=controlPanel ng-class="{\n	isProducer: appState.product == \'producer\',\n	isSxS: appState.product == \'sxs\'\n}"><div ng-if="appState.product == \'producer\'" class=editButtonPanel><a class="button button-episode" ng-click=editEpisode()>Edit episode</a> <a class="button button-scene" ng-if="appState.time > 0  && appState.viewMode == \'discover\'" ng-click=editCurrentScene()>Edit scene</a></div><div class="producer addButtonPanel" ng-show="!item && appState.time > 0"><span ng-if=expanded style="padding: 0 1em" class="animate transitionExpandW"><span ng-if="appState.product == \'sxs\'"><a class="button button-comment" ng-click="addEvent(\'comment\')">Comment</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">File</a> <a class="button button-video" ng-click="addEvent(\'video\')">Video</a></span> <span ng-if="appState.product == \'producer\'"><a class="button button-scene" ng-click="addEvent(\'scene\')">Add Scene</a> <a class="button button-comment" ng-click="addEvent(\'transcript\')">Transcript</a> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Annotation</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">Upload</a> </span></span> <span ng-if=!expanded><a class="button button-add" ng-click=expand()>Add</a></span></div></div>'),a.put("templates/producer/annotator-autocomplete.html",'<div style=position:relative ng-show=!hasAnnotator()><input class=annotatorChooser ng-model=searchText ng-focus=showAutocomplete() ng-blur=hideAutocomplete() ng-change=handleAutocomplete()><div class="autocompleteList animate transitionFade" ng-if=autoCompleting><div class=autocompleteItem ng-repeat="annotator in filteredAnnotators | orderBy:\'name\'" ng-click=select(annotator) ng-class="{selected: ($index == preselectedItem)}" style="white-space: nowrap"><img ng-src={{annotator.imageUrl}}> <span ng-bind-html="(annotator.key | highlightSubstring: searchText) || \'(New speaker)\'"></span></div></div></div><div style=position:relative ng-show=hasAnnotator()><div sxs-input-i18n=item.annotator x-inputtype="\'input\'"></div><a style="position: absolute; top: 3px; right: 10px" ng-click="item.annotator={}">(x)</a></div>'),a.put("templates/producer/container-assets.html",'<div ng-if=showParent><div sxs-container-assets=container.parent_id></div></div><div class=containerAssets><div ng-if="container.parent_id && !showParent"><a class=goUp ng-click=up()>Parent container</a></div><div class=title>{{container.display_name}}</div><div class=controls><span ng-if=!hideItems><a ng-click=toggleImages()><span ng-if=onlyImages>Images</span> <span ng-if=!onlyImages>All</span></a> &nbsp; <a ng-click=toggleGrid()><span ng-if=gridView></span> <span ng-if=!gridView></span></a></span></div><div class=scrollPane ng-if=!hideItems><div ng-if=gridView><div class=grid ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click=assetClick(asset._id)><div ng-if="asset._type == \'Asset::Image\'"><img class=thumbnail ng-src={{asset.url}}></div><div ng-if="asset._type != \'Asset::Image\'"><div class=thumbnail>(video)</div></div>{{asset.name}}</div></div><table ng-if=!gridView><tr ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click=assetClick(asset._id)><td><div ng-if="asset._type == \'Asset::Image\'"><img class=thumbnail ng-src={{asset.url}}></div><td>{{asset.size |asBytes}}<td>{{asset.content_type}}<td>{{asset.name}}</table></div></div>'),a.put("templates/producer/episode.html",'<div class="itemEdit authoringForm"><div class=authoringFormScrollContainer><div class=ittTabs itt-tabs=""><div class=ittTab itt-tab=tabs[0] x-tabindex=0 x-tablabel=Episode><div class=field><div class=input><select ng-if="episode.languages.length > 1" size=1 ng-model=appState.lang ng-change=forcePreview() style="float:right; width: 100px" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></div></div><div class=field><div class=label>Title [{{appState.lang}}]</div><div class=input ng-model-options="{ debounce: 500 }" sxs-input-i18n=episode.title x-inputtype="\'input\'" autofocus></div></div><div class=field><div class=label>Description [{{appState.lang}}]</div><div class=input ng-model-options="{ debounce: 50 }" sxs-input-i18n=episode.description x-inputtype="\'textarea\'"></div></div><div class=field><div class=label>Languages</div><div class=input><label><input type=checkbox ng-model=langForm.en>English</label><label><input type=checkbox ng-model=langForm.es>Spanish</label><label><input type=checkbox ng-model=langForm.zh>Chinese</label><label><input type=checkbox ng-model=langForm.pt>Portuguese</label><label><input type=checkbox ng-model=langForm.fr>French</label><label><input type=checkbox ng-model=langForm.de>German</label><label><input type=checkbox ng-model=langForm.it>Italian</label></div></div><div class=field ng-if="languageCount>1"><div class=label>Default language</div><div class=input><select size=1 ng-model=episode.defaultLanguage><option ng-disabled=!langForm.en value=en>English<option ng-disabled=!langForm.es value=es>Spanish<option ng-disabled=!langForm.zh value=zh>Chinese<option ng-disabled=!langForm.pt value=pt>Portuguese<option ng-disabled=!langForm.fr value=fr>French<option ng-disabled=!langForm.de value=pt>German<option ng-disabled=!langForm.it value=it>Italian</select></div></div><div class=field><div class=label>Inter-episode navigation</div><div class=input><select ng-model=episode.navigation_depth><option value=0>None<option value=1>1 level (sibling episodes only)<option value=2>2 levels (course and session)</select></div></div></div><div class=ittTab itt-tab=tabs[1] x-tabindex=1 x-tablabel="Master Asset"><div class=field><div class=label>Master asset type</div><div clas=input><select size=1 ng-model=masterAssetType ng-init="masterAssetType=\'Video\'"><option value=Video>Video<option value=Audio>Audio (TODO)<option value=Images>Image sequence (TODO)<option value=None>No master asset (TODO)</select></div></div><div class=field ng-if="masterAssetType != \'None\'"><div class=label>{{masterAssetType}}</div><div class=input ng-include="\'templates/producer/upload-single.html\'"></div></div><div class=field ng-if="masterAssetType == \'Images\' || masterAssetType == \'None\'"><div class=label>Duration</div><input name=start ng-model=episode.duration ng-minlength=1 ng-maxlength=5></div></div><div class=ittTab itt-tab=tabs[2] x-tabindex=2 x-tablabel=Style><div class=field><div class=label>Template</div><div class=input><select ng-model=episode.templateUrl><option value=templates/episode/story.html>(Default)<option value=templates/episode/episode.html>(Unbranded)<option value=templates/episode/columbia.html>Columbia University<option value=templates/episode/columbiabusiness.html>Columbia Business School<option value=templates/episode/eliterate.html>e-Literate TV<option value=templates/episode/ewb.html>Engineers Without Borders<option value=templates/episode/gw.html>George Washington<option value=templates/episode/gwlaw.html>George Washington Law<option value=templates/episode/purdue.html>Purdue<option value=templates/episode/schoolclimatesolutions.html>School Climate Solutions<option value=templates/episode/usc.html>University of Southern California<option value=templates/episode/middlebury.html>Middlebury</select></div></div><div class=field><div class=label>Typography</div><div class=input><select size=1 ng-model=itemForm.typography><option value="">(Default)<option value=Sans>Sans<option value=Serif>Serif<option value=Book>Book<option value=Swiss>Swiss</select></div></div><div class=field><div class=label>Color</div><div class=input><select size=1 ng-model=itemForm.color><option value="">(Default)<option value=Invert>Invert<option value=Sepia>Sepia<option value=Solarized>Solarized<option value=Vivid>Vivid</select></div></div><div class=field><div class=label>Timestamp</div><div class=input><select size=1 ng-model=itemForm.timestamp><option value="">(Default)<option value=None>No timestamp<option value=Inline>Inline timestamp</select></div></div><div class=field><div class=label>Highlight</div><div class=input><select size=1 ng-model=itemForm.highlight><option value="">(Default)<option value=Solid>Solid<option value=Border>Border<option value=Side>Side<option value=Bloom>Bloom<option value=Highlighter>Highlighter<option value=Tilt>Tilt</select></div></div><div class=field><div class=label>Transition</div><div class=input><select size=1 ng-model=itemForm.transition><option value="">(Default)<option value=None>No transition<option value=Fade>Fade<option value=SlideL>Slide left<option value=SlideR>Slide right<option value=ExpandW>Expand<option value=Pop>Pop</select></div></div></div></div></div><div style="clear:both; width: 100%; text-align:right; padding-right: 24px"><small><a ng-click=cancelEdit()>Cancel</a></small> &nbsp; &nbsp;<input type=button value=Save ng-click=saveEpisode()></div></div>'),a.put("templates/producer/episodelist.html",'<div itt-episode-list="" class=admin><div ng-if="userHasRole(\'admin\')"><div ng-if=root.children.length style=color:#C00><p>PLEASE NOTE Producer is in alpha. There are bugs. It is generally safe to edit individual events and scenes, but please do not depend on producer for episode creation or for routine episode production yet.</p></div><div ng-if=loading ng-include="\'templates/loading.html\'"></div><div ng-repeat="child in root.children" itt-container=containers[child._id] depth=0></div></div><div ng-if="!userHasRole(\'admin\') || (!loading && (failedLogin || root.children.length == 0))">Looks like you aren\'t logged in as an admin -- <a ng-click=logout();>try again</a>.</div><div x-ng-controller=ErrorController x-ng-include="\'templates/error.html\'"></div></div>'),a.put("templates/producer/inputi18n.html","<input ng-if=\"inputtype=='input'\" ng-model=field[appState.lang]><textarea rows=4 ng-if=\"inputtype=='textarea'\" ng-model=field[appState.lang]></textarea>"),a.put("templates/producer/item.html",'<div class="itemEdit authoringForm"><div class=authoringFormScrollContainer><div ng-if="appState.product == \'sxs\'"><div class=field><div class=label>Time</div><div class=input><a ng-class="{invisible: appState.time == 0}" class=button-prev ng-click=prevScene()><span class=control-text>Beginning of scene</span></a><input ng-model=item.start_time sxs-input-time="" style=max-width:100px ng-model-options="{ updateOn: \'blur\' }" ng-change=setItemTime()></div></div><div ng-include=itemEditor></div></div><div ng-if="appState.product == \'producer\'"><div class=ittTabs itt-tabs=""><div class=ittTab itt-tab=tabs[0] x-tabindex=0 x-tablabel="{{item._type === \'Scene\' ? \'Scene\' : \'Item\'}}"><div class=field ng-if="!(item._type===\'Scene\' && item.start_time <= 0.1)"><div class=label>Time</div><div class=input><a ng-if="item._type !== \'Scene\'" ng-class="{invisible: appState.time == 0}" class=button-prev ng-click=prevScene()><span class=control-text>Beginning of scene</span></a><input ng-model=item.start_time sxs-input-time="" style=max-width:100px ng-model-options="{ updateOn: \'blur\' }" ng-change=setItemTime()><span ng-if="!(item.stop || item._type === \'Scene\')"><span class=label>End</span><input ng-if=customEndTime ng-change=setItemEndTime() ng-model=item.end_time sxs-input-time="" style=max-width:100px ng-model-options="{ updateOn: \'blur\' }"><a class=fakeLink ng-click="customEndTime = !customEndTime; item.end_time=100000"><span ng-if=customEndTime>(x)</span> <span ng-if=!customEndTime>(auto)</span></a></span><select ng-if="languages.length > 1" size=1 ng-model=appState.lang ng-change=forcePreview() style="float:right; width: 100px" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in languages"></select></div></div><div ng-include=itemEditor></div></div><div class=ittTab itt-tab=tabs[1] x-tabindex=1 x-tablabel=Style><div class=field><div class=label>Template</div><div class=input><span ng-if="item.producerItemType == \'scene\'"><select ng-model=item.templateUrl><option value=templates/scene/centered.html>Centered video<option value=templates/scene/1col.html>One column<option value=templates/scene/2colL.html>Two columns<option value=templates/scene/2colR.html>Two columns (mirrored)<option value=templates/scene/cornerH.html>Corner video, horizontal<option value=templates/scene/cornerV.html>Corner video, vertical<option value=templates/scene/pip.html>Picture-in-picture</select><select ng-model=item.layouts[0] ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="" ng-if="item.templateUrl != \'templates/scene/cornerH.html\' && item.templateUrl != \'templates/scene/cornerV.html\' && item.templateUrl != \'templates/scene/pip.html\'">Centered<option value=videoLeft>Video on left<option value=videoRight>Video on right</select></span><select ng-if="item.producerItemType == \'transcript\'" ng-model=item.templateUrl><option value=templates/item/transcript.html>Transcript<option value=templates/item/transcript-withthumbnail.html>Transcript with thumbnail<option value=templates/item/transcript-withthumbnail-alt.html>Transcript with thumbnail B</select><select ng-if="item.producerItemType == \'annotation\'" ng-model=item.templateUrl><option value=templates/item/pullquote.html>Pullquote with attribution<option value=templates/item/pullquote-noattrib.html>Pullquote<option value=templates/item/text-h1.html>Header 1<option value=templates/item/text-h2.html>Header 2<option value=templates/item/text-transmedia.html>Long text (as transmedia)</select><select ng-if="item.producerItemType == \'link\'" ng-model=item.templateUrl><option value=templates/item/link.html>Link<option value=templates/item/link-withimage.html>Link with image<option value=templates/item/link-descriptionfirst.html>Link: description first<option value=templates/item/link-embed.html>Embedded link</select><select ng-if="item.producerItemType == \'image\'" ng-model=item.templateUrl><option value=templates/item/image-fill.html>Overlay or background fill<option value=templates/item/image.html>Linked image<option value=templates/item/image-inline.html>Inline image<option value=templates/item/image-inline-withtext.html>Inline image with text<option value=templates/item/image-caption.html>Image with caption<option value=templates/item/image-caption-sliding.html>Image with sliding caption<option value=templates/item/image-thumbnail.html>Image thumbnail<option value=templates/item/image-plain.html>Plain image</select><select ng-if="item.producerItemType == \'file\'" ng-model=item.templateUrl><option value=templates/item/file.html>Linked file (TODO: force noembed?)<option value=templates/item/file-withimage.html>Linked file with image</select><select ng-if="item.producerItemType == \'question\'" ng-model=item.templateUrl><option value=templates/item/question-mc.html>Question with image top<option value=templates/item/question-mc-image-right.html>Question with image right<option value=templates/item/question-mc-image-left.html>Question with image left</select></div></div><div class=field><div class=label>Layout</div><div class=input><span ng-if="item._type === \'Scene\'"><select ng-model=item.layouts[1] ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="">Show all content items, highlight current ones<option value=showCurrent>Show only current items</select></span> <span ng-if="item._type !== \'Scene\'"><span ng-if="item.templateUrl == \'templates/item/image-fill.html\'"><select size=1 ng-model=item.layouts[0]><option value=windowBg>Window background<option value=mainBg>Main content pane background<option value=altBg>Secondary content pane background<option value=mainFg>Main content pane foreground<option value=altFg>Secondary content pane foreground<option value=videoOverlay>Video overlay</select><select size=1 ng-model=itemForm.position><option value="">Fit<option value=center>Center<option value=cover>Cover<option value=contain>Contain<option value=fill>Fill and stretch</select><select size=1 ng-model=itemForm.pin ng-if="itemForm.position != \'center\' && itemForm.position != \'fill\'"><option value=tl>Top left<option value=tr>Top right<option value=bl>Bottom left<option value=br>Bottom right</select></span><select ng-if="item.templateUrl != \'templates/item/image-fill.html\'" size=1 ng-model=item.layouts[0]><option value=windowFg>Modal<option value=inline>Inline<option value=sidebarL>Sidebar: left<option value=sidebarR>Sidebar: right<option value=burstL>Burst left margin<option value=burstR>Burst right margin<option value=burst>Burst both margins</select></span></div></div><div class=field ng-if="item.producerItemType != \'scene\'"><div class=label>Flags</div><div class=input><label><input type=checkbox ng-model=item.required>Required</label><label><input type=checkbox ng-model=item.stop>Stop item</label><label><input type=checkbox ng-model=item.cosmetic>Cosmetic</label></div></div></div><div class=ittTab itt-tab=tabs[2] x-tabindex=2 x-tablabel=Customize><div class=field><div class=label>Typography</div><div class=input><select size=1 ng-model=itemForm.typography><option value="">(Default)<option value=Sans>Sans<option value=Serif>Serif<option value=Book>Book<option value=Swiss>Swiss</select></div></div><div class=field><div class=label>Color</div><div class=input><select size=1 ng-model=itemForm.color><option value="">(Default)<option value=Invert>Invert<option value=Sepia>Sepia<option value=Solarized>Solarized<option value=Vivid>Vivid</select></div></div><div class=field><div class=label>Timestamp</div><div class=input><select size=1 ng-model=itemForm.timestamp><option value="">(Default)<option value=None>No timestamp<option value=Inline>Inline timestamp</select></div></div><div class=field><div class=label>Highlight</div><div class=input><select size=1 ng-model=itemForm.highlight><option value="">(Default)<option value=Solid>Solid<option value=Border>Border<option value=Side>Side<option value=Bloom>Bloom<option value=Highlighter>Highlighter<option value=Tilt>Tilt</select></div></div><div class=field><div class=label>Transition</div><div class=input><select size=1 ng-model=itemForm.transition><option value="">(Default)<option value=None>No transition<option value=Fade>Fade<option value=SlideL>Slide left<option value=SlideR>Slide right<option value=ExpandW>Expand<option value=Pop>Pop</select></div></div></div></div></div></div><div style="clear:both; width: 100%; text-align:right;  padding-right: 24px"><small><a ng-click=cancelEdit()>Cancel</a></small> &nbsp; &nbsp;<input type=button value=Delete ng-if="item._id != \'internal:editing\'" ng-click=deleteEvent(item._id)><input type=button value=Save ng-click=saveEvent()></div></div>'),a.put("templates/producer/item/producer-annotation.html","<div class=field><div class=label>Speaker [{{appState.lang}}]</div><div class=input><div sxs-annotator-autocomplete=annotators item=item ng-model=item.annotator></div></div></div><div class=field><div class=label>Speaker thumbnail</div><div class=input ng-include=\"'templates/producer/upload-single.html'\"></div></div><div class=field><div class=label>Annotation [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.annotation x-inputtype=\"'textarea'\" autofocus></div></div>"),a.put("templates/producer/item/producer-file.html","<div class=field><div class=label>Title [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.title x-inputtype=\"'input'\" autofocus></div></div><div class=field><div class=label>File</div><div class=input ng-include=\"'templates/producer/upload-single.html'\"></div></div><div class=field><div class=label>Description [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.description x-inputtype=\"'textarea'\"></div></div>"),a.put("templates/producer/item/producer-image.html","<div class=field><div class=label>Title [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.title x-inputtype=\"'input'\" autofocus></div></div><div class=field><div class=label>Image</div><div class=input ng-include=\"'templates/producer/upload-single.html'\"></div></div><div class=field><div class=label>Description [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.description x-inputtype=\"'textarea'\"></div></div>"),a.put("templates/producer/item/producer-link.html","<div class=field><div class=label>Title [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.title x-inputtype=\"'input'\" autofocus></div></div><div class=field><div class=label>URL</div><div class=input><input ng-model=item.url></div></div><div class=field><div class=label>Image</div><div class=input ng-include=\"'templates/producer/upload-single.html'\"></div></div><div class=field><div class=label>Description [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.description x-inputtype=\"'textarea'\"></div></div>"),a.put("templates/producer/item/producer-question.html",'<div class=field><div class=label>Question type</div><div class=input><select ng-model=item.data._plugin.questiontype><option value=mc-poll>Poll<option value=mc-formative>Formative</select></div></div><div class=field><div class=label>Question text</div><div class=input><textarea ng-model=item.data._plugin.questiontext rows=4 autofocus></textarea></div></div><div class=field><div class=label>Image (optional)</div><div class=input ng-include="\'templates/producer/upload-single.html\'"></div></div><div class=field ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class=label>{{$index | alpha}} &nbsp;<input type=checkbox ng-model=distractor.correct ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class=input><textarea ng-model=distractor.text rows=4></textarea></div></div><div class=field><div class=input><button ng-click=addDistractor($event)>Add distractor</button></div></div><div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class=label>Feedback when correct</div><div class=input><textarea rows=4 ng-model=item.data._plugin.correctfeedback></textarea></div></div><div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class=label>Feedback when incorrect</div><div class=input><textarea rows=4 ng-model=item.data._plugin.incorrectfeedback></textarea></div></div>'),a.put("templates/producer/item/producer-scene.html","<div class=field><div class=label>Scene Title [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.title x-inputtype=\"'input'\" autofocus></div></div><div class=field><div class=label>Description [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.description x-inputtype=\"'textarea'\"></div></div>"),a.put("templates/producer/item/producer-transcript.html","<div class=field><div class=label>Speaker [{{appState.lang}}]</div><div class=input><div sxs-annotator-autocomplete=annotators item=item ng-model=item.annotator></div></div></div><div class=field><div class=label>Speaker thumbnail</div><div class=input ng-include=\"'templates/producer/upload-single.html'\"></div></div><div class=field><div class=label>Transcript [{{appState.lang}}]</div><div class=input sxs-input-i18n=item.annotation x-inputtype=\"'textarea'\" autofocus></div></div>"),a.put("templates/producer/item/sxs-comment.html",'<span class="eventIcon icon-comment"></span><div class=field><div class=label>Comment</div><div class=input><textarea ng-model=item.annotation.en rows=4 autofocus></textarea></div></div>'),a.put("templates/producer/item/sxs-file.html",'<span class="eventIcon icon-file"></span><div class=field><div class=label>Title</div><div class=input><input ng-model=item.title.en autofocus></div></div><div class=field><div class=label>File</div><div class=input ng-include="\'templates/producer/upload-single.html\'"></div></div><div class=field><div class=label>Description</div><div class=input><textarea ng-model=item.description.en rows=4></textarea></div></div>'),a.put("templates/producer/item/sxs-image.html",'<span class="eventIcon icon-image"></span><div class=field><div class=label>Title</div><div class=input><input ng-model=item.title.en autofocus></div></div><div class=field><div class=label>Image</div><div class=input ng-include="\'templates/producer/upload-single.html\'"></div></div><div class=field><div class=label>Description</div><div class=input><textarea ng-model=item.description.en rows=4></textarea></div></div>'),a.put("templates/producer/item/sxs-link.html",'<span class="eventIcon icon-link"></span><div class=field><div class=label>Title</div><div class=input><input ng-model=item.title.en autofocus></div></div><div class=field><div class=label>URL</div><div class=input><input ng-model=item.url></div></div><div class=field><div class=label>Description</div><div class=input><textarea ng-model=item.description.en rows=4></textarea></div></div>'),a.put("templates/producer/item/sxs-question.html",'<span class="eventIcon icon-question"></span><div class=field><div class=label>Question type</div><div class=input><select ng-model=item.data._plugin.questiontype><option value=mc-poll>Poll<option value=mc-formative>Formative</select></div></div><div class=field><div class=label>Question text</div><div class=input><textarea ng-model=item.data._plugin.questiontext rows=4 autofocus></textarea></div></div><div class=field><div class=label>Image (optional)</div><div class=input ng-include="\'templates/producer/upload-single.html\'"></div></div><div class=field ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class=label>{{$index | alpha}} &nbsp;<input type=checkbox ng-model=distractor.correct ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class=input><textarea ng-model=distractor.text rows=4></textarea></div></div><div class=field><div class=input><button ng-click=addDistractor($event)>Add distractor</button></div></div><div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class=label>Feedback when correct</div><div class=input><textarea rows=4 ng-model=item.data._plugin.correctfeedback></textarea></div></div><div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class=label>Feedback when incorrect</div><div class=input><textarea rows=4 ng-model=item.data._plugin.incorrectfeedback></textarea></div></div>'),a.put("templates/producer/item/sxs-video.html",'<span class="eventIcon icon-video"></span><div class=field><small><div style="width:20%; display:inline-block"></div><div style="width:48%; display:inline-block">Link to a video on YouTube...</div><div style="width:32%; display:inline-block">...or make your own</div></small></div><div class=field><div class=label>Video</div><div class=input><div style="width:60%; display:inline-block; padding-right: 5%"><input ng-model=item.yturl></div><div style="width:40%; display:inline-block"><input type=button value=Upload style="width: 48%; margin-right: 4%"><input type=button value=Record style="width: 48%"></div></div></div><div class=field ng-if="item.url || item.yturl"><div class=label>YouTube url</div><div class=input><small ng-if=item.url>{{item.url}}</small> <small ng-if="item.yturl && !item.url">(No valid YouTube video found)</small></div></div><div class=field><div class=label>Title</div><div class=input><input ng-model=item.title.en autofocus></div></div><div class=field><div class=label>Description</div><div class=input><textarea ng-model=item.description.en rows=4></textarea></div></div>'),a.put("templates/producer/questionauthoring.html",'<div style=margin:1em><p>This is a standalone editor for question items. Fill in the fields below, then copy the JSON data below into the existing authoring tool. To edit an existing question paste its JSON into the json field and the editor will separate it out into editable fields.</p><table class=authoringForm><tr><td class=label>Question type<td><select ng-model=question.questiontype><option value=mc-poll>Poll<option value=mc-formative>Formative</select><tr><td class=label>Question text<td><textarea rows=4 ng-model=question.questiontext>\n				</textarea><tr><td colspan=2>Answer choices. <span ng-if="question.questiontype == \'mc-formative\'">Check the correct answer (if more than one is selected, either will count as correct).</span>To remove an answer choice, just leave it blank.<tr ng-repeat="distractor in question.distractors"><td class=label><input type=checkbox ng-model=distractor.correct ng-if="question.questiontype == \'mc-formative\'"><td><input ng-model=distractor.text><tr><td class=label><a ng-click=addDistractor()>add another</a><td><tr ng-if="question.questiontype == \'mc-formative\'"><td class=label>Feedback for correct answer<td><input ng-model=question.correctfeedback><tr ng-if="question.questiontype == \'mc-formative\'"><td class=label>Feedback for incorrect answer<td><input ng-model=question.incorrectfeedback><tr><td colspan=2><br><hr><br><tr><td class=label>JSON data: <span ng-if=editwarning>Invalid JSON!</span><td><textarea rows=10 ng-model=pluginjson></textarea></table><br><hr><br><p class=label>Question preview:</p><div class=item><div ng-if=preview itt-item=questionpreview></div></div></div>'),a.put("templates/producer/upload-single.html",'<div ng-if=showAssetPicker class=floatAssetPicker><div class=scrollContainer><div sxs-container-assets=episodeContainerId></div></div><div class=controlsContainer><button ng-click=endChooseAsset();>Cancel</button></div></div><div><span ng-if="appState.product == \'producer\'"></span> <span ng-if=uploads><div ng-repeat="upload in uploads"><progress ng-attr-max={{uploadStatus[$index].bytesTotal}} ng-attr-value={{uploadStatus[$index].bytesSent}}></progress></div></span> <span ng-if="!uploads && (item.asset || masterAsset.original_filename)">{{item.asset.original_filename || masterAsset.original_filename}} <button ng-if="appState.product == \'sxs\'" ng-click=deleteAsset(item.asset._id)>Delete</button> <button ng-if="appState.product == \'producer\'" ng-click=detachAsset(item.asset._id)>Detach</button></span> <span ng-if="!uploads && !item.asset"><button ng-if=!showUpload ng-click=chooseAsset()>Select</button> <button ng-if=!showUpload ng-click=toggleUpload()>Upload</button><input ng-if=showUpload type=file onchange=angular.element(this).scope().uploadAsset(this.files)></span></div>'),a.put("templates/producer/upload.html",'<div ng-controller=UploadController style=margin:1em><div ng-if=loading class=loading><div class=spinner><div class="rotating pie"></div><div class="filler pie"></div><div class=mask></div></div>Loading</div><h2>Bucket Listing</h2><div ng-repeat="bucket_object in bucket_objects">{{bucket_object.Key}} <button ng-click=deleteObject(bucket_object)>Delete</button><br></div><h2>Uploads in progress</h2><ul><div ng-repeat="upload_in_progress in uploads_in_progress.Uploads"><li>{{upload_in_progress.Key}} <button ng-click=cancelMultipartUpload(upload_in_progress)>Cancel</button><ul><div ng-repeat="part in upload_parts[$index].Parts"><li>{{part}}</li></div></ul></li></div></ul><input type=file id=file name=file multiple><button ng-click=uploadFiles()>Upload</button><div ng-repeat="upload in uploads"><div><progress ng-attr-max={{upload_status[$index].bytesTotal}} ng-attr-value={{upload_status[$index].bytesSent}}></div><button ng-click=pauseUpload()>Pause</button> <button ng-click=resumeUpload()>Resume</button> <button ng-click=cancelUpload()>Cancel</button> <button ng-click=networkError()>Network Error</button></div></div><div x-ng-controller=ErrorController x-ng-include="\'templates/error.html\'"></div>'),a.put("templates/root.html",'<div class=rootLogin itt-login=""><div class=inner style="height: 100%"><div ng-if=appState.user.roles>You\'re currently logged in as {{appState.user.roles}}<br><a ng-if="userHasRole(\'admin\')" href=/#/episodes>Find episodes</a><br><a ng-click=logout()>Log out</a></div><div ng-if=!appState.user.roles><form ng-submit=adminLogin()><h1>Administrators</h1><label><span>Username</span><input name=auth_key ng-model=loginForm.auth_key></label><label><span>Password</span><input type=password name=password ng-model=loginForm.password></label><input class=submit type=submit value="Log in"><span class=error ng-if=badlogin>Sorry, try again?</span></form><p>Or login <a href={{apiDataBaseUrl}}/oauth2>via OAuth</a></p></div></div></div>'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class=videoMagnet ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src=images/aspectratiopreserver-16x9.gif></div><div class=col><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><div class="col col1"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div><div class="col col2"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><div class="col col1"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class="col col2"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class=row><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=row><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=col><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/endingscreen.html",'<div class="endingscreen stretchToViewport"><div class="pane introtext"><p>Thanks for watching <span ng-bind-html=episode.display_title></span>.</p><p ng-if=episode.nextEpisodeContainer>The next episode is <a class=nextEpisode ng-href=/#/{{crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}} ng-bind-html=episode.nextEpisodeContainer.display_name></a>.</p><br><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><br><div ng-if="episode.navigation_depth > 0">Other episodes:<ul class=crossEpisodeNav itt-container-episodes=episode.parents[0]></ul></div></div></div>'),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewportShort"><div class="pane introtext"><h1 ng-bind-html=episode.display_title></h1><p ng-bind-html=episode.display_description></p><br><div ng-if="episode.navigation_depth >0">Other episodes:<ul class=crossEpisodeNav itt-container-episodes=episode.parents[0]></ul></div></div><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class=clear></div></div>'),a.put("templates/scene/pip.html",'<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div><div ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer showCurrent" ng-class="{\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class=clear></div></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div>'),a.put("templates/searchpanel.html",'<div ng-class=episode.styleCss><div aria-label="sort toggle" class=searchfilters aria-controls=sortableSearch>Sorted by <button tabindex=0 class=fakeLink ng-click=toggleSortBy(sortBy) aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button></div><div class=scrollContainer><div class=searchResults id=sortableSearch><div ng-if="sortBy == \'startTime\'"><div ng-repeat="scene in episode.scenes"><h3 ng-if="sceneItems.length > 0 && scene.display_title" ng-bind-html=scene.display_title></h3><div class=item ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText, \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'"></div></div></div><div ng-if="sortBy == \'type\'"><div ng-repeat="(typeID,showType) in searchTypes" ng-if=showType><h3 ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3><div class=item ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\"></div></div></div><div ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">(Nothing matched your search.)</div></div></div></div>"),a.put("templates/timeline.html",'<div class=timeline><button tabindex=0 ng-focus=showControls() class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click=play()><span class=control-text>Play</span></button> <button tabindex=0 ng-focus=showControls() class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click=pause()><span class=control-text>Pause</span></button><div class=progressbarBox><div class=pbarTop><span ng-if="appState.product == \'producer\'"><a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click=zoomOut()><span class=control-text>Zoom out</span></a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click=zoomIn()><span class=control-text>Zoom in</span></a></span></div><div class=pbarMain><button ng-focus=showControls() ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click=prevScene()><span class=control-text>Previous</span></button><div class="tooltip sceneMenuTooltip" ng-if=sceneMenuToolTip><span class=content>Scene-by-scene navigation</span></div><button ng-focus=showControls() tabindex=0 class=button-scenemenu ng-click=showSceneMenuTooltip(false);toggleNavPanel(); ng-mouseover=showSceneMenuTooltip(true) ng-mouseout=showSceneMenuTooltip(false)><span class=control-text>Scenes</span></button> <button ng-focus=showControls() tabindex=0 ng-class="{invisible: appState.time >= appState.duration-0.1}" class="button button-next" ng-click=nextScene()><span class=control-text>Next</span></button><div class=progressbar><div class=mask><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=buffered ng-style="{width: appState.bufferedPercent+\'%\'}"></div><div class=played ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=handle ng-show="isSeeking && !appState.editEvent" ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class=tip ng-show=seekHandleVisible>{{willSeekTo | asTime}}</div></div><div class="handle sxsHandle playhead" ng-show=appState.editEvent ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class=tip>{{willSeekTo | asTime}}</div></div><div class=tooltip ng-if=event.showTooltip ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"><span class=content ng-bind-html="event.display_title || \'(&quot;Hidden&quot; scene)\'"></span></div><div ng-if=appState.editEvent class=editingItem ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(appState.duration - appState.editEvent.end_time)+\'%\'}"></div></div><div class="playhead mask"><div class=progressbarContainer ng-style="{width: zoomLevel+\'00%\'}"><div class=marker ng-mouseover=showTooltip(event); ng-mouseout=hideTooltip(event) ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}" ng-if="event.display_title || appState.product == \'producer\'" ng-class="{mini: (!event.display_title)}"></div></div></div></div></div><div class=pbarBottom><span class=timedisplay>{{appState.time | asTime}} / {{appState.duration | asTime}} <span class=speedcontrol ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(-0.25) aria-label="Slow down video"><div ng-class="{arrowLeft: appState.timeMultiplier > 0.5}"></div></button> <span class=speeddisplay ng-click=resetSpeed()>{{appState.timeMultiplier}}x</span> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(0.25) aria-label="Speed up video"><div ng-class="{arrowRight: appState.timeMultiplier < 2}"></div></button></span></span> <span style=display:inline-block;height:1em;position:relative ng-if="episode.languages.length > 1"><select size=1 ng-model=appState.lang class=languageSelector ng-change=setNewLanguage() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></span> <button ng-focus=showControls() tabindex=0 ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class=control-text>Captions</span></button>  <span ng-if=!appState.isTouchDevice><button ng-focus=showControls() tabindex=0 class="button button-mute {{audioIcon()}}" ng-click=toggleMute()><span class=control-text>Mute</span></button><itt-volume-slider></itt-volume-slider></span></div></div></div>'),a.put("templates/video.html","<div class=video><iframe tabindex=-1 id=ytplayer{{uid}} ng-if=video.urls.youtube ng-src=\"{{video.urls.youtube + '?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&wmode=opaque&rel=0'}}\"></iframe><video ng-if=!video.urls.youtube aria-label=\"media player\"><source class=m3u8 ng-if=video.urls.m3u8 ng-src={{video.urls.m3u8}} type=application/x-mpegURL><source class=mpeg4 ng-if=video.urls.mpeg4 ng-src={{video.urls.mpeg4}} type=video/mp4><source class=webm ng-if=video.urls.webm ng-src={{video.urls.webm}} type=video/webm><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-click=videoClick() class=videoMask ng-class=\"{\n		play: appState.timelineState == 'paused',\n		buffering: appState.timelineState == 'buffering',\n		firstplay: !appState.hasBeenPlayed,\n		rewind: (appState.time > 0 && appState.time >= video.duration - 0.3)\n	}\"></div></div>")
}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","config",function(a,b){var c={};return c.init=function(){c.user=c.user||{},c.episodeId=!1,c.isFramed=window.parent!=window,c.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),c.windowWidth=0,c.windowHeight=0,c.viewMode=$(window).width()>480?"discover":"review",c.producerEditLayer=0,c.time=0,c.bufferedPercent=0,c.timeMultiplier=1,c.duration=0,c.timelineState="paused",c.hasBeenPlayed=!1,c.volume=100,c.muted=!1,c.hideCaptions=!1,c.show={searchPanel:!1,helpPanel:!1,navPanel:!1},c.videoControlsActive=!1,c.videoControlsLocked=!1,c.itemDetail=!1,c.autoscroll=!1,c.autoscrollBlocked=!1,c.product=c.product,c.crossEpisodePath="sxs"===c.product||"producer"===c.product?c.product:"episode",c.editEvent=!1,c.editEpisode=!1,c.lang=!1},c.init(),a(function(){c.windowHeight=angular.element(window).height(),c.windowWidth=angular.element(window).width()},50,0,!1),c.isTouchDevice&&(document.getElementById("CONTAINER").className="touchDevice"),b.debugInBrowser,c}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","appState",function(a,b,c,d,e,f){var g={};g.userHasRole=function(a){if(f.user&&f.user.roles)for(var b=0;b<f.user.roles.length;b++)if(f.user.roles[b]===a)return!0;return!1},g.logout=function(){localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",f.user={},c({method:"GET",url:a.apiDataBaseUrl+"/logout"}).success(function(){delete c.defaults.headers.common.Authorization,e.path("/")}).error(function(){delete c.defaults.headers.common.Authorization,e.path("/")})},g.adminLogin=function(b,e){var f=d.defer();return c({method:"POST",url:a.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:b,password:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',h(a),g.getCurrentUser().then(function(){f.resolve(a)})}).error(function(a){f.reject(a)}),f.promise},g.authenticate=function(){var h=d.defer();if(c.defaults.headers.common.Authorization)f.user?h.resolve():g.getCurrentUser().then(function(){h.resolve()},function(){return g.authenticateViaNonce()});else{if(b.key){var i=b.key;return e.search("key",null),g.getAccessToken(i)}var j=g.getStoredToken();if(!j)return g.authenticateViaNonce();c.defaults.headers.common.Authorization='Token token="'+j+'"',g.getCurrentUser().then(function(){h.resolve()},function(){return localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",f.user={},g.authenticateViaNonce()})}return h.promise},g.authenticateViaNonce=function(){var a=d.defer();return g.getNonce().then(function(b){g.getAccessToken(b).then(function(){a.resolve()})}),a.promise},g.getStoredToken=function(){var b={};if(localStorage&&localStorage.getItem(a.localStorageKey)){localStorage.removeItem("storyKey"),b=angular.fromJson(localStorage.getItem(a.localStorageKey));var c=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];b.customer!==c&&(localStorage.removeItem(a.localStorageKey),b={})}return b.token||!1},g.getCurrentUser=function(){var b=d.defer();return c({method:"GET",url:a.apiDataBaseUrl+"/show_user"}).success(function(a){h(a),b.resolve()}).error(function(){b.reject()}),b.promise};var h=function(b){var c={access_token:b.access_token||b.authentication_token,customer:a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:b.roles};angular.forEach(["_id","name","email"],function(a){b[a]&&(c[a]=b[a])}),f.user=c;try{localStorage.setItem(a.localStorageKey,JSON.stringify({token:c.access_token,customer:c.customer}))}catch(d){}};return g.getNonce=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url?(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url,b.reject()):b.reject()}).error(function(){b.reject()}),b.promise},g.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){h(a),c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',g.getCurrentUser().then(function(){e.resolve(a)})}).error(function(){e.reject()}),e.promise},g}]),angular.module("com.inthetelling.story").factory("awsSvc",["config","$routeParams","$http","$q","appState","modelSvc",function(a,b,c,d,e,f){var g,h,i,j,k=1e3,l=3,m="public-read",n="pending",o="uploading",p="complete",q={},r={s3:{}},s=5242880,t=0,u=0,v=0,w=[],x=0,y=[],z=0,A=0,B=[],C=!1;q.awsCache=function(){return r},q.getBucketListing=function(){var a=d.defer();return D().then(function(){r.s3.listObjects(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},q.uploadFiles=function(a){for(var b=[],c=0;c<a.length;c++){y.push(a.item(c));var e=d.defer();B.push(e),b.push(e.promise)}return E(),b},q.pauseUpload=function(){if(g&&!C){if(C=!0,Q(),H())A=0;else{var a=0;for(A=0;u>a;){var b=w[a];b.status===p&&(A+=b.uploaded),a++}}i.notify({bytesSent:A,bytesTotal:g.size})}},q.resumeUpload=function(){if(g&&C)if(C=!1,H())J();else for(var a=0;l>a;a++)N()},q.cancelUpload=function(){g&&(C=!1,A=0,Q(),H()||(q.cancelMultipartUpload(h),h=null),g=null,i.notify({bytesSent:0,bytesTotal:0}),i.reject("Canceled by user"))},q.networkError=function(){g&&Q()},q.deleteObject=function(a){var b=d.defer();return D().then(function(){var c={Bucket:a.bucket,Key:a.Key};r.s3.deleteObject(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise},q.getMultipartUploads=function(){var a=d.defer();return D().then(function(){r.s3.listMultipartUploads(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},q.getMultipartUploadParts=function(a,b){var c=d.defer();return D().then(function(){var d={Bucket:b.bucket,Key:b.Key,UploadId:b.UploadId};r.s3.listParts(d,function(b,d){b?c.reject():c.resolve({i:a,parts:d})})}),c.promise},q.cancelMultipartUpload=function(a){var b=d.defer();return D().then(function(){var c={Bucket:a.bucket,Key:a.Key,UploadId:a.UploadId};r.s3.abortMultipartUpload(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise};var D=function(){return r.hasOwnProperty("sessionDeferred")?r.sessionDeferred.promise:(r.sessionDeferred=d.defer(),c.get(a.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(b){if(b.access_key_id){AWS.config.update({accessKeyId:b.access_key_id,secretAccessKey:b.secret_access_key,sessionToken:b.session_token,region:a.awsRegion});var c={params:{Bucket:b.bucket,Prefix:b.key_base}};r.s3=new AWS.S3(c),r.sessionDeferred.resolve(b)}else r.sessionDeferred.reject()}).error(function(){r.sessionDeferred.reject()}),r.sessionDeferred.promise)},E=function(){if(y.length>z&&!g){if(g=y[z],""===g.type)return B[z].resolve("Could not determine file type for file '"+g.name+"'"),g=null,z++,void E();F().then(function(){var a;a=H()?I():K(),a.then(R,function(a){B[z].reject(a)},function(a){B[z].notify(a)})})}},F=function(a){return a=a||d.defer(),g.uniqueName=G(),D().then(function(){var b={Key:r.s3.config.params.Prefix+g.uniqueName};r.s3.headObject(b,function(b){b?404!==b.statusCode?a.reject(b):(H()||q.getMultipartUploads().then(function(a){for(var b=!0;b;)for(var c=r.s3.config.params.Prefix+g.uniqueName,d=0;d<a.Uploads.length;d++){if(a.Uploads[d].Key===c){g.uniqueName=G();break}d===a.Uploads.length-1&&(b=!1)}}),a.resolve()):(g.uniqueName=G(),F(a))})}),a.promise},G=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b},H=function(){return g.size<=s?!0:!1},I=function(){return i=d.defer(),J().then(function(){},function(){},function(){}),i.promise},J=function(){var a=d.defer();return D().then(function(){var a={Key:r.s3.config.params.Prefix+g.uniqueName,ContentType:g.type,Body:g,ACL:m};j=r.s3.putObject(a,function(a,b){a?i.reject():i.resolve(b)}),j.on("httpUploadProgress",function(a){i.notify({bytesSent:a.loaded,bytesTotal:a.total})}).on("error",function(a){i.reject(a)})},function(){},function(){}),a.promise},K=function(){return i=d.defer(),L().then(M).then(function(){for(var a=0;l>a;a++)N()}),i.promise},L=function(){var a=d.defer();return D().then(function(){var b={Key:r.s3.config.params.Prefix+g.uniqueName};r.s3.createMultipartUpload(b,function(b,c){b?a.reject():a.resolve(c)})}),a.promise},M=function(a){var b=d.defer();h=a,w=[],u=0,v=0,x=0,t=s,A=0,g.size>t*k&&(t=Math.ceil(g.size/k)),u=Math.ceil(g.size/t);for(var c=0;u>c;c++){var e={};e.start=c*t,e.end=e.start+t,e.uploaded=0,e.end>g.size&&(e.end=g.size),e.status=n,w.push(e)}return b.resolve(),b.promise},N=function(){var a=d.defer(),b=x,c=!1;if(C)a.reject("Upload paused");else{for(;!c&&u>b;){var e=w[b];if(e.status===n){c=!0,e.status=o;var f=g.slice(e.start,e.end);e.cancel=function(){e.request.abort(),e.status=n,e.uploaded=0},d.all({partNumber:d.when(b+1),eTag:O(b+1,f)}).then(P).then(function(b){a.resolve(b)},function(b){a.reject(b)},function(b){a.update(b)})}else e.status===p&&b===x&&x++;b++}c||a.reject("All chunks uploaded")}return a.promise},O=function(a,b){var c=d.defer();return D().then(function(){var d={Bucket:h.Bucket,Key:h.Key,UploadId:h.UploadId,PartNumber:a,Body:b};w[a-1].request=r.s3.uploadPart(d,function(a,b){a?c.reject():c.resolve(b.ETag)}),w[a-1].request.on("httpUploadProgress",function(b){A+=b.loaded-w[a-1].uploaded,w[a-1].uploaded=b.loaded,i.notify({bytesSent:A,bytesTotal:g.size})}).on("error",function(a){i.reject(a)})}),c.promise},P=function(a){var b=d.defer();if(w[a.partNumber-1].status=p,w[a.partNumber-1].part={ETag:a.eTag,PartNumber:a.partNumber},v++,v===u){for(var c=[],e=0;u>e;e++)c.push(w[e].part);var f={Bucket:h.Bucket,Key:h.Key,UploadId:h.UploadId,MultipartUpload:{Parts:c}};r.s3.completeMultipartUpload(f,function(a,c){a?(i.reject(a),b.reject(a)):(f={Bucket:h.Bucket,Key:h.Key,ACL:m},r.s3.putObjectAcl(f,function(a){a&&(i.reject(a),b.reject(a))}),i.resolve(c),b.resolve(c))})}else N();return b.promise},Q=function(){if(H())j.abort();else for(var a=x,b=!1;!b&&u>a;){var c=w[a];c.status===o?c.cancel():c.status===n&&(b=!0),a++}},R=function(){var b=d.defer(),h={url:"https://s3.amazonaws.com/"+r.s3.config.params.Bucket+"/"+r.s3.config.params.Prefix+g.uniqueName,type:g.type,size:g.size,original_filename:g.name},i=f.episodes[e.episodeId].container_id;return c.post(a.apiDataBaseUrl+"/v1/containers/"+i+"/assets",h).success(function(a){B[z].resolve(a),g=null,z++,E()}).error(function(){B[z].reject()}),b.promise};return q}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc","errorSvc","mockSvc","questionAnswersSvc","appState",function(a,b,c,d,e,f,g,h,i,j,k){var l={};l.getEpisode=function(a){if(!a)throw"no episode ID supplied to dataSvc.getEpisode";g.episodes[a]||(g.cache("episode",{_id:a}),c.local?i.mockEpisode(a):f.authenticate().then(function(){return p()}).then(function(){return q(a)}))};var m={template:{},layout:{},style:{}},n=!1,o=a.defer(),p=function(){return n?o.promise:(n=!0,a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){l.cache("templates",a[0].data),l.cache("layouts",a[1].data),l.cache("styles",a[2].data),n=!0,o.resolve()},function(){n=!1,o.reject()}),o.promise)};l.cache=function(a,b){angular.forEach(b,function(b){"templates"===a?m.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?m.layout[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name}:"styles"===a&&(m.style[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name})})},l.resolveIDs=function(a){if(a.template_id&&(m.template[a.template_id]?(a.templateUrl=m.template[a.template_id].url,delete a.template_id):h.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){m.layout[a]?b.push(m.layout[a].css_name):h.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b)}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){m.style[a]?c.push(m.style[a].css_name):h.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c)}return a};var q=function(a){b.get(e.apiDataBaseUrl+"/v3/episodes/"+a).success(function(b){"Published"===b.status||f.userHasRole("admin")?(g.cache("episode",l.resolveIDs(b)),r(a),l.getContainer(b.container_id,a)):h.error({data:"This episode has not yet been published."})}).error(function(){h.error({data:"API call to /v3/episodes/"+a+" failed (bad episode ID?)"})})},r=function(a){b.get(e.apiDataBaseUrl+"/v3/episodes/"+a+"/events").success(function(b){s(b,"Plugin",a),angular.forEach(b,function(a){g.cache("event",l.resolveIDs(a))}),g.resolveEpisodeEvents(a)})},s=function(a,b,c){angular.forEach(a,function(a){"Plugin"===a.type&&!function(a){j.getUserAnswer(a._id,k.user._id).then(function(b){a.data._plugin.hasBeenAnswered=!0;var c=0,d=!0;angular.forEach(a.data._plugin.distractors,function(e){d&&(e.text===b.data.answer&&(e.selected=!0,a.data._plugin.selectedDistractor=c,d=!1),c++)}),g.cache("event",l.resolveIDs(a))})}(a)}),g.resolveEpisodeEvents(c)};l.getContainer=function(a,c){g.containers[a]||g.cache("container",{_id:a}),b.get(e.apiDataBaseUrl+"/v3/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id?l.getContainer(a[0].parent_id,c):c&&g.resolveEpisodeContainers(c)}),l.getContainerAssets(a,c)},l.getContainerAssets=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(b){g.containers[a].assetsHaveLoaded=!0,angular.forEach(b.files,function(a){g.cache("asset",a)}),c&&g.resolveEpisodeAssets(c)})};var t=function(c,d){var g=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+c).then(function(a){var b=a.data;return d&&(b=d(b)),g.resolve(b)})}),g.promise},u=function(c,d){var f=a.defer();return b({method:"PUT",url:e.apiDataBaseUrl+c,data:d}).success(function(a){return f.resolve(a)}),f.promise},v=function(c,d){var f=a.defer();return b({method:"POST",url:e.apiDataBaseUrl+c,data:d}).success(function(a){return f.resolve(a)}),f.promise},w=function(c){var d=a.defer();return b({method:"DELETE",url:e.apiDataBaseUrl+c}).success(function(a){return d.resolve(a)}),d.promise};l.getContainerRoot=function(){return t("/v3/containers",function(a){var b=[];return angular.forEach(a,function(a){g.cache("container",a),b.push(a._id)}),b})},l.getSingleContainer=function(a){return t("/v3/containers/"+a,function(a){return g.cache("container",a[0]),a[0]._id})},l.createContainer=function(b){var c=a.defer(),d={container:{customer_id:b.customer_id,name:b.name,parent_id:b.parent_id}};return v("/v3/containers",d).then(function(a){g.cache("container",a);var b;b=a.parent_id?a.parent_id:a.ancestry.replace(/.*\//,""),g.containers[b].children.push(g.containers[a._id]),c.resolve(a)}),c.promise},l.deleteContainer=function(a){return delete g.containers[a],w("/v3/containers/"+a)},l.createEpisode=function(b){var c=a.defer();return v("/v3/episodes",b).then(function(a){g.containers[a.container_id].episodes=[a._id],c.resolve(a)}),c.promise},l.deleteEpisode=function(b){var c=a.defer();return t("/v2/episodes/"+b+"/episode_user_metrics").then(function(d){if(d.length){for(var e=[],f=0;f<d.length;f++)e.push(w("/v2/episode_user_metrics/"+d[f]._id));a.all(e).then(function(){w("/v3/episodes/"+b),c.resolve()})}else w("/v3/episodes/"+b),c.resolve()}),c.promise},l.deleteItem=function(a){return w("/v3/events/"+a)},l.deleteAsset=function(a){return w("/v1/assets/"+a)},l.storeItem=function(a){return a=x(a),a?a&&a._id&&!a._id.match(/internal/)?u("/v3/events/"+a._id,{event:a}):v("/v3/episodes/"+a.episode_id+"/events",{event:a}):!1};var x=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;var c=["_id","producerItemType","start_time","end_time","episode_id","template_id","templateUrl","stop","sxs","title","url","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id"];b.type=a._type;for(var d=0;d<c.length;d++)(a[c[d]]||0===a[c[d]])&&(b[c[d]]=angular.copy(a[c[d]]));b.style_id=[],b.layout_id=[],b.style_id=A("style",a.styles),b.layout_id=A("layout",a.layouts);var e=l.readCache("template","url",a.templateUrl);return b.template_id=e?e.id:z(a.templateUrl),b.template_id?b:(h.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)};l.prepItemForStorage=x,l.detachMasterAsset=function(a){var b=y(a);return b.master_asset_id=null,b?u("/v3/episodes/"+b._id,b):!1},l.storeEpisode=function(a){var b=y(a);return b?u("/v3/episodes/"+b._id,b):!1};var y=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;for(var c=["_id","title","description","container_id","customer_id","master_asset_id","status","languages","navigation_depth"],d=0;d<c.length;d++)(a[c[d]]||0===a[c[d]])&&(b[c[d]]=angular.copy(a[c[d]]));b.style_id=A("style",a.styles);var e=l.readCache("template","url",a.templateUrl);return b.template_id=e?e.id:z(a.templateUrl),b.template_id?b:(h.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)},z=function(a){var b={"templates/episode/episode.html":"templates/episode-default.html","templates/episode/eliterate.html":"templates/episode-eliterate.html","templates/episode/ewb.html":"templates/episode-ewb.html","templates/episode/gw.html":"templates/episode-gw.html","templates/episode/purdue.html":"templates/episode-purdue.html","templates/episode/story.html":"templates/episode-tellingstory.html","templates/item/transcript.html":"templates/transcript-default.html","templates/item/transcript-withthumbnail.html":"templates/transcript-withthumbnail.html","templates/item/transcript-withthumbnail-alt.html":"templates/transcript-withthumbnail-alt.html","templates/item/text-h1.html":"templates/text-h1.html","templates/item/text-h2.html":"templates/text-h2.html","templates/item/pullquote-noattrib.html":"templates/text-pullquote-noattrib.html","templates/item/pullquote.html":"templates/text-pullquote.html","templates/item/image.html":"templates/transmedia-image-default.html","templates/item/image-caption.html":"templates/transmedia-caption.html","templates/item/image-caption-sliding.html":"templates/transmedia-slidingcaption.html","templates/item/image-fill.html":"templates/transmedia-image-fill.html","templates/item/image-plain.html":"templates/transmedia-image-plain.html","templates/item/image-linkonly.html":"templates/transmedia-linkonly.html","templates/item/image-thumbnail.html":"templates/transmedia-thumbnail.html","templates/item/link.html":"templates/transmedia-link-default.html","templates/item/link-embed.html":"templates/transmedia-link-embed.html","templates/scene/1col.html":"templates/scene-1col.html","templates/scene/2colL.html":"templates/scene-2colL.html","templates/scene/2colR.html":"templates/scene-2colR.html","templates/scene/centered.html":"templates/scene-centered.html","templates/scene/cornerH.html":"templates/scene-cornerH.html","templates/scene/cornerV.html":"templates/scene-cornerV.html","templates/item/question-mc-formative.html":"templates/question-mc-formative.html","templates/item/question-mc-poll.html":"templates/question-mc-poll.html","templates/item/question-mc.html":"templates/question-mc.html","templates/item/question-mc-image-left.html":"templates/question-mc-image-left.html","templates/item/question-mc-image-right.html":"templates/question-mc-image-right.html","templates/item/sxs-question.html":"templates/sxs-question.html"};if(b[a]){var c=l.readCache("template","url",b[a]);return c.id}return!1};l.readCache=function(a,b,c){var d=!1;return angular.forEach(m[a],function(a){a[b]===c&&(d=a)}),d?d:!1},e.debugInBrowser;var A=function(a,b){var c=[];return angular.forEach(b,function(b){if(b){var d=l.readCache(a,"css_name",b);if(!d)return h.error({data:"Tried to store a "+a+" with no ID: "+b}),!1;c.push(d.id)}}),c};return l}]),angular.module("com.inthetelling.story").factory("errorSvc",function(){var a={};return a.init=function(){a.errors=[],a.notifications=[]},a.init(),a.error=function(b){b&&401===b.status,b&&b.data&&a.errors.push({exception:b,cause:b.data.error})},a.notify=function(b){a.notifications.push({text:b})},a}),angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","config","appState",function(a,b,c,d){var e={};e.episodes={},e.assets={},e.events={},e.containers={},e.cache=function(a,b){"episode"===a?e.episodes[b._id]?angular.extend(e.episodes[b._id],e.deriveEpisode(angular.copy(b))):e.episodes[b._id]=e.deriveEpisode(angular.copy(b)):"event"===a?e.events[b._id]?angular.extend(e.events[b._id],e.deriveEvent(angular.copy(b))):e.events[b._id]=e.deriveEvent(angular.copy(b)):"asset"===a?e.assets[b._id]?angular.extend(e.assets[b._id],e.deriveAsset(angular.copy(b))):e.assets[b._id]=e.deriveAsset(angular.copy(b)):"container"===a&&(e.containers[b._id]?angular.extend(e.containers[b._id],e.deriveContainer(angular.copy(b))):e.containers[b._id]=e.deriveContainer(angular.copy(b)))};var f={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/debug.html","templates/upload-demo.html":"templates/item/debug.html","templates/question-mc-formative.html":"templates/item/question-mc-formative.html","templates/question-mc-poll.html":"templates/item/question-mc-poll.html","templates/question-mc.html":"templates/item/question-mc.html","templates/question-mc-image-left.html":"templates/item/question-mc-image-left.html","templates/question-mc-image-right.html":"templates/item/question-mc-image-right.html","templates/sxs-question.html":"templates/item/sxs-question.html"};e.deriveEpisode=function(a){return f[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl]),angular.forEach(a.languages,function(b){b.default&&(a.defaultLanguage=b.code)}),a.defaultLanguage===!1&&(a.defaultLanguage="en"),e.setLanguageStrings(),a.styles||(a.styles=[]),angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(b){a.templateUrl==="templates/episode/"+b+".html"&&angular.forEach(["color","typography"],function(c){var d=!1;angular.forEach(a.styles,function(a){a.match(c)&&(d=!0)}),d||a.styles.push(c+b[0].toUpperCase()+b.substring(1))})}),a.title&&e.events["internal:landingscreen:"+a._id]&&(e.events["internal:landingscreen:"+a._id].title=a.title,e.events["internal:landingscreen:"+a._id]=g(e.events["internal:landingscreen:"+a._id])),a=g(a)},e.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=j(a)),a},e.deriveContainer=function(a){if(a.haveNotLoadedChildData=!1,a.children&&a.children.length>0){a.children=a.children.sort(function(a,b){return a.name.en>b.name.en?1:-1}),a.children=a.children.sort(function(a,b){return a.sort_order-b.sort_order});var b=[];angular.forEach(a.children,function(a){e.containers[a._id]?b.push(e.containers[a._id]):(a.haveNotLoadedChildData=!0,e.containers[a._id]=angular.copy(g(a)))}),a.loadedChildData=!0}return g(a)},e.deriveEvent=function(a){return a=g(a),"Scene"!==a._type&&(e.episodes[a.episode_id]&&"templates/episode/usc.html"===e.episodes[a.episode_id].templateUrl&&(a.templateUrl||(a.templateUrl="templates/item/usc-badges.html"),"Link"===a._type&&("templates/transmedia-link-default.html"===a.templateUrl&&(a.templateUrl="templates/transmedia-link-noembed.html"),a.display_title.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youre finished - Come back to this page and click <b>Continue</b>).<br><br>If youd rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.display_title.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.display_title.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge"))),a.isContent=!1,a.isTranscript=!1,a.noEmbed=!1,a.noExternalLink=!1,a.targetTop=!1,a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),"Link"===a._type&&a.url.match(/^http:\/\//)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0,a.noEmbed=!0)),f[a.templateUrl]?(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])):a.origTemplateUrl=a.templateUrl,a.producerItemType||(a.templateUrl.match(/file/)?a.producerItemType="file":a.templateUrl.match(/image/)?a.producerItemType="image":a.templateUrl.match(/link/)?a.producerItemType="link":a.templateUrl.match(/video/)?a.producerItemType="link":a.templateUrl.match(/question/)?a.producerItemType="question":a.templateUrl.match(/transcript/)?a.producerItemType="transcript":a.templateUrl.match(/text/)?a.producerItemType="annotation":a.templateUrl.match(/pullquote/)?a.producerItemType="annotation":a.templateUrl.match(/scene/)?a.producerItemType="scene":a.templateUrl.match(/comment/)&&(a.producerItemType="comment")),a.displayStartTime=b("asTime")(a.start_time),a};var g=function(a){var b=d.lang?d.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(c){a[c]&&(a["display_"+c]="string"==typeof a[c]?a[c]:a[c][b]?a[c][b]:a[c].en)}),a};e.setLanguageStrings=function(){angular.forEach(e.events,function(a){a=g(a)}),angular.forEach(e.episodes,function(a){a=g(a)}),angular.forEach(e.containers,function(a){a=g(a)})},e.resolveEpisodeEvents=function(a){var b=[],c=[],d=e.episodes[a];angular.forEach(e.events,function(d){d.episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))});var f={};angular.forEach(c,function(a){if("Annotation"===a._type&&a.annotator){var b=d.defaultLanguage||"en",c=a.annotator[b];void 0===c&&(c=a.annotator[Object.keys(a.annotator).sort()[0]]),f[c]?(f[c].name=angular.extend(f[c].name,a.annotator),f[c].annotation_image_id||(f[c].annotation_image_id=a.annotation_image_id)):f[c]={name:a.annotator,annotation_image_id:a.annotation_image_id};for(var e=Object.keys(f[c].name).sort(),g=f[c].name[b]||"(untranslated)",h=0;h<e.length;h++)e[h]!==b&&(g=g+" / "+f[c].name[e[h]]);f[c].key=g}}),d.annotators=f,d.scenes=b.sort(function(a,b){return a.start_time-b.start_time}),d.items=c.sort(function(a,b){return a.start_time-b.start_time});for(var g=1;g<d.scenes.length-1;g++)d.scenes[g].end_time=d.scenes[g+1].start_time;angular.forEach(b,function(a){var b=[];angular.forEach(c,function(c){c.start_time>=a.start_time&&c.start_time<a.end_time&&(c.end_time<=a.end_time?(e.events[c._id].scene_id=a._id,b.push(c)):a.end_time-.25<c.start_time?c.start_time=a.end_time:(c.end_time=a.end_time,b.push(c)))}),e.events[a._id].items=b.sort(function(a,b){return a.start_time-b.start_time})}),d.styleCss=i(d),angular.forEach(e.events,function(b){b.episode_id===a&&(b.styleCss=i(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},e.resolveEpisodeContainers=function(a){var b=e.episodes[a];b.parents=[],delete b.previousEpisodeContainer,delete b.nextEpisodeContainer,b.navigation_depth>0?h(+b.navigation_depth+1,a,b.container_id):b.navigation_depth=0};var h=function(a,b,c){var d=e.episodes[b];if(a<=d.navigation_depth&&(d.parents[a-1]=e.containers[c]),a===d.navigation_depth)for(var f=0;f<e.containers[c].children.length;f++){var g=e.containers[c].children[f];g.episodes[0]===b&&(f>0&&(d.previousEpisodeContainer=e.containers[e.containers[c].children[f-1]._id]),f<e.containers[c].children.length-1&&(d.nextEpisodeContainer=e.containers[e.containers[c].children[f+1]._id]))}a>1&&h(a-1,b,e.containers[c].parent_id)};e.episode=function(a){return!e.episodes[a],e.episodes[a]},e.episodeEvents=function(a){var b=[];return angular.forEach(e.events,function(c){c.episode_id===a&&b.push(c)}),b},e.scene=function(a){return!e.events[a],e.events[a]};var i=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=e.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.episode_id){var f=e.episodes[a.episode_id].styles;angular.forEach(f,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}if("Scene"!==a._type&&!a.isContent&&a.layouts&&a.layouts[0].match(/Bg/))for(var g=0;g<c.length;g++)c[g].match(/transition/)&&"transitionNone"!==c[g]&&(c[g]="transitionFade");return c.join(" ")};e.resolveEpisodeAssets=function(a){angular.forEach(e.events,function(b){if(b.episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&e.assets[c]&&(e.events[b._id].asset=e.assets[c])}}),e.episodes[a]&&e.episodes[a].master_asset_id&&(e.episodes[a].masterAsset=e.assets[e.episodes[a].master_asset_id])
},e.addLandingScreen=function(a){e.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:.001}},e.addEndingScreen=function(a){if(e.episodes[a].masterAsset){var b=parseFloat(e.episodes[a].masterAsset.duration),c=e.episodes[a].scenes[e.episodes[a].scenes.length-1];c.end_time=b,angular.forEach(c.items,function(a){a.end_time>b&&(a.end_time=b)}),e.events["internal:endingscreen:"+a]={_id:"internal:endingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/endingscreen.html",episode_id:a,start_time:b,end_time:b+.1},e.events["internal:endingscreen:"+a]=g(e.events["internal:endingscreen:"+a]),e.resolveEpisodeEvents(d.episodeId)}};var j=function(a){var b={};if(a.alternate_urls){b.lowRes={};for(var e=/\.(\w+)$/,f=0;f<a.alternate_urls.length;f++)if(a.alternate_urls[f].match(/youtube/))b.youtube=k(a.alternate_urls[f]);else{var g;switch(a.alternate_urls[f].match(e)[1]){case"mp4":g=l(b.mpeg4,a.alternate_urls[f]),b.mpeg4=d.isTouchDevice?g.smaller:g.larger,b.lowRes.mpeg4=g.smaller;break;case"m3u8":g=l(b.m3u8,a.alternate_urls[f]),b.m3u8=d.isTouchDevice?g.smaller:g.larger,b.lowRes.m3u8=g.smaller;break;case"webm":g=l(b.webm,a.alternate_urls[f]),b.webm=d.isTouchDevice?g.smaller:g.larger,b.lowRes.webm=g.smaller}}a.you_tube_url&&(b.youtube=k(a.you_tube_url))}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:k(a.you_tube_url)};var h=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),i=/Version\/[891]/.test(navigator.appVersion),j=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if((d.isTouchDevice||h&&!i)&&(b.youtube=void 0),c.disableYoutube&&(b.youtube=void 0),j){var m,n="t="+(new Date).getTime();b.mpeg4&&(m=b.mpeg4.match(/\?/)?"&":"?",b.mpeg4=b.mpeg4+m+n),b.webm&&(m=b.webm.match(/\?/)?"&":"?",b.webm=b.webm+m+n)}return a.urls=b,a},k=function(a){if(!a)return void 0;var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b)[1];return"//www.youtube.com/embed/"+c},l=function(a,b){if(!a&&b)return{larger:b,smaller:null};if(!b)return{larger:a,smaller:null};if(!a&&!b)return{larger:null,smaller:null};var c=/(\d+)x(\d+)\.\w+$/,d=a.match(c)||[0,0],e=b.match(c)||[0,0],f=Math.floor(d[1])>Math.floor(e[1])?b:a,g=Math.floor(d[1])<Math.floor(e[1])?b:a;return{larger:g,smaller:f}};return c.debugInBrowser,e}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$timeout","$interval","$rootScope","$filter","config","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f,g,h){var i={};i.timelineEvents=[],i.markedEvents=[];var j,k,l,m;i.registerVideo=function(b){void 0!==l&&a(function(){i.seek(g.time)}),l=b},i.setSpeed=function(a){m=a,g.timeMultiplier=m,l.setSpeed(a),s()},i.play=function(a){if(g.duration&&!(g.duration<.1)){if(!g.hasBeenPlayed)return g.hasBeenPlayed=!0,void c.$emit("video.firstPlay");if(g.time>g.duration-.1&&(i.seek(.1),i.play()),void 0!==l)g.videoControlsActive=!0,g.show.navPanel=!1,g.timelineState="buffering",l.play().then(function(){g.timelineState="playing",u(),q(),a||h.captureEpisodeActivity("play")});else var b=c.$watch(function(){return void 0!==l},function(a){a&&(b(),i.play())})}},i.pause=function(a){g.videoControlsActive=!0,b.cancel(j),r(),j=void 0,p=void 0,g.timelineState="paused",l.pause(),a||h.captureEpisodeActivity("pause")},i.stall=function(){b.cancel(j),r(),j=void 0,p=void 0,i.wasPlaying="playing"===g.timelineState,g.timelineState="buffering"},i.unstall=function(){i.wasPlaying?(g.timelineState="playing",i.play()):g.timelineState="paused",i.wasPlaying=void 0},i.seek=function(b,c,d){if(!l||0===g.duration)return void a(function(){i.seek(b,c,d)},300);r();var e=g.time;if(b=z(b),0>b&&(b=0),b>g.duration&&(b=g.duration),g.time=b,l.seek(b,!0),i.updateEventStates(),s(!0),c){var f={method:c,seekStart:e};d&&(f.event_id=d),h.captureEpisodeActivity("seek",f)}},i.prevScene=function(){for(var a=i.markedEvents.length-1;a>=0;a--){var b=g.time;if("playing"===g.timelineState&&(b-=3),i.markedEvents[a].start_time<b){i.seek(i.markedEvents[a].start_time,"prevScene");break}}},i.nextScene=function(){for(var a=!1,b=0;b<i.markedEvents.length;b++)if(i.markedEvents[b].start_time>g.time){i.seek(i.markedEvents[b].start_time,"nextScene"),a=!0;break}a||(i.pause(),i.seek(g.duration-.01,"nextScene"))},i.toggleMute=function(){g.muted=!g.muted,l.toggleMute()},i.setVolume=function(a){g.volume=a,l.setVolume(a)};var n,o=function(){n={lastTimelineTime:0,lastVideoTime:0}};o();var p,q=function(){n.lastTimelineTime=g.time,n.lastVideoTime=g.time,s()},r=function(){a.cancel(k),o()},s=function(b){if(a.cancel(k),"playing"===g.timelineState){for(var c=l.currentTime(),d=g.time,e=0;e<i.timelineEvents.length;e++){var f=i.timelineEvents[e];if(f.t>=n.lastTimelineTime){if(f.t>d)break;if(("pause"!==f.action||!b&&f.t!==n.lastTimelineTime)&&(t(f),"pause"===f.action)){e++;break}}}var h=i.timelineEvents[e];if(n.lastVideoTime=c,n.lastTimelineTime=d,h&&"playing"===g.timelineState){var j=1e3*(i.timelineEvents[e].t-d)/m;k=a(s,j+10)}}},t=function(a){"timeline"===a.id?"pause"===a.action?(g.time=a.t,i.pause()):i.play():"enter"===a.action?(f.events[a.id].state="isCurrent",f.events[a.id].isCurrent=!0):"exit"===a.action?(f.events[a.id].state="isPast",f.events[a.id].isCurrent=!1):"preload"===a.action&&y(f.events[a.id])},u=function(){p=void 0,b.cancel(j),j=b(v,20)},v=function(){var a=new Date,b=isNaN(a-p)?0:a-p,c=parseFloat(g.time)+b/1e3*m;0>c&&(c=0,i.pause()),c>g.duration&&(c=g.duration,i.pause()),g.time=c,p=a};i.init=function(a){i.timelineEvents=[],i.markedEvents=[],m=1,g.duration=0,g.timelineState="paused",i.injectEvents(f.episodeEvents(a),0),b.cancel(j),r()},i.injectEvents=function(a,b){0!==a.length&&(b||(b=0),angular.forEach(a,function(a){a.start_time=+a.start_time,a.end_time=+a.end_time,"Scene"===a._type&&("producer"===g.product?w(a):a.display_title&&w(a)),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,f.events[a._id].start_time=.01),a.stop?(i.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),i.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),i.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(i.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&i.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"})),(a.asset_id||a.annotation_image_id||a.link_image_id)&&i.timelineEvents.push({t:a.start_time<3?0:a.start_time-3,id:a._id,action:"preload"})}),i.sortTimeline())};var w=function(a){for(var b=!1,c=0;c<i.markedEvents.length;c++)i.markedEvents[c]._id===a._id&&(i.markedEvents[c]=angular.copy(a),b=!0);b||i.markedEvents.push(a)};i.removeEvent=function(a){i.timelineEvents=d("filter")(i.timelineEvents,{id:"!"+a}),i.markedEvents=d("filter")(i.markedEvents,{_id:"!"+a}),i.updateEventStates()},i.updateEventTimes=function(a){i.timelineEvents=d("filter")(i.timelineEvents,{id:"!"+a._id}),i.injectEvents([a],0)},i.updateSceneTimes=function(a){angular.forEach(f.episodes[a].scenes,function(a){i.updateEventTimes(a)})},i.sortTimeline=function(){i.timelineEvents=i.timelineEvents.sort(function(a,b){return a.t===b.t?a.action===b.action?0:"enter"===a.action&&"pause"===b.action?-1:"enter"===a.action&&"exit"===b.action?1:"exit"===a.action&&"enter"===b.action?-1:"exit"===a.action&&"pause"===b.action?-1:"pause"===a.action&&"enter"===b.action?1:"pause"===a.action&&"exit"===b.action?1:0:a.t-b.t}),i.markedEvents=i.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),i.timelineEvents.length>0&&(g.duration=i.timelineEvents[i.timelineEvents.length-1].t),i.updateEventStates()},i.updateEventStates=function(){var a=g.time;angular.forEach(i.timelineEvents,function(a){if("timeline"!==a.id){var b=f.events[a.id];b&&(b.state="isFuture",b.isCurrent=!1)}}),angular.forEach(i.timelineEvents,function(b){if(b.t<=a){var c=f.events[b.id];c&&("enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1))}}),s()};var x={},y=function(a){a.asset&&"Asset::Image"===a.asset._type&&(x[a.asset.url]||(x[a.asset.url]=new Image,x[a.asset.url].src=a.asset.url))},z=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return e.debugInBrowser,i}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(!e.disableAnalytics&&f.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b,c,d){(d||!e.disableAnalytics&&f.user.track_event_actions)&&g.activityQueue.push({name:a,event_id:b,walltime:new Date,data:c})},g.forceCaptureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c,!0),g.flushActivityQueue()},g.captureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c),g.flushActivityQueue()},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){var b=a.defer();if(0===g.activityQueue.length)return b.resolve(""),b.promise;var c=angular.copy(g.activityQueue);g.activityQueue=[];var d=new Date,e=[],f=[];return angular.forEach(c,function(a){a.age=(d-a.walltime)/1e3,delete a.walltime,a.event_id?f.push(a):e.push(a)}),e=g.dejitter(e),f.length>0?i("event_user_actions",{event_user_actions:f}):e.length>0?i("episode_user_metrics",{episode_user_metrics:e}):void 0},g.dejitter=function(a){if(0===a.length)return[];for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1];"seek"===d.name&&"seek"===e.name&&d.timestamp===e.data.seekStart?e.data.seekStart=d.data.seekStart:b.push(a[c])}return b.push(a[a.length-1]),b};var i=function(c,d){var g=a.defer();return b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/"+c,data:d}).success(function(a){g.resolve(a)}).error(function(){g.reject()}),g.promise};return g}]),angular.module("com.inthetelling.story").factory("questionAnswersSvc",["$q","analyticsSvc",function(a,b){var c={};return c.saveAnswer=function(a,c,d){return b.forceCaptureEventActivityWithPromise(a,c,d)},c.getAnswers=function(c){var d=a.defer();return b.readEventActivity(c).then(function(a){var b=a.filter(function(a){return"question-answered"===a.name||"question-answered-updated"===a.name});d.resolve(b)}),d.promise},c.getUserAnswer=function(b,d){var e=a.defer();return c.getAnswers(b).then(function(a){if(!a)return e.reject();var b=a.filter(function(a){return a.user_id===d});b.length>0?e.resolve(b[0]):e.reject()}),e.promise},c.calculateCounts=function(a){var b;return angular.forEach(a,function(a){b[a.data.answer]++}),b},c.incrementAnswerCount=function(a,b){a[b]=(a[b]||0)+1},c.calculatePercentages=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&(b+=a[c]);var d=[],e=0;for(c in a)a.hasOwnProperty(c)&&d.push({data:a[c]/b*100,label:c}),e++;return d},c}]),angular.module("com.inthetelling.story").factory("recursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("com.inthetelling.story").factory("mockSvc",["modelSvc",function(a){var b={};return b.keepJsLintHappy=function(){var b=a.episodes.noop;b=void 0},b.mockEpisode=function(b){a.cache("episode",{_id:b,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en","default":!0}],status:"Published",templateUrl:"templates/episode/middlebury.html",styles:["","",""]}),a.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var c={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:b,layouts:["",""],styles:["transitionSlideL"]},d=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/1col.html"],e=0;10>e;e++){var f=angular.copy(c);f._id="scene-"+e,f.title=e/2===Math.floor(e/2)?{en:"Scene "+(e+1)+" Title"}:{en:""},f.start_time=20*e,f.end_time=20*e+20,f.templateUrl=d[e%d.length],a.cache("event",f)}var g={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:b,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},h=["sidebarL","sidebarR","inline"],i=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(e=0;30>e;e++){var j=angular.copy(g);j._id="transcript-"+e,j.annotation={en:"Transcript block number "+(e+1)},j.start_time=5*e,j.end_time=5*e+5,j.layouts=[h[e%h.length]]}for(e=0;10>e;e++){var k=angular.copy(g);k._id="annotation-"+e,k.start_time=6*e,k.end_time=6*e+3,k.templateUrl=i[e%i.length],a.cache("event",k)}for(e=0;10>e;e++){var l=angular.copy(g);l._id="longtext-"+e,l.start_time=7*e,l.end_time=7*e+7,l.styles=["timestampNone"],l.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},l.templateUrl="templates/item/text-transmedia.html",a.cache("event",l)}a.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),a.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),a.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),a.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var m={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:b,templateUrl:"templates/item/link-withimage.html",layouts:["inline"],styles:["timestampNone"],isContent:!0};for(e=0;30>e;e++){var n=angular.copy(m);n._id="link-"+e,n.required=Math.random()>.5,n.start_time=3*e,n.end_time=3*e+3,n.layouts=[h[e%h.length]],a.cache("event",n)}var o={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:b,templateUrl:"templates/item/question-mc-formative.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:1,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a"},{text:"b"},{text:"c",correct:!0},{text:""}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(e=0;10>e;e++){var p=angular.copy(o);p._id="question-"+e,p.required=Math.random()>.5,p.start_time=5*e,p.end_time=5*e+5,p.layouts=[h[e%h.length]],a.cache("event",p)}var q={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:b,templateUrl:"templates/item/question-mc-poll.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:1,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a"},{text:"b"},{text:"c"},{text:""}],_type:"question"}}};for(e=0;10>e;e++){var r=angular.copy(q);r._id="question-"+e,r.required=Math.random()>.5,r.start_time=6*e,r.end_time=6*e+6,r.layouts=[h[e%h.length]],a.cache("event",r)}var s={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:b,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(e=0;30>e;e++){var t=angular.copy(s);t._id="upload-"+e,t.asset_id="asset2",t.title={en:"Upload number "+(e%3+1)},t.start_time=4*e,t.end_time=4*e+4,t.layouts=[h[e%h.length]],a.cache("event",t)}var u=["mainFg","altFg","videoOverlay"];for(e=0;8>e;e++){var v=angular.copy(s);v.layouts=[u[e%u.length]],v._id="filltest-"+e,v.asset_id="asset2",v.start_time=2*e,v.end_time=2*e+2,v.templateUrl="templates/item/image-fill.html",v.styles.push("cover"),a.cache("event",v)}a.resolveEpisodeEvents(b),a.resolveEpisodeAssets(b)},b}]),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type||a.templateUrl.match(/transmedia/)||b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){("Annotation"!==a._type||a.templateUrl.match(/transmedia/))&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("reviewMode",["appState",function(a){return function(b){var c=[],d="producer"===a.product;return angular.forEach(b,function(a){(d||!a.cosmetic&&(a.isContent||a.layouts.indexOf("windowFg")>-1))&&c.push(a)}),c}}]).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asBytes",function(){return function(a){if(!a)return"";var b=Math.floor(a/1024);if(1024>b)return b+"Kb";var c=Math.floor(b/10.24)/100;return c+"Mb"}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}).filter("alpha",function(){return function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[a%26]}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","$http","config","errorSvc","appState","authSvc",function(a,b,c,d,e,f){a.errorSvc=d,a.logout=f.logout,a.user=e.user,a.dismiss=function(a){for(var b=0;b<d.errors.length;b++)d.errors[b]===a&&(d.errors.splice(b,1),b=d.errors.length);for(b=0;b<d.notifications.length;b++)d.notifications[b]===a&&(d.notifications.splice(b,1),b=d.notifications.length)}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.changeSpeed=function(a){var c=d.timeMultiplier+a;.5>c&&(c=.5),c>2&&(c=2),b.setSpeed(c)},a.resetSpeed=function(){b.setSpeed(1)},a.markerPercent=function(a){return void 0===a?0:a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.toggleFullscreen=function(){e()?g():h()};var e=function(){return document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen},f=a.$watch(function(){return e()},function(a){d.isInFullscreenMode=a});a.$on("$destroy",function(){f()});var g=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},h=function(){var a=document.getElementById("CONTAINER");a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["config","$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.viewMode=function(a){h.viewMode=a,l.captureEpisodeActivity("modeChange",{mode:a}),h.producerEditLayer=0,"review"===a?(f(function(){d.$emit("magnet.jumpToMagnet")},1),h.autoscroll=!0,h.autoscrollBlocked=!1,f(A)):h.autoscroll=!1,f(function(){$(window).trigger("resize")})},e.viewMode&&f(function(){b.viewMode(e.viewMode)}),e.t&&k.seek(e.t,"URLParameter"),b.$on("$routeUpdate",function(){e.viewMode&&b.viewMode(e.viewMode),e.t&&k.seek(e.t,"URLParameter")}),b.changeProducerEditLayer=function(a){h.producerEditLayer=h.producerEditLayer+a,2===h.producerEditLayer&&(h.producerEditLayer=1),-2===h.producerEditLayer&&(h.producerEditLayer=-1)},h.init(),m.init(),h.episodeId=e.epId,j.addLandingScreen(h.episodeId),i.getEpisode(h.episodeId),n.userHasRole("admin")||"player"===h.product||c.path("/episode/"+h.episodeId);var o=b.$watch(function(){return j.episodes[h.episodeId].display_title},function(a){a&&(document.title="STORY: "+a,o())});b.loading=!0;var p=b.$watch(function(){return j.episodes[h.episodeId].items},function(a){a&&(j.addEndingScreen(h.episodeId),k.init(h.episodeId),h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,j.setLanguageStrings(),b.loading=!1,p())});b.appState=h,b.show=h.show,b.now=new Date,b.apiDataBaseUrl=a.apiDataBaseUrl,h.videoControlsActive=!1;var q,r,s=b.$watch(function(){return h.videoControlsActive},function(a){a&&(f.cancel(q),q=f(function(){r||(h.videoControlsActive=!1)},5e3))});b.$on("$destroy",function(){s()}),b.showControls=function(){f.cancel(q),h.videoControlsActive=!0,h.isTouchDevice&&b.allowControlsExit()},b.allowControlsExit=function(){f.cancel(q),q=f(function(){h.videoControlsLocked||(h.videoControlsActive=!1)},5e3)},b.toggleSearchPanel=function(){h.show.searchPanel=!h.show.searchPanel},b.toggleNavPanel=function(){k.pause(),h.show.navPanel=!h.show.navPanel},b.seek=function(a){b.enableAutoscroll(),k.seek(a,"sceneMenu"),h.show.navPanel=!1},b.pause=function(){k.pause()};var t=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(u){t=!1}t&&localStorage.removeItem("iCanHazStorage"),d.$on("video.firstPlay",function(){t&&!localStorage.getItem("noMoreHelp")?h.show.helpPanel=!0:k.play()}),b.hidePanels=function(){h.show.searchPanel=!1,h.show.helpPanel=!1,h.show.navPanel=!1,h.show.profilePanel=!1,h.itemDetail=!1,d.$emit("player.dismissAllPanels")},b.noMoreHelp=function(){h.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),k.play()},b.play=function(){k.play()},b.userHasRole=function(a){return n.userHasRole(a)},b.logout=function(){return n.logout()};var v,w=$(window),x=$("html,body"),y=function(){v=g(A,400),w.bind("scroll",function(){x.stop(),z(),h.autoscrollBlocked=!0})},z=function(){w.unbind("scroll"),g.cancel(v)};b.enableAutoscroll=function(){h.autoscrollBlocked&&(h.autoscrollBlocked=!1,y())};var A=function(){if(!h.autoscrollBlocked&&h.autoscroll){var a=1/0,b=w.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),1/0!==a){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(z(),x.animate({scrollTop:a-c},1500),f(function(){y()},1750))}}};y(),d.$on("userKeypress.ESC",b.hidePanels)}]),angular.module("com.inthetelling.story").controller("EpisodeController",function(){}),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){delete a.mainContentHasLeftSidebar,delete a.mainContentHasRightSidebar,delete a.mainContentHasBothSidebars,delete a.altContentHasLeftSidebar,delete a.altContentHasRightSidebar,delete a.altContentHasBothSidebars,a.showCurrent=$.inArray("showCurrent",a.scene.layouts)>-1,a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)};var c={ENTER:13,SPACE:32};a.seekOnKeyPress=function(b,d){var e=d,f=!0;switch(e.keyCode){case c.ENTER:a.seek(b),f=!1;break;case c.SPACE:a.seek(b),f=!1;break;default:f=!0}f||(d.stopPropagation(),d.preventDefault())}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$timeout","$interval","$window","$document","appState","timelineSvc",function(a,b,c,d,e,f,g,h){var i=document.createElement("script");i.src="//www.youtube.com/iframe_api",angular.element(f[0].head).append(i),e.onYouTubeIframeAPIReady=function(){g.youtubeIsReady=!0},b.initVideo=function(a){if(b.video.urls.youtube)if(b.videoType="youtube",g.videoType=b.videoType,b.videoNode=a.find("iframe")[0],g.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return g.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",g.videoType=b.videoType,b.videoNode=a.find("video")[0],b.initHTML5Video()},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data],"buffering"===b.playerState&&b.stall()}}});var c=b.$watch(function(){return void 0!==b.YTPlayer.playVideo},function(a){a&&(c(),b.getBufferPercent=function(){return g.bufferedPercent=100*b.YTPlayer.getVideoLoadedFraction(),g.bufferedPercent},h.registerVideo(b))})},b.initHTML5Video=function(){b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),b.changeVideoBandwidth=function(){var a=b.videoNode.currentTime;b.videoNode.pause(),b.video.urls.lowRes.mpeg4&&(b.video.urls.mpeg4=b.video.urls.lowRes.mpeg4),b.video.urls.lowRes.webm&&(b.video.urls.webm=b.video.urls.lowRes.webm),c(function(){b.videoNode.load(),b.seek(a),b.videoNode.play()})},b.babysitHTML5Video(),b.getBufferPercent=function(){if(b.videoNode.buffered.length>0){var a=b.videoNode.buffered.start(b.videoNode.buffered.length-1),c=b.videoNode.buffered.end(b.videoNode.buffered.length-1);return 0>c&&(c-=a,a=0),g.bufferedPercent=c/g.duration*100,g.bufferedPercent}return 0},h.registerVideo(b)};var j=0;b.intentionalStall=!1,b.babysitHTML5Video=function(){j=0,b.babysitter=d(function(){"playing"===g.timelineState?(b.lastPlayheadTime===b.videoNode.currentTime&&(h.stall(),b.intentionalStall||1!==j++||b.changeVideoBandwidth()),b.lastPlayheadTime=b.videoNode.currentTime):"buffering"===g.timelineState&&b.lastPlayheadTime!==b.videoNode.currentTime&&h.unstall()},333)},b.$on("$destroy",function(){d.cancel(b.babysitter),c.cancel(b.stallGracePeriod),delete b.videoNode}),b.stall=function(){if("playing"===g.timelineState){h.stall();var a=b.$watch(function(){return b.playerState},function(b){"buffering"!==b&&"waiting"!==b&&(a(),h.unstall())})}},b.play=function(){var c=a.defer();
"youtube"===b.videoType?b.YTPlayer.playVideo():b.videoNode.play();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise},b.pause=function(){"youtube"===b.videoType?(b.YTPlayer.seekTo(g.time,!0),b.YTPlayer.pauseVideo()):b.videoNode.pause();try{b.videoNode.currentTime=g.time}catch(a){}},b.seek=function(a,d){var e=!1;try{if(b.intentionalStall=!!d,"youtube"===b.videoType){var f="playing"===g.timelineState;b.YTPlayer.seekTo(a,!0),f||b.YTPlayer.pauseVideo()}else 4===b.videoNode.readyState?(b.videoNode.currentTime=a,b.stallGracePeriod=c(function(){b.intentionalStall=!1},1e3)):(b.intentionalStall=!1,c.cancel(b.stallGracePeriod),e=!0)}catch(h){b.intentionalStall=!1,c.cancel(b.stallGracePeriod),e=!0}e&&c(function(){b.seek(a)},100)},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.setSortBy=function(b){a.sortBy=b},a.toggleSortBy=function(b){a.sortBy=c(b)},a.getToggledValue=function(a){return c(a)};var c=function(a){return"startTime"===a?"type":"startTime"};a.getFriendlySortText=function(a){return"startTime"===a?"time":"type"},a.seek=function(c,d){a.enableAutoscroll(),b.seek(c,"clickedOnEventInSearch",d)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){"Scene"!==a._type&&(a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator),a.sxs&&(a.cosmetic=!1))})}}]),angular.module("com.inthetelling.story").controller("EditController",["$scope","$rootScope","appState","dataSvc","modelSvc","timelineSvc",function(a,b,c,d,e,f){a.uneditedScene=angular.copy(a.item),a.chooseAsset=function(){a.showAssetPicker=!0,a.w1=b.$on("UserSelectedAsset",function(b,c){a.selectedAsset(c)}),a.w2=b.$on("userKeypress.ESC",a.endChooseAsset)},a.selectedAsset=function(b){var c=e.assets[b];a.masterAsset=c,a.item&&(a.item.asset=c,"image"===a.item.type?a.item.asset_id=b:"link"===a.item.type?a.item.link_image_id=b:"annotation"===a.item.type&&(a.item.annotation_image_id=b)),a.episode&&"Asset::Video"===c._type&&(a.episode.master_asset_id=b),a.endChooseAsset()},a.toggleUpload=function(){a.showUpload=!a.showUpload},a.endChooseAsset=function(){a.w1(),a.w2(),a.showAssetPicker=!1},a.addDistractor=function(){a.item.data._plugin.distractors.push({text:""})},a.addEvent=function(a){var b=n(a);e.cache("event",b),c.editEvent=e.events["internal:editing"],c.videoControlsActive=!0,c.videoControlsLocked=!0,e.resolveEpisodeEvents(c.episodeId),f.injectEvents([e.events["internal:editing"]]),"scene"===a&&f.updateSceneTimes(c.episodeId)},a.saveEvent=function(){var a=angular.copy(c.editEvent);if("Scene"===a._type){var b=m(a);angular.forEach(b,function(a){d.storeItem(a).then(function(){},function(){})})}d.storeItem(a).then(function(a){"internal:editing"===c.editEvent._id&&(f.removeEvent("internal:editing"),delete e.events["internal:editing"],e.cache("event",d.resolveIDs(a)),e.resolveEpisodeEvents(c.episodeId),f.injectEvents([e.events[a._id]])),c.editEvent=!1},function(){})},a.saveEpisode=function(){var a=angular.copy(c.editEpisode);d.storeEpisode(a).then(function(a){e.cache("episode",d.resolveIDs(a)),e.deriveEpisode(e.episodes[c.episodeId]),e.resolveEpisodeContainers(c.episodeId),e.resolveEpisodeAssets(c.episodeId),c.duration=e.assets[a.master_asset_id].duration,c.editEpisode=!1,c.videoControlsLocked=!1},function(){})};var g=function(){var a=e.episodes[c.episodeId];return a.scenes},h=function(){return angular.copy(g())},i=function(a,b){for(var c=0;c<a.length;c++){if(void 0===a[c]._id||"internal:editing"===a[c]._id){a.splice(c,1);break}if(b&&a[c]._id===b._id){a[c]=b;break}}return a},j=function(a){for(var b=1,c=a.length;c-1>b;b++)a[b].end_time!==a[b+1].start_time&&(a[b].end_time=a[b+1].start_time)},k=function(a,b){for(var c=!1,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=!0;break}c||a.push(b)},l=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]._id===b){a.splice(c,1);break}},m=function(b,c){var d=h(),e=[],f=function(a,b){return a.start_time-b.start_time};c?k(d,a.uneditedScene):i(d,a.uneditedScene),d=d.sort(f),j(d),l(d,b._id),c||d.push(b),d=d.sort(f);for(var g=1;g<d.length-1;g++)d[g].end_time!==d[g+1].start_time&&(d[g].end_time=d[g+1].start_time,e.push(d[g]));return e};a.editCurrentScene=function(){angular.forEach(g(),function(a){a.isCurrent&&(c.editEvent=e.events[a._id],c.editEvent.producerItemType="scene",c.videoControlsActive=!0,c.videoControlsLocked=!0)})},a.editEpisode=function(){c.editEpisode=e.episodes[c.episodeId],c.videoControlsActive=!0,c.videoControlsLocked=!0},a.deleteEvent=function(a){if(window.confirm("Are you sure you wish to delete this item?")){var b={};b._id=a;var g=m(b,!0);angular.forEach(g,function(a){d.storeItem(a).then(function(){},function(){})});var h=e.events[a]._type;d.deleteItem(a).then(function(){"sxs"===c.product&&e.events[a].asset&&d.deleteAsset(e.events[a].asset._id),f.removeEvent(a),delete e.events[a],e.resolveEpisodeEvents(c.episodeId),"Scene"===h&&f.updateSceneTimes(c.episodeId),c.editEvent=!1,c.videoControlsLocked=!1},function(){})}},a.cancelEventEdit=function(a){"internal:editing"===c.editEvent._id?(delete e.events["internal:editing"],f.removeEvent("internal:editing")):e.events[c.editEvent._id]=a,e.resolveEpisodeEvents(a.episode_id),"Scene"===a._type?f.updateSceneTimes(a.episode_id):f.updateEventTimes(a),c.editEvent=!1,c.videoControlsLocked=!1},a.cancelEpisodeEdit=function(a){e.episodes[c.episodeId]=a,e.deriveEpisode(e.episodes[a._id]),e.resolveEpisodeContainers(a._id),e.resolveEpisodeEvents(a._id),c.editEpisode=!1,c.videoControlsLocked=!1};var n=function(a){var b={_id:"internal:editing",start_time:c.time,episode_id:c.episodeId,type:a,isCurrent:!0,producerItemType:a,layouts:["inline"],styles:[]},d={};if("scene"===a&&(d={_type:"Scene",title:{},description:{}}),"video"===a&&(d={_type:"Link",link_image_id:"",url:"",title:{},description:{}}),("comment"===a||"transcript"===a||"annotation"===a)&&(d={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:""}),("file"===a||"image"===a)&&(d={_type:"Upload",asset_id:"",title:{},description:{}}),"link"===a&&(d={_type:"Link",link_image_id:"",url:"https://",title:{},description:{}}),"question"===a&&(d={_type:"Plugin",data:{_pluginType:"question",_version:1,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{text:""},{text:""},{text:""},{text:""}],correctfeedback:"",incorrectfeedback:""}}},d.plugin=d.data._plugin),"sxs"===c.product)d.sxs=!0,d.annotator={en:"Professor Smith"},d.layouts=["windowFg"],d.end_time=c.time,d.stop=!0,d.templateUrl="templates/item/sxs-"+a+".html";else{var e={scene:"templates/scene/1col.html",transcript:"templates/item/transcript.html",annotation:"templates/item/pullquote.html",link:"templates/item/link.html",image:"templates/item/image.html",file:"templates/item/link.html",question:"templates/item/question-mc.html",video:"TODO:VIDEO"};d.templateUrl=e[a]}return angular.extend(b,d),b}}]),angular.module("com.inthetelling.story").directive("ittLogin",["$location","$routeParams","config","authSvc","appState","errorSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!1,link:function(g){g.userHasRole=d.userHasRole,g.appState=e,g.loginForm={auth_key:"",password:""},g.apiDataBaseUrl=c.apiDataBaseUrl,d.authenticate().then(function(){if(f.init(),b.key&&a.search("key",null),b.episode){var c=b.episode;a.search("episode",null),a.search("nonce",null),a.path("/episode/"+c)}else g.userHasRole("admin")&&0===Object.keys(b).length&&a.path("/")},function(){}),g.adminLogin=function(){d.adminLogin(g.loginForm.auth_key,g.loginForm.password).then(function(){},function(){g.badlogin=!0})},g.logout=function(){d.logout()}}}}]),angular.module("com.inthetelling.story").directive("autofocus",["$timeout",function(a){return{link:function(b,c){a(function(){"TEXTAREA"===c[0].tagName||"INPUT"===c[0].tagName?c[0].focus():c.find("input,textarea")[0].focus()})}}}]),angular.module("com.inthetelling.story").directive("ittMcQuestion",["questionAnswersSvc","analyticsSvc",function(a,b){return{restrict:"E",replace:!1,scope:{plugin:"=data",qid:"=",choices:"=",correct:"=",onChoice:"=",questionType:"@",showChart:"="},templateUrl:"templates/item/question-mc-inner.html",link:function(c){c.scoreQuiz=function(a){c.plugin.distractors[a].selected=!0,c.plugin.hasBeenAnswered=!0,c.plugin.selectedDistractor=a,b.captureEventActivity("question-answered",c.qid,{answer:c.plugin.distractors[a].text,correct:!!c.plugin.distractors[a].correct})};var d=function(a){return a.questiontype};c.questionType=d(c.plugin),c.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.3}}}},legend:{show:!1},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}};var e=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({data:a[c],label:c});return b};if(c.plugin.hasBeenAnswered===!0){void 0===c.plugin.answer_counts&&(c.plugin.answer_counts={},c.plugin.answer_counts[c.plugin.distractors[c.plugin.selectedDistractor].text]=1);var f=c.plugin.answer_counts,g=e(f);c.chartData=g}c.scorePoll=function(b){a.saveAnswer("question-answered",c.qid,{answer:c.plugin.distractors[b].text,correct:!!c.plugin.distractors[b].correct}).then(function(){c.plugin.answer_counts=void 0===c.plugin.answer_counts?{}:c.plugin.answer_counts,a.incrementAnswerCount(c.plugin.answer_counts,c.plugin.distractors[b].text);var d=c.plugin.answer_counts,e=a.calculatePercentages(d);c.chartData=e,c.plugin.distractors[b].selected=!0,c.plugin.hasBeenAnswered=!0,c.plugin.selectedDistractor=b})}}}}]),angular.module("com.inthetelling.story").directive("ittFlotr2Chart",function(){var a=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:' <div id="chartContainer" aria-label="{{chartLabel}}"></div>',link:function(b,c,d){var e,f=500,g=500,h=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},i=h(2,function(a,c,d){b.chartLabel=l(c),d.series.pie.label.formatter=function(a,b){return'<div style="font-size:8pt;text-align:center;padding:2px;color:black;">'+a+"<br/>"+Math.round(b.percent)+"% ("+b.data[0][1]+")</div>"},$.plot(a,c,d),a.show()});e=$("#chartContainer");var j="chartContainer"+a++;e.attr("id",j),b.width&&(f=b.width),b.height&&(g=b.height),e.css({width:f,height:g}),d.$observe("data",function(a){b.data=JSON.parse(a),i(e,b.data,b.options)}),d.$observe("options",function(a){b.options=JSON.parse(a),i(e,b.data,b.options)});var k=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].data;for(var d=0;d<a.length;d++)a[d].percent=a[d].data/b*100;return a},l=function(a){var b="";a=k(a);for(var c=0;c<a.length;c++)b+=Math.round(a[c].percent)+"% of users totaling "+a[c].data+" choose '"+a[c].label+"'. ";return b}}}}),angular.module("com.inthetelling.story").directive("ittTimeline",["$timeout","appState","timelineSvc","modelSvc",function(a,b,c,d){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(e,f){function g(a){return a>98?100:a}function h(a){return 3>a?0:a}function i(a){var b=e.currentVolume()+a;b=g(b),"function"==typeof e.setVolume&&e.setVolume(b)}function j(a){var b=e.currentVolume()-a;b=h(b),"function"==typeof e.setVolume&&e.setVolume(b)}e.appState=b,e.timeline=c,e.handlePosition=0,e.zoomLevel=1,e.zoomOffset=0;var k=f.find(".progressbarContainer"),l=f.find(".progressbar");e.appState=b,e.setNewLanguage=function(){d.setLanguageStrings()},e.showSceneMenuTooltip=function(a){e.sceneMenuToolTip=a&&!b.isTouchDevice?!0:!1},e.prevScene=function(){c.prevScene()},e.nextScene=function(){c.nextScene()},e.userChangingVolume=function(a){b.muted&&e.toggleMute();var c=angular.element(a.currentTarget),d=function(a,b){var d=(a.clientX-c.offset().left)/c.width()*100;d>98&&(d=100),3>d&&(d=0),b?e.setVolume(d):e.$apply(e.setVolume(d))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var m={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};e.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case m.LEFTARROW:j(1),c=!1;break;case m.RIGHTARROW:i(1),c=!1;break;case m.UPARROW:i(1),c=!1;break;case m.DOWNARROW:j(1),c=!1;break;case m.PAGEUP:i(10),c=!1;break;case m.PAGEDOWN:j(10),c=!1;break;case m.HOME:j(100),c=!1;break;case m.END:i(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},e.currentVolume=function(){return b.muted?0:b.volume},e.audioIcon=function(){return b.muted?"muted":"vol"+Math.floor(b.volume/34)},e.showTooltip=function(a){a.showTooltip=!0},e.hideTooltip=function(a){a.showTooltip=!1},e.zoomIn=function(){e.stopWatching=!0,e.zoomLevel=e.zoomLevel+1,n()},e.zoomOut=function(){e.stopWatching=!0,e.zoomLevel=e.zoomLevel<=2?1:e.zoomLevel<=3?1.5:e.zoomLevel/2,n()};var n=function(){e.zoomOffset=-((e.zoomLevel-1)*(b.time/b.duration)),k.stop().animate({left:100*e.zoomOffset+"%",width:100*e.zoomLevel+"%"},1e3,function(){e.stopWatching=!1})};e.$watch(function(){return{t:b.time,d:b.duration}},function(){e.stopWatching||(e.zoomOffset=-((e.zoomLevel-1)*(b.time/b.duration)),k.css({left:100*e.zoomOffset+"%"}))},!0);var o=function(c){a(function(){e.seekHandleVisible=!0},250),e.isSeeking=!0;var d=b.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(d,function(){q()}),angular.element(document).bind(d,function(){r()}),p(c)};e.$watch(function(){return b.time},function(){b.editEvent&&(e.willSeekTo=b.time)});var p=function(a){e.isSeeking&&(e.willSeekTo=(a.clientX-k.offset().left)/k.width()*b.duration,e.willSeekTo<0&&(e.willSeekTo=0),e.willSeekTo>b.duration&&(e.willSeekTo=b.duration))},q=function(){e.stopWatching=!0,e.enableAutoscroll(),c.seek(e.willSeekTo,"scrubTimeline"),n()},r=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),e.$apply(function(){e.isSeeking=!1,e.seekHandleVisible=!1})},s=function(){var a=$(f.find(".playhead"));b.isTouchDevice?(a.on("touchstart.timeline",function(a){o(a.originalEvent.targetTouches[0]),a.preventDefault()}),a.on("touchmove.timeline",function(a){p(a.originalEvent.targetTouches[0]),a.preventDefault()})):(a.on("mousedown.timeline",function(a){o(a),a.preventDefault()}),a.on("mousemove.timeline",function(a){p(a),a.preventDefault()}))};s(),e.$on("$destroy",function(){r()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["$interval","analyticsSvc","modelSvc","appState",function(a,b,c,d){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(e){e.episode=c.episodes[d.episodeId],b.captureEpisodeActivity("episodeLoad");var f=function(){e.episode=c.episodes[d.episodeId]};a(f,457)}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState","modelSvc",function(a,b,c,d){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl"></span>',controller:"SceneController",link:function(a,e){"review"!==c.viewMode&&window.scrollTo(0,0),a.precalculateSceneValues(),a.appState=c,a.scene._id.match(/internal/)&&(a.containers=d.containers,a.crossEpisodePath=c.crossEpisodePath);var f=function(){var b=e.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return e.find(".videoMagnet img").height()},function(a){a>0&&(c(),f())});else{e.find(".matchVideoHeight:visible").each(function(){$(this).css("height",e.find(".videoMagnet img").height())});var d=angular.element(window).height()-$("#CONTAINER").scrollTop();e.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",d-$(this).offset().top)}),e.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",d-$(this).offset().top-210)})}e.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&f()},!0),a.unwatchEdits=a.$watch(function(){return c.editEvent},a.precalculateSceneValues,!0),a.safetyBelt=b(f,1321),a.$on("$destroy",function(){a.unwatch(),a.unwatchEdits(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittShowHideVisualOnly",["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ittShowHideVisualOnly,function(b){b?a.removeClass(c,"visual-hide"):a.addClass(c,"visual-hide")})}}}]),angular.module("com.inthetelling.story").animation(".visual-hide",function(){return{addClass:function(a){a.fadeTo("slow",0,function(){})},removeClass:function(a){a.fadeTo("slow",1,function(){})}}}),angular.module("com.inthetelling.story").directive("ittShowFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.ittShowFocus,function(b){a(function(){b&&c.filter(":visible").first().focus()})},!0)}}]),angular.module("com.inthetelling.story").directive("ittVolumeSlider",["appState",function(a){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(b){function c(a){return a>98?100:a}function d(a){return 3>a?0:a}function e(a){var d=b.currentVolume()+a;d=c(d),"function"==typeof b.setVolume&&b.setVolume(d)}function f(a){var c=b.currentVolume()-a;c=d(c),"function"==typeof b.setVolume&&b.setVolume(c)}b.appState=a,b.userChangingVolume=function(a){var c=angular.element(a.currentTarget),d=function(a,d){var e=(a.clientX-c.offset().left)/c.width()*100;e>98&&(e=100),3>e&&(e=0),d?b.setVolume(e):b.$apply(b.setVolume(e))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var g={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};b.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case g.LEFTARROW:f(1),c=!1;break;case g.RIGHTARROW:e(1),c=!1;break;case g.UPARROW:e(1),c=!1;break;case g.DOWNARROW:f(1),c=!1;break;case g.PAGEUP:e(10),c=!1;break;case g.PAGEDOWN:f(10),c=!1;break;case g.HOME:f(100),c=!1;break;case g.END:e(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},b.currentVolume=function(){return a.muted?0:a.volume}}}}]),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=400>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittReviewMode",["appState","$timeout",function(a,b){return{restrict:"A",replace:!1,scope:{allScenes:"=ittReviewMode"},templateUrl:"templates/episode/components/reviewmode-scenes.html",link:function(c){c.appState=a,c.scenes=[];var d=100,e=0;c.isLoading=!0;var f=[1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1/0];c.addOne=function(){if(e++,c.allScenes)c.scenes=c.allScenes.slice(0,f[e]),e<c.allScenes.length?b(c.addOne,d):(c.isLoading=!1,c.scenes=c.allScenes);else var a=c.$watch(function(){return c.allScenes},function(){c.allScenes&&(a(),c.addOne())})},b(c.addOne,d)}}}]),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","$interval","config","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g,h){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(i,j){i.toggleDetailView=function(){i.item.showInlineDetail?i.item.showInlineDetail=!1:(g.pause(),i.captureInteraction(),j.width()>400?i.item.showInlineDetail=!0:e.itemDetail=i.item)};var k={ENTER:13,SPACE:32};if(i.toggleDetailOnKeyPress=function(a){var b=a,c=!0;switch(b.keyCode){case k.ENTER:i.toggleDetailView(),c=!1;break;case k.SPACE:i.toggleDetailView(),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},i.forceModal=function(){g.pause(),e.itemDetail=i.item},i.outgoingLinkOnKeyPress=function(a,b){var c=b,d=!0;switch(c.keyCode){case k.ENTER:i.outgoingLink(a),d=!1;break;case k.SPACE:i.outgoingLink(a),d=!1;break;default:d=!0}d||(b.stopPropagation(),b.preventDefault())},i.outgoingLink=function(a){g.pause(),i.captureInteraction(),i.item.targetTop?b(function(){window.location.href=a}):window.open(a)},i.editItem=function(){e.editEvent=i.item,e.videoControlsActive=!0,e.videoControlsLocked=!0},i.captureInteraction=function(){f.captureEventActivity("clicked",i.item._id)},"templates/item/link-embed.html"===i.item.templateUrl&&i.captureInteraction(),i.item.asset_id&&!i.item.asset&&(i.item.asset=h.assets[i.item.asset_id]),i.item.styleCss&&i.item.styleCss.match(/fill|contain|cover/)&&(i.item.asset.cssUrl="url('"+i.item.asset.url+"');",i.item.backgroundImageStyle="background-image: url('"+i.item.asset.url+"');"),i.item.data&&(i.plugin=i.item.data._plugin,i.plugin._type=i.item.data._pluginType,"question"===i.plugin._type&&(i.scorePoll=function(){i.plugin.distractors[i.plugin.selectedDistractor].selected=!0,i.plugin.hasBeenAnswered=!0,f.captureEventActivity("question-answered",i.item._id,{answer:i.plugin.distractors[i.plugin.selectedDistractor].text,correct:!!i.plugin.distractors[i.plugin.selectedDistractor].correct})},i.resetQuestion=function(){i.plugin.selectedDistractor=void 0,i.plugin.hasBeenAnswered=!1;for(var a=0;a<i.plugin.distractors.length;a++)i.plugin.distractors[a].selected=!1}),"credlyBadge"===i.plugin._type)){f.captureEventActivity("viewed",i.item._id),e.user.roles&&1===e.user.roles.length&&"guest"===e.user.roles[0]?i.plugin.eligibleForBadges=!1:(i.plugin.eligibleForBadges=!0,i.plugin.userEmail=e.user.emails?e.user.emails[0]:"",i.plugin.totalAchieved=0),i.checkBadgeEligibility=function(){i.plugin.eligibleForBadges&&angular.forEach(i.plugin.requirements,function(a){a.achieved||f.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,i.countAchievements()}),i.countAchievements()})},i.countAchievements=function(){var a=0;angular.forEach(i.plugin.requirements,function(b){b.achieved&&(a+=1)}),i.plugin.totalAchieved=a,i.plugin.totalAchieved===i.plugin.requirements.length&&(h.episodes[e.episodeId].styleCss=h.episodes[e.episodeId].styleCss+" uscHackUserHasBadge")},i.checkBadgeEligibility();var l=0;i.badgePoll=c(function(){l++,(i.item.isCurrent||"review"===e.viewMode)&&i.checkBadgeEligibility(),l>60&&c.cancel(i.badgePoll)},1e4),i.$on("$destroy",function(){c.cancel(i.badgePoll)}),i.badger=function(){i.plugin.gettingBadge=!0,a({method:"GET",url:d.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+i.plugin.credlyBadgeId+"&email="+i.plugin.userEmail}).success(function(a){i.checkBadgeEligibility(),"Badge previously sent."===a.status&&(i.plugin.alreadyHadBadge=!0),i.plugin.gotBadge=!0}).error(function(){i.plugin.gettingBadge=!1,i.plugin.error=!0})}}}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",["appState",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeEditor",["$rootScope","appState","modelSvc","dataSvc","awsSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:{episode:"=ittEpisodeEditor"},templateUrl:"templates/producer/episode.html",controller:"EditController",link:function(f){if(f.episodeContainerId=c.episodes[b.episodeId].container_id,f.episode.master_asset_id&&""!==f.episode.master_asset_id&&(f.masterAsset=c.assets[f.episode.master_asset_id]),f.uploadStatus=[],f.uneditedEpisode=angular.copy(f.episode),f.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:""},f.episode.styles)for(var g in f.itemForm)for(var h=0;h<f.episode.styles.length;h++)f.episode.styles[h].substr(0,g.length)===g&&(f.itemForm[g]=f.episode.styles[h].substr(g.length));f.langForm={};for(var i=0;i<f.episode.languages.length;i++)f.langForm[f.episode.languages[i].code]=!0;f.langForm[f.episode.defaultLanguage]=!0,f.languageWatcher=f.$watch(function(){return[f.langForm,f.episode.defaultLanguage]},function(){var a=0,b="",c=[];for(var d in f.langForm)f.langForm[d]?(a++,b=d,c.push({code:d})):f.episode.defaultLanguage===d&&(f.episode.defaultLanguage=!1);f.languageCount=a,f.episode.defaultLanguage===!1&&(f.episode.defaultLanguage=b),angular.forEach(c,function(a){a.code===f.episode.defaultLanguage&&(a.default=!0)}),f.episode.languages=angular.copy(c)},!0),f.watchStyleEdits=f.$watch(function(){return f.itemForm},function(){var a=[];for(var b in f.itemForm)f.itemForm[b]&&a.push(b+f.itemForm[b]);f.episode.styles=a,c.deriveEpisode(f.episode),c.resolveEpisodeEvents(f.episode._id)},!0),f.appState=b,f.watchEdits=f.$watchGroup(["episode.templateUrl","episode.title[appState.lang]","episode.description[appState.lang]","episode.navigation_depth"],function(a,b){if(a[0]!==b[0]){var d=[];if(b[0]){var e=b[0].match("templates/episode/(.*).html")[1];angular.forEach(f.episode.styles,function(a){a.toLowerCase()!=="color"+e&&a.toLowerCase()!=="typography"+e&&d.push(a)})}var g=a[0].match("templates/episode/(.*).html")[1];angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(a){g===a&&(d.push("color"+a[0].toUpperCase()+a.substring(1)),d.push("typography"+a[0].toUpperCase()+a.substring(1)))}),f.episode.styles=angular.copy(d)}c.deriveEpisode(f.episode),c.resolveEpisodeContainers(f.episode._id),c.resolveEpisodeEvents(f.episode._id)}),f.dismissalWatcher=a.$on("player.dismissAllPanels",f.cancelEdit),f.cancelEdit=function(){f.cancelEpisodeEdit(f.uneditedEpisode)},f.detachMasterAsset=function(){f.episode.master_asset_id=null,f.masterAsset={},b.duration=0,d.detachMasterAsset(f.episode),c.deriveEpisode(f.episode),c.resolveEpisodeContainers(f.episode._id),c.resolveEpisodeAssets(f.episode._id)},f.setMasterAsset=function(a){f.episode.template_id||(f.episode.templateUrl="templates/episode/episode.html"),f.episode.master_asset_id=a._id,f.masterAsset=a,b.duration=c.assets[f.episode.master_asset_id].duration,d.storeEpisode(f.episode),c.deriveEpisode(f.episode),c.resolveEpisodeContainers(f.episode._id),c.resolveEpisodeAssets(f.episode._id)},f.uploadAsset=function(a){f.uploads=e.uploadFiles(a),f.uploads[0].then(function(a){c.cache("asset",a.file);var b=c.assets[a.file._id];f.setMasterAsset(b),delete f.uploads},function(){},function(a){f.uploadStatus[0]=a})},f.deleteAsset=function(){},f.detachAsset=function(){f.detachMasterAsset(),f.showUpload=!1},f.$on("$destroy",function(){f.watchEdits(),f.dismissalWatcher(),f.languageWatcher(),f.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittItemEditor",["$rootScope","appState","modelSvc","timelineSvc","awsSvc","dataSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/producer/item.html",controller:"EditController",link:function(g){if(g.uploadStatus=[],g.uneditedItem=angular.copy(g.item),g.annotators=c.episodes[b.episodeId].annotators,g.episodeContainerId=c.episodes[b.episodeId].container_id,g.languages=c.episodes[b.episodeId].languages,g.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:"",position:"",pin:""},g.item.layouts||(g.item.layouts=["inline"]),g.item.styles){for(var h in g.itemForm)for(var i=0;i<g.item.styles.length;i++)g.item.styles[i].substr(0,h.length)===h&&(g.itemForm[h]=g.item.styles[i].substr(h.length));for(var j=0;j<g.item.styles.length;j++)("contain"===g.item.styles[j]||"cover"===g.item.styles[j]||"center"===g.item.styles[j]||"fill"===g.item.styles[j])&&(g.itemForm.position=g.item.styles[j]),("tl"===g.item.styles[j]||"tr"===g.item.styles[j]||"bl"===g.item.styles[j]||"br"===g.item.styles[j])&&(g.itemForm.pin=g.item.styles[j])}g.itemEditor="templates/producer/item/"+b.product+"-"+g.item.producerItemType+".html",g.appState=b,g.watchEdits=g.$watch(function(){return g.item},function(){g.item.yturl&&(g.item.url=k(g.item.yturl)),c.resolveEpisodeEvents(b.episodeId),c.cache("event",g.item),g.item.asset&&(g.item.asset.cssUrl="url('"+g.item.asset.url+"');",g.item.backgroundImageStyle="background-image: url('"+g.item.asset.url+"');")},!0),g.watchStyleEdits=g.$watch(function(){return g.itemForm},function(){var a=[];for(var b in g.itemForm)g.itemForm[b]&&a.push("position"===b||"pin"===b?g.itemForm[b]:b+g.itemForm[b]);g.item.styles=a,g.item.asset&&(g.item.asset.cssUrl="url('"+g.item.asset.url+"');",g.item.backgroundImageStyle="background-image: url('"+g.item.asset.url+"');")},!0),g.forcePreview=function(){b.editEvent.fnord=b.editEvent.fnord?"":"fnord"},g.setItemTime=function(){"Scene"===g.item._type?(c.resolveEpisodeEvents(b.episodeId),d.updateSceneTimes(g.item.episode_id)):g.item.stop?(g.item.end_time=g.item.start_time,c.resolveEpisodeEvents(b.episodeId),d.updateEventTimes(g.item)):(c.resolveEpisodeEvents(b.episodeId),(g.item.end_time<=g.item.start_time||g.item.end_time>c.events[g.item.scene_id].end_time)&&(g.item.end_time=c.events[g.item.scene_id].end_time),d.updateEventTimes(g.item))},g.setItemEndTime=function(){(g.item.end_time<=g.item.start_time||g.item.end_time>c.events[g.item.scene_id].end_time)&&(g.item.end_time=c.events[g.item.scene_id].end_time),d.updateEventTimes(g.item)},g.dismissalWatcher=a.$on("player.dismissAllPanels",g.cancelEdit),g.cancelEdit=function(){g.cancelEventEdit(g.uneditedItem)};var k=function(a){var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b);return c?"//www.youtube.com/embed/"+c[1]:""};g.uploadAsset=function(a){g.uploads=e.uploadFiles(a),g.uploads[0].then(function(a){c.cache("asset",a.file),g.item.asset=c.assets[a.file._id],"Upload"===g.item._type?g.item.asset_id=a.file._id:"Link"===g.item._type?g.item.link_image_id=a.file._id:"Annotation"===g.item._type&&(g.item.annotation_image_id=a.file._id),delete g.uploads},function(){},function(a){g.uploadStatus[0]=a})},g.deleteAsset=function(a){window.confirm("Are you sure you wish to delete this asset?")&&(delete c.events[g.item._id].asset,delete g.item.asset_id,delete c.events[g.item._id].asset_id,delete g.item.link_image_id,delete c.events[g.item._id].link_image_id,delete g.item.annotation_image_id,delete c.events[g.item._id].annotation_image_id,delete g.item.asset,f.deleteAsset(a))},g.detachAsset=function(a){a&&(delete c.events[g.item._id].asset,delete g.item.asset,delete g.item.asset_id,delete g.item.link_image_id,delete g.item.annotation_image_id,g.showUpload=!1)},g.$on("$destroy",function(){g.watchEdits(),g.dismissalWatcher(),g.watchStyleEdits()
})}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$interval","$rootScope","appState","timelineSvc",function(a,b,c,d,e){var f=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(g,h){g.appState=d,g.uid=++f,a(function(){if(g.video)g.initVideo(h);else var a=g.$watch(function(){return g.video},function(b){b&&(a(),g.initVideo(h))})}),g.videoClick=function(){"paused"===d.timelineState?e.play():e.pause()},g.spaceWatcher=c.$on("userKeypress.SPACE",g.videoClick),g.bufferInterval=b(function(){if(g.getBufferPercent){var a=g.getBufferPercent();a>98&&(b.cancel(g.bufferInterval),d.bufferedPercent=100)}},200),g.$on("$destroy",function(){g.spaceWatcher(),b.cancel(g.bufferInterval)})}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.ceil(Math.abs(c)>4?e.width()+c/4:d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))})};a.$on("magnet.changeMagnet",function(a,b){g(b)});var i=function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute"),e.offset(d.magnet.offset()),e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))};a.$on("magnet.jumpToMagnet",i),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.unwatchVisibility=b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),"watchModeVideoMagnet"===c.attr("id")&&(b.unwatchSize=b.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:c.is(":visible")}},function(){var b=angular.element(window),d=b.height()-46;c.width(b.width()/d>16/9?16/9*d:b.width()),a.$emit("magnet.changeMagnet",c)},!0)),b.$on("$destroy",function(){b.unwatchVisibility(),b.unwatchSize&&b.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.indexEvents()}}}),angular.module("com.inthetelling.story").directive("ittContainer",["$timeout","$location","$route","appState","modelSvc","recursionHelper","dataSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{container:"=ittContainer",depth:"=depth"},templateUrl:"templates/container.html",compile:function(c){return f.compile(c,function(c){c.appState=d,c.containers=e.containers,c.isDemoServer=b.host().match(/demo|localhost|api-dev|client.dev/),c.containerTypes=["customer","course","session","episode"],c.toggleChildren=function(){c.container.children?c.container.showChildren=!c.container.showChildren:g.getSingleContainer(c.container._id).then(function(a){c.container=e.containers[a],c.container.showChildren=!0})},c.addEpisode=function(){var a={customer_id:c.container.customer_id,parent_id:c.container._id,name:{en:c.container.newEpisodeTitle}};g.createContainer(a).then(function(a){var b={container_id:a._id,title:{en:c.container.newEpisodeTitle}};g.createEpisode(b).then(function(){})}),c.container.addingEpisode=!1},c.deleteEpisodeAndContainer=function(b){var c=e.containers[b],d=c.parent_id?c.parent_id:c.ancestry.replace(/.*\//,""),f=e.containers[d],h=[];angular.forEach(f.children,function(a){a._id!==b&&h.push(a)}),f.children=h,c.episodes.length?g.deleteEpisode(c.episodes[0]).then(function(){a(function(){g.deleteContainer(c._id)},250)}):g.deleteContainer(c._id)}})}}}]),angular.module("com.inthetelling.story").directive("ittContainerEpisodes",["modelSvc","recursionHelper","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{container:"=ittContainerEpisodes"},templateUrl:"templates/containerepisodes.html",compile:function(d){return b.compile(d,function(b){b.containers=a.containers,b.crossEpisodePath=c.crossEpisodePath,b.episodeId=c.episodeId})}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeList",["$location","$timeout","appState","authSvc","dataSvc","modelSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,link:function(a){a.logout=function(){d.logout()},a.appState=c,a.loading=!0,a.containers=f.containers,a.userHasRole=d.userHasRole,e.getContainerRoot().then(function(b){a.root={children:[]},angular.forEach(b,function(b){f.containers[b].showChildren=!0,a.root.children.push(f.containers[b])}),a.loading=!1},function(){a.failedLogin=!0,a.loading=!1})}}}]),angular.module("com.inthetelling.story").controller("UploadController",["$scope","config","awsSvc",function(a,b,c){a.loading=!0,c.getBucketListing().then(function(b){a.bucket_objects=b.Contents,a.loading=!1}),a.loading=!0,c.getMultipartUploads().then(function(b){a.uploads_in_progress=b,a.upload_parts=[];for(var d=0;d<b.Uploads.length;d++)c.getMultipartUploadParts(d,b.Uploads[d]).then(function(b){a.upload_parts[b.i]=b.parts,a.loading=!1})}),a.uploadFiles=function(){a.upload_status=[],a.uploads=c.uploadFiles(document.getElementById("file").files);for(var b in a.uploads)!function(b){var c=a.uploads[b];c.then(function(b){a.upload_result=b},function(){},function(c){a.upload_status[b]=c})}(b)},a.pauseUpload=function(){c.pauseUpload()},a.resumeUpload=function(){c.resumeUpload()},a.cancelUpload=function(){c.cancelUpload()},a.networkError=function(){c.networkError()},a.deleteObject=function(a){c.deleteObject(a)},a.cancelMultipartUpload=function(a){c.cancelMultipartUpload(a)}}]),angular.module("com.inthetelling.story").directive("sxsAddContent",["appState",function(a){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/producer/addcontent.html",controller:"EditController",link:function(b){b.appState=a,b.expand=function(){b.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){b.collapse()})},b.collapse=function(){b.expanded=!1}}}}]),angular.module("com.inthetelling.story").directive("sxsInputTime",["appState",function(a){return{require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){var c;if(void 0===b||""===b)c=a.time;else if(isNaN(b)){var d=b.split(":");2===d.length?(isNaN(d[0])&&(d[0]=0),isNaN(d[1])&&(d[1]=0),c=60*+d[0]+ +d[1]):c=a.time}else c=b;return.01>c&&(c=.01),c}),e.$formatters.push(function(a){var b=Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2),c=(a+"").slice(4,6);return""!==c&&(b=b+"."+c),b})}}}]),angular.module("com.inthetelling.story").directive("sxsAnnotatorAutocomplete",["modelSvc","$timeout","appState",function(a,b,c){return{require:"ngModel",templateUrl:"templates/producer/annotator-autocomplete.html",scope:{annotators:"=sxsAnnotatorAutocomplete",item:"=item"},link:function(d,e,f,g){d.appState=c,d.hasAnnotator=function(){return Object.keys(d.item.annotator).length>0},angular.forEach(d.annotators,function(b){b.annotation_image_id&&(b.imageUrl=a.assets[b.annotation_image_id].url)}),d.annotator={name:d.item.annotator},d.annotators[d.item.annotator]&&d.annotators[d.item.annotator].annotation_image_id&&(d.annotator.imageUrl=a.assets[d.annotators[d.item.annotator].annotation_image_id].url),d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1,e.find(".annotatorChooser").bind("keydown",function(a){switch(a.which){case 40:d.preselectedItem=(d.preselectedItem+1)%Object.keys(d.filteredAnnotators).length;break;case 38:d.preselectedItem=(d.preselectedItem-1)%Object.keys(d.filteredAnnotators).length;break;case 13:a.preventDefault(),d.preselectedItem>-1&&d.selectByIndex(d.preselectedItem)}}),d.handleAutocomplete=function(){if(d.annotator.name="",d.searchText){d.preselectedItem=-1;var a={};angular.forEach(d.annotators,function(b){b.key.toLowerCase().indexOf(d.searchText.toLowerCase())>-1&&(a[b.key]=b)}),d.filteredAnnotators=a,1===Object.keys(d.filteredAnnotators).length&&(d.preselectedItem=0)}else d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1},d.selectByIndex=function(a){if(!(0>a)){var b=Object.keys(d.filteredAnnotators).sort();d.select(d.filteredAnnotators[b[a]])}},d.select=function(b){d.preselectedItem=-1,b.annotation_image_id?(d.item.annotation_image_id=b.annotation_image_id,d.item.asset=a.assets[b.annotation_image_id],d.annotator.imageUrl=d.item.asset.url):(delete d.annotator.imageUrl,delete d.item.asset),g.$setViewValue(b.name),d.searchText=""},d.autoCompleting=!1,d.showAutocomplete=function(){var a=e.find(".annotatorChooser")[0];a.setSelectionRange(0,a.value.length),d.autoCompleting=!0},d.hideAutocomplete=function(){b(function(){d.preselectedItem>-1?d.selectByIndex(d.preselectedItem):""!==d.searchText&&d.addNewAnnotator(),d.autoCompleting=!1},300)},d.addNewAnnotator=function(){var a=d.searchText;d.item.annotator={},d.item.annotator[c.lang]=a,d.searchText="",d.handleAutocomplete()},d.uploadAnnotatorImage=function(){window.alert("TODO")}}}}]),angular.module("com.inthetelling.story").directive("sxsInputI18n",["appState",function(a){return{templateUrl:"templates/producer/inputi18n.html",scope:{field:"=sxsInputI18n",inputtype:"=inputtype"},link:function(b){b.appState=a}}}]),angular.module("com.inthetelling.story").directive("ittTabs",function(){return{restrict:"A",replace:!0,link:function(a,b){a.tabs=[];for(var c=!1,d=b.find(".ittTab"),e=0;e<d.length;e++)a.tabs[e]=$(d[e]).hasClass("cur"),a.tabs[e]&&(c=!0);c||(a.tabs[0]=!0),a.tab=function(b){for(var c=0;c<d.length;c++)a.tabs[c]=!1;a.tabs[b]=!0}}}}).directive("ittTab",function(){return{restrict:"A",replace:!1,transclude:!0,scope:{isCur:"=ittTab"},template:'<div><div class="ittTabLabel" ng-class="{cur: isCur}"><a ng-click="$parent.tab(tabindex)">{{tablabel}}</a></div><div class="ittTabContents" ng-show="isCur" ng-transclude></div></div>',link:function(a,b,c){a.tablabel=c.tablabel,a.tabindex=c.tabindex}}}),angular.module("com.inthetelling.story").controller("ContainerAssetsTestController",["$scope","$routeParams",function(a,b){a.containerId=b.containerId}]).directive("sxsContainerAssets",["$routeParams","$rootScope","recursionHelper","dataSvc","modelSvc",function(a,b,c,d,e){return{restrict:"A",replace:!1,scope:{containerId:"=sxsContainerAssets"},templateUrl:"templates/producer/container-assets.html",compile:function(a){return c.compile(a,function(a){e.containers[a.containerId]?e.containers[a.containerId].assetsHaveLoaded||d.getContainerAssets(a.containerId):d.getContainer(a.containerId),a.container=e.containers[a.containerId],a.assets=e.assets,a.up=function(){a.showParent=!0},a.toggleImages=function(){a.onlyImages=!a.onlyImages},a.toggleGrid=function(){a.gridView=!a.gridView},a.assetClick=function(a){b.$emit("UserSelectedAsset",a)}})}}}]);