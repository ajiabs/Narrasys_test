"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/error",{controller:"UIErrorController",templateUrl:"templates/error.html"}).when("/episode/:epId",{controller:"EpisodeController",template:'<div ng-include="episode.templateUrl">Loading Episode...</div>'}).otherwise({redirectTo:"/error"})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/danielbeck.net/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop" ng-click="close($event)"></div>'),a.put("template/modal/window.html",'<div class="modal {{windowClass}}" ng-transclude></div>'),a.put("templates/contentpane.html",'<!-- \n	TODO:  item.styles is on both the ng-repeat and on the item. Harmless, but redundant.\n	Need it on the ng-repeat for animations; check to see if we can remove it from the item\n	(will definitely require edits to item.css, maybe elsewhere?)\n\n-->\n\n<div class="content" x-ng-class=\'{"noSidebars": noSidebars, "hasLeftSidebar": hasLeftSidebar, "hasRightSidebar": hasRightSidebar}\'>\n	<h2 x-ng-if="pane == \'main\'" class="sceneTitle">{{scene.title}}</h2>\n	<span x-ng-if="showCurrent">\n			<div x-ng-repeat="item in itemlist | filter:{isActive:true}" \n					class="item-animate" \n					x-ng-class="item.styles"\n					data-force-item-template="{{forceItemTemplate}}" \n					x-itt-item="item">\n			</div>\n	</span>\n	<span x-ng-if="!showCurrent">\n			<div x-ng-repeat="item in itemlist" \n					class="item-no-animate" \n					x-ng-class="item.styles"\n					data-force-item-template="{{forceItemTemplate}}" \n					x-itt-item="item">\n			</div>\n	</span>\n</div>\n'),a.put("templates/episode-default.html",'<div class="{{episode.styles}}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper"></div>\n	<div x-itt-search-panel ng-show="show.searchPanel"></div>\n	<div x-itt-navigation-panel ng-show="show.navigationPanel"></div>\n	<div x-itt-toolbar></div>\n	<div class="episode episode{{episode.layout}}">\n		<!-- TODO <div class="scene sceneintro"></div> -->\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<!-- TODO <div class="scene sceneoutro"></div> -->\n	</div>\n</div>\n\n<div id="footertrigger"><!-- TODO tap/hover event to force video nav to show --></div>\n'),a.put("templates/error.html","<h2>Oops!</h2>\n<p>{{errorMsg}}</p>"),a.put("templates/modal-link-default.html",'<div>\n	<a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n	<iframe src="{{item.source}}" width="100%" height="100%"></iframe>\n</div>\n'),a.put("templates/overlays/navigationPanel.html",'<div class="sidePanelInner colorInvert {{episode.styles}}">\n	<h2>{{episode.title}}</h2>\n	<div class="scene" ng-repeat="scene in scenes">\n		<span class="displayTime">{{scene.displayTime}}</span> <a href="javascript:void 1" ng-click="gotoScene(scene)">{{scene.title}}</a><br>\n		<p>{{scene.description}}</p>\n	</div>\n</div>\n\n<!-- TOTAL GODAWFUL HACK JUST FOR DEMO code not meant for real life -->\n<!--\n<div class="dev" style="position:absolute; bottom: 0">\n\n	<select class="epstylepart" size="1" onchange="hack()">\n		<option value="">Typography:</option>\n		<option value="typographySerif">Serif</option>\n		<option value="typographySans">Sans</option>\n		<option value="typographyBook">Book</option>\n		<option value="typographySwiss">Swiss</option>\n	</select>\n	<select class="epstylepart" size="1" onchange="hack()">\n		<option value="">Color:</option>\n		<option value="colorInvert">Invert</option>\n		<option value="colorSepia">Sepia</option>\n		<option value="colorSolarized">Solarized</option>\n		<option value="colorVivid">Vivid</option>\n</select>\n	<select class="epstylepart" size="1" onchange="hack()">\n		<option value="">Highlight:</option>\n<option value="highlightSolid">Solid</option>\n<option value="highlightBorder">Border</option>\n<option value="highlightSide">Side</option>\n<option value="highlightHighlighter">Highlighter</option>\n<option value="highlightTilt">Tilt</option>\n<option value="highlightBloom">Bloom</option>\n</select>\n	<select class="epstylepart" size="1" onchange="hack()">\n		<option value="">Timestamp:</option>\n<option value="timestampDefault">Default</option>\n<option value="timestampNone">None</option>\n<option value="timestampSmall">Small</option>\n<option value="timestampInline">Inline</option>\n<option value="timestampSidebar">Sidebar</option>\n</select>\n\n	<input class="epstyle" type="text" ng-model="episode.styles" style="visibility:hidden">\n</div>\n\n<script language="javascript"><!--\nfunction hack() {\n	var s = "";\n	$(\'.epstylepart\').each(function() {\n		s = s + " " + $(this).val()\n	});\n'+"	$('.epstyle').val(s).trigger('input');\n}\n-->\n<!-- END GODAWFUL DEMO HACK -->\n"),a.put("templates/overlays/searchPanel.html",'<div class="sidePanelInner {{episode.styles}}">\n	<div class="filters">\n		<dl>\n			<dt>Search:</dt>\n			<dd>\n				<input id="searchtext" type="text" ng-model="searchText" />\n			</dd>\n<!--\nTODO: bring this back when we implement categories (and use the episode\'s categories to build the list of options)\n			<dt>Types:</dt>\n			<dd>\n				<label><input type="checkbox" id="searchalltypes" checked="checked"><span> All transmedia types</span></label>\n				<div id="searchtypes" class="accordion">\n					<label><input type="checkbox" name="searchcategory" id="searchtype-transcript" ng-model="searchTypes.annotation"><span> {{prettyTypeMap[\'annotation\']}}</span></label>\n					<label><input type="checkbox" name="searchcategory" id="searchtype-links" ng-model="searchTypes.link"><span> {{prettyTypeMap[\'link\']}}</span></label>\n					<label><input type="checkbox" name="searchcategory" id="searchtype-slides" ng-model="searchTypes.slide"><span> {{prettyTypeMap[\'slide\']}}</span></label>\n					<label><input type="checkbox" name="searchcategory" id="searchtype-in_depth" ng-model="searchTypes.indepth"><span> {{prettyTypeMap[\'indepth\']}}</span></label>\n					<label><input type="checkbox" name="searchcategory" id="searchtype-projects" ng-model="searchTypes.project"><span> {{prettyTypeMap[\'project\']}}</span></label>\n					<label><input type="checkbox" name="searchcategory" id="searchtype-discussions" ng-model="searchTypes.discussion"><span> {{prettyTypeMap[\'discussion\']}}</span></label>\n				</div>\n			</dd>\n			\n\n-->\n			<dt>Sort by:</dt>\n			<dd>\n				<select id="searchsort" size="1" ng-model="sortBy">\n					<option value="startTime">Time</option>\n					<option value="type">Type</option>\n				</select>\n			</dd>\n		</dl>\n	</div>\n	<div class="scrollContainer">\n		<div class="searchResults">\n		<!-- TODO:\n			- Wire up all types checkbox\n			- Check ordering in items by type\n			- Hide type header when no child items are visible\n		-->\n			<!-- sorted by start time -->\n			<div ng-if="sortBy == \'startTime\'">\n				<div ng-repeat="scene in scenes">\n					<h3>{{scene.title}}</h3>\n					<div class="item" ng-repeat="item in scene.items | orderBy:\'startTime\' | filter:searchText | type:searchTypes">\n						<span class="displayTime"><a href="javascript:void 1" ng-click="gotoItem(item)">{{item.displayTime}}</a></span> <span class="type">({{prettyTypeMap[item.type]}})</span>\n						<div class="description">{{item.description || item.annotation}}</div>\n					</div>\n				</div>\n			</div>\n	\n			<!-- sorted by type -->\n			<div ng-if="sortBy == \'type\'">\n				<div class="sortedbytype" ng-repeat="(type, items) in allItemsByType | orderBy:\'type\'" ng-if="searchTypes[type]">\n					<h3>{{prettyTypeMap[type]}}</h3>\n					<div class="item" ng-repeat="item in items | orderBy:\'startTime\' | type:searchTypes | filter:searchText">\n						<span class="displayTime"><a href="javascript:void 1" ng-click="gotoItem(item)">{{item.displayTime}}</a></span> <span class="type">({{prettyTypeMap[item.type]}})</span>\n						<div class="description">{{item.description || item.annotation}}</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene-1col.html",'<div class="scene-1col {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif"/></div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n\n\n\n\n\n\n'),a.put("templates/scene-2colL.html",'<div class="scene-2col scene-2colL {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /></div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-2colR.html",'<div class="scene-2col scene-2colR {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /></div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-centered.html",'<div class="scene-centered {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif"/></div>\n		</div>\n		<div class="centeredVideoPad matchVideoHeight"></div>\n		<div class="pane contentMain stretchToViewportBottom">\n				<div class="fillPane paneBg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n				</div>\n				<div data-no-sidebars="true" data-show-current="true" data-content="content" x-itt-content-pane></div>\n				<div class="fillPane paneFg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n				</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerH.html",'<div class="scene-cornerH {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /></div>\n		</div>\n		<div class="pane contentMain matchVideoHeight">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerV.html",'<!--\nfillPane windowBg\nscene\n	title\n	pane videoContainer\n		video\n	pane contentMain\n		fillPane paneBg\n		content\n		fillPane paneFg\n	pane contentAlt\n		fillPane paneBg\n		content\n		fillPane paneFg\nvideoOverlay\nfillPane windowFg\n-->\n<div class="scene-cornerV {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="scene-cornerV-column stretchToViewportBottom">\n			<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /></div>\n		</div>\n			<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-explore.html",'<!-- TODO: on enter need to scroll directly to current scene if it\'s not scene 1 -->\n\n<div class="scene-explore {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n\n	<div class="scene">\n		<div class="pane videoContainer">\n			<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /></div>\n		</div>\n		<div class="pane contentMain">\n			<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n		</div>\n		<div class="pane contentAlt">\n			<div ng-if="scene.startTime == 0" class="matchVideoHeight">\n				<!-- in explore view, need to pad the first scene to make room for the video -->\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-video.html",'<div class="scene-video {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div style="position:relative; background-color: #000 !important">\n			<div class="pane showCurrent contentAlt timestampNone">\n				<div class="content noSidebars">\n					<div data-force-item-template="icon" x-ng-repeat="item in scene.items | filter:{isActive:true} | layout: scene.altPaneContents " x-itt-item="item"></div>\n				</div>\n			</div>\n			<div class="pane videoContainer">\n				<div class="fillPane video" x-itt-video-magnet><img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif"/></div>\n			</div>\n			<div class="clear"></div>\n		</div>\n		<div class="pane contentMain colorInvert stretchToViewportBottom">\n			<div class="fillPane paneBg">\n			<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div class="content showCurrent noSidebars">\n				<div x-ng-repeat="item in scene.items | layout: scene.mainPaneContents | filter:{isActive:true}" x-itt-item="item"></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n\n	<div x-itt-magnetized class="fillPane videoOverlay">\n			<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n			<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n\n\n'),a.put("templates/toolbar/toolbar.html",'<div class="toolbar">\n	<a class="button button-showscenenav" href="javascript: void 1;" ng-click="showNavigationPanel()">\n		<span>Scenes</span>\n	</a>\n	<a class="button button-search" href="javascript: void 1;" ng-click="showSearchPanel()">\n		<span>Search</span>\n	</a>\n	<div id="frameselections">\n		<!-- TODO: trigger view changes on click -->\n		<a ng-click="setSceneTemplate(\'video\');"   class="button button-video"    ng-class="{cur: currentSceneTemplateIs(\'video\')}"   href="javascript:void 1;"><span>Video view</span></a>\n		<a ng-click="setSceneTemplate();"          class="button button-directed" ng-class="{cur: currentSceneTemplateIs()}"          href="javascript:void 1;"><span>Directed view</span></a>\n		<a ng-click="setSceneTemplate(\'explore\');" class="button button-explore"  ng-class="{cur: currentSceneTemplateIs(\'explore\')}" href="javascript:void 1;"><span>Explore view</span></a>\n	</div>\n</div>'),a.put("templates/transcript-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="authorName">{{item.authorName}}</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.authorThumbSrc}}"><div class="clear"></div></div> -->\n	<div class="text">\n		{{item.annotation}}\n	</div>\n</div>\n'),a.put("templates/transmedia-image-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="icon"><img src="{{item.thumbSrc}}"></div>\n	<div class="category">\n		<!--{{item.category}}-->\n		<span ng-if="item.required">(Required viewing)</span>\n	</div>\n	<div class="startTime displayTime" ng-click="gotoItem()">{{item.displayTime}}</div>\n	<div class="title">{{item.title}}</div>\n	<button ng-click="toggleDetailView()">Detail View</button>\n	<div class="detail">\n		<img x-ng-src="{{item.source}}">\n		<div class="text">{{item.description}}</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-image-plain.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive\n}\'><img x-ng-src="{{item.source}}" /></div>\n'),a.put("templates/transmedia-link-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n		<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title"><a href="javascript:void 1;" ng-click="toggleDetailView()">{{item.title}}</a></div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="detail" ng-if="item.showInlineDetail">\n		<a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n		<iframe src="{{item.source}}" width="100%" height="300px"></iframe>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-icon.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="icon"><a href="javascript:void 1;" ng-click="toggleDetailView()"><img x-ng-src="{{item.thumbSrc}}"></a></div>\n	<div class="detail" ng-if="item.showInlineDetail">\n		<a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n		<iframe src="{{item.source}}" width="100%" height="300px"></iframe>\n	</div>\n</div>\n\n')}]),angular.module("com.inthetelling.player").controller("UIErrorController",["$scope","$rootScope",function(a,b){a.errorMsg=b.uiErrorMsg||"The requested route does not exist. Please use /episode/<episodeId> format."}]),angular.module("com.inthetelling.player").controller("EpisodeController",["dataSvc","modelFactory","queuePointScheduler","$scope","$rootScope","$location","$routeParams",function(a,b,c,d,e,f,g){a.get(g.epId,function(a){var e,f;for(d.episode=b.createEpisodeModel(a.episode),d.scenes=[],e=0;e<a.events.length;e++)if("scene"===a.events[e].type){var g=b.createSceneModel(a.events[e]);!function(a){c.subscribe({begin:a.startTime,end:a.endTime},function(b,e){d.$apply(function(){e===c.ENTER?a.isActive=!0:e===c.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(g),d.scenes.push(g)}for(e=0;e<a.events.length;e++)if("scene"!==a.events[e].type){var h=b.createItemModel(a.events[e]);for(function(a){c.subscribe({begin:a.startTime,end:a.endTime},function(b,e){d.$apply(function(){e===c.ENTER?a.isActive=!0:e===c.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(h),f=0;f<d.scenes.length;f++)if(h.startTime>=d.scenes[f].startTime&&h.startTime<d.scenes[f].endTime){d.scenes[f].items.push(h);break}}for(d.scenes.sort(function(a,b){return a.startTime-b.startTime}),e=0;e<d.scenes.length;e++)d.scenes[e].items.sort(function(a,b){return a.startTime-b.startTime});console.log("Created Scope:",d)},function(){e.uiErrorMsg="Unable to load data for Episode: "+g.epId,f.path("/error")})}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","videojs",function(a,b){a.gotoItem=function(){b.player.currentTime(a.item.startTime)}}]),angular.module("com.inthetelling.player").controller("ToolbarController",["$scope","$timeout","$rootScope","modalMgr",function(a,b,c,d){a.setSceneTemplate=function(d){console.log("setSceneTemplate "+d),a.currentSceneTemplate=d;for(var e=0;e<a.scenes.length;e++){var f=a.scenes[e];d?(void 0===f.origTemplateUrl&&(f.origTemplateUrl=f.templateUrl),f.templateUrl="templates/scene-"+d+".html"):f.origTemplateUrl&&(f.templateUrl=f.origTemplateUrl)}b(function(){c.$emit("toolbar.changedSceneTemplate")},0)},a.currentSceneTemplateIs=function(b){return a.currentSceneTemplate===b},a.showNavigationPanel=function(){console.log("showNavigationPanel()"),d.createNavigationPanelOverlay(a)},a.showSearchPanel=function(){console.log("showSearchPanel()"),d.createSearchPanelOverlay(a)}}]),angular.module("com.inthetelling.player").controller("NavigationPanelController",["$scope","videojs",function(a,b){a.gotoScene=function(c){b.player.currentTime(c.startTime),a.$close()}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","videojs",function(a,b){a.searchTypes={annotation:!0,link:!0,slide:!0,indepth:!0,project:!0,discussion:!0},a.sortBy="startTime",a.prettyTypeMap={annotation:"Transcript",link:"Links",slide:"Slides",indepth:"In Depth",project:"Projects",discussion:"Discussions"},a.allItemsByType={};var c,d;for(c=0;c<a.scenes.length;c++)for(d=0;d<a.scenes[c].items.length;d++)a.allItemsByType[a.scenes[c].items[d].type]||(a.allItemsByType[a.scenes[c].items[d].type]=[]),a.allItemsByType[a.scenes[c].items[d].type].push(a.scenes[c].items[d]);a.gotoItem=function(c){b.player.currentTime(c.startTime),a.$close()}}]),angular.module("com.inthetelling.player").factory("dataSvc",["config","$http","$q","_",function(a,b,c,d){var e,f={};return f.get=function(d,f,g){if(e={},a.localData)console.log("dataSvc.get() [Mode: Local Data]"),b({method:"GET",url:a.localDataBaseUrl+"/"+d+".json"}).success(function(a){f(a)}).error(function(a){g(a)});else{console.log("dataSvc.get() [Mode: API Data]"),b.defaults.headers.get={Authorization:a.apiAuthToken};var h=b.get(a.apiDataBaseUrl+"/v1/episodes/"+d).then(function(d){return e.episode=d.data,c.all([b.get(a.apiDataBaseUrl+"/v1/containers/"+d.data.container_id+"/assets"),b.get(a.apiDataBaseUrl+"/v1/containers/"+d.data.container_id)])}).then(function(d){return e.assets=d[0].data.files,c.all([b.get(a.apiDataBaseUrl+"/v1/containers/"+d[1].data[0].parent_id+"/assets"),b.get(a.apiDataBaseUrl+"/v1/containers/"+d[1].data[0].parent_id)])}).then(function(c){return e.assets=e.assets.concat(c[0].data.files),b.get(a.apiDataBaseUrl+"/v1/containers/"+c[1].data[0].parent_id+"/assets")}).then(function(a){e.assets=e.assets.concat(a.data.files)}),i=c.all([b.get(a.apiDataBaseUrl+"/v2/episodes/"+d+"/events"),b.get(a.apiDataBaseUrl+"/v1/templates"),b.get(a.apiDataBaseUrl+"/v1/layouts"),b.get(a.apiDataBaseUrl+"/v1/styles")]).then(function(a){e.events=a[0].data,e.templates=a[1].data,e.layouts=a[2].data,e.styles=a[3].data});c.all([h,i]).then(function(){console.log("Compiled API Data:",e);for(var a=0;a<e.events.length;a++)e.events[a].type=e.events[a].type.toLowerCase(),e.events[a]._type=e.events[a]._type.toLowerCase();f(e)})}},f.getAssetById=function(a){if(d.isArray(e.assets)){var b;for(b=0;b<e.assets.length;b++)if(e.assets[b]._id===a)return e.assets[b]}},f.getTemplateById=function(a){if(d.isArray(e.templates)){var b;for(b=0;b<e.templates.length;b++)if(e.templates[b]._id===a)return e.templates[b]}},f.getLayoutById=function(a){if(d.isArray(e.layouts)){var b;for(b=0;b<e.layouts.length;b++)if(e.layouts[b]._id===a)return e.layouts[b]}},f.getStyleById=function(a){if(d.isArray(e.styles)){var b;for(b=0;b<e.styles.length;b++)if(e.styles[b]._id===a)return e.styles[b]}},f}]),angular.module("com.inthetelling.player").factory("modelFactory",["dataSvc","_",function(a,b){var c=function(a){return b.isString(a)&&a.match(/^[0-9a-fA-F]{24}$/)?!0:!1},d=function(b){if(c(b)){var d=a.getTemplateById(b);if(d)return d.url;console.error("Template lookup failed for:",b)}return b},e=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getLayoutById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Layout lookup failed for:",c[d]);return f}return c},f=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getStyleById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Style lookup failed for:",c[d]);
return f}return c},g=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return{mpeg4:d.url,webm:d.url.replace(".mp4",".webm")};console.error("Master Asset lookup failed for:",b)}return b},h=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d.url;console.error("Asset lookup failed for:",b)}return b},i=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d._type;console.error("Asset lookup failed for:",b)}return b},j={};return j.createEpisodeModel=function(a){var b={};return b.title=a.title,b.category="Fnord",b.coverUrl="/images/coverlogo.png",b.templateUrl=d(a.template_id)||"templates/episode-default.html",b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.videos=g(a.master_asset_id),b},j.createSceneModel=function(a){var b={};return b.type=a.type,b.title=a.title,b.description=a.description,b.startTime=a.start_time,b.endTime=a.end_time,b.templateUrl=d(a.template_id)||"templates/scene-1col.html",b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),b.isActive=!1,b.wasActive=!1,b.items=[],b.layout.match(/splitOptional/)?(b.mainPaneContents="required",b.altPaneContents="optional"):(b.mainPaneContents="transcript",b.altPaneContents="transmedia"),b.layout.match(/showCurrent/)&&(b.showCurrent=!0),b},j.createItemModel=function(a){var b={};switch(b.type=a.type,b.startTime=a.start_time,b.endTime=a.end_time,b.layout=e(a.layout_id)||"inline",b.styles=f(a.style_id)||"",b.required=a.required||!1,b.cosmetic=a.cosmetic||!1,b.stop=a.stop||!1,b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),("inline"===b.layout||b.layout.match(/sidebar/)||b.layout.match(/burst/))&&(b.inContentPane=!0),a.type){case"annotation":b.templateUrl=d(a.template_id)||"templates/transcript-default.html",b.authorName=a.annotator,b.authorThumbSrc=h(a.annotation_image_id),b.annotation=a.annotation;break;case"link":b.templateUrl=d(a.template_id)||"templates/transmedia-link-default.html",b.itemDetailTemplateUrl="templates/modal-link-default.html",b.category="links",b.title=a.title,b.description=a.description,b.thumbSrc=h(a.link_image_id),b.source=a.url;break;case"upload":var c=a.mimeType||i(a.asset_id);c.match(/image/)&&(b.type="image"),b.templateUrl=d(a.template_id)||"templates/transmedia-image-default.html",b.title=a.title,b.description=a.description,b.source=h(a.asset_id)}return b},j}]),angular.module("com.inthetelling.player").factory("modalMgr",["$modal","videojs","_",function(a,b){var c,d={};return d.createItemDetailOverlay=function(c){console.log("createItemDetailOverlay:",c.item),b.player.pause();var d=a.open({keyboard:!0,backdrop:!0,templateUrl:c.item.itemDetailTemplateUrl,windowClass:"itemDetailModal",scope:c,controller:function(a,b){a.close=function(){b.close()}}});d.result.then(function(){b.player.play()},function(){b.player.play()})},d.createSearchPanelOverlay=function(c){console.log("createSearchPanelOverlay()"),b.player.pause();var d=a.open({keyboard:!0,backdrop:!0,templateUrl:"templates/overlays/searchPanel.html",windowClass:"sidePanel searchPanel",scope:c,controller:"SearchPanelController"});d.result.then(function(){b.player.play()},function(){b.player.play()})},d.createNavigationPanelOverlay=function(c){console.log("createNavigationPanelOverlay()"),b.player.pause();var d=a.open({keyboard:!0,backdrop:!0,templateUrl:"templates/overlays/navigationPanel.html",windowClass:"sidePanel navigationPanel",scope:c,controller:"NavigationPanelController"});d.result.then(function(){b.player.play()},function(){b.player.play()})},d.createInitOverlay=function(){console.log("createInitOverlay"),c||(c=a.open({keyboard:!1,backdrop:"static",templateUrl:"templates/overlays/init.html"}))},d.destroyInitOverlay=function(){console.log("destroyInitOverlay"),c&&(c.close(),c=null)},d}]),angular.module("com.inthetelling.player").factory("queuePointScheduler",["$window",function(a){var b={};b.ENTER="enter",b.EXIT="exit";var c,d,e,f=[],g={},h=!1,i=function(a){return a.begin+"-"+a.end},j=function(a){d=a,h=!0},k=function(){if(h){var a,c,e=f.length;for(a=0;e>a;a++)c=f[a],c.isActive?(d<c.begin||d>=c.end)&&(c.isActive=!1,c.callback.call(void 0,{begin:c.begin,end:c.end},b.EXIT,d)):c.isActive||d>=c.begin&&d<c.end&&(c.isActive=!0,c.callback.call(void 0,{begin:c.begin,end:c.end},b.ENTER,d));h=!1}};return b.subscribe=function(a,b){return g[i(a)]=!0,f.push({begin:a.begin,end:a.end,callback:b,isActive:!1}),!0},b.unsubscribe=function(a){delete g[i(a)];var b,c=f.length;for(b=0;c>b;b++)if(f[b].begin===a.begin&&f[b].end===a.end){f.splice(b,1);break}return!0},b.registerProvider=function(b,d){return c?!1:(c=b,e=a.setInterval(k,d||1e3),j)},b.unregisterProvider=function(b){return c!==b?!1:(c=null,a.clearInterval(e),!0)},b}]),angular.module("com.inthetelling.player").factory("_",function(){return window._}),angular.module("com.inthetelling.player").factory("videojs",function(){var a={};return a.player=null,a.init=function(b,c){return a.player?!1:(videojs(b,{},function(){a.player=this,c&&c(a.player)}),!0)},a}),angular.module("com.inthetelling.player").factory("config",function(){return window.config}),angular.module("com.inthetelling.player").directive("ittScene",["$rootScope","$timeout",function(a,b){return{restrict:"A",replace:!1,template:'<div ng-include="scene.templateUrl">Loading Scene...</div>',scope:{scene:"=ittScene"},link:function(c,d){var e=function(){b(function(){console.log("twiddleSceneLayout"),d.find(".matchVideoHeight:visible").height(d.find(".videoContainer").height()),d.find(".stretchToViewportBottom:visible").each(function(){$(this).css("min-height",$(window).height()-this.offsetTop-60)})},0)};c.$watch(function(){return d.width()},e),a.$on("toolbar.changedSceneTemplate",e),c.$watch("scene.isActive",e)}}}]),angular.module("com.inthetelling.player").directive("ittItem",["modalMgr",function(a){return{restrict:"A",replace:!1,template:'<div ng-include="item.templateUrl">Loading Item...</div>',scope:{item:"=ittItem"},link:function(b,c,d){d.forceItemTemplate?(b.item.origTemplateUrl=b.item.templateUrl,b.item.templateUrl="templates/transmedia-"+b.item.type+"-"+d.forceItemTemplate+".html"):b.item.origTemplateUrl&&(b.item.templateUrl=b.item.origTemplateUrl),b.toggleDetailView=function(){b.item.showInlineDetail?b.item.showInlineDetail=!1:c.closest(".content").width()>400?b.item.showInlineDetail=!b.item.showInlineDetail:a.createItemDetailOverlay(b)}},controller:"ItemController"}}]),angular.module("com.inthetelling.player").directive("ittVideo",["queuePointScheduler","videojs","$timeout","config",function(a,b,c,d){return{restrict:"A",replace:!1,link:function(c,e){e.html(function(){var a='<video id="'+d.videoJSElementId+'" class="video-js vjs-default-skin" autoplay preload poster="'+c.episode.coverUrl+'" controls width="100%" height="100%">';return a+='<source type="video/mp4" src="'+c.episode.videos.mpeg4+'" />',a+='<source type="video/webm" src="'+c.episode.videos.webm+'" />',a+="</video>"});var f=a.registerProvider(d.videoJSElementId,d.queuePointScanInterval);b.init(d.videoJSElementId,function(a){a.on("timeupdate",function(){f(a.currentTime())})})}}}]),angular.module("com.inthetelling.player").directive("ittVideoMagnet",["$window","$timeout","$rootScope",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){d.scene||console.warn("PROBABLE ERROR: videoMagnet directive should have scene scope. Got this instead:",d),d.activate=function(){console.log("ittVideoMagnet.activate()",e),b(function(){c.$emit("videoMagnet.activated",e)},0)},d.$watch("scene.isActive",function(a,b){a&&a!==b&&d.activate()}),c.$on("toolbar.changedSceneTemplate",function(){d.scene.isActive&&d.activate()}),angular.element(a).bind("resize",function(){d.scene.isActive&&d.activate()})}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){function d(a,b){console.log("ittMagnetized triggered"),"fixed"===b.parent().css("position")?(c.css("position","fixed"),c.offset(b.offset()),c.width(b.width()),c.height(b.height())):(c.css("position","absolute"),c.offset(b.offset()),c.width(b.width()),c.height(b.height()))}console.log("ittMagnetized",c),b.unbindMagnet=a.$on("videoMagnet.activated",d),b.$on("$destroy",function(){console.log("Destroying videoMagnet event"),b.unbindMagnet()})}}}]),angular.module("com.inthetelling.player").directive("ittToolbar",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/toolbar/toolbar.html",link:function(){},controller:"ToolbarController"}}),angular.module("com.inthetelling.player").directive("ittContentPane",["$filter",function(a){return{restrict:"A",replace:!1,scope:!0,templateUrl:"templates/contentpane.html",link:function(b,c,d){b.pane=d.pane||"main",b.contentLayout=d.content||"content",b.itemlist=a("layout")(b.scene.items,b.contentLayout),b.showCurrent=b.scene.showCurrent||d.showCurrent,"templates/scene-explore.html"===b.scene.templateUrl&&(b.showCurrent=!1),b.forceItemTemplate=d.forceItemTemplate;var e=function(){if(console.log("contentpane checkForSidebars"),d.noSidebars)return b.noSidebars=!0,void 0;for(var a=0;a<b.itemlist.length;a++){var c=b.itemlist[a].layout;"burst"===c?(b.hasLeftSidebar=!0,b.hasRightSidebar=!0):"sidebarL"===c||"burstL"===c?b.hasLeftSidebar=!0:("sidebarR"===c||"burstR"===c)&&(b.hasRightSidebar=!0)}};e(),b.$watch(function(){return c.width()},function(a){a>0&&450>a?(b.noSidebars=!0,b.hasLeftSidebar=!1,b.hasRightSidebar=!1):e()},!0)}}}]),angular.module("com.inthetelling.player").filter("type",function(){return function(a,b){if(b){var c,d=[];for(c=0;c<a.length;c++)b[a[c].type]&&d.push(a[c]);return d}return[]}}),angular.module("com.inthetelling.player").filter("layout",function(){return function(a,b){if(!a||!b)return[];var c,d=[];if("required"===b||"optional"===b||"transcript"===b||"transmedia"===b||"content"===b)for(c=0;c<a.length;c++)a[c].inContentPane&&("transcript"===b?"annotation"===a[c].type&&d.push(a[c]):"transmedia"===b?"annotation"!==a[c].type&&d.push(a[c]):"required"===b?("annotation"===a[c].type||a[c].required)&&d.push(a[c]):"optional"===b?"annotation"===a[c].type||a[c].required||d.push(a[c]):d.push(a[c]));else for(c=0;c<a.length;c++)a[c].layout===b&&d.push(a[c]);return d}});