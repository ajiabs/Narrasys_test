"use strict";function ittAssetUploader(a,b,c,d){return{restrict:"A",replace:!1,scope:{containerId:"=ittAssetUploader",callback:"=callback",mimeTypes:"@",instructions:"@",errorText:"@"},templateUrl:"templates/producer/asset-uploader.html",link:function(e,f,g){function h(a,b){return 0===a.indexOf(b)}function i(a,b){return a.substring(a.length-b.length,a.length)===b}void 0===e.instructions?e.manPage="We support uploads of most common file formats, including .doc, .docx, .jpeg, .jpg, .pdf, .png, .ppt, .pptx, .rtf, .txt, and .zip. ":e.manPage=e.instructions;var j;j=void 0===e.mimeTypes?["application/*","image/*","video/*","text/*","audio/*","model/*"]:e.mimeTypes.split(",");var k;k=void 0===e.errorText?"Whoops!, you may want to try that again!":e.errorText,angular.forEach(j,function(a,b){j[b]=a.trim()}),e.uploadStatus=[],e.uploads=[],e.uploadsinprogress=0,e.multiple=void 0!==g.multiple,e.handleUploads=function(a){if(!e.multiple&&(a.length>1||e.uploads.length>0))return e.errormessage="You may only upload one file at a time here.",!1;var f=!1;if(angular.forEach(a,function(a){angular.forEach(j,function(b){var c=i(b,"*");if(c){var d=b.slice(0,-1),e=h(a.type,d);e&&(f=!0)}else a.type===b&&(f=!0)})}),!f)return void(e.errormessage=k);var g=e.uploads.length,l=e.uploads.length+a.length;e.uploadsinprogress=e.uploadsinprogress+a.length,e.containerId?e.uploads=e.uploads.concat(b.uploadContainerFiles(e.containerId,a)):e.uploads=e.uploads.concat(b.uploadUserFiles(c.user._id,a));for(var m=g;l>m;m++)!function(b){e.uploadStatus[b]={bytesSent:0,bytesTotal:1,percent:0,name:a[b-g].name},e.uploads[b].then(function(a){d.cache("asset",a.file),e.callback&&e.callback(a.file._id),e.uploadStatus[b].done=!0,e.oneDone()},function(a){e.uploadStatus[b].error=a,e.oneDone()},function(a){e.uploadStatus[b].bytesSent=a.bytesSent,e.uploadStatus[b].bytesTotal=a.bytesTotal,e.uploadStatus[b].percent=Math.ceil(a.bytesSent/a.bytesTotal*100)})}(m)},e.oneDone=function(){e.uploadsinprogress=e.uploadsinprogress-1,0===e.uploadsinprogress&&(e.fileinput.value="",e.paused=!1)},e.handleDrop=function(a){a.preventDefault(),a.stopPropagation(),e.handleDragLeave(),e.handleUploads(a.dataTransfer.files)},e.handleDragOver=function(a){return a.preventDefault(),a.dataTransfer.dropEffect="move",e.handleDragEnter(),!1},e.handleDragEnter=function(){e.droptarget.addClass("droppable")},e.handleDragLeave=function(){e.droptarget.removeClass("droppable")},e.pauseUpload=function(){b.pauseUpload(),e.paused=!0},e.resumeUpload=function(){b.resumeUpload(),e.paused=!1},e.cancelUpload=function(){b.cancelUpload()},a(function(){e.droptarget=f.find(".uploadDropTarget"),e.fileinput=f.find(".uploadFileInput"),e.uploadsinprogress=0,e.droptarget[0].addEventListener("drop",e.handleDrop),e.droptarget[0].addEventListener("dragover",e.handleDragOver),e.droptarget[0].addEventListener("dragenter",e.handleDragEnter),e.droptarget[0].addEventListener("dragleave",e.handleDragLeave)})}}}angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize","textAngular"]).config(["$routeProvider",function(a){a.when("/",{title:"Telling STORY",templateUrl:"templates/root.html"}).when("/auth",{templateUrl:"templates/auth.html",reloadOnSearch:!1}).when("/user",{template:'<div class="standaloneAncillaryPage"><div itt-user></div></div>'}).when("/stories",{title:"Existing narratives",template:'<div class="standaloneAncillaryPage"><div itt-narrative-list></div></div>'}).when("/story",{template:'<div class="standaloneAncillaryPage"><div itt-narrative></div></div>'}).when("/story/:narrativePath",{template:'<div class="standaloneAncillaryPage"><div itt-narrative></div></div>'}).when("/story/:narrativePath/:timelinePath",{template:"<div itt-narrative-timeline></div>",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="narrative"}]}}).when("/episodes",{title:"Available episodes",templateUrl:"templates/producer/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/sxs/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/editor/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/producer/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="producer",a.productLoadedAs="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",controller:"ContainerAssetsTestController",template:'<div class="standaloneAncillaryPage"><div><a class="goUp" href="#episodes">Episodes</a><div sxs-container-assets="containerId"></div></div></div>'}).when("/event/:eventId",{title:"Event test",controller:"EventTestController",templateUrl:"templates/testbed-event.html"}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope","errorSvc","YoutubePlayerApi","appState",function(a,b,c,d){c.load().then(function(){d.youtubeIframeAPIReady=!0}),a.$on("$routeChangeSuccess",function(a,c){document.title=c.title?c.title:"Telling STORY",b.init()});var e=!1;$(document).on("keydown",function(b){e||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.attributes.contenteditable||(e=!0,27===b.keyCode&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))}),$(document).on("keyup",function(){e=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","errorSvc",function(a,b){return{responseError:function(c){return b.error(c),a.reject(c)}}}])}]).config(["$provide",function(a){a.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return b.toolbar=[["h1","h2","h3"],["bold","italics","underline","strikeThrough"],["ul","ol"],["undo","redo","clear"]],b}])}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/auth.html",'<div itt-login="" style="margin:2em"><a style="animation: delayedFadeIn 5s" href="/#/">Home</a></div>'),a.put("templates/container.html",'<div class="container" ng-class="{\n		isOpen: container.showChildren, \n		isClosed: !container.showChildren,\n		hoverIndicator: depth == 3\n	}" ng-if="container._id"><div class="hoverIndicator"><span ng-if="!container.editingContainer"><a ng-click="toggleChildren()">{{container.name.en}}</a> <span ng-if="depth==3" style="color:#999">({{container.status || Unpublished}})</span> <a style="color:#666" ng-click="container.editingContainer = true">â–¾</a></span> <span ng-if="container.editingContainer"><label>Name:&nbsp;<input ng-model="container.newContainerName" ng-init="container.newContainerName = container.name.en" autofocus>&nbsp;</label><button ng-click="container.editingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerName || container.newContainerName == container.name.en" ng-click="renameContainer()">Save</button></span> <span class="controls"><button class="danger" ng-if="appState.dangerousButtons && !container.children.length && !container.haveNotLoadedChildData" ng-click="deleteEpisodeAndContainer(container._id)">Delete</button> <a ng-href="#/assets/{{container._id}}">[Assets]</a></span></div><div ng-if="container.showChildren"><div ng-if="depth < 3" ng-repeat="child in container.children | orderBy:\'name.en\'" itt-container="containers[child._id]" depth="depth+1"></div><div ng-if="depth == 3" class="container"><a class="button" ng-click="container.showGuestUrl=!container.showGuestUrl"><span ng-if="customer.guest_access_allowed">Guest</span> <span ng-if="!customer.guest_access_allowed">ID</span></a> <a class="button" href="#/episode/{{container.episodes[0]}}">Player</a> <a class="button" ng-if="isDemoServer" href="#/editor/{{container.episodes[0]}}">Editor</a> <a class="button" href="#/producer/{{container.episodes[0]}}">Producer</a><div ng-if="container.showGuestUrl && customer.guest_access_allowed">The guest-accessible url for this episode is<input class="readonly" ng-click="selectText($event)" value="https://{{customer.domains[0]}}.inthetelling.com/#/episode/{{container.episodes[0]}}" readonly></div><div ng-if="container.showGuestUrl && !customer.guest_access_allowed">The ID for this episode is {{container.episodes[0]}}</div></div><div ng-if="!container.addingContainer" class="controls"><button ng-if="depth < 3" ng-click="container.addingContainer = true">Add {{containerTypes[depth+1]}} to {{container.name.en}}</button></div><div ng-if="container.addingContainer" class="controls"><label>Name:&nbsp;<input ng-model="container.newContainerTitle" autofocus>&nbsp;</label><button ng-click="container.addingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button></div></div></div>'),a.put("templates/containerepisodes.html",' <span ng-if="forAdmin"><li ng-if="!container.episodes.length" class="container" ng-class="{isOpen: wasClicked, isClosed: !wasClicked}" ng-click="toggle();loadChildren()" ng-bind-html="container.display_name"></li><li ng-if="container.episodes.length"><span ng-if="container.episodes[0] == episodeId"><b ng-bind-html="containers[container._id].display_name"></b></span> <span class="hoverIndicator" ng-if="container.episodes[0] != episodeId"><a ng-click="selectEpisode()" ng-bind-html="containers[container._id].display_name"></a> ({{container.status}})</span></li><ul class="crossEpisodeNav" ng-class="{isOpen: wasClicked, isClosed: !wasClicked}" ng-if="wasClicked"><li ng-repeat="child in container.children" itt-container-episodes="containers[child._id]" x-for-admin="true"></li></ul></span> <span ng-if="!forAdmin"><li ng-if="!container.episodes.length" ng-bind-html="container.display_name"></li><li ng-if="container.episodes.length && container.status === \'Published\'"><span ng-if="container.episodes[0] == episodeId"><b ng-bind-html="containers[container._id].display_title"></b></span> <span ng-if="container.episodes[0] != episodeId"><a ng-href="/#/{{crossEpisodePath}}/{{container.episodes[0]}}" ng-bind-html="containers[container._id].display_title"></a></span></li><ul class="crossEpisodeNav"><li ng-repeat="child in container.children | orderBy:\'name.en\'" itt-container-episodes="containers[child._id]"></li></ul></span>'),a.put("templates/copyright.html",'TELLING STORY player &#169; <span ng-bind-html="now | date:\'yyyy\'"></span> <a href="//inthetelling.com" target="_blank">IN THE TELLING</a>. All rights reserved.<br><a href="/privacy.html" target="_blank">Privacy</a> <span ng-if="narrative.support_url">- <a ng-href="{{narrative.support_url}}">Support</a></span>'),a.put("templates/episode/columbia.html",'<div class="episode episode-columbia" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/columbia.svg" alt="Columbia University"></div></div>'),a.put("templates/episode/columbiabusiness.html",'<div class="episode episode-columbiabusiness" ng-class="episode.styleCss"><div class="fill trident"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/cbs-logo.svg" alt="Columbia Business School"></div></div>'),a.put("templates/episode/components/discovermode.html",'<div class="discoverMode" ng-if="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene="scene" episode="episode"></div></div>'),a.put("templates/episode/components/reviewmode-scenes.html",'<div class="scene animate transitionFade" ng-class="{navigable: scene.display_title}" ng-repeat="scene in scenes" ng-if="!scene._internal"><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class="sceneTitle" ng-if="scene.display_title" ng-bind-html="scene.display_title"></h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items| reviewMode | orderBy:\'start_time\'" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-all"></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | reviewMode | annotation | orderBy:\'start_time\'" ng-class="item.state" itt-item="item" forcetemplate="review-annotation"></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding"> <div class="item animate" ng-repeat="item in scene.items | reviewMode | transmedia" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-transmedia"></div></div></div></div><itt-loading ng-if="isLoading"></itt-loading>'),a.put("templates/episode/components/reviewmode.html",'<div ng-show="appState.viewMode == \'review\'" class="searchMode"><div itt-magnet="" id="searchVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div itt-search-panel=""></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><span ng-if="episode.masterAsset"><div class="video contentLayer" itt-video="episode.masterAsset" poster="episode.poster"></div></span><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<div ng-if="appState.viewMode == \'watch\'" style="padding-bottom: 100%"><div class="watchMode"><div itt-magnet="" id="watchModeVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><span class="watchModeCaptions" ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class="item.state" itt-item="item" forcetemplate="caption"></div></span></div>'),a.put("templates/episode/components/windowfg.html",'<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"><div class="content"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div><a ng-if="!appState.editEvent && appState.timelineState == \'paused\'" class="button-continue" ng-click="continue()"><span>Continue</span></a></div></div>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href="//www.mindwires.com" target="_blank"><img src="images/customer/eliterate-mindwires.svg" alt="Mindwires logo"></a> <a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/eliterate-logo.svg" alt="E-Literate"></div></div>'),a.put("templates/episode/episode.html",'<div class="episode" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/ewb-logo.svg" alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="George Washington"></div></div>'),a.put("templates/episode/gwlaw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-law.jpg" alt="GW Law"></div></div>'),a.put("templates/episode/gwsb.html",'<div class="episode episode-gwsb" ng-class="episode.styleCss"><div class="fill gwsb-seal"><div class="fill"></div></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="The George Washington University"></div></div>'),a.put("templates/episode/kellogg.html",'<div class="episode episode-kellogg" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><img src="images/customer/kellogg-k.svg"> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"></div></div>'),a.put("templates/episode/middlebury.html",'<div class="episode episode-middlebury" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span class="colorInvert DiscoverModeOnly" ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt-incolor.svg" alt="In The Telling logo"></a> <a class="logo" href="http://middlebury.edu"><img src="images/customer/middlebury-shield.svg" alt="Middlebury logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/middlebury-logo.svg" alt="Middlebury"></div></div>'),a.put("templates/episode/prolotherapy.html",'<div class="episode episode-prolotherapy" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/prolotherapy-text.svg" alt="American Association of Musculoskeletal Medicine"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/purdue-logo.svg" alt="Purdue"></div></div>'),a.put("templates/episode/regis.html",'<div class="episode episode-regis" ng-class="episode.styleCss"><div class="fill bigregis"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/schoolclimatesolutions.html",'<div class="episode episode-schoolclimatesolutions" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/schoolclimatesolutions.svg" alt="SCS: School Climate Solutions"></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/tellingstory-logo.svg" alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/usc-logo.svg" alt="USC"></div></div>'),a.put("templates/episode/washingtonSBCTC.html",'<div class="episode episode-wsbctc" ng-class="episode.styleCss"><div class="fill bigwsbctc"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><div id="branding-wrapper"><img src="images/customer/WSBCTC_Logo.svg" id="sbctc-logo" alt="Washington SBCTC logo"> <a id="itt-logo" href="//inthetelling.com" target="_blank"><img src="images/itt-incolor.svg" alt="In The Telling logo"></a></div><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/wiley1.html",'<div class="episode episode-wiley wiley-endscreentext" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="ghost"></div></div>'),a.put("templates/episode/wiley2.html",'<div class="episode episode-wiley" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="ghost"></div></div>'),a.put("templates/episode/wiley3.html","<div ng-include=\"'templates/episode/wiley1.html'\"></div>"),
a.put("templates/error-404.html",'<div class="errors"><div class="error"><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>'),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class="errors"><div class="error" ng-repeat="error in errorSvc.errors" ng-click="dismiss(error)"><h3>Error: {{error.cause || error.exception.data.error || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if="error.exception.config.url"><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if="user.login_url"><a ng-if="user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}" target="_top">click here</a> <a ng-if="!user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}">click here</a> to log back in.</span> <span ng-if="!user.login_url"><a ng-click="logout();">reset your session</a> and start over.</span></p></div><div class="notification" ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click="dismiss(notification)">[x]</a><p>{{notification.text}}</p></div></span>'),a.put("templates/iframe.html",'<div class="iframeContainer"><itt-loading></itt-loading><iframe ng-if="!iframeCtrl.isYoutube" ng-src="{{iframeCtrl.src}}" ng-attr-sandbox="{{iframeCtrl.sandbox}}"></iframe><itt-youtube ng-if="iframeCtrl.isYoutube" embed-url="{{iframeCtrl.src}}"></itt-youtube></div>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/debug.html",'<div class="itemTemplate"><pre ng-if="itemDebug">{{item | pretty}}</pre></div>'),a.put("templates/item/file-withimage.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title"><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)"><img ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/file.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a role="button" tabindex="0" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><span ng-switch="item.asset.content_type.indexOf(\'image/\')"><span ng-switch-when="-1"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-default=""><img ng-src="{{item.asset.url}}"></span></span></div><div class="clear"></div></div>'),a.put("templates/item/image-caption-sliding.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption slidingcaption"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/image-caption.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/image-fill.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate imageFill" style="{{item.backgroundImageStyle}}" ng-style="{\'backgroundImage\':item.asset.cssUrl}"><img class="fillImg" ng-src="{{item.asset.url}}"></div>'),a.put("templates/item/image-inline-withtext.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="clear"></div></div></div>'),a.put("templates/item/image-inline.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-linkonly.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-plain.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate imagePlain"><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div>'),a.put("templates/item/image-thumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()"><img ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="text"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/image.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a class="fakeLink" role="button" tabindex="0" ng-click="toggleDetailView()" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" x-ng-if="item.showInlineDetail"><div class="touchable" style="position:relative"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/link-descriptionfirst.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="title"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" ng-if="!item.noEmbed" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe></div><div class="clear"></div></div>'),a.put("templates/item/link-embed.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe><div class="clear"></div></div>'),a.put("templates/item/link-withimage.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title"><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/link.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a role="button" tabindex="0" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe></div><div class="clear"></div></div>'),a.put("templates/item/modal.html",'<div class="modal" ng-click="dismiss();"><span ng-if="item._type == \'Link\'"><div class="modalmenu"><a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.url}}"></itt-iframe></span> <span ng-if="item._type == \'Upload\'"><span ng-switch="item.asset.content_type.indexOf(\'image/\')"><span ng-switch-when="-1"><div class="modalmenu"><a href="{{item.asset.url}}" target="_blank" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-default=""><div class="modalimage" ng-if="item._type == \'Upload\'"><img ng-src="{{item.asset.url}}"></div></span></span></span></div>'),a.put("templates/item/pullquote-noattrib.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div>'),a.put("templates/item/pullquote.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="pullquoteSpeaker" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div>'),a.put("templates/item/question-mc-image-left.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:left; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/question-mc-image-right.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:right; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/question-mc-inner.html",'<div class="question"><p ng-bind-html="plugin.questiontext | i18n"></p><div ng-if="!showChart"><div ng-repeat="distractor in choices"><div ng-if="(distractor.text | i18n) != \'\'"><label ng-class="{\n					correct: plugin.hasBeenAnswered && distractor.correct,\n					incorrect: plugin.hasBeenAnswered && !distractor.correct\n				}"><input ng-change="scoreQuiz($index)" type="radio" name="fnord" ng-model="index" ng-disabled="plugin.hasBeenAnswered" value="{{$index}}" ng-checked="distractor.selected"><span ng-bind-html="distractor.text | i18n"></span></label></div></div><div ng-if="plugin.hasBeenAnswered" ng-bind-html="feedback() | i18n"></div></div><div ng-if="showChart"><div ng-if="!plugin.hasBeenAnswered" ng-repeat="distractor in plugin.distractors"><div ng-if="(distractor.text | i18n) != \'\'"><label><input ng-change="scorePoll($index)" type="radio" name="fnord" ng-disabled="plugin.hasBeenAnswered" ng-model="$parent.plugin.selectedDistractor" value="{{$index}}"><span ng-bind-html="distractor.text | i18n"></span></label></div></div><br><div ng-if="plugin.hasBeenAnswered"><p ng-if="plugin.selectedDistractor">Here\'s how others answered this question. (Your choice was: <b ng-repeat="distractor in plugin.distractors | filter:{ index: plugin.selectedDistractor }" ng-bind-html="distractor.text | i18n"></b>.)</p><itt-flotr2-chart type="{{chartType}}" data="{{chartData}}" options="{{chartOptions}}"></itt-flotr2-chart></div></div></div>'),a.put("templates/item/question-mc.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question><div class="clear"></div></div></div>'),a.put("templates/item/review-all.html"," <span ng-switch=\"(item._type == 'Annotation' && item.templateUrl != 'templates/item/text-transmedia.html' && item.templateUrl != 'templates/item/text-definition.html')\"><span ng-switch-when=\"true\"><div ng-include=\"'templates/item/review-annotation.html'\"></div></span> <span ng-switch-default=\"\"><div ng-include=\"'templates/item/review-transmedia.html'\"></div></span></span>"),a.put("templates/item/review-annotation.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.isTranscript" class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div ng-if="!item.isTranscript" ng-include="item.templateUrl"></div><div class="clear"></div></div>'),a.put("templates/item/review-transmedia.html",'<span ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.sxs" ng-include="item.templateUrl"></div><span ng-if="!item.sxs"><span ng-if="item.layouts[0] == \'windowFg\'" ng-include="\'templates/item/review-windowfg.html\'"></span> <span ng-if="item.layouts[0] != \'windowFg\'"><div ng-if="item.data._pluginType" ng-include="item.templateUrl"></div><span ng-if="!item.data._pluginType"><a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" tabindex="0" class="startTime displayTime" aria-label="Seek video to {{item.displayStartTime}}" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><span ng-if="item._type == \'Annotation\'"><div class="text"><div class="title"><div ng-if="item.display_annotator" class="authorName" ng-bind-html="item.display_annotator"></div><div ng-if="item.display_title" class="authorName" ng-bind-html="item.display_title"></div></div><div ng-bind-html="item.display_annotation"></div></div></span> <span ng-if="item._type != \'Annotation\'"><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed" class="fakeLink escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" role="button" class="fakeLink" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type == \'Link\'"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type != \'Link\'"><div class="touchable" style="position:relative"><img ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div></span></div></span></span></span><div class="clear"></div></span>'),a.put("templates/item/review-windowfg.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-click="seek(item.start_time)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="text" ng-if="item.data._plugin._type == \'question\'">You have <span ng-if="!item.data._plugin.hasBeenAnswered">not yet</span> answered this <span ng-if="item.data._plugin.questiontype == \'mc-poll\'">poll</span> question.</div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="clear"></div></div></div>'),a.put("templates/item/searchresults-all.html",'<span ng-class="{\'sxs-item\': item.sxs}"><a ng-if="item.editableByThisUser" class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div ng-style="\n    item.sxs?{background:\'url(\'+item.avatar.url+\') no-repeat scroll right top / 40px 40px\',minHeight:\'40px\'}:{}\n    " ng-class="{isCosmetic: item.cosmetic}" class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div><div ng-if="item.display_annotator" class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div ng-if="item.producerItemType == \'annotation\' && item.display_title" class="authorName" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><span ng-if="item._type != \'Annotation\'"><a tabindex="0" ng-if="item.noEmbed" class="fakeLink escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText"></a> <a tabindex="0" role="button" class="fakeLink" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="item.showInlineDetail=!item.showInlineDetail" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a></span></div><div class="text"><div ng-class="{showAsHeader: item.showAsHeader}" ng-bind-html="item.display_annotation || item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><span ng-switch="item.producerItemType"><span ng-switch-when="file"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-when="link"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}"></itt-iframe></span> <span ng-switch-when="video"><span ng-switch-when="file"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span></span> <span ng-switch-when="image"><div class="touchable" style="position:relative"><img ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></span> <span ng-switch-when="question"><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question></span> <span ng-switch-default=""><span ng-if="item.data._pluginType == \'credlyBadge\'" ng-include="\'templates/item/usc-badges-inner.html\'"></span> </span></span></div></div></span>'),
a.put("templates/item/searchresults.html",'<div ng-class="{\nsearchitem:true,\nisSxS: item.sxs,\nisCurrent: ((item.start_time <= appState.time) && (item.end_time > appState.time)),\nisCosmetic: item.cosmetic\n}" ng-style="item.sxs?{backgroundImage:\'url(\'+item.avatar.url+\')\'}:{}"><a class="edit-event" ng-click="editItem(item._id)"><span>Edit item</span></a> <span class="displayTime"><button class="fakeLink" tabindex="2" ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</button></span> <span class="type" ng-bind-html="(item.display_title || item.display_annotator) | highlightSubstring: appState.searchText"></span><div class="description" ng-bind-html="(item.display_description || item.display_annotation) | highlightSubstring: appState.searchText"></div></div>'),a.put("templates/item/sxs-annotation.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.annotation.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-file.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><a ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-image.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div><b ng-bind-html="item.title.en"></b><p style="text-align:center"><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></p></div><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-link.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><a ng-if="item.noEmbed" class="escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><h3 ng-if="!item.noEmbed" ng-bind-html="item.title.en ||\'(Untitled)\'"></h3><div class="text" ng-bind-html="item.description.en"></div><div class="itemDetail" ng-if="item.url && !item.noEmbed && item.url != \'https://\'"><div class="modalmenu" ng-if="!item.noExternalLink"><a ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.url}}"></itt-iframe></div><div class="clear"></div></div>'),a.put("templates/item/sxs-question.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser"><span>Edit item</span></a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:right; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/sxs-video.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><a class="escapelink" ng-click="outgoingLink(item.url)">New window</a><itt-iframe x-src="{{item.url}}"></itt-iframe><div class="clear"></div></div>'),a.put("templates/item/text-definition.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div><div class="itemTemplate definition"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div><span ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></span></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/text-h1.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><h1 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h1></div>'),a.put("templates/item/text-h2.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><h2 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h2></div>'),a.put("templates/item/text-transmedia.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><h2 ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></h2></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="icon" style="float:right; margin-right: 0.5em"><img ng-src="{{item.asset.url}}"></div><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="icon" style="float:left; margin-right: 0.5em"><img ng-src="{{item.asset.url}}"><div class="clear"></div></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/transcript.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcript"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/usc-badges-inner.html",'<span><img style="max-width: 5em; float:left; margin-right: 0.5em" ng-src="{{plugin.credlyImageUrl}}"> <b>{{plugin.achievement}}</b> <span ng-if="plugin.eligibleForBadges"><p>Complete the following requirements to earn a <a ng-href="https://credly.com/recipients/{{plugin.credlyBadgeId}}" target="_blank">USC Scholar\'s Badge</a>:</p><div style="clear:both; margin: 1em 1.2em; font-size:90%"><div ng-repeat="req in plugin.requirements"><img ng-if="req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark.png"> <img ng-if="!req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark-empty.png"> <span>{{req.name}}</span></div></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement.</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"><p>Congratulations! You are eligible for a USC Scholarâ€™s Badge. Enter your email address to claim it:</p><input ng-model="plugin.userEmail"><input type="button" value="Go" ng-click="badger()"><span ng-if="plugin.gettingBadge"><small>Getting your badge...</small></span><div ng-if="plugin.error"><small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small></div></div><div ng-if="plugin.gotBadge">Your badge is in the mail. <span ng-if="plugin.alreadyHadBadge">(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div></span> <span ng-if="!plugin.eligibleForBadges"><p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p></span></span>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><span ng-include="\'templates/item/usc-badges-inner.html\'"></span></div>'),a.put("templates/loading.html",'<div class="loading"><div class="spinner"><div class="rotating pie"></div><div class="filler pie"></div><div class="mask"></div></div>Loading</div>'),a.put("templates/narrative/default.html",'<div><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><itt-loading ng-if="loading"></itt-loading><div ng-if="!loading"><div class="narrative"><h2 ng-bind-html="narrative.name.en"></h2><p ng-bind-html="narrative.description.en"></p><div class="storyTimeline" ng-repeat="timeline in narrative.timelines | filter:{hidden:!true} | orderBy:\'sort_order\'"><h3><a href="/#/story/{{narrative.path_slug.en}}/{{timeline.path_slug.en}}">{{timeline.name.en}}</a></h3><p>{{timeline.description.en}}</p>{{timeline.episode_segments[0].end_time | asTime}}</div></div></div><a ng-if="narrative.support_url" ng-href="{{narrative.support_url}}">Support</a></div>'),a.put("templates/narrative/edit.html",'<div class="narrative"><itt-loading ng-if="loading"></itt-loading><div ng-if="!loading"><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-click="stopEditing()">Done editing</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div class="authoringForm"><h2>Narrative</h2><div class="field"><div class="label">Customer</div><div class="input"><select ng-model="narrative.customer_id"><option ng-repeat="customer in customerList" value="{{customer._id}}">{{customer.name}}</option></select></div></div><div class="field"><div class="label">Template</div><div class="input">[TODO]</div></div><div class="field"><div class="label">Name</div><div class="input"><input ng-model="narrative.name.en"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="narrative.description.en"></textarea></div></div><div class="field"><div class="label">Path</div><div class="input"><input ng-model="narrative.path_slug.en"></div></div><div class="field"><div class="label">Support URL</div><div class="input"><input ng-model="narrative.support_url"></div></div><div class="field"><div class="label">Access</div><div class="input"><label><input type="checkbox" ng-model="narrative.guest_access_allowed">Guest access allowed [TODO]</label></div></div><div class="field controls"><button ng-if="narrative._id" ng-click="updateNarrative()"><span ng-if="narrative.saveInProgress">Saving...</span> <span ng-if="!narrative.saveInProgress">Save changes</span></button> <button ng-if="!narrative._id" ng-click="createNarrative()">Create narrative</button></div><h3>Timelines</h3><div class="storyTimeline" ng-repeat="timeline in narrative.timelines"><div class="field"><div class="label">Sort order</div><div class="input"><input ng-model="timeline.sort_order"></div></div><div class="field"><div class="label">Timeline name</div><div class="input"><input ng-model="timeline.name.en"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="timeline.description.en"></textarea></div></div><div class="field"><div class="label">Path</div><div class="input"><input ng-model="timeline.path_slug.en"></div></div><div class="field"><div class="label">Access</div><div class="input"><label><input type="checkbox" ng-model="timeline.hidden">Hidden from users</label></div></div><div class="field controls"><button ng-click="saveTimeline(timeline)"><span ng-if="timeline.saveInProgress">Saving...</span> <span ng-if="!timeline.saveInProgress">Save timeline</span></button></div></div><div style="padding: 0.5em"><button ng-if="narrative._id && !isAddingTimeline" ng-click="toggleEpisodeList()"><span ng-if="showEpisodeList">Cancel</span> <span ng-if="!showEpisodeList">Add timeline</span></button></div><div itt-episode-list="" class="admin episodePicker" ng-if="showEpisodeList">Choose an episode:<ul ng-repeat="child in root.children" x-for-admin="true" itt-container-episodes="containers[child._id]" depth="0"></ul></div></div></div></div>'),a.put("templates/narrativelist.html",'<div><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div ng-if="userHasRole(\'admin\')"><div ng-repeat="narrative in narratives"><a href="/#/story/{{narrative.path_slug.en}}">{{narrative.name.en}}</a></div><span ng-if="showAddNarrative"><hr><a href="/#/story/?admin">Create new narrative</a></span></div></div>'),a.put("templates/navpanel.html",'<span class="navPanel"><div class="parent" ng-repeat="parent in episode.parents" ng-bind-html="parent.display_name"></div><div class="scene" x-ng-if="scene.display_title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)"><span class="displayTime">{{scene.displayStartTime}}</span><p><button class="fakeLink" tabindex="0" ng-bind-html="scene.display_title" x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus="showControls()"></button><br><span ng-bind-html="scene.display_description"></span></p></div><div class="crossEpisode"><a class="prevEpisode" ng-if="episode.previousEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.previousEpisodeContainer.episodes[0]}}" title="{{episode.previousEpisodeContainer.display_name}}">Previous episode</a> <a class="nextEpisode" ng-if="episode.nextEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}}" title="{{episode.nextEpisodeContainer.display_name}}">Next Episode</a></div></span>'),a.put("templates/player-timeline.html",'<span><div ng-if="showPlayer" ng-controller="PlayerController" ng-include="\'templates/player.html\'"></div></span>'),a.put("templates/player.html","<div ng-class=\"{\n	isTouchDevice: appState.isTouchDevice,\n	isFramed: appState.isFramed,\n	isProducer: (appState.product == 'producer'),\n	isSxS: (appState.product == 'sxs'),\n\n	canEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == 'producer' || appState.product == 'sxs')\n"+'	}"><div class="player"><itt-toolbar-story></itt-toolbar-story><itt-loading ng-if="loading"></itt-loading><div ng-show="!loading" itt-episode="" ng-class="{\n		padForEditing: appState.editEvent || appState.editEpisode,\n		showBackgroundOnly: appState.producerEditLayer < 0,\n		showForegroundOnly: appState.producerEditLayer > 0,\n	}"></div><div class="toolbar-bottom" itt-show-hide-visual-only="appState.videoControlsActive" ng-mouseenter="showControls();" ng-click="showControls();" ng-mouseleave="allowControlsExit()"><div class="toolbar-bottom-fill"><div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"><div ng-if="appState.editEvent" itt-item-editor="appState.editEvent"></div><div ng-if="appState.editEpisode" itt-episode-editor="appState.editEpisode"></div></div><div itt-timeline=""></div></div></div><div class="toolbar-bottom-controltrigger" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()"></div></div><div class="animate transitionFade" ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()" sxs-add-content=""></div><div class="autoscroll" ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click="enableAutoscroll()"><img src="/images/autoscroll.svg" width="32" height="32"></div><div ng-show="show.navPanel" class="modal-backdrop" ng-click="hidePanel(\'navPanel\')"></div><div ng-show="show.profilePanel" class="modal-backdrop" ng-click="hidePanel(\'profilePanel\')"></div><div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div><div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div><div ng-if="show.profilePanel" class="profilePanel" ng-class="{isFramed: appState.isFramed}"><div class="arrow-up"></div><div itt-user="" x-in-player="true"></div></div><div ng-cloak="" ng-if="show.wileyNag &&  (appState.productLoadedAs == \'player\'\n	 			|| (appState.productLoadedAs == \'narrative\'\n	 			&& !narrative.disable_new_window ) )" class="wileyNag animate transitionFade"><div><span style="float:right">â¤´</span> <span style="float:right; display:inline-block; padding: 5px">Go here for best view</span></div><a class="goAway" ng-click="noWileyNag()">Don\'t show this again</a></div></div>'),a.put("templates/producer/addcontent.html",'<div ng-show="!appState.editEvent && !appState.editEpisode" class="controlPanel" ng-class="{\n	isProducer: appState.product == \'producer\',\n	isSxS: appState.product == \'sxs\'\n}"><div ng-if="appState.product == \'producer\'" class="editButtonPanel"><a class="button button-episode" ng-click="editEpisode()">Edit episode</a> <a class="button button-scene" ng-if="appState.time > 0  && appState.time < (appState.duration - 0.1) && appState.viewMode == \'discover\'" ng-click="editCurrentScene()">Edit scene</a></div><div class="producer addButtonPanel" ng-show="!item && appState.time > 0 && appState.time < (appState.duration - 0.1) "><span ng-if="expanded" style="padding: 0 1em" class="animate transitionExpandW"><span ng-if="appState.product == \'sxs\'"><a class="button button-comment" ng-click="addEvent(\'annotation\')">Comment</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">File</a> <a class="button button-video" ng-click="addEvent(\'video\')">Video</a></span> <span ng-if="appState.product == \'producer\'"><a class="button button-scene" ng-click="addEvent(\'scene\')">Add Scene</a> <a class="button button-comment" ng-click="addEvent(\'transcript\')">Transcript</a> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Annotation</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">Upload</a> </span></span> <span ng-if="!expanded"><a class="button button-add" ng-click="expand()">Add</a></span></div></div>'),a.put("templates/producer/annotator-autocomplete.html",'<div style="position:relative" ng-show="!hasAnnotator()"><input class="annotatorChooser" ng-model="searchText" ng-focus="showAutocomplete()" ng-blur="hideAutocomplete()" ng-change="handleAutocomplete()"><div class="autocompleteList animate transitionFade" ng-if="autoCompleting"><div class="autocompleteItem" ng-repeat="annotator in filteredAnnotators | orderBy:\'name\'" ng-click="select(annotator)" ng-class="{selected: ($index == preselectedItem)}" style="white-space: nowrap"><img ng-src="{{annotator.imageUrl}}"> <span ng-bind-html="(annotator.key | highlightSubstring: searchText) || \'(New speaker)\'"></span></div></div></div><div style="position:relative" ng-show="hasAnnotator()"><div sxs-input-i18n="item.annotator" x-inputtype="\'input\'"></div><a style="position: absolute; top: 3px; right: 10px" ng-click="item.annotator={}">(x)</a></div>'),a.put("templates/producer/asset-uploader.html",'<div class="assetUploader"><div ng-if="uploads.length"><div class="uploadList" ng-repeat="upload in uploads"><span class="uploadName">{{uploadStatus[$index].name}}:</span> <span class="uploadProgress"><span ng-if="uploadStatus[$index].done">Upload complete</span><div ng-if="uploadStatus[$index].error">Error</div><span ng-if="!uploadStatus[$index].done && !uploadStatus[$index].error"><progress ng-attr-max="{{uploadStatus[$index].bytesTotal}}" ng-attr-value="{{uploadStatus[$index].bytesSent}}"></progress><span ng-switch="uploadStatus[$index].percent"><span ng-switch-when="100">...</span> <span ng-switch-default="">{{uploadStatus[$index].percent}}%</span></span></span></span><div ng-if="uploadStatus[$index].error">{{uploadStatus[$index].error}}</div></div><span ng-if="uploadsinprogress > 0">{{uploadsinprogress}} files remaining <button ng-if="!paused" ng-click="pauseUpload()">Pause</button> <button ng-if="paused" ng-click="resumeUpload()">Resume</button> <button ng-click="cancelUpload()">Cancel</button></span></div><div ng-if="errormessage" ng-bind-html="errormessage"></div><div class="uploadDropTarget"><a style="float:right" ng-click="showInstructions=!showInstructions">(?)</a> Drag and drop <span ng-if="multiple">files</span> <span ng-if="!multiple">a file</span> here<br><small>or choose <span ng-if="multiple">files</span> <span ng-if="!multiple">a file</span> to upload:<input class="uploadFileInput" type="file" multiple onchange="angular.element(this).scope().handleUploads(this.files)"></small><div ng-if="showInstructions" style="text-align:left"><small>{{manPage}}</small></div></div></div>'),a.put("templates/producer/container-assets.html",'<div ng-if="showParent"><div sxs-container-assets="container.parent_id"></div></div><div class="containerAssets"><div ng-if="appState.product != \'sxs\' && container.parent_id && !showParent"><a class="goUp" ng-click="up()">Parent container</a></div><div class="title">{{container.display_name}}</div><div class="controls"><a ng-click="toggleImages()"><span ng-if="onlyImages">Images</span> <span ng-if="!onlyImages">All</span></a> &nbsp; <a ng-click="toggleGrid()"><span ng-if="gridView">â–¦</span> <span ng-if="!gridView">â˜°</span></a></div><div class="scrollPane" ng-if="!hideItems"><div ng-if="gridView"><div class="grid" ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div><div ng-if="asset._type != \'Asset::Image\'"><div class="thumbnail">{{asset._type}}</div></div>{{asset.display_name}}</div></div><table ng-if="!gridView"><tr ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><td><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div></td><td>{{asset.size |asBytes}}</td><td>{{asset.content_type}}</td><td>{{asset.display_name}}</td></tr></table></div><br><div itt-asset-uploader="container._id" multiple></div></div>'),a.put("templates/producer/episode.html",'<div class="itemEdit authoringForm"><div ng-if="appState.product == \'producer\'"><div class="ittTabs" itt-tabs=""><select ng-if="episode.languages.length > 1" size="1" ng-model="appState.lang" ng-change="forcePreview()" style="float:right; padding-right: 24px" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select><div class="ittTab" itt-tab="tabs[0]" x-tabindex="0" x-tablabel="Episode"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Public URL</div><div class="input"><input ng-click="selectText($event)" value="https://{{customer.domains[0]}}.inthetelling.com/#/episode/{{episode._id}}" readonly></div></div><div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" ng-model-options="{ debounce: 500 }" sxs-input-i18n="episode.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" ng-model-options="{ debounce: 50 }" sxs-input-i18n="episode.description" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="label">Status</div><div class="input"><select size="1" ng-model="episode.status"><option value="Published">Published</option><option value="Unpublished">Unpublished</option></select></div></div><div class="field"><div class="label">Languages</div><div class="input"><label><input type="checkbox" ng-model="langForm.en">English</label><label><input type="checkbox" ng-model="langForm.es">Spanish</label><label><input type="checkbox" ng-model="langForm.zh">Chinese</label><label><input type="checkbox" ng-model="langForm.pt">Portuguese</label><label><input type="checkbox" ng-model="langForm.fr">French</label><label><input type="checkbox" ng-model="langForm.de">German</label><label><input type="checkbox" ng-model="langForm.it">Italian</label></div></div><div class="field" ng-if="languageCount>1"><div class="label">Default language</div><div class="input"><select size="1" ng-model="episode.defaultLanguage"><option ng-disabled="!langForm.en" value="en">English</option><option ng-disabled="!langForm.es" value="es">Spanish</option><option ng-disabled="!langForm.zh" value="zh">Chinese</option><option ng-disabled="!langForm.pt" value="pt">Portuguese</option><option ng-disabled="!langForm.fr" value="fr">French</option><option ng-disabled="!langForm.de" value="pt">German</option><option ng-disabled="!langForm.it" value="it">Italian</option></select></div></div></div></div><div class="ittTab" itt-tab="tabs[1]" x-tabindex="1" x-tablabel="Master Asset"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Master asset type</div><div class="input"><select size="1" ng-model="masterAssetType"><option value="Video">Native Video</option><option value="Youtube">Youtube</option></select></div></div><div class="field" ng-if="masterAssetType == \'Video\'"><div class="label">Video</div><div class="input" ng-include="\'templates/producer/upload-masterasset.html\'"></div></div><div class="field" ng-if="masterAssetType == \'Youtube\'"><div class="label">Youtube URL</div><div class="input"><input ng-model="masterAsset.you_tube_url" style="width: 75%"><button ng-click="attachYouTube(masterAsset.you_tube_url)">Attach</button></div></div><div class="field" ng-if="showmessage"><div class="input" ng-bind-html="showmessage"></div></div><div class="field"><div class="label">Poster image</div><div class="input" ng-include="\'templates/producer/upload-poster.html\'"></div></div></div></div><div class="ittTab" itt-tab="tabs[2]" x-tabindex="2" x-tablabel="Style"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Template</div><div class="input"><select ng-model="episode.templateUrl"><option value="templates/episode/story.html">(Default)</option><option value="templates/episode/episode.html">(Unbranded)</option><option value="templates/episode/columbia.html">Columbia University</option><option value="templates/episode/columbiabusiness.html">Columbia Business School</option><option value="templates/episode/eliterate.html">e-Literate TV</option><option value="templates/episode/ewb.html">Engineers Without Borders</option><option value="templates/episode/gw.html">George Washington</option><option value="templates/episode/gwlaw.html">George Washington Law</option><option value="templates/episode/gwsb.html">George Washington Fed MOOC</option><option value="templates/episode/kellogg.html">Kellogg</option><option value="templates/episode/middlebury.html">Middlebury</option><option value="templates/episode/purdue.html">Purdue</option><option value="templates/episode/regis.html">Regis</option><option value="templates/episode/schoolclimatesolutions.html">School Climate Solutions</option><option value="templates/episode/usc.html">University of Southern California</option><option value="templates/episode/washingtonSBCTC.html">Washington SBCTC</option><option value="templates/episode/wiley1.html">Wiley</option><option value="templates/episode/wiley2.html">Wiley (without endscreen text)</option></select></div></div><div class="field"><div class="label">Typography</div><div class="input"><select size="1" ng-model="itemForm.typography"><option value="">(Default)</option><option value="Sans">Sans</option><option value="Serif">Serif</option><option value="Book">Book</option><option value="Swiss">Swiss</option></select></div></div><div class="field"><div class="label">Color</div><div class="input"><select size="1" ng-model="itemForm.color"><option value="">(Default)</option><option value="Invert">Invert</option><option value="Sepia">Sepia</option><option value="Solarized">Solarized</option><option value="Vivid">Vivid</option></select></div></div><div class="field"><div class="label">Timestamp</div><div class="input"><select size="1" ng-model="itemForm.timestamp"><option value="">(Default)</option><option value="None">No timestamp</option><option value="Inline">Inline timestamp</option></select></div></div><div class="field"><div class="label">Highlight</div><div class="input"><select size="1" ng-model="itemForm.highlight"><option value="">(Default)</option><option value="Solid">Solid</option><option value="Border">Border</option><option value="Side">Side</option><option value="Bloom">Bloom</option><option value="Highlighter">Highlighter</option><option value="Tilt">Tilt</option></select></div></div><div class="field"><div class="label">Transition</div><div class="input"><select size="1" ng-model="itemForm.transition"><option value="">(Default)</option><option value="None">No transition</option><option value="Fade">Fade</option><option value="SlideL">Slide left</option><option value="SlideR">Slide right</option><option value="ExpandW">Expand</option><option value="Pop">Pop</option></select></div></div></div></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-click="saveEpisode()">Save</button></div></div>'),
a.put("templates/producer/episodelist.html",'<div class="standaloneAncillaryPage"><div itt-episode-list=""><div ng-if="userHasRole(\'admin\')"><div class="ancillaryNav"><a class="button" href="/#/">Home</a> <a class="button" ng-click="logout()">Log out</a></div><itt-loading ng-if="loading"></itt-loading><div ng-repeat="child in root.children | orderBy:\'name.en\'" itt-container="containers[child._id]" depth="0"></div><div class="container"><div class="controls"><button disabled>TODO add customer</button></div></div><div ng-if="!userHasRole(\'admin\') || (!loading && (failedLogin || root.children.length == 0))">Looks like you aren\'t logged in as an admin -- <a ng-click="logout();">try again</a>.</div></div></div></div>'),a.put("templates/producer/inputi18n.html",'<input ng-if="inputtype==\'input\'" ng-model="field[appState.lang]"><text-angular ng-if="inputtype==\'textarea\'" name="{{textangularname}}" ng-model="field[appState.lang]" ta-paste="sanitizePastedHtml($html)" ta-default-wrap="span" ng-blur="trim()"></text-angular>'),a.put("templates/producer/inputtime.html",'<span class="floaterContainer"><input class="inputfield" ng-model="model" ng-focus="showTools(true)" ng-blur="showTools(false)" ng-model-options="{ updateOn: \'blur\' }" style="max-width: 150px" ng-class="{invalid: (fieldname == \'end_time\' && item.invalid_end_time)}"><div class="floater" ng-if="tooltip"><ul style="list-style:none; white-space:nowrap"><li style="text-align:center; font-size: 150%"><a ng-click="nudge(-5)">Â«</a> <a ng-click="nudge(-1)">â€¹</a> <span>&nbsp;&nbsp;</span> <a ng-click="nudge(1)">â€º</a> <a ng-click="nudge(5)">Â»</a></li><li ng-click="setTime(appState.time)"><a>Set to current time ({{format(appState.time)}})</a></li><span ng-if="item._type != \'Scene\' && scene().start_time > 0"><li ng-if="fieldname==\'start_time\'" ng-click="setTime(scene().start_time)"><a>Beginning of scene ({{format(scene().start_time)}})</a></li><li ng-if="fieldname==\'end_time\'" ng-click="setTime(scene().end_time)"><a>End of scene ({{format(scene().end_time)}})</a></li><li ng-if="fieldname==\'end_time\' && isTranscript()" ng-click="TODO"><a>Auto (TODO)</a></li></span></ul></div></span>'),a.put("templates/producer/item.html",'<div class="itemEdit authoringForm"><div><div ng-if="appState.product == \'sxs\'" class="authoringFormScrollContainer"><div class="field"><div class="label">Time</div><div class="input"><span sxs-input-time="item" x-input-field="start_time"></span></div></div><div ng-include="itemEditor"></div></div><div ng-if="appState.product == \'producer\'"><div class="ittTabs" itt-tabs=""><select style="float:right; padding-right: 24px" ng-if="languages.length > 1" size="1" ng-model="appState.lang" ng-change="forcePreview()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in languages"></select><div class="ittTab" itt-tab="tabs[0]" x-tabindex="0" x-tablabel="{{item._type === \'Scene\' ? \'Scene\' : \'Item\'}}"><div class="authoringFormScrollContainer"><div class="field" ng-if="!(item._type===\'Scene\' && item.start_time <= 0.1)"><div class="label">Time</div><div class="input"><span sxs-input-time="item" x-input-field="start_time"></span> <span ng-if="!(item.stop || item._type === \'Scene\')"><span class="label">&nbsp; &nbsp; &nbsp; End</span> <span sxs-input-time="item" x-input-field="end_time"></span></span></div></div><div ng-include="itemEditor"></div></div></div><div class="ittTab" itt-tab="tabs[1]" x-tabindex="1" x-tablabel="Style"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Template</div><div class="input"><span ng-if="item.producerItemType == \'scene\'"><select ng-model="item.templateUrl"><option value="templates/scene/centered.html">Centered video</option><option value="templates/scene/1col.html">One column</option><option value="templates/scene/2colL.html">Two columns</option><option value="templates/scene/2colR.html">Two columns (mirrored)</option><option value="templates/scene/cornerH.html">Corner video, horizontal</option><option value="templates/scene/cornerV.html">Corner video, vertical</option><option value="templates/scene/pip.html">Picture-in-picture</option></select><select ng-model="item.layouts[0]" ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="" ng-if="item.templateUrl != \'templates/scene/cornerH.html\' && item.templateUrl != \'templates/scene/cornerV.html\' && item.templateUrl != \'templates/scene/pip.html\'">Centered</option><option value="videoLeft">Video on left</option><option value="videoRight">Video on right</option></select></span><select ng-if="item.producerItemType == \'transcript\'" ng-model="item.templateUrl"><option value="templates/item/transcript.html">Transcript</option><option value="templates/item/transcript-withthumbnail.html">Transcript with thumbnail</option><option value="templates/item/transcript-withthumbnail-alt.html">Transcript with thumbnail B</option></select><select ng-if="item.producerItemType == \'annotation\'" ng-model="item.templateUrl"><option value="templates/item/pullquote.html">Pullquote with attribution</option><option value="templates/item/pullquote-noattrib.html">Pullquote</option><option value="templates/item/text-h1.html">Header 1</option><option value="templates/item/text-h2.html">Header 2</option><option value="templates/item/text-transmedia.html">Long text (as transmedia)</option><option value="templates/item/text-definition.html">Definition (as transmedia)</option></select><select ng-if="item.producerItemType == \'link\'" ng-model="item.templateUrl"><option value="templates/item/link.html">Link</option><option value="templates/item/link-withimage.html">Link with image</option><option value="templates/item/link-descriptionfirst.html">Link: description first</option><option value="templates/item/link-embed.html">Embedded link</option></select><select ng-if="item.producerItemType == \'image\'" ng-model="item.templateUrl"><option value="templates/item/image-fill.html">Overlay or background fill</option><option value="templates/item/image.html">Linked image</option><option value="templates/item/image-inline.html">Inline image</option><option value="templates/item/image-inline-withtext.html">Inline image with text</option><option value="templates/item/image-caption.html">Image with caption</option><option value="templates/item/image-caption-sliding.html">Image with sliding caption</option><option value="templates/item/image-thumbnail.html">Image thumbnail</option><option value="templates/item/image-plain.html">Plain image</option></select><select ng-if="item.producerItemType == \'file\'" ng-model="item.templateUrl"><option value="templates/item/file.html">Uploaded file</option></select><select ng-if="item.producerItemType == \'question\'" ng-model="item.templateUrl"><option value="templates/item/question-mc.html">Default question display</option><option value="templates/item/question-mc-image-right.html">Question with image right</option><option value="templates/item/question-mc-image-left.html">Question with image left</option></select></div></div><div class="field"><div class="label">Layout</div><div class="input"><span ng-if="item._type === \'Scene\'"><select ng-model="item.layouts[1]" ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="">Show all content items, highlight current ones</option><option value="showCurrent">Show only current items</option></select></span> <span ng-if="item._type !== \'Scene\'"><span ng-if="item.templateUrl == \'templates/item/image-fill.html\'"><select size="1" ng-model="item.layouts[0]"><option value="windowBg">Window background</option><option value="mainBg">Main content pane background</option><option value="altBg">Secondary content pane background</option><option value="mainFg">Main content pane foreground</option><option value="altFg">Secondary content pane foreground</option><option value="videoOverlay">Video overlay</option></select><select size="1" ng-model="itemForm.position"><option value="">Fit</option><option value="cover">Cover</option><option value="contain">Contain</option><option value="fill">Fill and stretch</option></select><select size="1" ng-model="itemForm.pin" ng-if="itemForm.position != \'center\' && itemForm.position != \'fill\'"><option value="tl">Top left</option><option value="tr">Top right</option><option value="bl">Bottom left</option><option value="br">Bottom right</option></select></span><select ng-if="item.templateUrl != \'templates/item/image-fill.html\'" size="1" ng-model="item.layouts[0]"><option value="windowFg">Modal</option><option value="inline">Inline</option><option value="sidebarL">Sidebar: left</option><option value="sidebarR">Sidebar: right</option><option value="burstL">Burst left margin</option><option value="burstR">Burst right margin</option><option value="burst">Burst both margins</option></select></span></div></div><div class="field" ng-if="item.producerItemType != \'scene\'"><div class="label">Flags</div><div class="input"><label><input type="checkbox" ng-model="item.required">Required</label><label><input type="checkbox" ng-model="item.stop">Stop item</label><label><input type="checkbox" ng-model="item.cosmetic">Cosmetic</label></div></div></div></div><div class="ittTab" itt-tab="tabs[2]" x-tabindex="2" x-tablabel="Customize"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Typography</div><div class="input"><select size="1" ng-model="itemForm.typography"><option value="">(Default)</option><option value="Sans">Sans</option><option value="Serif">Serif</option><option value="Book">Book</option><option value="Swiss">Swiss</option></select></div></div><div class="field"><div class="label">Color</div><div class="input"><select size="1" ng-model="itemForm.color"><option value="">(Default)</option><option value="Invert">Invert</option><option value="Sepia">Sepia</option><option value="Solarized">Solarized</option><option value="Vivid">Vivid</option></select></div></div><div class="field"><div class="label">Timestamp</div><div class="input"><select size="1" ng-model="itemForm.timestamp"><option value="">(Default)</option><option value="None">No timestamp</option><option value="Inline">Inline timestamp</option></select></div></div><div class="field"><div class="label">Highlight</div><div class="input"><select size="1" ng-model="itemForm.highlight"><option value="">(Default)</option><option value="Solid">Solid</option><option value="Border">Border</option><option value="Side">Side</option><option value="Bloom">Bloom</option><option value="Highlighter">Highlighter</option><option value="Tilt">Tilt</option></select></div></div><div class="field"><div class="label">Transition</div><div class="input"><select size="1" ng-model="itemForm.transition"><option value="">(Default)</option><option value="None">No transition</option><option value="Fade">Fade</option><option value="SlideL">Slide left</option><option value="SlideR">Slide right</option><option value="ExpandW">Expand</option><option value="Pop">Pop</option></select></div></div></div></div></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-if="\n			item._id != \'internal:editing\' && \n			!(item._type == \'Scene\' && item.start_time <= 0.01)\n		" ng-click="deleteEvent(item._id)">Delete</button> <button ng-click="saveEvent()" ng-disabled="blockDoubleClicks">Save</button></div></div>'),a.put("templates/producer/item/producer-annotation.html",'<div class="field"><div class="label">Speaker [{{appState.lang}}]</div><div class="input"><div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div></div></div><div class="field"><div class="label">Speaker thumbnail</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Annotation [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.annotation" x-inputtype="\'textarea\'" autofocus></div></div>'),a.put("templates/producer/item/producer-file.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">File</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-image.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-link.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">URL</div><div class="input"><input ng-model="item.url" ng-blur="validateItemUrl()" ng-model-options="{updateOn: \'blur\'}"></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-question.html",'<div class="field"><div class="label">Question type</div><div class="input"><select ng-model="item.data._plugin.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></div></div><div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Question text</div><div class="input" sxs-input-i18n="item.data._plugin.questiontext" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="label">Image (optional)</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class="label">{{$index | alpha}} &nbsp;<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class="input" sxs-input-i18n="distractor.text" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="input"><button ng-click="addDistractor($event)">Add distractor</button></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when correct</div><div class="input" sxs-input-i18n="item.data._plugin.correctfeedback" x-inputtype="\'textarea\'"></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when incorrect</div><div class="input" sxs-input-i18n="item.data._plugin.incorrectfeedback" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-scene.html",'<div class="field"><div class="label">Scene Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-transcript.html",'<div class="field"><div class="label">Speaker [{{appState.lang}}]</div><div class="input"><div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div></div></div><div class="field"><div class="label">Speaker thumbnail</div><div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div></div><div class="field"><div class="label">Transcript [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.annotation" x-inputtype="\'textarea\'" autofocus></div></div>'),a.put("templates/producer/item/producer-video.html",'<span class="eventIcon icon-video"></span><div class="field"><small><div style="width:20%; display:inline-block"></div><div style="width:48%; display:inline-block">Link to a video on YouTube...</div><div style="width:32%; display:inline-block">...or record your own</div></small></div><div ng-show="isRecordingVideo" class="ytRecordWidgetFloater"><div id="recordWidgetContainer"></div></div><div class="field"><div class="label">Video</div><div class="input"><div style="width:60%; display:inline-block; padding-right: 5%"><input ng-model="item.yturl"></div><div style="width:40%; display:inline-block"><button class="button" ng-click="startRecordVideo()" style="width: 48%; margin-right: 4%"><span ng-if="isRecordingVideo">Cancel</span> <span ng-if="!isRecordingVideo">Record</span></button></div><small ng-if="isRecordingVideo">Click the "Record from webcam" button above (requires Adobe Flash)</small> <small ng-if="isProcessingVideo">Your video is being processed by YouTube and will appear automatically in this episode when it is ready. (This may take a few minutes; you can safely continue editing or close this window.)</small></div></div><div class="field" ng-if="(item.url || item.yturl) && !(isRecordingVideo || isProcessingVideo)"><div class="label">YouTube url</div><div class="input"><small ng-if="item.url">{{item.url | stripParams}}</small> <small ng-if="item.yturl && !item.url">(No valid YouTube video found)</small></div></div><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="item.description.en" rows="4"></textarea></div></div>'),a.put("templates/producer/item/sxs-annotation.html",' <span class="eventIcon icon-comment"></span><div class="field"><div class="label">Comment</div><div class="input" sxs-input-i18n="item.annotation" autofocus x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-file.html",'<span class="eventIcon icon-file"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">File</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-image.html",'<span class="eventIcon icon-image"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-link.html",'<span class="eventIcon icon-link"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">URL</div><div class="input"><input ng-model="item.url" ng-blur="validateItemUrl()" ng-model-options="{updateOn: \'blur\'}"></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-question.html",'<span class="eventIcon icon-question"></span><div class="field"><div class="label">Question type</div><div class="input"><select ng-model="item.data._plugin.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></div></div><div class="field"><div class="label">Question text</div><div class="input" autofocus sxs-input-i18n="item.data._plugin.questiontext" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="label">Question Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image (optional)</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class="label">{{$index | alpha}} &nbsp;<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class="input" sxs-input-i18n="distractor.text" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="input"><button ng-click="addDistractor($event)">Add distractor</button></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when correct</div><div class="input" sxs-input-i18n="item.data._plugin.correctfeedback" x-inputtype="\'textarea\'"></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when incorrect</div><div class="input" sxs-input-i18n="item.data._plugin.incorrectfeedback" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-video.html",'<span class="eventIcon icon-video"></span><div class="field"><small><div style="width:20%; display:inline-block"></div><div style="width:80%; display:inline-block">Link to a video on YouTube...</div></small></div><div class="field"><div class="label">YouTube url</div><div class="input"><input ng-model="item.yturl"><small ng-if="item.url">{{item.url | stripParams}}</small> <small ng-if="item.yturl && !item.url">(No valid YouTube video found)</small></div></div><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/questionauthoring.html",'<div style="margin:1em"><p>This is a standalone editor for question items. Fill in the fields below, then copy the JSON data below into the existing authoring tool. To edit an existing question paste its JSON into the json field and the editor will separate it out into editable fields.</p><table class="authoringForm"><tr><td class="label">Question type</td><td><select ng-model="question.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></td></tr><tr><td class="label">Question text</td><td><textarea rows="4" ng-model="question.questiontext">\n				</textarea></td></tr><tr><td colspan="2">Answer choices. <span ng-if="question.questiontype == \'mc-formative\'">Check the correct answer (if more than one is selected, either will count as correct).</span>To remove an answer choice, just leave it blank.</td></tr><tr ng-repeat="distractor in question.distractors"><td class="label"><input type="checkbox" ng-model="distractor.correct" ng-if="question.questiontype == \'mc-formative\'"></td><td><input ng-model="distractor.text"></td></tr><tr><td class="label"><a ng-click="addDistractor()">add another</a></td><td></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for correct answer</td><td><input ng-model="question.correctfeedback"></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for incorrect answer</td><td><input ng-model="question.incorrectfeedback"></td></tr><tr><td colspan="2"><br><hr><br></td></tr><tr><td class="label">JSON data: <span ng-if="editwarning">Invalid JSON!</span></td><td><textarea rows="10" ng-model="pluginjson"></textarea></td></tr></table><br><hr><br><p class="label">Question preview:</p><div class="item"><div ng-if="preview" itt-item="questionpreview"></div></div></div>'),a.put("templates/producer/upload-masterasset.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><div ng-if="(masterAsset.original_filename) && !showUploadButtonsMaster">{{masterAsset.display_name}} <button class="button" ng-click="replaceAsset(\'Master\')">Replace this asset</button></div><div ng-if="showUploadButtonsMaster || !(masterAsset.original_filename)"><span ng-if="showUploadFieldMaster"><div itt-asset-uploader="episodeContainerId" callback="assetUploaded"></div></span> <span ng-if="!showUploadFieldMaster"><button class="button" ng-click="chooseAsset(\'Master\')">Browse uploaded assets</button> <button class="button" ng-click="toggleUpload(\'Master\')">Upload new asset</button></span></div></div>'),a.put("templates/producer/upload-poster.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><div ng-if="episode.poster && !showUploadButtonsPoster">{{episode.poster.display_name}} <button class="button" ng-click="replaceAsset(\'Poster\')">Replace this</button></div><div ng-if="showUploadButtonsPoster || !episode.poster"><span ng-if="showUploadFieldPoster"><div itt-asset-uploader="episodeContainerId" callback="posterUploaded"></div></span> <span ng-if="!showUploadFieldPoster"><button class="button" ng-click="chooseAsset(\'Poster\')">Browse uploaded</button> <button class="button" ng-click="toggleUpload(\'Poster\')">Upload new</button></span></div></div>'),a.put("templates/producer/upload-producer.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><div ng-if="item.asset && !showUploadButtons">{{item.asset.display_name}} <button class="button" ng-click="replaceAsset()">Replace this</button></div><div ng-if="showUploadButtons || !item.asset"><span ng-if="showUploadField"><div itt-asset-uploader="episodeContainerId" callback="assetUploaded"></div></span> <span ng-if="!showUploadField"><button class="button" ng-click="chooseAsset()">Browse uploaded</button> <button class="button" ng-click="toggleUpload()">Upload new</button></span></div></div>'),a.put("templates/producer/upload-sxs.html",'<div><div ng-if="(item.asset) && !showUploadButtons">{{item.asset.display_name}} <button class="button" ng-click="replaceAsset(item.asset._id)">Replace this asset</button></div><div ng-if="showUploadButtons || !(item.asset)"><div ng-if="item.producerItemType === \'image\'" itt-asset-uploader="" callback="assetUploaded" mime-types="image/*" instructions="We currently accept all image files." error-text="Please verify that the file you are trying to upload is an image."></div><div ng-if="item.producerItemType === \'file\'" itt-asset-uploader="" callback="assetUploaded" mime-types="application/*, text/*, audio/*, model/*" instructions="We currently accept all non-image or non-video files." error-text="Please make sure you are not trying to upload an image or video file."></div></div></div>'),a.put("templates/root.html",'<div class="rootLogin standaloneAncillaryPage" itt-login=""><div class="inner"><div ng-if="appState.user._id"><div itt-user=""></div></div><div ng-if="!appState.user._id"><form ng-submit="adminLogin()"><h1>Sign in to Telling STORY</h1><label><span>Username</span><input type="email" name="auth_key" ng-model="loginForm.auth_key"></label><label><span>Password</span><input type="password" name="password" ng-model="loginForm.password"></label><input class="submit button" type="submit" value="Sign in"><span class="error" ng-if="badlogin">Sorry, try again?</span></form></div><br style="clear:both"></div><small ng-if="!appState.user._id"><a href="{{apiDataBaseUrl}}/oauth2">OAuth</a></small></div>'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class="videoMagnet" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="col"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div class="col col2"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),
a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col col2"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow,\n				isEmpty: contentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class="row"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="row"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/endingscreen.html",'<div class="endingscreen stretchToViewport"><div class="pane introtext"><p>Thanks for watching <span ng-bind-html="episode.display_title"></span>.</p><br></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div>'),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewportShort"><div><div class="pane introtext"><h1 ng-bind-html="episode.display_title"></h1><p ng-bind-html="episode.display_description"></p><br></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="landingscreen-end"></div><div class="clear"></div></div></div>'),a.put("templates/scene/pip.html",'<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer showCurrent" ng-class="{\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div>'),a.put("templates/searchpanel.html",'<div ng-class="episode.styleCss"><div aria-label="sort toggle" class="searchfilters" aria-controls="sortableSearch"><div>Sorted by <button tabindex="0" class="fakeLink" ng-click="toggleSortBy(sortBy)" aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button></div></div><div class="scrollContainer"><div class="searchResults content" id="sortableSearch" itt-width-watch="" ng-class="{isNarrow: isNarrow}"><div ng-if="sortBy == \'startTime\'" class="sortByTime"><h1 ng-bind-html="episode.display_title"></h1><div ng-repeat="scene in episode.scenes"><h2 class="searchCategory" ng-if="scene.start_time > 0 && ([scene.display_title] | filter:appState.searchText).length" ng-bind-html="scene.display_title  | highlightSubstring: appState.searchText"></h2><span ng-switch="appState.product"><div ng-switch-when="producer" ng-repeat="item in sceneItems=(scene.items | orderBy:\'wtfchromesort\')" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div><div ng-switch-default="" ng-repeat="item in sceneItems=(scene.items | orderBy:\'wtfchromesort\' | filter:{cosmetic:false})" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div></span></div></div><div ng-if="sortBy == \'type\'" class="sortByType"><div ng-repeat="category in typeCategories"><h3 ng-if="matchedItems.length > 0" ng-bind-html="showTypes[category].name"></h3><div class="item animate" ng-repeat="item in matchedItems=\n						(showTypes[category].items\n						| orderBy:\'wtfchromesort\'\n						)" ng-show="\n							([item.searchableText] | filter:appState.searchText).length\n						" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div></div><div ng-if="(episode.items | filter:{\'searchableText\': appState.searchText||\'\', \'cosmetic\': false}).length == 0">(Nothing matched your search.)</div></div></div></div></div>'),a.put("templates/testbed-event.html",'<style>.testContentPane {\n	border: 1px solid #000;\n	position: absolute;\n	overflow: hidden;\n	top: 3em;\n	left: 2em;\n	right: 2em;\n	bottom: 10em;\n}\n.testEditorPane {\n	position: absolute;\n	bottom: 0;\n	z-index: 2;\n	left: 0;\n	right: 0;\n	height: 10em;\n	overflow-y: scroll;\n}\nlabel {\n	margin: 0 2em;\n}</style><div class="controls"><label>Content pane type:<select size="1" ng-model="testbed.contentType" ng-init="testbed.contentType=\'content\'"><option value="content">Content</option><option value="fill">Overlay</option></select></label><label ng-if="testbed.contentType == \'content\'"><input type="checkbox" ng-model="testbed.isNarrow">Narrow content pane</label><label>Item state:<select size="1" ng-model="item.state" ng-init="item.state=\'isCurrent\'"><option value="isCurrent">Current</option><option value="isPast">Past</option><option value="isFuture">Future</option></select></label><label><input type="checkbox" ng-model="testbed.showCurrent" ng-init="testbed.showCurrent = false;">Hide non-current items</label></div><div class="testContentPane allowHighlights allowSidebars hasLeftSidebar hasRightSidebar {{testbed.contentType}}" ng-class="{isNarrow: testbed.isNarrow, showCurrent: testbed.showCurrent}"><div ng-if="!(testbed.showCurrent && item.state!=\'isCurrent\')" class="item animate" itt-item="item" ng-class="item.styleCss + \' \' + item.state"></div></div><div class="testEditorPane" itt-item-editor="item"></div>'),a.put("templates/timeline-story.html",'<div class="timeline" ng-show="!isSuppressed" ng-cloak=""><button tabindex="0" ng-focus="showControls()" class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()"><span class="control-text">Play</span></button> <button tabindex="0" ng-focus="showControls()" class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()"><span class="control-text">Pause</span></button><div class="progressbarBox"><div class="pbarTop"><span ng-if="appState.product == \'producer\'"><a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()"><span class="control-text">Zoom out</span></a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click="zoomIn()"><span class="control-text">Zoom in</span></a></span></div><div class="pbarMain"><button ng-focus="showControls()" ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click="prevScene()"><span class="control-text">Previous</span></button> <button ng-focus="showControls()" tabindex="0" ng-class="{invisible: appState.time >= appState.duration-0.1}" class="button button-next" ng-click="nextScene()"><span class="control-text">Next</span></button><div class="progressbar"><div class="mask"><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="buffered" ng-style="{width: appState.bufferedPercent+\'%\'}"></div><div class="played" ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="handle" ng-show="isSeeking" ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class="tip" ng-show="seekHandleVisible">{{willSeekTo | asTime}}</div></div><div class="tooltip" ng-if="event.showTooltip" ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"><span ng-if="!event.stop" class="content" ng-bind-html="event.display_title || \'(&quot;Hidden&quot; scene)\'"></span> <span ng-if="event.stop" class="content">Stop item</span></div><div class="handle sxsHandle playhead" ng-show="appState.editEvent" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\'}"><div class="tip" ng-click="">{{appState.editEvent.start_time | asTime}}</div></div></div><div class="playhead mask"><div class="progressbarContainer" ng-style="{width: zoomLevel+\'00%\'}"><div class="marker" ng-mouseover="showTooltip(event);" ng-mouseout="hideTooltip(event)" ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}" ng-if="event.stop || event.display_title || appState.product == \'producer\'" ng-class="{stop: event.type != \'Scene\', mini: (event.type == \'Scene\' && !event.display_title)}"></div><div ng-if="appState.editEvent" class="editingItem" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(appState.duration - appState.editEvent.end_time)+\'%\'}"></div></div></div></div></div><div class="pbarBottom"><span class="timedisplay">{{appState.time | asTime}} / {{appState.duration | asTime}} <span class="speedcontrol" ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(-0.25)" aria-label="Slow down video"><div ng-class="{arrowLeft: appState.timeMultiplier > 0.5}"></div></button> <span class="speeddisplay" ng-click="resetSpeed()">{{appState.timeMultiplier}}x</span> <button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(0.25)" aria-label="Speed up video"><div ng-class="{arrowRight: appState.timeMultiplier < 2}"></div></button></span></span> <span style="display:inline-block;height:1em;position:relative" ng-if="episode.languages.length > 1"><select size="1" ng-model="appState.lang" class="languageSelector" ng-change="setNewLanguage()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></span> <button ng-focus="showControls()" tabindex="0" ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class="control-text">Captions</span></button> <a ng-if="appState.viewMode==\'watch\'" class="button button-fullscreen active" ng-click="viewMode(\'discover\')"><span class="control-text">Exit fullscreen</span></a> <a ng-if="appState.viewMode!=\'watch\'" class="button button-fullscreen" ng-click="viewMode(\'watch\')"><span class="control-text">Fullscreen video</span></a> <span ng-if="!appState.isTouchDevice"><button ng-focus="showControls()" tabindex="0" class="button button-mute {{audioIcon()}}" ng-click="toggleMute()"><span class="control-text">Mute</span></button><itt-volume-slider></itt-volume-slider></span></div></div></div>'),a.put("templates/toolbar-story.html",'<div class="toolbar"><div class="buttongroup"><a ng-if="appState.productLoadedAs == \'narrative\' && !narrative.disable_navigation" class="button button-exitEpisode" href="/#/story/{{narrative.path_slug.en}}"><span>Exit</span></a> <button tabindex="0" class="button button-nav" ng-click="toggleNavPanel();"><span>Scenes</span></button> </div><div ng-if="appState.isFramed && (appState.productLoadedAs == \'player\'\n	 			|| (appState.productLoadedAs == \'narrative\'\n	 			&& !narrative.disable_new_window ) )" class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-click="pause()" ng-href="{{newWindowUrl}}&t={{appState.time || 0}}&access_token={{appState.user.access_token}}" target="_blank"><span>New window</span></a></div><div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><button tabindex="2" class="button button-search" ng-click="toggleSearchPanel()" aria-label="Search" aria-expanded="{{show.searchPanel}}"><span>Search</span></button><label for="searchtext" class="hidden">Search Text</label><input tabindex="2" name="searchtext" id="searchtext" ng-show="show.searchPanel" ng-model="appState.searchText" ng-model-options="{ debounce: 200 }"></div><div class="profilegroup buttongroup" ng-if="appState.productLoadedAs != \'player\'"><a class="button button-preview" ng-if="appState.productLoadedAs==\'producer\' && userHasRole(\'admin\')" ng-click="toggleProducerPreview()"><span ng-if="appState.product == \'producer\'">Preview</span> <span ng-if="appState.product == \'player\'">Edit</span></a> <a class="button button-profile" ng-click="appState.show.profilePanel = !appState.show.profilePanel"><span>Profile</span></a></div></div><div ng-cloak="" ng-show="show.navPanel" class="navPanel topDrawer" ng-class="episode.styleCss"><div class="parent" ng-repeat="parent in episode.parents" ng-bind-html="parent.display_name"></div><div class="scene" x-ng-if="scene.display_title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)"><span class="displayTime">{{scene.displayStartTime}}</span><p><button class="fakeLink" tabindex="0" ng-bind-html="scene.display_title" x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus="showControls()"></button><br><span ng-bind-html="scene.display_description"></span></p></div></div>'),a.put("templates/user.html",'<div class="userHome"><p><i><span ng-bind="user.role_description"></span></i></p><div style="float:right; width: 79px"><div class="avatar" ng-click="toggleUploadAvatar()" style="cursor:pointer;cursor:hand"><img ng-src="{{user.avatar || \'/images/no-avatar.gif\'}}"></div><input ng-if="showUploadField && !uploads" style="width: 70px" type="file" onchange="angular.element(this).scope().uploadAvatar(this.files)"><progress ng-if="uploads" style="width:79px" ng-attr-max="{{uploadStatus[0].bytesTotal}}" ng-attr-value="{{uploadStatus[0].bytesSent}}"></progress></div><div style="margin-right:80px"><label><span>Name</span><input class="userEditable" ng-model="user.name" ng-blur="updateUser()"></label><span ng-if="!userHasRole(\'guest\')"><br><label><span>Email</span><input class="userEditable" ng-model="user.email" readonly></label></span></div><div style="clear:both; padding-top: 2em"><a style="float:left" target="_top" href="/#/user" class="button" ng-if="inPlayer && user._id && appState.productLoadedAs != \'narrative\'">Home</a> <a style="float:right" class="button" ng-if="user._id && !appState.isFramed" ng-click="logout()">Sign out</a></div><div ng-if="!inPlayer"><div ng-if="userHasRole(\'admin\')"><a href="/#/episodes">Find episodes</a><br><a href="/#/stories">Find narratives</a></div><div ng-if="!userHasRole(\'guest\') && myPurchases"><h3>Your purchases</h3><div class="narrativelist" ng-repeat="purchase in myPurchases"><div ng-if="purchase.daysUntilExpiration < 0"><h3>{{purchase.narrativeData.name.en}}</h3><p>We\'re sorry, this purchase has expired.</p></div><div ng-if="purchase.daysUntilExpiration >=0 || !purchase.daysUntilExpiration"><h3><a ng-href="/#/story/{{purchase.narrativeData.path_slug.en}}">{{purchase.narrativeData.name.en}}</a></h3><p><i>{{purchase.daysUntilExpiration}} days remaining</i></p><p>{{purchase.narrativeData.description.en}}</p></div></div><div ng-if="myPurchases.length == 0">You have not purchased any stories.</div></div></div></div>'),a.put("templates/video.html",'<div class="video"><itt-youtube tabindex="-1" ng-if="video.urls.youtube.length" embed-url="{{video.urls.youtube[0]}}" on-player-state-change="playerStateChange" on-ready="onReady" main-player="video._id"></itt-youtube><video ng-if="!video.urls.youtube || !video.urls.youtube.length" aria-label="media player"><source class="m3u8" ng-if="video.urls.m3u8[0]" ng-src="{{video.urls.m3u8[0]}}" type="application/x-mpegURL"><source class="mpeg4" ng-if="video.urls.mp4[video.curStream]" ng-src="{{video.urls.mp4[video.curStream]}}" type="video/mp4"><source class="webm" ng-if="video.urls.webm[video.curStream]" ng-src="{{video.urls.webm[video.curStream]}}" type="video/webm"><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-if="poster && appState.time == 0" class="poster overlay fill" ng-style="{backgroundImage:\'url(\'+poster.url+\')\'}"></div><div ng-hide="( video.urls.youtube.length && !appState.hasBeenPlayed && appState.isTouchDevice)" ng-click="videoClick()" class="videoMask" ng-class="{\n		play: appState.timelineState == \'paused\',\n		buffering: appState.timelineState == \'buffering\',\n		firstplay: !appState.hasBeenPlayed && !poster,\n		rewind: (appState.time > 0 && appState.time >= video.duration - 0.3),\n		transcoding: !video.isTranscoded()\n	}"><div class="convertingMessage" ng-if="!video.isTranscoded()">This video is being converted to a web-playable format and will be ready in a&nbsp;few&nbsp;minutes</div></div></div>')}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config?window.config:{};return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a.localStorageKey||(a.localStorageKey="storyToken"),a.youtube||(a.youtube={domain:"//gdata.youtube.com/",timeout:5e3}),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","config",function(a,b){var c={};return c.init=function(){c.user=c.user||{},c.episodeId=!1,c.episodeSegmentId=!1,c.narrativeId=!1,c.timelineId=!1,c.isFramed=window.parent!=window,c.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),c.isIPhone=navigator.platform.match(/iPod|iPhone/),c.windowWidth=0,c.windowHeight=0,c.viewMode=$(window).width()>480?"discover":"review",c.producerEditLayer=0,c.time=0,c.bufferedPercent=0,c.timeMultiplier=1,c.duration=0,c.timelineState="paused",c.hasBeenPlayed=!1,c.volume=100,c.muted=!1,c.hideCaptions=!1,c.show={searchPanel:!1,navPanel:!1},c.videoControlsActive=!1,c.videoControlsLocked=!1,c.itemDetail=!1,c.autoscroll=!1,c.autoscrollBlocked=!1,c.product=c.product,c.productLoadedAs=c.productLoadedAs,"sxs"===c.product||"producer"===c.product?c.crossEpisodePath=c.product:c.crossEpisodePath="episode",c.editEvent=!1,c.editEpisode=!1,c.lang=!1},c.init(),a(function(){c.windowHeight=angular.element(window).height(),c.windowWidth=angular.element(window).width()},50,0,!1),b.debugInBrowser,c}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","appState","modelSvc","errorSvc",function(a,b,c,d,e,f,g,h){var i={};i.userHasRole=function(a){if(f.user&&f.user.roles)for(var b=0;b<f.user.roles.length;b++)if(f.user.roles[b].role===a)return!0;return!1};var j={ADMINISTRATOR:"admin",INSTRUCTOR:"instructor",STUDENT:"student",GUEST:"guest"};i.getRoleForNarrative=function(a,b){b=void 0!==b?b:f.user.roles;var c="",d=!1;if(b)for(var e=0;e<b.length;e++){switch(b[e].role){case j.ADMINISTRATOR:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="admin",d=!0;break;case j.INSTRUCTOR:if(b[e].resource_id&&b[e].resource_id!==a)continue;c=b[e].role;break;case j.STUDENT:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="instructor"===c?c:b[e].role;break;case j.GUEST:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="instructor"===c||"student"===c?c:b[e].role}if(d)break}return c},i.getDefaultProductForRole=function(a){var b="player";return"narrative"===f.productLoadedAs?(a===j.ADMINISTRATOR||a===j.INSTRUCTOR)&&(b="sxs"):h.error({data:"authSvc.getDefaultProductForRole should only be used within narratives for now"}),b},i.logout=function(){try{localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(b){}f.user={},c({method:"GET",url:a.apiDataBaseUrl+"/logout"}).success(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})}).error(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})})},i.adminLogin=function(b,e){var f=d.defer();return c({method:"POST",url:a.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:b,password:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',l(a),i.getCurrentUser().then(function(){f.resolve(a)})}).error(function(a){f.reject(a)}),f.promise};var k=d.defer();i.authenticate=function(d){if(c.defaults.headers.common.Authorization)f.user?k.resolve():i.getCurrentUser().then(function(){k.resolve()},function(){return i.authenticateViaNonce(d)});else{if(b.key){var g=b.key;return e.search("key",null),i.getAccessToken(g)}var h=i.getStoredToken();if(!h)return i.authenticateViaNonce(d);c.defaults.headers.common.Authorization='Token token="'+h+'"',i.getCurrentUser().then(function(){k.resolve()},function(){try{localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(b){}return f.user={},i.authenticateViaNonce(d)})}return k.promise},i.authenticateViaNonce=function(a){var b=d.defer();return i.getNonce(a).then(function(a){i.getAccessToken(a).then(function(){b.resolve()})}),b.promise},i.getStoredToken=function(){var b={};try{if(!localStorage)return!1;localStorage.getItem(a.localStorageKey),b=angular.fromJson(localStorage.getItem(a.localStorageKey));var c=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];return b.customer!==c&&(localStorage.removeItem(a.localStorageKey),b={}),b.token||!1}catch(d){return!1}},i.getCurrentUser=function(){var b=d.defer();return c({method:"GET",url:a.apiDataBaseUrl+"/show_user"}).success(function(a){l(a),b.resolve()}).error(function(){b.reject()}),b.promise},i.updateUser=function(b){var e=d.defer();return c({method:"PUT",url:a.apiDataBaseUrl+"/users/"+b._id,data:b}).success(function(a){l(a),e.resolve()}).error(function(){e.reject()}),e.promise};var l=function(b){if(null!==b.roles&&void 0!==b.roles&&b.roles.length>0&&b.roles[0].constructor===String){for(var d=[],e=0;e<b.roles.length;e++){var h={role:b.roles[e]};d.push(h)}b.roles=d}var i={access_token:b.access_token||b.authentication_token,customer:a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:b.roles};angular.forEach(["_id","name","email","track_event_actions","track_episode_metrics","avatar_id"],function(a){b[a]&&(i[a]=b[a])}),i.avatar_id&&c.get(a.apiDataBaseUrl+"/v1/assets/"+i.avatar_id).then(function(a){g.cache("asset",a.data),f.user.avatar=a.data.url}),b["track_episode_metrics:"]&&(i.track_episode_metrics=!0),i.roles&&(i.role_description=m(i.roles[0])),b.emails&&(i.email=b.emails[0]),f.user=i;try{localStorage.setItem(a.localStorageKey,JSON.stringify({token:i.access_token,customer:i.customer}))}catch(j){}},m=function(a){return void 0===a?"User":"admin"===a.role?"Administrator":void 0===a.role?"User":"guest"===a.role?"Guest user":a.role.match(/student/i)?"Student":a.role.match(/instructor/i)?"Instructor":a};return i.getNonce=function(b){var e=d.defer(),f=a.apiDataBaseUrl+"/v1/get_nonce";return b&&(f=f+"?"+b),c.get(f).success(function(a){a.nonce?e.resolve(a.nonce):a.login_url&&null!==a.login_url?(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url,e.reject()):("#/"!==window.location.hash&&(window.location.href="/#/"),e.reject())}).error(function(){e.reject()}),e.promise},i.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){l(a),c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',i.getCurrentUser().then(function(){e.resolve(a)})}).error(function(){e.reject()}),e.promise},i}]),angular.module("com.inthetelling.story").factory("awsSvc",["config","$routeParams","$http","$q",function(a,b,c,d){var e,f,g,h,i=1e3,j=3,k="public-read",l="pending",m="uploading",n="complete",o={},p={s3:{}},q=5242880,r=0,s=0,t=0,u=[],v=0,w=[],x=0,y=0,z=[],A=!1;
o.awsCache=function(){return p},o.getBucketListing=function(){var a=d.defer();return C().then(function(){p.s3.listObjects(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},o.uploadContainerFiles=function(a,b){return B("/v1/containers/"+a+"/assets",b)},o.uploadUserFiles=function(a,b){return B("/v1/users/"+a+"/assets",b)};var B=function(a,b){for(var c=[],e=0;e<b.length;e++){w.push(b.item(e));var f=d.defer();z.push(f),c.push(f.promise)}return D(a),c};o.pauseUpload=function(){if(e&&!A){if(A=!0,P(),G())y=0;else{var a=0;for(y=0;s>a;){var b=u[a];b.status===n&&(y+=b.uploaded),a++}}g.notify({bytesSent:y,bytesTotal:e.size})}},o.resumeUpload=function(){if(e&&A)if(A=!1,G())I();else for(var a=0;j>a;a++)M()},o.cancelUpload=function(){e&&(A=!1,y=0,P(),G()||(o.cancelMultipartUpload(f),f=null),e=null,z[x].reject("Canceled by user"));for(var a=x+1;a<w.length;a++)z[a].reject("Canceled by user");x=w.length},o.networkError=function(){e&&P()},o.deleteObject=function(a){var b=d.defer();return C().then(function(){var c={Bucket:a.bucket,Key:a.Key};p.s3.deleteObject(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise},o.getMultipartUploads=function(){var a=d.defer();return C().then(function(){p.s3.listMultipartUploads(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},o.getMultipartUploadParts=function(a,b){var c=d.defer();return C().then(function(){var d={Bucket:b.bucket,Key:b.Key,UploadId:b.UploadId};p.s3.listParts(d,function(b,d){b?c.reject():c.resolve({i:a,parts:d})})}),c.promise},o.cancelMultipartUpload=function(a){var b=d.defer();return C().then(function(){var c={Bucket:a.bucket,Key:a.Key,UploadId:a.UploadId};p.s3.abortMultipartUpload(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise};var C=function(){return p.hasOwnProperty("sessionDeferred")?p.sessionDeferred.promise:(p.sessionDeferred=d.defer(),c.get(a.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(b){if(b.access_key_id){AWS.config.update({accessKeyId:b.access_key_id,secretAccessKey:b.secret_access_key,sessionToken:b.session_token,region:a.awsRegion});var c={params:{Bucket:b.bucket,Prefix:b.key_base}};p.s3=new AWS.S3(c),p.sessionDeferred.resolve(b)}else p.sessionDeferred.reject()}).error(function(){p.sessionDeferred.reject()}),p.sessionDeferred.promise)},D=function(a){if(w.length>x&&!e){if(e=w[x],""===e.type)return z[x].reject("Could not determine file type for file '"+e.name+"'"),e=null,x++,void D(a);E().then(function(){var b;b=G()?H():J(),b.then(function(){Q(a)},function(a){z[x].reject(a)},function(a){z[x].notify(a)})})}},E=function(a){return a=a||d.defer(),e.uniqueName=F(),C().then(function(){var b={Key:p.s3.config.params.Prefix+e.uniqueName};p.s3.headObject(b,function(b){b?404!==b.statusCode?a.reject(b):G()?a.resolve():o.getMultipartUploads().then(function(b){var c=function(a){for(var d=0;d<b.Uploads.length;d++)if(b.Uploads[d].Key===p.s3.config.params.Prefix+a)return c(F());return a};e.uniqueName=c(e.uniqueName),a.resolve()}):(e.uniqueName=F(),E(a))})}),a.promise},F=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b},G=function(){return e.size<=q?!0:!1},H=function(){return g=d.defer(),I().then(function(){},function(){},function(){}),g.promise},I=function(){var a=d.defer();return C().then(function(){var a={Key:p.s3.config.params.Prefix+e.uniqueName,ContentType:e.type,Body:e,ACL:k};h=p.s3.putObject(a,function(a,b){a?g.reject():g.resolve(b)}),h.on("httpUploadProgress",function(a){g.notify({bytesSent:a.loaded,bytesTotal:a.total})}).on("error",function(a){g.reject(a)})},function(){},function(){}),a.promise},J=function(){return g=d.defer(),K().then(L).then(function(){for(var a=0;j>a;a++)M()}),g.promise},K=function(){var a=d.defer();return C().then(function(){var b={Key:p.s3.config.params.Prefix+e.uniqueName};p.s3.createMultipartUpload(b,function(b,c){b?a.reject():a.resolve(c)})}),a.promise},L=function(a){var b=d.defer();f=a,u=[],s=0,t=0,v=0,r=q,y=0,e.size>r*i&&(r=Math.ceil(e.size/i)),s=Math.ceil(e.size/r);for(var c=0;s>c;c++){var g={};g.start=c*r,g.end=g.start+r,g.uploaded=0,g.end>e.size&&(g.end=e.size),g.status=l,u.push(g)}return b.resolve(),b.promise},M=function(){var a=d.defer(),b=v,c=!1;if(A)a.reject("Upload paused");else{for(;!c&&s>b;){var f=u[b];if(f.status===l){c=!0,f.status=m;var g=e.slice(f.start,f.end);f.cancel=function(){f.request.abort(),f.status=l,f.uploaded=0},d.all({partNumber:d.when(b+1),eTag:N(b+1,g)}).then(O).then(function(b){a.resolve(b)},function(b){a.reject(b)},function(b){a.update(b)})}else f.status===n&&b===v&&v++;b++}c||a.reject("All chunks uploaded")}return a.promise},N=function(a,b){var c=d.defer();return C().then(function(){var d={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,PartNumber:a,Body:b};u[a-1].request=p.s3.uploadPart(d,function(a,b){a?c.reject():c.resolve(b.ETag)}),u[a-1].request.on("httpUploadProgress",function(b){y+=b.loaded-u[a-1].uploaded,u[a-1].uploaded=b.loaded,g.notify({bytesSent:y,bytesTotal:e.size})}).on("error",function(a){g.reject(a)})}),c.promise},O=function(a){var b=d.defer();if(u[a.partNumber-1].status=n,u[a.partNumber-1].part={ETag:a.eTag,PartNumber:a.partNumber},t++,t===s){for(var c=[],e=0;s>e;e++)c.push(u[e].part);var h={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,MultipartUpload:{Parts:c}};p.s3.completeMultipartUpload(h,function(a,c){a?(g.reject(a),b.reject(a)):(h={Bucket:f.Bucket,Key:f.Key,ACL:k},p.s3.putObjectAcl(h,function(a){a&&(g.reject(a),b.reject(a))}),g.resolve(c),b.resolve(c))})}else M();return b.promise},P=function(){if(G())h.abort();else for(var a=v,b=!1;!b&&s>a;){var c=u[a];c.status===m?c.cancel():c.status===l&&(b=!0),a++}},Q=function(b){var f=d.defer(),g={url:"https://s3.amazonaws.com/"+p.s3.config.params.Bucket+"/"+p.s3.config.params.Prefix+e.uniqueName,type:e.type,size:e.size,original_filename:e.name};return c.post(a.apiDataBaseUrl+b,g).success(function(a){z[x].resolve(a),e=null,x++,D(b)}).error(function(){z[x].reject(),e=null,x++,D(b)}),f.promise};return o}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","$rootScope","config","authSvc","appState","modelSvc","errorSvc","mockSvc","questionAnswersSvc",function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};m.getNarrative=function(c){var d=a.defer();return g.authenticate("narrative="+c).then(function(){b.get(f.apiDataBaseUrl+"/v3/narratives/"+c+"/resolve").then(function(a){i.cache("narrative",m.resolveIDs(a.data)),d.resolve(i.narratives[a.data._id])})}),d.promise},m.getNarrativeOverview=function(a){return x("/v3/narratives/"+a)};var n=!1;m.getUserNarratives=function(b){if(n){var c=a.defer();return c.resolve(n),c.promise}return x("/v3/users/"+b+"/narrative_purchases",function(a){return n=a,a})},m.getCustomerList=function(){return x("/v3/customers/",function(a){return angular.forEach(a,function(a){i.cache("customer",a)}),a})},m.getCustomer=function(a){return g.userHasRole("admin")?void(i.customers[a]||(i.cache("customer",{_id:a}),x("/v3/customers/"+a,function(a){i.cache("customer",a)}))):!1},m.getEpisode=function(a,b){if(!a)throw"no episode ID supplied to dataSvc.getEpisode";i.cache("episode",{_id:a}),c.local?(k.mockEpisode(a),e.$emit("dataSvc.getEpisode.done")):g.authenticate().then(function(){return r()}).then(function(){return u(a,b)})},m.getEpisodeOverview=function(a){return x("/v3/episodes/"+a)},m.getNarrativeList=function(){return x("/v3/narratives/")},m.createUserGroup=function(a){return z("/v3/groups",{group:{name:a}})},m.createNarrative=function(a){return delete a.templateUrl,z("/v3/narratives",a)},m.updateNarrative=function(a){return delete a.templateUrl,y("/v3/narratives/"+a._id,a)},m.createChildEpisode=function(a){return z("/v3/episodes",{episode:a})},m.createEpisodeSegment=function(a,b){return z("/v3/timelines/"+a+"/episode_segments",b)},m.storeTimeline=function(a,b){return b._id?y("/v3/timelines/"+b._id,b,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a}):z("/v3/narratives/"+a+"/timelines",b,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a})},m.getSingleAsset=function(b){return b?x("/v1/assets/"+b):a(function(a){a(void 0)})};var o={template:{},layout:{},style:{}},p=!1,q=a.defer(),r=function(){return p?q.promise:(p=!0,a.all([b.get(f.apiDataBaseUrl+"/v1/templates"),b.get(f.apiDataBaseUrl+"/v1/layouts"),b.get(f.apiDataBaseUrl+"/v1/styles")]).then(function(a){m.cache("templates",a[0].data),m.cache("layouts",a[1].data),m.cache("styles",a[2].data),p=!0,q.resolve()},function(){p=!1,q.reject()}),q.promise)};m.getCommon=r,m.cache=function(a,b){angular.forEach(b,function(b){"templates"===a?o.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?o.layout[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name}:"styles"===a&&(o.style[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name})})},m.createTemplate=function(a){return z("/v1/templates",a)},m.resolveIDs=function(a){if(a.everyone_group&&!a.template_id&&(a.templateUrl="templates/narrative/default.html"),a.template_id&&(o.template[a.template_id]?(a.templateUrl=o.template[a.template_id].url,delete a.template_id):j.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){o.layout[a]?b.push(o.layout[a].css_name):j.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b)}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){o.style[a]?c.push(o.style[a].css_name):j.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c)}return a};var s=function(a){return a.hasOwnProperty("asset_id")&&a.asset_id?a.asset_id:a.hasOwnProperty("annotation_image_id")&&a.annotation_image_id?a.annotation_image_id:a.hasOwnProperty("link_image_id")&&a.link_image_id?a.link_image_id:a.hasOwnProperty("avatar_id")&&a.avatar_id?a.avatar_id:void 0},t=function(a){for(var b={},c=0,d=a.length;d>c;c++){var e=s(a[c]);e&&(e in b||(b[e]=0))}var f=Object.keys(b);return f};m.getAssetsByAssetIds=function(a,c){var d="/v1/assets",e={};return e.asset_ids=a,b.post(f.apiDataBaseUrl+d,e).success(function(a){c(a)}).error(function(){c()})};var u=function(a,c){var d=c?"/v3/episode_segments/"+c+"/resolve":"/v3/episodes/"+a;b.get(f.apiDataBaseUrl+d).success(function(b){var d={};b&&(d=b.episode?b.episode:b),"Published"===d.status||g.userHasRole("admin")?(i.cache("episode",m.resolveIDs(d)),v(a,c).success(function(b){b=b||[],w(b,"Plugin",a),angular.forEach(b,function(b){b.cur_episode_id=a,i.cache("event",m.resolveIDs(b))}),i.resolveEpisodeEvents(a);var c=t(b);c=void 0!==c&&c.length>0?c:[],c.push(d.master_asset_id),d.poster_frame_id&&c.push(d.poster_frame_id),m.getAssetsByAssetIds(c,function(b){angular.forEach(b.files,function(a){i.cache("asset",a)}),i.resolveEpisodeAssets(a),e.$emit("dataSvc.getEpisode.done")})}).error(function(){j.error({data:"API call to get events failed."})})):j.error({data:"This episode has not yet been published."})}).error(function(){j.error({data:"API call to /v3/episodes/"+a+" failed (bad episode ID?)"})})};m.getContainerAncestry=function(b,c,d){return d=d||a.defer(),m.getContainer(b,c).then(function(a){var b=i.containers[a];b.parent_id?m.getContainerAncestry(b.parent_id,c,d):d.resolve(a)}),d.promise};var v=function(a,c){var d=c?"/v3/episode_segments/"+c+"/events":"/v3/episodes/"+a+"/events";return b.get(f.apiDataBaseUrl+d)},w=function(a,b,c){angular.forEach(a,function(a){"Plugin"===a.type&&!function(a){l.getUserAnswer(a._id,h.user._id).then(function(b){if(b.data){a.data._plugin.hasBeenAnswered=!0;var c=0,d=!0;angular.forEach(a.data._plugin.distractors,function(e){d&&(e.index===b.data.index&&(e.selected=!0,a.data._plugin.selectedDistractor=e.index,d=!1),c++)}),i.cache("event",m.resolveIDs(a))}})}(a)}),i.resolveEpisodeEvents(c)},x=function(c,d){var e=a.defer();return g.authenticate().then(function(){b.get(f.apiDataBaseUrl+c).then(function(a){var b=a.data;return d&&(b=d(b)),e.resolve(b)})}),e.promise},y=function(c,d,e){var g=a.defer();return b({method:"PUT",url:f.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),g.resolve(b)}),g.promise},z=function(c,d,e){var g=a.defer();return b({method:"POST",url:f.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),g.resolve(b)}),g.promise},A=function(c){var d=a.defer();return b({method:"DELETE",url:f.apiDataBaseUrl+c}).success(function(a){return d.resolve(a)}),d.promise};m.getContainerRoot=function(){return x("/v3/containers",function(a){var b=[];return angular.forEach(a,function(a){i.cache("container",a),b.push(a._id)}),b})},m.getContainer=function(a,b){return x("/v3/containers/"+a,function(c){i.cache("container",c[0]);var d=i.containers[c[0]._id];if(m.getContainerAssets(a,b),d.children){for(var e=0;e<d.children.length;e++)d.children[e]=i.containers[d.children[e]._id];var f=!1;b||(f=!0),f&&angular.forEach(d.children,function(a){a.episodes[0]&&m.getEpisodeOverview(a.episodes[0]).then(function(b){b&&(a.status=b.status,a.title=b.title,i.cache("container",a))})})}return c[0]._id})},m.getContainerAssets=function(a,c){return b.get(f.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(b){i.containers[a].assetsHaveLoaded=!0,angular.forEach(b.files,function(a){i.cache("asset",a)}),i.resolveEpisodeAssets(c)})},m.createContainer=function(b){var c=a.defer(),d={container:{customer_id:b.customer_id,name:b.name,parent_id:b.parent_id}};return z("/v3/containers",d).then(function(a){i.cache("container",a);var b=a.parent_id;i.containers[b].children.push(i.containers[a._id]),c.resolve(a)}),c.promise},m.updateContainer=function(b){var c=a.defer();return b._id||c.reject(),y("/v3/containers/"+b._id,b,function(a){i.cache("container",a),c.resolve(a)}),c.promise},m.deleteContainer=function(a){return delete i.containers[a],A("/v3/containers/"+a)},m.createEpisode=function(b){b.status="Unpublished";var c=a.defer();return z("/v3/episodes",b).then(function(a){i.containers[a.container_id].episodes=[a._id],i.containers[a.container_id].status=a.status,c.resolve(a)}),c.promise},m.storeEpisode=function(a){var b=C(a);return b?y("/v3/episodes/"+b._id,b):!1},m.deleteEpisode=function(b){var c=a.defer();return x("/v2/episodes/"+b+"/episode_user_metrics").then(function(d){if(d.length){for(var e=[],f=0;f<d.length;f++)e.push(A("/v2/episode_user_metrics/"+d[f]._id));a.all(e).then(function(){A("/v3/episodes/"+b),c.resolve()})}else A("/v3/episodes/"+b),c.resolve()}),c.promise},m.deleteItem=function(a){return A("/v3/events/"+a)},m.createAsset=function(b,c){var d=a.defer();return c.container_id=b,c._id&&c._id.match(/internal/)&&delete c._id,c=i.deriveAsset(c),z("/v1/containers/"+b+"/assets",c).then(function(a){i.containers[a.file.container_id].episodes=[a.file._id],i.cache("asset",a.file),d.resolve(a.file)}),d.promise},m.deleteAsset=function(a){return A("/v1/assets/"+a)},m.storeItem=function(a){return a=B(a),a?a&&a._id&&!a._id.match(/internal/)?y("/v3/events/"+a._id,{event:a}):z("/v3/episodes/"+a.episode_id+"/events",{event:a}):!1};var B=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;var c=["_id","start_time","end_time","episode_id","template_id","templateUrl","stop","required","cosmetic","sxs","title","url","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id","avatar_id"];b.type=a._type;for(var d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=angular.copy(a[c[d]]));if(b.start_time&&b.end_time){var e=parseFloat(b.start_time),f=parseFloat(b.end_time);if(isNaN(e)||isNaN(f))return j.error({data:"Tried to store an invalid start_time or end_time."}),!1;if(e>f)return j.error({data:"Tried to store a start_time that is after the end_time."}),!1}if(b.data&&(delete b.data._plugin.selectedDistractor,delete b.data._plugin.hasBeenAnswered,delete b.data._plugin._type,b.data._plugin.distractors.length))for(d=0;d<b.data._plugin.distractors.length;d++)delete b.data._plugin.distractors[d].selected;b.style_id=[],b.layout_id=[],b.style_id=E("style",a.styles),b.layout_id=E("layout",a.layouts);var g=m.readCache("template","url",a.templateUrl);return g?b.template_id=g.id:b.template_id=D(a.templateUrl),b.template_id?b:(j.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)};m.prepItemForStorage=B,m.detachEventAsset=function(a,b){return(a=B(a))?(a.asset_id===b&&(a.asset_id=null),a.link_image_id===b&&(a.link_image_id=null),a.annotation_image_id===b&&(a.annotation_image_id=null),a&&a._id&&!a._id.match(/internal/)?y("/v3/events/"+a._id,{event:a}):z("/v3/episodes/"+a.episode_id+"/events",{event:a})):!1};var C=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;for(var c=["_id","title","description","container_id","customer_id","master_asset_id","poster_frame_id","status","languages"],d=0;d<c.length;d++)(a[c[d]]||0===a[c[d]])&&(b[c[d]]=angular.copy(a[c[d]]));b.style_id=E("style",a.styles);var e=m.readCache("template","url",a.templateUrl);return e?b.template_id=e.id:b.template_id=D(a.templateUrl),b.template_id?b:(j.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)},D=function(a){var b={"templates/episode/episode.html":"templates/episode-default.html","templates/episode/eliterate.html":"templates/episode-eliterate.html","templates/episode/ewb.html":"templates/episode-ewb.html","templates/episode/gw.html":"templates/episode-gw.html","templates/episode/purdue.html":"templates/episode-purdue.html","templates/episode/story.html":"templates/episode-tellingstory.html","templates/item/transcript.html":"templates/transcript-default.html","templates/item/transcript-withthumbnail.html":"templates/transcript-withthumbnail.html","templates/item/transcript-withthumbnail-alt.html":"templates/transcript-withthumbnail-alt.html","templates/item/text-h1.html":"templates/text-h1.html","templates/item/text-h2.html":"templates/text-h2.html","templates/item/pullquote-noattrib.html":"templates/text-pullquote-noattrib.html","templates/item/pullquote.html":"templates/text-pullquote.html","templates/item/image.html":"templates/transmedia-image-default.html","templates/item/image-caption.html":"templates/transmedia-caption.html","templates/item/image-caption-sliding.html":"templates/transmedia-slidingcaption.html","templates/item/image-fill.html":"templates/transmedia-image-fill.html","templates/item/image-plain.html":"templates/transmedia-image-plain.html","templates/item/image-linkonly.html":"templates/transmedia-linkonly.html","templates/item/image-thumbnail.html":"templates/transmedia-thumbnail.html","templates/item/link.html":"templates/transmedia-link-default.html","templates/item/link-embed.html":"templates/transmedia-link-embed.html","templates/scene/1col.html":"templates/scene-1col.html","templates/scene/2colL.html":"templates/scene-2colL.html","templates/scene/2colR.html":"templates/scene-2colR.html","templates/scene/centered.html":"templates/scene-centered.html","templates/scene/cornerH.html":"templates/scene-cornerH.html","templates/scene/cornerV.html":"templates/scene-cornerV.html","templates/item/question-mc-formative.html":"templates/question-mc-formative.html","templates/item/question-mc-poll.html":"templates/question-mc-poll.html","templates/item/question-mc.html":"templates/question-mc.html","templates/item/question-mc-image-left.html":"templates/question-mc-image-left.html","templates/item/question-mc-image-right.html":"templates/question-mc-image-right.html","templates/item/sxs-question.html":"templates/sxs-question.html","templates/item/sxs-link.html":"templates/sxs-link.html"};if(b[a]){var c=m.readCache("template","url",b[a]);return c.id}return!1};m.readCache=function(a,b,c){var d=!1;return angular.forEach(o[a],function(a){a[b]===c&&(d=a)}),d?d:!1},f.debugInBrowser;var E=function(a,b){var c=["colorEliterate","colorGw","colorGwsb","colorPurdue","colorUsc","colorColumbia","colorColumbiabusiness","typographyEliterate","typographyGw","typographyGwsb","typographyPurdue","typographyUsc","typographyColumbia","typographyColumbiabusiness"],d=[];return angular.forEach(b,function(b){if(b){var e=m.readCache(a,"css_name",b);if(e)d.push(e.id);else if(-1===c.indexOf(b))return j.error({data:"Tried to store a "+a+" with no ID: "+b}),!1}}),d};return m}]),angular.module("com.inthetelling.story").factory("errorSvc",["$location",function(a){var b={};return b.init=function(){b.errors=[],b.notifications=[]},b.init(),b.error=function(c){!c||401!==c.status&&403!==c.status||"/"===a.path()&&(c=void 0),c&&c.data&&("string"==typeof c.data?(c.data=c.data.replace(/\n/g,"").replace(/==/g,"").replace(/-----.*/g,""),b.errors.push({exception:c})):b.errors.push({exception:c}))},b.notify=function(a){b.notifications.push({text:a})},b}]);var DEFAULT_EPISODE_TEMPLATE_URL="templates/episode/story.html";angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","config","appState","youtubeSvc",function(a,b,c,d,e){var f={};f.episodes={},f.assets={},f.events={},f.containers={},f.narratives={},f.customers={},f.cache=function(a,b){"narrative"===a&&(f.narratives[b._id]?angular.extend(f.narratives[b._id],b):f.narratives[b._id]=angular.copy(b)),"customer"===a&&(f.customers[b._id]?angular.extend(f.customers[b._id],b):f.customers[b._id]=angular.copy(b)),"episode"===a?f.episodes[b._id]?angular.extend(f.episodes[b._id],f.deriveEpisode(angular.copy(b))):f.episodes[b._id]=f.deriveEpisode(angular.copy(b)):"event"===a?(b.title||(b.title={}),f.events[b._id]?angular.extend(f.events[b._id],f.deriveEvent(angular.copy(b))):f.events[b._id]=f.deriveEvent(angular.copy(b))):"asset"===a?f.assets[b._id]?angular.extend(f.assets[b._id],f.deriveAsset(angular.copy(b))):f.assets[b._id]=f.deriveAsset(angular.copy(b)):"container"===a&&(f.containers[b._id]?angular.extend(f.containers[b._id],f.deriveContainer(angular.copy(b))):f.containers[b._id]=f.deriveContainer(angular.copy(b)))};var g={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/question-mc-formative.html":"templates/item/question-mc-formative.html","templates/question-mc-poll.html":"templates/item/question-mc-poll.html","templates/question-mc.html":"templates/item/question-mc.html","templates/question-mc-image-left.html":"templates/item/question-mc-image-left.html","templates/question-mc-image-right.html":"templates/item/question-mc-image-right.html","templates/sxs-question.html":"templates/item/sxs-question.html"};f.deriveEpisode=function(a){return a.templateUrl||(a.templateUrl=DEFAULT_EPISODE_TEMPLATE_URL),g[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl]),angular.forEach(a.languages,function(b){b["default"]&&(a.defaultLanguage=b.code)}),a.defaultLanguage===!1&&(a.defaultLanguage="en"),f.setLanguageStrings(),a.styles||(a.styles=[]),angular.forEach(["eliterate","gw","gwsb","purdue","usc","columbia","columbiabusiness"],function(b){a.templateUrl==="templates/episode/"+b+".html"&&angular.forEach(["color","typography"],function(c){var d=!1;angular.forEach(a.styles,function(a){a.match(c)&&(d=!0)}),d||a.styles.push(c+b[0].toUpperCase()+b.substring(1))})}),a.title&&f.events["internal:landingscreen:"+a._id]&&(f.events["internal:landingscreen:"+a._id].title=a.title,f.events["internal:landingscreen:"+a._id]=i(f.events["internal:landingscreen:"+a._id])),a=i(a)},f.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=k(a)),a=i(a)},f.deriveContainer=function(a){if(a.haveNotLoadedChildData=!1,a.children&&a.children.length>0){a.children=a.children.sort(function(a,b){return a.name.en>b.name.en?1:-1}),a.children=a.children.sort(function(a,b){return a.sort_order-b.sort_order});var b=[];angular.forEach(a.children,function(a){f.containers[a._id]?b.push(f.containers[a._id]):(a.haveNotLoadedChildData=!0,f.containers[a._id]=angular.copy(i(a)))}),a.loadedChildData=!0}else a.children=[];return i(a)};var h=function(a){return void 0!==a?"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1:void 0};f.deriveEvent=function(a){return a=i(a),"Scene"!==a._type&&(a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator),a.cosmetic||(a.cosmetic=!1),a.sxs&&(a.cosmetic=!1),a.templateUrl||(a.templateUrl=""),a.avatar_id&&(f.assets[a.avatar_id]||(f.assets[a.avatar_id]={}),a.avatar=f.assets[a.avatar_id]),f.episodes[a.cur_episode_id]&&"templates/episode/usc.html"===f.episodes[a.cur_episode_id].templateUrl&&(""===a.templateUrl&&(a.templateUrl="templates/item/usc-badges.html"),"Link"===a._type&&("templates/transmedia-link-default.html"===a.templateUrl&&(a.templateUrl="templates/transmedia-link-noembed.html"),a.display_title.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youâ€™re finished - Come back to this page and click <b>Continue</b>).<br><br>If youâ€™d rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.display_title.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.display_title.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge"))),a.isContent=!1,a.isTranscript=!1,a.noEmbed=!1,a.noExternalLink=!1,a.targetTop=!1,a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,h(a)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),"Link"===a._type&&a.url&&a.url.match(/^http:\/\//)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0,a.noEmbed=!0)),g[a.templateUrl]?(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])):a.origTemplateUrl=a.templateUrl,a.producerItemType||("Scene"===a._type?a.producerItemType="scene":"Annotation"===a._type?a.templateUrl.match(/transcript/)?a.producerItemType="transcript":a.producerItemType="annotation":"Upload"===a._type?a.templateUrl.match(/file/)?a.producerItemType="file":a.producerItemType="image":"Link"===a._type?a.templateUrl.match(/video/)?a.producerItemType="video":a.producerItemType="link":"Plugin"===a._type&&a.templateUrl.match(/question/)&&(a.producerItemType="question"),!a.producerItemType),a.displayStartTime=b("asTime")(a.start_time),a};var i=function(a){var b=d.lang?d.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(c){a[c]&&("string"==typeof a[c]?a["display_"+c]=a[c]:a[c][b]?a["display_"+c]=a[c][b]:a["display_"+c]=a[c].en)}),a};f.setLanguageStrings=function(){angular.forEach(f.events,function(a){a=i(a)}),angular.forEach(f.episodes,function(a){a=i(a)}),angular.forEach(f.containers,function(a){a=i(a)})},f.resolveEpisodeEvents=function(a){var b=[],c=[],d=f.episodes[a];angular.forEach(f.events,function(d){d.cur_episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))});var e={};angular.forEach(c,function(a){if("Annotation"===a._type&&a.annotator){var b=d.defaultLanguage||"en",c=a.annotator[b];void 0===c&&(c=a.annotator[Object.keys(a.annotator).sort()[0]]),e[c]?(e[c].name=angular.extend(e[c].name,a.annotator),e[c].annotation_image_id||(e[c].annotation_image_id=a.annotation_image_id)):e[c]={name:a.annotator,annotation_image_id:a.annotation_image_id};for(var f=Object.keys(e[c].name).sort(),g=e[c].name[b]||"(untranslated)",h=0;h<f.length;h++)f[h]!==b&&(g=g+" / "+e[c].name[f[h]]);e[c].key=g}}),d.annotators=e;var g=0;d.masterAsset&&(g=d.masterAsset.duration,angular.forEach(d.scenes,function(a){a.start_time>g&&(a.start_time=g-.2)})),d.scenes=b.sort(function(a,b){return a._id.indexOf("internal:start")>-1||b._id.indexOf("internal:end")>-1?-1:b._id.indexOf("internal:start")>-1||a._id.indexOf("internal:end")>-1?1:a.start_time-b.start_time}),d.items=c.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(c,function(a){g>0&&a.start_time>g-.11&&(a.start_time=g-.2,a.end_time=g-.1),a.start_time<.01&&(a.start_time=.01,a.end_time<.01&&(a.end_time=.01)),a.start_time>a.end_time&&(a.end_time=a.start_time)});for(var i=1,k=d.scenes.length;k>i;i++)i===k-1?0!==g&&(d.scenes[i].end_time=g):d.scenes[i].end_time=d.scenes[i+1].start_time;for(var l=0,m=0,n=b.length;n>m;m++){for(var o=b[m],p=[],q={},r=l,s=c.length;s>r;r++){var t=c[r];t.start_time>=o.start_time&&t.start_time<o.end_time&&(h(t)&&(q.end_time===o.end_time&&(q.end_time=t.start_time),q=t),t.end_time<=o.end_time?(f.events[t._id].scene_id=o._id,p.push(t)):o.end_time-.25<t.start_time&&m!==n-1?t.start_time=o.end_time:(t.end_time=o.end_time,t.scene_id=o._id,p.push(t)))}f.events[o._id].items=p.sort(function(a,b){return a.start_time===b.start_time&&b.layouts?b.layouts.indexOf("sidebarL")>-1||b.layouts.indexOf("sidebarR")>-1?1:0:a.start_time-b.start_time})}d.styleCss=j(d),angular.forEach(f.events,function(b){b.cur_episode_id===a&&(b.styleCss=j(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},f.resolveEpisodeContainers=function(a){var b=f.episodes[a];b.parents=[],delete b.previousEpisodeContainer,delete b.nextEpisodeContainer,b.navigation_depth=0},f.episode=function(a){return!f.episodes[a],f.episodes[a]},f.episodeEvents=function(a){var b=[];return angular.forEach(f.events,function(c){
c.cur_episode_id===a&&b.push(c)}),b},f.sceneAtEpisodeTime=function(a,b){b=b||d.time;for(var c=f.episodes[a].scenes,e=0;e<c.length;e++)if(c[e].start_time<=b&&c[e].end_time>b)return c[e]},f.scene=function(a){return!f.events[a],f.events[a]};var j=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=f.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.cur_episode_id){var e=f.episodes[a.cur_episode_id].styles;angular.forEach(e,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}if("Scene"!==a._type&&!a.isContent&&a.layouts&&a.layouts[0].match(/Bg/))for(var g=0;g<c.length;g++)c[g].match(/transition/)&&"transitionNone"!==c[g]&&(c[g]="transitionFade");return c.join(" ")};f.resolveEpisodeAssets=function(a){if(angular.forEach(f.events,function(b){if(b.cur_episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&f.assets[c]&&(f.events[b._id].asset=f.assets[c])}}),f.episodes[a]){var b=f.episodes[a].master_asset_id;b&&f.assets[b]&&(f.episodes[a].masterAsset=f.assets[b]);var c=f.episodes[a].poster_frame_id;c&&f.assets[c]&&(f.episodes[a].poster=f.assets[c])}},f.addLandingScreen=function(a){f.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",cur_episode_id:a,episode_id:a,start_time:-.01,end_time:.01}},f.addEndingScreen=function(a){var b=f.episodes[a];if(b&&b.scenes&&b.masterAsset){b.scenes=b.scenes.sort(function(a,b){return a.start_time-b.start_time});var c=b.scenes[b.scenes.length-1];if(!c._id.match(/internal:endingscreen/)){var d=parseFloat(b.masterAsset.duration);c.end_time=d-.1,angular.forEach(c.items,function(a){a.end_time>d-.1&&(a.end_time=d-.1)}),f.events["internal:endingscreen:"+a]={_id:"internal:endingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/endingscreen.html",cur_episode_id:a,start_time:d-.1,end_time:d},f.events["internal:endingscreen:"+a]=i(f.events["internal:endingscreen:"+a]),f.resolveEpisodeEvents(a)}}};var k=function(a){var b={youtube:[],mp4:[],webm:[],m3u8:[]},d=/\.(\w+)$/;if(a.alternate_urls){for(var g=0;g<a.alternate_urls.length;g++)a.alternate_urls[g].match(/youtube/)?e.embeddableYoutubeUrl(a.alternate_urls[g])&&b.youtube.push(e.embeddableYoutubeUrl(a.alternate_urls[g])):b[a.alternate_urls[g].match(d)[1]].push(a.alternate_urls[g]);a.you_tube_url&&e.embeddableYoutubeUrl(a.you_tube_url)&&b.youtube.push(e.embeddableYoutubeUrl(a.you_tube_url));var h=/(\d+)x(\d+)\.\w+$/;angular.forEach(Object.keys(b),function(a){b[a]=b[a].sort(function(a,b){var c=a.match(h)||[0,0],d=b.match(h)||[0,0];return c[1]-d[1]})})}0===b.youtube.length&&(a.url&&e.embeddableYoutubeUrl(a.url)&&(a.you_tube_url=e.embeddableYoutubeUrl(a.url)),a.you_tube_url&&e.embeddableYoutubeUrl(a.you_tube_url)&&(b.youtube=[e.embeddableYoutubeUrl(a.you_tube_url)])),a.alternate_urls||angular.forEach(["mp4","webm","m3u8"],function(c){0!==b[c].length||a.url.match(/youtube/)||b[c].push(a.url.replace("mp4",c))}),c.youtube.disabled&&delete b.youtube;var i=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);i||delete b.m3u8;var j=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if(j){var k,l="t="+(new Date).getTime();angular.forEach(["mp4","webm"],function(a){if(b[a].length>0)for(var c=0;c<b[a].length;c++)k=b[a][c].match(/\?/)?"&":"?",b[a][c]=b[a][c]+k+l})}return a.urls=b,a.isTranscoded=function(){return f.isTranscoded(this)},a};return f.isTranscoded=function(a){return a.urls&&a.urls.youtube&&a.urls.youtube.length?!0:a.alternate_urls?!0:!1},c.debugInBrowser,f}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$window","$timeout","$interval","$rootScope","$filter","config","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f,g,h,i){var j={};j.timelineEvents=[],j.markedEvents=[];var k,l,m,n;j.registerVideo=function(a){void 0!==m&&b(function(){j.seek(h.time)}),m=a},j.unregisterVideo=function(){m=void 0},j.setSpeed=function(a){n=a,h.timeMultiplier=n,m.setSpeed(a),t()},j.play=function(b){if(h.duration&&!(h.duration<.1)){if(!h.hasBeenPlayed)return h.hasBeenPlayed=!0,void d.$emit("video.firstPlay");if(h.time>h.duration-.1&&(j.seek(.1),j.play()),void 0!==m)h.videoControlsActive=!0,h.show.navPanel=!1,h.timelineState="buffering",a.parent!==a&&a.parent.postMessage("pauseEpisodePlayback","*"),m.play().then(function(){h.timelineState="playing",v(),r(),b||i.captureEpisodeActivity("play")});else var c=d.$watch(function(){return void 0!==m},function(a){a&&(c(),j.play())})}},j.enforceSingletonPauseListener||a.addEventListener("message",function(a){"pauseEpisodePlayback"===a.data&&j.pause()},!1),j.enforceSingletonPauseListener=!0,j.pause=function(a){h.videoControlsActive=!0,c.cancel(k),s(),k=void 0,q=void 0,h.timelineState="paused",m&&m.pause(),a||i.captureEpisodeActivity("pause")},j.stall=function(){c.cancel(k),s(),k=void 0,q=void 0,j.wasPlaying="playing"===h.timelineState,h.timelineState="buffering"},j.unstall=function(){j.wasPlaying?(h.timelineState="playing",j.play()):h.timelineState="paused",j.wasPlaying=void 0},j.startAtSpecificTime=function(a){return m&&0!==h.duration?(h.isTouchDevice&&h.hasBeenPlayed===!1&&"youtube"===m.videoType,a=A(a),0>a&&(a=0),a>h.duration&&(a=h.duration),h.time=a,j.updateEventStates(),m.startAtTime(a),void i.captureEpisodeActivity("seek",{method:"URLParameter"})):void b(function(){j.startAtSpecificTime(a)},300)},j.seek=function(a,c,d){if(!m||0===h.duration)return void b(function(){j.seek(a,c,d)},300);var e=h.time;a=A(a),0>a&&(a=0),a>h.duration&&(a=h.duration);var f="playing"===h.timelineState;if(f&&j.pause(!0),s(),h.time=a,m.seek(a,!0),j.updateEventStates(),c){var g={method:c,seekStart:e};d&&(g.event_id=d),i.captureEpisodeActivity("seek",g)}if(f){for(var k=!0,l=150,n=0;n<j.timelineEvents.length;n++){var o=j.timelineEvents[n];if(o.t>a-l&&"pause"===o.action&&(k=!1),o.t>a)break}k&&b(function(){j.play()},l)}},j.prevScene=function(){for(var a=j.markedEvents.length-1;a>=0;a--){var b=h.time;if("playing"===h.timelineState&&(b-=3),j.markedEvents[a].start_time<b){j.seek(j.markedEvents[a].start_time,"prevScene");break}}},j.nextScene=function(){for(var a=!1,b=0;b<j.markedEvents.length;b++)if(j.markedEvents[b].start_time>h.time){j.seek(j.markedEvents[b].start_time,"nextScene"),a=!0;break}a||(j.pause(),j.seek(h.duration-.01,"nextScene"))},j.toggleMute=function(){h.muted=!h.muted,m.toggleMute()},j.setVolume=function(a){h.volume=a,m.setVolume(a)};var o,p=function(){o={lastTimelineTime:0,lastVideoTime:0}};p();var q,r=function(){o.lastTimelineTime=h.time,o.lastVideoTime=h.time,t()},s=function(){b.cancel(l),p()},t=function(a){if(b.cancel(l),"playing"===h.timelineState){for(var c=m.currentTime(),d=h.time,e=0;e<j.timelineEvents.length;e++){var f=j.timelineEvents[e];if(f.t>=o.lastTimelineTime){if(f.t>d)break;if(("pause"!==f.action||!a&&f.t!==o.lastTimelineTime)&&(u(f),"pause"===f.action)){e++;break}}}var g=j.timelineEvents[e];if(o.lastVideoTime=c,o.lastTimelineTime=d,g&&"playing"===h.timelineState){var i=1e3*(j.timelineEvents[e].t-d)/n;l=b(t,i+10)}}},u=function(a){"timeline"===a.id?"pause"===a.action?(h.time=a.t,j.pause()):j.play():"enter"===a.action?(g.events[a.id].state="isCurrent",g.events[a.id].isCurrent=!0):"exit"===a.action?(g.events[a.id].state="isPast",g.events[a.id].isCurrent=!1):"preload"===a.action&&z(g.events[a.id])},v=function(){q=void 0,c.cancel(k),k=c(w,20)},w=function(){var a=new Date,b=isNaN(a-q)?0:a-q,c=parseFloat(h.time)+b/1e3*n;0>c&&(c=0,j.pause()),c>h.duration&&(c=h.duration,j.pause()),h.time=c,q=a};j.init=function(a){j.timelineEvents=[],j.markedEvents=[],n=1,h.duration=0,h.timelineState="paused",j.injectEvents(g.episodeEvents(a),0),c.cancel(k),s()},j.injectEvents=function(a,b){0!==a.length&&(b||(b=0),angular.forEach(a,function(a){a.start_time=+a.start_time,a.end_time=+a.end_time,"Scene"===a._type&&("producer"===h.product?x(a):a.display_title&&x(a)),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,g.events[a._id].start_time=.01),a.stop?(x(a),j.timelineEvents.push({t:a.start_time+b,id:"timeline",eventId:a._id,action:"pause"}),j.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),j.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(j.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&j.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"})),(a.asset_id||a.annotation_image_id||a.link_image_id)&&j.timelineEvents.push({t:a.start_time<3?0:a.start_time-3,id:a._id,action:"preload"})}),j.sortTimeline())};var x=function(a){for(var b=!1,c=0;c<j.markedEvents.length;c++)j.markedEvents[c]._id===a._id&&(j.markedEvents[c]=angular.copy(a),b=!0);b||j.markedEvents.push(a)};j.removeEvent=function(a){j.timelineEvents=e("filter")(j.timelineEvents,function(b){return b.id===a||b.eventId===a?!1:!0}),j.markedEvents=e("filter")(j.markedEvents,{_id:"!"+a}),j.updateEventStates()},j.updateEventTimes=function(a){j.timelineEvents=e("filter")(j.timelineEvents,function(b){return b.id===a._id||b.eventId===a._id?!1:!0}),j.injectEvents([a],0)},j.updateSceneTimes=function(a){angular.forEach(g.episodes[a].scenes,function(a){j.updateEventTimes(a)})},j.sortTimeline=function(){j.timelineEvents=j.timelineEvents.sort(function(a,b){if(a.t===b.t){if(a.action===b.action)return 0;if("enter"===a.action){if("pause"===b.action)return-1;if("exit"===b.action)return 1}return"exit"===a.action?-1:"pause"===a.action?1:0}return a.t-b.t}),j.markedEvents=j.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),j.timelineEvents.length>0&&(h.duration=j.timelineEvents[j.timelineEvents.length-1].t),j.updateEventStates()},j.updateEventStates=function(){var a=h.time;angular.forEach(j.timelineEvents,function(a){if("timeline"!==a.id){var b=g.events[a.id];b&&(b.state="isFuture",b.isCurrent=!1)}}),angular.forEach(j.timelineEvents,function(b){if(b.t<=a){var c=g.events[b.id];c&&("enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1))}})};var y={},z=function(a){a.asset&&"Asset::Image"===a.asset._type&&(y[a.asset.url]||(y[a.asset.url]=new Image,y[a.asset.url].src=a.asset.url))},A=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return f.debugInBrowser,j}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);return(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(!e.disableAnalytics&&(!f.user||!f.user._id||f.user.track_episode_metrics)){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b,c,d){(d||!(e.disableAnalytics||f.user._id&&!f.user.track_event_actions))&&g.activityQueue.push({name:a,event_id:b,walltime:new Date,data:c})},g.forceCaptureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c,!0),g.flushActivityQueue()},g.captureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c),g.flushActivityQueue()},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){var c=a.defer();0===g.activityQueue.length&&c.resolve(""),f.episodeId||c.resolve();var d=angular.copy(g.activityQueue);g.activityQueue=[];var h=new Date,i=[],j=[];angular.forEach(d,function(a){a.age=(h-a.walltime)/1e3,delete a.walltime,a.event_id?j.push(a):i.push(a)}),i=g.dejitter(i);var k=[];return j.length>0&&k.push(b.post(e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/event_user_actions",{event_user_actions:j})),i.length>0&&k.push(b.post(e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/episode_user_metrics",{episode_user_metrics:i})),a.all(k).then(function(){c.resolve()}),c.promise},g.dejitter=function(a){if(0===a.length)return[];for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1];"seek"===d.name&&"seek"===e.name&&d.timestamp===e.data.seekStart?e.data.seekStart=d.data.seekStart:b.push(a[c])}return b.push(a[a.length-1]),b},g}]),angular.module("com.inthetelling.story").factory("youtubeSvc",["$q","$http","$timeout","config",function(a,b,c,d){var e={},f=function(e){var f="https://www.googleapis.com/youtube/v3/videos?id="+e+"&part=contentDetails,snippet&key="+d.youtube.apikey,g=a.defer(),h=c(function(){g.reject("Youtube API request timed out")},d.youtube.timeout);return b({method:"GET",url:f,transformRequest:function(a,b){var c=b();return delete c.Authorization,c}}).success(function(a){c.cancel(h),g.resolve(a)}).error(function(){g.reject()}),g.promise};e.extractYoutubeId=function(a){if(!a)return!1;a=a.replace(/%3F/,"?"),a=a.replace(/%26/,"&");var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b);return c&&c[1]?c[1]:!1},e.embedParams=function(){return"?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&rel=0&iv_load_policy=3&wmode=transparent"},e.createEmbedLinkFromYoutubeId=function(a,b){return a?"//www.youtube.com/embed/"+a+(b?"":e.embedParams()):!1},e.embeddableYoutubeUrl=function(a,b){if(!a)return!1;var c=e.extractYoutubeId(a);return e.createEmbedLinkFromYoutubeId(c,b)};var g=function(a){var b=0;return a.match(/(\d*)D/)&&(b+=parseInt(86400*a.match(/(\d*)D/)[1],10)),a.match(/(\d*)H/)&&(b+=parseInt(3600*a.match(/(\d*)H/)[1],10)),a.match(/(\d*)M/)&&(b+=parseInt(60*a.match(/(\d*)M/)[1],10)),a.match(/(\d*)S/)&&(b+=parseInt(a.match(/(\d*)S/)[1],10)),b};return e.getVideoData=function(b){var c=a.defer();return f(b).then(function(a){if(a.items[0]){var d={id:b,title:a.items[0].snippet.title,description:a.items[0].snippet.description,duration:g(a.items[0].contentDetails.duration)};c.resolve(d)}else c.reject("Bad response data from youtube getVideoData")},function(a){c.reject(a)}),c.promise},e}]),function(){function a(a,b){this.dfd=a.defer();var c=this;b.onYouTubeIframeAPIReady=function(){c.dfd.resolve()}}angular.module("com.inthetelling.story").service("YoutubePlayerApi",a),a.$inject=["$q","$window"],a.prototype.load=function(){var a="//www.youtube.com/iframe_api",b=document.createElement("script");b.src=a;var c=document.getElementsByTagName("script")[0];return c.parentNode.insertBefore(b,c),this.dfd.promise}}(),function(){function a(a,b,c){function d(a,b,c,d,e){return new YT.Player(a,{videoId:b,playerVars:{controls:0,enablejsonapi:1,modestbranding:1,showinfo:0,rel:0,iv_load_policy:3},events:{onReady:e,onStateChange:c,onPlaybackQualityChange:d}})}function e(a,e,f,g,i){function j(a){var d,e=x,g=a.data,i=a.target,j=i.m.id;j!==x&&(d=j);var k=h(d),l=h(e);j===e&&l===YT.PlayerState.PLAYING&&r(),j===d&&("playing"===b.timelineState&&(c.pause(),s(d)),k===YT.PlayerState.PLAYING&&s(d)),void 0!==y[d]&&void 0===y[e]&&g!==YT.PlayerState.UNSTARTED&&"playing"===b.timelineState&&b.embedYTPlayerAvailable&&c.pause(),f(a)}function k(a){var c=a.target,d=c.m.id;d===x&&(b.mainYTPlayerReady=!0),d!==x&&(b.embedYTPlayerReady=!0,b.embedYTPlayerAvailable=!0),i(a)}y[a]=d(a,e,j,g,k);var l=y[e];return l}function f(a){return y[a]?y[a]:void 0}function g(a){var b=f(a);return void 0!==b?b.getCurrentTime():void 0}function h(a){var b=f(a);return void 0!==b?b.getPlayerState():void 0}function i(a){var b=f(a);return void 0!==b?b.playVideo():void 0}function j(a){var b=f(a);return void 0!==b?b.pauseVideo():void 0}function k(a,b){var c=f(a);void 0!==c&&c.setPlaybackQuality(b)}function l(a){var b=f(a);return void 0!==b?b.getVideoLoadedFraction():void 0}function m(a,b,c){var d=f(a);void 0!==d&&d.seekTo(b,c)}function n(a){var b=f(a);return void 0!==b?b.isMuted():void 0}function o(a){var b=f(a);return void 0!==b?b.mute():void 0}function p(a){var b=f(a);return void 0!==b?b.unmute():void 0}function q(a,b){var c=f(a);void 0!==c&&c.setVolume(b)}function r(){for(var a in y)if(a!==x){var b=h(a);b!==YT.PlayerState.UNSTARTED&&b!==YT.PlayerState.PAUSED&&b!==YT.PlayerState.CUED&&j(a)}}function s(a){for(var b in y)if(b!==x&&b!==a){var c=h(b);c!==YT.PlayerState.UNSTARTED&&c!==YT.PlayerState.PAUSED&&c!==YT.PlayerState.CUED&&j(b)}}function t(a){var c=f(a);c&&c.destroy(),a!==x&&(b.embedYTPlayerAvailable=!1)}function u(){var a=(new Date).getTime(),b="xxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b}function v(b,c){var d,e=a.defer();return c?(d=b,x=d,y[d]={}):(d=u()+b,y[d]={}),e.resolve(d),e.promise}var w,x,y={};return w={getPlayer:f,create:e,destroy:t,play:i,playerState:h,pause:j,pauseEmbeds:r,pauseOtherEmbeds:s,setPlaybackQuality:k,setPlayerId:v,getVideoLoadedFraction:l,seekTo:m,getCurrentTime:g,isMuted:n,mute:o,unMute:p,setVolume:q}}angular.module("com.inthetelling.story").factory("youTubePlayerManager",a),a.$inject=["$q","appState","timelineSvc"]}(),angular.module("com.inthetelling.story").factory("questionAnswersSvc",["$q","analyticsSvc","appState",function(a,b,c){var d={};return d.saveAnswer=function(a,c,d){return b.forceCaptureEventActivityWithPromise(a,c,d)},d.getAnswers=function(d){var e=a.defer();return b.readEventActivity(d).then(function(a){var b=a.filter(function(a){return("question-answered"===a.name||"question-answered-updated"===a.name)&&a.episode_id===c.episodeId});e.resolve(b)}),e.promise},d.getUserAnswer=function(b,c){var e=a.defer();return d.getAnswers(b).then(function(a){if(!a)return e.reject();var b=a.filter(function(a){return a.user_id===c});b.length>0?e.resolve(b[0]):e.reject()}),e.promise},d.calculateCounts=function(a){var b;return angular.forEach(a,function(a){b[a.data.index]++}),b},d.incrementAnswerCount=function(a,b){a[b]=(a[b]||0)+1},d}]),angular.module("com.inthetelling.story").factory("recursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("com.inthetelling.story").factory("mockSvc",["modelSvc",function(a){var b={};return b.keepJsLintHappy=function(){var b=a.episodes.noop;b=void 0},b.mockEpisode=function(b){a.cache("episode",{_id:b,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en","default":!0}],status:"Published",templateUrl:"templates/episode/gwsb.html",styles:["","",""]}),a.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var c={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:b,cur_episode_id:b,layouts:["",""],styles:["transitionSlideL"]},d=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/1col.html"],e=0;10>e;e++){var f=angular.copy(c);f._id="scene-"+e,f.title=e/2===Math.floor(e/2)?{en:"Scene "+(e+1)+" Title"}:{en:""},f.start_time=20*e,f.end_time=20*e+20,f.templateUrl=d[e%d.length],a.cache("event",f)}var g={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:b,cur_episode_id:b,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},h=["sidebarL","sidebarR","inline"],i=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(e=0;30>e;e++){var j=angular.copy(g);j._id="transcript-"+e,j.annotation={en:"Transcript block number "+(e+1)},j.start_time=5*e,j.end_time=5*e+5,j.layouts=[h[e%h.length]]}for(e=0;10>e;e++){var k=angular.copy(g);k._id="annotation-"+e,k.start_time=6*e,k.end_time=6*e+3,k.templateUrl=i[e%i.length],a.cache("event",k)}for(e=0;10>e;e++){var l=angular.copy(g);l._id="longtext-"+e,l.start_time=7*e,l.end_time=7*e+7,l.styles=["timestampNone"],l.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},l.templateUrl="templates/item/text-transmedia.html",a.cache("event",l)}a.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),a.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),a.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),a.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var m={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/link-withimage.html",layouts:["inline"],styles:["timestampNone"],isContent:!0};for(e=0;30>e;e++){var n=angular.copy(m);n._id="link-"+e,n.required=Math.random()>.5,n.start_time=3*e,n.end_time=3*e+3,n.layouts=[h[e%h.length]],a.cache("event",n)}var o={_id:"",_type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],title:{},data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",correct:!0,index:3},{text:"",index:4}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(e=0;10>e;e++){var p=angular.copy(o);p._id="question-"+e,p.required=Math.random()>.5,p.start_time=5*e,p.end_time=5*e+5,p.layouts=[h[e%h.length]],a.cache("event",p)}var q={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",index:3},{text:"",index:4}],_type:"question"}}};for(e=0;10>e;e++){var r=angular.copy(q);r._id="question-"+e,r.required=Math.random()>.5,r.start_time=6*e,r.end_time=6*e+6,r.layouts=[h[e%h.length]],a.cache("event",r)}var s={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(e=0;30>e;e++){var t=angular.copy(s);t._id="upload-"+e,t.asset_id="asset2",t.title={en:"Upload number "+(e%3+1)},t.start_time=4*e,t.end_time=4*e+4,t.layouts=[h[e%h.length]],a.cache("event",t)}var u=["mainFg","altFg","videoOverlay"];for(e=0;8>e;e++){var v=angular.copy(s);v.layouts=[u[e%u.length]],v._id="filltest-"+e,v.asset_id="asset2",v.start_time=2*e,v.end_time=2*e+2,v.templateUrl="templates/item/image-fill.html",v.styles.push("cover"),a.cache("event",v)}a.resolveEpisodeEvents(b),a.resolveEpisodeAssets(b)},b}]),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type||a.templateUrl.match(/(transmedia|definition)/)||b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){("Annotation"!==a._type||a.templateUrl.match(/(transmedia|definition)/))&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("reviewMode",["appState",function(a){return function(b){var c=[],d="producer"===a.product;return angular.forEach(b,function(a){(d||!a.cosmetic&&(a.isContent||a.layouts.indexOf("windowFg")>-1))&&c.push(a)}),c}}]).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("i18n",["appState",function(a){return function(b){return b?"object"==typeof b?b[a.lang]||b.en||"":b:""}}]).filter("asBytes",function(){return function(a){if(!a)return"";var b=Math.floor(a/1024);if(1024>b)return b+"Kb";var c=Math.floor(b/10.24)/100;return c+"Mb"}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("stripParams",function(){return function(a){return a.substr(0,a.indexOf("?"))}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":0>a?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}).filter("alpha",function(){return function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[a%26]}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","$http","config","errorSvc","appState","authSvc",function(a,b,c,d,e,f){a.errorSvc=d,a.logout=f.logout,a.user=e.user,a.dismiss=function(a){for(var b=0;b<d.errors.length;b++)d.errors[b]===a&&(d.errors.splice(b,1),b=d.errors.length);for(b=0;b<d.notifications.length;b++)d.notifications[b]===a&&(d.notifications.splice(b,1),b=d.notifications.length)}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.changeSpeed=function(a){var c=d.timeMultiplier+a;.5>c&&(c=.5),c>2&&(c=2),b.setSpeed(c)},a.resetSpeed=function(){b.setSpeed(1)},a.markerPercent=function(a){return void 0===a?0:a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["config","$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.viewMode=function(a){h.viewMode=a,l.captureEpisodeActivity("modeChange",{mode:a}),h.producerEditLayer=0,"review"===a?(f(function(){d.$emit("magnet.jumpToMagnet")}),h.autoscroll=!0,h.autoscrollBlocked=!1,x(),f(z)):h.autoscroll=!1,"watch"===a&&b.endSearch(),f(function(){$(window).trigger("resize")})},e.viewMode&&f(function(){b.viewMode(e.viewMode)}),e.t&&k.startAtSpecificTime(e.t),b.toggleProducerPreview=function(){h.product="producer"===h.product?"player":"producer"},e.epId?(h.init(),h.episodeId=e.epId):b.narrativeId=e.narrativeId,h.isFramed&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)<151&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:"650px"}),"*");var o=function(){if(h.isFramed&&-1!==j.episodes[h.episodeId].templateUrl.indexOf("wiley")){var a=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(c){a=!1}if(a&&localStorage.removeItem("iCanHazStorage"),a&&!localStorage.getItem("noWileyNag")){h.show.wileyNag=!0;var d=b.$watch("appState.time",function(a){a&&(h.show.wileyNag=!1,d())})}b.noWileyNag=function(){h.show.wileyNag=!1,localStorage.setItem("noWileyNag","1")}}},p=d.$on("dataSvc.getEpisode.done",function(){p(),h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,j.setLanguageStrings(),o(),document.title=j.episodes[h.episodeId].display_title,i.getContainer(j.episodes[h.episodeId].container_id,h.episodeId).then(function(){if(j.episodes[h.episodeId].master_asset_id)var a=b.$watch(function(){return j.assets[j.episodes[h.episodeId].master_asset_id]},function(c){c&&Object.keys(c).length>1&&(a(),j.addEndingScreen(h.episodeId),k.init(h.episodeId),b.loading=!1)});else b.loading=!1,"producer"===h.product&&(h.editEpisode=j.episodes[h.episodeId]),h.videoControlsActive=!0,h.videoControlsLocked=!0;"producer"!==h.productLoadedAs||n.userHasRole("admin")||(h.product="player",h.productLoadedAs="player")})});j.episodes[h.episodeId]?(h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,document.title=j.episodes[h.episodeId].display_title,
j.episodes[h.episodeId].master_asset_id?k.init(h.episodeId):("producer"===h.product&&(h.editEpisode=j.episodes[h.episodeId]),h.videoControlsActive=!0,h.videoControlsLocked=!0),"producer"!==h.productLoadedAs||n.userHasRole("admin")||(h.product="player",h.productLoadedAs="player")):(b.loading=!0,j.addLandingScreen(h.episodeId),i.getEpisode(h.episodeId,h.episodeSegmentId)),b.appState=h,b.show=h.show,b.now=new Date,b.newWindowUrl=a.apiDataBaseUrl+"/v1/new_window",h.narrativeId?b.newWindowUrl=b.newWindowUrl+"?narrative="+h.narrativeId+"&timeline="+h.timelineId:b.newWindowUrl=b.newWindowUrl+"?episode="+h.episodeId,h.videoControlsActive=!1;var q,r,s=b.$watch(function(){return h.videoControlsActive},function(a){a&&(f.cancel(q),q=f(function(){r||(h.videoControlsActive=!1)},5e3))});b.showControls=function(){f.cancel(q),h.videoControlsActive=!0,h.isTouchDevice&&b.allowControlsExit()},b.allowControlsExit=function(){f.cancel(q),q=f(function(){h.videoControlsLocked||(h.videoControlsActive=!1)},5e3)},b.toggleSearchPanel=function(){h.show.searchPanel=!h.show.searchPanel,h.windowWidth<480?b.viewMode("review"):b.viewMode(h.show.searchPanel?"review":"discover"),h.searchText="",h.show.searchPanel&&f(function(){document.getElementById("searchtext").focus()})},b.endSearch=function(){h.searchText="",h.show.searchPanel=!1},b.toggleNavPanel=function(){k.pause(),h.show.navPanel=!h.show.navPanel},b.seek=function(a){k.seek(a,"sceneMenu"),h.show.navPanel=!1},b.pause=function(){k.pause()};var t=d.$on("video.firstPlay",function(){k.play()});b.hidePanel=function(a){h.show[a]=!1},b.hidePanels=function(){h.show.navPanel=!1,h.show.profilePanel=!1,h.itemDetail=!1,d.$emit("player.dismissAllPanels")},b.play=function(){k.play()},b["continue"]=function(){j.episodes[h.episodeId].masterAsset.duration-h.time<.2?(k.pause(),k.seek(j.episodes[h.episodeId].masterAsset.duration-.01)):k.play()},b.userHasRole=function(a){return n.userHasRole(a)},b.logout=function(){return n.logout()},h.isTouchDevice&&"review"===h.viewMode&&(h.autoscroll=!0);var u=$(window),v=$("html,body"),w=!1,x=function(){w||(w=g(z,400),u.bind("scroll",function(){v.stop(),y(),h.autoscrollBlocked=!0}))},y=function(){u.unbind("scroll"),g.cancel(w),w=!1};b.enableAutoscroll=function(){h.autoscrollBlocked&&(h.autoscrollBlocked=!1,x())};var z=function(){if(!h.autoscrollBlocked&&h.autoscroll){var a=1/0,b=u.scrollTop();if(angular.forEach($(".isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),a!==1/0){var c=180;a>b+c&&a-b<document.documentElement.clientHeight-c||c>a&&c>b||(y(),v.animate({scrollTop:a-c},1500),f(function(){x()},1750))}}};x();var A=d.$on("userKeypress.ESC",b.hidePanels);b.$on("$destroy",function(){s(),p(),t(),A()})}]),angular.module("com.inthetelling.story").controller("EpisodeController",function(){}),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){delete a.mainContentHasLeftSidebar,delete a.mainContentHasRightSidebar,delete a.mainContentHasBothSidebars,delete a.altContentHasLeftSidebar,delete a.altContentHasRightSidebar,delete a.altContentHasBothSidebars,a.showCurrent=$.inArray("showCurrent",a.scene.layouts)>-1,a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),$.inArray("splitRequired",a.scene.layouts)>-1?a.mainContentItems=b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?a.mainContentItems=b("transcriptandrequired")(a.contentItems):a.mainContentItems=b("annotation")(a.contentItems),$.inArray("splitRequired",a.scene.layouts)>-1?a.altContentItems=b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?a.altContentItems=b("optional")(a.contentItems):a.altContentItems=b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)};var c={ENTER:13,SPACE:32};a.seekOnKeyPress=function(b,d){var e=d,f=!0;switch(e.keyCode){case c.ENTER:a.seek(b),f=!1;break;case c.SPACE:a.seek(b),f=!1;break;default:f=!0}f||(d.stopPropagation(),d.preventDefault())}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$rootScope","$timeout","$interval","$window","$document","appState","timelineSvc","analyticsSvc","youTubePlayerManager",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){b.video.curStream=h.isTouchDevice?0:1,b.video.urls.youtube&&b.video.urls.youtube.length?(b.videoType="youtube",h.videoType=b.videoType,b.videoNode={id:b.video._id}):(b.videoType="video",h.videoType=b.videoType,b.videoNode=a.find("video")[0],r())}function m(){q()}function n(a){var c=a.data;0>c||(h.isTouchDevice&&h.hasBeenPlayed===!1?(k.pause(b.videoNode.id),i.play()):(b.playerState=F[parseInt(c,10)],"buffering"===b.playerState&&p()))}function o(a){"medium"===a.data&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&k.setPlaybackQuality(b.videoNode.id,"large")}function p(){if("playing"===h.timelineState&&!h.isIPhone){b.intentionalStall||j.captureEpisodeActivity("stall"),i.stall();var a=b.$watch(function(){return b.playerState},function(b){"buffering"!==b&&(a(),i.unstall())})}}function q(){i.registerVideo(b),b.$watch(function(){return k.getVideoLoadedFraction(b.videoNode.id)},function(a){a&&(h.bufferedPercent=100*k.getVideoLoadedFraction(b.videoNode.id))})}function r(){function a(){var a=b.currentTime();b.videoNode.pause(),b.video.curStream=0,j.captureEpisodeActivity("lowBandwidth"),d(function(){b.videoNode.load(),b.seek(a),b.videoNode.play()})}function c(){E=0,h.isIPhone||(C=e(function(){"playing"===h.timelineState?(b.lastPlayheadTime===b.currentTime()&&(b.intentionalStall||j.captureEpisodeActivity("stall"),i.stall(),b.intentionalStall||2!==E++||a()),b.lastPlayheadTime=b.currentTime()):"buffering"===h.timelineState&&b.lastPlayheadTime!==b.currentTime()&&(h.timelineState="playing",i.unstall())},333))}D.playing=b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),D.pause=b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),c(),b.getBufferPercent=function(){if(b.videoNode.buffered.length>0){var a=b.videoNode.buffered.start(b.videoNode.buffered.length-1),c=b.videoNode.buffered.end(b.videoNode.buffered.length-1);return 0>c&&(c-=a,a=0),h.bufferedPercent=c/h.duration*100,h.bufferedPercent}return 0},i.registerVideo(b)}function s(){var c=a.defer();"youtube"===b.videoType?k.play(b.videoNode.id):(b.videoNode.play(),h.embedYTPlayerAvailable&&k.pauseEmbeds());var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise}function t(){if("youtube"===b.videoType)k.seekTo(b.videoNode.id,h.time,!0),k.pause(b.videoNode.id);else{b.videoNode.pause();try{b.videoNode.currentTime=h.time}catch(a){}}}function u(a){if("youtube"===b.videoType){var c;h.isTouchDevice&&h.hasBeenPlayed===!1?c=b.$watch(function(){return h.hasBeenPlayed},function(d){d&&(c(),k.seekTo(b.videoNode.id,a,!0))}):(b.setVolume(0),k.play(b.videoNode.id),c=b.$watch(function(){return F[k.playerState(b.videoNode.id)]},function(d){"playing"===d&&(c(),k.seekTo(b.videoNode.id,a,!0),k.pause(b.videoNode.id),b.setVolume(100))}))}else b.seek(a,!0)}function v(c,e,f){f=f||a.defer();var g=!1;e&&(b.intentionalStall=!0,b.stallGracePeriod=d(function(){b.intentionalStall=!1},1500));try{if("youtube"===b.videoType){var i="playing"===h.timelineState;k.pause(b.videoNode.id),k.seekTo(b.videoNode.id,c,!0),k.pause(b.videoNode.id),i&&k.play(b.videoNode.id),f.resolve()}else b.videoNode.readyState>1?(b.videoNode.currentTime=c,f.resolve()):(b.intentionalStall=!1,d.cancel(b.stallGracePeriod),g=!0)}catch(j){b.intentionalStall=!1,d.cancel(b.stallGracePeriod),g=!0}return g&&d(function(){b.seek(c,e,f)},100),f.promise}function w(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)}function x(){return"youtube"===b.videoType?k.getCurrentTime(b.videoNode.id):b.videoNode.currentTime}function y(){"youtube"===b.videoType?k.isMuted(b.videoNode.id)?k.unMute(b.videoNode.id):k.mute(b.videoNode.id):b.videoNode.muted=!b.videoNode.muted}function z(a){"youtube"===b.videoType?k.setVolume(b.videoNode.id,a):b.videoNode.volume=a/100}function A(){e.cancel(C),d.cancel(b.stallGracePeriod),i.unregisterVideo(),"youtube"===b.videoType?B&&(B=void 0):b.videoNode&&(b.videoNode.removeEventListener("playing",D.playing),b.videoNode.removeEventListener("pause",D.pause),b.videoNode.pause(),b.videoNode.src="",b.videoNode.remove(),delete b.videoNode)}angular.extend(b,{initVideo:l,intentionalStall:!1,play:s,pause:t,startAtTime:u,seek:v,setSpeed:w,currentTime:x,toggleMute:y,setVolume:z,playerStateChange:n,playerQualityChange:o,onReady:m});var B,C,D={},E=0,F={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued"};b.$on("$destroy",A)}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","$rootScope","$timeout","timelineSvc","modelSvc","appState",function(a,b,c,d,e,f){a.sortBy="startTime",a.toggleSortBy=function(b){a.sortBy=g(b),f.autoscroll="startTime"===a.sortBy},a.getToggledValue=function(a){return g(a)};var g=function(a){return"startTime"===a?"type":"startTime"};a.getFriendlySortText=function(a){return"startTime"===a?"time":"type"},a.indexed=!1,a.indexEvents=function(){if(!a.episode.items)return c(function(){a.indexEvents()},300),!1;a.indexed=!0,a.typeCategories=["transcript","annotation","file","image","link","video","question","other"],a.showTypes={transcript:{name:"Transcript",items:[]},annotation:{name:"Annotations",items:[]},file:{name:"Files",items:[]},image:{name:"Images",items:[]},link:{name:"Links",items:[]},video:{name:"Videos",items:[]},question:{name:"Questions",items:[]},other:{name:"Other",items:[]}};var b=function(a,b){return Array(Math.max(b-(parseInt(a,10)+"").length+1,0)).join(0)+a};angular.forEach(a.episode.items,function(c){c.wtfchromesort=b(c.start_time,5),"producer"!==f.product&&c.cosmetic||"Scene"!==c._type&&(c.producerItemType&&a.showTypes[c.producerItemType]?a.showTypes[c.producerItemType].items.push(c):a.showTypes.other.items.push(c),"annotation"===c.producerItemType&&(c.showAsHeader=!c.templateUrl.match(/(transmedia|definition)/)))})},b.$on("searchReindexNeeded",a.indexEvents)}]),angular.module("com.inthetelling.story").controller("EditController",["$q","$scope","$rootScope","$timeout","$window","appState","dataSvc","modelSvc","timelineSvc","youtubeSvc",function(a,b,c,d,e,f,g,h,i,j){b.uneditedScene=angular.copy(b.item),b.validateItemUrl=function(){d(function(){b.item.url.length>0&&!b.item.url.match(/^(\/\/|http)/)&&(b.item.url="//"+b.item.url),j.extractYoutubeId(b.item.url)&&(b.item.url=j.embeddableYoutubeUrl(b.item.url,!0)),b.item.url.match(/inthetelling.com\/#/)&&b.item.url.indexOf(!1)&&(b.item.url=b.item.url+"?embed=1")})},b.chooseAsset=function(a){a=a||"",b.showAssetPicker=!0,b.w1=c.$on("UserSelectedAsset",function(c,d){"Poster"===a?b.attachPosterAsset(d):b.attachChosenAsset(d),b["showUploadButtons"+a]=!1,b.endChooseAsset()}),b.w2=c.$on("userKeypress.ESC",b.endChooseAsset)},b.endChooseAsset=function(){b.w1(),b.w2(),b.showAssetPicker=!1},b.toggleUpload=function(a){a=a||"",b["showUploadField"+a]=!b["showUploadField"+a]},b.addDistractor=function(){b.item.data._plugin.distractors.push({text:"",index:b.item.data._plugin.distractors.length+1})};var k=function(a){return angular.forEach(r(),function(b){return b.start_time===a?!0:void 0}),!1};b.addEvent=function(a){if("scene"===a&&k(f.time))return b.editCurrentScene();var d=z(a);d.cur_episode_id=f.episodeId,d.episode_id=f.episodeId,f.user&&f.user.avatar_id&&(d.avatar_id=f.user.avatar_id),h.cache("event",d),f.editEvent=h.events["internal:editing"],f.videoControlsActive=!0,f.videoControlsLocked=!0,h.resolveEpisodeEvents(f.episodeId),i.injectEvents([h.events["internal:editing"]]),"scene"===a&&i.updateSceneTimes(f.episodeId),c.$emit("searchReindexNeeded")};var l=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1},m=function(){var a=h.episodes[f.episodeId],b=angular.copy(a.items);return b.filter(l)},n=function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=d;break}return c},o=function(a,b){a=a.sort(x);var c=n(a,b),d=[];return 0===c?d:(c<a.length-1&&c>=1&&(s(a[c-1])||d.push(a[c-1])),d)},p=function(a,b){a=a.sort(x);var c=n(a,b),d=[];return 0===c?c<a.length-1&&(s(a[c+1])||d.push(a[c+1])):c<a.length-1&&(s(a[c+1])||d.push(a[c+1]),c>=1&&(s(a[c-1])||d.push(a[c-1]))),d},q=function(a,b,c){if(l(a)){var d=[],e=m();switch(b){case"create":d=p(e,a);break;case"delete":d=o(e,a);break;case"update":c&&q(c,"delete"),q(a,"create")}angular.forEach(d,function(a){g.storeItem(a).then(function(){},function(){})})}};b.saveEvent=function(){var a=angular.copy(f.editEvent);if(b.blockDoubleClicks=!0,a.cur_episode_id=f.episodeId,"Scene"===a._type){var d=y(a);angular.forEach(d,function(a){g.storeItem(a).then(function(){},function(){})})}g.storeItem(a).then(function(b){b.cur_episode_id=f.episodeId,"internal:editing"===f.editEvent._id?(i.removeEvent("internal:editing"),delete h.events["internal:editing"],h.cache("event",g.resolveIDs(b)),h.resolveEpisodeEvents(f.episodeId),i.injectEvents([h.events[b._id]]),q(b,"create")):(h.resolveEpisodeEvents(f.episodeId),i.updateEventTimes(h.events[b._id]),q(b,"update")),angular.forEach(a.removedAssets,function(a){g.deleteAsset(a)}),f.editEvent=!1,c.$emit("searchReindexNeeded")},function(){})};var r=function(){return h.episodes[f.episodeId].scenes},s=function(a){return a._id&&a._id.match(/internal/)};b.getItemsAfter=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)s(a[d])||(b<a[d].start_time||b<a[d].end_time)&&c.push(a[d]);return c},b.saveEpisode=function(){var a=angular.copy(f.editEpisode);g.storeEpisode(a).then(function(c){if(h.cache("episode",g.resolveIDs(c)),f.editEpisode._master_asset_was_changed){delete h.episodes[c._id]._master_asset_was_changed;var j=h.assets[c.master_asset_id].duration,k=j-.01;h.episodes[f.episodeId].masterAsset=h.assets[b.episode.master_asset_id],h.episodes[f.episodeId].master_asset_id=c.master_asset_id;var l=[],m=[],n=h.episodes[a._id];angular.forEach(n.scenes,function(a){a.start_time>j?m.push(a):a.end_time>j&&(a.end_time=k,l.push(a))}),angular.forEach(n.items,function(a){a.start_time>j&&(a.start_time=k),a.end_time>j&&(a.end_time=k),l.push(a)});var o=h.events["internal:endingscreen:"+a._id];o?(o.start_time=k,o.end_time=k):h.addEndingScreen(a._id),h.resolveEpisodeEvents(f.episodeId),h.resolveEpisodeAssets(f.episodeId),f.duration=j,f.editEpisode=!1,f.videoControlsLocked=!1,i.init(f.episodeId),angular.forEach(l,function(a){a._id.indexOf("internal")<0&&g.storeItem(a)}),angular.forEach(m,function(a){a._id.indexOf("internal")<0&&g.deleteItem(a._id)}),d(function(){e.location.reload()},500)}else h.resolveEpisodeEvents(f.episodeId),h.resolveEpisodeAssets(f.episodeId),f.editEpisode=!1,f.videoControlsLocked=!1},function(){})};var t=function(a,b){for(var c=0;c<a.length;c++){if(void 0===a[c]._id||"internal:editing"===a[c]._id){a.splice(c,1);break}if(b&&a[c]._id===b._id){a[c]=b;break}}return a},u=function(a,b){for(var c=1,d=a.length;d>c;c++)c===d-1?a[c].end_time=b:a[c].end_time!==a[c+1].start_time&&(a[c].end_time=a[c+1].start_time)},v=function(a,b){for(var c=!1,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=!0;break}c||a.push(b)},w=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]._id===b){a.splice(c,1);break}},x=function(a,b){return a.start_time-b.start_time},y=function(a,c){var d=f.duration,e=angular.copy(r()),g=[];c?v(e,b.uneditedScene):t(e,b.uneditedScene),e=e.sort(x),u(e,d),w(e,a._id),c||e.push(a),e=e.sort(x);for(var h=1,i=e.length;i>h;h++)h===i-1?e[h].end_time!==d&&(e[h].end_time=d,g.push(e[h])):e[h].end_time!==e[h+1].start_time&&(e[h].end_time=e[h+1].start_time,g.push(e[h]));return g};b.editCurrentScene=function(){angular.forEach(r(),function(a){a.isCurrent&&(f.editEvent=h.events[a._id],f.editEvent.cur_episode_id=f.episodeId,f.editEvent.episode_id=f.episodeId,f.editEvent.producerItemType="scene",f.videoControlsActive=!0,f.videoControlsLocked=!0)})},b.editEpisode=function(){f.editEpisode=h.episodes[f.episodeId],f.videoControlsActive=!0,f.videoControlsLocked=!0},b.deleteEvent=function(a){if(window.confirm("Are you sure you wish to delete this item?")){var b={};b._id=a;var c=h.events[a]._type;if("Scene"===c){var d=y(b,!0);angular.forEach(d,function(a){g.storeItem(a).then(function(){},function(){})})}g.deleteItem(a).then(function(){"sxs"===f.product&&h.events[a].asset&&g.deleteAsset(h.events[a].asset._id),i.removeEvent(a),delete h.events[a],h.resolveEpisodeEvents(f.episodeId),"Scene"===c&&i.updateSceneTimes(f.episodeId),q(b,"delete"),f.editEvent=!1,f.videoControlsLocked=!1},function(){})}},b.cancelEventEdit=function(a){var b=a.cur_episode_id?a.cur_episode_id:a.episode_id;"internal:editing"===f.editEvent._id?(delete h.events["internal:editing"],i.removeEvent("internal:editing")):h.events[f.editEvent._id]=a,h.resolveEpisodeEvents(b),"Scene"===a._type?i.updateSceneTimes(b):i.updateEventTimes(a),f.editEvent=!1,f.videoControlsLocked=!1},b.cancelEpisodeEdit=function(a){h.episodes[f.episodeId]=a,h.deriveEpisode(h.episodes[a._id]),h.resolveEpisodeContainers(a._id),h.resolveEpisodeEvents(a._id),f.editEpisode=!1,f.videoControlsLocked=!1};var z=function(a){var b={_id:"internal:editing",start_time:f.time,episode_id:f.episodeId,isCurrent:!0,producerItemType:a,layouts:["inline"],styles:[]},c={};if("scene"===a&&(c={_type:"Scene",title:{},description:{}}),"video"===a&&(c={_type:"Link",link_image_id:"",url:"",title:{},description:{}}),("comment"===a||"transcript"===a||"annotation"===a)&&(c={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:""}),("file"===a||"image"===a)&&(c={_type:"Upload",asset_id:"",title:{},description:{}}),"link"===a&&(c={_type:"Link",link_image_id:"",url:"https://",title:{},description:{}}),"question"===a&&(c={_type:"Plugin",title:{},data:{_pluginType:"question",_version:2,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{index:1,text:""},{index:2,text:""},{index:3,text:""},{index:4,text:""}],correctfeedback:"",incorrectfeedback:""}}},c.plugin=c.data._plugin),"sxs"===f.product)c.sxs=!0,c.annotator={en:f.user.name},c.layouts=["windowFg"],c.end_time=f.time,c.stop=!0,c.templateUrl="templates/item/sxs-"+a+".html";else{var d={scene:"templates/scene/1col.html",transcript:"templates/item/transcript.html",annotation:"templates/item/pullquote-noattrib.html",link:"templates/item/link.html",image:"templates/item/image-plain.html",file:"templates/item/file.html",question:"templates/item/question-mc.html",video:"TODO:VIDEO"};c.templateUrl=d[a]}return angular.extend(b,c),b}}]),angular.module("com.inthetelling.story").controller("EventTestController",["$scope","$routeParams","mockSvc","modelSvc","appState",function(a,b,c,d,e){c.mockEpisode("ep1"),e.episodeId="ep1",e.product="producer",e.lang="en",a.item=d.events[b.eventId]}]),angular.module("com.inthetelling.story").directive("ittLogin",["$location","$routeParams","config","authSvc","appState","errorSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!1,link:function(g){g.userHasRole=d.userHasRole,g.appState=e,g.loginForm={auth_key:"",password:""},g.apiDataBaseUrl=c.apiDataBaseUrl,d.authenticate().then(function(){if(f.init(),b.key&&a.search("key",null),b.episode){var c=b.episode;a.search("episode",null),a.search("nonce",null),a.path("/episode/"+c)}else if(b.narrative){var d=b.narrative;if(a.search("narrative",null),a.search("nonce",null),b.timeline){var e=b.timeline;a.search("timeline",null),a.path("/story/"+d+"/"+e)}else a.path("/story/"+d)}else 0===Object.keys(b).length&&a.path("/user")},function(){}),g.adminLogin=function(){d.adminLogin(g.loginForm.auth_key,g.loginForm.password).then(function(){},function(){g.badlogin=!0})},g.logout=function(){d.logout()}}}}]),angular.module("com.inthetelling.story").directive("autofocus",["$timeout",function(a){return{link:function(b,c){a(function(){"TEXTAREA"===c[0].tagName||"INPUT"===c[0].tagName?c[0].focus():c.find("input,textarea")[0].focus()})}}}]),angular.module("com.inthetelling.story").directive("ittMcQuestion",["questionAnswersSvc","analyticsSvc","appState",function(a,b,c){return{restrict:"E",replace:!1,scope:{plugin:"=data",qid:"=",choices:"=",correct:"=",onChoice:"=",questionType:"@",showChart:"="},templateUrl:"templates/item/question-mc-inner.html",link:function(d){d.scoreQuiz=function(a){d.plugin.distractors[a].selected=!0,d.plugin.hasBeenAnswered=!0,d.plugin.selectedDistractor=d.plugin.distractors[a].index,b.captureEventActivity("question-answered",d.qid,{answer:d.plugin.distractors[a].text,index:d.plugin.distractors[a].index,correct:!!d.plugin.distractors[a].correct})},d.feedback=function(){for(var a=0;a<d.plugin.distractors.length;a++)if(d.plugin.distractors[a].index===d.plugin.selectedDistractor)return d.plugin.distractors[a].correct?d.plugin.correctfeedback:d.plugin.incorrectfeedback},d.questionType=d.plugin.questiontype,d.chartOptions={};var e=function(a){var b=[];for(var e in a)a.hasOwnProperty(e)&&angular.forEach(d.plugin.distractors,function(d){if(d.index+""==e+""){var f=d.text;"object"==typeof f&&(f=f[c.lang]||f.en||""),b.push({data:a[e],label:f})}});return b};if(d.plugin.hasBeenAnswered===!0){void 0===d.plugin.answer_counts&&(d.plugin.answer_counts={});var f=d.plugin.answer_counts,g=e(f);d.chartData=g}d.scorePoll=function(b){a.saveAnswer("question-answered",d.qid,{answer:d.plugin.distractors[b].text,index:d.plugin.distractors[b].index,correct:!!d.plugin.distractors[b].correct}).then(function(){d.plugin.answer_counts=void 0===d.plugin.answer_counts?{}:d.plugin.answer_counts,a.incrementAnswerCount(d.plugin.answer_counts,d.plugin.distractors[b].index);var c=d.plugin.answer_counts,f=e(c);d.chartData=f,d.plugin.distractors[b].selected=!0,d.plugin.hasBeenAnswered=!0,d.plugin.selectedDistractor=d.plugin.distractors[b].index})}}}}]),angular.module("com.inthetelling.story").directive("ittFlotr2Chart",function(){var a=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:'<div class="flotContainer"><div class="chartContainer" id="chartContainer" aria-label="{{chartLabel}}"></div><div class="legendContainer" id="legendContainer"></div></div>',link:function(b,c,d){var e=function(a,c,d){b.chartLabel=k(c),$.plot(a,c,d),a.show()},f=$("#chartContainer");f.attr("id","chartContainer"+a);var g=$("#legendContainer");g.attr("id","legendContainer"+a++);var h=function(a,b){return Math.round(b.percent)+"% ("+b.data[0][1]+"): "+a},i=function(a,b){return'<div style="padding: 3px; font-size: 80%">'+Math.round(b.percent)+"%</div>"};b.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.7},formatter:i}}},legend:{show:!0,labelFormatter:h,noColumns:1,position:"sw",margin:0,backgroundColor:null,backgroundOpacity:1,sorted:"descending",container:g},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}},b.$watch(function(){return f.width()},function(a){a>0&&(f.css({height:a}),e(f,JSON.parse(b.data),b.chartOptions),b.observeData=d.$observe("data",function(a){b.data=JSON.parse(a),e(f,b.data,b.chartOptions)}),b.$on("$destroy",b.observeData))});var j=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].data;for(var d=0;d<a.length;d++)a[d].percent=a[d].data/b*100;return a},k=function(a){var b="";a=j(a);for(var c=0;c<a.length;c++)b+=Math.round(a[c].percent)+"% of users totaling "+a[c].data+" choose '"+a[c].label+"'. ";return b}}}}),angular.module("com.inthetelling.story").directive("ittTimeline",["$rootScope","$timeout","appState","timelineSvc","modelSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline-story.html",controller:"TimelineController",link:function(a,f){function g(a){return a>98?100:a}function h(a){return 3>a?0:a}function i(b){var c=a.currentVolume()+b;c=g(c),"function"==typeof a.setVolume&&a.setVolume(c)}function j(b){var c=a.currentVolume()-b;c=h(c),"function"==typeof a.setVolume&&a.setVolume(c)}a.appState=c,a.timeline=d,a.handlePosition=0,a.zoomLevel=1,a.zoomOffset=0,c.isTouchDevice&&!c.hasBeenPlayed&&(a.isSuppressed=!0);var k,l,m=a.$watch(function(){return c.hasBeenPlayed},function(b){b===!0&&(a.isSuppressed=!1,m())});b(function(){k=f.find(".progressbarContainer"),l=f.find(".progressbar"),u()}),a.autoZoom=function(b){a.savedZoomLevel=a.zoomLevel;var d=b.end_time-b.start_time,e=c.duration-b.end_time;a.zoomLevel=Math.min(Math.max(Math.round(.6*e/d),1),20),p()},a.endAutoZoom=function(){a.savedZoomLevel&&(a.zoomLevel=a.savedZoomLevel,p(),delete a.savedZoomLevel)};var n=a.$watch(function(){return c.editEvent},function(b){"producer"===c.product&&(b?a.autoZoom(b):a.endAutoZoom())});a.appState=c,a.setNewLanguage=function(){e.setLanguageStrings()},a.showSceneMenuTooltip=function(b){b&&!c.isTouchDevice?a.sceneMenuToolTip=!0:a.sceneMenuToolTip=!1},a.prevScene=function(){d.prevScene()},a.nextScene=function(){d.nextScene()},a.userChangingVolume=function(b){c.muted&&a.toggleMute();var d=angular.element(b.currentTarget),e=function(b,c){var e=(b.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),c?a.setVolume(e):a.$apply(a.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})};var o={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};a.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case o.LEFTARROW:j(1),c=!1;break;case o.RIGHTARROW:i(1),c=!1;break;case o.UPARROW:i(1),c=!1;break;case o.DOWNARROW:j(1),c=!1;break;case o.PAGEUP:i(10),c=!1;break;case o.PAGEDOWN:j(10),c=!1;break;case o.HOME:j(100),c=!1;break;case o.END:i(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},a.currentVolume=function(){return c.muted?0:c.volume},a.audioIcon=function(){return c.muted?"muted":"vol"+Math.floor(c.volume/34)},a.showTooltip=function(a){a.showTooltip=!0},a.hideTooltip=function(a){a.showTooltip=!1},a.zoomIn=function(){a.stopWatching=!0,a.zoomLevel=a.zoomLevel+1,p()},a.zoomOut=function(){a.stopWatching=!0,a.zoomLevel<=2?a.zoomLevel=1:a.zoomLevel<=3?a.zoomLevel=1.5:a.zoomLevel=a.zoomLevel/2,p()};var p=function(){a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),k.stop().animate({left:100*a.zoomOffset+"%",width:100*a.zoomLevel+"%"},1e3,function(){a.stopWatching=!1})};a.$watch(function(){return{t:c.time,d:c.duration}},function(){a.stopWatching||(a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),k&&k.css({left:100*a.zoomOffset+"%"}))},!0);var q=function(d){b(function(){a.seekHandleVisible=!0},250),a.isSeeking=!0;var e=c.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(e,function(){s()}),angular.element(document).bind(e,function(){t()}),r(d)};a.$watch(function(){return c.time},function(){c.editEvent&&(a.willSeekTo=c.time)});var r=function(b){a.isSeeking&&(a.willSeekTo=(b.clientX-k.offset().left)/k.width()*c.duration,a.willSeekTo<0&&(a.willSeekTo=0),a.willSeekTo>c.duration&&(a.willSeekTo=c.duration))},s=function(){a.stopWatching=!0,a.enableAutoscroll(),d.seek(a.willSeekTo,"scrubTimeline"),p()},t=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),b(function(){a.isSeeking=!1,a.seekHandleVisible=!1})},u=function(){var a=$(f.find(".playhead"));c.isTouchDevice?(a.on("touchstart.timeline",function(a){q(a.originalEvent.targetTouches[0]),a.preventDefault()}),a.on("touchmove.timeline",function(a){r(a.originalEvent.targetTouches[0]),a.preventDefault()})):(a.on("mousedown.timeline",function(a){q(a),a.preventDefault()}),a.on("mousemove.timeline",function(a){r(a),a.preventDefault()}))};a.$on("$destroy",function(){t(),n()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["$interval","analyticsSvc","modelSvc","appState",function(a,b,c,d){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(e){e.episode=c.episodes[d.episodeId],b.captureEpisodeActivity("episodeLoad");var f=function(){e.episode=c.episodes[d.episodeId]};a(f,457)}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl"></span>',controller:"SceneController",link:function(a,d){"review"!==c.viewMode&&window.scrollTo(0,0),a.precalculateSceneValues(),a.appState=c;var e=function(){var b=d.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return d.find(".videoMagnet img").height()},function(a){a>0&&(c(),e())});else{d.find(".matchVideoHeight:visible").each(function(){$(this).css("height",d.find(".videoMagnet img").height())});var f=angular.element(window).height()-$("#CONTAINER").scrollTop();d.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",f-$(this).offset().top)}),d.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",f-$(this).offset().top-210)})}d.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&e()},!0),a.unwatchEdits=a.$watch(function(){return c.editEvent},a.precalculateSceneValues,!0),a.safetyBelt=b(e,1321),a.$on("$destroy",function(){a.unwatch(),a.unwatchEdits(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittShowHideVisualOnly",["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ittShowHideVisualOnly,function(b){b?a.removeClass(c,"visual-hide"):a.addClass(c,"visual-hide")})}}}]),angular.module("com.inthetelling.story").animation(".visual-hide",function(){return{addClass:function(a){a.fadeTo("slow",0,function(){})},removeClass:function(a){a.fadeTo("slow",1,function(){})}}}),angular.module("com.inthetelling.story").directive("ittShowFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.ittShowFocus,function(b){a(function(){b&&c.filter(":visible").first().focus()})},!0)}}]),function(){function a(){return{scope:!0,templateUrl:"templates/toolbar-story.html"}}angular.module("com.inthetelling.story").directive("ittToolbarStory",a)}(),angular.module("com.inthetelling.story").directive("ittVolumeSlider",["appState",function(a){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',
multiElement:!1,link:function(b){function c(a){return a>98?100:a}function d(a){return 3>a?0:a}function e(a){var d=b.currentVolume()+a;d=c(d),"function"==typeof b.setVolume&&b.setVolume(d)}function f(a){var c=b.currentVolume()-a;c=d(c),"function"==typeof b.setVolume&&b.setVolume(c)}b.appState=a,b.userChangingVolume=function(a){var c=angular.element(a.currentTarget),d=function(a,d){var e=(a.clientX-c.offset().left)/c.width()*100;e>98&&(e=100),3>e&&(e=0),d?b.setVolume(e):b.$apply(b.setVolume(e))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var g={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};b.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case g.LEFTARROW:f(1),c=!1;break;case g.RIGHTARROW:e(1),c=!1;break;case g.UPARROW:e(1),c=!1;break;case g.DOWNARROW:f(1),c=!1;break;case g.PAGEUP:e(10),c=!1;break;case g.PAGEDOWN:f(10),c=!1;break;case g.HOME:f(100),c=!1;break;case g.END:e(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},b.currentVolume=function(){return a.muted?0:a.volume}}}}]),function(){function a(){return{restrict:"E",scope:{src:"@",contenttype:"@"},replace:!0,templateUrl:"templates/iframe.html",controller:"ittIframeCtrl",controllerAs:"iframeCtrl",bindToController:!0}}function b(a,b){var c=this,d="allow-forms allow-same-origin allow-scripts";c.isYoutube=!1,b.extractYoutubeId(c.src)&&(c.isYoutube=!0),c.watcher=a.$watchGroup([function(){return c.src},function(){return c.contenttype}],function(){c.src&&(c.contenttype?c.sandbox="text/html"===c.contenttype?d:void 0:(c.sandbox=d,c.src.match(/.pdf$/)&&delete c.sandbox,c.src.match(/amazonaws.com\/itt/i)&&delete c.sandbox))}),a.$on("$destroy",function(){c.watcher()})}angular.module("com.inthetelling.story").directive("ittIframe",a).controller("ittIframeCtrl",b),b.$inject=["$scope","youtubeSvc"]}(),function(){function a(){return{scope:!0,templateUrl:"templates/loading.html"}}angular.module("com.inthetelling.story").directive("ittLoading",a)}(),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=450>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittReviewMode",["appState","$timeout",function(a,b){return{restrict:"A",replace:!1,scope:{allScenes:"=ittReviewMode"},templateUrl:"templates/episode/components/reviewmode-scenes.html",link:function(c){c.appState=a,c.scenes=[];var d=100,e=0;c.isLoading=!0;var f=[1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1/0];c.addOne=function(){if(e++,c.allScenes)c.scenes=c.allScenes.slice(0,f[e]),e<c.allScenes.length?b(c.addOne,d):(c.isLoading=!1,c.scenes=c.allScenes);else var a=c.$watch(function(){return c.allScenes},function(){c.allScenes&&(a(),c.addOne())})},b(c.addOne,d)}}}]),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","$interval","config","authSvc","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g,h,i){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(j,k){j.appState=f,j.item.avatar_id&&(j.item.avatar=i.assets[j.item.avatar_id]),"internal:editing"===j.item._id?k.addClass("noTransitions"):(e.userHasRole("admin")||j.item.user_id===f.user._id)&&(j.item.editableByThisUser=!0),j.toggleDetailView=function(){j.item.showInlineDetail?j.item.showInlineDetail=!1:(h.pause(),j.captureInteraction(),k.width()>450?j.item.showInlineDetail=!0:f.itemDetail=j.item)};var l={ENTER:13,SPACE:32};if(j.toggleDetailOnKeyPress=function(a){var b=a,c=!0;switch(b.keyCode){case l.ENTER:j.toggleDetailView(),c=!1;break;case l.SPACE:j.toggleDetailView(),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},j.forceModal=function(){h.pause(),f.itemDetail=j.item},j.outgoingLinkOnKeyPress=function(a,b){var c=b,d=!0;switch(c.keyCode){case l.ENTER:j.outgoingLink(a),d=!1;break;case l.SPACE:j.outgoingLink(a),d=!1;break;default:d=!0}d||(b.stopPropagation(),b.preventDefault())},j.outgoingLink=function(a){h.pause(),j.captureInteraction(),j.item.targetTop?b(function(){window.location.href=a}):window.open(a)},j.editItem=function(){f.editEvent=j.item,f.videoControlsActive=!0,f.videoControlsLocked=!0},j.captureInteraction=function(){g.captureEventActivity("clicked",j.item._id)},"templates/item/link-embed.html"===j.item.templateUrl)var m=j.$watch(function(){return f.time>j.item.start_time},function(a){a&&(j.captureInteraction(),m())});if(j.item.asset_id&&!j.item.asset&&(j.item.asset=i.assets[j.item.asset_id]),j.item.asset&&j.item.styleCss&&j.item.styleCss.match(/fill|contain|cover/)&&(j.item.asset.cssUrl="url('"+j.item.asset.url+"');",j.item.backgroundImageStyle="background-image: url('"+j.item.asset.url+"');"),j.item.data&&(j.plugin=j.item.data._plugin,j.plugin._type=j.item.data._pluginType,"credlyBadge"===j.plugin._type)){g.captureEventActivity("viewed",j.item._id),f.user.roles&&1===f.user.roles.length&&"guest"===f.user.roles[0]?j.plugin.eligibleForBadges=!1:(j.plugin.eligibleForBadges=!0,f.user.emails?j.plugin.userEmail=f.user.emails[0]:j.plugin.userEmail="",j.plugin.totalAchieved=0),j.checkBadgeEligibility=function(){j.plugin.eligibleForBadges&&angular.forEach(j.plugin.requirements,function(a){a.achieved||g.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,j.countAchievements()}),j.countAchievements()})},j.countAchievements=function(){var a=0;angular.forEach(j.plugin.requirements,function(b){b.achieved&&(a+=1)}),j.plugin.totalAchieved=a,j.plugin.totalAchieved===j.plugin.requirements.length&&(i.episodes[f.episodeId].styleCss=i.episodes[f.episodeId].styleCss+" uscHackUserHasBadge")},j.checkBadgeEligibility();var n=0;j.badgePoll=c(function(){n++,(j.item.isCurrent||"review"===f.viewMode)&&j.checkBadgeEligibility(),n>60&&c.cancel(j.badgePoll)},1e4),j.$on("$destroy",function(){c.cancel(j.badgePoll)}),j.badger=function(){j.plugin.gettingBadge=!0,a({method:"GET",url:d.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+j.plugin.credlyBadgeId+"&email="+j.plugin.userEmail}).success(function(a){j.checkBadgeEligibility(),"Badge previously sent."===a.status&&(j.plugin.alreadyHadBadge=!0),j.plugin.gotBadge=!0}).error(function(){j.plugin.gettingBadge=!1,j.plugin.error=!0})}}}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",["appState",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeEditor",["$rootScope","appState","errorSvc","modelSvc","dataSvc","awsSvc","youtubeSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{episode:"=ittEpisodeEditor"},templateUrl:"templates/producer/episode.html",controller:"EditController",link:function(c){c.episodeContainerId=d.episodes[b.episodeId].container_id;var f=d.containers[c.episodeContainerId];if(c.customer=d.customers[f.customer_id],c.episode.master_asset_id&&""!==c.episode.master_asset_id&&(c.masterAsset=d.assets[c.episode.master_asset_id]),c.uploadStatus=[],c.uneditedEpisode=angular.copy(c.episode),c.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:""},c.masterAsset&&c.masterAsset.urls.youtube.length&&1===Object.keys(c.masterAsset.urls).filter(function(a){return c.masterAsset.urls[a].length>0}).length?c.masterAssetType="Youtube":c.masterAssetType="Video",c.episode.styles)for(var h in c.itemForm)for(var i=0;i<c.episode.styles.length;i++)c.episode.styles[i].substr(0,h.length)===h&&(c.itemForm[h]=c.episode.styles[i].substr(h.length));c.langForm={};for(var j=0;j<c.episode.languages.length;j++)c.langForm[c.episode.languages[j].code]=!0;c.langForm[c.episode.defaultLanguage]=!0,c.languageWatcher=c.$watch(function(){return[c.langForm,c.episode.defaultLanguage]},function(){var a=0,b="",d=[];for(var e in c.langForm)c.langForm[e]?(a++,b=e,d.push({code:e})):c.episode.defaultLanguage===e&&(c.episode.defaultLanguage=!1);c.languageCount=a,c.episode.defaultLanguage===!1&&(c.episode.defaultLanguage=b),angular.forEach(d,function(a){a.code===c.episode.defaultLanguage&&(a["default"]=!0)}),c.episode.languages=angular.copy(d)},!0),c.watchStyleEdits=c.$watch(function(){return c.itemForm},function(){var a=[];for(var b in c.itemForm)c.itemForm[b]&&a.push(b+c.itemForm[b]);c.episode.styles=a,d.deriveEpisode(c.episode),d.resolveEpisodeEvents(c.episode._id)},!0),c.appState=b,c.watchEdits=c.$watchGroup(["episode.templateUrl","episode.title[appState.lang]","episode.description[appState.lang]"],function(a,b){if(a[0]!==b[0]){var e=[];if(b[0]){var f=b[0].match("templates/episode/(.*).html")[1];angular.forEach(c.episode.styles,function(a){a.toLowerCase()!=="color"+f&&a.toLowerCase()!=="typography"+f&&e.push(a)})}var g=a[0].match("templates/episode/(.*).html")[1];angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(a){g===a&&(e.push("color"+a[0].toUpperCase()+a.substring(1)),e.push("typography"+a[0].toUpperCase()+a.substring(1)))}),c.episode.styles=angular.copy(e)}d.deriveEpisode(c.episode),d.resolveEpisodeEvents(c.episode._id)}),c.dismissalWatcher=a.$on("player.dismissAllPanels",c.cancelEdit),c.cancelEdit=function(){c.cancelEpisodeEdit(c.uneditedEpisode)},c.attachChosenAsset=function(a){var b=d.assets[a],e=d.assets[c.episode.master_asset_id];if(c.showmessage="New video attached.",e&&b.duration<e.duration){var f=c.getItemsAfter(c.episode.items.concat(c.episode.scenes),b.duration);f.length&&(c.showmessage="Warning: this new video is shorter than the current video and we've detected that some existing content items will be impacted. If you save this edit, these events will have their start and end times adjusted to the new episode end. (If this isn't what you want, choose a different video or hit 'cancel'.)")}c.episode._master_asset_was_changed=!0,c.episode.master_asset_id=b._id,c.masterAsset=b,c.episode.masterAsset=b,d.deriveEpisode(c.episode)},c.attachPosterAsset=function(a){var b=d.assets[a];c.episode.poster_frame_id=a,c.episode.poster=b,d.deriveEpisode(c.episode)},c.assetUploaded=function(a){c.showUploadButtons=!1,c.showUploadField=!1,c.attachChosenAsset(a)},c.posterUploaded=function(a){c.showUploadButtonsPoster=!1,c.showUploadFieldPoster=!1,c.attachPosterAsset(a)},c.attachYouTube=function(a){c.showmessage="Getting video from YouTube...";var b=g.extractYoutubeId(a);b?g.getVideoData(b).then(function(b){var f={};f.you_tube_url=f.url=g.embeddableYoutubeUrl(a),f.duration=b.duration,f.name={en:b.title},f.description={en:b.description},f.content_type="video/x-youtube",e.createAsset(c.episodeContainerId,f).then(function(a){d.cache("asset",a),c.attachChosenAsset(a._id)})},function(){c.showmessage="Sorry, couldn't find that video on YouTube."}):c.showmessage="Sorry, couldn't match that to a valid YouTube url."},c.replaceAsset=function(a){a=a||"",c["showUploadButtons"+a]=!0,c["showUploadField"+a]=!1},c.selectText=function(a){a.target.select()},c.$on("$destroy",function(){c.watchEdits(),c.dismissalWatcher(),c.languageWatcher(),c.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittItemEditor",["$rootScope","$timeout","errorSvc","appState","modelSvc","timelineSvc","awsSvc","dataSvc","youtubeSvc",function(a,b,c,d,e,f,g,h,i){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/producer/item.html",controller:"EditController",link:function(g){var h;if(g.startRecordVideo=function(){g.isRecordingVideo=!g.isRecordingVideo;var a=.8*(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth);a>500&&(a=500),h=new window.YT.UploadWidget("recordWidgetContainer",{width:a,events:{onApiReady:function(){h.setVideoPrivacy("unlisted");var a=new Date,b=a.getMonth()+1+"-"+a.getDate()+"-"+a.getFullYear()+" "+a.getHours()%12+":"+a.getMinutes()+(a.getHours()>12?" pm":" am");h.setVideoTitle("In The Telling webcam recording: "+b)},onUploadSuccess:function(a){g.item.url=i.createEmbedLinkFromYoutubeId(a.data.videoId),g.isRecordingVideo=!1,g.isProcessingVideo=!0,b(function(){g.isProcessingVideo=!1},3e4)},onProcessingComplete:function(){g.isProcessingVideo=!1}}})},f.pause(),f.seek(g.item.start_time),g.uploadStatus=[],g.uneditedItem=angular.copy(g.item),g.uneditedItem.$$hashKey=g.item.$$hashKey,g.annotators=e.episodes[d.episodeId].annotators,g.episodeContainerId=e.episodes[d.episodeId].container_id,g.languages=e.episodes[d.episodeId].languages,g.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:"",position:"",pin:""},g.item.layouts||(g.item.layouts=["inline"]),g.item.styles){for(var j in g.itemForm)for(var k=0;k<g.item.styles.length;k++)g.item.styles[k].substr(0,j.length)===j&&(g.itemForm[j]=g.item.styles[k].substr(j.length));for(var l=0;l<g.item.styles.length;l++)("contain"===g.item.styles[l]||"cover"===g.item.styles[l]||"center"===g.item.styles[l]||"fill"===g.item.styles[l])&&(g.itemForm.position=g.item.styles[l]),("tl"===g.item.styles[l]||"tr"===g.item.styles[l]||"bl"===g.item.styles[l]||"br"===g.item.styles[l])&&(g.itemForm.pin=g.item.styles[l])}g.item.producerItemType||c.error({data:"Don't have a producerItemType for item "+g.item._id}),g.itemEditor="templates/producer/item/"+d.product+"-"+g.item.producerItemType+".html",g.appState=d,g.watchEdits=g.$watch(function(){return g.item},function(a,b){b&&(a.yturl!==b.yturl&&(g.item.url=i.embeddableYoutubeUrl(a.yturl)),a.templateUrl!==b.templateUrl&&("templates/item/image-fill.html"===a.templateUrl&&(g.item.cosmetic=!0,g.item.layouts=["windowBg"],g.itemForm.position="fill"),"templates/item/image-fill.html"===b.templateUrl&&(g.item.cosmetic=!1,g.item.layouts=["inline"],g.itemForm.position="",g.itemForm.pin="")),g.item=e.deriveEvent(a),a.asset?(g.item.asset.cssUrl="url('"+a.asset.url+"');",g.item.backgroundImageStyle="background-image: url('"+a.asset.url+"');"):(delete g.item.asset,delete g.item.backgroundImageStyle),(a.start_time!==b.start_time||a.start_time!==b.end_time)&&e.resolveEpisodeEvents(d.episodeId))},!0),g.watchStyleEdits=g.$watch(function(){return g.itemForm},function(){var a=[];for(var b in g.itemForm)g.itemForm[b]&&("position"===b||"pin"===b?a.push(g.itemForm[b]):a.push(b+g.itemForm[b]));g.item.styles=a,g.item.asset&&(g.item.asset.cssUrl="url('"+g.item.asset.url+"');",g.item.backgroundImageStyle="background-image: url('"+g.item.asset.url+"');")},!0),g.forcePreview=function(){d.editEvent.fnord=d.editEvent.fnord?"":"fnord"};var m=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1};g.setItemTime=function(){"Scene"===g.item._type?(e.resolveEpisodeEvents(d.episodeId),f.updateSceneTimes(g.item.episode_id)):g.item.stop?(g.item.end_time=g.item.start_time,e.resolveEpisodeEvents(d.episodeId),f.updateEventTimes(g.item)):(e.resolveEpisodeEvents(d.episodeId),(g.item.end_time<=g.item.start_time||g.item.end_time>e.events[g.item.scene_id].end_time)&&(g.item.end_time=e.events[g.item.scene_id].end_time),f.updateEventTimes(g.item))};var n=function(a,b){return a.start_time-b.start_time};g.setItemEndTime=function(){(g.item.end_time<=g.item.start_time||g.item.end_time>e.events[g.item.scene_id].end_time)&&(g.item.end_time=e.events[g.item.scene_id].end_time),f.updateEventTimes(g.item)};var o=function(){var a=e.episodes[d.episodeId],b=angular.copy(a.items);return b.filter(m)},p=function(a,b,c){if(!a)return!1;var d,e=a.end_time;c=c.sort(n);for(var f=0,g=c.length;g>f;f++)if(c[f]._id===b._id){d=c[f+1];break}return d&&d.start_time<a.end_time&&(e=d.start_time),e},q=function(a){return"Scene"===a._type?a:e.events[g.item.scene_id]};g.switchToAutoOrCustom=function(a){if(a){var b=m(g.item)?o():[];g.item.end_time=p(q(g.item),g.item,b),g.customEndTime=!1}else g.customEndTime=!0},g.isAutoEndTime=function(){var a=m(g.item)?o():[],b=p(q(g.item),g.item,a);return g.item.end_time===b?!0:!1},g.customEndTime=!g.isAutoEndTime(),g.dismissalWatcher=a.$on("player.dismissAllPanels",g.cancelEdit),g.cancelEdit=function(){g.cancelEventEdit(g.uneditedItem)},g.assetUploaded=function(a){g.item.asset=e.assets[a],"Link"===g.item._type?g.item.link_image_id=a:"Annotation"===g.item._type?g.item.annotation_image_id=a:g.item.asset_id=a,g.showUploadButtons=!1,g.showUploadField=!1},g.replaceAsset=function(){g.showUploadButtons=!0,g.item.sxs&&(g.item.removedAssets=g.item.removedAssets||[],"Link"===g.item._type?g.item.removedAssets.push(g.item.link_image_id):"Annotation"===g.item._type?g.item.removedAssets.push(g.item.annotation_image_id):g.item.removedAssets.push(g.item.asset_id))},g.attachChosenAsset=function(a){var b=e.assets[a];g.item&&(g.item.asset=b,"Upload"===g.item._type||"Plugin"===g.item._type?g.item.asset_id=a:"Link"===g.item._type?g.item.link_image_id=a:"Annotation"===g.item._type&&(g.item.annotation_image_id=a))},g.$on("$destroy",function(){g.watchEdits(),g.dismissalWatcher(),g.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$interval","$rootScope","appState","timelineSvc","dataSvc","modelSvc",function(a,b,c,d,e,f,g){var h=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo",poster:"="},link:function(i,j){i.appState=d,i.uid=++h,a(function(){i.initVideo(j)}),i.videoClick=function(){"paused"===d.timelineState?e.play():e.pause()},i.spaceWatcher=c.$on("userKeypress.SPACE",i.videoClick),i.bufferInterval=b(function(){if(i.getBufferPercent){var a=i.getBufferPercent();a>98&&(b.cancel(i.bufferInterval),d.bufferedPercent=100)}},200);var k=0;i.pollInterval=b(function(){k++,k>360&&b.cancel(i.pollInterval);var a=g.episodes[d.episodeId];a&&a.masterAsset&&!g.isTranscoded(a.masterAsset)?f.getSingleAsset(a.master_asset_id).then(function(a){g.isTranscoded(a)&&(b.cancel(i.pollInterval),g.cache("asset",a))}):b.cancel(i.pollInterval)},1e4),i.$on("$destroy",function(){i.spaceWatcher(),b.cancel(i.bufferInterval),b.cancel(i.pollInterval)})}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();Math.abs(a)>1||Math.abs(b)>1?e.offset({top:e.offset().top+a/4,left:e.offset().left+b/4}):e.offset(d.magnet.offset()),Math.abs(c)>4?e.width(Math.ceil(e.width()+c/4)):e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))})};a.$on("magnet.changeMagnet",function(a,b){g(b)});var i=function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute"),e.offset(d.magnet.offset()),e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))};a.$on("magnet.jumpToMagnet",i),d.$on("$destroy",function(){d.unwatch&&d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope","appState",function(a,b){return{restrict:"A",replace:!0,scope:!0,link:function(c,d){c.changeMagnet=function(c){a.$emit("magnet.changeMagnet",c),(b.isTouchDevice||0===b.time)&&a.$emit("magnet.jumpToMagnet")},c.unwatchVisibility=c.$watch(function(){return d.is(":visible")},function(a){a&&c.changeMagnet(d)}),"watchModeVideoMagnet"===d.attr("id")&&(c.unwatchSize=c.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:d.is(":visible")}},function(){var a=angular.element(window),b=a.height()-46;a.width()/b>16/9?d.width(16/9*b):d.width(a.width()),c.changeMagnet(d)},!0)),c.$on("$destroy",function(){c.unwatchVisibility(),c.unwatchSize&&c.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",["$timeout","appState",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.appState=b,a.indexEvents()}}}]),angular.module("com.inthetelling.story").directive("ittContainer",["$timeout","$location","$route","appState","modelSvc","recursionHelper","dataSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{container:"=ittContainer",depth:"=depth"},templateUrl:"templates/container.html",compile:function(c){return f.compile(c,function(c){c.appState=d,c.containers=e.containers,c.customer=e.customers[c.container.customer_id],c.isDemoServer=b.host().match(/demo|localhost|api-dev|client.dev/),c.selectText=function(a){a.target.select()},c.containerTypes=["customer","course","session","episode"],c.toggleChildren=function(){c.container.children||c.container.episodes.length?c.container.showChildren=!c.container.showChildren:g.getContainer(c.container._id).then(function(a){c.container=e.containers[a],c.container.showChildren=!0})},c.renameContainer=function(){var a={};angular.forEach(["_id","customer_id","episodes","keywords","parent_id","sort_order"],function(b){a[b]=angular.copy(c.container[b])}),a.name={en:c.container.newContainerName},g.updateContainer(a).then(function(){c.container.editingContainer=!1})},c.addContainer=function(){var a={customer_id:c.container.customer_id,parent_id:c.container._id,name:{en:angular.copy(c.container.newContainerTitle)}};g.createContainer(a).then(function(a){if(2===c.depth){var b={container_id:a._id,title:angular.copy(a.name)};g.getCommon().then(function(){g.createEpisode(b).then(function(a){var b={_type:"Scene",title:{},description:{},templateUrl:"templates/scene/1col.html",start_time:0,end_time:0,episode_id:a._id};g.storeItem(b)})})}}),c.container.newContainerTitle="",c.container.addingContainer=!1},c.deleteEpisodeAndContainer=function(b){var c=e.containers[b],d=c.parent_id?c.parent_id:c.ancestry.replace(/.*\//,""),f=e.containers[d],h=[];angular.forEach(f.children,function(a){a._id!==b&&h.push(a)}),f.children=h,c.episodes.length?g.deleteEpisode(c.episodes[0]).then(function(){a(function(){g.deleteContainer(c._id)},250)}):g.deleteContainer(c._id)}})}}}]),angular.module("com.inthetelling.story").directive("ittContainerEpisodes",["modelSvc","recursionHelper","appState","dataSvc",function(a,b,c,d){return{restrict:"A",replace:!1,scope:{container:"=ittContainerEpisodes",forAdmin:"=forAdmin"},templateUrl:"templates/containerepisodes.html",compile:function(e){return b.compile(e,function(b){b.containers=a.containers,b.crossEpisodePath=c.crossEpisodePath,b.episodeId=c.episodeId,b.loadChildren=function(){a.containers[b.container._id].haveNotLoadedChildData&&d.getContainer(b.container._id)},b.toggle=function(){b.wasClicked=!b.wasClicked},b.selectEpisode=function(){b.$emit("episodeSelected",b.container.episodes[0])}})}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeList",["$location","$timeout","appState","authSvc","dataSvc","modelSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,link:function(a){a.logout=function(){d.logout()},a.appState=c,a.loading=!0,a.containers=f.containers,a.userHasRole=d.userHasRole,e.getCustomerList(),e.getContainerRoot().then(function(b){a.root={children:[]},angular.forEach(b,function(b){a.root.children.push(f.containers[b])}),a.loading=!1},function(){a.failedLogin=!0,a.loading=!1})}}}]),angular.module("com.inthetelling.story").directive("ittUser",["appState","authSvc","dataSvc","awsSvc","modelSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/user.html",link:function(f,g,h){f.inPlayer=h.inPlayer,f.appState=a,f.loading=!0,f.logout=b.logout,b.authenticate().then(function(){f.loading=!1,f.user=a.user,f.userHasRole=b.userHasRole,f.inPlayer||f.userHasRole("guest")||f.getMyNarratives()}),f.uploadStatus=[],f.toggleUploadAvatar=function(){f.showUploadField=!f.showUploadField},f.uploadAvatar=function(b){f.uploadStatus[0]={bytesSent:0,bytesTotal:1},f.uploads=d.uploadUserFiles(a.user._id,b),f.uploads[0].then(function(b){f.showUploadField=!1,e.cache("asset",b.file),a.user.avatar_id,a.user.avatar_id=b.file._id,f.updateUser(),delete f.uploads},function(){},function(a){f.uploadStatus[0]=a})},f.updateUser=function(){b.updateUser(a.user).then(function(){f.user=a.user})},f.getMyNarratives=function(){c.getUserNarratives(f.user._id).then(function(a){f.myPurchases=a,angular.forEach(f.myPurchases,function(a){a.daysUntilExpiration=Math.floor((new Date(a.expiration_date)-new Date)/864e5),c.getNarrativeOverview(a.narrative_id).then(function(a){angular.forEach(f.myPurchases,function(b){b.narrative_id===a._id&&(b.narrativeData=a)})})})})}}}}]),angular.module("com.inthetelling.story").directive("ittNarrative",["authSvc","appState","$location","$routeParams","modelSvc","dataSvc",function(a,b,c,d,e,f){return{template:function(){return'<div ng-include="narrative.templateUrl"></div>'},link:function(g){g.loading=!0,g.logout=a.logout,g.tmpSetNarrativeTemplate=function(){g.narrative.templateUrl="templates/narrative/default.html",d.admin&&(g.narrative.templateUrl="templates/narrative/edit.html")},g.stopEditing=function(){c.search("admin",null)};var h=function(){g.userHasRole=a.userHasRole,g.user=b.user,a.userHasRole("admin")&&f.getCustomerList().then(function(a){g.customerList=a})};g.isOwner=!1,g.toggleOwnership=function(){g.isOwner=!g.isOwner};var i=g._id?g._id:d.narrativePath;i?f.getNarrative(i).then(function(a){h(),g.loading=!1,g.narrative=a,g.tmpSetNarrativeTemplate()}):(a.authenticate().then(h),g.loading=!1,g.toggleOwnership(!0),g.narrative={},g.tmpSetNarrativeTemplate()),g.toggleEpisodeList=function(){g.showEpisodeList=!g.showEpisodeList},g.$on("episodeSelected",function(a,b){g.showEpisodeList=!1,g.addTimeline(b)}),g.createNarrative=function(){a.authenticate().then(function(){f.createNarrative(g.narrative).then(function(a){c.path("/story/"+a._id)})})},g.updateNarrative=function(){g.narrative.saveInProgress=!0,f.updateNarrative(g.narrative).then(function(){g.tmpSetNarrativeTemplate(),g.narrative.saveInProgress=!1})},g.addTimeline=function(a){f.getEpisodeOverview(a).then(function(a){var b={name:a.title,description:a.description,hidden:!1,path_slug:"",sort_order:g.narrative.timelines.length,parent_episode:a};f.getSingleAsset(a.master_asset_id).then(function(a){a?b.duration=a.duration:b.duration=0,g.narrative.timelines.push(b),g.isAddingTimeline=!0})})},g.saveTimeline=function(a){a.saveInProgress=!0,a._id?f.storeTimeline(g.narrative._id,a).then(function(){a.saveInProgress=!1}):f.createChildEpisode({parent_id:a.parent_episode._id,title:a.name}).then(function(b){f.storeTimeline(g.narrative._id,a).then(function(c){f.createEpisodeSegment(c._id,{episode_id:b._id,start_time:0,end_time:a.duration,sort_order:0,timeline_id:c._id}).then(function(a){c.episode_segments=[a],f.storeTimeline(g.narrative._id,c).then(function(){g.isAddingTimeline=!1;var a=g.narrative._id;f.getNarrative(a).then(function(){g.narrative=e.narratives[a],g.tmpSetNarrativeTemplate()})})})})})}}}}]),angular.module("com.inthetelling.story").directive("ittNarrativeList",["dataSvc","authSvc","$routeParams","appState",function(a,b,c,d){return{restrict:"A",replace:!0,templateUrl:"templates/narrativelist.html",link:function(e){b.authenticate().then(function(){e.userHasRole=b.userHasRole,e.user=d.user,c.admin&&(e.showAddNarrative=!0)}),e.logout=b.logout,a.getNarrativeList().then(function(a){e.narratives=a})}}}]),angular.module("com.inthetelling.story").directive("ittNarrativeTimeline",["$routeParams","$timeout","dataSvc","appState","authSvc","modelSvc","errorSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,templateUrl:"templates/player-timeline.html",link:function(b){d.init(),c.getNarrative(a.narrativePath).then(function(c){d.narrativeId=c._id,b.narrative=c;var f=e.getRoleForNarrative(c._id),h=e.getDefaultProductForRole(f);d.product=h,angular.forEach(c.timelines,function(c){(c._id===a.timelinePath||c.path_slug.en===a.timelinePath)&&(d.timelineId=c._id,c.episode_segments[0]&&(d.episodeId=c.episode_segments[0].episode_id,d.episodeSegmentId=c.episode_segments[0]._id,b.showPlayer=!0))}),d.episodeId||g.error({data:"Sorry, no episode was found in this timeline."})})}}}]),function(){function a(){return{restrict:"EA",template:'<div id="{{ittYoutubeCtrl.embedId}}"></div>',scope:{embedUrl:"@",onPlayerStateChange:"=?",onReady:"=?",mainPlayer:"=mainPlayer"},controller:"ittYoutubeCtrl",controllerAs:"ittYoutubeCtrl",bindToController:!0}}function b(a,b,c){var d,e,f=this;f.ytVideoID=c.extractYoutubeId(f.embedUrl),void 0===f.onPlayerStateChange&&(f.onPlayerStateChange=angular.noop),void 0===f.onReady&&(f.onReady=angular.noop),angular.isDefined(f.mainPlayer)?(d=f.mainPlayer,e=!0):(e=!1,d=f.ytVideoID),b.setPlayerId(d,e).then(function(c){f.embedId=c,a(function(){b.create(c,f.ytVideoID,f.onPlayerStateChange,angular.noop,f.onReady)},0)})}angular.module("com.inthetelling.story").directive("ittYoutube",a).controller("ittYoutubeCtrl",b),b.$inject=["$timeout","youTubePlayerManager","youtubeSvc"]}(),angular.module("com.inthetelling.story").directive("sxsAddContent",["appState",function(a){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/producer/addcontent.html",controller:"EditController",link:function(b){b.appState=a,b.expand=function(){b.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){b.collapse()})},b.collapse=function(){b.expanded=!1}}}}]),angular.module("com.inthetelling.story").directive("sxsInputTime",["appState","$rootScope","$timeout","modelSvc","timelineSvc",function(a,b,c,d,e){return{scope:{item:"=sxsInputTime"},templateUrl:"templates/producer/inputtime.html",link:function(f,g,h){f.parse=function(c){var d;if(void 0===c||""===c)d=a.time;else if(isNaN(c)){var e=c.split(":");2===e.length?(isNaN(e[0])&&(e[0]=0),isNaN(e[1])&&(e[1]=0),d=60*+e[0]+ +e[1]):d=a.time}else d=c;return.01>d&&(d=.01),b.$emit("searchReindexNeeded"),d},f.format=function(a){var b=Math.floor(a/60),c=Math.round(a%60*100)/100;return 10>c&&(c="0"+c),b+":"+c},f.fieldname=angular.copy(h.inputField),f.realValue=angular.copy(f.item[h.inputField]),f.model=f.format(f.realValue),f.appState=a,f.scene="Scene"===f.item.type?f.item:d.events[f.item.scene_id],"Scene"===f.item._type?f.scene=function(){return f.item}:f.scene=function(){return d.sceneAtEpisodeTime(f.item.cur_episode_id,a.time)};var i=d.episodes[f.item.cur_episode_id].masterAsset.duration;f.$watch(function(){return f.parse(f.model)},function(a){f.setTime(a),"start_time"===h.inputField&&f.item.stop&&(f.item.end_time=a)}),f.nudge=function(a){c.cancel(j),g.find(".inputfield").focus();var b=a/30;f.setTime(f.item[h.inputField]+b),"start_time"===h.inputField&&e.seek(f.item[h.inputField]+b)},f.setTime=function(a){0>a&&(a=0),a>i&&(a=i),f.item.stop&&(f.item.end_time=a),f.realValue=a,f.item[h.inputField]=f.realValue,f.model=f.format(a),f.item.invalid_end_time=f.item.start_time>f.item.end_time};var j;f.showTools=function(a){a?f.tooltip=!0:j=c(function(){f.tooltip=!1},300)},f.isTranscript=function(){return!1}}}}]),angular.module("com.inthetelling.story").directive("sxsAnnotatorAutocomplete",["modelSvc","$timeout","appState",function(a,b,c){return{require:"ngModel",templateUrl:"templates/producer/annotator-autocomplete.html",scope:{annotators:"=sxsAnnotatorAutocomplete",item:"=item"},link:function(d,e,f,g){d.appState=c,d.hasAnnotator=function(){return Object.keys(d.item.annotator).length>0},angular.forEach(d.annotators,function(b){b.annotation_image_id&&(b.imageUrl=a.assets[b.annotation_image_id].url)}),d.annotator={name:d.item.annotator},d.annotators[d.item.annotator]&&d.annotators[d.item.annotator].annotation_image_id&&(d.annotator.imageUrl=a.assets[d.annotators[d.item.annotator].annotation_image_id].url),
d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1,e.find(".annotatorChooser").bind("keydown",function(a){switch(a.which){case 40:d.preselectedItem=(d.preselectedItem+1)%Object.keys(d.filteredAnnotators).length;break;case 38:d.preselectedItem=(d.preselectedItem-1)%Object.keys(d.filteredAnnotators).length;break;case 13:a.preventDefault(),d.preselectedItem>-1&&d.selectByIndex(d.preselectedItem)}}),d.handleAutocomplete=function(){if(d.annotator.name="",d.searchText){d.preselectedItem=-1;var a={};angular.forEach(d.annotators,function(b){b.key.toLowerCase().indexOf(d.searchText.toLowerCase())>-1&&(a[b.key]=b)}),d.filteredAnnotators=a,1===Object.keys(d.filteredAnnotators).length&&(d.preselectedItem=0)}else d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1},d.selectByIndex=function(a){if(!(0>a)){var b=Object.keys(d.filteredAnnotators).sort();d.select(d.filteredAnnotators[b[a]])}},d.select=function(b){d.preselectedItem=-1,b.annotation_image_id?(d.item.annotation_image_id=b.annotation_image_id,d.item.asset=a.assets[b.annotation_image_id],d.annotator.imageUrl=d.item.asset.url):(delete d.annotator.imageUrl,delete d.item.asset),g.$setViewValue(b.name),d.searchText=""},d.autoCompleting=!1,d.showAutocomplete=function(){var a=e.find(".annotatorChooser")[0];a.setSelectionRange(0,a.value.length),d.autoCompleting=!0},d.hideAutocomplete=function(){b(function(){d.preselectedItem>-1?d.selectByIndex(d.preselectedItem):""!==d.searchText&&d.addNewAnnotator(),d.autoCompleting=!1},300)},d.addNewAnnotator=function(){var a=d.searchText;d.item.annotator={},d.item.annotator[c.lang]=a,d.searchText="",d.handleAutocomplete()},d.uploadAnnotatorImage=function(){window.alert("TODO")}}}}]),angular.module("com.inthetelling.story").directive("sxsInputI18n",["appState","$timeout","textAngularManager",function(a,b,c){return{templateUrl:"templates/producer/inputi18n.html",scope:{field:"=sxsInputI18n",inputtype:"=inputtype"},link:function(d,e,f){d.field||(d.field={en:""}),d.appState=a,"textarea"===d.inputtype&&(d.textangularname="ta"+(new Date).getUTCMilliseconds()+"y"+Math.random().toString(16),b(function(){if(void 0!==f.autofocus){var a=c.retrieveEditor(d.textangularname).scope;a.displayElements.text.trigger("focus")}}),d.trim=function(){var b=d.field[a.lang];b&&(b=b.replace(/<br\/>/g,"<br>"),b=b.replace(/<div>/g,"<br>"),b=b.replace(/<\/?(span|div)>/g,""),b=b.replace(/(<br>)*$/,""),d.field[a.lang]=b)},d.sanitizePastedHtml=function(a){var b=document.createElement("div");return b.innerHTML=a,b.textContent})}}}]),angular.module("com.inthetelling.story").directive("ittTabs",function(){return{restrict:"A",replace:!0,link:function(a,b){a.tabs=[];for(var c=!1,d=b.find(".ittTab"),e=0;e<d.length;e++)a.tabs[e]=$(d[e]).hasClass("cur"),a.tabs[e]&&(c=!0);c||(a.tabs[0]=!0),a.tab=function(b){for(var c=0;c<d.length;c++)a.tabs[c]=!1;a.tabs[b]=!0}}}}).directive("ittTab",function(){return{restrict:"A",replace:!1,transclude:!0,scope:{isCur:"=ittTab"},template:'<div><div class="ittTabLabel" ng-class="{cur: isCur}"><a ng-click="$parent.tab(tabindex)">{{tablabel}}</a></div><div class="ittTabContents" ng-show="isCur" ng-transclude></div></div>',link:function(a,b,c){a.tablabel=c.tablabel,a.tabindex=c.tabindex}}}),angular.module("com.inthetelling.story").controller("ContainerAssetsTestController",["$scope","$routeParams",function(a,b){a.containerId=b.containerId}]).directive("sxsContainerAssets",["$routeParams","$rootScope","recursionHelper","dataSvc","modelSvc","awsSvc","appState",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{containerId:"=sxsContainerAssets"},templateUrl:"templates/producer/container-assets.html",compile:function(a){return c.compile(a,function(a){a.appState=g,e.containers[a.containerId]?(a.container=e.containers[a.containerId],a.container.assetsHaveLoaded||d.getContainerAssets(a.containerId)):d.getContainer(a.containerId).then(function(){a.container=e.containers[a.containerId],d.getContainerAssets(a.containerId)}),a.assets=e.assets,a.uploadStatus=[],a.up=function(){a.showParent=!0},a.toggleImages=function(){a.onlyImages=!a.onlyImages},a.toggleGrid=function(){a.gridView=!a.gridView},a.assetClick=function(a){b.$emit("UserSelectedAsset",a)},a.uploadAsset=function(b){var c=b.files;a.uploadStatus[0]={bytesSent:0,bytesTotal:1},a.uploads=f.uploadContainerFiles(a.containerId,c),a.uploads[0].then(function(c){e.cache("asset",c.file),b.value="",delete a.uploads},function(){},function(b){a.uploadStatus[0]=b})}})}}}]),angular.module("com.inthetelling.story").directive("ittAssetUploader",ittAssetUploader),ittAssetUploader.$inject=["$timeout","awsSvc","appState","modelSvc"];