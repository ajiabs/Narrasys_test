"use strict";angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{title:"Telling STORY",templateUrl:"templates/root.html"}).when("/auth",{templateUrl:"templates/auth.html",reloadOnSearch:!1}).when("/user",{template:'<div class="standaloneAncillaryPage"><div itt-user></div></div>'}).when("/stories",{title:"Existing narratives",template:'<div class="standaloneAncillaryPage"><div itt-narrative-list></div></div>'}).when("/story",{template:'<div class="standaloneAncillaryPage"><div itt-narrative></div></div>'}).when("/story/:narrativePath",{template:'<div class="standaloneAncillaryPage"><div itt-narrative></div></div>'}).when("/story/:narrativePath/:timelinePath",{template:"<div itt-narrative-timeline></div>",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="narrative"}]}}).when("/episodes",{title:"Available episodes",templateUrl:"templates/producer/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/sxs/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/editor/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/producer/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="producer",a.productLoadedAs="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",controller:"ContainerAssetsTestController",template:'<div class="standaloneAncillaryPage"><div><a class="goUp" href="#episodes">Episodes</a><div sxs-container-assets="containerId"></div></div></div>'}).when("/event/:eventId",{title:"Event test",controller:"EventTestController",templateUrl:"templates/testbed-event.html"}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope","errorSvc",function(a,b){a.$on("$routeChangeSuccess",function(a,c){document.title=c.title?c.title:"Telling STORY",b.init()});var c=!1;$(document).on("keydown",function(b){c||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||(c=!0,27===b.keyCode&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))}),$(document).on("keyup",function(){c=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","errorSvc",function(a,b){return{responseError:function(c){return b.error(c),a.reject(c)}}}])}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/auth.html",'<div itt-login="" style="margin:2em"><a style="animation: delayedFadeIn 5s" href="/#/">Home</a></div>'),a.put("templates/container.html",'<div class="container" ng-class="{\n		isOpen: container.showChildren, \n		isClosed: !container.showChildren,\n		hoverIndicator: depth == 3\n	}" ng-if="container._id"><div class="hoverIndicator"><span ng-if="!container.editingContainer"><a ng-click="toggleChildren()">{{container.name.en}}</a> <span ng-if="depth==3" style="color:#999">({{container.status || Unpublished}})</span> <a style="color:#666" ng-click="container.editingContainer = true">â–¾</a></span> <span ng-if="container.editingContainer"><label>Name:&nbsp;<input ng-model="container.newContainerName" ng-init="container.newContainerName = container.name.en" autofocus>&nbsp;</label><button ng-click="container.editingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerName || container.newContainerName == container.name.en" ng-click="renameContainer()">Save</button></span> <span class="controls"><button class="danger" ng-if="appState.dangerousButtons && !container.children.length && !container.haveNotLoadedChildData" ng-click="deleteEpisodeAndContainer(container._id)">Delete</button> <a ng-href="#/assets/{{container._id}}">[Assets]</a></span></div><div ng-if="container.showChildren"><div ng-if="depth < 3" ng-repeat="child in container.children | orderBy:\'name.en\'" itt-container="containers[child._id]" depth="depth+1"></div><div ng-if="depth == 3" class="container"><a class="button" ng-click="container.showGuestUrl=!container.showGuestUrl"><span ng-if="customer.guest_access_allowed">Guest</span> <span ng-if="!customer.guest_access_allowed">ID</span></a> <a class="button" href="#/episode/{{container.episodes[0]}}">Player</a> <a class="button" ng-if="isDemoServer" href="#/editor/{{container.episodes[0]}}">Editor</a> <a class="button" href="#/producer/{{container.episodes[0]}}">Producer</a><div ng-if="container.showGuestUrl && customer.guest_access_allowed">The guest-accessible url for this episode is<input class="readonly" ng-click="selectText($event)" value="https://{{customer.domains[0]}}.inthetelling.com/#/episode/{{container.episodes[0]}}" readonly></div><div ng-if="container.showGuestUrl && !customer.guest_access_allowed">The ID for this episode is {{container.episodes[0]}}</div></div><div ng-if="!container.addingContainer" class="controls"><button ng-if="depth < 3" ng-click="container.addingContainer = true">Add {{containerTypes[depth+1]}} to {{container.name.en}}</button></div><div ng-if="container.addingContainer" class="controls"><label>Name:&nbsp;<input ng-model="container.newContainerTitle" autofocus>&nbsp;</label><button ng-click="container.addingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button></div></div></div>'),a.put("templates/containerepisodes.html",' <span ng-if="forAdmin"><li ng-if="!container.episodes.length" class="container" ng-class="{isOpen: wasClicked, isClosed: !wasClicked}" ng-click="toggle();loadChildren()" ng-bind-html="container.display_name"></li><li ng-if="container.episodes.length"><span ng-if="container.episodes[0] == episodeId"><b ng-bind-html="containers[container._id].display_name"></b></span> <span class="hoverIndicator" ng-if="container.episodes[0] != episodeId"><a ng-click="selectEpisode()" ng-bind-html="containers[container._id].display_name"></a> ({{container.status}})</span></li><ul class="crossEpisodeNav" ng-class="{isOpen: wasClicked, isClosed: !wasClicked}" ng-if="wasClicked"><li ng-repeat="child in container.children" itt-container-episodes="containers[child._id]" x-for-admin="true"></li></ul></span> <span ng-if="!forAdmin"><li ng-if="!container.episodes.length" ng-bind-html="container.display_name"></li><li ng-if="container.episodes.length && container.status === \'Published\'"><span ng-if="container.episodes[0] == episodeId"><b ng-bind-html="containers[container._id].display_title"></b></span> <span ng-if="container.episodes[0] != episodeId"><a ng-href="/#/{{crossEpisodePath}}/{{container.episodes[0]}}" ng-bind-html="containers[container._id].display_title"></a></span></li><ul class="crossEpisodeNav"><li ng-repeat="child in container.children | orderBy:\'name.en\'" itt-container-episodes="containers[child._id]"></li></ul></span>'),a.put("templates/copyright.html",'TELLING STORY player &#169; <span ng-bind-html="now | date:\'yyyy\'"></span> <a href="https://inthetelling.com">IN THE TELLING</a>. All rights reserved.<br><a href="/privacy.html" target="_new">Privacy</a> <span ng-if="narrative.support_url">- <a ng-href="{{narrative.support_url}}">Support</a></span>'),a.put("templates/episode/columbia.html",'<div class="episode episode-columbia" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/columbia.svg" alt="Columbia University"></div></div>'),a.put("templates/episode/columbiabusiness.html",'<div class="episode episode-columbiabusiness" ng-class="episode.styleCss"><div class="fill trident"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/cbs-logo.svg" alt="Columbia Business School"></div></div>'),a.put("templates/episode/components/discovermode.html",'<div class="discoverMode" ng-if="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene="scene" episode="episode"></div></div>'),a.put("templates/episode/components/reviewmode-scenes.html",'<div class="scene animate transitionFade" ng-class="{navigable: scene.display_title}" ng-repeat="scene in scenes" ng-if="!scene._internal"><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class="sceneTitle" ng-if="scene.display_title" ng-bind-html="scene.display_title"></h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items| reviewMode | orderBy:\'start_time\'" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-all"></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | reviewMode | annotation | orderBy:\'start_time\'" ng-class="item.state" itt-item="item" forcetemplate="review-annotation"></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding"> <div class="item animate" ng-repeat="item in scene.items | reviewMode | transmedia" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-transmedia"></div></div></div></div><div ng-if="isLoading" ng-include="\'templates/loading.html\'"></div>'),a.put("templates/episode/components/reviewmode.html",'<div class="reviewMode" ng-show="appState.viewMode == \'review\'"><div itt-magnet="" id="reviewModeVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div ng-if="appState.viewMode == \'review\'" itt-review-mode="episode.scenes"></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><div class="video contentLayer" itt-video="episode.masterAsset"></div><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<div ng-if="appState.viewMode == \'watch\'" style="padding-bottom: 100%"><div class="watchMode"><div itt-magnet="" id="watchModeVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><span class="watchModeCaptions" ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class="item.state" itt-item="item" forcetemplate="caption"></div></span></div>'),a.put("templates/episode/components/windowfg.html",'<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"><div class="content"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div><a ng-if="!appState.editEvent && appState.timelineState == \'paused\'" class="button-continue" ng-click="continue()"><span>Continue</span></a></div></div>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href="http://www.mindwires.com"><img src="images/customer/eliterate-mindwires.svg" alt="Mindwires logo"></a> <a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/eliterate-logo.svg" alt="E-Literate"></div></div>'),a.put("templates/episode/episode.html",'<div class="episode" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/ewb-logo.svg" alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="George Washington"></div></div>'),a.put("templates/episode/gwlaw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-law.jpg" alt="GW Law"></div></div>'),a.put("templates/episode/gwsb.html",'<div class="episode episode-gwsb" ng-class="episode.styleCss"><div class="fill gwsb-seal"><div class="fill"></div></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="The George Washington University"></div></div>'),a.put("templates/episode/kellogg.html",'<div class="episode episode-kellogg" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><img src="images/customer/kellogg-k.svg"> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"></div></div>'),a.put("templates/episode/middlebury.html",'<div class="episode episode-middlebury" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span class="colorInvert DiscoverModeOnly" ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt-incolor.svg" alt="In The Telling logo"></a> <a class="logo" href="http://middlebury.edu"><img src="images/customer/middlebury-shield.svg" alt="Middlebury logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/middlebury-logo.svg" alt="Middlebury"></div></div>'),a.put("templates/episode/prolotherapy.html",'<div class="episode episode-prolotherapy" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/prolotherapy-text.svg" alt="American Association of Musculoskeletal Medicine"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/purdue-logo.svg" alt="Purdue"></div></div>'),a.put("templates/episode/schoolclimatesolutions.html",'<div class="episode episode-schoolclimatesolutions" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/schoolclimatesolutions.svg" alt="SCS: School Climate Solutions"></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/tellingstory-logo.svg" alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="http://inthetelling.com"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/usc-logo.svg" alt="USC"></div></div>'),a.put("templates/error-404.html",'<div class="errors"><div class="error"><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>'),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class="errors"><div class="error" ng-repeat="error in errorSvc.errors" ng-click="dismiss(error)"><h3>Error: {{error.cause || error.exception.data.error || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if="error.exception.config.url"><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if="user.login_url"><a ng-if="user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}" target="_top">click here</a> <a ng-if="!user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}">click here</a> to log back in.</span> <span ng-if="!user.login_url"><a ng-click="logout();">reset your session</a> and start over.</span></p></div><div class="notification" ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click="dismiss(notification)">[x]</a><p>{{notification.text}}</p></div></span>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div class="text" ng-bind-html="item.display_annotation"></div><div class="clear"></div></div>'),a.put("templates/item/debug.html",'<div class="itemTemplate"><pre ng-if="itemDebug">{{item | pretty}}</pre></div>'),a.put("templates/item/file-withimage.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title"><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div>'),a.put("templates/item/file.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a role="button" tabindex="0" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div></div>'),a.put("templates/item/image-caption-sliding.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption slidingcaption"><div class="title" ng-bind-html="item.display_title"></div><div class="text" ng-bind-html="item.display_description"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/image-caption.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption"><div class="title" ng-bind-html="item.display_title"></div><div class="text" ng-bind-html="item.display_description"></div></div></div><div class="clear"></div></div>'),
a.put("templates/item/image-fill.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate imageFill" style="{{item.backgroundImageStyle}}" ng-style="{\'backgroundImage\':item.asset.cssUrl}"><img class="fillImg" ng-src="{{item.asset.url}}"></div>'),a.put("templates/item/image-inline-withtext.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title" ng-bind-html="item.display_title"></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div ng-bind-html="item.display_description"></div><div class="clear"></div></div></div>'),a.put("templates/item/image-inline.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-linkonly.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div class="text" ng-bind-html="item.display_description"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-plain.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate imagePlain"><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div>'),a.put("templates/item/image-thumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()"><img ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="text"><div class="title" ng-bind-html="item.display_title"></div><div class="text" ng-bind-html="item.display_description"></div></div><div class="clear"></div></div>'),a.put("templates/item/image.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a class="fakeLink" role="button" tabindex="0" ng-click="toggleDetailView()" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" x-ng-if="item.showInlineDetail"><div class="touchable" style="position:relative"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/link-descriptionfirst.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div ng-bind-html="item.display_description"></div><div class="title"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex="0" ng-if="!item.noEmbed" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div></div>'),a.put("templates/item/link-embed.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-bind-html="item.display_title"></div><div ng-bind-html="item.display_description"></div></div><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div><div class="clear"></div></div>'),a.put("templates/item/link-withimage.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title"><a tabindex="0" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div>'),a.put("templates/item/link.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a role="button" tabindex="0" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div></div>'),a.put("templates/item/modal.html",'<div class="modal" ng-click="dismiss();"><div ng-if="item._type == \'Link\'" class="modalmenu"><a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a></div><div ng-if="item._type == \'Link\'" class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div><div class="modalimage" ng-if="item._type == \'Upload\'"><img ng-src="{{item.asset.url}}"></div></div>'),a.put("templates/item/pullquote-noattrib.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote" ng-bind-html="item.display_annotation"></div></div>'),a.put("templates/item/pullquote.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote" ng-bind-html="item.display_annotation"></div><div class="pullquoteSpeaker" ng-bind-html="item.display_annotator"></div></div>'),a.put("templates/item/question-mc-image-left.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title" ng-bind-html="item.display_title"></div><div ng-if="item.asset.url" class="touchable" style="float:left; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/question-mc-image-right.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title" ng-bind-html="item.display_title"></div><div ng-if="item.asset.url" class="touchable" style="float:right; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/question-mc-inner.html",'<div class="question"><p ng-bind-html="plugin.questiontext"></p><div ng-if="!showChart"><div ng-repeat="distractor in choices"><div ng-if="distractor.text != \'\'"><label ng-class="{\n					correct: plugin.hasBeenAnswered && distractor.correct,\n					incorrect: plugin.hasBeenAnswered && !distractor.correct\n				}"><input ng-change="scoreQuiz($index)" type="radio" name="fnord" ng-model="index" ng-disabled="plugin.hasBeenAnswered" value="{{$index}}"><span ng-bind-html="distractor.text"></span></label></div></div><div ng-if="plugin.hasBeenAnswered" ng-bind-html="feedback()"></div></div><div ng-if="showChart"><div ng-if="!plugin.hasBeenAnswered" ng-repeat="distractor in plugin.distractors"><div ng-if="distractor.text != \'\'"><label><input ng-change="scorePoll($index)" type="radio" name="fnord" ng-disabled="plugin.hasBeenAnswered" ng-model="$parent.plugin.selectedDistractor" value="{{$index}}"><span ng-bind-html="distractor.text"></span></label></div></div><br><div ng-if="plugin.hasBeenAnswered"><p ng-if="plugin.selectedDistractor">Here\'s how others answered this question. (Your choice was <b ng-repeat="distractor in plugin.distractors | filter:{ index: plugin.selectedDistractor }" ng-bind-html="distractor.text"></b>.)</p><itt-flotr2-chart type="{{chartType}}" data="{{chartData}}" options="{{chartOptions}}"></itt-flotr2-chart></div></div></div>'),a.put("templates/item/question-mc.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title" ng-if="item.display_title" ng-bind-html="item.display_title"></div><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/review-all.html","<span><div ng-if=\"item._type == 'Annotation'\" ng-include=\"'templates/item/review-annotation.html'\"></div><div ng-if=\"item._type != 'Annotation'\" ng-include=\"'templates/item/review-transmedia.html'\"></div></span>"),a.put("templates/item/review-annotation.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.isTranscript" class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div class="text" ng-bind-html="item.display_annotation"></div></div><div ng-if="!item.isTranscript" ng-include="item.templateUrl"></div><div class="clear"></div></div>'),a.put("templates/item/review-transmedia.html",'<span ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.sxs" ng-include="item.templateUrl"></div><span ng-if="!item.sxs"><span ng-if="item.layouts[0] == \'windowFg\'" ng-include="\'templates/item/review-windowfg.html\'"></span> <span ng-if="item.layouts[0] != \'windowFg\'"><div ng-if="item.data._pluginType" ng-include="item.templateUrl"></div><span ng-if="!item.data._pluginType"><a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" tabindex="0" class="startTime displayTime" aria-label="Seek video to {{item.displayStartTime}}" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed" class="fakeLink escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex="0" role="button" class="fakeLink" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\'" aria-label="Toggle detail display of {{item.display_title}}"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type == \'Link\'"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type != \'Link\'"><div class="touchable" style="position:relative"><img ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div></div></span></span></span><div class="clear"></div></span>'),a.put("templates/item/review-windowfg.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-click="seek(item.start_time)" ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div class="text" ng-if="item.data._plugin._type == \'question\'">You have <span ng-if="!item.data._plugin.hasBeenAnswered">not yet</span> answered this <span ng-if="item.data._plugin.questiontype == \'mc-poll\'">poll</span> question.</div><div class="text" ng-bind-html="item.display_description"></div><div class="clear"></div></div></div>'),a.put("templates/item/searchresults.html",'<div ng-class="{isSxS: item.sxs}"><span class="displayTime"><button class="fakeLink" tabindex="2" ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</button></span> <span class="type" ng-bind-html="(item.display_title || item.display_annotator) | highlightSubstring: searchText"></span><div class="description" ng-bind-html="(item.display_description || item.display_annotation) | highlightSubstring: searchText"></div></div>'),a.put("templates/item/sxs-comment.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div class="text" ng-bind-html="item.annotation.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-file.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><a ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-image.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div><b ng-bind-html="item.title.en"></b><p style="text-align:center"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></p></div><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-link.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><a ng-if="item.noEmbed" class="escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <a ng-if="!item.noEmbed" ng-click="toggleDetailView()" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class="text" ng-bind-html="item.description.en"></div><div class="itemDetail" ng-if="item.showInlineDetail"><a ng-if="!item.noExternalLink" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><div class="iframeContainer"><div ng-include="\'templates/loading.html\'"></div><iframe ng-src="{{item.url}}"></iframe></div></div><div class="clear"></div></div>'),a.put("templates/item/sxs-question.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><itt-mc-question choices="item.data._plugin.distractors" data="item.data._plugin" qid="item._id"></itt-mc-question></div>'),a.put("templates/item/sxs-video.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item._id != \'internal:editing\'">[Edit]</a> <img class="sxs-profile" src="/images/no-avatar.gif"><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div class="text"><div class="title" ng-bind-html="item.display_title"></div><div ng-bind-html="item.display_description"></div></div><div class="iframeContainer" ng-if="item.url"><iframe ng-src="{{item.url}}"></iframe></div><div class="clear"></div></div>'),a.put("templates/item/text-h1.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><h1 ng-bind-html="item.display_annotation"></h1></div>'),a.put("templates/item/text-h2.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><h2 ng-bind-html="item.display_annotation"></h2></div>'),a.put("templates/item/text-transmedia.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><h2 ng-if="item.display_title" ng-bind-html="item.display_title"></h2></div><div class="text" ng-bind-html="item.display_annotation"></div></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="icon" style="float:right; margin-right: 0.5em"><img ng-src="{{item.asset.url}}"></div><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="authorName" ng-bind-html="item.display_annotator"></div><div class="text" ng-bind-html="item.display_annotation"></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="icon" style="float:left; margin-right: 0.5em"><img ng-src="{{item.asset.url}}"><div class="clear"></div></div><div class="authorName" ng-bind-html="item.display_annotator"></div><div class="text" ng-bind-html="item.display_annotation"></div><div class="clear"></div></div>'),a.put("templates/item/transcript.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcript"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator"></div></div><div class="text" ng-bind-html="item.display_annotation"></div><div class="clear"></div></div>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><img style="max-width: 5em; float:left; margin-right: 0.5em" ng-src="{{plugin.credlyImageUrl}}"> <b>{{plugin.achievement}}</b> <span ng-if="plugin.eligibleForBadges"><p>Complete the following requirements to earn a <a ng-href="https://credly.com/recipients/{{plugin.credlyBadgeId}}" target="_new">USC Scholar\'s Badge</a>:</p><div style="clear:both; margin: 1em 1.2em; font-size:90%"><div ng-repeat="req in plugin.requirements"><img ng-if="req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark.png"> <img ng-if="!req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark-empty.png"> <span>{{req.name}}</span></div></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement.</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"><p>Congratulations! You are eligible for a USC Scholarâ€™s Badge. Enter your email address to claim it:</p><input ng-model="plugin.userEmail"><input type="button" value="Go" ng-click="badger()"><span ng-if="plugin.gettingBadge"><small>Getting your badge...</small></span><div ng-if="plugin.error"><small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small></div></div><div ng-if="plugin.gotBadge">Your badge is in the mail. <span ng-if="plugin.alreadyHadBadge">(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div></span> <span ng-if="!plugin.eligibleForBadges"><p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p></span><br><br></div>'),a.put("templates/loading.html",'<div class="loading"><div class="spinner"><div class="rotating pie"></div><div class="filler pie"></div><div class="mask"></div></div>Loading</div>'),a.put("templates/narrative/default.html",'<div><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div ng-if="loading" ng-include="\'templates/loading.html\'"></div><div ng-if="!loading"><div class="narrative"><h2 ng-bind-html="narrative.name.en"></h2><p ng-bind-html="narrative.description.en"></p><div class="storyTimeline" ng-repeat="timeline in narrative.timelines | filter:{hidden:!true} | orderBy:\'sort_order\'"><h3><a href="/#/story/{{narrative.path.en}}/{{timeline.path.en}}">{{timeline.name.en}}</a></h3><p>{{timeline.description.en}}</p>{{timeline.episode_segments[0].end_time | asTime}}</div></div></div><a ng-if="narrative.support_url" ng-href="{{narrative.support_url}}">Support</a></div>'),a.put("templates/narrative/edit.html",'<div class="narrative"><div ng-if="loading" ng-include="\'templates/loading.html\'"></div><div ng-if="!loading"><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-click="stopEditing()">Done editing</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div class="authoringForm"><h2>Narrative</h2><div class="field"><div class="label">Customer</div><div class="input"><select ng-model="narrative.customer_id"><option ng-repeat="customer in customerList" value="{{customer._id}}">{{customer.name}}</option></select></div></div><div class="field"><div class="label">Template</div><div class="input">[TODO]</div></div><div class="field"><div class="label">Name</div><div class="input"><input ng-model="narrative.name.en"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="narrative.description.en"></textarea></div></div><div class="field"><div class="label">Path</div><div class="input"><input ng-model="narrative.path.en"></div></div><div class="field"><div class="label">Support URL</div><div class="input"><input ng-model="narrative.support_url"></div></div><div class="field"><div class="label">Access</div><div class="input"><label><input type="checkbox" ng-model="narrative.guest_access_allowed">Guest access allowed [TODO]</label></div></div><div class="field controls"><button ng-if="narrative._id" ng-click="updateNarrative()"><span ng-if="narrative.saveInProgress">Saving...</span> <span ng-if="!narrative.saveInProgress">Save changes</span></button> <button ng-if="!narrative._id" ng-click="createNarrative()">Create narrative</button></div><h3>Timelines</h3><div class="storyTimeline" ng-repeat="timeline in narrative.timelines"><div class="field"><div class="label">Sort order</div><div class="input"><input ng-model="timeline.sort_order"></div></div><div class="field"><div class="label">Timeline name</div><div class="input"><input ng-model="timeline.name.en"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="timeline.description.en"></textarea></div></div><div class="field"><div class="label">Path</div><div class="input"><input ng-model="timeline.path.en"></div></div><div class="field"><div class="label">Access</div><div class="input"><label><input type="checkbox" ng-model="timeline.hidden">Hidden from users</label></div></div><div class="field controls"><button ng-click="saveTimeline(timeline)"><span ng-if="timeline.saveInProgress">Saving...</span> <span ng-if="!timeline.saveInProgress">Save timeline</span></button></div></div><div style="padding: 0.5em"><button ng-if="narrative._id && !isAddingTimeline" ng-click="toggleEpisodeList()"><span ng-if="showEpisodeList">Cancel</span> <span ng-if="!showEpisodeList">Add timeline</span></button></div><div itt-episode-list="" class="admin episodePicker" ng-if="showEpisodeList">Choose an episode:<ul ng-repeat="child in root.children" x-for-admin="true" itt-container-episodes="containers[child._id]" depth="0"></ul></div></div></div></div>'),
a.put("templates/narrativelist.html",'<div><div class="ancillaryNav"><a class="button" ng-if="user._id" href="/#/user">Home</a> <a class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div ng-if="userHasRole(\'admin\')"><div ng-repeat="narrative in narratives"><a href="/#/story/{{narrative.path.en}}">{{narrative.name.en}}</a></div><span ng-if="showAddNarrative"><hr><a href="/#/story/?admin">Create new narrative</a></span></div></div>'),a.put("templates/player-timeline.html",'<span><div ng-if="showPlayer" ng-controller="PlayerController" ng-include="\'templates/player.html\'"></div></span>'),a.put("templates/player.html","<div class=\"player\" ng-class=\"{\n	isTouchDevice: appState.isTouchDevice,\n	isFramed: appState.isFramed,\n	isProducer: (appState.product == 'producer'),\n	isSxS: (appState.product == 'sxs'),\n	canEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == 'producer' || appState.product == 'sxs')\n"+'	}"><div class="toolbar"><div ng-if="appState.productLoadedAs == \'narrative\'" class="buttongroup"><a class="button button-exitEpisode" href="/#/story/{{narrative.path.en}}"><span>Exit</span></a></div><div class="modegroup buttongroup"><nav role="navigation"><button tabindex="0" class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')" aria-label="Watch"><span>Watch</span></button> <span ng-switch="appState.product != \'producer\' || appState.viewMode != \'discover\' || appState.time == 0"><button ng-switch-when="true" tabindex="0" class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')" aria-label="Discover"><span>Discover</span></button> <span ng-switch-when="false" class="producerEditLayers" ng-class="{\n				bg: appState.producerEditLayer < 0,\n				fg: appState.producerEditLayer > 0\n			}"><a ng-click="changeProducerEditLayer(-1)" class="button">&nbsp;&nbsp; <span>Discover</span></a> <a ng-click="changeProducerEditLayer(+1)" class="button">&nbsp;&nbsp; <span>Discover</span></a></span> <button tabindex="0" class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')" aria-label="Review"><span>Review</span></button></span></nav></div><div ng-if="appState.isFramed" class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-click="pause()" ng-href="{{apiDataBaseUrl}}/v1/new_window/{{appState.episodeId}}?access_token={{appState.user.access_token}}&t={{appState.time}}" target="_new"><span>New window</span></a></div><div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><button tabindex="2" class="button button-search" ng-click="toggleSearchPanel()" aria-label="Search" aria-expanded="{{show.searchPanel}}"><span>Search</span></button><label for="searchtext" class="hidden">Search Text</label><input tabindex="2" name="searchtext" id="searchtext" ng-show="show.searchPanel" ng-model="searchText"></div><div class="profilegroup buttongroup" ng-if="appState.narrativeId || appState.product == \'sxs\' || userHasRole(\'admin\')"><a class="button button-preview" ng-if="appState.productLoadedAs==\'producer\' && userHasRole(\'admin\')" ng-click="toggleProducerPreview()"><span ng-if="appState.product == \'producer\'">Preview</span> <span ng-if="appState.product == \'player\'">Edit</span></a> <a class="button button-profile" ng-click="appState.show.profilePanel = true"><span>Profile</span></a></div></div><div ng-if="loading" ng-include="\'templates/loading.html\'"></div><div ng-show="!loading" itt-episode="" ng-class="{\n		padForEditing: appState.editEvent || appState.editEpisode,\n		showBackgroundOnly: appState.producerEditLayer < 0,\n		showForegroundOnly: appState.producerEditLayer > 0,\n	}"></div><div class="toolbar-bottom" itt-show-hide-visual-only="appState.videoControlsActive" ng-mouseenter="showControls();" ng-click="showControls();" ng-mouseleave="allowControlsExit()"><div class="toolbar-bottom-fill"><div ng-show="show.navPanel" class="navPanel" ng-class="episode.styleCss"><div class="parent" ng-repeat="parent in episode.parents" ng-bind-html="parent.display_name"></div><div class="scene" x-ng-if="scene.display_title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)"><span class="displayTime">{{scene.displayStartTime}}</span><p><button class="fakeLink" tabindex="0" ng-bind-html="scene.display_title" x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus="showControls()"></button><br><span ng-bind-html="scene.display_description"></span></p></div><div class="crossEpisode"><a class="prevEpisode" ng-if="episode.previousEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.previousEpisodeContainer.episodes[0]}}" title="{{episode.previousEpisodeContainer.display_name}}">Previous episode</a> <a class="nextEpisode" ng-if="episode.nextEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}}" title="{{episode.nextEpisodeContainer.display_name}}">Next Episode</a></div></div><div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"><div ng-if="appState.editEvent" itt-item-editor="appState.editEvent"></div><div ng-if="appState.editEpisode" itt-episode-editor="appState.editEpisode"></div></div><div itt-timeline=""></div></div></div><div class="toolbar-bottom-controltrigger" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()"></div></div><div class="animate transitionFade" ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()" sxs-add-content=""></div><div class="autoscroll" ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click="enableAutoscroll()"><img src="/images/autoscroll.svg" width="32" height="32"></div><div ng-show="show.navPanel || show.searchPanel || show.helpPanel || show.profilePanel" class="modal-backdrop" ng-click="hidePanels()"></div><div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div><div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div><div ng-show="show.searchPanel" class="searchPanel"><div ng-if="show.searchPanel" itt-search-panel="">This will be the search panel</div></div><div ng-if="show.helpPanel" class="helpPanel"><div class="arrow-up"></div><p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p><ul><li class="video"><h3>Watch</h3><p>Just the video, no frills.</p></li><li class="directed"><h3>Discover</h3><p>The guided, synchronized view of the video and related content.</p></li><li class="explore"><h3>Review</h3><p>Read the full transcript and all the related transmedia in one convenient list.</p></li></ul><a class="goAway" x-ng-click="noMoreHelp()" href="javascript:void 1;">Don\'t show this again</a></div><div ng-if="show.profilePanel" class="profilePanel"><div class="arrow-up"></div><div itt-user="" x-in-player="true"></div></div>'),a.put("templates/producer/addcontent.html",'<div ng-show="!appState.editEvent && !appState.editEpisode" class="controlPanel" ng-class="{\n	isProducer: appState.product == \'producer\',\n	isSxS: appState.product == \'sxs\'\n}"><div ng-if="appState.product == \'producer\'" class="editButtonPanel"><a class="button button-episode" ng-click="editEpisode()">Edit episode</a> <a class="button button-scene" ng-if="appState.time > 0  && appState.time < (appState.duration - 0.1) && appState.viewMode == \'discover\'" ng-click="editCurrentScene()">Edit scene</a></div><div class="producer addButtonPanel" ng-show="!item && appState.time > 0 && appState.time < (appState.duration - 0.1) "><span ng-if="expanded" style="padding: 0 1em" class="animate transitionExpandW"><span ng-if="appState.product == \'sxs\'"><a class="button button-comment" ng-click="addEvent(\'comment\')">Comment</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">File</a> <a class="button button-video" ng-click="addEvent(\'video\')">Video</a></span> <span ng-if="appState.product == \'producer\'"><a class="button button-scene" ng-click="addEvent(\'scene\')">Add Scene</a> <a class="button button-comment" ng-click="addEvent(\'transcript\')">Transcript</a> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Annotation</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">Upload</a> </span></span> <span ng-if="!expanded"><a class="button button-add" ng-click="expand()">Add</a></span></div></div>'),a.put("templates/producer/annotator-autocomplete.html",'<div style="position:relative" ng-show="!hasAnnotator()"><input class="annotatorChooser" ng-model="searchText" ng-focus="showAutocomplete()" ng-blur="hideAutocomplete()" ng-change="handleAutocomplete()"><div class="autocompleteList animate transitionFade" ng-if="autoCompleting"><div class="autocompleteItem" ng-repeat="annotator in filteredAnnotators | orderBy:\'name\'" ng-click="select(annotator)" ng-class="{selected: ($index == preselectedItem)}" style="white-space: nowrap"><img ng-src="{{annotator.imageUrl}}"> <span ng-bind-html="(annotator.key | highlightSubstring: searchText) || \'(New speaker)\'"></span></div></div></div><div style="position:relative" ng-show="hasAnnotator()"><div sxs-input-i18n="item.annotator" x-inputtype="\'input\'"></div><a style="position: absolute; top: 3px; right: 10px" ng-click="item.annotator={}">(x)</a></div>'),a.put("templates/producer/container-assets.html",'<div ng-if="showParent"><div sxs-container-assets="container.parent_id"></div></div><div class="containerAssets"><div ng-if="appState.product != \'sxs\' && container.parent_id && !showParent"><a class="goUp" ng-click="up()">Parent container</a></div><div class="title">{{container.display_name}}</div><div class="controls"><a ng-click="toggleImages()"><span ng-if="onlyImages">Images</span> <span ng-if="!onlyImages">All</span></a> &nbsp; <a ng-click="toggleGrid()"><span ng-if="gridView">â–¦</span> <span ng-if="!gridView">â˜°</span></a></div><div class="scrollPane" ng-if="!hideItems"><div ng-if="gridView"><div class="grid" ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div><div ng-if="asset._type != \'Asset::Image\'"><div class="thumbnail">(video)</div></div>{{asset.display_name}}</div></div><table ng-if="!gridView"><tr ng-repeat="asset in assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><td><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div></td><td>{{asset.size |asBytes}}</td><td>{{asset.content_type}}</td><td>{{asset.display_name}}</td></tr></table></div><div ng-if="appState.product != \'sxs\'"><span ng-if="uploads"><div ng-repeat="upload in uploads"><progress ng-attr-max="{{uploadStatus[$index].bytesTotal}}" ng-attr-value="{{uploadStatus[$index].bytesSent}}"></progress></div></span><div ng-if="!uploads" class="field"><div class="label">Upload</div><div class="input"><input type="file" onchange="angular.element(this).scope().uploadAsset(this)"></div></div></div></div>'),a.put("templates/producer/episode.html",'<div class="itemEdit authoringForm"><div><div class="ittTabs" itt-tabs=""><select ng-if="episode.languages.length > 1" size="1" ng-model="appState.lang" ng-change="forcePreview()" style="float:right; padding-right: 24px" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select><div class="ittTab" itt-tab="tabs[0]" x-tabindex="0" x-tablabel="Episode"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Public URL</div><div class="input"><input ng-click="selectText($event)" value="https://{{customer.domains[0]}}.inthetelling.com/#/episode/{{episode._id}}" readonly></div></div><div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" ng-model-options="{ debounce: 500 }" sxs-input-i18n="episode.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" ng-model-options="{ debounce: 50 }" sxs-input-i18n="episode.description" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="label">Status</div><div class="input"><select size="1" ng-model="episode.status"><option value="Published">Published</option><option value="Unpublished">Unpublished</option></select></div></div><div class="field"><div class="label">Languages</div><div class="input"><label><input type="checkbox" ng-model="langForm.en">English</label><label><input type="checkbox" ng-model="langForm.es">Spanish</label><label><input type="checkbox" ng-model="langForm.zh">Chinese</label><label><input type="checkbox" ng-model="langForm.pt">Portuguese</label><label><input type="checkbox" ng-model="langForm.fr">French</label><label><input type="checkbox" ng-model="langForm.de">German</label><label><input type="checkbox" ng-model="langForm.it">Italian</label></div></div><div class="field" ng-if="languageCount>1"><div class="label">Default language</div><div class="input"><select size="1" ng-model="episode.defaultLanguage"><option ng-disabled="!langForm.en" value="en">English</option><option ng-disabled="!langForm.es" value="es">Spanish</option><option ng-disabled="!langForm.zh" value="zh">Chinese</option><option ng-disabled="!langForm.pt" value="pt">Portuguese</option><option ng-disabled="!langForm.fr" value="fr">French</option><option ng-disabled="!langForm.de" value="pt">German</option><option ng-disabled="!langForm.it" value="it">Italian</option></select></div></div><div class="field" style="display:none"><div class="label">Inter-episode navigation</div><div class="input"><select ng-model="episode.navigation_depth"><option value="0">None</option><option value="1">Include links to published episodes in the same container</option></select></div></div></div></div><div class="ittTab" itt-tab="tabs[1]" x-tabindex="1" x-tablabel="Master Asset"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Master asset type</div><div class="input"><select size="1" ng-model="masterAssetType" ng-init="masterAssetType=\'Video\'"><option value="Video">Native Video</option><option value="Youtube">Youtube</option><option value="Audio">Audio (TODO)</option><option value="Images">Image sequence (TODO)</option><option value="None">No master asset (TODO)</option></select></div></div><div class="field" ng-if="masterAssetType == \'Video\'"><div class="label">Video</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field" ng-if="masterAssetType == \'Youtube\'"><div class="label">Youtube URL</div><div class="input"><input ng-model="masterAsset.you_tube_url" style="width: 78%"><button ng-click="attachYouTube(masterAsset.you_tube_url)">Attach</button></div></div><div class="field" ng-if="masterAssetType == \'Images\' || masterAssetType == \'None\'"><div class="label">Duration</div><input name="start" ng-model="episode.duration" ng-minlength="1" ng-maxlength="5"></div></div></div><div class="ittTab" itt-tab="tabs[2]" x-tabindex="2" x-tablabel="Style"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Template</div><div class="input"><select ng-model="episode.templateUrl"><option value="templates/episode/story.html">(Default)</option><option value="templates/episode/episode.html">(Unbranded)</option><option value="templates/episode/columbia.html">Columbia University</option><option value="templates/episode/columbiabusiness.html">Columbia Business School</option><option value="templates/episode/eliterate.html">e-Literate TV</option><option value="templates/episode/ewb.html">Engineers Without Borders</option><option value="templates/episode/gw.html">George Washington</option><option value="templates/episode/gwlaw.html">George Washington Law</option><option value="templates/episode/gwsb.html">George Washington Fed MOOC</option><option value="templates/episode/kellogg.html">Kellogg</option><option value="templates/episode/purdue.html">Purdue</option><option value="templates/episode/schoolclimatesolutions.html">School Climate Solutions</option><option value="templates/episode/usc.html">University of Southern California</option><option value="templates/episode/middlebury.html">Middlebury</option></select></div></div><div class="field"><div class="label">Typography</div><div class="input"><select size="1" ng-model="itemForm.typography"><option value="">(Default)</option><option value="Sans">Sans</option><option value="Serif">Serif</option><option value="Book">Book</option><option value="Swiss">Swiss</option></select></div></div><div class="field"><div class="label">Color</div><div class="input"><select size="1" ng-model="itemForm.color"><option value="">(Default)</option><option value="Invert">Invert</option><option value="Sepia">Sepia</option><option value="Solarized">Solarized</option><option value="Vivid">Vivid</option></select></div></div><div class="field"><div class="label">Timestamp</div><div class="input"><select size="1" ng-model="itemForm.timestamp"><option value="">(Default)</option><option value="None">No timestamp</option><option value="Inline">Inline timestamp</option></select></div></div><div class="field"><div class="label">Highlight</div><div class="input"><select size="1" ng-model="itemForm.highlight"><option value="">(Default)</option><option value="Solid">Solid</option><option value="Border">Border</option><option value="Side">Side</option><option value="Bloom">Bloom</option><option value="Highlighter">Highlighter</option><option value="Tilt">Tilt</option></select></div></div><div class="field"><div class="label">Transition</div><div class="input"><select size="1" ng-model="itemForm.transition"><option value="">(Default)</option><option value="None">No transition</option><option value="Fade">Fade</option><option value="SlideL">Slide left</option><option value="SlideR">Slide right</option><option value="ExpandW">Expand</option><option value="Pop">Pop</option></select></div></div></div></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-click="saveEpisode()">Save</button></div></div>'),a.put("templates/producer/episodelist.html",'<div class="standaloneAncillaryPage"><div itt-episode-list=""><div ng-if="userHasRole(\'admin\')"><div class="ancillaryNav"><a class="button" href="/#/">Home</a> <a class="button" ng-click="logout()">Log out</a></div><div ng-if="loading" ng-include="\'templates/loading.html\'"></div><div ng-repeat="child in root.children | orderBy:\'name.en\'" itt-container="containers[child._id]" depth="0"></div><div class="container"><div class="controls"><button disabled>TODO add customer</button></div></div><div ng-if="!userHasRole(\'admin\') || (!loading && (failedLogin || root.children.length == 0))">Looks like you aren\'t logged in as an admin -- <a ng-click="logout();">try again</a>.</div></div></div></div>'),a.put("templates/producer/inputi18n.html",'<input ng-if="inputtype==\'input\'" ng-model="field[appState.lang]"><textarea rows="4" ng-if="inputtype==\'textarea\'" ng-model="field[appState.lang]"></textarea>'),a.put("templates/producer/inputtime.html",'<span class="floaterContainer"><input class="inputfield" ng-model="model" ng-focus="showTools(true)" ng-blur="showTools(false)" ng-model-options="{ updateOn: \'blur\' }" style="max-width: 150px" ng-class="{invalid: (fieldname == \'end_time\' && item.invalid_end_time)}"><div class="floater" ng-if="tooltip"><ul style="list-style:none; white-space:nowrap"><li style="text-align:center; font-size: 150%"><a ng-click="nudge(-5)">Â«</a> <a ng-click="nudge(-1)">â€¹</a> <span>&nbsp;&nbsp;</span> <a ng-click="nudge(1)">â€º</a> <a ng-click="nudge(5)">Â»</a></li><li ng-click="setTime(appState.time)"><a>Set to current time ({{format(appState.time)}})</a></li><span ng-if="item._type != \'Scene\' && scene().start_time > 0"><li ng-if="fieldname==\'start_time\'" ng-click="setTime(scene().start_time)"><a>Beginning of scene ({{format(scene().start_time)}})</a></li><li ng-if="fieldname==\'end_time\'" ng-click="setTime(scene().end_time)"><a>End of scene ({{format(scene().end_time)}})</a></li><li ng-if="fieldname==\'end_time\' && isTranscript()" ng-click="TODO"><a>Auto (TODO)</a></li></span></ul></div></span>'),a.put("templates/producer/item.html",'<div class="itemEdit authoringForm"><div><div ng-if="appState.product == \'sxs\'" class="authoringFormScrollContainer"><div class="field"><div class="label">Time</div><div class="input"><span sxs-input-time="item" x-input-field="start_time"></span></div></div><div ng-include="itemEditor"></div></div><div ng-if="appState.product == \'producer\'"><div class="ittTabs" itt-tabs=""><select style="float:right; padding-right: 24px" ng-if="languages.length > 1" size="1" ng-model="appState.lang" ng-change="forcePreview()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in languages"></select><div class="ittTab" itt-tab="tabs[0]" x-tabindex="0" x-tablabel="{{item._type === \'Scene\' ? \'Scene\' : \'Item\'}}"><div class="authoringFormScrollContainer"><div class="field" ng-if="!(item._type===\'Scene\' && item.start_time <= 0.1)"><div class="label">Time</div><div class="input"><span sxs-input-time="item" x-input-field="start_time"></span> <span ng-if="!(item.stop || item._type === \'Scene\')"><span class="label">&nbsp; &nbsp; &nbsp; End</span> <span sxs-input-time="item" x-input-field="end_time"></span></span></div></div><div ng-include="itemEditor"></div></div></div><div class="ittTab" itt-tab="tabs[1]" x-tabindex="1" x-tablabel="Style"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Template</div><div class="input"><span ng-if="item.producerItemType == \'scene\'"><select ng-model="item.templateUrl"><option value="templates/scene/centered.html">Centered video</option><option value="templates/scene/1col.html">One column</option><option value="templates/scene/2colL.html">Two columns</option><option value="templates/scene/2colR.html">Two columns (mirrored)</option><option value="templates/scene/cornerH.html">Corner video, horizontal</option><option value="templates/scene/cornerV.html">Corner video, vertical</option><option value="templates/scene/pip.html">Picture-in-picture</option></select><select ng-model="item.layouts[0]" ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="" ng-if="item.templateUrl != \'templates/scene/cornerH.html\' && item.templateUrl != \'templates/scene/cornerV.html\' && item.templateUrl != \'templates/scene/pip.html\'">Centered</option><option value="videoLeft">Video on left</option><option value="videoRight">Video on right</option></select></span><select ng-if="item.producerItemType == \'transcript\'" ng-model="item.templateUrl"><option value="templates/item/transcript.html">Transcript</option><option value="templates/item/transcript-withthumbnail.html">Transcript with thumbnail</option><option value="templates/item/transcript-withthumbnail-alt.html">Transcript with thumbnail B</option></select><select ng-if="item.producerItemType == \'annotation\'" ng-model="item.templateUrl"><option value="templates/item/pullquote.html">Pullquote with attribution</option><option value="templates/item/pullquote-noattrib.html">Pullquote</option><option value="templates/item/text-h1.html">Header 1</option><option value="templates/item/text-h2.html">Header 2</option><option value="templates/item/text-transmedia.html">Long text (as transmedia)</option></select><select ng-if="item.producerItemType == \'link\'" ng-model="item.templateUrl"><option value="templates/item/link.html">Link</option><option value="templates/item/link-withimage.html">Link with image</option><option value="templates/item/link-descriptionfirst.html">Link: description first</option><option value="templates/item/link-embed.html">Embedded link</option></select><select ng-if="item.producerItemType == \'image\'" ng-model="item.templateUrl"><option value="templates/item/image-fill.html">Overlay or background fill</option><option value="templates/item/image.html">Linked image</option><option value="templates/item/image-inline.html">Inline image</option><option value="templates/item/image-inline-withtext.html">Inline image with text</option><option value="templates/item/image-caption.html">Image with caption</option><option value="templates/item/image-caption-sliding.html">Image with sliding caption</option><option value="templates/item/image-thumbnail.html">Image thumbnail</option><option value="templates/item/image-plain.html">Plain image</option></select><select ng-if="item.producerItemType == \'file\'" ng-model="item.templateUrl"><option value="templates/item/file.html">Linked file (TODO: force noembed?)</option><option value="templates/item/file-withimage.html">Linked file with image</option></select><select ng-if="item.producerItemType == \'question\'" ng-model="item.templateUrl"><option value="templates/item/question-mc.html">Default question display</option><option value="templates/item/question-mc-image-right.html">Question with image right</option><option value="templates/item/question-mc-image-left.html">Question with image left</option></select></div></div><div class="field"><div class="label">Layout</div><div class="input"><span ng-if="item._type === \'Scene\'"><select ng-model="item.layouts[1]" ng-if="item.templateUrl !=\'templates/scene/centered.html\'"><option value="">Show all content items, highlight current ones</option><option value="showCurrent">Show only current items</option></select></span> <span ng-if="item._type !== \'Scene\'"><span ng-if="item.templateUrl == \'templates/item/image-fill.html\'"><select size="1" ng-model="item.layouts[0]"><option value="windowBg">Window background</option><option value="mainBg">Main content pane background</option><option value="altBg">Secondary content pane background</option><option value="mainFg">Main content pane foreground</option><option value="altFg">Secondary content pane foreground</option><option value="videoOverlay">Video overlay</option></select><select size="1" ng-model="itemForm.position"><option value="">Fit</option><option value="center">Center</option><option value="cover">Cover</option><option value="contain">Contain</option><option value="fill">Fill and stretch</option></select><select size="1" ng-model="itemForm.pin" ng-if="itemForm.position != \'center\' && itemForm.position != \'fill\'"><option value="tl">Top left</option><option value="tr">Top right</option><option value="bl">Bottom left</option><option value="br">Bottom right</option></select></span><select ng-if="item.templateUrl != \'templates/item/image-fill.html\'" size="1" ng-model="item.layouts[0]"><option value="windowFg">Modal</option><option value="inline">Inline</option><option value="sidebarL">Sidebar: left</option><option value="sidebarR">Sidebar: right</option><option value="burstL">Burst left margin</option><option value="burstR">Burst right margin</option><option value="burst">Burst both margins</option></select></span></div></div><div class="field" ng-if="item.producerItemType != \'scene\'"><div class="label">Flags</div><div class="input"><label><input type="checkbox" ng-model="item.required">Required</label><label><input type="checkbox" ng-model="item.stop">Stop item</label><label><input type="checkbox" ng-model="item.cosmetic">Cosmetic</label></div></div></div></div><div class="ittTab" itt-tab="tabs[2]" x-tabindex="2" x-tablabel="Customize"><div class="authoringFormScrollContainer"><div class="field"><div class="label">Typography</div><div class="input"><select size="1" ng-model="itemForm.typography"><option value="">(Default)</option><option value="Sans">Sans</option><option value="Serif">Serif</option><option value="Book">Book</option><option value="Swiss">Swiss</option></select></div></div><div class="field"><div class="label">Color</div><div class="input"><select size="1" ng-model="itemForm.color"><option value="">(Default)</option><option value="Invert">Invert</option><option value="Sepia">Sepia</option><option value="Solarized">Solarized</option><option value="Vivid">Vivid</option></select></div></div><div class="field"><div class="label">Timestamp</div><div class="input"><select size="1" ng-model="itemForm.timestamp"><option value="">(Default)</option><option value="None">No timestamp</option><option value="Inline">Inline timestamp</option></select></div></div><div class="field"><div class="label">Highlight</div><div class="input"><select size="1" ng-model="itemForm.highlight"><option value="">(Default)</option><option value="Solid">Solid</option><option value="Border">Border</option><option value="Side">Side</option><option value="Bloom">Bloom</option><option value="Highlighter">Highlighter</option><option value="Tilt">Tilt</option></select></div></div><div class="field"><div class="label">Transition</div><div class="input"><select size="1" ng-model="itemForm.transition"><option value="">(Default)</option><option value="None">No transition</option><option value="Fade">Fade</option><option value="SlideL">Slide left</option><option value="SlideR">Slide right</option><option value="ExpandW">Expand</option><option value="Pop">Pop</option></select></div></div></div></div></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-if="item._id != \'internal:editing\'" ng-click="deleteEvent(item._id)">Delete</button> <button ng-click="saveEvent()">Save</button></div></div>'),a.put("templates/producer/item/producer-annotation.html",'<div class="field"><div class="label">Speaker [{{appState.lang}}]</div><div class="input"><div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div></div></div><div class="field"><div class="label">Speaker thumbnail</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Annotation [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.annotation" x-inputtype="\'textarea\'" autofocus></div></div>'),a.put("templates/producer/item/producer-file.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">File</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-image.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),
a.put("templates/producer/item/producer-link.html",'<div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">URL</div><div class="input"><input ng-model="item.url"></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-question.html",'<div class="field"><div class="label">Question type</div><div class="input"><select ng-model="item.data._plugin.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></div></div><div class="field"><div class="label">Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Question text</div><div class="input"><textarea ng-model="item.data._plugin.questiontext" rows="4"></textarea></div></div><div class="field"><div class="label">Image (optional)</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class="label">{{$index | alpha}} &nbsp;<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class="input"><textarea ng-model="distractor.text" rows="4"></textarea></div></div><div class="field"><div class="input"><button ng-click="addDistractor($event)">Add distractor</button></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when correct</div><div class="input"><textarea rows="4" ng-model="item.data._plugin.correctfeedback"></textarea></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when incorrect</div><div class="input"><textarea rows="4" ng-model="item.data._plugin.incorrectfeedback"></textarea></div></div>'),a.put("templates/producer/item/producer-scene.html",'<div class="field"><div class="label">Scene Title [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.title" x-inputtype="\'input\'" autofocus></div></div><div class="field"><div class="label">Description [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/producer-transcript.html",'<div class="field"><div class="label">Speaker [{{appState.lang}}]</div><div class="input"><div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div></div></div><div class="field"><div class="label">Speaker thumbnail</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Transcript [{{appState.lang}}]</div><div class="input" sxs-input-i18n="item.annotation" x-inputtype="\'textarea\'" autofocus></div></div>'),a.put("templates/producer/item/sxs-comment.html",'<span class="eventIcon icon-comment"></span><div class="field"><div class="label">Comment</div><div class="input"><textarea ng-model="item.annotation.en" rows="4" autofocus></textarea></div></div>'),a.put("templates/producer/item/sxs-file.html",'<span class="eventIcon icon-file"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">File</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="item.description.en" rows="4"></textarea></div></div>'),a.put("templates/producer/item/sxs-image.html",'<span class="eventIcon icon-image"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="item.description.en" rows="4"></textarea></div></div>'),a.put("templates/producer/item/sxs-link.html",'<span class="eventIcon icon-link"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">URL</div><div class="input"><input ng-model="item.url"></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="item.description.en" rows="4"></textarea></div></div>'),a.put("templates/producer/item/sxs-question.html",'<span class="eventIcon icon-question"></span><div class="field"><div class="label">Question type</div><div class="input"><select ng-model="item.data._plugin.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></div></div><div class="field"><div class="label">Question text</div><div class="input"><textarea ng-model="item.data._plugin.questiontext" rows="4" autofocus></textarea></div></div><div class="field"><div class="label">Question Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image (optional)</div><div class="input" ng-include="\'templates/producer/upload-single.html\'"></div></div><div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class="label">{{$index | alpha}} &nbsp;<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class="input"><textarea ng-model="distractor.text" rows="4"></textarea></div></div><div class="field"><div class="input"><button ng-click="addDistractor($event)">Add distractor</button></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when correct</div><div class="input"><textarea rows="4" ng-model="item.data._plugin.correctfeedback"></textarea></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when incorrect</div><div class="input"><textarea rows="4" ng-model="item.data._plugin.incorrectfeedback"></textarea></div></div>'),a.put("templates/producer/item/sxs-video.html",'<span class="eventIcon icon-video"></span><div class="field"><small><div style="width:20%; display:inline-block"></div><div style="width:48%; display:inline-block">Link to a video on YouTube...</div><div style="width:32%; display:inline-block">...or make your own</div></small></div><div class="field"><div class="label">Video</div><div class="input"><div style="width:60%; display:inline-block; padding-right: 5%"><input ng-model="item.yturl"></div><div style="width:40%; display:inline-block"><input type="button" value="Upload" style="width: 48%; margin-right: 4%"></div></div></div><div class="field" ng-if="item.url || item.yturl"><div class="label">YouTube url</div><div class="input"><small ng-if="item.url">{{item.url}}</small> <small ng-if="item.yturl && !item.url">(No valid YouTube video found)</small></div></div><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Description</div><div class="input"><textarea ng-model="item.description.en" rows="4"></textarea></div></div>'),a.put("templates/producer/questionauthoring.html",'<div style="margin:1em"><p>This is a standalone editor for question items. Fill in the fields below, then copy the JSON data below into the existing authoring tool. To edit an existing question paste its JSON into the json field and the editor will separate it out into editable fields.</p><table class="authoringForm"><tr><td class="label">Question type</td><td><select ng-model="question.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></td></tr><tr><td class="label">Question text</td><td><textarea rows="4" ng-model="question.questiontext">\n				</textarea></td></tr><tr><td colspan="2">Answer choices. <span ng-if="question.questiontype == \'mc-formative\'">Check the correct answer (if more than one is selected, either will count as correct).</span>To remove an answer choice, just leave it blank.</td></tr><tr ng-repeat="distractor in question.distractors"><td class="label"><input type="checkbox" ng-model="distractor.correct" ng-if="question.questiontype == \'mc-formative\'"></td><td><input ng-model="distractor.text"></td></tr><tr><td class="label"><a ng-click="addDistractor()">add another</a></td><td></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for correct answer</td><td><input ng-model="question.correctfeedback"></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for incorrect answer</td><td><input ng-model="question.incorrectfeedback"></td></tr><tr><td colspan="2"><br><hr><br></td></tr><tr><td class="label">JSON data: <span ng-if="editwarning">Invalid JSON!</span></td><td><textarea rows="10" ng-model="pluginjson"></textarea></td></tr></table><br><hr><br><p class="label">Question preview:</p><div class="item"><div ng-if="preview" itt-item="questionpreview"></div></div></div>'),a.put("templates/producer/upload-single-episode.html",""),a.put("templates/producer/upload-single.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><span ng-if="uploads"><div ng-repeat="upload in uploads"><progress ng-attr-max="{{uploadStatus[$index].bytesTotal}}" ng-attr-value="{{uploadStatus[$index].bytesSent}}"></progress></div></span> <span ng-if="!uploads"><span ng-if="(item.asset || masterAsset.original_filename)">{{item.asset.original_filename || masterAsset.original_filename}} <button ng-if="appState.product == \'sxs\'" ng-click="deleteAsset(item.asset._id)">Delete</button> <button ng-if="appState.product == \'producer\'" ng-click="detachAsset(item.asset._id)">Detach</button></span> <span ng-if="!(item.asset || masterAsset.original_filename)"><button ng-if="!showUpload" ng-click="chooseAsset()">Select</button> <button ng-if="!showUpload" ng-click="toggleUpload()">Upload</button><input ng-if="showUpload" type="file" onchange="angular.element(this).scope().uploadAsset(this.files)"></span></span></div>'),a.put("templates/producer/upload.html",'<div ng-controller="UploadController" style="margin:1em"><div ng-if="loading" class="loading"><div class="spinner"><div class="rotating pie"></div><div class="filler pie"></div><div class="mask"></div></div>Loading</div><h2>Bucket Listing</h2><div ng-repeat="bucket_object in bucket_objects">{{bucket_object.Key}} <button ng-click="deleteObject(bucket_object)">Delete</button><br></div><h2>Uploads in progress</h2><ul><div ng-repeat="upload_in_progress in uploads_in_progress.Uploads"><li>{{upload_in_progress.Key}} <button ng-click="cancelMultipartUpload(upload_in_progress)">Cancel</button><ul><div ng-repeat="part in upload_parts[$index].Parts"><li>{{part}}</li></div></ul></li></div></ul><input type="file" id="file" name="file" multiple><button ng-click="uploadFiles()">Upload</button><div ng-repeat="upload in uploads"><div><progress ng-attr-max="{{upload_status[$index].bytesTotal}}" ng-attr-value="{{upload_status[$index].bytesSent}}"></div><button ng-click="pauseUpload()">Pause</button> <button ng-click="resumeUpload()">Resume</button> <button ng-click="cancelUpload()">Cancel</button> <button ng-click="networkError()">Network Error</button></div></div>'),a.put("templates/root.html",'<div class="rootLogin standaloneAncillaryPage" itt-login=""><div class="inner"><div ng-if="appState.user._id"><div itt-user=""></div></div><div ng-if="!appState.user._id"><div><a class="bigredbutton" href="{{apiDataBaseUrl}}/oauth2">Begin</a></div><div ng-click="showAdminLogin=1;" style="margin-top: 1em;font-size: 0.86em;display:block"><a ng-if="showAdminLogin!=1">Admin</a></div><form ng-submit="adminLogin()" ng-if="showAdminLogin"><h1>Administrators</h1><label><span>Username</span><input type="email" name="auth_key" ng-model="loginForm.auth_key"></label><label><span>Password</span><input type="password" name="password" ng-model="loginForm.password"></label><input class="submit" type="submit" value="Log in"><span class="error" ng-if="badlogin">Sorry, try again?</span></form></div></div></div>'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class="videoMagnet" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="col"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div class="col col2"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col col2"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow,\n				isEmpty: contentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class="row"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="row"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/endingscreen.html",'<div class="endingscreen stretchToViewport"><div class="pane introtext"><p>Thanks for watching <span ng-bind-html="episode.display_title"></span>.</p><p ng-if="episode.nextEpisodeContainer">The next episode is <a class="nextEpisode" ng-href="/#/{{crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}}" ng-bind-html="episode.nextEpisodeContainer.display_name"></a>.</p><br><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><br><div ng-if="episode.navigation_depth > 0">Other episodes:<ul class="crossEpisodeNav" itt-container-episodes="episode.parents[0]"></ul></div></div></div>'),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewportShort"><div><div class="pane introtext"><h1 ng-bind-html="episode.display_title"></h1><p ng-bind-html="episode.display_description"></p><br><div ng-if="episode.navigation_depth >0">Other episodes:<ul class="crossEpisodeNav" itt-container-episodes="episode.parents[0]"></ul></div></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="landingscreen-end"></div><div class="clear"></div></div></div>'),a.put("templates/scene/pip.html",'<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer showCurrent" ng-class="{\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div>'),a.put("templates/searchpanel.html",'<div ng-class="episode.styleCss"><div aria-label="sort toggle" class="searchfilters" aria-controls="sortableSearch">Sorted by <button tabindex="0" class="fakeLink" ng-click="toggleSortBy(sortBy)" aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button></div><div class="scrollContainer"><div class="searchResults" id="sortableSearch"><div ng-if="sortBy == \'startTime\'"><div ng-repeat="scene in episode.scenes"><h3 ng-if="sceneItems.length > 0 && scene.display_title" ng-bind-html="scene.display_title"></h3><div class="item" ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText||\'\', \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'"></div></div></div><div ng-if="sortBy == \'type\'"><div ng-repeat="(typeID,showType) in searchTypes" ng-if="showType"><h3 ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3><div class="item" ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText||'', 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\"></div></div></div><div ng-if=\"(episode.items | filter:{'searchableText': searchText||'', 'cosmetic': false}).length == 0\">(Nothing matched your search.)</div></div></div></div>"),a.put("templates/testbed-event.html",'<style>.testContentPane {\n	border: 1px solid #000;\n	position: absolute;\n	overflow: hidden;\n	top: 3em;\n	left: 2em;\n	right: 2em;\n	bottom: 10em;\n}\n.testEditorPane {\n	position: absolute;\n	bottom: 0;\n	z-index: 2;\n	left: 0;\n	right: 0;\n	height: 10em;\n	overflow-y: scroll;\n}\nlabel {\n	margin: 0 2em;\n}</style><div class="controls"><label>Content pane type:<select size="1" ng-model="testbed.contentType" ng-init="testbed.contentType=\'content\'"><option value="content">Content</option><option value="fill">Overlay</option></select></label><label ng-if="testbed.contentType == \'content\'"><input type="checkbox" ng-model="testbed.isNarrow">Narrow content pane</label><label>Item state:<select size="1" ng-model="item.state" ng-init="item.state=\'isCurrent\'"><option value="isCurrent">Current</option><option value="isPast">Past</option><option value="isFuture">Future</option></select></label><label><input type="checkbox" ng-model="testbed.showCurrent" ng-init="testbed.showCurrent = false;">Hide non-current items</label></div><div class="testContentPane allowHighlights allowSidebars hasLeftSidebar hasRightSidebar {{testbed.contentType}}" ng-class="{isNarrow: testbed.isNarrow, showCurrent: testbed.showCurrent}"><div ng-if="!(testbed.showCurrent && item.state!=\'isCurrent\')" class="item animate" itt-item="item" ng-class="item.styleCss + \' \' + item.state"></div></div><div class="testEditorPane" itt-item-editor="item"></div>'),a.put("templates/timeline.html",'<div class="timeline" ng-show="!isSuppressed"><button tabindex="0" ng-focus="showControls()" class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()"><span class="control-text">Play</span></button> <button tabindex="0" ng-focus="showControls()" class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()"><span class="control-text">Pause</span></button><div class="progressbarBox"><div class="pbarTop"><span ng-if="appState.product == \'producer\'"><a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()"><span class="control-text">Zoom out</span></a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click="zoomIn()"><span class="control-text">Zoom in</span></a></span></div><div class="pbarMain"><button ng-focus="showControls()" ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click="prevScene()"><span class="control-text">Previous</span></button><div class="tooltip sceneMenuTooltip" ng-if="sceneMenuToolTip"><span class="content">Scene-by-scene navigation</span></div><button ng-focus="showControls()" tabindex="0" class="button-scenemenu" ng-click="showSceneMenuTooltip(false);toggleNavPanel();" ng-mouseover="showSceneMenuTooltip(true)" ng-mouseout="showSceneMenuTooltip(false)"><span class="control-text">Scenes</span></button> <button ng-focus="showControls()" tabindex="0" ng-class="{invisible: appState.time >= appState.duration-0.1}" class="button button-next" ng-click="nextScene()"><span class="control-text">Next</span></button><div class="progressbar"><div class="mask"><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="buffered" ng-style="{width: appState.bufferedPercent+\'%\'}"></div><div class="played" ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="handle" ng-show="isSeeking" ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class="tip" ng-show="seekHandleVisible">{{willSeekTo | asTime}}</div></div><div class="tooltip" ng-if="event.showTooltip" ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"><span class="content" ng-bind-html="event.display_title || \'(&quot;Hidden&quot; scene)\'"></span></div><div class="handle sxsHandle playhead" ng-show="appState.editEvent" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\'}"><div class="tip" ng-click="">{{appState.editEvent.start_time | asTime}}</div></div></div><div class="playhead mask"><div class="progressbarContainer" ng-style="{width: zoomLevel+\'00%\'}"><div class="marker" ng-mouseover="showTooltip(event);" ng-mouseout="hideTooltip(event)" ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}" ng-if="event.display_title || appState.product == \'producer\'" ng-class="{mini: (!event.display_title)}"></div><div ng-if="appState.editEvent" class="editingItem" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(appState.duration - appState.editEvent.end_time)+\'%\'}"></div></div></div></div></div><div class="pbarBottom"><span class="timedisplay">{{appState.time | asTime}} / {{appState.duration | asTime}} <span class="speedcontrol" ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(-0.25)" aria-label="Slow down video"><div ng-class="{arrowLeft: appState.timeMultiplier > 0.5}"></div></button> <span class="speeddisplay" ng-click="resetSpeed()">{{appState.timeMultiplier}}x</span> <button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(0.25)" aria-label="Speed up video"><div ng-class="{arrowRight: appState.timeMultiplier < 2}"></div></button></span></span> <span style="display:inline-block;height:1em;position:relative" ng-if="episode.languages.length > 1"><select size="1" ng-model="appState.lang" class="languageSelector" ng-change="setNewLanguage()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></span> <button ng-focus="showControls()" tabindex="0" ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class="control-text">Captions</span></button>  <span ng-if="!appState.isTouchDevice"><button ng-focus="showControls()" tabindex="0" class="button button-mute {{audioIcon()}}" ng-click="toggleMute()"><span class="control-text">Mute</span></button><itt-volume-slider></itt-volume-slider></span></div></div></div>'),
a.put("templates/user.html",'<div class="userHome"><p><i><span ng-bind="user.role_description"></span></i></p><div style="float:right; width: 79px"><div class="avatar" ng-click="TODOuploadAvatar()"><img ng-if="TODOavatar" ng-src="TODO"></div></div><div style="margin-right:80px"><label><span>Name</span><input class="userEditable" ng-model="user.name" ng-blur="updateUser()"></label><span ng-if="!userHasRole(\'guest\')"><br><label><span>Email</span><input class="userEditable" ng-model="user.email" readonly></label></span></div><div style="clear:both; padding-top: 2em"><a style="float:left" href="/#/user" class="button" ng-if="inPlayer && user._id">Home</a> <a style="float:right" class="button" ng-if="user._id" ng-click="logout()">Sign out</a></div><div ng-if="!inPlayer"><div ng-if="userHasRole(\'admin\')"><a href="/#/episodes">Find episodes</a><br><a href="/#/stories">Find narratives</a></div><div ng-if="!userHasRole(\'guest\') && myPurchases"><h3>Your purchases</h3><div class="narrativelist" ng-repeat="purchase in myPurchases"><div ng-if="purchase.daysUntilExpiration < 0"><h3>{{purchase.narrativeData.name.en}}</h3><p>We\'re sorry, this purchase has expired.</p></div><div ng-if="purchase.daysUntilExpiration >=0 || !purchase.daysUntilExpiration"><h3><a ng-href="/#/story/{{purchase.narrativeData.path.en}}">{{purchase.narrativeData.name.en}}</a></h3><p><i>{{purchase.daysUntilExpiration}} days remaining</i></p><p>{{purchase.narrativeData.description.en}}</p></div></div><div ng-if="myPurchases.length == 0">You have not purchased any stories.</div></div></div></div>'),a.put("templates/video.html",'<div class="video"><iframe tabindex="-1" id="ytplayer{{uid}}" ng-if="video.urls.youtube.length" ng-src="{{video.urls.youtube + \'?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&wmode=opaque&rel=0&html5=1&autoplay=0&disablekb=1&loop=0\'}}"></iframe><video ng-if="video.url && (!video.urls.youtube || !video.urls.youtube.length)" aria-label="media player"><source class="m3u8" ng-if="video.urls.m3u8[0]" ng-src="{{video.urls.m3u8[0]}}" type="application/x-mpegURL"><source class="mpeg4" ng-if="video.urls.mp4[video.curStream]" ng-src="{{video.urls.mp4[video.curStream]}}" type="video/mp4"><source class="webm" ng-if="video.urls.webm[video.curStream]" ng-src="{{video.urls.webm[video.curStream]}}" type="video/webm"><source class="{{video.extension}}" ng-src="{{video.url}}" type="{{video.content_type}}"><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-hide="( video.urls.youtube.length && !appState.hasBeenPlayed && appState.isTouchDevice)" ng-click="videoClick()" class="videoMask" ng-class="{\n		play: appState.timelineState == \'paused\',\n		buffering: appState.timelineState == \'buffering\',\n		firstplay: !appState.hasBeenPlayed,\n		rewind: (appState.time > 0 && appState.time >= video.duration - 0.3)\n	}"></div></div>')}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config?window.config:{};return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a.localStorageKey||(a.localStorageKey="storyToken"),a.youtube||(a.youtube={domain:"//gdata.youtube.com/",timeout:5e3}),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","config",function(a,b){var c={};return c.init=function(){c.user=c.user||{},c.episodeId=!1,c.episodeSegmentId=!1,c.isFramed=window.parent!=window,c.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),c.windowWidth=0,c.windowHeight=0,c.viewMode=$(window).width()>480?"discover":"review",c.producerEditLayer=0,c.time=0,c.bufferedPercent=0,c.timeMultiplier=1,c.duration=0,c.timelineState="paused",c.hasBeenPlayed=!1,c.volume=100,c.muted=!1,c.hideCaptions=!1,c.show={searchPanel:!1,helpPanel:!1,navPanel:!1},c.videoControlsActive=!1,c.videoControlsLocked=!1,c.itemDetail=!1,c.autoscroll=!1,c.autoscrollBlocked=!1,c.product=c.product,c.productLoadedAs=c.productLoadedAs,c.crossEpisodePath="sxs"===c.product||"producer"===c.product?c.product:"episode",c.editEvent=!1,c.editEpisode=!1,c.lang=!1},c.init(),a(function(){c.windowHeight=angular.element(window).height(),c.windowWidth=angular.element(window).width()},50,0,!1),b.debugInBrowser,c}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","appState",function(a,b,c,d,e,f){var g={};g.userHasRole=function(a){if(f.user&&f.user.roles)for(var b=0;b<f.user.roles.length;b++)if(f.user.roles[b].role===a)return!0;return!1},g.logout=function(){localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",f.user={},c({method:"GET",url:a.apiDataBaseUrl+"/logout"}).success(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})}).error(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})})},g.adminLogin=function(b,e){var f=d.defer();return c({method:"POST",url:a.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:b,password:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',h(a),g.getCurrentUser().then(function(){f.resolve(a)})}).error(function(a){f.reject(a)}),f.promise},g.authenticate=function(){var h=d.defer();if(c.defaults.headers.common.Authorization)f.user?h.resolve():g.getCurrentUser().then(function(){h.resolve()},function(){return g.authenticateViaNonce()});else{if(b.key){var i=b.key;return e.search("key",null),g.getAccessToken(i)}var j=g.getStoredToken();if(!j)return g.authenticateViaNonce();c.defaults.headers.common.Authorization='Token token="'+j+'"',g.getCurrentUser().then(function(){h.resolve()},function(){return localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",f.user={},g.authenticateViaNonce()})}return h.promise},g.authenticateViaNonce=function(){var a=d.defer();return g.getNonce().then(function(b){g.getAccessToken(b).then(function(){a.resolve()})}),a.promise},g.getStoredToken=function(){var b={};if(localStorage&&localStorage.getItem(a.localStorageKey)){localStorage.removeItem("storyKey"),b=angular.fromJson(localStorage.getItem(a.localStorageKey));var c=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];b.customer!==c&&(localStorage.removeItem(a.localStorageKey),b={})}return b.token||!1},g.getCurrentUser=function(){var b=d.defer();return c({method:"GET",url:a.apiDataBaseUrl+"/show_user"}).success(function(a){h(a),b.resolve()}).error(function(){b.reject()}),b.promise},g.updateUser=function(b){var e=d.defer();return c({method:"PUT",url:a.apiDataBaseUrl+"/users/"+b._id,data:b}).success(function(){e.resolve()}).error(function(){e.reject()}),e.promise};var h=function(b){if(null!==b.roles&&void 0!==b.roles&&b.roles.length>0&&b.roles[0].constructor===String){for(var c=[],d=0;d<b.roles.length;d++){var e={role:b.roles[d]};c.push(e)}b.roles=c}var g={access_token:b.access_token||b.authentication_token,customer:a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:b.roles};angular.forEach(["_id","name","email","track_event_actions","track_episode_metrics"],function(a){b[a]&&(g[a]=b[a])}),b["track_episode_metrics:"]&&(g.track_episode_metrics=!0),g.roles&&(g.role_description=i(g.roles[0])),b.emails&&(g.email=b.emails[0]),f.user=g;try{localStorage.setItem(a.localStorageKey,JSON.stringify({token:g.access_token,customer:g.customer}))}catch(h){}},i=function(a){return void 0===a?"User":"admin"===a.role?"Administrator":void 0===a.role?"User":"guest"===a.role?"Guest user":a.role.match(/student/i)?"Student":a.role.match(/instructor/i)?"Instructor":a};return g.getNonce=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url&&null!==a.login_url?(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url,b.reject()):("#/"!==window.location.hash&&(window.location.href="/#/"),b.reject())}).error(function(){b.reject()}),b.promise},g.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){h(a),c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',g.getCurrentUser().then(function(){e.resolve(a)})}).error(function(){e.reject()}),e.promise},g}]),angular.module("com.inthetelling.story").factory("awsSvc",["config","$routeParams","$http","$q","appState",function(a,b,c,d){var e,f,g,h,i=1e3,j=3,k="public-read",l="pending",m="uploading",n="complete",o={},p={s3:{}},q=5242880,r=0,s=0,t=0,u=[],v=0,w=[],x=0,y=0,z=[],A=!1;o.awsCache=function(){return p},o.getBucketListing=function(){var a=d.defer();return B().then(function(){p.s3.listObjects(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},o.uploadFiles=function(a,b){for(var c=[],e=0;e<b.length;e++){w.push(b.item(e));var f=d.defer();z.push(f),c.push(f.promise)}return C(a),c},o.pauseUpload=function(){if(e&&!A){if(A=!0,O(),F())y=0;else{var a=0;for(y=0;s>a;){var b=u[a];b.status===n&&(y+=b.uploaded),a++}}g.notify({bytesSent:y,bytesTotal:e.size})}},o.resumeUpload=function(){if(e&&A)if(A=!1,F())H();else for(var a=0;j>a;a++)L()},o.cancelUpload=function(){e&&(A=!1,y=0,O(),F()||(o.cancelMultipartUpload(f),f=null),e=null,g.notify({bytesSent:0,bytesTotal:0}),g.reject("Canceled by user"))},o.networkError=function(){e&&O()},o.deleteObject=function(a){var b=d.defer();return B().then(function(){var c={Bucket:a.bucket,Key:a.Key};p.s3.deleteObject(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise},o.getMultipartUploads=function(){var a=d.defer();return B().then(function(){p.s3.listMultipartUploads(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},o.getMultipartUploadParts=function(a,b){var c=d.defer();return B().then(function(){var d={Bucket:b.bucket,Key:b.Key,UploadId:b.UploadId};p.s3.listParts(d,function(b,d){b?c.reject():c.resolve({i:a,parts:d})})}),c.promise},o.cancelMultipartUpload=function(a){var b=d.defer();return B().then(function(){var c={Bucket:a.bucket,Key:a.Key,UploadId:a.UploadId};p.s3.abortMultipartUpload(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise};var B=function(){return p.hasOwnProperty("sessionDeferred")?p.sessionDeferred.promise:(p.sessionDeferred=d.defer(),c.get(a.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(b){if(b.access_key_id){AWS.config.update({accessKeyId:b.access_key_id,secretAccessKey:b.secret_access_key,sessionToken:b.session_token,region:a.awsRegion});var c={params:{Bucket:b.bucket,Prefix:b.key_base}};p.s3=new AWS.S3(c),p.sessionDeferred.resolve(b)}else p.sessionDeferred.reject()}).error(function(){p.sessionDeferred.reject()}),p.sessionDeferred.promise)},C=function(a){if(w.length>x&&!e){if(e=w[x],""===e.type)return z[x].resolve("Could not determine file type for file '"+e.name+"'"),e=null,x++,void C(a);D().then(function(){var b;b=F()?G():I(),b.then(function(){P(a)},function(a){z[x].reject(a)},function(a){z[x].notify(a)})})}},D=function(a){return a=a||d.defer(),e.uniqueName=E(),B().then(function(){var b={Key:p.s3.config.params.Prefix+e.uniqueName};p.s3.headObject(b,function(b){b?404!==b.statusCode?a.reject(b):(F()||o.getMultipartUploads().then(function(a){for(var b=!0;b;)for(var c=p.s3.config.params.Prefix+e.uniqueName,d=0;d<a.Uploads.length;d++){if(a.Uploads[d].Key===c){e.uniqueName=E();break}d===a.Uploads.length-1&&(b=!1)}}),a.resolve()):(e.uniqueName=E(),D(a))})}),a.promise},E=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b},F=function(){return e.size<=q?!0:!1},G=function(){return g=d.defer(),H().then(function(){},function(){},function(){}),g.promise},H=function(){var a=d.defer();return B().then(function(){var a={Key:p.s3.config.params.Prefix+e.uniqueName,ContentType:e.type,Body:e,ACL:k};h=p.s3.putObject(a,function(a,b){a?g.reject():g.resolve(b)}),h.on("httpUploadProgress",function(a){g.notify({bytesSent:a.loaded,bytesTotal:a.total})}).on("error",function(a){g.reject(a)})},function(){},function(){}),a.promise},I=function(){return g=d.defer(),J().then(K).then(function(){for(var a=0;j>a;a++)L()}),g.promise},J=function(){var a=d.defer();return B().then(function(){var b={Key:p.s3.config.params.Prefix+e.uniqueName};p.s3.createMultipartUpload(b,function(b,c){b?a.reject():a.resolve(c)})}),a.promise},K=function(a){var b=d.defer();f=a,u=[],s=0,t=0,v=0,r=q,y=0,e.size>r*i&&(r=Math.ceil(e.size/i)),s=Math.ceil(e.size/r);for(var c=0;s>c;c++){var g={};g.start=c*r,g.end=g.start+r,g.uploaded=0,g.end>e.size&&(g.end=e.size),g.status=l,u.push(g)}return b.resolve(),b.promise},L=function(){var a=d.defer(),b=v,c=!1;if(A)a.reject("Upload paused");else{for(;!c&&s>b;){var f=u[b];if(f.status===l){c=!0,f.status=m;var g=e.slice(f.start,f.end);f.cancel=function(){f.request.abort(),f.status=l,f.uploaded=0},d.all({partNumber:d.when(b+1),eTag:M(b+1,g)}).then(N).then(function(b){a.resolve(b)},function(b){a.reject(b)},function(b){a.update(b)})}else f.status===n&&b===v&&v++;b++}c||a.reject("All chunks uploaded")}return a.promise},M=function(a,b){var c=d.defer();return B().then(function(){var d={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,PartNumber:a,Body:b};u[a-1].request=p.s3.uploadPart(d,function(a,b){a?c.reject():c.resolve(b.ETag)}),u[a-1].request.on("httpUploadProgress",function(b){y+=b.loaded-u[a-1].uploaded,u[a-1].uploaded=b.loaded,g.notify({bytesSent:y,bytesTotal:e.size})}).on("error",function(a){g.reject(a)})}),c.promise},N=function(a){var b=d.defer();if(u[a.partNumber-1].status=n,u[a.partNumber-1].part={ETag:a.eTag,PartNumber:a.partNumber},t++,t===s){for(var c=[],e=0;s>e;e++)c.push(u[e].part);var h={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,MultipartUpload:{Parts:c}};p.s3.completeMultipartUpload(h,function(a,c){a?(g.reject(a),b.reject(a)):(h={Bucket:f.Bucket,Key:f.Key,ACL:k},p.s3.putObjectAcl(h,function(a){a&&(g.reject(a),b.reject(a))}),g.resolve(c),b.resolve(c))})}else L();return b.promise},O=function(){if(F())h.abort();else for(var a=v,b=!1;!b&&s>a;){var c=u[a];c.status===m?c.cancel():c.status===l&&(b=!0),a++}},P=function(b){var f=d.defer(),g={url:"https://s3.amazonaws.com/"+p.s3.config.params.Bucket+"/"+p.s3.config.params.Prefix+e.uniqueName,type:e.type,size:e.size,original_filename:e.name};return c.post(a.apiDataBaseUrl+"/v1/containers/"+b+"/assets",g).success(function(a){z[x].resolve(a),e=null,x++,C(b)}).error(function(){z[x].reject()}),f.promise};return o}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","$rootScope","config","authSvc","appState","modelSvc","errorSvc","mockSvc","questionAnswersSvc",function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};m.getNarrative=function(a){return v("/v3/narratives/"+a+"/resolve",function(a){return i.cache("narrative",m.resolveIDs(a)),i.narratives[a._id]})},m.getNarrativeOverview=function(a){return v("/v3/narratives/"+a)};var n=!1;m.getUserNarratives=function(b){if(n){var c=a.defer();return c.resolve(n),c.promise}return v("/v3/users/"+b+"/narrative_purchases",function(a){return n=a,a})},m.getCustomerList=function(){return v("/v3/customers/",function(a){return angular.forEach(a,function(a){i.cache("customer",a)}),a})},m.getCustomer=function(a){return g.userHasRole("admin")?void(i.customers[a]||(i.cache("customer",{_id:a}),v("/v3/customers/"+a,function(a){i.cache("customer",a)}))):!1},m.getEpisode=function(a,b){if(!a)throw"no episode ID supplied to dataSvc.getEpisode";i.cache("episode",{_id:a}),c.local?(k.mockEpisode(a),e.$emit("dataSvc.getEpisode.done")):g.authenticate().then(function(){return r()}).then(function(){return s(a,b)})},m.getEpisodeOverview=function(a){return v("/v3/episodes/"+a)},m.getNarrativeList=function(){return v("/v3/narratives/")},m.createUserGroup=function(a){return x("/v3/groups",{group:{name:a}})},m.createNarrative=function(a){return delete a.templateUrl,x("/v3/narratives",a)},m.updateNarrative=function(a){return delete a.templateUrl,w("/v3/narratives/"+a._id,a)},m.createChildEpisode=function(a){return x("/v3/episodes",{episode:a})},m.createEpisodeSegment=function(a,b){return x("/v3/timelines/"+a+"/episode_segments",b)},m.storeTimeline=function(a,b){return b._id?w("/v3/timelines/"+b._id,b,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a}):x("/v3/narratives/"+a+"/timelines",b,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a})},m.getSingleAsset=function(a){return v("/v1/assets/"+a)};var o={template:{},layout:{},style:{}},p=!1,q=a.defer(),r=function(){return p?q.promise:(p=!0,a.all([b.get(f.apiDataBaseUrl+"/v1/templates"),b.get(f.apiDataBaseUrl+"/v1/layouts"),b.get(f.apiDataBaseUrl+"/v1/styles")]).then(function(a){m.cache("templates",a[0].data),m.cache("layouts",a[1].data),m.cache("styles",a[2].data),p=!0,q.resolve()},function(){p=!1,q.reject()}),q.promise)};m.cache=function(a,b){angular.forEach(b,function(b){"templates"===a?o.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?o.layout[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name}:"styles"===a&&(o.style[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name})})},m.createTemplate=function(a){return x("/v1/templates",a)},m.resolveIDs=function(a){if(a.everyone_group&&!a.template_id&&(a.templateUrl="templates/narrative/default.html"),a.template_id&&(o.template[a.template_id]?(a.templateUrl=o.template[a.template_id].url,delete a.template_id):j.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){o.layout[a]?b.push(o.layout[a].css_name):j.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b)}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){o.style[a]?c.push(o.style[a].css_name):j.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c)}return a};var s=function(a,c){var d=c?"/v3/episode_segments/"+c+"/resolve":"/v3/episodes/"+a;b.get(f.apiDataBaseUrl+d).success(function(b){var d={};if(b&&(d=b.episode?b.episode:b),"Published"===d.status||g.userHasRole("admin")){i.cache("episode",m.resolveIDs(d));var f=0;t(a,c).then(function(){i.resolveEpisodeEvents(a),2===++f&&e.$emit("dataSvc.getEpisode.done")}),m.getContainerAncestry(d.container_id,a).then(function(){i.resolveEpisodeContainers(a),2===++f&&e.$emit("dataSvc.getEpisode.done")})}else j.error({data:"This episode has not yet been published."})}).error(function(){j.error({data:"API call to /v3/episodes/"+a+" failed (bad episode ID?)"})})};m.getContainerAncestry=function(b,c,d){return d=d||a.defer(),m.getContainer(b,c).then(function(a){var b=i.containers[a];b.parent_id?m.getContainerAncestry(b.parent_id,c,d):d.resolve(a)}),d.promise};var t=function(a,c){var d=c?"/v3/episode_segments/"+c+"/events":"/v3/episodes/"+a+"/events";return b.get(f.apiDataBaseUrl+d).success(function(b){u(b,"Plugin",a),angular.forEach(b,function(b){b.cur_episode_id=a,i.cache("event",m.resolveIDs(b))})})},u=function(a,b,c){angular.forEach(a,function(a){"Plugin"===a.type&&!function(a){l.getUserAnswer(a._id,h.user._id).then(function(b){if(b.data){a.data._plugin.hasBeenAnswered=!0;var c=0,d=!0;angular.forEach(a.data._plugin.distractors,function(e){d&&(e.text===b.data.answer&&(e.selected=!0,a.data._plugin.selectedDistractor=e.index,d=!1),c++)}),i.cache("event",m.resolveIDs(a))}})}(a)}),i.resolveEpisodeEvents(c)},v=function(c,d){var e=a.defer();return g.authenticate().then(function(){b.get(f.apiDataBaseUrl+c).then(function(a){var b=a.data;return d&&(b=d(b)),e.resolve(b)})}),e.promise},w=function(c,d,e){var g=a.defer();return b({method:"PUT",url:f.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),g.resolve(b)}),g.promise},x=function(c,d,e){var g=a.defer();return b({method:"POST",url:f.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),g.resolve(b)}),g.promise},y=function(c){var d=a.defer();return b({method:"DELETE",url:f.apiDataBaseUrl+c}).success(function(a){return d.resolve(a)}),d.promise};m.getContainerRoot=function(){return v("/v3/containers",function(a){var b=[];return angular.forEach(a,function(a){i.cache("container",a),b.push(a._id)}),b})},m.getContainer=function(a,b){return v("/v3/containers/"+a,function(c){i.cache("container",c[0]);var d=i.containers[c[0]._id];if(m.getContainerAssets(a,b),d.children){for(var e=0;e<d.children.length;e++)d.children[e]=i.containers[d.children[e]._id];var f=!1;b||(f=!0),b&&i.episodes[b].navigation_depth>0&&(f=!0),f&&angular.forEach(d.children,function(a){a.episodes[0]&&m.getEpisodeOverview(a.episodes[0]).then(function(b){b&&(a.status=b.status,a.title=b.title,i.cache("container",a))})})}return c[0]._id})},m.getContainerAssets=function(a,c){return b.get(f.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(b){i.containers[a].assetsHaveLoaded=!0,angular.forEach(b.files,function(a){i.cache("asset",a)}),i.resolveEpisodeAssets(c)})},m.createContainer=function(b){var c=a.defer(),d={container:{customer_id:b.customer_id,name:b.name,parent_id:b.parent_id}};return x("/v3/containers",d).then(function(a){i.cache("container",a);var b=a.parent_id;i.containers[b].children.push(i.containers[a._id]),c.resolve(a)}),c.promise},m.updateContainer=function(b){var c=a.defer();return b._id||c.reject(),w("/v3/containers/"+b._id,b,function(a){i.cache("container",a),c.resolve(a)}),c.promise},m.deleteContainer=function(a){return delete i.containers[a],y("/v3/containers/"+a)},m.createEpisode=function(b){b.status="Unpublished";var c=a.defer();return x("/v3/episodes",b).then(function(a){i.containers[a.container_id].episodes=[a._id],i.containers[a.container_id].status=a.status,c.resolve(a)}),c.promise},m.storeEpisode=function(a){var b=A(a);return b?w("/v3/episodes/"+b._id,b):!1},m.deleteEpisode=function(b){var c=a.defer();return v("/v2/episodes/"+b+"/episode_user_metrics").then(function(d){if(d.length){for(var e=[],f=0;f<d.length;f++)e.push(y("/v2/episode_user_metrics/"+d[f]._id));a.all(e).then(function(){y("/v3/episodes/"+b),c.resolve()})}else y("/v3/episodes/"+b),c.resolve()}),c.promise},m.deleteItem=function(a){return y("/v3/events/"+a)},m.createAsset=function(b,c){var d=a.defer();return c.container_id=b,c._id&&c._id.match(/internal/)&&delete c._id,x("/v1/containers/"+b+"/assets",c).then(function(a){var b=a.file;i.containers[b.container_id].episodes=[b._id],d.resolve(a),i.cache("asset",b)}),d.promise},m.deleteAsset=function(a){return y("/v1/assets/"+a)},m.storeItem=function(a){return a=z(a),a?a&&a._id&&!a._id.match(/internal/)?w("/v3/events/"+a._id,{event:a}):x("/v3/episodes/"+a.episode_id+"/events",{event:a}):!1};var z=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;var c=["_id","start_time","end_time","episode_id","template_id","templateUrl","stop","required","cosmetic","sxs","title","url","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id"];b.type=a._type;for(var d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=angular.copy(a[c[d]]));if(b.start_time&&b.end_time){var e=parseFloat(b.start_time),f=parseFloat(b.end_time);if(isNaN(e)||isNaN(f))return j.error({data:"Tried to store an invalid start_time or end_time."}),!1;if(e>f)return j.error({data:"Tried to store a start_time that is after the end_time."}),!1}if(b.data&&(delete b.data._plugin.selectedDistractor,delete b.data._plugin.hasBeenAnswered,delete b.data._plugin._type,b.data._plugin.distractors.length))for(d=0;d<b.data._plugin.distractors.length;d++)delete b.data._plugin.distractors[d].selected;b.style_id=[],b.layout_id=[],b.style_id=C("style",a.styles),b.layout_id=C("layout",a.layouts);var g=m.readCache("template","url",a.templateUrl);return b.template_id=g?g.id:B(a.templateUrl),b.template_id?b:(j.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)};m.prepItemForStorage=z,m.detachMasterAsset=function(a){var b=A(a);return b.master_asset_id=null,b?w("/v3/episodes/"+b._id,b):!1},m.detachEventAsset=function(a,b){return(a=z(a))?(a.asset_id===b&&(a.asset_id=null),a.link_image_id===b&&(a.link_image_id=null),a.annotation_image_id===b&&(a.annotation_image_id=null),a&&a._id&&!a._id.match(/internal/)?w("/v3/events/"+a._id,{event:a}):x("/v3/episodes/"+a.episode_id+"/events",{event:a})):!1};var A=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;for(var c=["_id","title","description","container_id","customer_id","master_asset_id","status","languages","navigation_depth"],d=0;d<c.length;d++)(a[c[d]]||0===a[c[d]])&&(b[c[d]]=angular.copy(a[c[d]]));b.style_id=C("style",a.styles);var e=m.readCache("template","url",a.templateUrl);return b.template_id=e?e.id:B(a.templateUrl),b.template_id?b:(j.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)},B=function(a){var b={"templates/episode/episode.html":"templates/episode-default.html","templates/episode/eliterate.html":"templates/episode-eliterate.html","templates/episode/ewb.html":"templates/episode-ewb.html","templates/episode/gw.html":"templates/episode-gw.html","templates/episode/purdue.html":"templates/episode-purdue.html","templates/episode/story.html":"templates/episode-tellingstory.html","templates/item/transcript.html":"templates/transcript-default.html","templates/item/transcript-withthumbnail.html":"templates/transcript-withthumbnail.html","templates/item/transcript-withthumbnail-alt.html":"templates/transcript-withthumbnail-alt.html","templates/item/text-h1.html":"templates/text-h1.html","templates/item/text-h2.html":"templates/text-h2.html","templates/item/pullquote-noattrib.html":"templates/text-pullquote-noattrib.html","templates/item/pullquote.html":"templates/text-pullquote.html","templates/item/image.html":"templates/transmedia-image-default.html","templates/item/image-caption.html":"templates/transmedia-caption.html","templates/item/image-caption-sliding.html":"templates/transmedia-slidingcaption.html","templates/item/image-fill.html":"templates/transmedia-image-fill.html","templates/item/image-plain.html":"templates/transmedia-image-plain.html","templates/item/image-linkonly.html":"templates/transmedia-linkonly.html","templates/item/image-thumbnail.html":"templates/transmedia-thumbnail.html","templates/item/link.html":"templates/transmedia-link-default.html","templates/item/link-embed.html":"templates/transmedia-link-embed.html","templates/scene/1col.html":"templates/scene-1col.html","templates/scene/2colL.html":"templates/scene-2colL.html","templates/scene/2colR.html":"templates/scene-2colR.html","templates/scene/centered.html":"templates/scene-centered.html","templates/scene/cornerH.html":"templates/scene-cornerH.html","templates/scene/cornerV.html":"templates/scene-cornerV.html","templates/item/question-mc-formative.html":"templates/question-mc-formative.html","templates/item/question-mc-poll.html":"templates/question-mc-poll.html","templates/item/question-mc.html":"templates/question-mc.html","templates/item/question-mc-image-left.html":"templates/question-mc-image-left.html","templates/item/question-mc-image-right.html":"templates/question-mc-image-right.html","templates/item/sxs-question.html":"templates/sxs-question.html","templates/item/sxs-link.html":"templates/sxs-link.html"};if(b[a]){var c=m.readCache("template","url",b[a]);return c.id}return!1};m.readCache=function(a,b,c){var d=!1;return angular.forEach(o[a],function(a){a[b]===c&&(d=a)}),d?d:!1},f.debugInBrowser;var C=function(a,b){var c=["colorEliterate","colorGw","colorGwsb","colorPurdue","colorUsc","colorColumbia","colorColumbiabusiness","typographyEliterate","typographyGw","typographyGwsb","typographyPurdue","typographyUsc","typographyColumbia","typographyColumbiabusiness"],d=[];return angular.forEach(b,function(b){if(b){var e=m.readCache(a,"css_name",b);if(e)d.push(e.id);else if(-1===c.indexOf(b))return j.error({data:"Tried to store a "+a+" with no ID: "+b}),!1}}),d};return m}]),angular.module("com.inthetelling.story").factory("errorSvc",["$location",function(a){var b={};return b.init=function(){b.errors=[],b.notifications=[]},b.init(),b.error=function(c){!c||401!==c.status&&403!==c.status||"/"===a.path()&&(c=void 0),c&&c.data&&("string"==typeof c.data?(c.data=c.data.replace(/\n/g,"").replace(/==/g,"").replace(/-----.*/g,""),b.errors.push({exception:c})):b.errors.push({exception:c}))},b.notify=function(a){b.notifications.push({text:a})},b}]);var DEFAULT_EPISODE_TEMPLATE_URL="templates/episode/story.html";angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","config","appState","youtubeSvc",function(a,b,c,d,e){var f={};f.episodes={},f.assets={},f.events={},f.containers={},f.narratives={},f.customers={},f.cache=function(a,b){"narrative"===a&&(f.narratives[b._id]?angular.extend(f.narratives[b._id],b):f.narratives[b._id]=angular.copy(b)),"customer"===a&&(f.customers[b._id]?angular.extend(f.customers[b._id],b):f.customers[b._id]=angular.copy(b)),"episode"===a?f.episodes[b._id]?angular.extend(f.episodes[b._id],f.deriveEpisode(angular.copy(b))):f.episodes[b._id]=f.deriveEpisode(angular.copy(b)):"event"===a?(b.title||(b.title={}),f.events[b._id]?angular.extend(f.events[b._id],f.deriveEvent(angular.copy(b))):f.events[b._id]=f.deriveEvent(angular.copy(b))):"asset"===a?f.assets[b._id]?angular.extend(f.assets[b._id],f.deriveAsset(angular.copy(b))):f.assets[b._id]=f.deriveAsset(angular.copy(b)):"container"===a&&(f.containers[b._id]?angular.extend(f.containers[b._id],f.deriveContainer(angular.copy(b))):f.containers[b._id]=f.deriveContainer(angular.copy(b)))};var g={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html",
"templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/debug.html","templates/upload-demo.html":"templates/item/debug.html","templates/question-mc-formative.html":"templates/item/question-mc-formative.html","templates/question-mc-poll.html":"templates/item/question-mc-poll.html","templates/question-mc.html":"templates/item/question-mc.html","templates/question-mc-image-left.html":"templates/item/question-mc-image-left.html","templates/question-mc-image-right.html":"templates/item/question-mc-image-right.html","templates/sxs-question.html":"templates/item/sxs-question.html"};f.deriveEpisode=function(a){return a.templateUrl||(a.templateUrl=DEFAULT_EPISODE_TEMPLATE_URL),g[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl]),angular.forEach(a.languages,function(b){b["default"]&&(a.defaultLanguage=b.code)}),a.defaultLanguage===!1&&(a.defaultLanguage="en"),f.setLanguageStrings(),a.styles||(a.styles=[]),angular.forEach(["eliterate","gw","gwsb","purdue","usc","columbia","columbiabusiness"],function(b){a.templateUrl==="templates/episode/"+b+".html"&&angular.forEach(["color","typography"],function(c){var d=!1;angular.forEach(a.styles,function(a){a.match(c)&&(d=!0)}),d||a.styles.push(c+b[0].toUpperCase()+b.substring(1))})}),a.title&&f.events["internal:landingscreen:"+a._id]&&(f.events["internal:landingscreen:"+a._id].title=a.title,f.events["internal:landingscreen:"+a._id]=i(f.events["internal:landingscreen:"+a._id])),a=i(a)},f.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=l(a)),a=i(a)},f.deriveContainer=function(a){if(a.haveNotLoadedChildData=!1,a.children&&a.children.length>0){a.children=a.children.sort(function(a,b){return a.name.en>b.name.en?1:-1}),a.children=a.children.sort(function(a,b){return a.sort_order-b.sort_order});var b=[];angular.forEach(a.children,function(a){f.containers[a._id]?b.push(f.containers[a._id]):(a.haveNotLoadedChildData=!0,f.containers[a._id]=angular.copy(i(a)))}),a.loadedChildData=!0}else a.children=[];return i(a)};var h=function(a){return void 0!==a?"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1:void 0};f.deriveEvent=function(a){return a=i(a),"Scene"!==a._type&&(f.episodes[a.cur_episode_id]&&"templates/episode/usc.html"===f.episodes[a.cur_episode_id].templateUrl&&(a.templateUrl||(a.templateUrl="templates/item/usc-badges.html"),"Link"===a._type&&("templates/transmedia-link-default.html"===a.templateUrl&&(a.templateUrl="templates/transmedia-link-noembed.html"),a.display_title.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youâ€™re finished - Come back to this page and click <b>Continue</b>).<br><br>If youâ€™d rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.display_title.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.display_title.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge"))),a.isContent=!1,a.isTranscript=!1,a.noEmbed=!1,a.noExternalLink=!1,a.targetTop=!1,a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,h(a)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),"Link"===a._type&&a.url&&a.url.match(/^http:\/\//)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0,a.noEmbed=!0)),g[a.templateUrl]?(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])):a.origTemplateUrl=a.templateUrl,a.producerItemType||("Scene"===a._type?a.producerItemType="scene":"Annotation"===a._type?a.producerItemType=a.templateUrl.match(/transcript/)?"transcript":"annotation":"Upload"===a._type?a.producerItemType=a.templateUrl.match(/file/)?"file":"image":"Link"===a._type?a.producerItemType="link":"Plugin"===a._type&&a.templateUrl.match(/question/)&&(a.producerItemType="question"),!a.producerItemType),a.displayStartTime=b("asTime")(a.start_time),a};var i=function(a){var b=d.lang?d.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(c){a[c]&&(a["display_"+c]="string"==typeof a[c]?a[c]:a[c][b]?a[c][b]:a[c].en)}),a};f.setLanguageStrings=function(){angular.forEach(f.events,function(a){a=i(a)}),angular.forEach(f.episodes,function(a){a=i(a)}),angular.forEach(f.containers,function(a){a=i(a)})},f.resolveEpisodeEvents=function(a){var b=[],c=[],d=f.episodes[a];angular.forEach(f.events,function(d){d.cur_episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))});var e={};angular.forEach(c,function(a){if("Annotation"===a._type&&a.annotator){var b=d.defaultLanguage||"en",c=a.annotator[b];void 0===c&&(c=a.annotator[Object.keys(a.annotator).sort()[0]]),e[c]?(e[c].name=angular.extend(e[c].name,a.annotator),e[c].annotation_image_id||(e[c].annotation_image_id=a.annotation_image_id)):e[c]={name:a.annotator,annotation_image_id:a.annotation_image_id};for(var f=Object.keys(e[c].name).sort(),g=e[c].name[b]||"(untranslated)",h=0;h<f.length;h++)f[h]!==b&&(g=g+" / "+e[c].name[f[h]]);e[c].key=g}}),d.annotators=e,d.scenes=b.sort(function(a,b){return a.start_time-b.start_time}),d.items=c.sort(function(a,b){return a.start_time-b.start_time});var g=0;d.masterAsset&&(g=d.masterAsset.duration),angular.forEach(c,function(a){g>0&&a.start_time>g-.11&&(a.start_time=g-.2,a.end_time=g-.1),a.start_time<.01&&(a.start_time=.01,a.end_time<.01&&(a.end_time=.01)),a.start_time>a.end_time&&(a.end_time=a.start_time)});for(var i=1,j=d.scenes.length;j>i;i++)i===j-1?0!==g&&(d.scenes[i].end_time=g):d.scenes[i].end_time=d.scenes[i+1].start_time;for(var l=0,m=0,n=b.length;n>m;m++){for(var o=b[m],p=[],q={},r=l,s=c.length;s>r;r++){var t=c[r];t.start_time>=o.start_time&&t.start_time<o.end_time&&(h(t)&&(q.end_time===o.end_time&&(q.end_time=t.start_time),q=t),t.end_time<=o.end_time?(f.events[t._id].scene_id=o._id,p.push(t)):o.end_time-.25<t.start_time&&m!==n-1?t.start_time=o.end_time:(t.end_time=o.end_time,t.scene_id=o._id,p.push(t)))}f.events[o._id].items=p.sort(function(a,b){return a.start_time===b.start_time&&b.layouts?b.layouts.indexOf("sidebarL")>-1||b.layouts.indexOf("sidebarR")>-1?1:0:a.start_time-b.start_time})}d.styleCss=k(d),angular.forEach(f.events,function(b){b.cur_episode_id===a&&(b.styleCss=k(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},f.resolveEpisodeContainers=function(a){var b=f.episodes[a];b.parents=[],delete b.previousEpisodeContainer,delete b.nextEpisodeContainer,b.navigation_depth>0?j(+b.navigation_depth+1,a,b.container_id):b.navigation_depth=0};var j=function(a,b,c){var d=f.episodes[b];if(a<=d.navigation_depth&&(d.parents[a-1]=f.containers[c]),a===d.navigation_depth)for(var e=0;e<f.containers[c].children.length;e++){var g=f.containers[c].children[e];if(g.episodes[0]===b){if(e>0)for(var h=e-1;h>-1;h--)if("Published"===f.containers[f.containers[c].children[h]._id].status){d.previousEpisodeContainer=f.containers[f.containers[c].children[h]._id];break}if(e<f.containers[c].children.length-1)for(var i=e+1;i<f.containers[c].children.length;i++)if("Published"===f.containers[f.containers[c].children[i]._id].status){d.nextEpisodeContainer=f.containers[f.containers[c].children[i]._id];break}}}a>1&&j(a-1,b,f.containers[c].parent_id)};f.episode=function(a){return!f.episodes[a],f.episodes[a]},f.episodeEvents=function(a){var b=[];return angular.forEach(f.events,function(c){c.cur_episode_id===a&&b.push(c)}),b},f.sceneAtEpisodeTime=function(a,b){b=b||d.time;for(var c=f.episodes[a].scenes,e=0;e<c.length;e++)if(c[e].start_time<=b&&c[e].end_time>b)return c[e]},f.scene=function(a){return!f.events[a],f.events[a]};var k=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=f.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.cur_episode_id){var e=f.episodes[a.cur_episode_id].styles;angular.forEach(e,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}if("Scene"!==a._type&&!a.isContent&&a.layouts&&a.layouts[0].match(/Bg/))for(var g=0;g<c.length;g++)c[g].match(/transition/)&&"transitionNone"!==c[g]&&(c[g]="transitionFade");return c.join(" ")};f.resolveEpisodeAssets=function(a){if(angular.forEach(f.events,function(b){if(b.cur_episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&f.assets[c]&&(f.events[b._id].asset=f.assets[c])}}),f.episodes[a]){var b=f.episodes[a].master_asset_id;b&&f.assets[b]&&(f.episodes[a].masterAsset=f.assets[b])}},f.addLandingScreen=function(a){f.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",cur_episode_id:a,episode_id:a,start_time:-.01,end_time:.01}},f.addEndingScreen=function(a){var b=f.episodes[a];if(b&&b.scenes&&b.masterAsset){b.scenes=b.scenes.sort(function(a,b){return a.start_time-b.start_time});var c=b.scenes[b.scenes.length-1];if(!c._id.match(/internal:endingscreen/)){var d=parseFloat(b.masterAsset.duration);c.end_time=d-.1,angular.forEach(c.items,function(a){a.end_time>d-.1&&(a.end_time=d-.1)}),f.events["internal:endingscreen:"+a]={_id:"internal:endingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/endingscreen.html",cur_episode_id:a,start_time:d-.1,end_time:d},f.events["internal:endingscreen:"+a]=i(f.events["internal:endingscreen:"+a]),f.resolveEpisodeEvents(a)}}};var l=function(a){var b={youtube:[],mp4:[],webm:[],m3u8:[]},f=/\.(\w+)$/;if(a.alternate_urls){for(var g=0;g<a.alternate_urls.length;g++)a.alternate_urls[g].match(/youtube/)?e.embeddableYoutubeUrl(a.alternate_urls[g])&&b.youtube.push(e.embeddableYoutubeUrl(a.alternate_urls[g])):b[a.alternate_urls[g].match(f)[1]].push(a.alternate_urls[g]);a.you_tube_url&&e.embeddableYoutubeUrl(a.you_tube_url)&&b.youtube.push(e.embeddableYoutubeUrl(a.you_tube_url));var h=/(\d+)x(\d+)\.\w+$/;angular.forEach(Object.keys(b),function(a){b[a]=b[a].sort(function(a,b){var c=a.match(h)||[0,0],d=b.match(h)||[0,0];return c[1]-d[1]})})}0===b.youtube.length&&(a.url&&!a.you_tube_url&&e.embeddableYoutubeUrl(a.url)&&(a.you_tube_url=e.embeddableYoutubeUrl(a.url)),a.you_tube_url&&e.embeddableYoutubeUrl(a.you_tube_url)&&(b.youtube=[e.embeddableYoutubeUrl(a.you_tube_url)])),a.alternate_urls||angular.forEach(["mp4","webm","m3u8"],function(c){0!==b[c].length||a.url.match(/youtube/)||b[c].push(a.url.replace("mp4",c))});var i=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),j=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if(d.isTouchDevice&&delete b.youtube,c.youtube.disabled&&delete b.youtube,i||delete b.m3u8,j){var k,l="t="+(new Date).getTime();angular.forEach(["mp4","webm"],function(a){if(b[a].length>0)for(var c=0;c<b[a].length;c++)k=b[a][c].match(/\?/)?"&":"?",b[a][c]=b[a][c]+k+l})}return a.urls=b,a};return c.debugInBrowser,f}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$timeout","$interval","$rootScope","$filter","config","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f,g,h){var i={};i.timelineEvents=[],i.markedEvents=[];var j,k,l,m;i.registerVideo=function(b){void 0!==l&&a(function(){i.seek(g.time)}),l=b},i.setSpeed=function(a){m=a,g.timeMultiplier=m,l.setSpeed(a),s()},i.play=function(a){if(g.duration&&!(g.duration<.1)){if(!g.hasBeenPlayed)return g.hasBeenPlayed=!0,void c.$emit("video.firstPlay");if(g.time>g.duration-.1&&(i.seek(.1),i.play()),void 0!==l)g.videoControlsActive=!0,g.show.navPanel=!1,g.timelineState="buffering",l.play().then(function(){g.timelineState="playing",u(),q(),a||h.captureEpisodeActivity("play")});else var b=c.$watch(function(){return void 0!==l},function(a){a&&(b(),i.play())})}},i.pause=function(a){g.videoControlsActive=!0,b.cancel(j),r(),j=void 0,p=void 0,g.timelineState="paused",l&&l.pause(),a||h.captureEpisodeActivity("pause")},i.stall=function(){b.cancel(j),r(),j=void 0,p=void 0,i.wasPlaying="playing"===g.timelineState,g.timelineState="buffering"},i.unstall=function(){i.wasPlaying?(g.timelineState="playing",i.play()):g.timelineState="paused",i.wasPlaying=void 0},i.seek=function(b,c,d){if(!l||0===g.duration)return void a(function(){i.seek(b,c,d)},300);if(!g.isTouchDevice||g.hasBeenPlayed!==!1||"youtube"!==l.videoType){var e=g.time;b=z(b),0>b&&(b=0),b>g.duration&&(b=g.duration);var f="playing"===g.timelineState;if(f&&i.pause(!0),r(),g.time=b,l.seek(b,!0),i.updateEventStates(),c){var j={method:c,seekStart:e};d&&(j.event_id=d),h.captureEpisodeActivity("seek",j)}f&&a(function(){i.play()},350)}},i.prevScene=function(){for(var a=i.markedEvents.length-1;a>=0;a--){var b=g.time;if("playing"===g.timelineState&&(b-=3),i.markedEvents[a].start_time<b){i.seek(i.markedEvents[a].start_time,"prevScene");break}}},i.nextScene=function(){for(var a=!1,b=0;b<i.markedEvents.length;b++)if(i.markedEvents[b].start_time>g.time){i.seek(i.markedEvents[b].start_time,"nextScene"),a=!0;break}a||(i.pause(),i.seek(g.duration-.01,"nextScene"))},i.toggleMute=function(){g.muted=!g.muted,l.toggleMute()},i.setVolume=function(a){g.volume=a,l.setVolume(a)};var n,o=function(){n={lastTimelineTime:0,lastVideoTime:0}};o();var p,q=function(){n.lastTimelineTime=g.time,n.lastVideoTime=g.time,s()},r=function(){a.cancel(k),o()},s=function(b){if(a.cancel(k),"playing"===g.timelineState){for(var c=l.currentTime(),d=g.time,e=0;e<i.timelineEvents.length;e++){var f=i.timelineEvents[e];if(f.t>=n.lastTimelineTime){if(f.t>d)break;if(("pause"!==f.action||!b&&f.t!==n.lastTimelineTime)&&(t(f),"pause"===f.action)){e++;break}}}var h=i.timelineEvents[e];if(n.lastVideoTime=c,n.lastTimelineTime=d,h&&"playing"===g.timelineState){var j=1e3*(i.timelineEvents[e].t-d)/m;k=a(s,j+10)}}},t=function(a){"timeline"===a.id?"pause"===a.action?(g.time=a.t,i.pause()):i.play():"enter"===a.action?(f.events[a.id].state="isCurrent",f.events[a.id].isCurrent=!0):"exit"===a.action?(f.events[a.id].state="isPast",f.events[a.id].isCurrent=!1):"preload"===a.action&&y(f.events[a.id])},u=function(){p=void 0,b.cancel(j),j=b(v,20)},v=function(){var a=new Date,b=isNaN(a-p)?0:a-p,c=parseFloat(g.time)+b/1e3*m;0>c&&(c=0,i.pause()),c>g.duration&&(c=g.duration,i.pause()),g.time=c,p=a};i.init=function(a){i.timelineEvents=[],i.markedEvents=[],m=1,g.duration=0,g.timelineState="paused",i.injectEvents(f.episodeEvents(a),0),b.cancel(j),r()},i.injectEvents=function(a,b){0!==a.length&&(b||(b=0),angular.forEach(a,function(a){a.start_time=+a.start_time,a.end_time=+a.end_time,"Scene"===a._type&&("producer"===g.product?w(a):a.display_title&&w(a)),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,f.events[a._id].start_time=.01),a.stop?(i.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),i.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),i.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(i.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&i.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"})),(a.asset_id||a.annotation_image_id||a.link_image_id)&&i.timelineEvents.push({t:a.start_time<3?0:a.start_time-3,id:a._id,action:"preload"})}),i.sortTimeline())};var w=function(a){for(var b=!1,c=0;c<i.markedEvents.length;c++)i.markedEvents[c]._id===a._id&&(i.markedEvents[c]=angular.copy(a),b=!0);b||i.markedEvents.push(a)};i.removeEvent=function(a){i.timelineEvents=d("filter")(i.timelineEvents,{id:"!"+a}),i.markedEvents=d("filter")(i.markedEvents,{_id:"!"+a}),i.updateEventStates()},i.updateEventTimes=function(a){i.timelineEvents=d("filter")(i.timelineEvents,{id:"!"+a._id}),i.injectEvents([a],0)},i.updateSceneTimes=function(a){angular.forEach(f.episodes[a].scenes,function(a){i.updateEventTimes(a)})},i.sortTimeline=function(){i.timelineEvents=i.timelineEvents.sort(function(a,b){if(a.t===b.t){if(a.action===b.action)return 0;if("enter"===a.action){if("pause"===b.action)return-1;if("exit"===b.action)return 1}return"exit"===a.action?-1:"pause"===a.action?1:0}return a.t-b.t}),i.markedEvents=i.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),i.timelineEvents.length>0&&(g.duration=i.timelineEvents[i.timelineEvents.length-1].t),i.updateEventStates()},i.updateEventStates=function(){var a=g.time;angular.forEach(i.timelineEvents,function(a){if("timeline"!==a.id){var b=f.events[a.id];b&&(b.state="isFuture",b.isCurrent=!1)}}),angular.forEach(i.timelineEvents,function(b){if(b.t<=a){var c=f.events[b.id];c&&("enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1))}})};var x={},y=function(a){a.asset&&"Asset::Image"===a.asset._type&&(x[a.asset.url]||(x[a.asset.url]=new Image,x[a.asset.url].src=a.asset.url))},z=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return e.debugInBrowser,i}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(!e.disableAnalytics&&f.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b,c,d){(d||!e.disableAnalytics&&f.user.track_event_actions)&&g.activityQueue.push({name:a,event_id:b,walltime:new Date,data:c})},g.forceCaptureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c,!0),g.flushActivityQueue()},g.captureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c),g.flushActivityQueue()},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){var b=a.defer();if(0===g.activityQueue.length)return b.resolve(""),b.promise;var c=angular.copy(g.activityQueue);g.activityQueue=[];var d=new Date,e=[],f=[];return angular.forEach(c,function(a){a.age=(d-a.walltime)/1e3,delete a.walltime,a.event_id?f.push(a):e.push(a)}),e=g.dejitter(e),f.length>0?i("event_user_actions",{event_user_actions:f}):e.length>0?i("episode_user_metrics",{episode_user_metrics:e}):void 0},g.dejitter=function(a){if(0===a.length)return[];for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1];"seek"===d.name&&"seek"===e.name&&d.timestamp===e.data.seekStart?e.data.seekStart=d.data.seekStart:b.push(a[c])}return b.push(a[a.length-1]),b};var i=function(c,d){var g=a.defer();return b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/"+c,data:d}).success(function(a){g.resolve(a)}).error(function(){g.reject()}),g.promise};return g}]),angular.module("com.inthetelling.story").factory("youtubeSvc",["$q","$http","$timeout","config",function(a,b,c,d){var e={},f=d.youtube,g=function(d){var e="feeds/api/videos/",g="?v=2&alt=json&callback=JSON_CALLBACK",h=f.domain+e+d+g,i=a.defer(),j=c(function(){i.reject("Timed out")},f.timeout);return b.jsonp(h).success(function(a){c.cancel(j),i.resolve(a)}).error(function(){i.reject()}),i.promise},h=function(a){for(var b=1;b<arguments.length;b++){if(!a.hasOwnProperty(arguments[b]))return!1;a=a[arguments[b]]}return!0};return e.extractYoutubeId=function(a){if(!a)return!1;var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b);return c&&c[1]?c[1]:!1},e.embeddableYoutubeUrl=function(a){var b=e.extractYoutubeId(a);return b?"//www.youtube.com/embed/"+b:!1},e.getVideoData=function(b){var c=a.defer(),d=g(b);return d.then(function(a){var d=0,e="",f="";h(a,"entry","media$group","yt$duration","seconds")&&(d=a.entry.media$group.yt$duration.seconds),h(a,"entry","media$group","media$title","$t")&&(e=a.entry.media$group.media$title.$t),h(a,"entry","media$group","media$description","$t")&&(f=a.entry.media$group.media$description.$t);var g={};g.id=b,g.title=e,g.description=f,g.duration=d,c.resolve(g)},function(a){c.reject(a)}),c.promise},e.getVideoDuration=function(b){var c=a.defer(),d=g(b);return d.then(function(a){var b=0;h(a,"entry","media$group","yt$duration","seconds")&&(b=a.entry.media$group.yt$duration.seconds),c.resolve(b)},function(a){c.reject(a)}),c.promise},e}]),angular.module("com.inthetelling.story").factory("questionAnswersSvc",["$q","analyticsSvc",function(a,b){var c={};return c.saveAnswer=function(a,c,d){return b.forceCaptureEventActivityWithPromise(a,c,d)},c.getAnswers=function(c){var d=a.defer();return b.readEventActivity(c).then(function(a){var b=a.filter(function(a){return"question-answered"===a.name||"question-answered-updated"===a.name});d.resolve(b)}),d.promise},c.getUserAnswer=function(b,d){var e=a.defer();return c.getAnswers(b).then(function(a){if(!a)return e.reject();var b=a.filter(function(a){return a.user_id===d});b.length>0?e.resolve(b[0]):e.reject()}),e.promise},c.calculateCounts=function(a){var b;return angular.forEach(a,function(a){b[a.data.index]++}),b},c.incrementAnswerCount=function(a,b){a[b]=(a[b]||0)+1},c}]),angular.module("com.inthetelling.story").factory("recursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("com.inthetelling.story").factory("mockSvc",["modelSvc",function(a){var b={};return b.keepJsLintHappy=function(){var b=a.episodes.noop;b=void 0},b.mockEpisode=function(b){a.cache("episode",{_id:b,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en","default":!0}],status:"Published",templateUrl:"templates/episode/gwsb.html",styles:["","",""]}),a.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var c={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:b,cur_episode_id:b,layouts:["",""],styles:["transitionSlideL"]},d=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/1col.html"],e=0;10>e;e++){var f=angular.copy(c);f._id="scene-"+e,f.title=e/2===Math.floor(e/2)?{en:"Scene "+(e+1)+" Title"}:{en:""},f.start_time=20*e,f.end_time=20*e+20,f.templateUrl=d[e%d.length],a.cache("event",f)}var g={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:b,cur_episode_id:b,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},h=["sidebarL","sidebarR","inline"],i=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(e=0;30>e;e++){var j=angular.copy(g);j._id="transcript-"+e,j.annotation={en:"Transcript block number "+(e+1)},j.start_time=5*e,j.end_time=5*e+5,j.layouts=[h[e%h.length]]}for(e=0;10>e;e++){var k=angular.copy(g);k._id="annotation-"+e,k.start_time=6*e,k.end_time=6*e+3,k.templateUrl=i[e%i.length],a.cache("event",k)}for(e=0;10>e;e++){var l=angular.copy(g);l._id="longtext-"+e,l.start_time=7*e,l.end_time=7*e+7,l.styles=["timestampNone"],l.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},l.templateUrl="templates/item/text-transmedia.html",a.cache("event",l)}a.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),a.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),a.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),a.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var m={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/link-withimage.html",layouts:["inline"],styles:["timestampNone"],isContent:!0};for(e=0;30>e;e++){var n=angular.copy(m);n._id="link-"+e,n.required=Math.random()>.5,n.start_time=3*e,n.end_time=3*e+3,n.layouts=[h[e%h.length]],a.cache("event",n)}var o={_id:"",_type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],title:{},data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",correct:!0,index:3},{text:"",index:4}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(e=0;10>e;e++){var p=angular.copy(o);p._id="question-"+e,p.required=Math.random()>.5,p.start_time=5*e,p.end_time=5*e+5,p.layouts=[h[e%h.length]],a.cache("event",p)}var q={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",index:3},{text:"",index:4}],_type:"question"}}};for(e=0;10>e;e++){var r=angular.copy(q);r._id="question-"+e,r.required=Math.random()>.5,r.start_time=6*e,r.end_time=6*e+6,r.layouts=[h[e%h.length]],a.cache("event",r)}var s={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(e=0;30>e;e++){var t=angular.copy(s);t._id="upload-"+e,t.asset_id="asset2",t.title={en:"Upload number "+(e%3+1)},t.start_time=4*e,t.end_time=4*e+4,t.layouts=[h[e%h.length]],a.cache("event",t)}var u=["mainFg","altFg","videoOverlay"];for(e=0;8>e;e++){var v=angular.copy(s);v.layouts=[u[e%u.length]],v._id="filltest-"+e,v.asset_id="asset2",v.start_time=2*e,v.end_time=2*e+2,v.templateUrl="templates/item/image-fill.html",v.styles.push("cover"),a.cache("event",v)}a.resolveEpisodeEvents(b),a.resolveEpisodeAssets(b)},b}]),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type||a.templateUrl.match(/transmedia/)||b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){("Annotation"!==a._type||a.templateUrl.match(/transmedia/))&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("reviewMode",["appState",function(a){return function(b){var c=[],d="producer"===a.product;return angular.forEach(b,function(a){(d||!a.cosmetic&&(a.isContent||a.layouts.indexOf("windowFg")>-1))&&c.push(a)}),c}}]).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2);

}}).filter("asBytes",function(){return function(a){if(!a)return"";var b=Math.floor(a/1024);if(1024>b)return b+"Kb";var c=Math.floor(b/10.24)/100;return c+"Mb"}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}).filter("alpha",function(){return function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[a%26]}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","$http","config","errorSvc","appState","authSvc",function(a,b,c,d,e,f){a.errorSvc=d,a.logout=f.logout,a.user=e.user,a.dismiss=function(a){for(var b=0;b<d.errors.length;b++)d.errors[b]===a&&(d.errors.splice(b,1),b=d.errors.length);for(b=0;b<d.notifications.length;b++)d.notifications[b]===a&&(d.notifications.splice(b,1),b=d.notifications.length)}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.changeSpeed=function(a){var c=d.timeMultiplier+a;.5>c&&(c=.5),c>2&&(c=2),b.setSpeed(c)},a.resetSpeed=function(){b.setSpeed(1)},a.markerPercent=function(a){return void 0===a?0:a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["config","$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.viewMode=function(a){h.viewMode=a,l.captureEpisodeActivity("modeChange",{mode:a}),h.producerEditLayer=0,"review"===a?(f(function(){d.$emit("magnet.jumpToMagnet")},1),h.autoscroll=!0,h.autoscrollBlocked=!1,z(),f(B)):h.autoscroll=!1,f(function(){$(window).trigger("resize")})},e.viewMode&&f(function(){b.viewMode(e.viewMode)}),e.t&&k.seek(e.t,"URLParameter"),b.changeProducerEditLayer=function(a){h.producerEditLayer=h.producerEditLayer+a,2===h.producerEditLayer&&(h.producerEditLayer=1),-2===h.producerEditLayer&&(h.producerEditLayer=-1)},b.toggleProducerPreview=function(){h.product="producer"===h.product?"player":"producer"},m.init(),e.epId?(h.init(),h.episodeId=e.epId):b.narrativeId=e.narrativeId,h.isFramed&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)<151&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:"650px"}),"*"),b.loading=!0,j.addLandingScreen(h.episodeId);var o=d.$on("dataSvc.getEpisode.done",function(){h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,j.setLanguageStrings(),document.title=j.episodes[h.episodeId].display_title;var a=b.$watch(function(){return j.assets[j.episodes[h.episodeId].master_asset_id]},function(c){c&&Object.keys(c).length>1&&(a(),j.addEndingScreen(h.episodeId),k.init(h.episodeId),b.loading=!1)})});if(i.getEpisode(h.episodeId,h.episodeSegmentId),"producer"===h.productLoadedAs)var p=b.$watch(function(){return h.user},function(a){Object.keys(a).length&&(p(),n.userHasRole("admin")||(h.product="player",h.productLoadedAs="player"))});b.appState=h,b.show=h.show,b.now=new Date,b.apiDataBaseUrl=a.apiDataBaseUrl,h.videoControlsActive=!1;var q,r,s=b.$watch(function(){return h.videoControlsActive},function(a){a&&(f.cancel(q),q=f(function(){r||(h.videoControlsActive=!1)},5e3))});b.showControls=function(){f.cancel(q),h.videoControlsActive=!0,h.isTouchDevice&&b.allowControlsExit()},b.allowControlsExit=function(){f.cancel(q),q=f(function(){h.videoControlsLocked||(h.videoControlsActive=!1)},5e3)},b.toggleSearchPanel=function(){h.show.searchPanel=!h.show.searchPanel},b.toggleNavPanel=function(){k.pause(),h.show.navPanel=!h.show.navPanel},b.seek=function(a){k.seek(a,"sceneMenu"),h.show.navPanel=!1},b.pause=function(){k.pause()};var t=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(u){t=!1}t&&localStorage.removeItem("iCanHazStorage");var v=d.$on("video.firstPlay",function(){t&&!localStorage.getItem("noMoreHelp")?h.show.helpPanel=!0:k.play()});b.hidePanels=function(){h.show.searchPanel=!1,h.show.helpPanel=!1,h.show.navPanel=!1,h.show.profilePanel=!1,h.itemDetail=!1,d.$emit("player.dismissAllPanels")},b.noMoreHelp=function(){h.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),k.play()},b.play=function(){k.play()},b["continue"]=function(){j.episodes[h.episodeId].masterAsset.duration-h.time<.2?(k.pause(),k.seek(j.episodes[h.episodeId].masterAsset.duration-.01)):k.play()},b.userHasRole=function(a){return n.userHasRole(a)},b.logout=function(){return n.logout()};var w=$(window),x=$("html,body"),y=!1,z=function(){y||(y=g(B,400),w.bind("scroll",function(){x.stop(),A(),h.autoscrollBlocked=!0}))},A=function(){w.unbind("scroll"),g.cancel(y),y=!1};b.enableAutoscroll=function(){h.autoscrollBlocked&&(h.autoscrollBlocked=!1,z())};var B=function(){if(!h.autoscrollBlocked&&h.autoscroll){var a=1/0,b=w.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),a!==1/0){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(A(),x.animate({scrollTop:a-c},1500),f(function(){z()},1750))}}};z();var C=d.$on("userKeypress.ESC",b.hidePanels);b.$on("$destroy",function(){s(),o(),v(),C()})}]),angular.module("com.inthetelling.story").controller("EpisodeController",function(){}),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){delete a.mainContentHasLeftSidebar,delete a.mainContentHasRightSidebar,delete a.mainContentHasBothSidebars,delete a.altContentHasLeftSidebar,delete a.altContentHasRightSidebar,delete a.altContentHasBothSidebars,a.showCurrent=$.inArray("showCurrent",a.scene.layouts)>-1,a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)};var c={ENTER:13,SPACE:32};a.seekOnKeyPress=function(b,d){var e=d,f=!0;switch(e.keyCode){case c.ENTER:a.seek(b),f=!1;break;case c.SPACE:a.seek(b),f=!1;break;default:f=!0}f||(d.stopPropagation(),d.preventDefault())}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$timeout","$interval","$window","$document","appState","timelineSvc","analyticsSvc",function(a,b,c,d,e,f,g,h,i){var j=document.createElement("script");j.src="//www.youtube.com/iframe_api",angular.element(f[0].head).append(j),e.onYouTubeIframeAPIReady=function(){g.youtubeIsReady=!0},b.initVideo=function(a){if(b.video.curStream=g.isTouchDevice?0:1,b.video.urls.youtube&&b.video.urls.youtube.length)if(b.videoType="youtube",g.videoType=b.videoType,b.videoNode=a.find("iframe")[0],g.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return g.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",g.videoType=b.videoType,b.videoNode=a.find("video")[0],b.initHTML5Video()},b.initYoutube=function(){var a=["ended","playing","paused","buffering","???","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){c.data<0||(g.isTouchDevice&&g.hasBeenPlayed===!1?(b.YTPlayer.pauseVideo(),h.play()):(b.playerState=a[c.data],"buffering"===b.playerState&&b.stall()))}}});var c=b.$watch(function(){return void 0!==b.YTPlayer.playVideo},function(a){a&&(c(),b.getBufferPercent=function(){return g.bufferedPercent=100*b.YTPlayer.getVideoLoadedFraction(),g.bufferedPercent},h.registerVideo(b))});b.babysitYoutubeVideo=function(){b.babysitter=d(function(){"paused"===g.timelineState&&"playing"===b.playerState&&b.pause(),"playing"===g.timelineState&&"playing"!==b.playerState&&b.YTPlayer.playVideo(),"buffering"===g.timelineState&&"buffering"===b.playerState&&h.unstall()},333)},b.babysitYoutubeVideo(),b.stall=function(){if("playing"===g.timelineState){b.intentionalStall||i.captureEpisodeActivity("stall"),h.stall();var a=b.$watch(function(){return b.playerState},function(b){"buffering"!==b&&(a(),h.unstall())})}}},b.initHTML5Video=function(){b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),b.changeVideoBandwidth=function(){var a=b.currentTime();b.videoNode.pause(),b.video.curStream=0,i.captureEpisodeActivity("lowBandwidth"),c(function(){b.videoNode.load(),b.seek(a),b.videoNode.play()})},b.babysitHTML5Video=function(){k=0,b.babysitter=d(function(){"playing"===g.timelineState?(b.lastPlayheadTime===b.currentTime()&&(b.intentionalStall||i.captureEpisodeActivity("stall"),h.stall(),b.intentionalStall||2!==k++||b.changeVideoBandwidth()),b.lastPlayheadTime=b.currentTime()):"buffering"===g.timelineState&&b.lastPlayheadTime!==b.currentTime()&&(g.timelineState="playing",h.unstall())},333)},b.babysitHTML5Video(),b.getBufferPercent=function(){if(b.videoNode.buffered.length>0){var a=b.videoNode.buffered.start(b.videoNode.buffered.length-1),c=b.videoNode.buffered.end(b.videoNode.buffered.length-1);return 0>c&&(c-=a,a=0),g.bufferedPercent=c/g.duration*100,g.bufferedPercent}return 0},h.registerVideo(b)};var k=0;b.intentionalStall=!1,b.$on("$destroy",function(){d.cancel(b.babysitter),c.cancel(b.stallGracePeriod),delete b.videoNode}),b.play=function(){var c=a.defer();"youtube"===b.videoType?b.YTPlayer.playVideo():b.videoNode.play();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise},b.pause=function(){if("youtube"===b.videoType)b.YTPlayer.seekTo(g.time,!0),b.YTPlayer.pauseVideo();else{b.videoNode.pause();try{b.videoNode.currentTime=g.time}catch(a){}}},b.seek=function(d,e,f){f=f||a.defer();var h=!1;e&&(b.intentionalStall=!0,b.stallGracePeriod=c(function(){b.intentionalStall=!1},1500));try{if("youtube"===b.videoType){var i="playing"===g.timelineState;b.YTPlayer.pauseVideo(),b.YTPlayer.seekTo(d,!0),b.YTPlayer.pauseVideo(),i&&b.YTPlayer.playVideo(),f.resolve()}else b.videoNode.readyState>1?(b.videoNode.currentTime=d,f.resolve()):(b.intentionalStall=!1,c.cancel(b.stallGracePeriod),h=!0)}catch(j){b.intentionalStall=!1,c.cancel(b.stallGracePeriod),h=!0}return h&&c(function(){b.seek(d,e,f)},100),f.promise},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.setSortBy=function(b){a.sortBy=b},a.toggleSortBy=function(b){a.sortBy=c(b)},a.getToggledValue=function(a){return c(a)};var c=function(a){return"startTime"===a?"type":"startTime"};a.getFriendlySortText=function(a){return"startTime"===a?"time":"type"},a.seek=function(c,d){a.enableAutoscroll(),b.seek(c,"clickedOnEventInSearch",d)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){"Scene"!==a._type&&(a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator),a.sxs&&(a.cosmetic=!1))})}}]),angular.module("com.inthetelling.story").controller("EditController",["$scope","$rootScope","$timeout","appState","dataSvc","modelSvc","timelineSvc",function(a,b,c,d,e,f,g){a.uneditedScene=angular.copy(a.item),a.chooseAsset=function(){a.showAssetPicker=!0,a.w1=b.$on("UserSelectedAsset",function(b,c){a.selectedAsset(c)}),a.w2=b.$on("userKeypress.ESC",a.endChooseAsset)},a.selectedAsset=function(b){var d=f.assets[b];if(a.item&&(a.item.asset=d,"Upload"===a.item._type||"Plugin"===a.item._type?a.item.asset_id=b:"Link"===a.item._type?a.item.link_image_id=b:"Annotation"===a.item._type&&(a.item.annotation_image_id=b)),a.episode&&"Asset::Video"===d._type){a.masterAsset=d;var e=f.assets[a.episode.master_asset_id];c(function(){a.checkAndConfirmDuration(e,d,function(c){c&&(a.episode.master_asset_id=b)})},0)}a.endChooseAsset()},a.toggleUpload=function(){a.showUpload=!a.showUpload},a.endChooseAsset=function(){a.w1(),a.w2(),a.showAssetPicker=!1},a.addDistractor=function(){a.item.data._plugin.distractors.push({text:"",index:a.item.data._plugin.distractors.length+1})};var h=function(a){return"Scene"===a.Type?!0:"Scene"===a._type?!0:!1},i=function(a){var b=!1;for(var c in f.events)if(f.events.hasOwnProperty(c)&&h(f.events[c])&&f.events[c].start_time===a){b=!0;break}return b};a.addEvent=function(b){if("scene"===b&&i(d.time))return a.editCurrentScene();var c=C(b);c.cur_episode_id=d.episodeId,c.episode_id=d.episodeId,f.cache("event",c),d.editEvent=f.events["internal:editing"],d.videoControlsActive=!0,d.videoControlsLocked=!0,f.resolveEpisodeEvents(d.episodeId),g.injectEvents([f.events["internal:editing"]]),"scene"===b&&g.updateSceneTimes(d.episodeId)};var j=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1},k=function(){var a=f.episodes[d.episodeId],b=angular.copy(a.items);return b.filter(j)},l=function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=d;break}return c},m=function(a,b){a=a.sort(A);var c=l(a,b),d=[];return 0===c?d:(c<a.length-1&&c>=1&&(s(a[c-1])||d.push(a[c-1])),d)},n=function(a,b){a=a.sort(A);var c=l(a,b),d=[];return 0===c?c<a.length-1&&(s(a[c+1])||d.push(a[c+1])):c<a.length-1&&(s(a[c+1])||d.push(a[c+1]),c>=1&&(s(a[c-1])||d.push(a[c-1]))),d},o=function(a,b,c){if(j(a)){var d=[],f=k();switch(b){case"create":d=n(f,a);break;case"delete":d=m(f,a);break;case"update":c&&o(c,"delete"),o(a,"create")}angular.forEach(d,function(a){e.storeItem(a).then(function(){},function(){})})}};a.saveEvent=function(){var a=angular.copy(d.editEvent);if(a.cur_episode_id=d.episodeId,"Scene"===a._type){var b=B(a);angular.forEach(b,function(a){e.storeItem(a).then(function(){},function(){})})}e.storeItem(a).then(function(a){a.cur_episode_id=d.episodeId,"internal:editing"===d.editEvent._id?(g.removeEvent("internal:editing"),delete f.events["internal:editing"],f.cache("event",e.resolveIDs(a)),f.resolveEpisodeEvents(d.episodeId),g.injectEvents([f.events[a._id]]),o(a,"create")):(f.resolveEpisodeEvents(d.episodeId),g.injectEvents([f.events[a._id]]),o(a,"update")),d.editEvent=!1},function(){})};var p=function(){var a=f.episodes[d.episodeId];return a.scenes},q=function(){var a=f.episodes[d.episodeId];return a.items},r=function(a){return!s(a)},s=function(a){return a._id&&a._id.match(/internal/)?!0:!1},t=function(){var a=p();return void 0===a||a.length<1?[]:a.filter(r)};a.checkIfTimesAfter=function(a,b){for(var c=0,d=a.length;d>c;c++)if(!s(a[c])&&(b<a[c].start_time||b<a[c].end_time))return!0;return!1},a.getItemsAfter=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)s(a[d])||(b<a[d].start_time||b<a[d].end_time)&&c.push(a[d]);return c},a.willCauseOrphanedData=function(b){var c=p(),d=q(),e=!1;return e=a.checkIfTimesAfter(c,b),e?!0:a.checkIfTimesAfter(d,b)},a.confirmDurationImpact=function(a,b,c){var d=function(){};c=c||d;var e=a-b,f=Math.floor(e/60),g=e%60,h=""+g;1===h.length&&(h="0"+h),c(window.confirm("Warning: Your new video is "+f+":"+h+" shorter than the current video and we've detected that some events will be impacted. These events will have their start and end times adjusted to the new episode end.  Are you sure you wish to continue?")?!0:!1)},a.checkAndConfirmDuration=function(b,c,d){var e=!1,f=0,g=0;return f=parseInt(c.duration,10),void 0!==b&&(g=parseInt(b.duration,10),g>f&&(e=a.willCauseOrphanedData(c.duration))),e?a.confirmDurationImpact(g,f,d):d(!0)},a.setStartAndEndTimes=function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].start_time=b,a[c].end_time=b},a.getEndingSceneId=function(a){return"internal:endingscreen:"+a},a.removeEndingScene=function(){var b=a.getEndingSceneId(d.episodeId);g.removeEvent(b)},a.adjustEndingScene=function(){a.removeEndingScene(),f.addEndingScreen(d.episodeId)},a.moveEventsAfter=function(b){var c=p(),f=q(),h=a.getItemsAfter(c,b),i=a.getItemsAfter(f,b);a.setStartAndEndTimes(h,b),a.setStartAndEndTimes(i,b),angular.forEach(h,function(a){g.removeEvent(a._id),e.storeItem(a)}),angular.forEach(i,function(a){g.removeEvent(a._id),e.storeItem(a)}),g.injectEvents(h),g.injectEvents(i),a.adjustEndingScene(),g.updateSceneTimes(d.episodeId)};var u=function(b,c){var h=f.assets[b.master_asset_id].duration,i=t();return a.adjustEndingScene(),0===i.length?c():1!==i.length?c():void(i[0].end_time!==h&&(i[0].end_time=h,e.storeItem(i[0]).then(function(a){return a.episode_id=d.episodeId,a.cur_episode_id=d.episodeId,f.events[a._id]=a,f.resolveEpisodeEvents(d.episodeId),g.removeEvent(a._id),g.injectEvents([a]),c()},function(){return c()})))};a.saveEpisode=function(){var b=angular.copy(d.editEpisode);c(function(){e.storeEpisode(b).then(function(b){if(f.cache("episode",e.resolveIDs(b)),b.master_asset_id){var c=f.assets[b.master_asset_id].duration;d.masterAsset=f.assets[a.episode.master_asset_id],f.episodes[d.episodeId].masterAsset=f.assets[a.episode.master_asset_id],f.episodes[d.episodeId].master_asset_id=b.master_asset_id,u(b,function(){d.duration=c,a.moveEventsAfter(c),f.deriveEpisode(f.episodes[d.episodeId]),f.resolveEpisodeContainers(d.episodeId),f.resolveEpisodeAssets(d.episodeId),d.editEpisode=!1,d.videoControlsLocked=!1})}else f.resolveEpisodeContainers(d.episodeId),f.resolveEpisodeAssets(d.episodeId),d.editEpisode=!1,d.videoControlsLocked=!1},function(){})},0)};var v=function(){return angular.copy(p())},w=function(a,b){for(var c=0;c<a.length;c++){if(void 0===a[c]._id||"internal:editing"===a[c]._id){a.splice(c,1);break}if(b&&a[c]._id===b._id){a[c]=b;break}}return a},x=function(a,b){for(var c=1,d=a.length;d>c;c++)c===d-1?a[c].end_time=b:a[c].end_time!==a[c+1].start_time&&(a[c].end_time=a[c+1].start_time)},y=function(a,b){for(var c=!1,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=!0;break}c||a.push(b)},z=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]._id===b){a.splice(c,1);break}},A=function(a,b){return a.start_time-b.start_time},B=function(b,c){var e=d.duration,f=v(),g=[];c?y(f,a.uneditedScene):w(f,a.uneditedScene),f=f.sort(A),x(f,e),z(f,b._id),c||f.push(b),f=f.sort(A);for(var h=1,i=f.length;i>h;h++)h===i-1?f[h].end_time!==e&&(f[h].end_time=e,g.push(f[h])):f[h].end_time!==f[h+1].start_time&&(f[h].end_time=f[h+1].start_time,g.push(f[h]));return g};a.editCurrentScene=function(){angular.forEach(p(),function(a){a.isCurrent&&(d.editEvent=f.events[a._id],d.editEvent.cur_episode_id=d.episodeId,d.editEvent.episode_id=d.episodeId,d.editEvent.producerItemType="scene",d.videoControlsActive=!0,d.videoControlsLocked=!0)})},a.editEpisode=function(){d.editEpisode=f.episodes[d.episodeId],d.videoControlsActive=!0,d.videoControlsLocked=!0},a.deleteEvent=function(a){if(window.confirm("Are you sure you wish to delete this item?")){var b={};b._id=a;var c=B(b,!0);angular.forEach(c,function(a){e.storeItem(a).then(function(){},function(){})});var h=f.events[a]._type;e.deleteItem(a).then(function(){"sxs"===d.product&&f.events[a].asset&&e.deleteAsset(f.events[a].asset._id),g.removeEvent(a),delete f.events[a],f.resolveEpisodeEvents(d.episodeId),"Scene"===h&&g.updateSceneTimes(d.episodeId),o(b,"delete"),d.editEvent=!1,d.videoControlsLocked=!1},function(){})}},a.cancelEventEdit=function(a){"internal:editing"===d.editEvent._id?(delete f.events["internal:editing"],g.removeEvent("internal:editing")):f.events[d.editEvent._id]=a,f.resolveEpisodeEvents(a.episode_id),"Scene"===a._type?g.updateSceneTimes(a.episode_id):g.updateEventTimes(a),d.editEvent=!1,d.videoControlsLocked=!1},a.cancelEpisodeEdit=function(a){f.episodes[d.episodeId]=a,f.deriveEpisode(f.episodes[a._id]),f.resolveEpisodeContainers(a._id),f.resolveEpisodeEvents(a._id),d.editEpisode=!1,d.videoControlsLocked=!1};var C=function(a){var b={_id:"internal:editing",start_time:d.time,episode_id:d.episodeId,isCurrent:!0,producerItemType:a,layouts:["inline"],styles:[]},c={};if("scene"===a&&(c={_type:"Scene",title:{},description:{}}),"video"===a&&(c={_type:"Link",link_image_id:"",url:"",title:{},description:{}}),("comment"===a||"transcript"===a||"annotation"===a)&&(c={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:""}),("file"===a||"image"===a)&&(c={_type:"Upload",asset_id:"",title:{},description:{}}),"link"===a&&(c={_type:"Link",link_image_id:"",url:"https://",title:{},description:{}}),"question"===a&&(c={_type:"Plugin",title:{},data:{_pluginType:"question",_version:2,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{index:1,text:""},{index:2,text:""},{index:3,text:""},{index:4,text:""}],correctfeedback:"",incorrectfeedback:""}}},c.plugin=c.data._plugin),"sxs"===d.product)c.sxs=!0,c.annotator={en:d.user.name},c.layouts=["windowFg"],c.end_time=d.time,c.stop=!0,c.templateUrl="templates/item/sxs-"+a+".html";else{var e={scene:"templates/scene/1col.html",transcript:"templates/item/transcript.html",annotation:"templates/item/pullquote-noattrib.html",link:"templates/item/link.html",image:"templates/item/image-plain.html",file:"templates/item/link.html",question:"templates/item/question-mc.html",video:"TODO:VIDEO"};c.templateUrl=e[a]}return angular.extend(b,c),b};a.generateEmptyItem=C}]),angular.module("com.inthetelling.story").controller("EventTestController",["$scope","$routeParams","mockSvc","modelSvc","appState",function(a,b,c,d,e){c.mockEpisode("ep1"),e.episodeId="ep1",e.product="producer",e.lang="en",a.item=d.events[b.eventId]}]),angular.module("com.inthetelling.story").directive("ittLogin",["$location","$routeParams","config","authSvc","appState","errorSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!1,link:function(g){g.userHasRole=d.userHasRole,g.appState=e,g.loginForm={auth_key:"",password:""},g.apiDataBaseUrl=c.apiDataBaseUrl,d.authenticate().then(function(){if(f.init(),b.key&&a.search("key",null),b.episode){var c=b.episode;a.search("episode",null),a.search("nonce",null),a.path("/episode/"+c)}else if(b.narrative){var d=b.narrative;if(a.search("narrative",null),a.search("nonce",null),b.timeline){var e=b.timeline;a.search("timeline",null),a.path("/story/"+d+"/"+e)}else a.path("/story/"+d)}else 0===Object.keys(b).length&&a.path("/user")},function(){}),g.adminLogin=function(){d.adminLogin(g.loginForm.auth_key,g.loginForm.password).then(function(){},function(){g.badlogin=!0})},g.logout=function(){d.logout()}}}}]),angular.module("com.inthetelling.story").directive("autofocus",["$timeout",function(a){return{link:function(b,c){a(function(){"TEXTAREA"===c[0].tagName||"INPUT"===c[0].tagName?c[0].focus():c.find("input,textarea")[0].focus()})}}}]),angular.module("com.inthetelling.story").directive("ittMcQuestion",["questionAnswersSvc","analyticsSvc",function(a,b){return{restrict:"E",replace:!1,scope:{plugin:"=data",qid:"=",choices:"=",correct:"=",onChoice:"=",questionType:"@",showChart:"="},templateUrl:"templates/item/question-mc-inner.html",link:function(c){c.scoreQuiz=function(a){c.plugin.distractors[a].selected=!0,c.plugin.hasBeenAnswered=!0,c.plugin.selectedDistractor=c.plugin.distractors[a].index,b.captureEventActivity("question-answered",c.qid,{answer:c.plugin.distractors[a].text,index:c.plugin.distractors[a].index,correct:!!c.plugin.distractors[a].correct})},c.feedback=function(){for(var a=0;a<c.plugin.distractors.length;a++)if(c.plugin.distractors[a].index===c.plugin.selectedDistractor)return c.plugin.distractors[a].correct?c.plugin.correctfeedback:c.plugin.incorrectfeedback},c.questionType=c.plugin.questiontype,c.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.7}}}},legend:{show:!1},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}};var d=function(a){var b=[];for(var d in a)a.hasOwnProperty(d)&&angular.forEach(c.plugin.distractors,function(c){c.index+""==d+""&&b.push({data:a[d],label:c.text})});return b};if(c.plugin.hasBeenAnswered===!0){void 0===c.plugin.answer_counts&&(c.plugin.answer_counts={});var e=c.plugin.answer_counts,f=d(e);c.chartData=f}c.scorePoll=function(b){a.saveAnswer("question-answered",c.qid,{answer:c.plugin.distractors[b].text,index:c.plugin.distractors[b].index,correct:!!c.plugin.distractors[b].correct}).then(function(){c.plugin.answer_counts=void 0===c.plugin.answer_counts?{}:c.plugin.answer_counts,a.incrementAnswerCount(c.plugin.answer_counts,c.plugin.distractors[b].index);var e=c.plugin.answer_counts,f=d(e);c.chartData=f,c.plugin.distractors[b].selected=!0,c.plugin.hasBeenAnswered=!0,c.plugin.selectedDistractor=c.plugin.distractors[b].index})}}}}]),angular.module("com.inthetelling.story").directive("ittFlotr2Chart",function(){var a=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:' <div class="chartContainer" id="chartContainer" aria-label="{{chartLabel}}"></div>',link:function(b,c,d){var e,f=function(a,c,d){c=JSON.parse(c),d=JSON.parse(d),b.chartLabel=i(c),d.series.pie.label.formatter=function(a,b){return'<div style="font-size:8pt;text-align:center;padding:2px;color:black;">'+a+"<br/>"+Math.round(b.percent)+"% ("+b.data[0][1]+")</div>"},$.plot(a,c,d),a.show()};e=$("#chartContainer");var g="chartContainer"+a++;e.attr("id",g),b.$watch(function(){return e.width()},function(a){a>0&&(e.css({height:a}),f(e,b.data,b.options),d.$observe("data",function(a){b.data=a,f(e,b.data,b.options)}))});var h=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].data;for(var d=0;d<a.length;d++)a[d].percent=a[d].data/b*100;return a},i=function(a){var b="";a=h(a);for(var c=0;c<a.length;c++)b+=Math.round(a[c].percent)+"% of users totaling "+a[c].data+" choose '"+a[c].label+"'. ";return b}}}}),angular.module("com.inthetelling.story").directive("ittTimeline",["$rootScope","$timeout","appState","timelineSvc","modelSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(a,f){function g(a){return a>98?100:a}function h(a){return 3>a?0:a}function i(b){var c=a.currentVolume()+b;c=g(c),"function"==typeof a.setVolume&&a.setVolume(c)}function j(b){var c=a.currentVolume()-b;c=h(c),"function"==typeof a.setVolume&&a.setVolume(c)}a.appState=c,a.timeline=d,a.handlePosition=0,a.zoomLevel=1,a.zoomOffset=0,c.isTouchDevice&&!c.hasBeenPlayed&&(a.isSuppressed=!0);var k=a.$watch(function(){return c.hasBeenPlayed},function(b){b===!0&&(a.isSuppressed=!1,k())}),l=f.find(".progressbarContainer"),m=f.find(".progressbar");a.autoZoom=function(b){a.savedZoomLevel=a.zoomLevel;var d=b.end_time-b.start_time,e=c.duration-b.end_time;a.zoomLevel=Math.min(Math.max(Math.round(.6*e/d),1),20),p()},a.endAutoZoom=function(){a.savedZoomLevel&&(a.zoomLevel=a.savedZoomLevel,p(),delete a.savedZoomLevel)};var n=a.$watch(function(){return c.editEvent},function(b){b?a.autoZoom(b):a.endAutoZoom()});a.appState=c,a.setNewLanguage=function(){e.setLanguageStrings()},a.showSceneMenuTooltip=function(b){a.sceneMenuToolTip=b&&!c.isTouchDevice?!0:!1},a.prevScene=function(){d.prevScene()},a.nextScene=function(){d.nextScene()},a.userChangingVolume=function(b){c.muted&&a.toggleMute();var d=angular.element(b.currentTarget),e=function(b,c){var e=(b.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),c?a.setVolume(e):a.$apply(a.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})};var o={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};a.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case o.LEFTARROW:j(1),c=!1;break;case o.RIGHTARROW:i(1),c=!1;break;case o.UPARROW:i(1),c=!1;break;case o.DOWNARROW:j(1),c=!1;break;case o.PAGEUP:i(10),c=!1;break;case o.PAGEDOWN:j(10),c=!1;break;case o.HOME:j(100),c=!1;break;case o.END:i(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},a.currentVolume=function(){return c.muted?0:c.volume},a.audioIcon=function(){return c.muted?"muted":"vol"+Math.floor(c.volume/34)},a.showTooltip=function(a){a.showTooltip=!0},a.hideTooltip=function(a){a.showTooltip=!1},a.zoomIn=function(){a.stopWatching=!0,a.zoomLevel=a.zoomLevel+1,p()},a.zoomOut=function(){a.stopWatching=!0,a.zoomLevel=a.zoomLevel<=2?1:a.zoomLevel<=3?1.5:a.zoomLevel/2,p()};var p=function(){a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),l.stop().animate({left:100*a.zoomOffset+"%",width:100*a.zoomLevel+"%"},1e3,function(){a.stopWatching=!1})};a.$watch(function(){return{t:c.time,d:c.duration}},function(){a.stopWatching||(a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),l.css({left:100*a.zoomOffset+"%"}))},!0);var q=function(d){b(function(){a.seekHandleVisible=!0},250),a.isSeeking=!0;var e=c.isTouchDevice?"touchend.timeline":"mouseup.timeline";m.bind(e,function(){s()}),angular.element(document).bind(e,function(){t()}),r(d)};a.$watch(function(){return c.time},function(){c.editEvent&&(a.willSeekTo=c.time)});var r=function(b){a.isSeeking&&(a.willSeekTo=(b.clientX-l.offset().left)/l.width()*c.duration,a.willSeekTo<0&&(a.willSeekTo=0),a.willSeekTo>c.duration&&(a.willSeekTo=c.duration))},s=function(){a.stopWatching=!0,a.enableAutoscroll(),d.seek(a.willSeekTo,"scrubTimeline"),p()},t=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),m.off("mouseup.timeline"),m.off("touchend.timeline"),a.$apply(function(){a.isSeeking=!1,a.seekHandleVisible=!1})},u=function(){var a=$(f.find(".playhead"));c.isTouchDevice?(a.on("touchstart.timeline",function(a){q(a.originalEvent.targetTouches[0]),a.preventDefault()}),a.on("touchmove.timeline",function(a){r(a.originalEvent.targetTouches[0]),a.preventDefault()})):(a.on("mousedown.timeline",function(a){q(a),a.preventDefault()}),a.on("mousemove.timeline",function(a){r(a),a.preventDefault()}))};u(),a.$on("$destroy",function(){t(),n()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["$interval","analyticsSvc","modelSvc","appState",function(a,b,c,d){
return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(e){e.episode=c.episodes[d.episodeId],b.captureEpisodeActivity("episodeLoad");var f=function(){e.episode=c.episodes[d.episodeId]};a(f,457)}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState","modelSvc",function(a,b,c,d){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl"></span>',controller:"SceneController",link:function(a,e){"review"!==c.viewMode&&window.scrollTo(0,0),a.precalculateSceneValues(),a.appState=c,a.scene._id.match(/internal/)&&(a.containers=d.containers,a.crossEpisodePath=c.crossEpisodePath);var f=function(){var b=e.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return e.find(".videoMagnet img").height()},function(a){a>0&&(c(),f())});else{e.find(".matchVideoHeight:visible").each(function(){$(this).css("height",e.find(".videoMagnet img").height())});var d=angular.element(window).height()-$("#CONTAINER").scrollTop();e.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",d-$(this).offset().top)}),e.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",d-$(this).offset().top-210)})}e.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&f()},!0),a.unwatchEdits=a.$watch(function(){return c.editEvent},a.precalculateSceneValues,!0),a.safetyBelt=b(f,1321),a.$on("$destroy",function(){a.unwatch(),a.unwatchEdits(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittShowHideVisualOnly",["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ittShowHideVisualOnly,function(b){b?a.removeClass(c,"visual-hide"):a.addClass(c,"visual-hide")})}}}]),angular.module("com.inthetelling.story").animation(".visual-hide",function(){return{addClass:function(a){a.fadeTo("slow",0,function(){})},removeClass:function(a){a.fadeTo("slow",1,function(){})}}}),angular.module("com.inthetelling.story").directive("ittShowFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.ittShowFocus,function(b){a(function(){b&&c.filter(":visible").first().focus()})},!0)}}]),angular.module("com.inthetelling.story").directive("ittVolumeSlider",["appState",function(a){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(b){function c(a){return a>98?100:a}function d(a){return 3>a?0:a}function e(a){var d=b.currentVolume()+a;d=c(d),"function"==typeof b.setVolume&&b.setVolume(d)}function f(a){var c=b.currentVolume()-a;c=d(c),"function"==typeof b.setVolume&&b.setVolume(c)}b.appState=a,b.userChangingVolume=function(a){var c=angular.element(a.currentTarget),d=function(a,d){var e=(a.clientX-c.offset().left)/c.width()*100;e>98&&(e=100),3>e&&(e=0),d?b.setVolume(e):b.$apply(b.setVolume(e))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var g={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};b.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case g.LEFTARROW:f(1),c=!1;break;case g.RIGHTARROW:e(1),c=!1;break;case g.UPARROW:e(1),c=!1;break;case g.DOWNARROW:f(1),c=!1;break;case g.PAGEUP:e(10),c=!1;break;case g.PAGEDOWN:f(10),c=!1;break;case g.HOME:f(100),c=!1;break;case g.END:e(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},b.currentVolume=function(){return a.muted?0:a.volume}}}}]),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=400>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittReviewMode",["appState","$timeout",function(a,b){return{restrict:"A",replace:!1,scope:{allScenes:"=ittReviewMode"},templateUrl:"templates/episode/components/reviewmode-scenes.html",link:function(c){c.appState=a,c.scenes=[];var d=100,e=0;c.isLoading=!0;var f=[1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1/0];c.addOne=function(){if(e++,c.allScenes)c.scenes=c.allScenes.slice(0,f[e]),e<c.allScenes.length?b(c.addOne,d):(c.isLoading=!1,c.scenes=c.allScenes);else var a=c.$watch(function(){return c.allScenes},function(){c.allScenes&&(a(),c.addOne())})},b(c.addOne,d)}}}]),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","$interval","config","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g,h){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(i,j){i.toggleDetailView=function(){i.item.showInlineDetail?i.item.showInlineDetail=!1:(g.pause(),i.captureInteraction(),j.width()>400?i.item.showInlineDetail=!0:e.itemDetail=i.item)};var k={ENTER:13,SPACE:32};if(i.toggleDetailOnKeyPress=function(a){var b=a,c=!0;switch(b.keyCode){case k.ENTER:i.toggleDetailView(),c=!1;break;case k.SPACE:i.toggleDetailView(),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},i.forceModal=function(){g.pause(),e.itemDetail=i.item},i.outgoingLinkOnKeyPress=function(a,b){var c=b,d=!0;switch(c.keyCode){case k.ENTER:i.outgoingLink(a),d=!1;break;case k.SPACE:i.outgoingLink(a),d=!1;break;default:d=!0}d||(b.stopPropagation(),b.preventDefault())},i.outgoingLink=function(a){g.pause(),i.captureInteraction(),i.item.targetTop?b(function(){window.location.href=a}):window.open(a)},i.editItem=function(){e.editEvent=i.item,e.videoControlsActive=!0,e.videoControlsLocked=!0},i.captureInteraction=function(){f.captureEventActivity("clicked",i.item._id)},"templates/item/link-embed.html"===i.item.templateUrl&&i.captureInteraction(),i.item.asset_id&&!i.item.asset&&(i.item.asset=h.assets[i.item.asset_id]),i.item.styleCss&&i.item.styleCss.match(/fill|contain|cover/)&&(i.item.asset.cssUrl="url('"+i.item.asset.url+"');",i.item.backgroundImageStyle="background-image: url('"+i.item.asset.url+"');"),i.item.data&&(i.plugin=i.item.data._plugin,i.plugin._type=i.item.data._pluginType,"credlyBadge"===i.plugin._type)){f.captureEventActivity("viewed",i.item._id),e.user.roles&&1===e.user.roles.length&&"guest"===e.user.roles[0]?i.plugin.eligibleForBadges=!1:(i.plugin.eligibleForBadges=!0,i.plugin.userEmail=e.user.emails?e.user.emails[0]:"",i.plugin.totalAchieved=0),i.checkBadgeEligibility=function(){i.plugin.eligibleForBadges&&angular.forEach(i.plugin.requirements,function(a){a.achieved||f.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,i.countAchievements()}),i.countAchievements()})},i.countAchievements=function(){var a=0;angular.forEach(i.plugin.requirements,function(b){b.achieved&&(a+=1)}),i.plugin.totalAchieved=a,i.plugin.totalAchieved===i.plugin.requirements.length&&(h.episodes[e.episodeId].styleCss=h.episodes[e.episodeId].styleCss+" uscHackUserHasBadge")},i.checkBadgeEligibility();var l=0;i.badgePoll=c(function(){l++,(i.item.isCurrent||"review"===e.viewMode)&&i.checkBadgeEligibility(),l>60&&c.cancel(i.badgePoll)},1e4),i.$on("$destroy",function(){c.cancel(i.badgePoll)}),i.badger=function(){i.plugin.gettingBadge=!0,a({method:"GET",url:d.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+i.plugin.credlyBadgeId+"&email="+i.plugin.userEmail}).success(function(a){i.checkBadgeEligibility(),"Badge previously sent."===a.status&&(i.plugin.alreadyHadBadge=!0),i.plugin.gotBadge=!0}).error(function(){i.plugin.gettingBadge=!1,i.plugin.error=!0})}}}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",["appState",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeEditor",["$rootScope","appState","modelSvc","dataSvc","awsSvc","youtubeSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,scope:{episode:"=ittEpisodeEditor"},templateUrl:"templates/producer/episode.html",controller:"EditController",link:function(g){g.episodeContainerId=c.episodes[b.episodeId].container_id;var h=c.containers[g.episodeContainerId];if(g.customer=c.customers[h.customer_id],g.episode.master_asset_id&&""!==g.episode.master_asset_id&&(g.masterAsset=c.assets[g.episode.master_asset_id]),g.uploadStatus=[],g.uneditedEpisode=angular.copy(g.episode),g.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:""},g.episode.styles)for(var i in g.itemForm)for(var j=0;j<g.episode.styles.length;j++)g.episode.styles[j].substr(0,i.length)===i&&(g.itemForm[i]=g.episode.styles[j].substr(i.length));g.langForm={};for(var k=0;k<g.episode.languages.length;k++)g.langForm[g.episode.languages[k].code]=!0;g.langForm[g.episode.defaultLanguage]=!0,g.languageWatcher=g.$watch(function(){return[g.langForm,g.episode.defaultLanguage]},function(){var a=0,b="",c=[];for(var d in g.langForm)g.langForm[d]?(a++,b=d,c.push({code:d})):g.episode.defaultLanguage===d&&(g.episode.defaultLanguage=!1);g.languageCount=a,g.episode.defaultLanguage===!1&&(g.episode.defaultLanguage=b),angular.forEach(c,function(a){a.code===g.episode.defaultLanguage&&(a["default"]=!0)}),g.episode.languages=angular.copy(c)},!0),g.watchStyleEdits=g.$watch(function(){return g.itemForm},function(){var a=[];for(var b in g.itemForm)g.itemForm[b]&&a.push(b+g.itemForm[b]);g.episode.styles=a,c.deriveEpisode(g.episode),c.resolveEpisodeEvents(g.episode._id)},!0),g.appState=b,g.watchEdits=g.$watchGroup(["episode.templateUrl","episode.title[appState.lang]","episode.description[appState.lang]","episode.navigation_depth"],function(a,b){if(a[0]!==b[0]){var d=[];if(b[0]){var e=b[0].match("templates/episode/(.*).html")[1];angular.forEach(g.episode.styles,function(a){a.toLowerCase()!=="color"+e&&a.toLowerCase()!=="typography"+e&&d.push(a)})}var f=a[0].match("templates/episode/(.*).html")[1];angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(a){f===a&&(d.push("color"+a[0].toUpperCase()+a.substring(1)),d.push("typography"+a[0].toUpperCase()+a.substring(1)))}),g.episode.styles=angular.copy(d)}c.deriveEpisode(g.episode),c.resolveEpisodeContainers(g.episode._id),c.resolveEpisodeEvents(g.episode._id)}),g.dismissalWatcher=a.$on("player.dismissAllPanels",g.cancelEdit),g.cancelEdit=function(){g.cancelEpisodeEdit(g.uneditedEpisode)},g.detachMasterAsset=function(){g.masterAsset={},b.duration=0,d.detachMasterAsset(g.episode),c.deriveEpisode(g.episode),c.resolveEpisodeContainers(g.episode._id),c.resolveEpisodeAssets(g.episode._id)},g.setMasterAsset=function(a){g.episode.template_id||(g.episode.templateUrl="templates/episode/episode.html"),g.episode.master_asset_id=a._id,g.masterAsset=a,b.duration=c.assets[g.episode.master_asset_id].duration,c.deriveEpisode(g.episode),c.resolveEpisodeContainers(g.episode._id),c.resolveEpisodeAssets(g.episode._id)},g.uploadAsset=function(a){g.uploadStatus[0]={bytesSent:0,bytesTotal:1},g.uploads=e.uploadFiles(g.episodeContainerId,a),g.uploads[0].then(function(a){c.cache("asset",a.file);var b=angular.copy(g.masterAsset);g.checkAndConfirmDuration(b,a.file,function(b){if(b){c.cache("asset",a.file);var d=c.assets[a.file._id];g.setMasterAsset(d)}}),delete g.uploads},function(){},function(a){g.uploadStatus[0]=a})};var l=function(a,b,e){d.createAsset(g.episodeContainerId,e).then(function(a){a.you_tube_url=e.url,a.duration=e.duration,c.cache("asset",a);var b=c.assets[a.file._id];b.you_tube_url=e.url,b.duration=e.duration,g.setMasterAsset(b),c.deriveEpisode(g.episode),c.resolveEpisodeContainers(g.episode._id),c.resolveEpisodeAssets(g.episode._id)},function(){})};g.attachYouTube=function(a){a=f.embeddableYoutubeUrl(a),void 0===g.masterAsset&&(g.masterAsset={},g.masterAsset.urls={}),g.episode.masterAsset=g.masterAsset,c.deriveEpisode(g.episode),c.resolveEpisodeContainers(g.episode._id),c.resolveEpisodeAssets(g.episode._id);var b=f.extractYoutubeId(a);b&&f.getVideoData(b).then(function(b){var c={};c.you_tube_url=c.url=a,c.duration=b.duration,c.name={en:b.title},c.description={en:b.description},c.content_type="video/x-youtube",l(g.episodeContainerId,g.episode._id,c)},function(){var b={};b.you_tube_url=b.url=a,b.duration=0,l(g.episodeContainerId,g.episode._id,b)})},g.deleteAsset=function(){},g.detachAsset=function(){g.detachMasterAsset(),g.showUpload=!1},g.selectText=function(a){a.target.select()},g.$on("$destroy",function(){g.watchEdits(),g.dismissalWatcher(),g.languageWatcher(),g.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittItemEditor",["$rootScope","errorSvc","appState","modelSvc","timelineSvc","awsSvc","dataSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/producer/item.html",controller:"EditController",link:function(h){if(e.pause(),e.seek(h.item.start_time),h.uploadStatus=[],h.uneditedItem=angular.copy(h.item),h.annotators=d.episodes[c.episodeId].annotators,h.episodeContainerId=d.episodes[c.episodeId].container_id,h.languages=d.episodes[c.episodeId].languages,h.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:"",position:"",pin:""},h.item.layouts||(h.item.layouts=["inline"]),h.item.styles){for(var i in h.itemForm)for(var j=0;j<h.item.styles.length;j++)h.item.styles[j].substr(0,i.length)===i&&(h.itemForm[i]=h.item.styles[j].substr(i.length));for(var k=0;k<h.item.styles.length;k++)("contain"===h.item.styles[k]||"cover"===h.item.styles[k]||"center"===h.item.styles[k]||"fill"===h.item.styles[k])&&(h.itemForm.position=h.item.styles[k]),("tl"===h.item.styles[k]||"tr"===h.item.styles[k]||"bl"===h.item.styles[k]||"br"===h.item.styles[k])&&(h.itemForm.pin=h.item.styles[k])}h.item.producerItemType||b.error({data:"Don't have a producerItemType for item "+h.item._id}),h.itemEditor="templates/producer/item/"+c.product+"-"+h.item.producerItemType+".html",h.appState=c,h.watchEdits=h.$watch(function(){return h.item},function(a,b){b&&(a.yturl!==b.yturl&&(h.item.url=q(a.yturl)),a.templateUrl!==b.templateUrl&&("templates/item/image-fill.html"===a.templateUrl&&(h.item.cosmetic=!0,h.item.layouts=["windowBg"],h.itemForm.position="fill"),"templates/item/image-fill.html"===b.templateUrl&&(h.item.cosmetic=!1,h.item.layouts=["inline"],h.itemForm.position="",h.itemForm.pin="")),h.item=d.deriveEvent(a),a.asset?(h.item.asset.cssUrl="url('"+a.asset.url+"');",h.item.backgroundImageStyle="background-image: url('"+a.asset.url+"');"):(delete h.item.asset,delete h.item.backgroundImageStyle),(a.start_time!==b.start_time||a.start_time!==b.end_time)&&d.resolveEpisodeEvents(c.episodeId))},!0),h.watchStyleEdits=h.$watch(function(){return h.itemForm},function(){var a=[];for(var b in h.itemForm)h.itemForm[b]&&a.push("position"===b||"pin"===b?h.itemForm[b]:b+h.itemForm[b]);h.item.styles=a,h.item.asset&&(h.item.asset.cssUrl="url('"+h.item.asset.url+"');",h.item.backgroundImageStyle="background-image: url('"+h.item.asset.url+"');")},!0),h.forcePreview=function(){c.editEvent.fnord=c.editEvent.fnord?"":"fnord"};var l=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1};h.setItemTime=function(){"Scene"===h.item._type?(d.resolveEpisodeEvents(c.episodeId),e.updateSceneTimes(h.item.episode_id)):h.item.stop?(h.item.end_time=h.item.start_time,d.resolveEpisodeEvents(c.episodeId),e.updateEventTimes(h.item)):(d.resolveEpisodeEvents(c.episodeId),(h.item.end_time<=h.item.start_time||h.item.end_time>d.events[h.item.scene_id].end_time)&&(h.item.end_time=d.events[h.item.scene_id].end_time),e.updateEventTimes(h.item))};var m=function(a,b){return a.start_time-b.start_time};h.setItemEndTime=function(){(h.item.end_time<=h.item.start_time||h.item.end_time>d.events[h.item.scene_id].end_time)&&(h.item.end_time=d.events[h.item.scene_id].end_time),e.updateEventTimes(h.item)};var n=function(){var a=d.episodes[c.episodeId],b=angular.copy(a.items);return b.filter(l)},o=function(a,b,c){if(!a)return!1;var d,e=a.end_time;c=c.sort(m);for(var f=0,g=c.length;g>f;f++)if(c[f]._id===b._id){d=c[f+1];break}return d&&d.start_time<a.end_time&&(e=d.start_time),e},p=function(a){return"Scene"===a._type?a:d.events[h.item.scene_id]};h.switchToAutoOrCustom=function(a){if(a){var b=l(h.item)?n():[];h.item.end_time=o(p(h.item),h.item,b),h.customEndTime=!1}else h.customEndTime=!0},h.isAutoEndTime=function(){var a=l(h.item)?n():[],b=o(p(h.item),h.item,a);return h.item.end_time===b?!0:!1},h.customEndTime=!h.isAutoEndTime(),h.dismissalWatcher=a.$on("player.dismissAllPanels",h.cancelEdit),h.cancelEdit=function(){h.cancelEventEdit(h.uneditedItem)};var q=function(a){var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b);return c?"//www.youtube.com/embed/"+c[1]:""};h.uploadAsset=function(a){h.uploadStatus[0]={bytesSent:0,bytesTotal:1},h.uploads=f.uploadFiles(h.episodeContainerId,a),h.uploads[0].then(function(a){d.cache("asset",a.file),h.item.asset=d.assets[a.file._id],"Upload"===h.item._type?h.item.asset_id=a.file._id:"Link"===h.item._type?h.item.link_image_id=a.file._id:"Annotation"===h.item._type&&(h.item.annotation_image_id=a.file._id),delete h.uploads},function(){},function(a){h.uploadStatus[0]=a})},h.deleteAsset=function(a){window.confirm("Are you sure you wish to delete this asset?")&&(delete d.events[h.item._id].asset,delete h.item.asset_id,delete d.events[h.item._id].asset_id,delete h.item.link_image_id,delete d.events[h.item._id].link_image_id,delete h.item.annotation_image_id,delete d.events[h.item._id].annotation_image_id,delete h.item.asset,g.deleteAsset(a))},h.detachAsset=function(a){a&&(delete d.events[h.item._id].asset,delete h.item.asset,h.item.asset_id===a&&delete h.item.asset_id,h.item.link_image_id===a&&delete h.item.link_image_id,h.item.annotation_image_id===a&&delete h.item.annotation_image_id,g.detachEventAsset(angular.copy(h.item),a).then(function(){},function(){}),h.showUpload=!1)},h.$on("$destroy",function(){h.watchEdits(),h.dismissalWatcher(),h.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$interval","$rootScope","appState","timelineSvc",function(a,b,c,d,e){var f=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(g,h){g.appState=d,g.uid=++f,a(function(){if(g.video)g.initVideo(h);else var a=g.$watch(function(){return g.video},function(b){b&&(a(),g.initVideo(h))})}),g.videoClick=function(){"paused"===d.timelineState?e.play():e.pause()},g.spaceWatcher=c.$on("userKeypress.SPACE",g.videoClick),g.bufferInterval=b(function(){if(g.getBufferPercent){var a=g.getBufferPercent();a>98&&(b.cancel(g.bufferInterval),d.bufferedPercent=100)}},200),g.$on("$destroy",function(){g.spaceWatcher(),b.cancel(g.bufferInterval)})}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.ceil(Math.abs(c)>4?e.width()+c/4:d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))})};a.$on("magnet.changeMagnet",function(a,b){g(b)});var i=function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute"),e.offset(d.magnet.offset()),e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))};a.$on("magnet.jumpToMagnet",i),d.$on("$destroy",function(){d.unwatch&&d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope","appState",function(a,b){return{restrict:"A",replace:!0,scope:!0,link:function(c,d){c.changeMagnet=function(c){a.$emit("magnet.changeMagnet",c),(b.isTouchDevice||0===b.time)&&a.$emit("magnet.jumpToMagnet")},c.unwatchVisibility=c.$watch(function(){return d.is(":visible")},function(a){a&&c.changeMagnet(d)}),"watchModeVideoMagnet"===d.attr("id")&&(c.unwatchSize=c.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:d.is(":visible")}},function(){var a=angular.element(window),b=a.height()-46;d.width(a.width()/b>16/9?16/9*b:a.width()),c.changeMagnet(d)},!0)),c.$on("$destroy",function(){c.unwatchVisibility(),c.unwatchSize&&c.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",["$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(b){a(function(){b.indexEvents()})}}}]),angular.module("com.inthetelling.story").directive("ittContainer",["$timeout","$location","$route","appState","modelSvc","recursionHelper","dataSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{container:"=ittContainer",depth:"=depth"},templateUrl:"templates/container.html",compile:function(c){return f.compile(c,function(c){c.appState=d,c.containers=e.containers,c.customer=e.customers[c.container.customer_id],c.isDemoServer=b.host().match(/demo|localhost|api-dev|client.dev/),c.selectText=function(a){a.target.select()},c.containerTypes=["customer","course","session","episode"],c.toggleChildren=function(){c.container.children||c.container.episodes.length?c.container.showChildren=!c.container.showChildren:g.getContainer(c.container._id).then(function(a){c.container=e.containers[a],c.container.showChildren=!0})},c.renameContainer=function(){var a={};angular.forEach(["_id","customer_id","episodes","keywords","parent_id","sort_order"],function(b){a[b]=angular.copy(c.container[b])}),a.name={en:c.container.newContainerName},g.updateContainer(a).then(function(){c.container.editingContainer=!1})},c.addContainer=function(){var a={customer_id:c.container.customer_id,parent_id:c.container._id,name:{en:angular.copy(c.container.newContainerTitle)}};g.createContainer(a).then(function(a){if(2===c.depth){var b={container_id:a._id,title:angular.copy(a.name)};g.createEpisode(b).then(function(){})}}),c.container.newContainerTitle="",c.container.addingContainer=!1},c.deleteEpisodeAndContainer=function(b){var c=e.containers[b],d=c.parent_id?c.parent_id:c.ancestry.replace(/.*\//,""),f=e.containers[d],h=[];angular.forEach(f.children,function(a){a._id!==b&&h.push(a)}),f.children=h,c.episodes.length?g.deleteEpisode(c.episodes[0]).then(function(){a(function(){g.deleteContainer(c._id)},250)}):g.deleteContainer(c._id)}})}}}]),angular.module("com.inthetelling.story").directive("ittContainerEpisodes",["modelSvc","recursionHelper","appState","dataSvc",function(a,b,c,d){return{restrict:"A",replace:!1,scope:{container:"=ittContainerEpisodes",forAdmin:"=forAdmin"},templateUrl:"templates/containerepisodes.html",compile:function(e){return b.compile(e,function(b){b.containers=a.containers,b.crossEpisodePath=c.crossEpisodePath,b.episodeId=c.episodeId,b.loadChildren=function(){a.containers[b.container._id].haveNotLoadedChildData&&d.getContainer(b.container._id)},b.toggle=function(){b.wasClicked=!b.wasClicked},b.selectEpisode=function(){b.$emit("episodeSelected",b.container.episodes[0])}})}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeList",["$location","$timeout","appState","authSvc","dataSvc","modelSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,link:function(a){a.logout=function(){d.logout()},a.appState=c,a.loading=!0,a.containers=f.containers,a.userHasRole=d.userHasRole,e.getCustomerList(),e.getContainerRoot().then(function(b){a.root={children:[]},angular.forEach(b,function(b){a.root.children.push(f.containers[b])}),a.loading=!1},function(){a.failedLogin=!0,a.loading=!1})}}}]),angular.module("com.inthetelling.story").directive("ittUser",["appState","authSvc","dataSvc",function(a,b,c){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/user.html",link:function(d,e,f){d.inPlayer=f.inPlayer,d.loading=!0,d.logout=b.logout,b.authenticate().then(function(){d.loading=!1,d.user=a.user,d.userHasRole=b.userHasRole,d.inPlayer||d.userHasRole("guest")||d.getMyNarratives()}),d.updateUser=function(){a.user.email=a.user.email,b.updateUser(a.user).then(function(){})},d.getMyNarratives=function(){c.getUserNarratives(d.user._id).then(function(a){d.myPurchases=a,angular.forEach(d.myPurchases,function(a){a.daysUntilExpiration=Math.floor((new Date(a.expiration_date)-new Date)/864e5),c.getNarrativeOverview(a.narrative_id).then(function(a){angular.forEach(d.myPurchases,function(b){b.narrative_id===a._id&&(b.narrativeData=a)})})})})}}}}]),angular.module("com.inthetelling.story").directive("ittNarrative",["authSvc","appState","$location","$routeParams","modelSvc","dataSvc",function(a,b,c,d,e,f){return{template:function(){return'<div ng-include="narrative.templateUrl"></div>'},link:function(g){g.loading=!0,g.logout=a.logout,g.tmpSetNarrativeTemplate=function(){g.narrative.templateUrl="templates/narrative/default.html",d.admin&&(g.narrative.templateUrl="templates/narrative/edit.html")},g.stopEditing=function(){c.search("admin",null)},a.authenticate().then(function(){g.userHasRole=a.userHasRole,g.user=b.user,a.userHasRole("admin")&&f.getCustomerList().then(function(a){g.customerList=a})}),g.isOwner=!1,g.toggleOwnership=function(){g.isOwner=!g.isOwner};var h=g._id?g._id:d.narrativePath;h?e.narratives[h]?(g.narrative=e.narratives[h],g.tmpSetNarrativeTemplate(),g.loading=!1):f.getNarrative(h).then(function(a){g.loading=!1,g.narrative=a,g.tmpSetNarrativeTemplate()}):(g.loading=!1,g.toggleOwnership(!0),g.narrative={},g.tmpSetNarrativeTemplate()),g.toggleEpisodeList=function(){g.showEpisodeList=!g.showEpisodeList},g.$on("episodeSelected",function(a,b){g.showEpisodeList=!1,g.addTimeline(b)}),g.createNarrative=function(){a.authenticate().then(function(){f.createUserGroup({en:"All users"}).then(function(a){g.narrative.everyone_group_id=a._id,g.narrative.sub_groups_id=[],f.createNarrative(g.narrative).then(function(a){c.path("/story/"+a._id)})})})},g.updateNarrative=function(){g.narrative.saveInProgress=!0,f.updateNarrative(g.narrative).then(function(){g.tmpSetNarrativeTemplate(),g.narrative.saveInProgress=!1})},g.addTimeline=function(a){f.getEpisodeOverview(a).then(function(a){var b={name:a.title,description:a.description,hidden:!1,path:"",sort_order:g.narrative.timelines.length,parent_episode:a};f.getSingleAsset(a.master_asset_id).then(function(a){b.duration=a.duration,g.narrative.timelines.push(b),g.isAddingTimeline=!0})})},g.saveTimeline=function(a){a.saveInProgress=!0,a._id?f.storeTimeline(g.narrative._id,a).then(function(){a.saveInProgress=!1}):f.createChildEpisode({parent_id:a.parent_episode._id,title:a.name}).then(function(b){f.storeTimeline(g.narrative._id,a).then(function(c){f.createEpisodeSegment(c._id,{episode_id:b._id,start_time:0,end_time:a.duration,sort_order:0,timeline_id:c._id}).then(function(a){c.episode_segments=[a],f.storeTimeline(g.narrative._id,c).then(function(){g.isAddingTimeline=!1;var a=g.narrative._id;f.getNarrative(a).then(function(){g.narrative=e.narratives[a],g.tmpSetNarrativeTemplate()})})})})})}}}}]),angular.module("com.inthetelling.story").directive("ittNarrativeList",["dataSvc","authSvc","$routeParams","appState",function(a,b,c,d){return{restrict:"A",replace:!0,templateUrl:"templates/narrativelist.html",link:function(e){b.authenticate().then(function(){e.userHasRole=b.userHasRole,e.user=d.user,c.admin&&(e.showAddNarrative=!0)}),e.logout=b.logout,a.getNarrativeList().then(function(a){e.narratives=a})}}}]),angular.module("com.inthetelling.story").directive("ittNarrativeTimeline",["$routeParams","$timeout","dataSvc","appState","modelSvc","errorSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,templateUrl:"templates/player-timeline.html",link:function(b){d.init(),d.product="player",c.getNarrative(a.narrativePath).then(function(c){d.narrativeId=c._id,b.narrative=c,angular.forEach(c.timelines,function(c){(c.path===a.timelinePath||c.path.en===a.timelinePath)&&c.episode_segments[0]&&(d.episodeId=c.episode_segments[0].episode_id,d.episodeSegmentId=c.episode_segments[0]._id,b.showPlayer=!0)}),d.episodeId||f.error({data:"Sorry, no episode was found in this timeline."})})}}}]),angular.module("com.inthetelling.story").directive("sxsAddContent",["appState",function(a){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/producer/addcontent.html",controller:"EditController",link:function(b){b.appState=a,b.expand=function(){b.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){b.collapse()})},b.collapse=function(){b.expanded=!1}}}}]),angular.module("com.inthetelling.story").directive("sxsInputTime",["appState","$timeout","modelSvc","timelineSvc",function(a,b,c,d){return{scope:{item:"=sxsInputTime"},templateUrl:"templates/producer/inputtime.html",link:function(e,f,g){e.parse=function(b){var c;if(void 0===b||""===b)c=a.time;else if(isNaN(b)){var d=b.split(":");2===d.length?(isNaN(d[0])&&(d[0]=0),isNaN(d[1])&&(d[1]=0),c=60*+d[0]+ +d[1]):c=a.time}else c=b;return.01>c&&(c=.01),c},e.format=function(a){var b=Math.floor(a/60),c=Math.round(a%60*100)/100;return 10>c&&(c="0"+c),b+":"+c},e.fieldname=angular.copy(g.inputField),e.realValue=angular.copy(e.item[g.inputField]),e.model=e.format(e.realValue),e.appState=a,e.scene="Scene"===e.item.type?e.item:c.events[e.item.scene_id],e.scene="Scene"===e.item._type?function(){return e.item}:function(){return c.sceneAtEpisodeTime(e.item.cur_episode_id,a.time)};var h=c.episodes[e.item.cur_episode_id].masterAsset.duration;e.$watch(function(){return e.parse(e.model)},function(a){e.setTime(a),"start_time"===g.inputField&&e.item.stop&&(e.item.end_time=a)}),e.nudge=function(a){b.cancel(i),f.find(".inputfield").focus();var c=a/30;e.setTime(e.item[g.inputField]+c),"start_time"===g.inputField&&d.seek(e.item[g.inputField]+c)},e.setTime=function(a){0>a&&(a=0),a>h&&(a=h),e.item.stop&&(e.item.end_time=a),e.realValue=a,e.item[g.inputField]=e.realValue,e.model=e.format(a),e.item.invalid_end_time=e.item.start_time>e.item.end_time};var i;e.showTools=function(a){a?e.tooltip=!0:i=b(function(){e.tooltip=!1},300)},e.isTranscript=function(){return!1}}}}]),angular.module("com.inthetelling.story").directive("sxsAnnotatorAutocomplete",["modelSvc","$timeout","appState",function(a,b,c){return{require:"ngModel",templateUrl:"templates/producer/annotator-autocomplete.html",scope:{annotators:"=sxsAnnotatorAutocomplete",item:"=item"},link:function(d,e,f,g){d.appState=c,d.hasAnnotator=function(){
return Object.keys(d.item.annotator).length>0},angular.forEach(d.annotators,function(b){b.annotation_image_id&&(b.imageUrl=a.assets[b.annotation_image_id].url)}),d.annotator={name:d.item.annotator},d.annotators[d.item.annotator]&&d.annotators[d.item.annotator].annotation_image_id&&(d.annotator.imageUrl=a.assets[d.annotators[d.item.annotator].annotation_image_id].url),d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1,e.find(".annotatorChooser").bind("keydown",function(a){switch(a.which){case 40:d.preselectedItem=(d.preselectedItem+1)%Object.keys(d.filteredAnnotators).length;break;case 38:d.preselectedItem=(d.preselectedItem-1)%Object.keys(d.filteredAnnotators).length;break;case 13:a.preventDefault(),d.preselectedItem>-1&&d.selectByIndex(d.preselectedItem)}}),d.handleAutocomplete=function(){if(d.annotator.name="",d.searchText){d.preselectedItem=-1;var a={};angular.forEach(d.annotators,function(b){b.key.toLowerCase().indexOf(d.searchText.toLowerCase())>-1&&(a[b.key]=b)}),d.filteredAnnotators=a,1===Object.keys(d.filteredAnnotators).length&&(d.preselectedItem=0)}else d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1},d.selectByIndex=function(a){if(!(0>a)){var b=Object.keys(d.filteredAnnotators).sort();d.select(d.filteredAnnotators[b[a]])}},d.select=function(b){d.preselectedItem=-1,b.annotation_image_id?(d.item.annotation_image_id=b.annotation_image_id,d.item.asset=a.assets[b.annotation_image_id],d.annotator.imageUrl=d.item.asset.url):(delete d.annotator.imageUrl,delete d.item.asset),g.$setViewValue(b.name),d.searchText=""},d.autoCompleting=!1,d.showAutocomplete=function(){var a=e.find(".annotatorChooser")[0];a.setSelectionRange(0,a.value.length),d.autoCompleting=!0},d.hideAutocomplete=function(){b(function(){d.preselectedItem>-1?d.selectByIndex(d.preselectedItem):""!==d.searchText&&d.addNewAnnotator(),d.autoCompleting=!1},300)},d.addNewAnnotator=function(){var a=d.searchText;d.item.annotator={},d.item.annotator[c.lang]=a,d.searchText="",d.handleAutocomplete()},d.uploadAnnotatorImage=function(){window.alert("TODO")}}}}]),angular.module("com.inthetelling.story").directive("sxsInputI18n",["appState",function(a){return{templateUrl:"templates/producer/inputi18n.html",scope:{field:"=sxsInputI18n",inputtype:"=inputtype"},link:function(b){b.field||(b.field={en:""}),b.appState=a}}}]),angular.module("com.inthetelling.story").directive("ittTabs",function(){return{restrict:"A",replace:!0,link:function(a,b){a.tabs=[];for(var c=!1,d=b.find(".ittTab"),e=0;e<d.length;e++)a.tabs[e]=$(d[e]).hasClass("cur"),a.tabs[e]&&(c=!0);c||(a.tabs[0]=!0),a.tab=function(b){for(var c=0;c<d.length;c++)a.tabs[c]=!1;a.tabs[b]=!0}}}}).directive("ittTab",function(){return{restrict:"A",replace:!1,transclude:!0,scope:{isCur:"=ittTab"},template:'<div><div class="ittTabLabel" ng-class="{cur: isCur}"><a ng-click="$parent.tab(tabindex)">{{tablabel}}</a></div><div class="ittTabContents" ng-show="isCur" ng-transclude></div></div>',link:function(a,b,c){a.tablabel=c.tablabel,a.tabindex=c.tabindex}}}),angular.module("com.inthetelling.story").controller("ContainerAssetsTestController",["$scope","$routeParams",function(a,b){a.containerId=b.containerId}]).directive("sxsContainerAssets",["$routeParams","$rootScope","recursionHelper","dataSvc","modelSvc","awsSvc","appState",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{containerId:"=sxsContainerAssets"},templateUrl:"templates/producer/container-assets.html",compile:function(a){return c.compile(a,function(a){a.appState=g,e.containers[a.containerId]?e.containers[a.containerId].assetsHaveLoaded||d.getContainerAssets(a.containerId):d.getContainer(a.containerId),e.containers[a.containerId]?a.container=e.containers[a.containerId]:d.getContainer(a.containerId).then(function(){a.container=e.containers[a.containerId]}),a.assets=e.assets,a.uploadStatus=[],a.up=function(){a.showParent=!0},a.toggleImages=function(){a.onlyImages=!a.onlyImages},a.toggleGrid=function(){a.gridView=!a.gridView},a.assetClick=function(a){b.$emit("UserSelectedAsset",a)},a.uploadAsset=function(b){var c=b.files;a.uploadStatus[0]={bytesSent:0,bytesTotal:1},a.uploads=f.uploadFiles(a.containerId,c),a.uploads[0].then(function(c){e.cache("asset",c.file),b.value="",delete a.uploads},function(){},function(b){a.uploadStatus[0]=b})}})}}}]);