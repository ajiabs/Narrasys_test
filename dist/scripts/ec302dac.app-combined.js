"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/error",{controller:"UIErrorController",templateUrl:"templates/error.html"}).when("/episode/:epId",{controller:"EpisodeController",template:'<div ng-include="episode.templateUrl">Loading Episode...</div>'}).when("/episode/:epId/:authKey",{controller:"EpisodeController",template:'<div ng-include="episode.templateUrl">Loading Episode...</div>'}).otherwise({redirectTo:"/error"}),b.html5Mode(!1)}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/danielbeck.net/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"]}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/contentpane.html",'<!-- \n	TODO:  item.styles is on both the ng-repeat and on the item. Harmless, but redundant.\n	Need it on the ng-repeat for animations; check to see if we can remove it from the item\n	(will definitely require edits to item.css, maybe elsewhere?)\n\n-->\n\n<div class="content" x-ng-class=\'{"noSidebars": noSidebars, "hasLeftSidebar": hasLeftSidebar, "hasRightSidebar": hasRightSidebar}\'>\n	<h2 x-ng-if="pane == \'main\'" class="sceneTitle">{{scene.title}}</h2>\n	<div x-ng-repeat="item in itemlist | itemList:showCurrent" class="item-animate" x-ng-class="item.styles" data-force-item-template="{{forceItemTemplate}}" x-itt-item="item">\n	</div>\n</div>\n'),a.put("templates/episode-default.html",'<div class="{{episode.styles}}" x-ng-class="{isFramed: isFramed}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n</div>\n<div class="branding">\n	<a class="itt" href="http://inthetelling.com">\n		<img src="images/itt.svg" alt="In The Telling logo">\n	</a>\n</div>\n'),a.put("templates/episode-eliterate.html",'<div class="{{episode.styles}} episode-eliterate" x-ng-class="{isFramed: isFramed}">\n	<div x-itt-video x-itt-magnetized class="vjs-wrapper">\n	</div>\n	<div x-itt-toolbar>\n	</div>\n	<div class="eliterate-logo">\n		<img src="images/eliterate-logo.svg">\n	</div>\n	<div class="episode episode{{episode.layout}}">\n		<div x-ng-repeat="scene in scenes" x-itt-scene="scene"></div>\n		<div class="clear"></div>\n	</div>\n	<div class="branding">\n		<a class="eliterate" href="http://www.mindwires.com">\n			<img src="images/mindwires.svg" alt="Mindwires logo">\n		</a>\n		<a class="itt" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n	</div>\n</div>\n'),a.put("templates/error.html",'<div class="error">\n	<h2>Error</h2>\n	<p>Something went wrong: {{errorMsg}}</p>\n	<!--<p><small>{{errorDetails}}</small></p>-->\n</div>\n'),a.put("templates/modal-image-default.html",'<div>\n	<img x-ng-src="{{item.source}}" width="100%">\n</div>\n'),a.put("templates/modal-link-default.html",'<div x-ng-class="{isIDevice: item.isIDevice}">\n	<div class="modalmenu"><a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n	</div>\n	<div class="modalIframeContainer">\n		<iframe x-ng-src="{{item.source}}"></iframe>\n	</div>\n</div>\n'),a.put("templates/scene-1col.html",'<div class="scene-1col {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-2colL.html",'<div class="scene-2col scene-2colL {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-2colR.html",'<div class="scene-2col scene-2colR {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="main" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div>\n				<div class="matchVideoHeight"></div>\n				<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-animatetest.html",'<!-- \n\nThis is an equivalent of scene-1col which allows animated transitions on Fg, Bg, and videoOverlay elements. \nMost of the transitions don\'t play nicely with those items\' positioning, however!  transitionFade is the only \ncurrently trustworthy one.  \n\nTODO: decide whether to support that transtion (only)?\n\nTODO: does filter:{isActive:true} mean a performance hit?\n\n-->\n\n<div class="scene-1col {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\' | filter:{isActive:true}" x-itt-item="item"></div>\n			</div>\n			<div x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\' | filter:{isActive:true}" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div class="item-animate" x-ng-repeat="item in scene.items | layout: \'videoOverlay\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\' | filter:{isActive:true}" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-centered.html",'<div class="scene-centered {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-no-sidebars="true" data-show-current="true" data-content="content" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerH.html",'<div class="scene-cornerH {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain matchVideoHeight">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-cornerV.html",'<div class="scene-cornerV {{scene.layout}} {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div class="scene-cornerV-column stretchToViewportBottom">\n			<div class="pane videoContainer" x-itt-magnet>\n				<div class="fillPane video">\n					<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n				</div>\n			</div>\n			<div class="pane contentMain stretchToViewportBottom">\n				<div class="fillPane paneBg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n				</div>\n				<div data-pane="main" data-no-sidebars="true" data-show-current="true" data-content="{{scene.mainPaneContents}}" x-itt-content-pane></div>\n				<div class="fillPane paneFg">\n					<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n				</div>\n			</div>\n		</div>\n		<div class="pane contentAlt stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'altBg\'" x-itt-item="item"></div>\n			</div>\n			<div data-pane="alt" data-content="{{scene.altPaneContents}}" x-itt-content-pane></div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'altFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-explore.html",'<!-- TODO: on enter need to scroll directly to current scene if it\'s not scene 1 -->\n\n<div x-ng-if="scene.items.length" class="clear scene-explore {{scene.layout}} {{scene.styles}}" \nx-ng-class=\'{\n	"currentScene": scene.isActive, \n	"futureScene": !scene.isActive && !scene.wasActive, \n	"pastScene": !scene.isActive && scene.wasActive,\n	"nonNavigable": scene.nonNavigable\n}\'>\n	<div class="scene">\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n			</div>\n		</div>\n		<div class="pane contentMain">\n			<div class="content noSidebars">\n				<h2 class="sceneTitle">{{scene.title}}</h2>\n				<div x-ng-repeat="item in scene.items | layout: scene.mainPaneContents | filter:{cosmetic: false}" class="item-animate" data-force-item-template="default" x-itt-item="item"></div>\n			</div>\n		</div>\n		<div class="pane contentAlt">\n			<div x-ng-if="scene.startTime == 0" class="matchVideoHeight">\n				<!-- in explore view, need to pad the first scene to make room for the video -->\n			</div>\n			<div class="content noSidebars">\n				<div x-ng-repeat="item in scene.items | layout: scene.altPaneContents | filter:{cosmetic: false}" class="item-animate" data-force-item-template="default" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/scene-video.html",'<div class="scene-video {{scene.styles}}" x-ng-class=\'{"currentScene": scene.isActive, "futureScene": !scene.isActive && !scene.wasActive, "pastScene": !scene.isActive && scene.wasActive}\'>\n	<div class="fillPane windowBg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowBg\'" x-itt-item="item"></div>\n	</div>\n	<div class="scene">\n		<div style="position:relative;">\n			<div class="pane videoContainer" x-itt-magnet>\n				<div class="fillPane video">\n					<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" />\n				</div>\n			</div>\n			<div class="clear"></div>\n		</div>\n		<div class="pane contentMain stretchToViewportBottom">\n			<div class="fillPane paneBg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainBg\'" x-itt-item="item"></div>\n			</div>\n			<div class="content showCurrent noSidebars">\n				<div data-force-item-template="closedcaption" x-ng-repeat="item in scene.items | layout: scene.mainPaneContents | filter:{isActive:true, type: \'annotation\'}" x-itt-item="item"></div>\n			</div>\n			<div class="fillPane paneFg">\n				<div x-ng-repeat="item in scene.items | layout: \'mainFg\'" x-itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n\n	<div x-itt-magnetized class="fillPane videoOverlay">\n		<div x-ng-repeat="item in scene.items | layout: \'videoOverlay\'" x-itt-item="item"></div>\n	</div>\n	<div class="fillPane windowFg">\n		<div x-ng-repeat="item in scene.items | layout: \'windowFg\'" x-itt-item="item"></div>\n	</div>\n</div>\n'),a.put("templates/text-h1.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<h1>\n		{{item.annotation}}\n	</h1>\n</div>\n'),a.put("templates/text-h2.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<h2>\n		{{item.annotation}}\n	</h2>\n</div>\n'),a.put("templates/text-pullquote-noattrib.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="pullquote">\n		{{item.annotation}}\n	</div>\n</div>\n'),a.put("templates/text-pullquote.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="pullquote">\n		{{item.annotation}}\n	</div>\n	<div class="pullquoteSpeaker">{{item.authorName}}</div>\n</div>\n'),a.put("templates/toolbar/toolbar.html",'<span>\n	<div class="toolbar" x-ng-show="show.playerPanel">\n			<a x-ng-click="toggleSceneTemplate();" class="button button-directed" href="javascript:void 1;">\n				<span x-ng-if="!currentSceneTemplateIs(\'explore\')">Explore</span>\n				<span x-ng-if="currentSceneTemplateIs(\'explore\')">Watch</span>\n			</a>\n\n		<a x-ng-if="isFramed" class="button button-mainframeescape" href="/#/episode/{{episodeID}}/{{authKey}}" target="frameEscape" onclick="window.open(\'\',\'frameEscape\').focus();">\n			<span>New window</span>\n		</a>\n\n		<a class="button button-search" href="javascript: void 1;" x-ng-click="showSearchPanel()">\n			<span>Search</span>\n		</a>\n		\n	</div>\n	<div class="threedee">\n		<div class="modal-backdrop" x-ng-click="hidePanels()" x-ng-show="show.navigationPanel || show.searchPanel"></div>\n		<div x-ng-show="show.navigationPanel" class="sidePanel navigationPanel">\n			<div x-ng-controller="NavigationPanelController">\n				<h2>{{episode.title}}</h2>\n				<div class="scene" x-ng-if="scene.title" x-ng-repeat="scene in scenes" x-ng-class="{currentScene: scene.isActive}" x-ng-click="gotoScene(scene)">\n					<span class="displayTime">{{scene.displayTime}}</span>\n					<p>\n						<a href="javascript:void 1;">{{scene.title}}</a>\n						<br>{{scene.description}}\n					</p>\n				</div>\n			</div>\n		</div>\n		<div x-ng-show="show.searchPanel" class="sidePanel searchPanel">\n			<div x-ng-if="show.searchPanelInternals" x-ng-controller="SearchPanelController">\n				<div class="filters">\n					<dl>\n						<dt>Search:</dt>\n						<dd>\n							<input id="searchtext" type="text" x-ng-model="searchText" />\n						</dd>\n						<!--\n		TODO: bring this back when we implement categories (and use the episode\'s categories to build the list of options)\n					<dt>Types:</dt>\n					<dd>\n						<label><input type="checkbox" id="searchalltypes" checked="checked"><span> All transmedia types</span></label>\n						<div id="searchtypes" class="accordion">\n							<label><input type="checkbox" name="searchcategory" id="searchtype-transcript" x-ng-model="searchTypes.annotation"><span> {{prettyTypeMap[\'annotation\']}}</span></label>\n							<label><input type="checkbox" name="searchcategory" id="searchtype-links" x-ng-model="searchTypes.link"><span> {{prettyTypeMap[\'link\']}}</span></label>\n							<label><input type="checkbox" name="searchcategory" id="searchtype-slides" x-ng-model="searchTypes.slide"><span> {{prettyTypeMap[\'slide\']}}</span></label>\n							<label><input type="checkbox" name="searchcategory" id="searchtype-in_depth" x-ng-model="searchTypes.indepth"><span> {{prettyTypeMap[\'indepth\']}}</span></label>\n							<label><input type="checkbox" name="searchcategory" id="searchtype-projects" x-ng-model="searchTypes.project"><span> {{prettyTypeMap[\'project\']}}</span></label>\n							<label><input type="checkbox" name="searchcategory" id="searchtype-discussions" x-ng-model="searchTypes.discussion"><span> {{prettyTypeMap[\'discussion\']}}</span></label>\n						</div>\n					</dd>\n		-->\n						<dt>Sort by:</dt>\n						<dd>\n							<select id="searchsort" size="1" x-ng-model="sortBy">\n								<option value="startTime">Time</option>\n								<option value="type">Type</option>\n							</select>\n						</dd>\n					</dl>\n				</div>\n				<div class="scrollContainer">\n					<div class="searchResults">\n						<!-- TODO:\n					- Wire up all types checkbox\n					- Check ordering in items by type\n					- Hide type header when no child items are visible\n				-->\n						<!-- sorted by start time -->\n						<div x-ng-if="sortBy == \'startTime\'">\n							<div x-ng-repeat="scene in scenes">\n								<h3>{{scene.title}}</h3>\n								<div class="item" x-ng-repeat="item in scene.items | orderBy:\'startTime\' | filter:{\'searchableText\': searchText} | type:searchTypes">\n									<span class="displayTime"><a href="javascript:void 1" x-ng-click="gotoItem(item)">{{item.displayTime}}</a>\n									</span>\n									<span class="type">({{prettyTypeMap[item.type]}})</span>\n									<div class="description" ng-bind-html="item.trustedDisplayText | highlight: searchText"></div>\n								</div>\n							</div>\n						</div>\n\n						<!-- sorted by type -->\n						<div x-ng-if="sortBy == \'type\'">\n							<div class="sortedbytype" x-ng-repeat="(type, items) in allItemsByType | orderBy:\'type\'" x-ng-if="searchTypes[type]">\n								<h3>{{prettyTypeMap[type]}}</h3>\n								<div class="item" x-ng-repeat="item in items | orderBy:\'startTime\' | type:searchTypes | filter:{\'searchableText\': searchText}">\n									<span class="displayTime"><a href="javascript:void 1" x-ng-click="gotoItem(item)">{{item.displayTime}}</a>\n									</span>\n									<span class="type">({{prettyTypeMap[item.type]}})</span>\n									<div class="description" ng-bind-html="item.trustedDisplayText | highlight: searchText"></div>\n								</div>\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<!-- TODO ARIA markup on all clickables -->\n	<div class="injectedvideocontrols vjs-story-skin">\n		<div x-ng-click="showSceneMenu()" class="video-scenemenu vjs-control">\n			<a href="javascript: void 1;">\n				<span class="vjs-control-text">Scene list</span>\n			</a>\n		</div>\n\n		<div x-ng-class="{isOpen: currentSceneTemplateIs(\'video\')}" x-ng-click="toggleClosedCaptionMode()" class="video-captions vjs-control">\n			<a href="javascript: void 1;">\n				<span class="vjs-control-text">Closed Captions</span>\n			</a>\n		</div>\n	\n		<div x-ng-if="curScene.$prevScene" class="video-prevscene vjs-control">\n			<a x-ng-click="gotoTime(curScene.$prevScene.startTime)">\n				<span class="vjs-control-text">Previous scene</span>\n			</a>\n		</div>\n		<div x-ng-if="curScene.$nextScene" class="video-nextscene vjs-control">\n			<a x-ng-click="gotoTime(curScene.$nextScene.startTime)">\n				<span class="vjs-control-text">Next scene</span>\n			</a>\n		</div>\n	</div>\n\n\n	<div x-ng-show="show.introPanel" class="sceneintro">\n		<h1>\n			{{episode.title}}\n		</h1>\n		<p>\n			{{episode.description}}\n		</p>\n		<div class="pane videoContainer" x-itt-magnet>\n			<div class="fillPane video">\n				<img class="aspectratiopreserver" src="/images/aspectratiopreserver-16x9.gif" /> \n			</div>\n		</div>\n\n\n	</div>\n\n\n	<div id="footertrigger" x-ng-mouseenter="showVideoControls()"></div>\n\n</span>\n'),a.put("templates/transcript-closedcaption.html",'<div class="item" x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="authorName">{{item.authorName}}</div>\n	</div>\n	<div class="text">{{item.annotation}}</div>\n</div>\n'),a.put("templates/transcript-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="authorName">{{item.authorName}}</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.authorThumbSrc}}"><div class="clear"></div></div> -->\n	<div class="text">\n		{{item.annotation}}\n	</div>\n</div>\n'),a.put("templates/transcript-withthumbnail-alt.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="icon" style="float:right">\n			<img x-ng-src="{{item.authorThumbSrc}}">\n			<div class="clear"></div>\n		</div>\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="authorName">{{item.authorName}}</div>\n	</div>\n	<div class="text">\n		{{item.annotation}}\n	</div>\n</div>\n'),a.put("templates/transcript-withthumbnail.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n	</div>\n	<div class="icon" style="float:left; margin-right: 1em;">\n		<img x-ng-src="{{item.authorThumbSrc}}">\n		<div class="clear"></div>\n	</div>\n	<div class="authorName">{{item.authorName}}</div>\n	<div class="text">\n		{{item.annotation}}\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/transmedia-caption.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<!--<span x-ng-if="item.required">(Required viewing)</span>-->\n		</div>\n	</div>\n\n	<div class="captioncontainer">\n		<img x-ng-src="{{item.source}}" style="width:100%">\n		<div class="caption">\n			<div class="title">{{item.title}}</div>\n			<div class="text">{{item.description}}</div>\n		</div>\n	</div>\n'),a.put("templates/transmedia-embed-youtube.html",'<!-- TODO: clean up the YT url, add our own params, probably use their player API so we can hook into play/pause events -->\n\n\n<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n	<div class="detail" style="width: 100%;position: relative;padding-bottom: 56.25%;height: 0;">\n		<iframe x-ng-src="{{item.source}}" style="position:absolute; width: 100%; height: 100%; "></iframe>\n	</div>\n\n	<div class="text">\n		{{item.description}}\n	</div>\n\n</div>\n'),a.put("templates/transmedia-image-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<!--<span x-ng-if="item.required">(Required viewing)</span>-->\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title">\n			<a href="javascript:void 1;" x-ng-click="toggleDetailView()">{{item.title}}</a>\n		</div>\n		<div class="text">{{item.description}}</div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail">\n		<img x-ng-src="{{item.source}}" style="width: 100%">\n	</div>\n</div>\n'),a.put("templates/transmedia-image-plain.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive\n}\'>\n	<img x-ng-src="{{item.source}}" />\n</div>\n'),a.put("templates/transmedia-link-default.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title"><a href="javascript:void 1;" x-ng-click="toggleDetailView()">{{item.title}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail">\n		<a href="{{item.source}}" target="_blank" class="escapelink">(new window)</a>\n		<div style="-webkit-overflow-scrolling:touch; overflow: auto; width: 100%; height: 320px">\n			<iframe x-ng-src="{{item.source}}" width="100%" height="300px"></iframe>\n		</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-icon.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="icon">\n		<a href="{{item.source}}" target="_blank">\n			<img x-ng-src="{{item.thumbSrc}}">\n		</a>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-noembed.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title"><a href="{{item.source}}" class="escapelink" target="_blank">{{item.title}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-link-youtube.html",'<!-- TODO: clean up the YT url, add our own params, probably use their player API so we can hook into play/pause events -->\n\n\n<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title"><a href="javascript:void 1;" x-ng-click="toggleDetailView()">{{item.title}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="detail" x-ng-if="item.showInlineDetail" style="width: 100%;position: relative;padding-bottom: 56.25%;height: 0;">\n		<iframe x-ng-src="{{item.source}}" style="position:absolute; width: 100%; height: 100%; "></iframe>\n	</div>\n</div>\n'),a.put("templates/transmedia-linkonly.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<!-- <div class="icon"><img x-ng-src="{{item.thumbSrc}}"></div> -->\n	<div class="text">\n		<div class="title"><a href="{{item.source}}" class="escapelink" target="_blank">{{item.title}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n</div>\n'),a.put("templates/transmedia-slidingcaption.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span x-ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n\n	<div class="captioncontainer">\n		<img x-ng-src="{{item.source}}" style="width:100%">\n		<div class="caption slidingcaption">\n			<div class="title">{{item.title}}</div>\n			<div class="text">{{item.description}}</div>\n		</div>\n	</div>\n'),a.put("templates/transmedia-thumbnail.html",'<div class="item {{item.layout}} {{item.styles}} " x-ng-class=\'{\n	"currentItem": item.isActive, \n	"futureItem": !item.isActive && !item.wasActive, \n	"pastItem": !item.isActive && item.wasActive,\n	"isRequired": item.required,\n	"isCosmetic": item.cosmetic\n}\'>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="gotoItem()">{{item.displayTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<!--<span x-ng-if="item.required">(Required viewing)</span>-->\n		</div>\n	</div>\n	<div class="thumbnail" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()">\n		<img x-ng-src="{{item.source}}">\n	</div>\n	<div class="text">\n		<div class="title">{{item.title}}</div>\n		{{item.description}}\n	</div>\n</div>\n</div>\n')
}]),angular.module("com.inthetelling.player").controller("UIErrorController",["$scope","$rootScope",function(a,b){a.errorMsg=b.uiErrorMsg||"The requested route does not exist.",a.errorDetails=b.uiErrorDetails}]),angular.module("com.inthetelling.player").controller("EpisodeController",["dataSvc","modelFactory","cuePointScheduler","$scope","$rootScope","$location","$routeParams","videojs","$window",function(a,b,c,d,e,f,g,h,i){h.player&&(console.log("Route change: forcing refresh"),i.location.reload()),a.get(g,function(a){var f,h;for(d.episodeID=g.epId,d.authKey=g.authKey,d.episode=b.createEpisodeModel(a.episode),d.scenes=[],f=0;f<a.events.length;f++)if("scene"===a.events[f].type){var i=b.createSceneModel(a.events[f]);!function(a){c.subscribe({begin:a.startTime,end:a.endTime},function(b,e){d.$apply(function(){e===c.ENTER?a.isActive=!0:e===c.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(i),d.scenes.push(i)}for(f=0;f<a.events.length;f++)if("scene"!==a.events[f].type){var j=b.createItemModel(a.events[f]);for(function(a){c.subscribe({begin:a.startTime,end:a.endTime},function(b,e){d.$apply(function(){e===c.ENTER?a.isActive=!0:e===c.EXIT&&(a.isActive=!1,a.wasActive=!0)})})}(j),h=0;h<d.scenes.length;h++)if(j.startTime>=d.scenes[h].startTime&&j.startTime<d.scenes[h].endTime){d.scenes[h].items.push(j);break}}for(d.scenes.sort(function(a,b){return a.startTime-b.startTime}),f=0;f<d.scenes.length;f++)d.scenes[f].items.sort(function(a,b){return a.startTime-b.startTime});for(f=1;f<d.scenes.length;f++)for(h=f-1;h>-1;h-=1)if(d.scenes[h].title){d.scenes[f].$prevScene=d.scenes[h];break}for(f=0;f<d.scenes.length-1;f++)for(h=f+1;h<d.scenes.length;h++)if(d.scenes[h].title){d.scenes[f].$nextScene=d.scenes[h];break}e.isFramed=window.parent!=window,e.isIPad=navigator.platform.indexOf("iPad")>-1,e.isiPhone=navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,console.log("Created episode scope:",d)},function(a){e.uiErrorMsg="Wasn't able to load episode data. Sorry!",e.uiErrorDetails=JSON.stringify(a),f.path("/error")})}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","videojs",function(a,b){a.gotoItem=function(){b.player.currentTime(a.item.startTime)}}]),angular.module("com.inthetelling.player").controller("ToolbarController",["$scope","$timeout","$rootScope","videojs",function(a,b,c,d){a.setSceneTemplate=function(d){a.currentSceneTemplate=d;for(var e=0;e<a.scenes.length;e++){var f=a.scenes[e];d?(void 0===f.origTemplateUrl&&(f.origTemplateUrl=f.templateUrl),f.templateUrl="templates/scene-"+d+".html"):f.origTemplateUrl&&(f.templateUrl=f.origTemplateUrl)}b(function(){c.$emit("toolbar.changedSceneTemplate")},0)},a.currentSceneTemplateIs=function(b){return a.currentSceneTemplate===b},a.toggleSceneTemplate=function(){"explore"===a.currentSceneTemplate?a.setSceneTemplate(""):a.setSceneTemplate("explore")},a.show={navigationPanel:!1,searchPanel:!1,searchPanelInternals:!1,introPanel:!0,playerPanel:!1},a.showNavigationPanel=function(){d.player.pause(),d.player.controls(!1),a.show.navigationPanel=!0},a.showSearchPanel=function(){d.player.pause(),d.player.controls(!1),a.show.searchPanel=!0,b(function(){a.show.searchPanelInternals=!0},0)},a.showSceneMenu=function(){a.show.navigationPanel?a.hidePanels():a.showNavigationPanel()},a.toggleClosedCaptionMode=function(){"video"===a.currentSceneTemplate?(a.setSceneTemplate(a.lastModeUsed),a.lastModeUsed=void 0):(a.lastModeUsed=a.currentSceneTemplate,a.setSceneTemplate("video"))},a.showVideoControls=function(){d.player&&d.player.userActive(!0)},a.hidePanels=function(){a.show.navigationPanel=!1,a.show.searchPanel=!1,d.player.controls(!0)},a.gotoTime=function(a){d.player.currentTime(a+.001)},a.firstPlayWatcher=c.$on("toolbar.videoFirstPlay",function(){$(".injectedvideocontrols").appendTo($(".vjs-control-bar")).show(),a.show.introPanel=!1,a.show.playerPanel=!0,c.$emit("toolbar.changedSceneTemplate"),a.firstPlayWatcher(),a.curSceneWatcher=a.$watch(function(){for(var b=d.player.currentTime(),c=0;c<a.scenes.length;c++)if(a.scenes[c].startTime>b)return a.scenes[c-1];return a.scenes[a.scenes.length-1]},function(b){a.curScene=b})}),a.firstPlayWatcherForIDevicesWhenWeAreUsingYoutube=a.$watch(function(){return d.player?d.player.durationchanged:void 0},function(b){b&&(c.$emit("toolbar.videoFirstPlay"),a.firstPlayWatcherForIDevicesWhenWeAreUsingYoutube())})}]),angular.module("com.inthetelling.player").controller("NavigationPanelController",["$scope","videojs",function(a,b){a.gotoScene=function(a){b.player.currentTime(a.startTime)}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","videojs","$sce",function(a,b,c){a.searchTypes={annotation:!0,link:!0,slide:!0,indepth:!0,project:!0,discussion:!0},a.sortBy="startTime",a.prettyTypeMap={annotation:"Transcript",link:"Links",slide:"Slides",indepth:"In Depth",project:"Projects",discussion:"Discussions"},a.allItemsByType={};var d,e;for(d=0;d<a.scenes.length;d++)for(e=0;e<a.scenes[d].items.length;e++)a.allItemsByType[a.scenes[d].items[e].type]||(a.allItemsByType[a.scenes[d].items[e].type]=[]),a.scenes[d].items[e].searchableText=a.scenes[d].items[e].annotation||a.scenes[d].items[e].description,a.scenes[d].items[e].trustedDisplayText=c.trustAsHtml(a.scenes[d].items[e].searchableText),a.allItemsByType[a.scenes[d].items[e].type].push(a.scenes[d].items[e]);a.gotoItem=function(a){b.player.currentTime(a.startTime)}}]),angular.module("com.inthetelling.player").factory("dataSvc",["config","$route","$location","$http","$q","_","$rootScope",function(a,b,c,d,e,f,g){var h,i={};return i.get=function(b,e,f){var j=b.epId,k=b.authKey;h={},a.localData||"local"===k?d({method:"GET",url:a.localDataBaseUrl+"/"+j+".json"}).success(function(a){e(a)}).error(function(a){f(a)}):d.get(a.apiDataBaseUrl+"/v1/check_signed_in").success(function(a){a.signed_in===!0?i.batchAPIcalls(b,e,f):(g.uiErrorMsg="Authentication failed.",g.uiErrorDetails=JSON.stringify(a),c.path("/error"))}).error(function(a){g.uiErrorMsg="Couldn't make authentication check!",g.uiErrorDetails=JSON.stringify(a),c.path("/error")})},i.batchAPIcalls=function(b,c,f){var g=b.epId,i=b.authKey,j="";a.apiAuthToken?d.defaults.headers.get={Authorization:a.apiAuthToken}:j=i?"?access_token="+i:"";var k=d.get(a.apiDataBaseUrl+"/v1/episodes/"+g+j).then(function(b){return h.episode=b.data,e.all([d.get(a.apiDataBaseUrl+"/v1/containers/"+b.data.container_id+"/assets"+j),d.get(a.apiDataBaseUrl+"/v1/containers/"+b.data.container_id+j)])}).then(function(b){return h.assets=b[0].data.files,e.all([d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+"/assets"+j),d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+j)])}).then(function(b){return h.assets=h.assets.concat(b[0].data.files),d.get(a.apiDataBaseUrl+"/v1/containers/"+b[1].data[0].parent_id+"/assets"+j)}).then(function(a){h.assets=h.assets.concat(a.data.files)}),l=e.all([d.get(a.apiDataBaseUrl+"/v2/episodes/"+g+"/events"+j),d.get(a.apiDataBaseUrl+"/v1/templates"+j),d.get(a.apiDataBaseUrl+"/v1/layouts"+j),d.get(a.apiDataBaseUrl+"/v1/styles"+j)]).then(function(a){h.events=a[0].data,h.templates=a[1].data,h.layouts=a[2].data,h.styles=a[3].data});e.all([k,l]).then(function(){for(var a=0;a<h.events.length;a++)h.events[a].type=h.events[a].type.toLowerCase(),h.events[a]._type=h.events[a]._type.toLowerCase();c(h)},function(a){f(a)})},i.getAssetById=function(a){if(f.isArray(h.assets)){var b;for(b=0;b<h.assets.length;b++)if(h.assets[b]._id===a)return h.assets[b]}},i.getTemplateById=function(a){if(f.isArray(h.templates)){var b;for(b=0;b<h.templates.length;b++)if(h.templates[b]._id===a)return h.templates[b]}},i.getLayoutById=function(a){if(f.isArray(h.layouts)){var b;for(b=0;b<h.layouts.length;b++)if(h.layouts[b]._id===a)return h.layouts[b]}},i.getStyleById=function(a){if(f.isArray(h.styles)){var b;for(b=0;b<h.styles.length;b++)if(h.styles[b]._id===a)return h.styles[b]}},i}]),angular.module("com.inthetelling.player").factory("modelFactory",["dataSvc","_",function(a,b){var c=function(a){return b.isString(a)&&a.match(/^[0-9a-fA-F]{24}$/)?!0:!1},d=function(b){if(c(b)){var d=a.getTemplateById(b);if(d)return d.url;console.error("Template lookup failed for:",b)}return b},e=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getLayoutById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Layout lookup failed for:",c[d]);return f}return c},f=function(c){if(b.isArray(c)){var d,e,f="";for(d=0;d<c.length;d++)e=a.getStyleById(c[d]),e?(f.length&&(f+=" "),f+=e.css_name):console.error("Style lookup failed for:",c[d]);return f}return c},g=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return{mpeg4:d.url,webm:d.url.replace(".mp4",".webm"),youtube:d.you_tube_url};console.error("Master Asset lookup failed for:",b)}return b},h=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d.url;console.error("Asset lookup failed for:",b)}return b},i=function(b){if(c(b)){var d=a.getAssetById(b);if(d)return d._type;console.error("Asset lookup failed for:",b)}return b},j={};return j.createEpisodeModel=function(a){var b={};return b.title=a.title,b.description=a.description,b.category="Fnord",b.coverUrl="/images/coverlogo.png",b.templateUrl=d(a.template_id)||"templates/episode-default.html",b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.videos=g(a.master_asset_id),b},j.createSceneModel=function(a){var b={};return b.type=a.type,b.title=a.title,b.title||(b.nonNavigable=!0),b.description=a.description,b.startTime=a.start_time,b.endTime=a.end_time,b.templateUrl=d(a.template_id)||"templates/scene-1col.html",b.layout=e(a.layout_id)||"",b.styles=f(a.style_id)||"",b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),b.isActive=!1,b.wasActive=!1,b.items=[],b.layout.match(/splitOptional/)?(b.mainPaneContents="required",b.altPaneContents="optional"):(b.mainPaneContents="transcript",b.altPaneContents="transmedia"),b.layout.match(/showCurrent/)&&(b.showCurrent=!0),b},j.createItemModel=function(a){var b={};switch(b.type=a.type,b.startTime=a.start_time,b.endTime=a.end_time,b.layout=e(a.layout_id)||"inline",b.styles=f(a.style_id)||"",b.required=a.required||!1,b.cosmetic=a.cosmetic||!1,b.stop=a.stop||!1,b.displayTime=Math.floor(a.start_time/60)+":"+("0"+Math.floor(a.start_time)%60).slice(-2),("inline"===b.layout||b.layout.match(/sidebar/)||b.layout.match(/burst/))&&(b.inContentPane=!0),a.type){case"annotation":b.templateUrl=d(a.template_id)||"templates/transcript-default.html",b.authorName=a.annotator,b.authorThumbSrc=h(a.annotation_image_id),b.annotation=a.annotation;break;case"link":b.templateUrl=d(a.template_id)||"templates/transmedia-link-default.html",b.itemDetailTemplateUrl="templates/modal-link-default.html",b.category="links",b.title=a.title,b.description=a.description,b.thumbSrc=h(a.link_image_id),b.source=a.url.indexOf("youtube.com/embed/")>-1?-1===a.url.indexOf("?")?a.url+"?wmode=transparent":(a.url.replace(/wmode=[^&]*&?/g,"")+"&wmode=transparent").replace(/&+/g,"&"):a.url;break;case"upload":var c=a.mimeType||i(a.asset_id);c.match(/image/)&&(b.type="image"),b.templateUrl=d(a.template_id)||"templates/transmedia-image-default.html",b.itemDetailTemplateUrl="templates/modal-image-default.html",b.title=a.title,b.description=a.description,b.source=h(a.asset_id)}return b},j}]),angular.module("com.inthetelling.player").factory("modalMgr",["videojs","$modal","_",function(a,b){var c={};return c.createItemDetailOverlay=function(c){c.item.isIDevice=navigator.platform.indexOf("iPad")>-1||navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,c.videoWasPlaying=!a.player.paused(),a.player.pause();var d=function(){c.videoWasPlaying&&a.player.play()},e=b.open({keyboard:!0,backdrop:!0,templateUrl:c.item.itemDetailTemplateUrl,windowClass:"itemDetailModal",scope:c});e.result.then(function(){d()},function(){d()})},c}]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b===a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b===a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(a,b){return{restrict:"EA",replace:!0,template:'<div class="modal-backdrop" x-ng-click="close($event)"></div>',link:function(c){b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!==c.value.backdrop&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).directive("modalWindow",["$timeout",function(a){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,template:'<div class="modal {{windowClass}}" x-ng-transclude></div>',link:function(b,c,d){b.windowClass=d.windowClass||"",a(function(){b.animate=!0})}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(a){var b=k.get(a).value;k.remove(a),b.modalDomEl.remove(),-1===e()&&(h.remove(),h=void 0),b.modalScope.$destroy()}var g,h,i=c.$new(!0),j=a.find("body").eq(0),k=d.createNew(),l={};return c.$watch(e,function(a){i.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(a,c){k.add(a,{deferred:c.deferred,modalScope:c.scope,backdrop:c.backdrop,keyboard:c.keyboard});var d=angular.element("<div modal-window></div>");d.attr("window-class",c.windowClass),d.attr("index",k.length()-1),d.html(c.content);var f=b(d)(c.scope);k.top().value.modalDomEl=f,j.append(f),e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(i),j.append(h))},l.close=function(a,b){var c=k.get(a);c&&(c.value.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",["$injector",function(a){var b={options:{backdrop:!0,keyboard:!0},$get:["$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(b){var c=[];return angular.forEach(b,function(b){(angular.isFunction(b)||angular.isArray(b))&&c.push(d.when(a.invoke(b)))}),c}var k={};return k.open=function(a){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(a=angular.extend({},b.options,a),a.resolve=a.resolve||{},!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(a)].concat(j(a.resolve)));return l.then(function(b){var d=(a.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;a.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(a.resolve,function(a,c){i[c]=b[j++]}),f=g(a.controller,i)),h.open(k,{scope:d,deferred:e,content:b[0],backdrop:a.backdrop,keyboard:a.keyboard,windowClass:a.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return b}]),angular.module("com.inthetelling.player").factory("cuePointScheduler",["$window",function(a){var b={};b.ENTER="enter",b.EXIT="exit";var c,d,e,f=[],g={},h=!1,i=function(a){return a.begin+"-"+a.end},j=function(a){d=a,h=!0},k=function(){if(h){var a,c,e=f.length;for(a=0;e>a;a++)c=f[a],c.isActive?(d<c.begin||d>=c.end)&&(c.isActive=!1,c.callback.call(void 0,{begin:c.begin,end:c.end},b.EXIT,d)):c.isActive||d>=c.begin&&d<c.end&&(c.isActive=!0,c.callback.call(void 0,{begin:c.begin,end:c.end},b.ENTER,d));h=!1}};return b.subscribe=function(a,b){return g[i(a)]=!0,f.push({begin:a.begin,end:a.end,callback:b,isActive:!1}),!0},b.unsubscribe=function(a){delete g[i(a)];var b,c=f.length;for(b=0;c>b;b++)if(f[b].begin===a.begin&&f[b].end===a.end){f.splice(b,1);break}return!0},b.registerProvider=function(b,d){return c?!1:(c=b,e=a.setInterval(k,d||1e3),j)},b.unregisterProvider=function(b){return c!==b?!1:(c=null,a.clearInterval(e),!0)},b}]),angular.module("com.inthetelling.player").factory("_",function(){return window._}),angular.module("com.inthetelling.player").factory("videojs",["config","$rootScope",function(a){var b={};return b.player=null,b.init=function(c,d){if(!b.player){var e={controls:!0,preload:!0,nativeControlsForTouch:!1};return e.techOrder=c.youtube?["youtube"]:["html5","flash"],videojs(a.videoJSElementId,e,function(){b.player=this,d&&d(b.player)}),!0}return!1},b}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config,b=window.location.href.match(/\/\/(.*)\.inthetelling.com/);return b&&(a.apiDataBaseUrl=a.apiDataBaseUrl.replace(/\/\/.*\.inthetelling.com/,"//"+b[1]+".inthetelling.com")),a}),angular.module("com.inthetelling.player").directive("ittScene",["$rootScope","$timeout","$window",function(a,b,c){return{restrict:"A",replace:!1,template:'<div ng-include="scene.templateUrl">Loading Scene...</div>',scope:{scene:"=ittScene"},link:function(d,e){d.twiddleSceneLayout=function(){b(function(){if(d.scene.isActive){var a=e.find(".videoContainer");if(d.scene.templateUrl.indexOf("scene-video.html")>-1)a.height()>angular.element(c).height()-200&&a.height(angular.element(c).height()-200);else if(d.scene.templateUrl.indexOf("scene-centered.html")>-1){var b=(angular.element(c).height()-a.width())/2;0>b&&(b=0),e.find(".scene-centered").css("paddingTop",b)}}e.find(".matchVideoHeight:visible").height(e.find(".videoContainer").height()),e.find(".stretchToViewportBottom:visible").each(function(){$(this).css("min-height",angular.element(c).height()-this.offsetTop-60)})}),angular.element(c).trigger("resize")},d.$watch(function(){return e.width()},d.twiddleSceneLayout),a.$on("toolbar.changedSceneTemplate",function(){d.twiddleSceneLayout(),b(d.twiddleSceneLayout,100)}),d.$watch("scene.isActive",d.twiddleSceneLayout)}}}]),angular.module("com.inthetelling.player").directive("ittItem",["modalMgr",function(a){return{restrict:"A",replace:!1,template:'<div ng-include="item.templateUrl">Loading Item...</div>',scope:{item:"=ittItem"},link:function(b,c,d){d.forceItemTemplate?(b.item.origTemplateUrl=b.item.templateUrl,"annotation"===b.item.type?b.item.templateUrl="templates/transcript-"+d.forceItemTemplate+".html":"upload"===b.item.type?b.item.templateUrl="templates/transmedia-image-"+d.forceItemTemplate+".html":"link"===b.item.type?"templates/transmedia-link-noembed.html"!==b.item.templateUrl&&(b.item.templateUrl="templates/transmedia-link-"+d.forceItemTemplate+".html"):console.warn("PROBABLE ERROR: unknown item type ",b.item),b.item.origLayout=b.item.layout,b.item.origStyles=b.item.styles,b.item.layout="",b.item.styles=""):b.item.origTemplateUrl&&(b.item.templateUrl=b.item.origTemplateUrl,b.item.layout=b.item.origLayout,b.item.styles=b.item.origStyles),b.toggleDetailView=function(){b.item.showInlineDetail?b.item.showInlineDetail=!1:c.closest(".content").width()>500?b.item.showInlineDetail=!b.item.showInlineDetail:a.createItemDetailOverlay(b)}},controller:"ItemController"}}]),angular.module("com.inthetelling.player").directive("ittVideo",["cuePointScheduler","videojs","$timeout","config","$rootScope",function(a,b,c,d,e){return{restrict:"A",replace:!1,template:'<div class="video"></div>',link:function(c,f){console.log("ITT-VIDEO LINKING FUNCTION: [scope:",c,"]"),f.find(".video").html(function(){var a='<video id="'+d.videoJSElementId+'" class="video-js vjs-story-skin" poster="'+c.episode.coverUrl+'">';return c.episode.videos.youtube?a+='<source type="video/youtube" src="'+c.episode.videos.youtube+'" />':(a+='<source type="video/mp4" src="'+c.episode.videos.mpeg4+'" />',a+='<source type="video/webm" src="'+c.episode.videos.webm+'" />'),a+=" </video>"}),c.setPlayhead=a.registerProvider(d.videoJSElementId,d.cuePointScanInterval),b.init(c.episode.videos,function(a){console.log("videojs init"),a.on("play",function(){a.hasPlayed||(a.hasPlayed=!0,e.$emit("toolbar.videoFirstPlay"),a.on("timeupdate",function(){c.setPlayhead(a.currentTime())}))});var b=c.$watch(function(){return a.duration()},function(d){if(0!==d){b();for(var e={setting:{},marker_breaks:[],marker_text:[]},f=0;f<c.scenes.length;f++)c.scenes[f].title&&(e.marker_breaks.push(c.scenes[f].startTime),e.marker_text.push(c.scenes[f].title));a.markers(e),a.trigger("loadedmetadata")}})})}}}]),angular.module("com.inthetelling.player").directive("ittMagnet",["$window","$timeout","$rootScope",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=function(){b(function(){c.$emit("magnet.activated",e)},0)};if(d.scene){var g=function(){d.scene&&d.scene.isActive&&f()};d.$watch("scene.isActive",function(a,b){a&&a!==b&&f()});var h=c.$on("toolbar.changedSceneTemplate",g);angular.element(a).bind("resize",g),d.$on("$destroy",function(){h(),angular.element(a).unbind("resize",g)})}else f()}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){var d=function(a,b){var d;0===b.height()?(console.warn("Videocontainer height appears to be zero; forcing to 16:9 aspect ratio"),d=9*b.width()/16):d=b.height(),"fixed"===b.css("position")?(c.css("position","fixed"),c.offset(b.offset()),c.width(b.width()),c.height(d)):(c.css("position","absolute"),c.offset(b.offset()),c.width(b.width()),c.height(d))},e=a.$on("magnet.activated",d);b.$on("$destroy",function(){e()})}}}]),angular.module("com.inthetelling.player").directive("ittToolbar",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/toolbar/toolbar.html",link:function(){},controller:"ToolbarController"}}),angular.module("com.inthetelling.player").directive("ittContentPane",["$filter",function(a){return{restrict:"A",replace:!1,scope:!0,templateUrl:"templates/contentpane.html",link:function(b,c,d){b.pane=d.pane||"main",b.contentLayout=d.content||"content",b.itemlist=a("layout")(b.scene.items,b.contentLayout),b.showCurrent=b.scene.showCurrent||d.showCurrent,"templates/scene-explore.html"===b.scene.templateUrl&&(b.showCurrent=!1),b.forceItemTemplate=d.forceItemTemplate;var e=function(){if(d.noSidebars)return b.noSidebars=!0,void 0;for(var a=0;a<b.itemlist.length;a++){var c=b.itemlist[a].layout;"burst"===c?(b.hasLeftSidebar=!0,b.hasRightSidebar=!0):"sidebarL"===c||"burstL"===c?b.hasLeftSidebar=!0:("sidebarR"===c||"burstR"===c)&&(b.hasRightSidebar=!0)}};b.$watch(function(){return c.width()},function(a){a>0&&450>a?(b.noSidebars=!0,b.hasLeftSidebar=!1,b.hasRightSidebar=!1):e()},!0)}}}]),angular.module("com.inthetelling.player").filter("type",function(){return function(a,b){if(b){var c,d=[];for(c=0;c<a.length;c++)b[a[c].type]&&d.push(a[c]);return d}return[]}}),angular.module("com.inthetelling.player").filter("layout",function(){return function(a,b){if(!a||!b)return[];var c,d=[];if("required"===b||"optional"===b||"transcript"===b||"transmedia"===b||"content"===b)for(c=0;c<a.length;c++)a[c].inContentPane&&("transcript"===b?"annotation"===a[c].type&&d.push(a[c]):"transmedia"===b?"annotation"!==a[c].type&&d.push(a[c]):"required"===b?("annotation"===a[c].type||a[c].required)&&d.push(a[c]):"optional"===b?"annotation"===a[c].type||a[c].required||d.push(a[c]):d.push(a[c]));else for(c=0;c<a.length;c++)a[c].layout===b&&d.push(a[c]);return d}}),angular.module("com.inthetelling.player").filter("itemList",function(){return function(a,b){if(b){var c,d=[];for(c=0;c<a.length;c++)a[c].isActive&&d.push(a[c]);return d}return a}}),angular.module("com.inthetelling.player").filter("highlight",["$sce",function(a){return function(b,c){return c||angular.isNumber(c)?a.trustAsHtml(b.toString().replace(new RegExp(c.toString(),"gi"),'<span class="ui-match">$&</span>')):b}}]);