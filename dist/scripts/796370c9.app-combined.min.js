"use strict";angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/root.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/producer",{title:"Available episodes",templateUrl:"templates/producer/episodelist.html"}).when("/episodes",{title:"Available episodes",templateUrl:"templates/producer/episodelist.html"}).when("/producer/questioneditor",{title:"Plugin authoring for standalone questions",controller:"QuestionAuthoringController",templateUrl:"templates/producer/questionauthoring.html",reloadOnSearch:!1}).when("/producer/:epId",{title:"Producer",controller:"EpisodeEditorController",templateUrl:"templates/producer/episode.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"});var b=!1;$(document).on("keydown",function(c){b||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||(b=!0,27===c.keyCode&&(a.$emit("userKeypress.ESC"),c.preventDefault()),32===c.which&&(a.$emit("userKeypress.SPACE"),c.preventDefault()))}),$(document).on("keyup",function(){b=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","errorSvc",function(a,b){return{responseError:function(c){return b.error(c),a.reject(c)}}}])}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/copyright.html","TELLING STORY player &#169; <span ng-bind-html=\"{{now | date:'yyyy'}}\"></span> <a href=https://inthetelling.com>IN THE TELLING</a>. All rights reserved. <a href=/privacy.html target=_new>Privacy Policy</a>"),a.put("templates/episode/columbia.html",'<div class="episode episode-columbia" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/columbia.svg alt="Columbia University"></div></div>'),a.put("templates/episode/columbiabusiness.html",'<div class="episode episode-columbiabusiness" ng-class=episode.styleCss><div class="fill trident"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/cbs-logo.svg alt="Columbia Business School"></div></div>'),a.put("templates/episode/components/discovermode.html",'<div class=discoverMode ng-show="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene=scene episode=episode></div></div>'),a.put("templates/episode/components/reviewmode.html",'<div class=reviewMode ng-show="appState.viewMode == \'review\'"><div itt-magnet="" id=reviewModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div><div class=scene ng-class="{navigable: scene.display_title}" ng-repeat="scene in episode.scenes" ng-if=!scene._internal><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class=sceneTitle ng-if=scene.display_title ng-bind-html=scene.display_title></h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items| reviewMode | orderBy:\'start_time\'" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item=item forcetemplate=review-all></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | reviewMode | annotation | orderBy:\'start_time\'" ng-class=item.state itt-item=item forcetemplate=review-annotation></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src=images/aspectratiopreserver-16x9.gif class=videoPadding> <div class="item animate" ng-repeat="item in scene.items | reviewMode | transmedia" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item=item forcetemplate=review-transmedia></div></div></div></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><div class="video contentLayer" itt-video=episode.masterAsset></div><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<div ng-if="appState.viewMode == \'watch\'" style="padding-bottom: 100%"><div class=watchMode><div itt-magnet="" id=watchModeVideoMagnet class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif></div></div><span class=watchModeCaptions ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class=item.state itt-item=item forcetemplate=caption></div></span></div>'),a.put("templates/episode/components/windowfg.html",'<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer"><div class=overflowY><div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div><a ng-if="appState.timelineState == \'paused\'" class=button-continue ng-click=play()><span>Continue</span></a></div></div>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href=http://www.mindwires.com><img src=images/customer/eliterate-mindwires.svg alt="Mindwires logo"></a> <a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/eliterate-logo.svg alt=E-Literate></div></div>'),a.put("templates/episode/episode.html",'<div class=episode ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/ewb-logo.svg alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/gw-logo.svg alt="George Washington"></div></div>'),a.put("templates/episode/gwlaw.html",'<div class="episode episode-gw" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/gw-law.jpg alt="GW Law"></div></div>'),a.put("templates/episode/middlebury.html",'<div class="episode episode-middlebury" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span class="colorInvert DiscoverModeOnly" ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt-incolor.svg alt="In The Telling logo"></a> <a class=logo href=http://middlebury.edu><img src=images/customer/middlebury-shield.svg alt="Middlebury logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/middlebury-logo.svg alt=Middlebury></div></div>'),a.put("templates/episode/prolotherapy.html",'<div class="episode episode-prolotherapy" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/prolotherapy-text.svg alt="American Association of Musculoskeletal Medicine"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/purdue-logo.svg alt=Purdue></div></div>'),a.put("templates/episode/schoolclimatesolutions.html",'<div class="episode episode-schoolclimatesolutions" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/schoolclimatesolutions.svg alt="SCS: School Climate Solutions"></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/tellingstory-logo.svg alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class=episode.styleCss><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href=http://inthetelling.com><img src=images/itt.svg alt="In The Telling logo"></a> <span class=copyright ng-include="\'templates/copyright.html\'"></span></div><div class=banner-logo><img src=images/customer/usc-logo.svg alt=USC></div></div>'),a.put("templates/error-404.html","<div class=errors><div class=error><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>"),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class=errors><div class=error ng-repeat="error in errorSvc.errors"><a style="float: right" ng-click=dismiss(error)>[x]</a><h3>Error: {{error.cause || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if=error.exception.config.url><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if=user.login_url><a ng-if=user.login_via_top_window_only ng-click=resetAuth(); ng-href={{user.login_url}} target=_top>click here</a> <a ng-if=!user.login_via_top_window_only ng-click=resetAuth(); ng-href={{user.login_url}}>click here</a> to log back in.</span> <span ng-if=!user.login_url><a ng-click="resetAuth(); reload();">reset your session</a> and start over.</span></p></div><div class=notification ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click=dismiss(notification)>[x]</a><p>{{notification.text}}</p></div></span>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/debug.html","<div class=itemTemplate><pre ng-if=itemDebug>{{item | pretty}}</pre></div>"),a.put("templates/item/image-caption-sliding.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div><div class="caption slidingcaption"><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-caption.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div><div class=caption><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div></div><div class=clear></div></div>'),a.put("templates/item/image-fill.html",'<div class="itemTemplate imageFill" style={{item.backgroundImageStyle}} ng-style="{\'backgroundImage\':item.asset.cssUrl}"><img class=fillImg ng-src={{item.asset.url}} alt={{item.asset.description}}></div>'),a.put("templates/item/image-inline-withtext.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title ng-if=item.display_title ng-bind-html=item.display_title></div><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div><div ng-bind-html=item.display_description></div><div class=clear></div></div></div>'),a.put("templates/item/image-inline.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div><div class=clear></div></div>'),a.put("templates/item/image-linkonly.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div class=text ng-bind-html=item.display_description></div></div><div class=clear></div></div>'),a.put("templates/item/image-plain.html",'<div class="itemTemplate imagePlain"><div class=touchable><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div></div>'),a.put("templates/item/image-thumbnail.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click=toggleDetailView()><img ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div><div class=text><div class=title ng-bind-html=item.display_title></div><div class=text ng-bind-html=item.display_description></div></div><div class=clear></div></div>'),a.put("templates/item/image.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a class=fakeLink role=button tabindex=0 ng-click=toggleDetailView() x-ng-keypress=toggleDetailOnKeyPress($event) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail x-ng-if=item.showInlineDetail><div class=touchable style=position:relative><img x-ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div></div><div class=clear></div></div>'),a.put("templates/item/link-descriptionfirst.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div ng-bind-html=item.display_description></div><div class=title><a tabindex=0 ng-if="item.noEmbed && !item.targetTop" class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if="item.noEmbed && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if=!item.noEmbed ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/link-embed.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title ng-bind-html=item.display_title></div><div ng-bind-html=item.display_description></div></div><a tabindex=0 class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div><div class=clear></div></div>'),a.put("templates/item/link-withimage.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><span ng-if=item.noEmbed><span ng-if=!item.targetTop><div class=title><a tabindex=0 class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)><img ng-src={{item.asset.url}} alt={{item.asset.description}}></a></span> <span ng-if=item.targetTop><div class=title><a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)><img ng-src={{item.asset.url}} alt={{item.asset.description}}></a></span></span> <span ng-if=!item.noEmbed><div class=title><a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class=fakeLink tabindex=0 ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><img ng-click=toggleDetailView() ng-src={{item.asset.url}} alt={{item.asset.description}}></span></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div>'),a.put("templates/item/link.html",'<div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 ng-if="item.noEmbed && !item.targetTop" class=escapelink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 ng-if="item.noEmbed && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a role=button tabindex=0 ng-if=!item.noEmbed x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if=item.showInlineDetail><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=clear></div></div>'),a.put("templates/item/modal.html","<div class=modal ng-click=dismiss();><div ng-if=\"item._type == 'Link'\" class=modalmenu><a href={{item.url}} target=_blank class=escapelink>(new window)</a></div><div ng-if=\"item._type == 'Link'\" class=iframeContainer><div ng-include=\"'templates/loading.html'\"></div><iframe ng-src={{item.url}}></iframe></div><div class=modalimage ng-if=\"item._type == 'Upload'\"><img ng-src={{item.asset.url}} alt={{item.asset.description}}></div></div>"),a.put("templates/item/pullquote-noattrib.html",'<div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.display_annotation></div></div>'),a.put("templates/item/pullquote.html",'<div class="itemTemplate headerItem"><div class=pullquote ng-bind-html=item.display_annotation></div><div class=pullquoteSpeaker ng-bind-html=item.display_annotator></div></div>'),a.put("templates/item/question-mc-formative.html",'<div class="itemTemplate multipleChoiceQuestion"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=question><p ng-bind-html=plugin.questiontext></p><div ng-repeat="distractor in plugin.distractors"><label ng-class="{\n				correct: plugin.hasBeenAnswered && distractor.correct,\n				incorrect: plugin.hasBeenAnswered && !distractor.correct\n			}"><input ng-change=scoreQuiz($index) type=radio name=fnord ng-disabled=plugin.hasBeenAnswered ng-model=$parent.plugin.selectedDistractor value={{$index}}><span ng-bind-html=distractor.text></span></label></div><div ng-if=plugin.hasBeenAnswered><div ng-if=plugin.distractors[plugin.selectedDistractor].correct ng-bind-html=plugin.correctfeedback></div><div ng-if=!plugin.distractors[plugin.selectedDistractor].correct ng-bind-html=plugin.incorrectfeedback></div></div></div></div>'),a.put("templates/item/question-mc-poll.html",'<div class="itemTemplate pollQuestion"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=question><p ng-bind-html=plugin.questiontext></p><div ng-if=!plugin.hasBeenAnswered ng-repeat="distractor in plugin.distractors"><label><input ng-change=scorePoll() type=radio name=fnord ng-disabled=plugin.hasBeenAnswered ng-model=$parent.plugin.selectedDistractor value={{$index}}><span ng-bind-html=distractor.text></span></label></div><br><div ng-if=plugin.hasBeenAnswered><p>Here\'s how others answered this question: (your choice was <b ng-bind-html=plugin.distractors[plugin.selectedDistractor].text></b>)</p><p>TODO: insert beautiful chart of user responses</p></div></div></div>'),a.put("templates/item/review-all.html","<span><div ng-if=\"item._type == 'Annotation'\" ng-include=\"'templates/item/review-annotation.html'\"></div><div ng-if=\"item._type != 'Annotation'\" ng-include=\"'templates/item/review-transmedia.html'\"></div></span>"),a.put("templates/item/review-annotation.html",'<div><div ng-if=item.isTranscript class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div></div><div ng-if=!item.isTranscript ng-include=item.templateUrl></div><div class=clear></div></div>'),a.put("templates/item/review-transmedia.html",'<span><div ng-if="item._type == \'Annotation\'" ng-include="\'templates/item/review-annotation.html\'"></div><span ng-if="item._type != \'Annotation\'"><div ng-if="item.data._pluginType == \'credlyBadge\'" ng-include="\'templates/item/usc-badges.html\'"></div><div ng-if="item.data._pluginType != \'credlyBadge\'" class=itemTemplate><div class=itemHead><a role=button tabindex=0 class="startTime displayTime" aria-label="Seek video to {{item.displayStartTime}}" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=category><span ng-if=item.required>(Required viewing)</span></div></div><div class=text><div class=title><a tabindex=0 ng-if=item.noEmbed class="fakeLink escapelink" ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\'"></a> <a tabindex=0 role=button class=fakeLink ng-if=!item.noEmbed x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\'" aria-label="Toggle detail display of {{item.display_title}}"></a></div><div ng-bind-html=item.display_description></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type == \'Link\'"><a tabindex=0 ng-if=!item.noExternalLink x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class=escapelink>(new window)</a><div class=iframeContainer><div ng-include="\'templates/loading.html\'"></div><iframe ng-src={{item.url}}></iframe></div></div><div class=itemDetail ng-if="item.showInlineDetail && item._type != \'Link\'"><div class=touchable style=position:relative><img ng-click=forceModal() ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=touchableIndicator></div></div></div><div class=clear></div></div></span></span>'),a.put("templates/item/searchresults.html",'<div><span class=displayTime><button tabindex=2 ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</button></span> <span class=type ng-bind-html="(item.display_title || item.display_annotator) | highlightSubstring: searchText"></span><div class=description ng-bind-html="(item.display_description || item.display_annotation) | highlightSubstring: searchText"></div></div>'),a.put("templates/item/text-h1.html",'<div class="itemTemplate headerItem"><h1 ng-bind-html=item.display_annotation></h1></div>'),a.put("templates/item/text-h2.html",'<div class="itemTemplate headerItem"><h2 ng-bind-html=item.display_annotation></h2></div>'),a.put("templates/item/text-transmedia.html",'<div><div class=itemTemplate><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><h2 ng-if=item.display_title ng-bind-html=item.display_title></h2></div><div class=text ng-bind-html=item.display_annotation></div></div><div class=clear></div></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<div class="itemTemplate transcriptWithThumbnail"><div class=icon style="float:right; margin-right: 0.5em"><img ng-src={{item.asset.url}} alt={{item.asset.description}}></div><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class=authorName ng-bind-html=item.display_annotator></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<div class="itemTemplate transcriptWithThumbnail"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class=icon style="float:left; margin-right: 0.5em"><img ng-src={{item.asset.url}} alt={{item.asset.description}}><div class=clear></div></div><div class=authorName ng-bind-html=item.display_annotator></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/transcript.html",'<div class="itemTemplate transcript"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class=authorName ng-bind-html=item.display_annotator></div></div><div class=text ng-bind-html=item.display_annotation></div><div class=clear></div></div>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges"><div class=itemHead><a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><img style="max-width: 5em; float:left; margin-right: 0.5em" ng-src={{plugin.credlyImageUrl}} alt={{item.asset.description}}> <b>{{plugin.achievement}}</b> <span ng-if=plugin.eligibleForBadges><p>Complete the following requirements to earn a <a ng-href=https://credly.com/recipients/{{plugin.credlyBadgeId}} target=_new>USC Scholar\'s Badge</a>:</p><div style="clear:both; margin: 1em 1.2em; font-size:90%"><div ng-repeat="req in plugin.requirements"><img ng-if=req.achieved style="width: 1em; height: 1em; margin-left: -1.2em" src=/images/checkmark.png> <img ng-if=!req.achieved style="width: 1em; height: 1em; margin-left: -1.2em" src=/images/checkmark-empty.png> <span>{{req.name}}</span></div></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement.</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"><p>Congratulations! You are eligible for a USC Scholarâ€™s Badge. Enter your email address to claim it:</p><input ng-model=plugin.userEmail><input type=button value=Go ng-click=badger()><span ng-if=plugin.gettingBadge><small>Getting your badge...</small></span><div ng-if=plugin.error><small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small></div></div><div ng-if=plugin.gotBadge>Your badge is in the mail. <span ng-if=plugin.alreadyHadBadge>(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div></span> <span ng-if=!plugin.eligibleForBadges><p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p></span><br><br></div>'),a.put("templates/loading.html",'<div class=loading><div class=spinner><div class="rotating pie"></div><div class="filler pie"></div><div class=mask></div></div>Loading</div>'),a.put("templates/player.html",'<div class=player ng-class="{\n	isFramed: appState.isFramed,\n	guestUser: appState.user.isGuestUser\n	}"><div class=toolbar><div class="modegroup buttongroup"><nav role=navigation><button tabindex=0 class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')" aria-label=Watch><span>Watch</span></button> <button tabindex=0 class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')" aria-label=Discover><span>Discover</span></button> <button tabindex=0 class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')" aria-label=Review><span>Review</span></button></nav></div><div ng-if=appState.isFramed class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-click=pause() ng-href="/v1/new_window/{{appState.episodeId}}?t={{appState.time}}" target=_new><span>New window</span></a></div><div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><button tabindex=2 class="button button-search" ng-click=toggleSearchPanel() aria-label=Search aria-expanded={{show.searchPanel}}><span>Search</span></button><label for=searchtext class=hidden>Search Text</label><input tabindex=2 name=searchtext id=searchtext ng-show=show.searchPanel ng-model=searchText></div></div><div ng-if=loading ng-include="\'templates/loading.html\'"></div><div itt-episode=""></div><div class=toolbar-bottom itt-show-hide-visual-only=appState.videoControlsActive ng-mouseenter=showControls(); ng-click=showControls(); ng-mouseleave=allowControlsExit()><div class=toolbar-bottom-fill><div ng-show=show.navPanel class=navPanel ng-class=episode.styleCss><div class=parent ng-repeat="parent in episode.parents" ng-bind-html=parent.display_name></div><h2 ng-bind-html=episode.display_title></h2><div class=scene x-ng-if=scene.display_title x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click=seek(scene.start_time)><span class=displayTime>{{scene.displayStartTime}}</span><p><button tabindex=0 ng-bind-html=scene.display_title x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus=showControls()></button><br><span ng-bind-html=scene.display_description></span></p></div><div class=crossEpisode><a class=prevEpisode ng-if=episode.previousEpisodeContainer ng-href=/#/{{appState.crossEpisodePath}}/{{episode.previousEpisodeContainer.episodes[0]}} title={{episode.previousEpisodeContainer.display_name}}>Previous episode</a> <a class=nextEpisode ng-if=episode.nextEpisodeContainer ng-href=/#/{{appState.crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}} title={{episode.nextEpisodeContainer.display_name}}>Next Episode</a></div></div><div itt-timeline=""></div></div></div><div class=toolbar-bottom-controltrigger ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls()></div></div><div class=autoscroll ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click=enableAutoscroll()><img src=/images/autoscroll.svg width=32 height=32></div><div ng-show="show.navPanel || show.searchPanel || show.helpPanel" class=modal-backdrop ng-click=hidePanels()></div><div ng-show=appState.itemDetail class=modal-backdrop ng-click="appState.itemDetail=false"></div><div ng-if=appState.itemDetail itt-item-detail-modal=appState.itemDetail></div><div ng-show=show.searchPanel class=searchPanel><div ng-if=show.searchPanel itt-search-panel="">This will be the search panel</div></div><div id=helpModal tabindex=-1 aria-hidden={{!show.helpPanel}} ng-show=show.helpPanel itt-show-focus=show.helpPanel class=helpPanel aria-labelledby="modalHelpTitle modalHelpDescription" role=dialog><div class=arrow-up></div><div id=modalHelpDescription class=screen-reader-offscreen>Help dialog window. Don\'t show this again link will close the window and prevent it from returning. Escape will cancel and close the window.</div><h1 id=modalHelpTitle>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</h1><ul><li class=video><h3>Watch</h3><p>Just the video, no frills.</p></li><li class=directed><h3>Discover</h3><p>The guided, synchronized view of the video and related content.</p></li><li class=explore><h3>Review</h3><p>Read the full transcript and all the related transmedia in one convenient list.</p></li></ul><input type=button value="Don\'t show this again" class=goAway x-ng-click=noMoreHelp() href="javascript:void 1;"></div><div ng-controller=ErrorController ng-include="\'templates/error.html\'"></div>'),a.put("templates/producer/episodelist.html",'<div ng-controller=EpisodeListController style=margin:1em><div ng-if=loading ng-include="\'templates/loading.html\'"></div><div ng-repeat="customer in containers"><h2 ng-click="customer.hidden = !customer.hidden" style="cursor: pointer; width:100%; background-color:#EEE">{{customer.name.en}}</h2><div ng-if=!customer.hidden ng-repeat="course in customer.children"><h3 style=cursor:pointer ng-click="course.visible=!course.visible">{{course.name.en}}</h3><div ng-if=course.visible style=margin-left:2em ng-repeat="session in course.children"><h4>{{session.name.en}}</h4><ul><li ng-repeat="episodecontainer in session.children"><a href=#episode/{{episodecontainer.episodes[0]}}>[View]</a> {{episodecontainer.name.en}} <small style=opacity:0.2>{{episodecontainer.episodes[0]}}</small></li></ul></div></div></div></div><div x-ng-controller=ErrorController x-ng-include="\'templates/error.html\'"></div>'),a.put("templates/producer/questionauthoring.html",'<div style=margin:1em><p>This is a standalone editor for question items. Fill in the fields below, then copy the JSON data below into the existing authoring tool. To edit an existing question paste its JSON into the json field and the editor will separate it out into editable fields.</p><table class=authoringForm><tr><td class=label>Question type<td><select ng-model=question.questiontype><option value=mc-poll>Poll<option value=mc-formative>Formative</select><tr><td class=label>Question text<td><textarea rows=4 ng-model=question.questiontext>\n				</textarea><tr><td colspan=2>Answer choices. <span ng-if="question.questiontype == \'mc-formative\'">Check the correct answer (if more than one is selected, either will count as correct).</span>To remove an answer choice, just leave it blank.<tr ng-repeat="distractor in question.distractors"><td class=label><input type=checkbox ng-model=distractor.correct ng-if="question.questiontype == \'mc-formative\'"><td><input ng-model=distractor.text><tr><td class=label><a ng-click=addDistractor()>add another</a><td><tr ng-if="question.questiontype == \'mc-formative\'"><td class=label>Feedback for correct answer<td><input ng-model=question.correctfeedback><tr ng-if="question.questiontype == \'mc-formative\'"><td class=label>Feedback for incorrect answer<td><input ng-model=question.incorrectfeedback><tr><td colspan=2><br><hr><br><tr><td class=label>JSON data: <span ng-if=editwarning>Invalid JSON!</span><td><textarea rows=10 ng-model=pluginjson></textarea></table><br><hr><br><p class=label>Question preview:</p><div class=item><div ng-if=preview itt-item=questionpreview></div></div></div>'),a.put("templates/root.html",'<div style="background-color: #333; position:fixed; top:0;left:0;right:0;bottom:0; padding: 4em"><div style="width:100%; height:100%;background: url(\'images/itt.svg\') 50% 50% no-repeat; background-size:contain"></div></div>'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class=videoMagnet ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div><div class=col><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div></div><div class="col col1"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight alt="" aria-hidden=true><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div><div class="col col2"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight alt="" aria-hidden=true><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div></div><div class="col col1"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight alt="" aria-hidden=true><div class=clear></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class="col col2"><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><img src=images/aspectratiopreserver-16x9.gif class=matchVideoHeight alt="" aria-hidden=true><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class=row><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=row><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class=col><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div><div class="pane mainPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{singleitem: mainItems.length==1, isNarrow: isNarrow}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div><div class=col><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/endingscreen.html",'<div class="endingscreen stretchToViewport"><div class="pane introtext"><p>Thanks for watching <span ng-bind-html=episode.display_title></span>.</p><br><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div></div></div>'),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewportShort"><div class="pane introtext"><h1 ng-bind-html=episode.display_title></h1><p ng-bind-html=episode.display_description></p></div><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div><div class=clear></div></div>'),a.put("templates/scene/pip.html",'<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div><div class=clear></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div><div ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class=videoPositioner><div itt-magnet="" class=videoMagnet><img src=images/aspectratiopreserver-16x9.gif alt="" aria-hidden=true></div></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class="content contentLayer showCurrent" ng-class="{\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div><div class=clear></div></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div></div></div>'),a.put("templates/searchpanel.html",'<div ng-class=episode.styleCss><div aria-label="sort toggle" class=searchfilters aria-controls=sortableSearch>Sorted by <button tabindex=0 class=fakeLink ng-click=toggleSortBy(sortBy) aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button></div><div class=scrollContainer><div class=searchResults id=sortableSearch><div ng-if="sortBy == \'startTime\'"><div ng-repeat="scene in episode.scenes"><h3 ng-if="sceneItems.length > 0 && scene.display_title" ng-bind-html=scene.display_title></h3><div class=item ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText, \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'"></div></div></div><div ng-if="sortBy == \'type\'"><div ng-repeat="(typeID,showType) in searchTypes" ng-if=showType><h3 ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3><div class=item ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\"></div></div></div><div ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">(Nothing matched your search.)</div></div></div></div>"),a.put("templates/timeline.html",'<div class=timeline><button tabindex=0 ng-focus=showControls() class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click=play()><span class=control-text>Play</span></button> <button tabindex=0 ng-focus=showControls() class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click=pause()><span class=control-text>Pause</span></button><div class=progressbarBox><div class=pbarTop></div><div class=pbarMain><div class=progressbar><div class=mask style=overflow:hidden><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=buffered ng-style="{width: appState.bufferedPercent+\'%\'}"></div><div class=played ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class=progressbarContainer style="width: {{zoomLevel}}00%"><div class=handle ng-show=isSeeking ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class=tip ng-show=seekHandleVisible>{{willSeekTo | asTime}}</div></div><div class=tooltip ng-if="event.showTooltip && event.display_title" ng-repeat="event in timeline.markedEvents " ng-style="{left: markerPercent(event.start_time)+\'%\'}"><span class=content ng-bind-html=event.display_title></span> </div></div><div class="playhead mask"><div class=progressbarContainer ng-style="{width: zoomLevel+\'00%\'}"><div class=marker ng-mouseover=showTooltip(event); ng-mouseout=hideTooltip(event) ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"></div></div></div></div><button ng-focus=showControls() ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click=prevScene()><span class=control-text>Previous</span></button><div class="tooltip sceneMenuTooltip" ng-if=sceneMenuToolTip><span class=content>Scene-by-scene navigation</span> </div><button ng-focus=showControls() tabindex=0 class=button-scenemenu ng-click=showSceneMenuTooltip(false);toggleNavPanel(); ng-mouseover=showSceneMenuTooltip(true) ng-mouseout=showSceneMenuTooltip(false)><span class=control-text>Scenes</span></button> <button ng-focus=showControls() tabindex=0 ng-class="{invisible: appState.time >= appState.duration-0.1}" class="button button-next" ng-click=nextScene()><span class=control-text>Next</span></button></div><div class=pbarBottom><span class=timedisplay>{{appState.time | asTime}} / {{appState.duration | asTime}} <span class=speedcontrol ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(-0.25) aria-label="Slow down video"><div ng-class="{arrowLeft: appState.timeMultiplier > 0.5}"></div></button> <span class=speeddisplay ng-click=resetSpeed()>{{appState.timeMultiplier}}x</span> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(0.25) aria-label="Speed up video"><div ng-class="{arrowRight: appState.timeMultiplier < 2}"></div></button></span></span> <span style=display:inline-block;height:1em;position:relative ng-if="episode.languages.length > 1"><select size=1 ng-model=appState.lang class=languageSelector ng-change=setNewLanguage() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></span> <button ng-focus=showControls() tabindex=0 ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class=control-text>Captions</span></button>  <span ng-if=!appState.isTouchDevice><button ng-focus=showControls() tabindex=0 class="button button-mute {{audioIcon()}}" ng-click=toggleMute()><span class=control-text>Mute</span></button><itt-volume-slider></itt-volume-slider></span></div></div></div>'),a.put("templates/video.html","<div class=video><iframe tabindex=-1 id=ytplayer{{uid}} ng-if=video.urls.youtube ng-src=\"{{video.urls.youtube + '?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&wmode=opaque&rel=0'}}\"></iframe><video ng-if=!video.urls.youtube aria-label=\"media player\"><source class=mpeg4 ng-if=video.urls.mpeg4 ng-src={{video.urls.mpeg4}} type=video/mp4><source class=webm ng-if=video.urls.webm ng-src={{video.urls.webm}} type=video/webm><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-click=videoClick() class=videoMask ng-class=\"{\n		play: appState.timelineState == 'paused',\n		buffering: appState.timelineState == 'buffering',\n		firstplay: !appState.hasBeenPlayed,\n		rewind: (appState.time > 0 && appState.time >= video.duration - 0.3)\n	}\"></div></div>")
}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","config",function(a,b){var c={};return c.init=function(){c.user=c.user||{},c.episodeId=!1,c.isFramed=window.parent!=window,c.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),c.windowWidth=0,c.windowHeight=0,c.viewMode=$(window).width()>480?"discover":"review",c.time=0,c.bufferedPercent=0,c.timeMultiplier=1,c.duration=0,c.timelineState="paused",c.hasBeenPlayed=!1,c.volume=100,c.muted=!1,c.hideCaptions=!1,c.show={searchPanel:!1,helpPanel:!1,navPanel:!1},c.videoControlsActive=!1,c.itemDetail=!1,c.autoscroll=!1,c.autoscrollBlocked=!1,c.editing=!1,c.lang="en"},c.init(),a(function(){c.windowHeight=angular.element(window).height(),c.windowWidth=angular.element(window).width()},50,0,!1),c.isTouchDevice&&(document.getElementById("CONTAINER").className="touchDevice"),b.debugInBrowser,c}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","appState",function(a,b,c,d,e,f){var g={};g.userHasRole=function(a){if(f.user==={})return!1;for(var b=0;b<f.user.roles.length;b++)if(f.user.roles[b]===a)return!0;return!1};var h,i=d.defer();return g.authenticate=function(){if(h)return i.promise;if(h=!0,b.key){var a=b.key;e.search("key",null),g.getAccessToken(a).then(function(){i.resolve()})}else if(c.defaults.headers.common.Authorization)f.user==={}&&(f.user=g.getStoredUserData()),i.resolve();else{var d=g.getStoredUserData();d?(f.user=d,c.defaults.headers.common.Authorization='Token token="'+d.access_token+'"',i.resolve()):g.getNonce().then(function(a){g.getAccessToken(a).then(function(){i.resolve()})})}return i.promise},g.getStoredUserData=function(){var b;if(localStorage&&localStorage.getItem(a.localStorageKey)){var c=angular.fromJson(localStorage.getItem(a.localStorageKey)),d=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];c.customer===d?(b=c,c.roles&&1===c.roles.length&&"guest"===c.roles[0]&&(b.isGuestUser=!0)):(localStorage.removeItem(a.localStorageKey),b=!1)}return b},g.getNonce=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url?a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url:b.reject()}).error(function(){b.reject()}),b.promise},g.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(b){b.customer=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],f.user=b;try{localStorage.setItem(a.localStorageKey,JSON.stringify(b))}catch(d){}c.defaults.headers.common.Authorization='Token token="'+b.access_token+'"',e.resolve(b)}).error(function(){e.reject()}),e.promise},g}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc","errorSvc","mockSvc",function(a,b,c,d,e,f,g,h,i){var j={};j.getEpisode=function(a){if(!a)throw"no episode ID supplied to dataSvc.getEpisode";g.episodes[a]||(g.cache("episode",{_id:a}),c.local?i.mockEpisode(a):f.authenticate().then(function(){return n()}).then(function(){return p(a)}))};var k={template:{},layout:{},style:{}},l=!1,m=a.defer(),n=function(){return l?m.promise:(l=!0,a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){j.cache("templates",a[0].data),j.cache("layouts",a[1].data),j.cache("styles",a[2].data),l=!0,m.resolve()},function(){l=!1,m.reject()}),m.promise)};j.cache=function(a,b){angular.forEach(b,function(b){"templates"===a?k.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?k.layout[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name}:"styles"===a&&(k.style[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name})})};var o=function(a){if(a.template_id&&(k.template[a.template_id]?(a.templateUrl=k.template[a.template_id].url,delete a.template_id):h.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){k.layout[a]?b.push(k.layout[a].css_name):h.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b)}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){k.style[a]?c.push(k.style[a].css_name):h.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c)}return a},p=function(a){b.get(e.apiDataBaseUrl+"/v3/episodes/"+a).success(function(b){"Published"===b.status||f.userHasRole("admin")?(g.cache("episode",o(b)),q(a),r(b.container_id,a)):h.error({data:"This episode has not yet been published."})}).error(function(){h.error({data:"API call to /v3/episodes/"+a+" failed (bad episode ID?)"})})},q=function(a){b.get(e.apiDataBaseUrl+"/v3/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",o(a))}),g.resolveEpisodeEvents(a)})},r=function(a,c){b.get(e.apiDataBaseUrl+"/v3/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&r(a[0].parent_id,c)}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)})},s={},t=function(c,d){var g=a.defer();return s[c]&&g.resolve(s[c]),f.authenticate().then(function(){return b.get(e.apiDataBaseUrl+c)}).then(function(a){var b=a.data;return d&&(b=d(b)),s[c]=b,g.resolve(b)}),g.promise},u=function(c,d){var f=a.defer();return b({method:"PUT",url:e.apiDataBaseUrl+c,data:d}).success(function(a){return f.resolve(a)}).error(function(){return f.reject()}),f.promise};return j.getAllContainers=function(){return t("/v3/containers",function(a){return a})},j.storeItem=function(a){return a=j.prepItemForStorage(a),a._id?u("/v2/events/"+a._id,{event:a}):void 0},j.prepItemForStorage=function(a){return delete a.asjson,delete a.styleCss,delete a.layoutCss,delete a.isContent,delete a.isTranscript,delete a.isFuture,delete a.isPast,delete a.isCurrent,delete a.edit,delete a.$$hashKey,delete a.noEmbed,delete a.noExternalLink,delete a.targetTop,delete a.asset,a.style_id=[],angular.forEach(a.styles,function(b){var c=j.readCache("style","css_name",b);c?a.style_id.push(c.id):h.error({data:"Tried to store a style with no ID: "+b})}),delete a.styles,a.layout_id=[],angular.forEach(a.layouts,function(b){var c=j.readCache("layout","css_name",b);c?a.layout_id.push(c.id):h.error({data:"Tried to store a layout with no ID: "+b})}),delete a.layouts,a},j.readCache=function(a,b,c){var d=!1;return angular.forEach(k[a],function(a){a[b]===c&&(d=a)}),d?d:!1},j}]),angular.module("com.inthetelling.story").factory("errorSvc",function(){var a={};return a.init=function(){a.errors=[],a.notifications=[]},a.init(),a.error=function(b){b&&b.data&&a.errors.push({exception:b,cause:b.data.error})},a.notify=function(b){a.notifications.push({text:b})},a}),angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","config","appState","errorSvc",function(a,b,c,d,e){var f={};f.episodes={},f.assets={},f.events={},f.containers={},f.cache=function(a,b){"episode"===a?f.episodes[b._id]?angular.extend(f.episodes[b._id],f.deriveEpisode(angular.copy(b))):f.episodes[b._id]=f.deriveEpisode(angular.copy(b)):"event"===a?f.events[b._id]?angular.extend(f.events[b._id],f.deriveEvent(angular.copy(b))):f.events[b._id]=f.deriveEvent(angular.copy(b)):"asset"===a?f.assets[b._id]?angular.extend(f.assets[b._id],f.deriveAsset(angular.copy(b))):f.assets[b._id]=f.deriveAsset(angular.copy(b)):"container"===a&&(f.containers[b._id]?angular.extend(f.containers[b._id],f.deriveContainer(angular.copy(b))):f.containers[b._id]=f.deriveContainer(angular.copy(b)))};var g={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/debug.html","templates/upload-demo.html":"templates/item/debug.html"};f.deriveEpisode=function(a){return g[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl]),a.styles||(a.styles=[]),angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(b){a.templateUrl==="templates/episode/"+b+".html"&&angular.forEach(["color","typography"],function(c){var d=!1;angular.forEach(a.styles,function(a){a.match(c)&&(d=!0)}),d||a.styles.push(c+b[0].toUpperCase()+b.substring(1))})}),a.title&&f.events["internal:landingscreen:"+a._id]&&(f.events["internal:landingscreen:"+a._id].title=a.title),a.languages,a=h(a)},f.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=j(a)),a},f.deriveContainer=function(a){return h(a)},f.deriveEvent=function(a){return a=h(a),"Scene"!==a._type&&(a.templateUrl||(a.templateUrl="templates/item/usc-badges.html"),f.episodes[a.episode_id]&&"templates/episode/usc.html"===f.episodes[a.episode_id].templateUrl&&"Link"===a._type&&("templates/transmedia-link-default.html"===a.templateUrl&&(a.templateUrl="templates/transmedia-link-noembed.html"),a.title.en&&a.title.en.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youâ€™re finished - Come back to this page and click <b>Continue</b>).<br><br>If youâ€™d rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.title.en&&a.title.en.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.title.en&&a.title.en.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge")),a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,!a.cosmetic&&(a.isContent||a.layouts.indexOf("windowFg")>-1)&&(a.showInReviewMode=!0),"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),"Link"===a._type&&a.url.match(/^http:\/\//)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0,a.noEmbed=!0)),g[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=g[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])),a.displayStartTime=b("asTime")(a.start_time),a};var h=function(a){var b=d.lang?d.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(c){a[c]&&(a["display_"+c]="string"==typeof a[c]?a[c]:a[c][b]?a[c][b]:a[c].en)}),a};f.setLanguageStrings=function(){angular.forEach(f.events,function(a){a=h(a)}),angular.forEach(f.episodes,function(a){a=h(a)}),angular.forEach(f.containers,function(a){a=h(a)})},f.resolveEpisodeEvents=function(a){var b=[],c=[],d=f.episodes[a];angular.forEach(f.events,function(d){d.episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))}),d.scenes=b.sort(function(a,b){return a.start_time-b.start_time}),d.items=c.sort(function(a,b){return a.start_time-b.start_time});for(var e=1;e<d.scenes.length-2;e++)d.scenes[e].end_time=d.scenes[e+1].start_time;angular.forEach(b,function(a){var b=[];angular.forEach(c,function(c){c.start_time>=a.start_time&&c.start_time<a.end_time&&(c.end_time<=a.end_time?(f.events[c._id].scene_id=a._id,b.push(c)):a.end_time-.25<c.start_time?c.start_time=a.end_time:(c.end_time=a.end_time,b.push(c)))}),f.events[a._id].items=b.sort(function(a,b){return a.start_time-b.start_time})}),d.styleCss=i(d),angular.forEach(f.events,function(b){b.episode_id===a&&(b.styleCss=i(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},f.episode=function(a){return!f.episodes[a],f.episodes[a]},f.episodeEvents=function(a){var b=[];return angular.forEach(f.events,function(c){c.episode_id===a&&b.push(c)}),b},f.scene=function(a){return!f.events[a],f.events[a]};var i=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=f.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.episode_id){var e=f.episodes[a.episode_id].styles;angular.forEach(e,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}if("Scene"!==a._type&&!a.isContent&&a.layouts&&a.layouts[0].match(/Bg/))for(var g=0;g<c.length;g++)c[g].match(/transition/)&&"transitionNone"!==c[g]&&(c[g]="transitionFade");return c.join(" ")};f.resolveEpisodeAssets=function(a){angular.forEach(f.events,function(b){if(b.episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&f.assets[c]&&(f.events[b._id].asset=f.assets[c])}}),f.episodes[a]&&(f.episodes[a].master_asset_id?f.episodes[a].masterAsset=f.assets[f.episodes[a].master_asset_id]:e.error({data:"This episode has no master_asset_id (authoring error?)"}))},f.addLandingScreen=function(a){f.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:.001}},f.addEndingScreen=function(a){if(f.episodes[a].masterAsset){var b=parseFloat(f.episodes[a].masterAsset.duration),c=f.episodes[a].scenes[f.episodes[a].scenes.length-1];c.end_time=b,angular.forEach(c.items,function(a){a.end_time>b&&(a.end_time=b)}),f.events["internal:endingscreen:"+a]={_id:"internal:endingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/endingscreen.html",episode_id:a,start_time:b,end_time:b+.1,title:f.episodes[a].title},f.resolveEpisodeEvents(d.episodeId)}};var j=function(a){var b={};if(a.alternate_urls){for(var e=/\.(\w+)$/,f=0;f<a.alternate_urls.length;f++)if(a.alternate_urls[f].match(/youtube/))b.youtube=k(a.alternate_urls[f]);else switch(a.alternate_urls[f].match(e)[1]){case"mp4":b.mpeg4=l(b.mpeg4,a.alternate_urls[f]);break;case"m3u8":b.m3u8=l(b.m3u8,a.alternate_urls[f]);break;case"webm":b.webm=l(b.webm,a.alternate_urls[f])}a.you_tube_url&&(b.youtube=k(a.you_tube_url))}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:k(a.you_tube_url)};var g=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),h=/Version\/[891]/.test(navigator.appVersion),i=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if((d.isTouchDevice||g&&!h)&&(b.youtube=void 0),c.disableYoutube&&(b.youtube=void 0),i){var j,m="t="+(new Date).getTime();b.mpeg4&&(j=b.mpeg4.match(/\?/)?"&":"?",b.mpeg4=b.mpeg4+j+m),b.webm&&(j=b.webm.match(/\?/)?"&":"?",b.webm=b.webm+j+m)}return a.urls=b,a},k=function(a){if(!a)return void 0;var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b)[1];return"//www.youtube.com/embed/"+c},l=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,e=a.match(c)||[0,0],f=b.match(c)||[0,0];return d.isTouchDevice?Math.floor(e[1])>Math.floor(f[1])?b:a:Math.floor(e[1])<Math.floor(f[1])?b:a};return c.debugInBrowser,f}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$timeout","$interval","$rootScope","config","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f,g){var h={};h.timelineEvents=[],h.markedEvents=[];var i,j,k,l;h.registerVideo=function(b){void 0!==k&&a(function(){h.seek(f.time)}),k=b},h.setSpeed=function(a){l=a,f.timeMultiplier=l,k.setSpeed(a),r()},h.play=function(a){if(!f.hasBeenPlayed)return f.hasBeenPlayed=!0,void c.$emit("video.firstPlay");if(f.time>f.duration-.1&&(h.seek(.1),h.play()),void 0!==k)f.videoControlsActive=!0,f.show.navPanel=!1,f.timelineState="buffering",k.play().then(function(){f.timelineState="playing",t(),p(),a||g.captureEpisodeActivity("play")});else var b=c.$watch(function(){return void 0!==k},function(a){a&&(b(),h.play())})},h.pause=function(a){f.videoControlsActive=!0,b.cancel(i),q(),i=void 0,o=void 0,f.timelineState="paused",k.pause(),a||g.captureEpisodeActivity("pause")},h.stall=function(){b.cancel(i),q(),i=void 0,o=void 0,h.wasPlaying="playing"===f.timelineState,f.timelineState="buffering"},h.unstall=function(){h.wasPlaying?h.play():f.timelineState="paused",h.wasPlaying=void 0},h.seek=function(b,c,d){if(!k||0===f.duration)return void a(function(){h.seek(b)},300);q();var e=f.time;if(b=x(b),0>b&&(b=0),b>f.duration&&(b=f.duration),f.time=b,k.seek(b),h.updateEventStates(),r(!0),c){var i={method:c,seekStart:e};d&&(i.event_id=d),g.captureEpisodeActivity("seek",i)}},h.toggleMute=function(){f.muted=!f.muted,k.toggleMute()},h.setVolume=function(a){f.volume=a,k.setVolume(a)};var m,n=function(){m={lastTimelineTime:0,lastVideoTime:0}};n();var o,p=function(){m.lastTimelineTime=f.time,m.lastVideoTime=f.time,r()},q=function(){a.cancel(j),n()},r=function(b){if(a.cancel(j),"playing"===f.timelineState){for(var c=k.currentTime(),d=f.time,e=0;e<h.timelineEvents.length;e++){var g=h.timelineEvents[e];if(g.t>=m.lastTimelineTime){if(g.t>d)break;if(("pause"!==g.action||!b&&g.t!==m.lastTimelineTime)&&(s(g),"pause"===g.action)){e++;break}}}var i=h.timelineEvents[e];if(m.lastVideoTime=c,m.lastTimelineTime=d,i&&"playing"===f.timelineState){var n=1e3*(h.timelineEvents[e].t-d)/l;j=a(r,n+10)}}},s=function(a){"timeline"===a.id?"pause"===a.action?(f.time=a.t,h.pause()):h.play():"enter"===a.action?(e.events[a.id].state="isCurrent",e.events[a.id].isCurrent=!0):"exit"===a.action?(e.events[a.id].state="isPast",e.events[a.id].isCurrent=!1):"preload"===a.action&&w(e.events[a.id])},t=function(){o=void 0,b.cancel(i),i=b(u,20)},u=function(){var a=new Date,b=isNaN(a-o)?0:a-o,c=parseFloat(f.time)+b/1e3*l;0>c&&(c=0,h.pause()),c>f.duration&&(c=f.duration,h.pause()),f.time=c,o=a};h.init=function(a){h.timelineEvents=[],h.markedEvents=[],l=1,f.duration=0,f.timelineState="paused",h.injectEvents(e.episodeEvents(a),0),b.cancel(i),q()},h.injectEvents=function(a,b){0!==a.length&&(angular.forEach(a,function(a){"Scene"===a._type&&a.title&&("string"==typeof a.title||a.title.en)&&h.markedEvents.push(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,e.events[a._id].start_time=.01),a.stop?(h.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),h.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),h.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(h.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&h.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"})),(a.asset_id||a.annotation_image_id||a.link_image_id)&&h.timelineEvents.push({t:a.start_time<3?0:a.start_time-3,id:a._id,action:"preload"})}),h.timelineEvents=h.timelineEvents.sort(function(a,b){return a.t===b.t?a.action===b.action?0:"enter"===a.action&&"pause"===b.action?-1:"enter"===a.action&&"exit"===b.action?1:"exit"===a.action&&"enter"===b.action?-1:"exit"===a.action&&"pause"===b.action?-1:"pause"===a.action&&"enter"===b.action?1:"pause"===a.action&&"exit"===b.action?1:0:a.t-b.t}),h.markedEvents=h.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),h.timelineEvents.length>0&&(f.duration=h.timelineEvents[h.timelineEvents.length-1].t),h.updateEventStates())},h.updateEventStates=function(){var a=f.time;angular.forEach(h.timelineEvents,function(a){if("timeline"!==a.id){var b=e.events[a.id];b.state="isFuture",b.isCurrent=!1}}),angular.forEach(h.timelineEvents,function(b){if(b.t<=a){var c=e.events[b.id];"enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1)}})};var v={},w=function(a){a.asset&&"Asset::Image"===a.asset._type&&(v[a.asset.url]||(v[a.asset.url]=new Image,v[a.asset.url].src=a.asset.url))},x=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return d.debugInBrowser,h}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(f.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b,c){f.user.track_event_actions&&g.activityQueue.push({name:a,event_id:b,walltime:new Date,data:c})},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){if(0!==g.activityQueue.length){var a=angular.copy(g.activityQueue);g.activityQueue=[];var b=new Date,c=[],d=[];angular.forEach(a,function(a){a.age=(b-a.walltime)/1e3,delete a.walltime,a.event_id?d.push(a):c.push(a)}),c=g.dejitter(c),d.length>0&&i("event_user_actions",{event_user_actions:d}),c.length>0&&i("episode_user_metrics",{episode_user_metrics:c})}},g.dejitter=function(a){if(0===a.length)return[];for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1];"seek"===d.name&&"seek"===e.name&&d.timestamp===e.data.seekStart?e.data.seekStart=d.data.seekStart:b.push(a[c])}return b.push(a[a.length-1]),b};var i=function(a,c){b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/"+a,data:c})};return g}]),angular.module("com.inthetelling.story").factory("mockSvc",["modelSvc",function(a){var b={};return b.keepJsLintHappy=function(){var b=a.episodes.noop;b=void 0},b.mockEpisode=function(a){var b=a;b=void 0},b}]),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type||a.templateUrl.match(/transmedia/)||b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){("Annotation"!==a._type||a.templateUrl.match(/transmedia/))&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("reviewMode",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.showInReviewMode&&b.push(a)}),b}}).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","$http","config","errorSvc","appState",function(a,b,c,d,e){a.errorSvc=d,a.user=e.user,a.dismiss=function(a){for(var b=0;b<d.errors.length;b++)d.errors[b]===a&&(d.errors.splice(b,1),b=d.errors.length);for(b=0;b<d.notifications.length;b++)d.notifications[b]===a&&(d.notifications.splice(b,1),b=d.notifications.length)},a.resetAuth=function(){b.defaults.headers.common.Authorization=void 0,localStorage.removeItem(c.localStorageKey),e.user={}},a.reload=function(){window.location.reload(!0)}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.changeSpeed=function(a){var c=d.timeMultiplier+a;.5>c&&(c=.5),c>2&&(c=2),b.setSpeed(c)},a.resetSpeed=function(){b.setSpeed(1)},a.markerPercent=function(a){return void 0===a?0:a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.toggleFullscreen=function(){e()?g():h()};var e=function(){return document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen},f=a.$watch(function(){return e()},function(a){d.isInFullscreenMode=a});a.$on("$destroy",function(){f()});var g=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},h=function(){var a=document.getElementById("CONTAINER");a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc",function(a,b,c,d,e,f,g,h,i,j,k,l){a.viewMode=function(a){g.viewMode=a,g.viewModeText=a.substring(0,1).toUpperCase()+a.substring(1),k.captureEpisodeActivity("modeChange",{mode:a}),"review"===a?(g.autoscroll=!0,g.autoscrollBlocked=!1,e(y)):g.autoscroll=!1,e(function(){$(window).trigger("resize")})},d.viewMode&&e(function(){a.viewMode(d.viewMode)}),d.t&&j.seek(d.t,"URLParameter"),g.init(),l.init(),g.episodeId=d.epId,i.addLandingScreen(g.episodeId),h.getEpisode(g.episodeId);var m=a.$watch(function(){return i.episodes[g.episodeId].title},function(a){a&&(document.title="string"==typeof a?"STORY: "+a:"STORY: "+a.en,m())});a.loading=!0;var n=a.$watch(function(){return i.episodes[g.episodeId].items},function(b){b&&(i.addEndingScreen(g.episodeId),j.init(g.episodeId),a.loading=!1,n())});a.episode=i.episode(g.episodeId),a.appState=g,a.show=g.show,a.now=new Date,a.currentdate=new Date,g.videoControlsActive=!1;var o,p,q=a.$watch(function(){return g.videoControlsActive},function(a){a&&(p=e(function(){o||(g.videoControlsActive=!1)},5e3))});a.$on("$destroy",function(){q()}),a.showControls=function(){e.cancel(p),g.videoControlsActive=!0,g.isTouchDevice&&a.allowControlsExit()},a.keepControls=function(){o=!0},a.allowControlsExit=function(){o=!1,e.cancel(p),p=e(function(){g.show.navPanel||(g.videoControlsActive=!1)},5e3)},a.toggleSearchPanel=function(){g.show.searchPanel=!g.show.searchPanel},a.toggleNavPanel=function(){j.pause(),g.show.navPanel=!g.show.navPanel},a.seek=function(b){a.enableAutoscroll(),j.seek(b,"sceneMenu"),g.show.navPanel=!1},a.pause=function(){j.pause()};var r=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(s){r=!1}r&&localStorage.removeItem("iCanHazStorage"),c.$on("video.firstPlay",function(){r&&!localStorage.getItem("noMoreHelp")?g.show.helpPanel=!0:j.play()}),a.hidePanels=function(){g.show.helpPanel=!1,g.show.navPanel=!1,g.show.searchPanel=!1},a.noMoreHelp=function(){g.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),j.play()},a.play=function(){j.play()};var t,u=$(window),v=$("html,body"),w=function(){t=f(y,400),u.bind("scroll",function(){v.stop(),x(),g.autoscrollBlocked=!0})},x=function(){u.unbind("scroll"),f.cancel(t)};a.enableAutoscroll=function(){g.autoscrollBlocked&&(g.autoscrollBlocked=!1,w())};var y=function(){if(!g.autoscrollBlocked&&g.autoscroll){var a=1/0,b=u.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),1/0!==a){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(x(),v.animate({scrollTop:a-c},1500),e(function(){w()},1750))}}};w(),c.$on("userKeypress.ESC",function(){g.show.searchPanel=!1,g.show.helpPanel=!1,g.show.navPanel=!1,g.itemDetail=!1})}]),angular.module("com.inthetelling.story").controller("EpisodeController",["$scope","$routeParams","modelSvc","appState",function(a,b,c,d){a.episode=c.episode(d.episodeId),a.appState=d}]),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){$.inArray("showCurrent",a.scene.layouts)>-1&&(a.showCurrent=!0),a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);
for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)};var c={ENTER:13,SPACE:32};a.seekOnKeyPress=function(b,d){var e=d,f=!0;switch(e.keyCode){case c.ENTER:a.seek(b),f=!1;break;case c.SPACE:a.seek(b),f=!1;break;default:f=!0}f||(d.stopPropagation(),d.preventDefault())}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$timeout","$window","$document","appState","timelineSvc",function(a,b,c,d,e,f,g){var h=document.createElement("script");h.src="//www.youtube.com/iframe_api",angular.element(e[0].head).append(h),d.onYouTubeIframeAPIReady=function(){f.youtubeIsReady=!0},b.initVideo=function(a){if(b.video.urls.youtube)if(b.videoType="youtube",f.videoType=b.videoType,b.videoNode=a.find("iframe")[0],f.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return f.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",f.videoType=b.videoType,b.videoNode=a.find("video")[0],b.initHTML5Video()},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data],"buffering"===b.playerState&&b.stall()}}});var c=b.$watch(function(){return void 0!==b.YTPlayer.playVideo},function(a){a&&(c(),b.getBufferPercent=function(){return f.bufferedPercent=100*b.YTPlayer.getVideoLoadedFraction(),f.bufferedPercent},g.registerVideo(b))})},b.initHTML5Video=function(){b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("waiting",function(){b.playerState="waiting",b.stall()},!1),b.videoNode.addEventListener("stalled",function(){b.playerState="stalled"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),b.getBufferPercent=function(){if(b.videoNode.buffered.length>0){var a=b.videoNode.buffered.start(b.videoNode.buffered.length-1),c=b.videoNode.buffered.end(b.videoNode.buffered.length-1);return 0>c&&(c-=a,a=0),f.bufferedPercent=c/f.duration*100,f.bufferedPercent}return 0},g.registerVideo(b)},b.stall=function(){if("playing"===f.timelineState){g.stall();var a=b.$watch(function(){return b.playerState},function(b){"buffering"!==b&&"waiting"!==b&&(a(),g.unstall())})}},b.play=function(){var c=a.defer();"youtube"===b.videoType?b.YTPlayer.playVideo():b.videoNode.play();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise},b.pause=function(){"youtube"===b.videoType?(b.YTPlayer.seekTo(f.time,!0),b.YTPlayer.pauseVideo()):b.videoNode.pause();try{b.videoNode.currentTime=f.time}catch(a){}},b.seek=function(a){try{if("youtube"===b.videoType){var d="playing"===f.timelineState;b.YTPlayer.seekTo(a,!0),d||b.YTPlayer.pauseVideo()}else b.videoNode.currentTime=a}catch(e){c(function(){b.seek(a)},100)}},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.setSortBy=function(b){a.sortBy=b},a.toggleSortBy=function(b){a.sortBy=c(b)},a.getToggledValue=function(a){return c(a)};var c=function(a){return"startTime"===a?"type":"startTime"};a.getFriendlySortText=function(a){return"startTime"===a?"time":"type"},a.seek=function(c,d){a.enableAutoscroll(),b.seek(c,"clickedOnEventInSearch",d)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator)})}}]),angular.module("com.inthetelling.story").controller("QuestionAuthoringController",["$scope","$timeout",function(a,b){a.addDistractor=function(){a.question.distractors.push({text:""})},a.init=function(){a.question={questiontext:"",questiontype:"mc-formative",distractors:[]},a.addDistractor(),a.addDistractor(),a.addDistractor(),a.addDistractor(),a.sampleitem={_id:"sample",type:"Plugin",start_time:0,templateUrl:"templates/item/question-"+a.question.questiontype+".html",data:a.pluginjson}},a.init(),a.$watch(function(){return a.question},function(){if(!a.selfediting){a.fieldediting=!0,a.editwarning=!1;for(var c={questiontext:a.question.questiontext,questiontype:a.question.questiontype,distractors:[]},d=0;d<a.question.distractors.length;d++){var e=a.question.distractors[d];e.text&&c.distractors.push("mc-formative"===a.question.questiontype&&e.correct?{text:e.text,correct:!0}:{text:e.text})}"mc-formative"===a.question.questiontype&&(c.correctfeedback=a.question.correctfeedback,c.incorrectfeedback=a.question.incorrectfeedback),a.sampleitem={_id:"sample",type:"Plugin",start_time:0,templateUrl:"templates/item/question-"+a.question.questiontype+".html",data:{_pluginType:"question",_version:1,_plugin:c}},a.pluginjson=angular.toJson(a.sampleitem.data),b(function(){a.updatePreview(),a.fieldediting=!1})}},!0),a.$watch(function(){return a.pluginjson},function(){if(!a.fieldediting){a.selfediting=!0;var c;a.editwarning=!1;try{c=angular.fromJson(a.pluginjson),a.question=c._plugin}catch(d){a.editwarning=!0}b(function(){a.sampleitem.data._plugin=angular.fromJson(a.pluginjson),a.updatePreview(),a.selfediting=!1})}}),a.updatePreview=function(){a.preview=!1,b(function(){a.questionpreview=a.sampleitem,a.preview=!0})}}]),angular.module("com.inthetelling.story").directive("ittTimeline",["$timeout","appState","timelineSvc","modelSvc",function(a,b,c,d){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(e,f){function g(a){return a>98?100:a}function h(a){return 3>a?0:a}function i(a){var b=e.currentVolume()+a;b=g(b),"function"==typeof e.setVolume&&e.setVolume(b)}function j(a){var b=e.currentVolume()-a;b=h(b),"function"==typeof e.setVolume&&e.setVolume(b)}e.appState=b,e.timeline=c,e.handlePosition=0,e.zoomLevel=1,e.zoomOffset=0;var k=f.find(".progressbarContainer"),l=f.find(".progressbar");e.setNewLanguage=function(){d.setLanguageStrings()},e.showSceneMenuTooltip=function(a){e.sceneMenuToolTip=a&&!b.isTouchDevice?!0:!1},e.prevScene=function(){for(var a=c.markedEvents.length-1;a>=0;a--){var d=b.time;if("playing"===b.timelineState&&(d-=3),c.markedEvents[a].start_time<d){e.enableAutoscroll(),c.seek(c.markedEvents[a].start_time,"prevScene");break}}},e.nextScene=function(){for(var a=!1,d=0;d<c.markedEvents.length;d++)if(c.markedEvents[d].start_time>b.time){e.enableAutoscroll(),c.seek(c.markedEvents[d].start_time,"nextScene"),a=!0;break}a||(c.pause(),c.seek(b.duration-.01,"nextScene"),e.enableAutoscroll())},e.userChangingVolume=function(a){b.muted&&e.toggleMute();var c=angular.element(a.currentTarget),d=function(a,b){var d=(a.clientX-c.offset().left)/c.width()*100;d>98&&(d=100),3>d&&(d=0),b?e.setVolume(d):e.$apply(e.setVolume(d))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var m={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};e.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case m.LEFTARROW:j(1),c=!1;break;case m.RIGHTARROW:i(1),c=!1;break;case m.UPARROW:i(1),c=!1;break;case m.DOWNARROW:j(1),c=!1;break;case m.PAGEUP:i(10),c=!1;break;case m.PAGEDOWN:j(10),c=!1;break;case m.HOME:j(100),c=!1;break;case m.END:i(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},e.currentVolume=function(){return b.muted?0:b.volume},e.audioIcon=function(){return b.muted?"muted":"vol"+Math.floor(b.volume/34)},e.showTooltip=function(a){a.showTooltip=!0},e.hideTooltip=function(a){a.showTooltip=!1},e.zoomIn=function(){e.stopWatching=!0,e.zoomLevel=e.zoomLevel+1,n()},e.zoomOut=function(){e.stopWatching=!0,e.zoomLevel=e.zoomLevel-1,e.zoomLevel<1&&(e.zoomLevel=1),n()};var n=function(){e.zoomOffset=-((e.zoomLevel-1)*(b.time/b.duration)),k.animate({left:100*e.zoomOffset+"%",width:100*e.zoomLevel+"%"},1e3,function(){e.stopWatching=!1})};e.$watch(function(){return{t:b.time,d:b.duration}},function(){e.stopWatching||(e.zoomOffset=-((e.zoomLevel-1)*(b.time/b.duration)),k.css({left:100*e.zoomOffset+"%"}))},!0);var o=function(c){a(function(){e.seekHandleVisible=!0},250),e.isSeeking=!0;var d=b.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(d,function(){q()}),angular.element(document).bind(d,function(){r()}),p(c)},p=function(a){e.isSeeking&&(e.willSeekTo=(a.clientX-k.offset().left)/k.width()*b.duration,e.willSeekTo<0&&(e.willSeekTo=0),e.willSeekTo>b.duration&&(e.willSeekTo=b.duration))},q=function(){e.stopWatching=!0,e.enableAutoscroll(),c.seek(e.willSeekTo,"scrubTimeline"),n()},r=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),e.$apply(function(){e.isSeeking=!1,e.seekHandleVisible=!1})},s=function(){var a=$(f.find(".playhead"));b.isTouchDevice?(a.on("touchstart.timeline",function(a){o(a.originalEvent.targetTouches[0]),a.preventDefault()}),a.on("touchmove.timeline",function(a){p(a.originalEvent.targetTouches[0]),a.preventDefault()})):(a.on("mousedown.timeline",function(a){o(a),a.preventDefault()}),a.on("mousemove.timeline",function(a){p(a),a.preventDefault()}))};s(),e.$on("$destroy",function(){r()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["analyticsSvc",function(a){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(){a.captureEpisodeActivity("episodeLoad")}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl"></span>',controller:"SceneController",link:function(a,d){"review"!==c.viewMode&&window.scrollTo(0,0),a.precalculateSceneValues(),a.appState=c;var e=function(){var b=d.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return d.find(".videoMagnet img").height()},function(a){a>0&&(c(),e())});else{d.find(".matchVideoHeight:visible").each(function(){$(this).css("height",d.find(".videoMagnet img").height())});var f=angular.element(window).height()-$("#CONTAINER").scrollTop();d.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",f-$(this).offset().top)}),d.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",f-$(this).offset().top-210)})}d.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&e()},!0),a.safetyBelt=b(e,1321),a.$on("$destroy",function(){a.unwatch(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittShowHideVisualOnly",["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ittShowHideVisualOnly,function(b){b?a.removeClass(c,"visual-hide"):a.addClass(c,"visual-hide")})}}}]),angular.module("com.inthetelling.story").animation(".visual-hide",function(){return{addClass:function(a){a.fadeTo("slow",0,function(){})},removeClass:function(a){a.fadeTo("slow",1,function(){})}}}),angular.module("com.inthetelling.story").directive("ittShowFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.ittShowFocus,function(b){a(function(){b&&c.filter(":visible").first().focus()})},!0)}}]),angular.module("com.inthetelling.story").directive("ittVolumeSlider",["appState",function(a){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(b){function c(a){return a>98?100:a}function d(a){return 3>a?0:a}function e(a){var d=b.currentVolume()+a;d=c(d),"function"==typeof b.setVolume&&b.setVolume(d)}function f(a){var c=b.currentVolume()-a;c=d(c),"function"==typeof b.setVolume&&b.setVolume(c)}b.appState=a,b.userChangingVolume=function(a){var c=angular.element(a.currentTarget),d=function(a,d){var e=(a.clientX-c.offset().left)/c.width()*100;e>98&&(e=100),3>e&&(e=0),d?b.setVolume(e):b.$apply(b.setVolume(e))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var g={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};b.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case g.LEFTARROW:f(1),c=!1;break;case g.RIGHTARROW:e(1),c=!1;break;case g.UPARROW:e(1),c=!1;break;case g.DOWNARROW:f(1),c=!1;break;case g.PAGEUP:e(10),c=!1;break;case g.PAGEDOWN:f(10),c=!1;break;case g.HOME:f(100),c=!1;break;case g.END:e(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},b.currentVolume=function(){return a.muted?0:a.volume}}}}]),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=400>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","config","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(h,i){h.toggleDetailView=function(){h.item.showInlineDetail?h.item.showInlineDetail=!1:(f.pause(),h.captureInteraction(),i.width()>400?h.item.showInlineDetail=!0:d.itemDetail=h.item)};var j={ENTER:13,SPACE:32};h.toggleDetailOnKeyPress=function(a){var b=a,c=!0;switch(b.keyCode){case j.ENTER:h.toggleDetailView(),c=!1;break;case j.SPACE:h.toggleDetailView(),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},h.forceModal=function(){f.pause(),d.itemDetail=h.item},h.outgoingLinkOnKeyPress=function(a,b){var c=b,d=!0;switch(c.keyCode){case j.ENTER:h.outgoingLink(a),d=!1;break;case j.SPACE:h.outgoingLink(a),d=!1;break;default:d=!0}d||(b.stopPropagation(),b.preventDefault())},h.outgoingLink=function(a){f.pause(),h.captureInteraction(),h.item.targetTop?b(function(){window.location.href=a}):window.open(a)},h.captureInteraction=function(){e.captureEventActivity("clicked",h.item._id)},"templates/item/link-embed.html"===h.item.templateUrl&&h.captureInteraction(),h.item.asset_id&&!h.item.asset&&(h.item.asset=g.assets[h.item.asset_id]),h.item.styleCss&&h.item.styleCss.match(/fill|contain|cover/)&&(h.item.asset.cssUrl="url('"+h.item.asset.url+"');",h.item.backgroundImageStyle="background-image: url('"+h.item.asset.url+"');"),h.item.data&&(h.plugin=h.item.data._plugin,h.plugin._type=h.item.data._pluginType,"question"===h.plugin._type&&(h.scoreQuiz=function(){h.plugin.distractors[h.plugin.selectedDistractor].selected=!0,h.plugin.hasBeenAnswered=!0,e.captureEventActivity("question-answered",h.item._id)},h.scorePoll=function(){h.plugin.distractors[h.plugin.selectedDistractor].selected=!0,h.plugin.hasBeenAnswered=!0},h.resetQuestion=function(){h.plugin.selectedDistractor=void 0,h.plugin.hasBeenAnswered=!1;for(var a=0;a<h.plugin.distractors.length;a++)h.plugin.distractors[a].selected=!1}),"credlyBadge"===h.plugin._type&&(e.captureEventActivity("viewed",h.item._id),d.user.roles&&1===d.user.roles.length&&"guest"===d.user.roles[0]?h.plugin.eligibleForBadges=!1:(h.plugin.eligibleForBadges=!0,h.plugin.userEmail=d.user.emails?d.user.emails[0]:"",h.plugin.totalAchieved=0),h.checkBadgeEligibility=function(){h.plugin.eligibleForBadges&&angular.forEach(h.plugin.requirements,function(a){a.achieved||e.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,h.countAchievements()}),h.countAchievements()})},h.$watch(function(){return h.item.isCurrent||"review"===d.viewMode},function(a,b){a&&!b&&h.checkBadgeEligibility()}),h.countAchievements=function(){var a=0;angular.forEach(h.plugin.requirements,function(b){b.achieved&&(a+=1)}),h.plugin.totalAchieved=a,h.plugin.totalAchieved===h.plugin.requirements.length&&(h.$parent.episode.styleCss=h.$parent.episode.styleCss+" uscHackUserHasBadge")},h.badger=function(){h.plugin.gettingBadge=!0,a({method:"GET",url:c.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+h.plugin.credlyBadgeId+"&email="+h.plugin.userEmail}).success(function(a){h.checkBadgeEligibility(),"Badge previously sent."===a.status&&(h.plugin.alreadyHadBadge=!0),h.plugin.gotBadge=!0}).error(function(){h.plugin.gettingBadge=!1,h.plugin.error=!0})}))}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",["appState",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$interval","$rootScope","appState","timelineSvc",function(a,b,c,d,e){var f=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(g,h){g.appState=d,g.uid=++f,a(function(){if(g.video)g.initVideo(h);else var a=g.$watch(function(){return g.video},function(b){b&&(a(),g.initVideo(h))})}),g.videoClick=function(){"paused"===d.timelineState?e.play():e.pause()},g.spaceWatcher=c.$on("userKeypress.SPACE",g.videoClick),g.bufferInterval=b(function(){if(g.getBufferPercent){var a=g.getBufferPercent();a>98&&(b.cancel(g.bufferInterval),d.bufferedPercent=100)}},200),g.$on("$destroy",function(){g.spaceWatcher(),b.cancel(g.bufferInterval)})}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.ceil(Math.abs(c)>4?e.width()+c/4:d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))})};a.$on("magnet.changeMagnet",function(a,b){g(b)}),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.unwatchVisibility=b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),"watchModeVideoMagnet"===c.attr("id")&&(b.unwatchSize=b.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:c.is(":visible")}},function(){var b=angular.element(window),d=b.height()-46;c.width(b.width()/d>16/9?16/9*d:b.width()),a.$emit("magnet.changeMagnet",c)},!0)),b.$on("$destroy",function(){b.unwatchVisibility(),b.unwatchSize&&b.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.indexEvents()}}}),angular.module("com.inthetelling.story").controller("EpisodeListController",["$scope","config","dataSvc",function(a,b,c){a.loading=!0,c.getAllContainers().then(function(b){a.containers=b,a.loading=!1})}]);