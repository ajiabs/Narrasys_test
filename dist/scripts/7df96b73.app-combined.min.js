"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate"]).config(["$routeProvider",function(a){a.when("/episodes",{title:"Telling STORY: All episodes",templateUrl:"templates/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.responseInterceptors.push(["$q",function(){function a(a){return a}function b(a){var b=a.status;if(401===b){if(localStorage.storyAuth){var c=angular.fromJson(localStorage.storyAuth);localStorage.removeItem("storyAuth"),c.login_url&&(c.login_via_top_window_only?window.top.location.href=c.login_url:window.location.href=c.login_url)}return window.location.reload(),!1}window.alert("API error (and no proper error handler yet)! See console for details")}return function(c){return c.then(a,b)}}])}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/episode/episode.html",'<div class="episode">\n	<div class="fill bgLayer" ng-show="appState.viewMode == \'discover\'">\n		<!-- windowBg -->\n		<div itt-item="item" class="animate" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowBg\'"></div>\n	</div>\n\n	<div class="discoverMode">\n		<div itt-scene="scene" episode="episode" class="animate" ng-repeat="scene in episode.scenes | isCurrent" ng-show="appState.viewMode == \'discover\'">\n		</div>\n	</div>\n\n	<div class="reviewMode" ng-show="appState.viewMode == \'review\'">\n		<div itt-magnet id="reviewModeVideoMagnet" class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="scene" ng-class="{navigable: scene.title}" ng-repeat="scene in episode.scenes">\n			<div class="pane mainPane">\n				<div class="content allowHighlights">\n					<!-- contentMain -->\n					<h2 ng-if="scene.title">{{scene.title}}</h2>\n					<div class="itemanimate" ng-repeat="item in scene.items | isContent | annotation | filter:{cosmetic:false} | orderBy:\'start_time\'" itt-item="item">\n					</div>\n				</div>\n			</div>\n			<div class="pane altPane">\n				<div class="content allowHighlights">\n					<img ng-if="$index == 1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding">\n					<!-- contentAlt -->\n					<div class="itemanimate" ng-repeat="item in scene.items | isContent | transmedia | filter:{cosmetic:false}" itt-item="item">\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class="watchMode" ng-show="appState.viewMode == \'watch\'">\n		<div itt-magnet id="watchModeVideoMagnet" class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n\n	<div itt-magnetized class="pane videoContainer">\n		<div class="video contentLayer" itt-video="episode.masterAsset.video"></div>\n		<div class="pane fill overlay fgLayer">\n			<!-- Video Overlays -->\n			<div itt-item="item" class="animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div>\n		</div>\n	</div>\n\n	<div ng-show="appState.viewMode == \'watch\'" class="watchModeCaption itemanimate" ng-repeat="item in episode.items  | transcript | isCurrent" itt-item="item"></div>\n\n	<div class="fill overlay fgLayer" ng-show="appState.viewMode == \'discover\'">\n		<!-- WindowFg -->\n		<div itt-item="item" class="animate" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div>\n	</div>\n</div>\n'),a.put("templates/episodelist.html",'Episode list\n\n<div ng-controller="EpisodeListController">\n	<div ng-repeat="episode in episodes">\n		({{episode._id}}) {{episode.title}} -\n		<a href="#episode/{{episode._id}}">as guest</a> -\n		<!-- <a ng-click="authenticate(episode._id)">Log in first</a> -->\n		<br>\n	</div>\n</div>\n\n<div x-ng-controller="ErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/error.html",'<div x-ng-if="error" class="error">\n	<h2>Error</h2>\n	<p>Sorry, but something went wrong and we weren\'t able to continue:<br>{{error.message}}</p>\n	<span style="color:#FFF">\n		<pre>{{error.details}}</pre>\n	</span>\n</div>'),a.put("templates/item/edit.html",'<div ng-if="item">\n	Editing item\n\n	<span ng-if="item.type==\'Annotation\'">\n		<br>Speaker:\n		<input type="text" ng-model="item.annotator">\n		<br>TODO: generate list of speakers to choose from based on those already used in this episode, with an \'add\' button for new ones\n\n		<br>Annotation:\n		<textarea ng-model="item.annotation"></textarea>\n	</span>\n	<span ng-if="item.type != \'Annotation\'">\n		<br>Title:\n		<input type="text" ng-model="item.title">\n		<br>Description:\n		<textarea ng-model="item.description"></textarea>\n\n		<span ng-if="item.type == \'Link\'">\n			<br>URL:\n			<input type="text" ng-model="item.url">\n		</span>\n		<span ng-if="item.type == \'Upload\'">\n			<br>TODO: edit/replace asset:\n			<pre>{{item.asset | pretty}}</pre>\n		</span>\n	</span>\n\n	<br>Start time:\n	<input type="text" ng-model="item.start_time">\n	<br>End time:\n	<input type="text" ng-model="item.end_time">\n	<br>Cosmetic:\n	<input type="checkbox" ng-model="item.cosmetic">\n	<br>Stop:\n	<input type="checkbox" ng-model="item.stop">\n	<br>Required:\n	<input type="checkbox" ng-model="item.required">\n	<br>TODO: templateUrl\n	<br>styleCss:\n	<input type="text" ng-model="item.styleCss">\n	<br>layoutCss:\n	<input type="text" ng-model="item.layoutCss">\n\n\n	<input type="button" ng-click="save()" value="Save">\n	<input type="button" ng-click="cancelEdit()" value="Cancel">\n	<a ng-click="itemEditDebug=!itemEditDebug">Debug</a>\n	<pre style="max-height: 200px; overflow-y: scroll" ng-if="itemEditDebug">{{item | pretty}}</pre>\n\n</div>\n'),a.put("templates/item/image-fill.html",'<!-- one or the other of .item background-image and fillImg will be made invisible, depending on fill type -->\n<div class="item imageFill" ng-class="item.styleCss + \' \' + item.state" ng-style="{\'background-image\': \'url(\' + item.asset.url + \')\'}">\n	<img class="fillImg" ng-src="{{item.asset.url}}">\n</div>\n'),a.put("templates/item/item.html",'<div class="item" ng-class="item.styleCss + \' \' + item.state">\n	{{item._id}} {{item.start_time | asTime}}-{{item.end_time | asTime}}: {{item.title}}\n	<br>{{item.annotation}} {{item.description}}\n	<br>\n\n	<a ng-click="edit()">Edit</a>\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/link.html",'<div class="item" ng-class="item.styleCss + \' \' + item.state">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.start_time | asTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="toggleDetailView()">{{item.title || \'(Untitled)\'}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="itemDetail" x-ng-if="item.showInlineDetail">\n		<a ng-href="{{item.url}}" target="_blank" class="escapelink">(new window)</a>\n		<div class="iframeContainer">\n			<iframe ng-src="{{item.url}}"></iframe>\n		</div>\n	</div>\n</div>\n<!--\n\n<div class="itemHead">\n	<div class="startTime displayTime" x-ng-click="gotoItem()" bo-text="item.displayTime"></div>\n	<div class="category">\n		<span bo-if="item.required">(Required viewing)</span>\n	</div>\n</div>\n <div class="icon"><img bo-src="item.thumbSrc"></div> \n<div class="text">\n	<div class="title">\n		<a href="javascript:void 1;" x-ng-click="toggleDetailView()" bo-html="item.title || \'(no title)\'"></a>\n	</div>\n	<div bo-html="item.description"></div>\n</div>\n<div class="detail" x-ng-if="item.showInlineDetail">\n	<a bo-href="item.source" target="_blank" class="escapelink">(new window)</a>\n	<div class="iframeContainer">\n		<iframe bo-src="item.source"></iframe>\n	</div>\n</div>\n</div>\n-->\n'),a.put("templates/item/modal.html",'<div class="modal">\n	<div ng-if="item._type == \'Link\'" class="modalmenu">\n		<a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a>\n	</div>\n	<div ng-if="item._type == \'Link\'" class="iframeContainer">\n		<iframe x-ng-src="{{item.url}}"></iframe>\n	</div>\n	<div ng-click="dismiss();" class="modalimage" ng-if="item._type == \'Upload\'">\n		<img ng-src="{{item.asset.url}}">\n	</div>\n</div>\n'),a.put("templates/item/searchresults.html",'<div class="item">\n	<span class="displayTime">\n		<a href="javascript:void 1" x-ng-click="seek(item.start_time, item._id)">{{item.start_time | asTime}}</a>\n	</span>\n	<span class="type" ng-bind-html="item.trustedDisplayTitle | highlightSubstring: searchText"></span>\n	<div class="description" ng-bind-html="item.trustedDisplayText | highlightSubstring: searchText"></div>\n\n</div>\n'),a.put("templates/item/transcript.html",'<div class="item" ng-class="item.styleCss + \' \' + item.state">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.start_time | asTime}}</div>\n		<div class="authorName">{{item.annotator}}</div>\n	</div>\n	<div class="text">{{item.annotation}}</div>\n</div>\n'),a.put("templates/item/upload.html",'<div class="item" ng-class="item.styleCss + \' \' + item.state">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.start_time | asTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="toggleDetailView()">{{item.title || \'(Untitled)\'}}</a>\n		</div>\n		<div>{{item.description}}</div>\n	</div>\n	<div class="itemDetail" x-ng-if="item.showInlineDetail">\n		<!-- TODO handle videos here by checking item.asset._type -->\n		<div class="touchable" style="position:relative">\n			<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n			<div class="touchableIndicator"></div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/player.html",'<div class="player" ng-class="{\n	isFramed: appState.isFramed,\n	producer: appState.producer,\n	editBgLayer: editLayer.bgLayer,\n	editFgLayer: editLayer.fgLayer,\n	editContentLayer: editLayer.contentLayer,\n	editScene: editLayer.scene\n	}">\n	<div class="toolbar">\n		<div class="modegroup buttongroup">\n			<a class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')">\n				<span>Watch</span>\n			</a>\n			<a class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')">\n				<span>Discover</span>\n			</a>\n			<a class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')">\n				<span>Review</span>\n			</a>\n		</div>\n\n		<div ng-if="appState.producer && appState.viewMode == \'discover\'" class="buttongroup">\n			<a class="button" ng-click="editLayer(\'scene\');">Scene<span>Edit the scene layout (TODO)</span></a>\n			<a class="button" ng-click="editLayer(\'bgLayer\');">BG<span>Edit the background layer</span></a>\n			<a class="button" ng-click="editLayer(\'contentLayer\');">C<span>Edit the content layer</span></a>\n			<a class="button" ng-click="editLayer(\'fgLayer\');">FG<span>Edit the foreground layer</span></a>\n			<a class="button" ng-click="editLayer(\'\');">All<span>Show everything</span></a>\n		</div>\n\n\n		<div ng-if="appState.isFramed" class="escapegroup buttongroup">\n			<a ng-click="mainframeescape();" class="button button-mainframeescape">\n				<span>New window</span>\n			</a>\n		</div>\n		<div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}">\n			<a class="button button-search" ng-click="toggleSearchPanel()">\n				<span>Search</span>\n			</a>\n			<input id="searchtext" type="text" ng-model="searchText" />\n		</div>\n	</div>\n	<div itt-episode></div>\n	<div ng-if="appState.viewMode != \'watch\'" class="branding">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright">TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved</span>\n	</div>\n\n	<div ng-show="show.searchPanel" class="modal-backdrop searchPanel-backdrop" ng-click="toggleSearchPanel()"></div>\n	<div ng-show="show.searchPanel" class="searchPanel">\n		<div ng-show="show.searchPanel" itt-search-panel>This will be the search panel</div>\n	</div>\n\n	<!-- scene navbar -->\n	<div ng-show="show.navPanel" class="modal-backdrop" ng-click="toggleNavPanel()"></div>\n	<div class="toolbar-bottom">\n		<div class="toolbar-bottom-fill">\n			<div ng-show="show.navPanel" class="navPanel">\n				<h2>{{episode.title}}</h2>\n				<div class="scene" x-ng-if="scene.title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)">\n					<span class="displayTime">{{scene.displayTime}}</span>\n					<p>\n						<a href="javascript:void 1;">{{scene.title}}</a>\n						<br>{{scene.description}}\n					</p>\n				</div>\n			</div>\n\n			<div itt-item-editor="appState.editing"></div>\n			<div itt-timeline></div>\n		</div>\n	</div>\n</div>\n\n<div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div>\n<div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div>\n\n<!--  -->\n\n<!-- <div ng-controller="ErrorController" ng-include="\'templates/error.html\'"></div> -->\n<!-- \n<a href="javascript:void 1;" ng-click="showDebug=!showDebug">DEBUG:</a>\n<pre ng-if="showDebug === true">{{appState | pretty }}</pre>\n<pre ng-if="showDebug === true">{{episode | pretty}}</pre>\n -->\n'),a.put("templates/producer/episode.html",'<div class="producer">\n\n	TODO?\n</div>\n'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col">\n		<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in mainBgItems=(scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="\n			{singleitem: \n				(showCurrent \n					? (contentItems | isCurrent).length==1 \n					: contentItems.length == 1\n				), allowHighlights: !showCurrent\n			}">\n\n				<div ng-if="showCurrent" class="item-animate" ng-repeat="item in mainItems = (contentItems | isCurrent)" itt-item="item"></div>\n				<div ng-if="!showCurrent" class="item-animate" ng-repeat="item in mainItems = (contentItems)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in mainFgItems = (scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer" ng-if="mainBgItems.length>0">\n				<div class="animate" ng-repeat="item in mainBgItems = (scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="\n			{singleitem: \n				(showCurrent \n					? (mainContentItems() | isCurrent).length==1 \n					: mainContentItems().length == 1\n				), allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight">\n				<div ng-if="!showCurrent" class="item-animate" ng-repeat="item in mainContentItems()" itt-item="item"></div>\n				<div ng-if="showCurrent" class="item-animate" ng-repeat="item in (mainContentItems() | isCurrent)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay" ng-if="mainFgItems.length>0">\n				<div class="animate" ng-repeat="item in mainFgItems=(scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in altBgItems = (scene.items | isCurrent | itemLayout:\'altBg\')" itt-item="item"></div>\n			</div>\n			<!-- showCurrent is baked into the alt pane directive, don\'t need to handle it in this ngrepeat -->\n			<div class="content contentLayer" ng-class="{singleitem: altItems.length==1, allowHighlights: !showCurrent}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight">\n				<div class="item-animate" ng-repeat="item in altItems = altContentItems()" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in altFgItems=(scene.items | isCurrent | itemLayout:\'altFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in altBgItems = (scene.items | isCurrent | itemLayout:\'altBg\')" itt-item="item"></div>\n			</div>\n			<!-- showCurrent is baked into the alt pane directive, don\'t need to handle it heres -->\n			<div class="content contentLayer " ng-class="{singleitem: altItems.length==1, allowHighlights: !showCurrent}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight">\n				<div class="item-animate" ng-repeat="item in altItems = altContentItems()" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in altFgItems=(scene.items | isCurrent | itemLayout:\'altFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer" ng-if="mainBgItems.length>0">\n				<div class="animate" ng-repeat="item in mainBgItems = (scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="\n			{singleitem: \n				(showCurrent \n					? (mainContentItems() | isCurrent).length==1 \n					: mainContentItems().length == 1\n				), allowHighlights: !showCurrent\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight">\n				<div ng-if="!showCurrent" class="item-animate" ng-repeat="item in mainContentItems()" itt-item="item"></div>\n				<div ng-if="showCurrent" class="item-animate" ng-repeat="item in (mainContentItems() | isCurrent)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay" ng-if="mainFgItems.length>0">\n				<div class="animate" ng-repeat="item in mainFgItems=(scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in mainBgItems=(scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="\n			{singleitem: \n				(showCurrent \n					? (contentItems | isCurrent).length==1 \n					: contentItems.length == 1\n				), allowHighlights: !showCurrent\n			}">\n				<div ng-if="showCurrent" class="item-animate" ng-repeat="item in mainItems = (contentItems | isCurrent)" itt-item="item"></div>\n				<div ng-if="!showCurrent" class="item-animate" ng-repeat="item in mainItems = (contentItems)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayeroverlay">\n				<div class="animate" ng-repeat="item in mainFgItems = (scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerH.html",'<!--\n\nVideo, Main, Alt:\n___________\n|V/M |M/V |\n|____|____|\n|A        |\n|         |\n|_________|\n\n-->\n\n<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="row">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane matchVideoHeight">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in mainBgItems=(scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item-animate" ng-repeat="item in mainItems = (mainContentItems() | isCurrent)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in mainFgItems = (scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="row">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in altBgItems = (scene.items | isCurrent | itemLayout:\'altBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: altItems.length==1, allowHighlights: !showCurrent}">\n				<div class="item-animate" ng-repeat="item in altItems = (altContentItems())" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in altFgItems=(scene.items | isCurrent | itemLayout:\'altFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerV.html",'<!--\nVideo, Main, Alt:\n___________    ___________\n|V   |A   |    |A   |V   |\n|____|    |    |    |____|\n|M   |    |    |    |M   |\n|    |    |    |    |    |\n|____|____|    |____|____|\n-->\n\n<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in mainBgItems=(scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item-animate" ng-repeat="item in mainItems = (mainContentItems() | isCurrent)" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in mainFgItems = (scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="animate" ng-repeat="item in altBgItems = (scene.items | isCurrent | itemLayout:\'altBg\')" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: altItems.length==1, allowHighlights: !showCurrent}">\n				<div class="item-animate" ng-repeat="item in altItems = (altContentItems())" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="animate" ng-repeat="item in altFgItems=(scene.items | isCurrent | itemLayout:\'altFg\')" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/debug.html",'<div ng-class="scene.state">\n	<h3>Scene:{{scene.title}}</h3>\n	<p>{{scene.start_time}} - {{scene.end_time}}</p>\n\n	(sample scene panes:)\n\n	<div>\n		<div>Main pane background items\n			<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'mainBg\'" itt-item="item"></div>\n		</div>\n		<div>Transcript+text items (current only):\n			<div class="animate" ng-repeat="item in scene.items | annotation | isCurrent" itt-item="item"></div>\n		</div>\n		<div>Main pane foreground items\n			<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'mainFg\'" itt-item="item"></div>\n		</div>\n	</div>\n\n	<div>\n		<div>Alt pane background items\n			<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'altBg\'" itt-item="item"></div>\n		</div>\n		<div>Transmedia items:\n			<div class="animate" ng-repeat="item in scene.items | transmedia" itt-item="item"></div>\n		</div>\n		<div>Alt pane background items\n			<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'altFg\'" itt-item="item"></div>\n		</div>\n	</div>\n\n\n	<a ng-click="debugScene=!debugScene">Debug scene</a>\n	<pre ng-if="debugScene">{{scene | pretty}}</pre>\n</div>\n'),a.put("templates/scene/landingscreen.html",'<div>\n\n	<div style="width:40%; margin: 30%">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	This is the landing screen. So far it is just a stub.\n	<h3>{{episode.title}}</h3>\n	<p>{{episode.description}}</p>\n</div>\n'),a.put("templates/scene/scene.html",'<div class="scene" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div itt-magnet class="videoMagnet">\n		<img src="images/aspectratiopreserver-16x9.gif">\n	</div>\n	<div class="pane mainPane">\n		<div class="fill bgLayer">\n			<div class="animate" ng-repeat="item in mainBgItems=(scene.items | isCurrent | itemLayout:\'mainBg\')" itt-item="item"></div>\n		</div>\n		<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n			<div class="itemanimate" ng-repeat="item in mainContentItems() | isCurrent" itt-item="item"></div>\n			<div class="clear"></div>\n		</div>\n		<div class="fill fgLayer overlay">\n			<div class="animate" ng-repeat="item in mainFgItems = (scene.items | isCurrent | itemLayout:\'mainFg\')" itt-item="item"></div>\n		</div>\n	</div>\n\n	<div class="pane altPane">\n		<div class="fill bgLayer">\n			<div class="animate" ng-repeat="item in altBgItems = (scene.items | isCurrent | itemLayout:\'altBg\')" itt-item="item"></div>\n		</div>\n		<div class="content contentLayer" ng-class="{singleitem: altItems.length==1, allowHighlights: !showCurrent}">\n			<div class="itemanimate" ng-repeat="item in altContentItems()" itt-item="item"></div>\n			<div class="clear"></div>\n		</div>\n		<div class="fill fgLayer overlay">\n			<div class="animate" ng-repeat="item in altFgItems=(scene.items | isCurrent | itemLayout:\'altFg\')" itt-item="item"></div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/searchpanel.html",'<div>\n	<div class="searchfilters">\n		<label x-ng-show="sortBy!==\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="startTime">Sorted by\n			<span class="fakelink">type</span>\n		</label>\n		<label x-ng-show="sortBy===\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" x-ng-model="sortBy" value="type">Sorted by\n			<span class="fakelink">time</span>\n		</label>\n	</div>\n	<div class="scrollContainer">\n		<div class="searchResults">\n			<div x-ng-if="sortBy == \'startTime\'">\n				<div x-ng-repeat="scene in episode.scenes">\n					<h3 x-ng-if="sceneItems.length > 0 && scene.title">{{scene.title}}</h3>\n					<div x-ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText, \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'">\n					</div>\n				</div>\n			</div>\n\n			<!-- sorted by type -->\n			<div x-ng-if="sortBy == \'type\'">\n				<div x-ng-repeat="(typeID,showType) in searchTypes" x-ng-if="showType">\n					<h3 x-ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3>\n					<div x-ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\">\n					</div>\n				</div>\n			</div>\n			<div x-ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">\n				(Nothing matched your search.)\n			</div>\n		</div>\n	</div>\n</div>\n"),a.put("templates/timeline.html",'<div class="timeline">\n\n	<!-- \n	<br>TODO: add [CC] button\n -->\n	<div class="progressbarBox">\n		<div class="auxControls">TODO zoom icons:\n			<a class="button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()">[-]\n				<span class="control-text">Zoom out</span>\n			</a>\n			<a class="button-zoomin" ng-click="zoomIn()">[+]\n				<span class="control-text">Zoom in</span>\n			</a>\n		</div>\n		<div class="middlerow">\n			<div class="progressbar">\n				<div class="mask">\n					<div class="progressbarContainer" style="width: {{zoomLevel}}00%">\n						<div class="played" style="width: {{markerPercent(appState.time)}}%"></div>\n						<div class="buffered" style="width: {{0}}%"></div>\n					</div>\n				</div>\n				<!-- unmasked parts of timeline -->\n				<div class="progressbarContainer" style="width: {{zoomLevel}}00%;">\n					<div class="handle" ng-show="isSeeking " style="left: {{markerPercent(willSeekTo)}}% ">\n						<div class="tip">{{willSeekTo | asTime}}</div>\n					</div>\n					<div class="tooltip" ng-if="event.showTooltip" ng-repeat="event in timeline.markedEvents " style="left: {{markerPercent(event.start_time)}}% ">\n						<span class="content">{{event.title}}</span>\n						<div class="tooltip-arrow"></div>\n					</div>\n				</div>\n				<div class="mask" ng-mousedown="startSeek($event)" ng-mousemove="seeking($event)">\n					<!-- interactive parts of timeline -->\n					<div class="progressbarContainer " style="width: {{zoomLevel}}00%">\n						<div class="marker" ng-mouseover="showTooltip(event);" ng-mouseout="hideTooltip(event)" ng-repeat="event in timeline.markedEvents" style="left: {{markerPercent(event.start_time)}}% "></div>\n					</div>\n				</div>\n			</div>\n			<a ng-class="{invisible: appState.time == 0}" class="button-prev" ng-click="prevScene()">\n				<span class="control-text">Previous</span>\n			</a>\n			<a class="button-scenemenu" ng-click="toggleNavPanel()">\n				<span class="control-text">Scenes</span>\n			</a>\n			<a ng-class="{invisible: appState.time == appState.duration}" class="button-next" ng-click="nextScene()">\n				<span class="control-text">Next</span>\n			</a>\n		</div>\n		<div class="auxInfo">\n			<span class="small" style="float:left;">\n				{{appState.time | asTime}} / {{appState.duration | asTime}}\n				<span ng-if="appState.videoType == \'video\'">\n					<a ng-if="appState.timeMultiplier == 1" ng-click="setSpeed(1.25)">ICON TODO x1</a>\n					<a ng-if="appState.timeMultiplier == 1.25" ng-click="setSpeed(1.5)">ICON TODO x1.25</a>\n					<a ng-if="appState.timeMultiplier == 1.5" ng-click="setSpeed(2)">ICON TODO x1.5</a>\n					<a ng-if="appState.timeMultiplier == 2" ng-click="setSpeed(0.75)">ICON TODO x2</a>\n					<a ng-if="appState.timeMultiplier == 0.75" ng-click="setSpeed(1)">ICON TODO x0.75</a>\n\n				</span>\n			</span>\n\n			<a class="button-mute {{audioIcon()}}" ng-click="toggleMute()">\n				<span class="control-text">Mute</span>\n			</a>\n			<div class="volumebar" ng-mousedown="userChangingVolume($event);">\n				<div class="volume" style="width: {{currentVolume()}}%"></div>\n			</div>\n		</div>\n	</div>\n\n	<a class="button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()">\n		<span class="control-text">Play</span>\n	</a>\n	<a class="button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()">\n		<span class="control-text">Pause</span>\n	</a>\n\n\n	<!-- \n	<div>Playback speed is {{appState.timeMultiplier}}.\n		<a ng-click="setSpeed(0.5) ">0.5x</a>\n		<a ng-click="setSpeed(1) ">1x</a>\n		<a ng-click="setSpeed(1.5) ">1.5x</a>\n		<a ng-click="setSpeed(2) ">2x</a>\n		<a ng-click="setSpeed(5) ">5x</a>\n	</div> -->\n</div>\n'),a.put("templates/video.html",'<div class="video">\n	<iframe id="ytplayer{{uid}}" ng-if="video.youtube" ng-src="{{video.youtube + \'?enablejsapi=1&controls=0&modestbranding=1&showinfo=0\'}}"></iframe>\n	<video ng-if="!video.youtube">\n		<source class="mpeg4" ng-if="video.mpeg4" ng-src="{{video.mpeg4}}" type="video/mp4" />\n		<source class="webm" ng-if="video.webm" ng-src="{{video.webm}}" type="video/webm" />\n		<p>Oh no! Your browser does not support the HTML5 Video element.</p>\n	</video>\n	<img ng-click="videoClick()" class="videoMask" src="images/aspectratiopreserver-16x9.gif">\n</div>\n')
}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.player").factory("authSvc",["config","$routeParams","$http","$q","$location",function(a,b,c,d,e){var f={};f.roles=[],f.userHasRole=function(a){for(var b=0;b<f.roles.length;b++)if(f.roles[b]===a)return!0;return!1},f.authenticate=function(){var a=d.defer();if(b.key){var f=b.key;e.search("key",null),h(f).then(function(){a.resolve()})}else if(c.defaults.headers.common.Authorization)a.resolve();else if(localStorage&&localStorage.storyAuth){var i=angular.fromJson(localStorage.storyAuth);c.defaults.headers.common.Authorization='Token token="'+i.access_token+'"',a.resolve()}else g().then(function(b){h(b).then(function(){a.resolve()})});return a.promise};var g=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url&&(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url)}).error(function(){b.reject()}),b.promise},h=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){localStorage&&(localStorage.storyAuth=JSON.stringify(a)),f.roles=a.roles,c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',e.resolve(a)}).error(function(){e.reject()}),e.promise};return f}]),angular.module("com.inthetelling.player").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc",function(a,b,c,d,e,f,g){var h={};h.storeEvent=function(){},h.storeEpisode=function(){},h.storeAsset=function(){},h.getEpisodeList=function(){var c=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+"/v1/episodes").success(function(a){c.resolve(a)}).error(function(){})}),c.promise},h.getEpisode=function(a){g.episodes[a]||(g.cache("episode",{_id:a}),c.local?r(a):f.authenticate().then(function(){l().then(function(){o(a)},function(){})},function(){}))};var i={template:{},layout:{},style:{}},j=!1,k=a.defer(),l=function(){if(j===!0)k.resolve();else{if("in progress"===j)return k.promise;j="in progress",a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){m("templates",a[0].data),m("layouts",a[1].data),m("styles",a[2].data),j=!0,k.resolve()},function(){j=!1,k.reject()})}return k.promise},m=function(a,b){angular.forEach(b,function(b){"templates"===a?i.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types[0],displayName:b.name}:"layouts"===a?i.layout[b._id]={id:b._id,css:b.css_name,displayName:b.display_name}:"styles"===a&&(i.style[b._id]={id:b._id,css:b.css_name,displayName:b.display_name})})},n=function(a){if(a.template_id&&i.template[a.template_id]&&(a.templateUrl=i.template[a.template_id].url,delete a.template_id),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){i.layout[a]&&b.push(i.layout[a].css)}),b.length>0&&(a.layouts=b),delete a.layout_id}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){i.style[a]&&c.push(i.style[a].css)}),c.length>0&&(a.styles=c),delete a.style_id}return a},o=function(a){b.get(e.apiDataBaseUrl+"/v1/episodes/"+a).success(function(b){("Published"===b.status||f.userHasRole("admin"))&&(g.cache("episode",n(b)),p(a),q(b.container_id,a))}).error(function(){})},p=function(a){b.get(e.apiDataBaseUrl+"/v2/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",n(a))}),g.resolveEpisodeEvents(a)}).error(function(){})},q=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&q(a[0].parent_id,c)}).error(function(){}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)}).error(function(){})},r=function(a){g.cache("episode",{_id:a,created_at:"2014-04-10T02:02:15Z",description:"The Business Case for Sustainability",master_asset_id:"masterasset",title:"Test Episode",status:"Published",templateUrl:"templates/episode/episode.html",styles:["transitionSlideL","highlightSide"]}),g.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/embed/sRS36lDiDvk","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var b={_id:"-",_type:"Scene",title:"Scene title",description:"Scene Description",keywords:[],start_time:0,end_time:10,type:"Scene",episode_id:a,layouts:["","splitTransmedia","showCurrent"]},c=["templates/scene/1col.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/cornerH.html","templates/scene/cornerV.html"],d=0;20>d;d++){var e=angular.copy(b);e._id="scene-"+d,e.title=d/2===Math.floor(d/2)?"Scene "+(d+1)+" Title":"",e.start_time=10*d,e.end_time=10*d+10,e.templateUrl=c[d%c.length],g.cache("event",e)}var f={_id:"",_type:"Annotation",annotation:"Transcript text",annotation_image_id:"",annotator:"Speaker Name",cosmetic:!1,episode_id:a,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript.html",styles:[]};for(d=0;30>d;d++){var h=angular.copy(f);h._id="transcript-"+d,h.annotation="Transcript block number "+(d+1),h.start_time=d,h.end_time=d+1,g.cache("event",h)}g.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),g.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),g.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),g.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var i={_id:"",_type:"Link",link_image_id:"asset1",url:"http://www.inthetelling.com",title:"Link Title",description:"Link Description",cosmetic:!1,stop:!1,type:"Link",episode_id:a,templateUrl:"templates/item/link.html",layouts:["inline"],layoutCss:"inline",isContent:!0};for(d=0;30>d;d++){var j=angular.copy(i);j._id="link-"+d,j.required=Math.random()>.5,j.start_time=d,j.end_time=d+1,g.cache("event",j)}var k={_type:"Upload",description:"Description of an upload item",required:!1,cosmetic:!1,stop:!1,type:"Upload",episode_id:a,templateUrl:"templates/item/upload.html",layouts:["inline"]};for(d=0;30>d;d++){var l=angular.copy(k);l._id="upload-"+d,l.asset_id="asset"+(d%3+2),l.title="Upload number "+(d%3+1),l.start_time=2*d,l.end_time=2*d+2,g.cache("event",l)}var m=["windowBg","mainBg","altBg","videoOverlay","mainFg","altFg","windowFg"];for(d=0;7>d;d++){var n=angular.copy(k);n.layouts=[m[d]],n._id="filltest-"+d,n.asset_id="asset2",n.start_time=5*d,n.end_time=5*d+4,n.templateUrl="templates/item/image-fill.html",g.cache("event",n)}g.resolveEpisodeEvents(a),g.resolveEpisodeAssets(a)};return h}]),angular.module("com.inthetelling.player").factory("modelSvc",["$interval",function(a){var b={};b.appState={isFramed:window.parent!=window,isIDevice:navigator.platform.indexOf("iPad")>-1||navigator.platform.indexOf("iPhone")>-1||navigator.platform.indexOf("iPod")>-1,windowWidth:0,windowHeight:0,viewMode:"discover",time:0,timeMultiplier:1,duration:0,timelineState:"paused",volume:100,muted:!1,show:{searchPanel:!1,helpPanel:!1,navPanel:!1},itemDetail:!1,editing:!1,blerg:"fnord"},a(function(){b.appState.windowHeight=angular.element(window).height(),b.appState.windowWidth=angular.element(window).width()},50,0,!1),b.episodes={},b.assets={},b.events={},b.containers={},b.cache=function(a,c){"episode"===a?b.episodes[c._id]?angular.extend(b.episodes[c._id],b.deriveEpisode(angular.copy(c))):b.episodes[c._id]=b.deriveEpisode(angular.copy(c)):"event"===a?b.events[c._id]?angular.extend(b.events[c._id],b.deriveEvent(angular.copy(c))):b.events[c._id]=b.deriveEvent(angular.copy(c)):"asset"===a?b.assets[c._id]?angular.extend(b.assets[c._id],b.deriveAsset(angular.copy(c))):b.assets[c._id]=b.deriveAsset(angular.copy(c)):"container"===a&&(b.containers[c._id]?angular.extend(b.containers[c._id],angular.copy(c)):b.containers[c._id]=angular.copy(c))},b.deriveEpisode=function(a){return a},b.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=e(a)),a};var c={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/episode.html","templates/episode-ewb.html":"templates/episode/episode.html","templates/episode-gw.html":"templates/episode/episode.html","templates/episode-tellingstory.html":"templates/episode/episode.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/item.html","templates/transcript-withthumbnail-alt.html":"templates/item/item.html","templates/text-h1.html":"templates/item/item.html","templates/text-h2.html":"templates/item/item.html","templates/text-pullquote-noattrib.html":"templates/item/item.html","templates/text-pullquote.html":"templates/item/item.html","templates/transmedia-caption.html":"templates/item/item.html","templates/transmedia-image-default.html":"templates/item/item.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-fill.html","templates/transmedia-linkonly.html":"templates/item/item.html","templates/transmedia-slidingcaption.html":"templates/item/item.html","templates/transmedia-thumbnail.html":"templates/item/item.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link.html"};b.deriveEvent=function(a){return"Scene"!==a._type&&(a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0)),c[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=c[a.templateUrl]),a},b.resolveEpisodeEvents=function(a){var c=[],e=[];angular.forEach(b.events,function(b){b.episode_id===a&&("Scene"===b._type?c.push(b):e.push(b))}),b.episodes[a].scenes=c.sort(function(a,b){return a.start_time-b.start_time}),b.episodes[a].items=e.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(c,function(a){var c=[];angular.forEach(e,function(d){d.start_time>=a.start_time&&d.start_time<a.end_time&&(b.events[d._id].scene_id=a._id,c.push(d))}),b.events[a._id].items=c.sort(function(a,b){return a.start_time-b.start_time})}),b.episodes[a].styleCss=d(b.episodes[a]),angular.forEach(b.events,function(b){b.episode_id===a&&(b.styleCss=d(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},b.episode=function(a){return!b.episodes[a],b.episodes[a]},b.episodeEvents=function(a){var c=[];return angular.forEach(b.events,function(b){b.episode_id===a&&c.push(b)}),c},b.scene=function(a){return!b.events[a],b.events[a]};var d=function(a){var c={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},d=[];if(angular.forEach(a.styles,function(a){d.push(a),angular.forEach(c,function(b,d){0===a.indexOf(d)&&(c[d]=a)})}),a.scene_id){var e=b.events[a.scene_id].styles;angular.forEach(e,function(a){angular.forEach(c,function(b,e){c[e]||0!==a.indexOf(e)||(d.push(a),c[e]=a)})})}if(a.episode_id){var f=b.episodes[a.episode_id].styles;angular.forEach(f,function(a){angular.forEach(c,function(b,e){c[e]||0!==a.indexOf(e)||d.push(a)})})}return d.join(" ")};b.resolveEpisodeAssets=function(a){angular.forEach(b.events,function(c){if(c.episode_id===a){var d=c.asset_id||c.link_image_id||c.annotation_image_id;d&&b.assets[d]&&(b.events[c._id].asset=b.assets[d])}}),b.episodes[a].masterAsset=b.assets[b.episodes[a].master_asset_id]},b.addLandingScreen=function(a){b.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:0,stop:!0}};var e=function(a){var b={};if(a.alternate_urls){for(var c=/\.(\w+)$/,d=0;d<a.alternate_urls.length;d++)if(a.alternate_urls[d].match(/youtube/))b.youtube=a.alternate_urls[d];else switch(a.alternate_urls[d].match(c)[1]){case"mp4":b.mpeg4=f(b.mpeg4,a.alternate_urls[d]);break;case"m3u8":b.m3u8=f(b.m3u8,a.alternate_urls[d]);break;case"webm":b.webm=f(b.webm,a.alternate_urls[d])}a.you_tube_url&&(b.youtube=a.you_tube_url)}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:a.you_tube_url};var e=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);return(e||navigator.platform.indexOf("iPad")>-1)&&b.mpeg4&&(b.youtube=void 0),b.youtube=void 0,a.video=b,a},f=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,d=a.match(c)||[0,0],e=b.match(c)||[0,0];return Math.floor(d[1])<Math.floor(e[1])?b:a};return b}]),angular.module("com.inthetelling.player").factory("timelineSvc",["$timeout","$interval","modelSvc","analyticsSvc",function(a,b,c,d){var e={};e.timelineEvents=[],e.markedEvents=[];var f,g,h,i;e.registerVideo=function(b){void 0!==g&&a(function(){e.seek(c.appState.time)}),g=b},e.setSpeed=function(a){i=a,c.appState.timeMultiplier=i,g.setSpeed(a),l()},e.play=function(){angular.isDefined(f)||g.play().then(function(){c.appState.timelineState="playing",h=b(p,1e3),n(),f=b(n,20),l(),d.captureActivity("play")})},e.pause=function(l){b.cancel(f),b.cancel(h),a.cancel(j),f=void 0,k=void 0,h=void 0,c.appState.timelineState="paused",g.pause(),l&&a(e.play,1e3*l*Math.abs(i)),d.captureActivity("pause")},e.seek=function(b,f,h){if(0===c.appState.duration)return void a(function(){e.seek(b)},300);a.cancel(j);var i=c.appState.time;if(b=o(b),0>b&&(b=0),b>c.appState.duration&&(b=c.appState.duration),c.appState.time=b,b>i?e.updateEventStates(i,b):e.updateEventStates(b,i),g.seek(b),l(),f){var k={method:f,seekStart:i};h&&(k.event_id=h),d.captureActivity("seek",k)}},e.toggleMute=function(){c.appState.muted=!c.appState.muted,g.toggleMute()},e.setVolume=function(a){c.appState.volume=a,g.setVolume(a)};var j,k,l=function(b){if(a.cancel(j),"playing"===c.appState.timelineState){var d=c.appState.time;if(!b){var f;for(f=0;f<e.timelineEvents.length;f++)if(e.timelineEvents[f].t>d){b=f;break}}if(!(void 0===b||0>b||b>e.timelineEvents.length)){var g=Math.abs(e.timelineEvents[b].t-d)/Math.abs(i)*1e3;j=a(function(){var a=e.timelineEvents[b].t;for(c.appState.time=a;e.timelineEvents[b].t===a;)m(e.timelineEvents[b]),b+=1;l(b)},g)}}},m=function(a){"timeline"===a.id?"pause"===a.action?e.pause():e.play():e.updateEventStates()},n=function(){var a=new Date,b=isNaN(a-k)?0:a-k,d=parseFloat(c.appState.time)+b/1e3*i;0>d&&(d=0,e.pause()),d>c.appState.duration&&(d=c.appState.duration,e.pause()),c.appState.time=d,k=a};e.init=function(a){e.timelineEvents=[],i=1,c.appState.duration=0,c.appState.timelineState="paused",l(),e.injectEvents(c.episodeEvents(a),0)},e.injectEvents=function(a,b){0!==a.length&&(angular.forEach(a,function(a){"Scene"===a._type&&a.title&&e.markedEvents.push(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,c.events[a._id].start_time=.01),a.stop?(e.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),e.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),e.timelineEvents.push({t:a.start_time+.01+b,id:a._id,action:"exit"})):(e.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&e.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"}))}),e.timelineEvents=e.timelineEvents.sort(function(a,b){return a.t-b.t}),c.appState.duration=e.timelineEvents[e.timelineEvents.length-1].t,e.updateEventStates(0,c.appState.duration))},e.updateEventStates=function(){var a=c.appState.time;angular.forEach(e.timelineEvents,function(a){if("timeline"!==a.id){var b=c.events[a.id];b.state="isFuture",b.isCurrent=!1}}),angular.forEach(e.timelineEvents,function(b){if(b.t<=a){var d=c.events[b.id];"enter"===b.action?(d.state="isCurrent",d.isCurrent=!0):"exit"===b.action&&(d.state="isPast",d.isCurrent=!1)}})};var o=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)},p=function(){var a=g.currentTime(),b=c.appState.time,d=a-b;Math.abs(d)>1?e.seek(a):Math.abs(d)>.1?(i=d/c.appState.timeMultiplier+c.appState.timeMultiplier,0>i&&(i=0),l()):i=c.appState.timeMultiplier};return e}]),angular.module("com.inthetelling.player").factory("analyticsSvc",["$http","$routeParams","$interval","config","modelSvc",function(a,b,c,d,e){var f={};f.activityQueue=[];var g=c(function(){f.flushActivityQueue()},5e3);b.local&&c.cancel(g),f.captureActivity=function(a,b){var c={name:a,walltime:new Date,timestamp:e.appState.time};b&&(c.data=b),f.activityQueue.push(c)},f.captureEventActivity=function(a,b){f.activityQueue.push({name:a,event_id:b,walltime:new Date})},f.flushActivityQueue=function(){if(0!==f.activityQueue.length){var a=angular.copy(f.activityQueue);f.activityQueue=[];var b=new Date,c=[],d=[];angular.forEach(a,function(a){a.age=(b-a.walltime)/1e3,delete a.walltime,a.event_id?d.push(a):c.push(a)}),d.length&&h("event_user_actions",{event_user_actions:d}),c.length&&h("episode_user_metrics",{episode_user_metrics:c})}};var h=function(c,e){a({method:"POST",url:d.apiDataBaseUrl+"/v2/episodes/"+b.epId+"/"+c,data:e}).success(function(){}).error(function(){})};return f}]),angular.module("com.inthetelling.player").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"===a._type&&b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",["$sce",function(a){return function(b,c){return c||angular.isNumber(c)?a.trustAsHtml((""+b).replace(RegExp(""+c,"gi"),'<span class="ui-match">$&</span>')):b}}]).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asPercent",function(){return function(a){return Math.floor(100*a)+"%"}}).filter("asTime",function(){return function(a){return Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}),angular.module("com.inthetelling.player").controller("ErrorController",["$scope","$rootScope","$location",function(a,b){b.$on("error",function(b,c){a.error=c})}]),angular.module("com.inthetelling.player").controller("EpisodeListController",["$scope","config","dataSvc",function(a,b,c){c.getEpisodeList().then(function(b){a.episodes=b}),a.authenticate=function(a){localStorage&&localStorage.removeItem("storyAuth"),window.location=b.apiDataBaseUrl+"/pages/launch_oauth2?episode="+a}}]),angular.module("com.inthetelling.player").controller("EpisodeEditorController",["$scope","$injector","modelSvc",function(a,b,c){b.invoke(PlayerController,this,{$scope:a}),c.appState.producer=!0,c.appState.HELLODOLLY="fantastic"}]),angular.module("com.inthetelling.player").controller("TimelineController",["$scope","timelineSvc","modelSvc",function(a,b,c){a.play=b.play,a.pause=b.pause,a.setSpeed=function(a){b.setSpeed(a)},a.markerPercent=function(a){return a/c.appState.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.player").controller("PlayerController",["$scope","$rootScope","$routeParams","$timeout","dataSvc","modelSvc","timelineSvc","analyticsSvc",function(a,b,c,d,e,f,g,h){a.viewMode=function(a){f.appState.viewMode=a,h.captureActivity("modeChange",{mode:a})},c.viewMode&&a.viewMode(c.viewMode),c.t&&g.seek(c.t,"URLParam"),c.producer&&(f.appState.producer=!0),f.addLandingScreen(c.epId),e.getEpisode(c.epId);var i=a.$watch(function(){return f.episodes[c.epId].title},function(a,b){a!==b&&(document.title="STORY: "+a,i())}),j=a.$watch(function(){return f.episodes[c.epId].items},function(a){a&&(g.init(c.epId),j())});a.episode=f.episode(c.epId),a.appState=f.appState,a.show=f.appState.show,a.now=new Date,a.toggleSearchPanel=function(){f.appState.show.searchPanel=!f.appState.show.searchPanel},a.toggleNavPanel=function(){f.appState.show.navPanel=!f.appState.show.navPanel},a.seek=function(a){g.seek(a,"sceneMenu")},a.editLayer=function(b){a.editLayer.scene=!1,a.editLayer.bgLayer=!1,a.editLayer.contentLayer=!1,a.editLayer.fgLayer=!1,""!==b&&(a.editLayer[b]=!0)}}]),angular.module("com.inthetelling.player").controller("EpisodeController",["$scope","modelSvc","$routeParams",function(a,b,c){a.episode=b.episode(c.epId),a.appState=b.appState}]),angular.module("com.inthetelling.player").controller("SceneController",["$scope",function(){}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","modelSvc","timelineSvc",function(a,b,c){a.seek=function(b){c.seek(b,"clickedOnItem",a.item._id)},a.editItem=function(){b.appState.producer&&(b.appState.editing=a.item)}}]),angular.module("com.inthetelling.player").controller("VideoController",["$q","$scope","$timeout","$window","$document","modelSvc","timelineSvc",function(a,b,c,d,e,f,g){var h=document.createElement("script");h.src="//www.youtube.com/iframe_api",angular.element(e[0].head).append(h),d.onYouTubeIframeAPIReady=function(){b.youtubeIsReady=!0},b.$on("$destroy",function(){b.YTPlayer=void 0}),b.initVideo=function(a){if(b.video.youtube)if(b.videoType="youtube",b.videoNode=a.find("iframe")[0],b.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return b.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",b.videoNode=a.find("video")[0],g.registerVideo(b),b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("waiting",function(){b.playerState="waiting"},!1),b.videoNode.addEventListener("stalled",function(){b.playerState="stalled"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1);f.appState.videoType=b.videoType},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data]}}}),g.registerVideo(b)},b.play=function(){var c=a.defer();if("youtube"===b.videoType){b.YTPlayer.playVideo();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())})}else b.videoNode.play(),c.resolve();return c.promise},b.pause=function(){"youtube"===b.videoType?(b.YTPlayer.seekTo(f.appState.time,!0),b.YTPlayer.pauseVideo()):(b.videoNode.currentTime=f.appState.time,b.videoNode.pause())},b.seek=function(a){try{"youtube"===b.videoType?(b.YTPlayer.seekTo(a,!0),"paused"===f.appState.timelineState&&b.pause()):b.videoNode.currentTime=a}catch(d){c(function(){b.seek(a)},100)}},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlyer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.seek=function(a,c){b.seek(a,"clickedOnEventInSearch",c)}}]),angular.module("com.inthetelling.player").directive("ittTimeline",["modelSvc","timelineSvc",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(c,d){c.appState=a.appState,c.timeline=b,c.handlePosition=0,c.zoomLevel=1,c.zoomOffset=0;var e=d.find(".progressbarContainer"),f=d.find(".progressbar");c.prevScene=function(){for(var c=b.markedEvents.length-1;c>=0;c--)if(b.markedEvents[c].start_time<a.appState.time){b.seek(b.markedEvents[c].start_time,"prevScene");break}},c.nextScene=function(){for(var c=!1,d=0;d<b.markedEvents.length;d++)if(b.markedEvents[d].start_time>a.appState.time){b.seek(b.markedEvents[d].start_time,"nextScene"),c=!0;break}c||b.seek(a.appState.duration,"nextScene")},c.userChangingVolume=function(b){a.appState.muted&&c.toggleMute();var d=angular.element(b.currentTarget),e=function(a,b){var e=(a.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),b?c.setVolume(e):c.$apply(c.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})},c.currentVolume=function(){return a.appState.muted?0:a.appState.volume},c.audioIcon=function(){return a.appState.muted?"muted":"vol"+Math.floor(a.appState.volume/34)},c.showTooltip=function(a){a.showTooltip=!0},c.hideTooltip=function(a){a.showTooltip=!1},c.zoomIn=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel+1,g()},c.zoomOut=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel-1,c.zoomLevel<1&&(c.zoomLevel=1),g()};var g=function(){c.zoomOffset=-((c.zoomLevel-1)*(a.appState.time/a.appState.duration)),e.animate({left:100*c.zoomOffset+"%",width:100*c.zoomLevel+"%"},1e3,function(){c.stopWatching=!1})};c.$watch(function(){return{t:a.appState.time,d:a.appState.duration}},function(){c.stopWatching||(c.zoomOffset=-((c.zoomLevel-1)*(a.appState.time/a.appState.duration)),e.css({left:100*c.zoomOffset+"%"}))},!0),c.startSeek=function(a){c.isSeeking=!0,f.bind("mouseup.timeline",function(){c.stopWatching=!0,b.seek(c.willSeekTo,"scrubTimeline"),g()}),angular.element(document).bind("mouseup.timeline",function(){angular.element(document).unbind("mouseup.timeline"),f.unbind("mouseup.timeline"),c.$apply(function(){c.isSeeking=!1})}),c.seeking(a)},c.seeking=function(b){c.isSeeking&&(c.willSeekTo=(b.clientX-e.offset().left)/e.width()*a.appState.duration)}}}}]),angular.module("com.inthetelling.player").directive("ittEpisode",["modelSvc","analyticsSvc",function(a,b){return{restrict:"A",replace:!0,templateUrl:"templates/episode/episode.html",controller:"EpisodeController",link:function(){b.captureActivity("episodeLoad")}}}]),angular.module("com.inthetelling.player").directive("ittScene",["$timeout","$filter","modelSvc",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl">Loading Item...</span>',controller:"SceneController",link:function(d,e){$.inArray("showCurrent",d.scene.layouts)>-1&&(d.showCurrent=!0),d.contentItems=b("isContent")(d.scene.items),d.mainContentItems=function(){return $.inArray("splitRequired",d.scene.layouts)>-1?b("transcriptandoptional")(d.contentItems):$.inArray("splitOptional",d.scene.layouts)>-1?b("transcriptandrequired")(d.contentItems):b("annotation")(d.contentItems)},d.altContentItems=function(){var a=d.contentItems;return $.inArray("showCurrent",d.scene.layouts)>-1&&(a=b("isCurrent")(d.contentItems)),a=$.inArray("splitRequired",d.scene.layouts)>-1?b("required")(a):$.inArray("splitOptional",d.scene.layouts)>-1?b("optional")(a):b("transmedia")(a)};var f=function(){e.find(".matchVideoHeight:visible").each(function(){$(this).css("height",e.find(".videoMagnet img").height())}),e.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",angular.element(window).height()-$(this).offset().top)})};a(f),d.unwatch=d.$watch(function(){return{winWidth:c.appState.windowWidth,winHeight:c.appState.windowHeight}},f,!0),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittItem",["modelSvc","analyticsSvc","timelineSvc",function(a,b,c){return{restrict:"A",replace:!0,scope:{item:"=ittItem"},template:'<div ng-click="editItem()" ng-include="item.templateUrl">Loading Item...</div>',controller:"ItemController",link:function(d,e){d.toggleDetailView=function(){d.item.showInlineDetail?d.item.showInlineDetail=!1:(b.captureEventActivity("clicked",d.item._id),e.closest(".content").width()>500?d.item.showInlineDetail=!0:(c.pause(),a.appState.itemDetail=d.item))},d.forceModal=function(){a.appState.itemDetail=d.item}}}}]),angular.module("com.inthetelling.player").directive("ittItemDetailModal",["modelSvc","timelineSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.appState.itemDetail=!1
}}}}]),angular.module("com.inthetelling.player").directive("ittItemEditor",["modelSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/item/edit.html",controller:"ItemController",link:function(b){b.save=function(){for(var c in b.item)b.item.hasOwnProperty(c)&&(a.events[b.item._id][c]=angular.copy(b.item[c]));a.appState.editing=!1},b.cancelEdit=function(){a.appState.editing=!1}}}}]),angular.module("com.inthetelling.player").directive("ittVideo",["$timeout","modelSvc","timelineSvc",function(a,b,c){var d=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(e,f){e.uid=++d,a(function(){if(e.video)e.initVideo(f);else var a=e.$watch(function(){return e.video},function(b){b&&(e.initVideo(f),a())})}),e.videoClick=function(){"paused"===b.appState.timelineState?c.play():c.pause()}}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope","$timeout","modelSvc",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.appState.windowWidth,winHeight:c.appState.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.abs(c)>2?e.width()+c/4:d.magnet.width()),e.height(d.magnet.width()/f)})};a.$on("magnet.changeMagnet",function(a,b){g(b)}),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittMagnet",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),b.$on("$destroy",function(){b.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittSearchPanel",["$sce",function(a){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(b){angular.forEach(b.episode.items,function(b){b.searchableText=(b.annotation||b.description)+" "+(b.title||b.annotator),b.trustedDisplayText=a.trustAsHtml(b.annotation||b.description),b.trustedDisplayTitle=a.trustAsHtml(b.title||b.annotator)})}}}]);