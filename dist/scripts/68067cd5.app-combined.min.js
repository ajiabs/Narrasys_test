"use strict";function ittItemDetailModal(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){var c={transition:"none"};b.item.animate||(b.modalSmooth=c),b.item=b.item.item,b.dismiss=function(){a.itemDetail=!1}}}}function ittNarrative(){return{templateUrl:"templates/narrative/default.html",controller:"ittNarrativeCtrl",controllerAs:"ittNarrative",scope:{narrativeData:"=",customerData:"="}}}function ittNarrativeCtrl(a,b,c,d,e){function f(a,b){var c=b.length,d=0;a>0&&(d=a===c-1?b[a-1].sort_order+100:e.bitwiseCeil((b[a-1].sort_order+b[a+1].sort_order)/2));var f=d;for(b[a].sort_order=d,a++,d++;c>a;a++)f>=b[a].sort_order&&(b[a].sort_order=d),f=d,d++}function g(b){d.storeTimeline(a.narrative._id,b).then(function(a){angular.extend(b,a)})}function h(){a.loading=!0,a.logout=b.logout,a.isOwner=!1,a.narrative=a.narrativeData,a.customers=a.customerData,a.user=c.user,(b.userHasRole("admin")||b.userHasRole("customer admin"))&&(a.canAccess=!0),a.loading=!1,p(a.narrative.timelines)}function i(){a.isEditing=!a.isEditing}function j(b){a.timelineUnderEdit=b,a.isEditingTimeline=!a.isEditingTimeline}function k(){a.isOwner=!a.isOwner}function l(){a.showEpisodeList=!a.showEpisodeList}function m(){a.timelineUnderEdit=null,a.narrative.timelines=a.narrative.timelines.filter(function(b){return b!==a.tmpTimeline}),a.tmpTimeline=null}function n(a,b){a.isTemp===!0?t(a):v(a,b)}function o(b){return b===a.timelineUnderEdit||b===a.tmpTimeline}function p(b){a.totalNarrativeDuration=b.map(function(a){return a.episode_segments.map(function(a){return a.end_time})[0]}).reduce(function(a,b){return a+=b},0)}function q(b){d.deleteTimeline(b._id).then(function(){a.narrative.timelines=a.narrative.timelines.filter(function(a){return b._id!==a._id}),m(),p(a.narrative.timelines)})}function r(b,c){var d,f,g,h,i;e.existy(b)?(h=c.indexOf(b),i=h+1,f=c[h],d=f.sort_order,c.slice(-1)[0]===f?d+=100:(g=c[h+1].sort_order,d=e.bitwiseCeil((g+d)/2))):(d=0,i=0);var j={name:{en:""},description:{en:""},hidden:!1,path_slug:"",sort_order:d,isTemp:!0,index:i},k=c.slice(0,i),m=c.slice(i,c.length);k.push(j),c=k.concat(m),a.narrative.timelines=c,a.tmpTimeline=j,l()}function s(b){d.getEpisodeOverview(b).then(function(b){return a.tmpTimeline.parent_episode=b,e.existy(b.description)&&(a.tmpTimeline.description.en=e.stripHtmlTags(b.description.en)),a.tmpTimeline.name.en=e.stripHtmlTags(b.title.en),b}).then(function(b){d.getSingleAsset(b.master_asset_id).then(function(b){b?a.tmpTimeline.duration=b.duration:a.tmpTimeline.duration=0,l()})})}function t(b){function c(c){return d.storeTimeline(a.narrative._id,b).then(function(a){return{d:a,e:c}})}function e(c){var e=c.d,f=c.e;d.createEpisodeSegment(e._id,{episode_id:f._id,start_time:0,end_time:b.duration,sort_order:0,timeline_id:e._id}).then(function(b){e.episode_segments=[b],angular.forEach(a.narrative.timelines,function(a){a.sort_order===e.sort_order&&angular.extend(a,e)}),a.tmpTimeline=null,m(),p(a.narrative.timelines)})}function g(){}f(b.index,a.narrative.timelines),d.createChildEpisode({parent_id:b.parent_episode._id}).then(c).then(e)["catch"](g)}function u(b){d.updateNarrative(b).then(function(b){a.isEditing=!1,angular.extend(a.narrative,b)})}function v(b,c){d.storeTimeline(a.narrative._id,b).then(function(a){angular.extend(c,a),m()})}var w={accept:function(){return!0},dropped:function(b){var c=b.dest.index,d=b.source.index;c!==d&&(f(c,a.narrative.timelines),g(a.narrative.timelines[c]))}};angular.extend(a,{toggleEditing:i,toggleEditingTimeline:j,doneEditingTimeline:m,toggleOwnership:k,toggleEpisodeList:l,updateNarrative:u,updateTimeline:v,addTmpTimeline:r,onEpisodeSelect:s,persistTmpTimeline:t,showTimelineEditor:o,editorAction:n,deleteTimeline:q,exportToSpreadsheet:d.getNarrativeExportAsSpreadsheet,isEditing:!1,canAccess:!1,isEditingTimeline:!1,treeOpts:w}),h()}function ittAssetUploader(a,b,c,d){return{restrict:"A",replace:!1,scope:{containerId:"=ittAssetUploader",callback:"=callback",mimeTypes:"@",instructions:"@",errorText:"@"},templateUrl:"templates/producer/asset-uploader.html",link:function(e,f,g){function h(a,b){return 0===a.indexOf(b)}function i(a,b){return a.substring(a.length-b.length,a.length)===b}void 0===e.instructions?e.manPage="We support uploads of most common file formats, including .doc, .docx, .jpeg, .jpg, .pdf, .png, .ppt, .pptx, .rtf, .txt, and .zip. ":e.manPage=e.instructions;var j;j=void 0===e.mimeTypes?["application/*","image/*","video/*","text/*","audio/*","model/*"]:e.mimeTypes.split(",");var k;k=void 0===e.errorText?"Whoops! You may want to try that again!":e.errorText,angular.forEach(j,function(a,b){j[b]=a.trim()}),e.uploadStatus=[],e.uploads=[],e.uploadsinprogress=0,e.multiple=void 0!==g.multiple,e.handleUploads=function(a){if(!e.multiple&&(a.length>1||e.uploads.length>0))return e.errormessage="You may only upload one file at a time here.",!1;var f=!1;if(angular.forEach(a,function(a){angular.forEach(j,function(b){var c=i(b,"*");if(c){var d=b.slice(0,-1),e=h(a.type,d);e&&(f=!0)}else a.type===b&&(f=!0);k=a.type+" uploads are not allowed here."})}),!f)return void(e.errormessage=k);var g=e.uploads.length,l=e.uploads.length+a.length;e.uploadsinprogress=e.uploadsinprogress+a.length,e.containerId?e.uploads=e.uploads.concat(b.uploadContainerFiles(e.containerId,a)):e.uploads=e.uploads.concat(b.uploadUserFiles(c.user._id,a));for(var m=g;l>m;m++)!function(b){e.uploadStatus[b]={bytesSent:0,bytesTotal:1,percent:0,name:a[b-g].name},e.uploads[b].then(function(a){d.cache("asset",a.file),e.callback&&e.callback(a.file._id),e.uploadStatus[b].done=!0,e.oneDone()},function(a){e.uploadStatus[b].error=a,e.oneDone()},function(a){e.uploadStatus[b].bytesSent=a.bytesSent,e.uploadStatus[b].bytesTotal=a.bytesTotal,e.uploadStatus[b].percent=Math.ceil(a.bytesSent/a.bytesTotal*100)})}(m)},e.oneDone=function(){e.uploadsinprogress=e.uploadsinprogress-1,0===e.uploadsinprogress&&(e.fileinput.value="",e.paused=!1)},e.handleDrop=function(a){a.preventDefault(),a.stopPropagation(),e.handleDragLeave(),e.handleUploads(a.dataTransfer.files)},e.handleDragOver=function(a){return a.preventDefault(),a.dataTransfer.dropEffect="move",e.handleDragEnter(),!1},e.handleDragEnter=function(){e.droptarget.addClass("droppable")},e.handleDragLeave=function(){e.droptarget.removeClass("droppable")},e.pauseUpload=function(){b.pauseUpload(),e.paused=!0},e.resumeUpload=function(){b.resumeUpload(),e.paused=!1},e.cancelUpload=function(){b.cancelUpload()},a(function(){e.droptarget=f.find(".uploadDropTarget"),e.fileinput=f.find(".uploadFileInput"),e.uploadsinprogress=0,e.droptarget[0].addEventListener("drop",e.handleDrop),e.droptarget[0].addEventListener("dragover",e.handleDragOver),e.droptarget[0].addEventListener("dragenter",e.handleDragEnter),e.droptarget[0].addEventListener("dragleave",e.handleDragLeave)})}}}angular.module("com.inthetelling.story",["ngRoute","ngAnimate","ngSanitize","textAngular","ui.tree"]).constant("MIMES",{assetLib:"image/*,text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf",file:"text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf","default":"image/*"}).config(["$routeProvider",function(a){a.when("/",{title:"Telling STORY",templateUrl:"templates/root.html"}).when("/auth",{templateUrl:"templates/auth.html",reloadOnSearch:!1}).when("/account",{template:'<div class="standaloneAncillaryPage"><div itt-user></div></div>'}).when("/stories",{title:"Existing narratives",template:'<div class="standaloneAncillaryPage">\n	<itt-nav on-logout="logout()"></itt-nav>\n	<h1>Narratives</h1>\n	<div itt-narrative-list narratives-data="narrativesResolve" customers-data="customersResolve"></div>\n</div>',controller:"NarrativesCtrl",resolve:{narrativesResolve:["$route","$q","ittUtils","authSvc","dataSvc","modelSvc",function(a,b,c,d,e,f){var g,h=f.getNarrativesAsArray(),i=Object.keys(h).length>1;return i?(g=f.getCustomersAsArray(),b(function(a){return a({n:h,c:g})})):d.authenticate().then(function(){return e.getCustomerList().then(function(a){return e.getNarrativeList().then(function(b){return angular.forEach(b,function(a){a.subDomain=f.customers[a.customer_id].domains[0],f.cache("narrative",a)}),{n:b,c:a}})})})}]}}).when("/story/:narrativePath",{template:'<div class="standaloneAncillaryPage"><div itt-narrative narrative-data="narrativeResolve" customer-data="customersResolve"></div></div>',controller:"NarrativeCtrl",resolve:{narrativeResolve:["$route","$q","authSvc","dataSvc","modelSvc","ittUtils",function(a,b,c,d,e,f){var g,h=a.current.params.narrativePath,i=e.getNarrativeByPathOrId(h),j=f.existy(i)&&f.existy(i.path_slug)&&f.existy(i.timelines)&&(i.path_slug.en===h||i._id===h);return j?(g=e.getCustomersAsArray(),b(function(a){return a({n:i,c:g})})):d.getNarrative(h).then(function(a){return d.getCustomerList().then(function(b){return{n:a,c:b}})})}]}}).when("/story/:narrativePath/:timelinePath",{template:"<div itt-narrative-timeline></div>",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="narrative"}]}}).when("/projects",{title:"Available projects",templateUrl:"templates/producer/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="player",a.productLoadedAs="player"}]}}).when("/sxs/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/editor/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="sxs",a.productLoadedAs="sxs"}]}}).when("/producer/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",resolve:{product:["appState",function(a){a.product="producer",a.productLoadedAs="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",controller:"ContainerAssetsTestController",template:'<div class="standaloneAncillaryPage"><div><a class="goUp" href="/#/projects">Projects</a><div sxs-container-assets="containerId" mime-key="assetLib"></div></div></div>'}).when("/event/:eventId",{title:"Event test",controller:"EventTestController",templateUrl:"templates/testbed-event.html"}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope","errorSvc",function(a,b){a.$on("$routeChangeSuccess",function(a,c){document.title=c.title?c.title:"Telling STORY",b.init()});var c=!1;$(document).on("keydown",function(b){c||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.attributes.contenteditable||(c=!0,27===b.keyCode&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))}),$(document).on("keyup",function(){c=!1})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push(["$q","errorSvc",function(a,b){return{responseError:function(c){return b.error(c),a.reject(c)}}}])}]).config(["$provide",function(a){a.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return b.defaultFileDropHandler=function(){},b.toolbar=[["h1","h2","h3"],["bold","italics","underline","strikeThrough"],["ul","ol"],["undo","redo","clear"]],b}])}]).config(["$compileProvider",function(a){var b=!1,c=window.location.hostname;(0===c.indexOf("localhost")||0===c.indexOf("api-dev"))&&(b=!0),b===!1&&a.debugInfoEnabled(!1)}]),angular.module("com.inthetelling.story").run(["$templateCache",function(a){a.put("templates/auth.html",'<div itt-login="" style="margin:2em"><a style="animation: delayedFadeIn 5s" href="/#/">Home</a></div>'),a.put("templates/container.html",'<div class="container" ng-class="{\n		isOpen: container.showChildren,\n		isClosed: !container.showChildren,\n		hoverIndicator: depth == 3\n	}" ng-if="container._id"><itt-modal modal-class="narrative__modal" ng-if="showNarrativeModal"><itt-narrative-editor customers="customers" container-id="container._id" name="container.name" path="container.name" customer-id="container.customer_id" on-done="toggleNarrativeModal()" on-update="postNewNarrative(data)"></itt-narrative-editor><itt-route-loading is-loading="resolvingNarrative"></itt-route-loading></itt-modal><div class="hoverIndicator"><span ng-if="!container.editingContainer"><itt-edit-pencil can-access="true" on-edit="container.editingContainer = true"><a ng-click="toggleChildren()">{{container.name.en}}</a> <span ng-if="depth==3" style="color:#999">({{container.status || Unpublished}})</span> </itt-edit-pencil></span> <span ng-if="container.editingContainer"><label>Name:&nbsp;<input ng-model="container.newContainerName" ng-init="container.newContainerName = container.name.en" autofocus>&nbsp;</label><button ng-click="container.editingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerName || container.newContainerName == container.name.en" ng-click="renameContainer()">Save</button></span> <span class="controls"><button class="danger" ng-if="appState.dangerousButtons && !container.children.length && !container.haveNotLoadedChildData" ng-click="deleteEpisodeAndContainer(container._id)">Delete</button>  </span></div><div ng-if="container.showChildren"><div ng-if="!container.addingContainer"><button ng-if="depth === 0" ng-click="container.addingContainer = true">+Project</button></div><div ng-if="container.addingContainer && depth === 0"><label>Name:&nbsp;<input ng-model="container.newContainerTitle" autofocus>&nbsp;</label><button ng-click="container.addingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button></div><div ng-if="!container.addingContainer"><div ng-if="depth === 1"><button ng-click="container.addingContainer = true">+Module</button> <a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a> <a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a></div></div><div ng-if="container.addingContainer && depth === 1"><label>Name:&nbsp;<input ng-model="container.newContainerTitle" autofocus>&nbsp;</label><button ng-click="container.addingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button></div><div ng-if="depth === 2"><div ng-if="!container.addingContainer"><button ng-click="container.addingContainer = true">+Episode</button> <a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a> <a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a></div><div ng-if="container.addingContainer"><label>Name:&nbsp;<input ng-model="container.newContainerTitle" autofocus>&nbsp;</label><button ng-click="container.addingContainer = false">Cancel</button> <button ng-disabled="!container.newContainerTitle" ng-click="addContainer(container)">Add</button></div></div><div ng-if="depth < 3" ng-repeat="child in container.children | orderBy:\'name.en\'" itt-container="containers[child._id]" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'" depth="depth+1" on-container-click="rootContext($container)" root-context="rootContext"></div><div ng-if="depth == 3" class="container"><a class="icon__button button__editor" ng-if="isDemoServer" href="#/editor/{{container.episodes[0]}}" title="Go to editor"></a> <a class="icon__button button__producer" href="#/producer/{{container.episodes[0]}}" title="Go to producer"></a> <a class="icon__button button__assets" ng-href="#/assets/{{container._id}}" title="Go to assets"></a> <a ng-if="canAccess" class="icon__button button__generateNarrative" title="Generate new narrative" ng-click="toggleNarrativeModal()"></a>         </div></div></div>'),a.put("templates/containerepisodes.html",' <span><li ng-if="!container.episodes.length" class="container" ng-class="{isOpen: container.wasClicked, isClosed: !container.wasClicked}" ng-click="toggle();loadChildren()" ng-bind-html="container.display_name"></li><li ng-if="container.episodes.length"><span class="hoverIndicator"><a ng-click="onNodeClick({node: container.episodes[0]})" ng-bind-html="containers[container._id].display_name"></a> ({{container.status}})</span></li><ul class="crossEpisodeNav" ng-class="{isOpen: container.wasClicked, isClosed: !container.wasClicked}" ng-if="container.wasClicked"><li ng-repeat="child in container.children" on-node-click="rootContext(node)" root-context="rootContext" itt-container-episodes="containers[child._id]" x-for-admin="true"></li></ul></span>'),a.put("templates/copyright.html",'TELLING STORY player &#169; <span ng-bind-html="now | date:\'yyyy\'"></span> <a href="//inthetelling.com" target="_blank">IN THE TELLING</a>. All rights reserved.<br><a href="/privacy.html" target="_blank">Privacy</a> <span ng-if="narrative.support_url">- <a ng-href="{{narrative.support_url}}">Support</a></span>'),a.put("templates/episode/career-playbook.html",'<div class="episode professional career-playbook" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="professional__branding"><div class="professional__copyright" ng-include="\'templates/copyright.html\'"></div><img class="professional__logo" src="images/customer/CPB_Logo-01-2.svg"></div></div>'),a.put("templates/episode/columbia.html",'<div class="episode episode-columbia" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/columbia.svg" alt="Columbia University"></div></div>'),a.put("templates/episode/columbiabusiness.html",'<div class="episode episode-columbiabusiness" ng-class="episode.styleCss"><div class="fill trident"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/cbs-logo.svg" alt="Columbia Business School"></div></div>'),a.put("templates/episode/components/discovermode.html",'<div class="discoverMode" ng-if="appState.viewMode == \'discover\'"><div class="fill windowBg bgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"></div></div><div itt-scene="scene" episode="episode"></div></div>'),a.put("templates/episode/components/reviewmode-scenes.html",'<div class="scene animate transitionFade" ng-class="{navigable: scene.display_title}" ng-repeat="scene in scenes" ng-if="!scene._internal"><div class="pane mainPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><h1 class="sceneTitle" ng-if="scene.display_title" ng-bind-html="scene.display_title"></h1><div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items| reviewMode | orderBy:\'start_time\'" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-all"></div><div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | reviewMode | annotation | orderBy:\'start_time\'" ng-class="item.state" itt-item="item" forcetemplate="review-annotation"></div></div></div><div ng-if="appState.windowWidth >= 480" class="pane altPane"><div class="content allowHighlights" ng-class="{isNarrow: isNarrow}" itt-width-watch=""><img ng-if="$index==1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding"> <div class="item animate" ng-repeat="item in scene.items | reviewMode | transmedia" ng-class="item.state + \' \' + item.uscReviewModeHack" itt-item="item" forcetemplate="review-transmedia"></div></div></div></div><itt-loading ng-if="isLoading"></itt-loading>'),a.put("templates/episode/components/reviewmode.html",'<div ng-show="appState.viewMode == \'review\'" class="searchMode"><div itt-magnet="" id="searchVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div itt-search-panel=""></div></div>'),a.put("templates/episode/components/video.html",'<div itt-magnetized="" class="pane videoContainer"><span ng-if="episode.masterAsset"><div class="video contentLayer" itt-video="episode.masterAsset" poster="episode.poster"></div></span><div class="pane fill overlay fgLayer"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div></div></div>'),a.put("templates/episode/components/watchmode.html",'<div ng-if="appState.viewMode == \'watch\'" style="padding-bottom: 100%"><div class="watchMode"><div itt-magnet="" id="watchModeVideoMagnet" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><span class="watchModeCaptions" ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class="item.state" itt-item="item" forcetemplate="caption"></div></span></div>'),a.put("templates/episode/components/windowfg.html",'<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"><div class="content w-modal"><div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div><a ng-if="!appState.editEvent && appState.timelineState == \'paused\'" class="button-continue" ng-click="continue()"><span>Continue</span></a></div></div>'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="eliterate logo" href="//www.mindwires.com" target="_blank"><img src="images/customer/eliterate-mindwires.svg" alt="Mindwires logo"></a> <a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/eliterate-logo.svg" alt="E-Literate"></div></div>'),a.put("templates/episode/episode.html",'<div class="episode professional default" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="professional__branding branding footer"><div class="professional__copyright" ng-include="\'templates/copyright.html\'"></div><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a></div></div>'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/ewb-logo.svg" alt="Engineers Without Borders"></div></div>'),a.put("templates/episode/fieldpros.html",'<div class="episode professional field-pros" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="professional__branding"><div class="professional__copyright" ng-include="\'templates/copyright.html\'"></div><img class="professional__logo" src="images/customer/Logo_ColorBars-01.svg"></div></div>'),a.put("templates/episode/george-washington.html",'<div class="episode professional george-washington" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="professional__branding"><div class="professional__copyright" ng-include="\'templates/copyright.html\'"></div></div></div>'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="George Washington"></div></div>'),a.put("templates/episode/gwlaw.html",'<div class="episode episode-gw" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-law.jpg" alt="GW Law"></div></div>'),a.put("templates/episode/gwsb.html",'<div class="episode episode-gwsb" ng-class="episode.styleCss"><div class="fill gwsb-seal"><div class="fill"></div></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/gw-logo.svg" alt="The George Washington University"></div></div>'),a.put("templates/episode/kellogg.html",'<div class="episode episode-kellogg" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><img src="images/customer/kellogg-k.svg"> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"></div></div>'),a.put("templates/episode/middlebury.html",'<div class="episode episode-middlebury" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span class="colorInvert DiscoverModeOnly" ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt-incolor.svg" alt="In The Telling logo"></a> <a class="logo" href="http://middlebury.edu"><img src="images/customer/middlebury-shield.svg" alt="Middlebury logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/middlebury-logo.svg" alt="Middlebury"></div></div>'),
a.put("templates/episode/narrasys-pro.html",'<div class="episode professional narrasys" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="professional__branding"><div class="professional__copyright" ng-include="\'templates/copyright.html\'"></div><img class="professional__logo" src="images/customer/Narrasys_brand_logo.svg"></div></div>'),a.put("templates/episode/prolotherapy.html",'<div class="episode episode-prolotherapy" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/prolotherapy-text.svg" alt="American Association of Musculoskeletal Medicine"></div></div>'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/purdue-logo.svg" alt="Purdue"></div></div>'),a.put("templates/episode/regis.html",'<div class="episode episode-regis" ng-class="episode.styleCss"><div class="fill bigregis"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/schoolclimatesolutions.html",'<div class="episode episode-schoolclimatesolutions" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/schoolclimatesolutions.svg" alt="SCS: School Climate Solutions"></div></div>'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/tellingstory-logo.svg" alt="Telling STORY"></div></div>'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="banner-logo"><img src="images/customer/usc-logo.svg" alt="USC"></div></div>'),a.put("templates/episode/washingtonSBCTC.html",'<div class="episode episode-wsbctc" ng-class="episode.styleCss"><div class="fill bigwsbctc"></div><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><div id="branding-wrapper"><img src="images/customer/WSBCTC_Logo.svg" id="sbctc-logo" alt="Washington SBCTC logo"> <a id="itt-logo" href="//inthetelling.com" target="_blank"><img src="images/itt-incolor.svg" alt="In The Telling logo"></a></div><span class="copyright" ng-include="\'templates/copyright.html\'"></span></div></div>'),a.put("templates/episode/wiley1.html",'<div class="episode episode-wiley wiley-endscreentext" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="ghost"></div></div>'),a.put("templates/episode/wiley2.html",'<div class="episode episode-wiley" ng-class="episode.styleCss"><span ng-include="\'templates/episode/components/reviewmode.html\'"></span> <span ng-include="\'templates/episode/components/watchmode.html\'"></span> <span ng-repeat="scene in episode.scenes | isCurrent" ng-include="\'templates/episode/components/discovermode.html\'"></span> <span ng-include="\'templates/episode/components/video.html\'"></span> <span ng-include="\'templates/episode/components/windowfg.html\'"></span><div ng-if="appState.viewMode != \'watch\'" class="branding footer"><a class="itt logo" href="//inthetelling.com" target="_blank"><img src="images/itt.svg" alt="In The Telling logo"></a> <span class="copyright" ng-include="\'templates/copyright.html\'"></span></div><div class="ghost"></div></div>'),a.put("templates/episode/wiley3.html","<div ng-include=\"'templates/episode/wiley1.html'\"></div>"),a.put("templates/error-404.html",'<div class="errors"><div class="error"><h3>Error: no such route</h3><p><i>404. File not found. Sorry!</i></p></div></div>'),a.put("templates/error.html",'<span ng-if="errorSvc.errors.length || errorSvc.notifications.length" class="errors"><div class="error" ng-repeat="error in errorSvc.errors" ng-click="dismiss(error)"><h3><i class="fa fa-exclamation-triangle error-red"></i> Error: {{error.cause || error.exception.data.error || error.exception.data || \'(unknown reason)\'}}</h3><p ng-if="error.exception.config.url"><i>(While trying to load {{error.exception.config.url}})</i></p><p ng-if="error.exception.status == 401">Please <span ng-if="user.login_url"><a ng-if="user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}" target="_top">click here</a> <a ng-if="!user.login_via_top_window_only" ng-click="logout();" ng-href="{{user.login_url}}">click here</a> to log back in.</span> <span ng-if="!user.login_url"><a ng-click="logout();">reset your session</a> and start over.</span></p></div><div class="notification" ng-repeat="notification in errorSvc.notifications"><a style="float: right" ng-click="dismiss(notification)">[x]</a><p><i class="fa fa-info-circle info-blue"></i> <strong>Note:</strong> {{notification.text}}</p></div></span>'),a.put("templates/iframe.html",'<div class="iframeContainer"><itt-loading ng-if="iframeCtrl.isLoading"></itt-loading><div ng-if="!iframeCtrl.isLoading"><iframe ng-if="!iframeCtrl.isYoutube" ng-src="{{iframeCtrl.src}}" ng-attr-scrolling="{{iframeCtrl.iOSScroll}}" ng-style="iframeCtrl.styles" ng-attr-sandbox="{{iframeCtrl.sandbox}}"></iframe><itt-youtube ng-if="iframeCtrl.isYoutube" embed-url="{{iframeCtrl.src}}" main-player="false" player-id="iframeCtrl.item()._id"></itt-youtube></div></div>'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/debug.html",'<div class="itemTemplate"><pre ng-if="itemDebug">{{item | pretty}}</pre></div>'),a.put("templates/item/file-withimage.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text item__text--file-with-image"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title item__title item__title--file-with-image"><a tabindex="0" class="escapelink item__link--escape-link" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)"><img ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title item__title item__title--file-with-image"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title item__title item__title--file-with-image"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink item__link--fake-link" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span></div><div class="item__text item__text--file-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.asset.url}}" item="item" x-contenttype="{{item.asset.content_type}}"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/file.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text item__text--file"><div class="title item__title item__title--file"><a role="button" tabindex="0" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="item__text item__text--file" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><span ng-switch="item.asset.content_type.indexOf(\'image/\')"><span ng-switch-when="-1"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink item__link--escape-link">(new window)</a><itt-iframe x-src="{{item.asset.url}}" item="item" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-default=""><img ng-src="{{item.asset.url}}"></span></span></div><div class="clear"></div></div>'),a.put("templates/item/image-caption-sliding.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption slidingcaption"><div class="title item__title item__title--image-caption-sliding" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text item__text item__title--image-caption-sliding" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/image-caption.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="captionContainer touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div><div class="caption"><div class="title item__title item__title--image-caption" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text item__text item__text--image-caption" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/image-fill.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate imageFill" style="{{item.backgroundImageStyle}}" ng-style="{\'backgroundImage\':item.asset.cssUrl}"><img class="fillImg" ng-src="{{item.asset.url}}"></div>'),a.put("templates/item/image-inline-withtext.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><div class="title item__title item__title--image-inline-with-text" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="item__text item__text--image-inline-with-text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="clear"></div></div></div>'),a.put("templates/item/image-inline.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-linkonly.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-plain.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="clear"></div></div>'),a.put("templates/item/image-thumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()"><img ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><div class="text item__text"><div class="title item__title item__title--image-thumbnail" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="text item__text item__text--image-thumbnail" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/image.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><div class="title item__title item__title--image"><a class="fakeLink item__link--fake-link" role="button" tabindex="0" ng-click="toggleDetailView()" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="item__text item__text--image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" x-ng-if="item.showInlineDetail"><div class="touchable" style="position:relative"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div><div class="clear"></div></div>'),a.put("templates/item/link-descriptionfirst.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><div class="item__text--link text--description-first" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="title item__title item__title--link title--description-first"><a tabindex="0" ng-if="item.noEmbed && !item.targetTop" class="escapelink item__escape-link item__link--escape-link escape-link--description-first" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" ng-if="item.noEmbed && item.targetTop" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" ng-if="!item.noEmbed" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link escape-link--description-first">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div></div>'),a.put("templates/item/link-embed.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><div class="title item__title item__title--link title--link-embed" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div class="item__text--link text--link-embed" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><a tabindex="0" class="escapelink item__link--escape-link escape-link--link-embed" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe><div class="clear"></div></div>'),a.put("templates/item/link-modal-thumb.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title item__title item__title--link title--link-modal"><a tabindex="0" class="escapelink item__link--escape-link escape-link--link-modal" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title item__title item__title--link title--link-modal"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title item__title item__title--link title--link-modal"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink item__link--fake-link" tabindex="0" ng-click="forceModal(false)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-if="item.asset.url" ng-click="forceModal(false)" ng-src="{{item.asset.url}}"></span><div class="item__text item__text--link text--link-modal" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="itemDetail" ng-if="item.showInlineDetail && appState.viewMode === \'review\'"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link escape-link--link-modal">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/link-withimage-notitle.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}" class="img--link-with-image-no-title"></a></span> <span ng-if="item.targetTop"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-src="{{item.asset.url}}" class="img--link-with-image-no-title"></a></span></span> <span ng-if="!item.noEmbed"><img ng-click="toggleDetailView()" ng-src="{{item.asset.url}}" class="img--link-with-image-no-title"></span><div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/link-withimage.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title item__title item__title--link title--link-with-image"><a tabindex="0" class="escapelink item__link--escape-link escape-link--link-with-image" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title item__title item__title--link title--link-with-image"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title item__title item__title--link title--link-with-image"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink item__link--fake-link" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-if="item.asset.url" ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span><div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div>'),
a.put("templates/item/link.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text"><span ng-if="item.noEmbed"><span ng-if="!item.targetTop"><div class="title item__title item__title--link title--link-with-image"><a tabindex="0" class="escapelink item__link--escape-link escape-link--link-with-image" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" ng-if="item.asset.url" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span> <span ng-if="item.targetTop"><div class="title item__title item__title--link title--link-with-image"><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><a tabindex="0" target="_top" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"></a></span></span> <span ng-if="!item.noEmbed"><div class="title item__title item__title--link title--link-with-image"><a role="button" x-ng-keypress="toggleDetailOnKeyPress($event)" class="fakeLink item__link--fake-link" tabindex="0" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><img ng-if="item.asset.url" ng-click="toggleDetailView()" ng-src="{{item.asset.url}}"></span><div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div>'),a.put("templates/item/modal.html",'<div class="modal" ng-style="modalSmooth" ng-click="dismiss();"><span ng-if="item._type == \'Link\'"><div class="modalmenu"><a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></span> <span ng-if="item._type == \'Upload\'"><span ng-switch="item.asset.content_type.indexOf(\'image/\')"><span ng-switch-when="-1"><div class="modalmenu"><a href="{{item.asset.url}}" target="_blank" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.asset.url}}" item="item" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-default=""><div class="modalimage" ng-if="item._type == \'Upload\'"><img ng-src="{{item.asset.url}}"></div></span></span></span></div>'),a.put("templates/item/pullquote-noattrib.html",' <a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote item__text item__text--pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="pullquoteSpeaker" ng-if="item.display_annotator"> <span ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></span></div></div>'),a.put("templates/item/pullquote.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="pullquote item__text item__text--pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="pullquoteSpeaker" ng-if="item.display_annotator"> <span ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></span></div></div>'),a.put("templates/item/question-mc-image-left.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text item__text--question-mc-image-left"><div class="title item__title item__title--question-mc-image-left" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:left; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question><div class="clear"></div></div></div>'),a.put("templates/item/question-mc-image-right.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text item__text--question-mc-image-right"><div class="title item__title item__title--question-mc-image-right" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:right; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question><div class="clear"></div></div></div>'),a.put("templates/item/question-mc-inner.html",'<div class="question item__text"><p ng-bind-html="plugin.questiontext | i18n"></p><div ng-if="!showChart"><div ng-repeat="distractor in choices"><div ng-if="(distractor.text | i18n) != \'\'"><label ng-class="{\n					correct: plugin.hasBeenAnswered && distractor.correct,\n					incorrect: plugin.hasBeenAnswered && !distractor.correct\n				}"><input ng-change="scoreQuiz($index)" type="radio" name="fnord" ng-model="index" ng-disabled="plugin.hasBeenAnswered" value="{{$index}}" ng-checked="distractor.selected"><span ng-bind-html="distractor.text | i18n"></span></label></div></div><div ng-if="plugin.hasBeenAnswered" ng-bind-html="feedback() | i18n"></div></div><div ng-if="showChart"><div ng-if="!plugin.hasBeenAnswered" ng-repeat="distractor in plugin.distractors"><div ng-if="(distractor.text | i18n) != \'\'"><label><input ng-change="scorePoll($index)" type="radio" name="fnord" ng-disabled="plugin.hasBeenAnswered" ng-model="$parent.plugin.selectedDistractor" value="{{$index}}"><span ng-bind-html="distractor.text | i18n"></span></label></div></div><br><div ng-if="plugin.hasBeenAnswered"><p ng-if="plugin.selectedDistractor">Here\'s how others answered this question. (Your choice was: <b ng-repeat="distractor in plugin.distractors | filter:{ index: plugin.selectedDistractor }" ng-bind-html="distractor.text | i18n"></b>)</p><itt-flotr2-chart type="{{chartType}}" data="{{chartData}}" options="{{chartOptions}}"></itt-flotr2-chart></div></div></div>'),a.put("templates/item/question-mc.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text item__text item__text--question-mc"><div class="title item__title item__title--question-mc" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question><div class="clear"></div></div></div>'),a.put("templates/item/review-all.html"," <span ng-switch=\"(item._type == 'Annotation' && item.templateUrl != 'templates/item/text-transmedia.html' && item.templateUrl != 'templates/item/text-definition.html')\"><span ng-switch-when=\"true\"><div ng-include=\"'templates/item/review-annotation.html'\"></div></span> <span ng-switch-default=\"\"><div ng-include=\"'templates/item/review-transmedia.html'\"></div></span></span>"),a.put("templates/item/review-annotation.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.isTranscript" class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div ng-if="!item.isTranscript" ng-include="item.templateUrl"></div><div class="clear"></div></div>'),a.put("templates/item/review-transmedia.html",'<span ng-class="{isCosmetic: item.cosmetic}"><div ng-if="item.sxs" ng-include="item.templateUrl"></div><span ng-if="!item.sxs"><span ng-if="item.layouts[0] == \'windowFg\'" ng-include="\'templates/item/review-windowfg.html\'"></span> <span ng-if="item.layouts[0] != \'windowFg\'"><div ng-if="item.data._pluginType" ng-include="item.templateUrl"></div><span ng-if="!item.data._pluginType"><a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" tabindex="0" class="startTime displayTime" aria-label="Seek video to {{item.displayStartTime}}" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><span ng-if="item._type == \'Annotation\'"><div class="text"><div class="title"><div ng-if="item.display_annotator" class="authorName" ng-bind-html="item.display_annotator"></div><div ng-if="item.display_title" class="authorName" ng-bind-html="item.display_title"></div></div><div ng-bind-html="item.display_annotation"></div></div></span> <span ng-if="item._type != \'Annotation\'"><div class="text"><div class="title"><a tabindex="0" ng-if="item.noEmbed" class="fakeLink escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex="0" role="button" class="fakeLink" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="toggleDetailView()" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a></div><div ng-bind-html="item.display_description"></div></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type == \'Link\'"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="itemDetail" ng-if="item.showInlineDetail && item._type != \'Link\'"><div class="touchable" style="position:relative"><img ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></div></span></div></span></span></span><div class="clear"></div></span>'),a.put("templates/item/review-windowfg.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div></div><div class="text"><div class="title"><a tabindex="0" ng-click="seek(item.start_time)" ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a></div><div class="text" ng-if="item.data._plugin._type == \'question\'">You have <span ng-if="!item.data._plugin.hasBeenAnswered">not yet</span> answered this <span ng-if="item.data._plugin.questiontype == \'mc-poll\'">poll</span> question.</div><div class="text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div><div class="clear"></div></div></div>'),a.put("templates/item/searchresults-all.html",'<span ng-class="{\'sxs-item\': item.sxs}"><a ng-if="item.editableByThisUser" class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div ng-style="\n    item.sxs?{background:\'url(\'+item.avatar.url+\') no-repeat scroll right top / 40px 40px\',minHeight:\'40px\'}:{}\n    " ng-class="{isCosmetic: item.cosmetic}" class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" ng-if="item._type !== \'Chapter\' && !item.chapter_marker" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="category"><span ng-if="item.required">(Required viewing)</span></div><div ng-if="item.display_annotator && item.producerItemType !== \'annotation\' || item.isPq" class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div ng-if="item.producerItemType == \'annotation\' && item.display_title && !item.isHeader && !item.isPq" class="authorName" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><span ng-if="item._type != \'Annotation\' && item._type !== \'Chapter\'"><a tabindex="0" ng-if="item.noEmbed" class="fakeLink escapelink item__link--escape-link item__link--fake-link" ng-click="outgoingLink(item.url)" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText"></a> <a tabindex="0" role="button" class="fakeLink item__link--fake-link" ng-if="!item.noEmbed" x-ng-keypress="toggleDetailOnKeyPress($event)" ng-click="item.showInlineDetail=!item.showInlineDetail" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a></span> <span ng-if="item._type === \'Chapter\' || item.chapter_marker"><h2 class="searchChapter" ng-bind-html="(item.display_annotation || item.display_title) | highlightSubstring: appState.searchText"></h2></span></div><div class="text item__text"><div ng-class="{showAsHeader: item.showAsHeader}" ng-if="!item.chapter_marker" ng-bind-html="item.display_annotation || item.display_description | highlightSubstring: appState.searchText"></div></div><div class="itemDetail" ng-if="item.showInlineDetail"><span ng-switch="item.producerItemType"><span ng-switch-when="file"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink item__link--escape-link">(new window)</a><itt-iframe x-src="{{item.asset.url}}" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span> <span ng-switch-when="link"><a tabindex="0" ng-if="!item.noExternalLink" x-ng-keypress="outgoingLinkOnKeyPress(item.url,$event)" ng-click="outgoingLink(item.url)" class="escapelink item__link--escape-link">(new window)</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></span> <span ng-switch-when="video"><span ng-switch-when="file"><a tabindex="0" x-ng-keypress="outgoingLinkOnKeyPress(item.asset.url,$event)" ng-click="outgoingLink(item.asset.url)" class="escapelink item__link--escape-link">(new window)</a><itt-iframe x-src="{{item.asset.url}}" item="item" x-contenttype="{{item.asset.content_type}}"></itt-iframe></span></span> <span ng-switch-when="image"><div class="touchable" style="position:relative"><img ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></span> <span ng-switch-when="question"><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"></itt-mc-question></span> <span ng-switch-default=""><span ng-if="item.data._pluginType == \'credlyBadge\'" ng-include="\'templates/item/usc-badges-inner.html\'"></span> </span></span></div></div></span>'),a.put("templates/item/searchresults.html",'<div ng-class="{\nsearchitem:true,\nisSxS: item.sxs,\nisCurrent: ((item.start_time <= appState.time) && (item.end_time > appState.time)),\nisCosmetic: item.cosmetic\n}" ng-style="item.sxs?{backgroundImage:\'url(\'+item.avatar.url+\')\'}:{}"><a class="edit-event" ng-click="editItem(item._id)"><span>Edit item</span></a> <span class="displayTime"><button class="fakeLink" tabindex="2" ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</button></span> <span class="type" ng-bind-html="(item.display_title || item.display_annotator) | highlightSubstring: appState.searchText"></span><div class="description" ng-bind-html="(item.display_description || item.display_annotation) | highlightSubstring: appState.searchText"></div></div>'),a.put("templates/item/sxs-annotation.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.annotation.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-file.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><a ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-image.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div><b ng-bind-html="item.title.en"></b><p style="text-align:center"><div ng-if="item.asset.url" class="touchable"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div></p></div><div class="text" ng-bind-html="item.description.en"></div><div class="clear"></div></div>'),a.put("templates/item/sxs-link.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><a ng-if="item.noEmbed" class="escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.title.en ||\'(Untitled)\'"></a><h3 ng-if="!item.noEmbed" ng-bind-html="item.title.en ||\'(Untitled)\'"></h3><div class="text" ng-bind-html="item.description.en"></div><div class="itemDetail" ng-if="item.url && !item.noEmbed && item.url != \'https://\'"><div class="modalmenu" ng-if="!item.noExternalLink"><a ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a></div><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe></div><div class="clear"></div></div>'),a.put("templates/item/sxs-question.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser"><span>Edit item</span></a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text"><div class="title" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-if="item.asset.url" class="touchable" style="float:right; max-width: 50%; padding-right: 0.5em"><img x-ng-click="forceModal()" ng-src="{{item.asset.url}}"><div class="touchableIndicator"></div></div><itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices="item.data._plugin.distractors" on-choice="save" data="item.data._plugin" qid="item._id"><div class="clear"></div></itt-mc-question></div></div>'),a.put("templates/item/sxs-video.html",'<div class="itemTemplate sxs-item"><a class="edit-event" ng-click="editItem()" ng-if="item.editableByThisUser">[Edit]</a><div class="avatar"><img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"></div><div class="itemHead"><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text"><div class="title" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div><div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div></div><a class="escapelink" ng-click="outgoingLink(item.url)">New window</a><itt-iframe x-src="{{item.url}}" item="item"></itt-iframe><div class="clear"></div></div>'),a.put("templates/item/text-definition.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div><div class="itemTemplate definition"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="item__title item__title--definition"><span ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></span></div></div><div class="text item__text item__text--definition" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/text-h1.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="item__text item__text--h1"><h1 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h1></div></div>'),a.put("templates/item/text-h2.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate headerItem"><div class="category"></div><div class="item__text item__text--h2"><h2 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h2></div></div>'),a.put("templates/item/text-transmedia.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div><div class="itemTemplate"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="item__title"><h2 class="item__title item__title--transmedia" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></h2></div></div><div class="text item__text item__text--transmedia" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail-alt.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="icon" style="float:right; margin-right: 0.5em"><img ng-src="{{item.asset.url}}"></div><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/transcript-withthumbnail.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcriptWithThumbnail"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><div class="icon" style="float:left; margin-right: 0.5em"><img ng-if="item.asset.url" ng-src="{{item.asset.url}}"><div class="clear"></div></div><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div><div class="text item__text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/transcript.html",'<a class="edit-event" ng-click="editItem()"><span>Edit item</span></a><div class="itemTemplate transcript"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a><div class="authorName" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div></div><div class="text" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div><div class="clear"></div></div>'),a.put("templates/item/usc-badges-inner.html",'<span><img style="max-width: 5em; float:left; margin-right: 0.5em" ng-src="{{plugin.credlyImageUrl}}"> <b>{{plugin.achievement}}</b> <span ng-if="plugin.eligibleForBadges"><p>Complete the following requirements to earn a <a ng-href="https://credly.com/recipients/{{plugin.credlyBadgeId}}" target="_blank">USC Scholar\'s Badge</a>:</p><div style="clear:both; margin: 1em 1.2em; font-size:90%"><div ng-repeat="req in plugin.requirements"><img ng-if="req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark.png"> <img ng-if="!req.achieved" style="width: 1em; height: 1em; margin-left: -1.2em" src="/images/checkmark-empty.png"> <span>{{req.name}}</span></div></div><p ng-if="plugin.totalAchieved != plugin.requirements.length">You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement.</p><div ng-if="plugin.totalAchieved == plugin.requirements.length && !plugin.gotBadge"><p>Congratulations! You are eligible for a USC Scholars Badge. Enter your email address to claim it:</p><input ng-model="plugin.userEmail"><input type="button" value="Go" ng-click="badger()"><span ng-if="plugin.gettingBadge"><small>Getting your badge...</small></span><div ng-if="plugin.error"><small>We\'re sorry, there was an error retrieving your badge. Please try again later.</small></div></div><div ng-if="plugin.gotBadge">Your badge is in the mail. <span ng-if="plugin.alreadyHadBadge">(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span></div></span> <span ng-if="!plugin.eligibleForBadges"><p>We\'re sorry, guest users are not eligibile for USC Scholar\'s Badges.</p></span></span>'),a.put("templates/item/usc-badges.html",'<div class="itemTemplate uscBadges"><div class="itemHead"><a role="button" aria-label="Seek video to {{item.displayStartTime}}" tabindex="0" class="startTime displayTime" x-ng-click="seek(item.start_time)" x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a></div><span ng-include="\'templates/item/usc-badges-inner.html\'"></span></div>'),a.put("templates/loading.html",'<div class="loading"><div class="spinner"><div class="rotating pie"></div><div class="filler pie"></div><div class="mask"></div></div>Loading</div>'),a.put("templates/narrative/default.html",'<div><div class="ancillaryNav"><a class="button" ng-if="canAccess" ng-click="exportToSpreadsheet(narrative._id)">Export to Spreadsheet</a> <a class="button" ng-if="canAccess" href="/#/projects">Projects</a> <a class="button" ng-if="canAccess" href="/#/stories">Narratives</a> <a class="button" ng-if="user._id" href="/#/account">Account</a> <a class="button" ng-if="user._id" ng-click="logout()">Log out</a></div><div ng-if="!loading"><div class="narrative"><div ng-hide="isEditing"><itt-edit-pencil can-access="canAccess" on-edit="toggleEditing()"><h2 ng-bind-html="narrative.name.en"></h2></itt-edit-pencil><p ng-bind-html="narrative.description.en"></p><p>Total Duration: {{totalNarrativeDuration | asTime}}</p></div><itt-narrative-editor ng-if="isEditing" narrative="narrative" customers="customers" on-done="toggleEditing()" on-update="updateNarrative(n)"></itt-narrative-editor><button ng-if="canAccess" ng-disabled="timelineUnderEdit || tmpTimeline" ng-click="addTmpTimeline(null, narrative.timelines)">Add Timeline</button><itt-modal ng-if="showEpisodeList"><div itt-episode-list="" class="admin episodePicker">Choose an episode: <button ng-click="toggleEpisodeList(); doneEditingTimeline()">cancel</button><ul ng-repeat="child in root.children" x-for-admin="true" itt-container-episodes="containers[child._id]" on-node-click="onEpisodeSelect(node)" root-context="onEpisodeSelect" depth="0"></ul></div></itt-modal><div ui-tree="treeOpts" ng-if="narrative.timelines.length !== 0"><div ui-tree-nodes="" ng-model="narrative.timelines"><div class="storyTimeline hoverIndicator" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'" ui-tree-node="" ng-repeat="timeline in narrative.timelines"><itt-timeline-editor ng-if="showTimelineEditor(timeline)" timeline="timeline" on-done="doneEditingTimeline()" on-update="editorAction(t, timeline)" on-delete="deleteTimeline(t)"></itt-timeline-editor><div ng-mouseenter="showDrag = true" ng-mouseleave="showDrag = false" ng-class="{\'timeline--hidden\': timeline.hidden}"><span ng-show="canAccess && showDrag" class="tlDrag__handle" ui-tree-handle=""><i class="fa fa-th"></i></span><div ng-hide="timelineUnderEdit === timeline || tmpTimeline === timeline" class="tl__wrapper"><itt-edit-pencil can-access="canAccess" on-edit="toggleEditingTimeline(timeline)"><h3><i ng-if="timeline.hidden" class="fa fa-eye-slash"></i> <a href="/#/story/{{narrative._id}}/{{timeline._id}}">{{timeline.name.en}}</a></h3></itt-edit-pencil><p>{{timeline.description.en}}</p>{{timeline.episode_segments[0].end_time | asTime}}<div ng-mouseenter="showLine = true" ng-mouseleave="showLine = false" style="height: 25px"><div ng-show="!!showLine && canAccess"><button ng-click="addTmpTimeline(timeline, narrative.timelines)">Insert Timeline</button></div></div></div></div></div></div></div></div></div></div><a ng-if="narrative.support_url" target="_blank" ng-href="{{narrative.support_url}}">Support</a>'),
a.put("templates/narrativelist.html",'<div><div ng-if="narrativeList.canAccess"><button ng-click="narrativeList.toggleSelectNarrative()">Add Narrative</button><itt-modal modal-class="narrative__modal" ng-if="narrativeList.narrativeSelect"><h3>Add Narrative</h3><itt-narrative-editor customers="narrativeList.customers" on-done="narrativeList.toggleSelectNarrative()" on-update="narrativeList.addNarrative(n)"></itt-narrative-editor></itt-modal></div><div ng-repeat="narrative in narrativeList.narratives" class="hoverIndicator" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'"><div><h3 class="narratives__name"><a href="/#/story/{{narrative._id}}">{{narrative.name.en}}</a></h3><p class="narratives__description" ng-if="narrative.description.en">{{narrative.description.en}}</p></div></div></div>'),a.put("templates/navpanel.html",'<span class="navPanel"><div class="parent" ng-repeat="parent in episode.parents" ng-bind-html="parent.display_name"></div><div class="scene" x-ng-if="scene.display_title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)"><span class="displayTime">{{scene.displayStartTime}}</span><p><button class="fakeLink" tabindex="0" ng-bind-html="scene.display_title" x-ng-class="{sceneLink: !scene.isCurrent}" ng-focus="showControls()"></button><br><span ng-bind-html="scene.display_description"></span></p></div><div class="crossEpisode"><a class="prevEpisode" ng-if="episode.previousEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.previousEpisodeContainer.episodes[0]}}" title="{{episode.previousEpisodeContainer.display_name}}">Previous episode</a> <a class="nextEpisode" ng-if="episode.nextEpisodeContainer" ng-href="/#/{{appState.crossEpisodePath}}/{{episode.nextEpisodeContainer.episodes[0]}}" title="{{episode.nextEpisodeContainer.display_name}}">Next Episode</a></div></span>'),a.put("templates/player-timeline.html",'<span><div ng-if="showPlayer" ng-controller="PlayerController" ng-include="\'templates/player.html\'"></div></span>'),a.put("templates/player.html","<div ng-class=\"{\n	isTouchDevice: appState.isTouchDevice,\n	isFramed: appState.isFramed,\n	isProducer: (appState.product == 'producer'),\n	isSxS: (appState.product == 'sxs'),\n\n	canEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == 'producer' || appState.product == 'sxs')\n"+'	}"><div class="player"><itt-toolbar-story></itt-toolbar-story><itt-loading ng-if="loading"></itt-loading><div ng-show="!loading" itt-episode="" ng-class="{\n		padForEditing: appState.editEvent || appState.editEpisode,\n		showBackgroundOnly: appState.producerEditLayer < 0,\n		showForegroundOnly: appState.producerEditLayer > 0,\n	}"></div><div class="toolbar-bottom" itt-show-hide-visual-only="appState.videoControlsActive" ng-mouseenter="showControls();" ng-click="showControls();" ng-mouseleave="allowControlsExit()"><div class="toolbar-bottom-fill"><div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"><div ng-if="appState.editEvent" itt-item-editor="appState.editEvent"></div><div ng-if="appState.editEpisode" itt-episode-editor="appState.editEpisode"></div></div><div itt-timeline=""></div></div></div><div class="toolbar-bottom-controltrigger" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()"></div></div><div class="animate transitionFade" ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter="showControls();" ng-click="showControls();" ng-focus="showControls()" sxs-add-content=""></div><div class="autoscroll" ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click="enableAutoscroll()"><img src="/images/autoscroll.svg" width="32" height="32"></div><div ng-show="show.navPanel" class="modal-backdrop" ng-click="hidePanel(\'navPanel\')"></div><div ng-show="show.profilePanel" class="modal-backdrop" ng-click="hidePanel(\'profilePanel\')"></div><div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div><div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div><div ng-if="show.profilePanel" class="profilePanel" ng-class="{isFramed: appState.isFramed}"><div class="arrow-up"></div><div itt-user="" x-in-player="true"></div></div><div ng-cloak="" ng-if="show.wileyNag &&  (appState.productLoadedAs == \'player\'\n	 			|| (appState.productLoadedAs == \'narrative\'\n	 			&& !narrative.disable_new_window ) )" class="wileyNag animate transitionFade"><div><span style="float:right"></span> <span style="float:right; display:inline-block; padding: 5px">Go here for best view</span></div><a class="goAway" ng-click="noWileyNag()">Don\'t show this again</a></div></div>'),a.put("templates/producer/addcontent.html",'<div ng-show="!appState.editEvent && !appState.editEpisode" class="controlPanel" ng-class="{\n	isProducer: appState.product == \'producer\',\n	isSxS: appState.product == \'sxs\'\n}"><div ng-if="appState.product == \'producer\'" class="editButtonPanel"><a class="button button-episode" ng-click="editEpisode()">Edit episode</a> <a class="button button-scene" ng-if="appState.time > 0  && appState.time < (appState.duration - 0.1) && appState.viewMode == \'discover\'" ng-click="editCurrentScene()">Edit Layout</a></div><div class="producer addButtonPanel" ng-show="!item && appState.time > 0 && appState.time < (appState.duration - 0.1) "><span ng-if="expanded" style="padding: 0 1em" class="animate transitionExpandW"><span ng-if="appState.product == \'sxs\'"><a class="button button-comment" ng-click="addEvent(\'annotation\')">Comment</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">File</a> <a class="button button-video" ng-click="addEvent(\'video\')">Video</a></span> <span ng-if="appState.product == \'producer\'"><a class="button button-scene" ng-click="addEvent(\'scene\')">Layout</a> <a class="button button-comment" ng-click="addEvent(\'transcript\')">Transcript</a> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Annotation</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')" ng-if="userHasRole(\'admin\') || userHasRole(\'customer admin\')">File</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-chapter" ng-click="addEvent(\'chapter\')">Chapter</a></span></span> <span ng-if="!expanded"><a class="button button-add" ng-click="expand()">Add</a></span></div></div>'),a.put("templates/producer/annotator-autocomplete.html",'<div style="position:relative" ng-show="!hasAnnotator()"><input class="annotatorChooser" ng-model="searchText" ng-focus="showAutocomplete()" ng-blur="hideAutocomplete()" ng-change="handleAutocomplete()"><div class="autocompleteList animate transitionFade" ng-if="autoCompleting"><div class="autocompleteItem" ng-repeat="annotator in filteredAnnotators | orderBy:\'name\'" ng-click="select(annotator)" ng-class="{selected: ($index == preselectedItem)}" style="white-space: nowrap"><img ng-src="{{annotator.imageUrl}}"> <span ng-bind-html="(annotator.key | highlightSubstring: searchText) || \'(New speaker)\'"></span></div></div></div><div style="position:relative" ng-show="hasAnnotator()"><div sxs-input-i18n="item.annotator" x-inputtype="\'input\'"></div><a style="position: absolute; top: 3px; right: 10px" ng-click="item.annotator={}">(x)</a></div>'),a.put("templates/producer/asset-uploader.html",'<div class="assetUploader"><div ng-if="uploads.length"><div class="uploadList" ng-repeat="upload in uploads"><span class="uploadName">{{uploadStatus[$index].name}}:</span> <span class="uploadProgress"><span ng-if="uploadStatus[$index].done">Upload complete</span><div ng-if="uploadStatus[$index].error">Error</div><span ng-if="!uploadStatus[$index].done && !uploadStatus[$index].error"><progress ng-attr-max="{{uploadStatus[$index].bytesTotal}}" ng-attr-value="{{uploadStatus[$index].bytesSent}}"></progress><span ng-switch="uploadStatus[$index].percent"><span ng-switch-when="100">...</span> <span ng-switch-default="">{{uploadStatus[$index].percent}}%</span></span></span></span><div ng-if="uploadStatus[$index].error">{{uploadStatus[$index].error}}</div></div><span ng-if="uploadsinprogress > 0">{{uploadsinprogress}} files remaining <button ng-if="!paused" ng-click="pauseUpload()">Pause</button> <button ng-if="paused" ng-click="resumeUpload()">Resume</button> <button ng-click="cancelUpload()">Cancel</button></span></div><div ng-if="errormessage" class="error-red" ng-bind-html="errormessage"></div><div class="uploadDropTarget"><a style="float:right" ng-click="showInstructions=!showInstructions">(?)</a> Drag and drop <span ng-if="multiple">files</span> <span ng-if="!multiple">a file</span> here<br><small>or choose <span ng-if="multiple">files</span> <span ng-if="!multiple">a file</span> to upload: <input class="uploadFileInput" type="file" multiple itt-files-handler="" on-selected="handleUploads(files)"></small><div ng-if="showInstructions" style="text-align:left"><small>{{manPage}}</small></div></div></div>'),a.put("templates/producer/container-assets.html",'<div ng-if="showParent"><div sxs-container-assets="container.parent_id"></div></div><div class="containerAssets"><div ng-if="appState.product != \'sxs\' && container.parent_id && !showParent"><a class="goUp" ng-click="up()">Parent container</a></div><div class="title">{{container.display_name}} - Asset Library</div><div class="controls"><a ng-click="toggleImages()"><span ng-if="onlyImages">Images</span> <span ng-if="!onlyImages">All</span></a> &nbsp; <a ng-click="toggleGrid()"><span ng-if="gridView"></span> <span ng-if="!gridView"></span></a></div><div class="scrollPane" ng-if="!hideItems"><div ng-if="gridView"><div class="grid" ng-repeat="asset in isCustAdmin ? (assets | vidsFromCustAdmins) : assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div><div ng-if="asset._type != \'Asset::Image\'"><div class="thumbnail">{{asset._type}}</div></div>{{asset.display_name}}</div></div><table ng-if="!gridView"><tr ng-repeat="asset in isCustAdmin ? (assets | vidsFromCustAdmins) : assets" ng-if="asset.container_id == containerId && !(onlyImages && asset._type != \'Asset::Image\')" ng-click="assetClick(asset._id)"><td><div ng-if="asset._type == \'Asset::Image\'"><img class="thumbnail" ng-src="{{asset.url}}"></div></td><td>{{asset.size |asBytes}}</td><td>{{asset.content_type}}</td><td>{{asset.display_name}}</td></tr></table></div><br><div ng-if="canAccess" itt-asset-uploader="container._id" mime-types="{{mimes}}" multiple></div></div>'),a.put("templates/producer/episode.html",'<div class="itemEdit authoringForm"><div ng-if="appState.product == \'producer\'"><div class="ittTabs" itt-tabs=""><div class="ittTab" itt-tab="" title="Episode"><div class="field" ng-hide="!userHasRole(\'admin\')"><div class="label">Master asset type</div><div class="input"><select size="1" ng-model="masterAssetType"><option value="Video">Native Video</option><option value="Youtube">Youtube</option></select></div></div><div class="field" ng-if="masterAssetType == \'Video\' && userHasRole(\'admin\')"><div class="label">Video</div><div class="input" ng-include="\'templates/producer/upload-masterasset.html\'"></div></div><div class="field" ng-if="masterAssetType == \'Youtube\'"><div class="label">Youtube URL</div><div class="input"><input ng-model="masterAsset.you_tube_url" style="width: 75%"><button ng-click="attachYouTube(masterAsset.you_tube_url)">Attach</button></div></div><div class="field" ng-if="showmessage"><div class="input" ng-bind-html="showmessage"></div></div><itt-title-field data="episode" model-opts="{ debounce: 500 }"></itt-title-field><itt-description-field data="episode" model-opts="{debounce: 50}"></itt-description-field><div class="field" ng-if="userHasRole(\'admin\')"><div class="label">Poster image</div><div class="input" ng-include="\'templates/producer/upload-poster.html\'"></div></div><div class="field"><div class="label">Status</div><div class="input"><select size="1" ng-model="episode.status"><option value="Published">Published</option><option value="Unpublished">Unpublished</option></select></div></div><itt-language-flags></itt-language-flags><itt-language-select ng-if="languageCount > 1" data="episode" lang-form="langForm"></itt-language-select><div class="field" ng-if="episode.languages.length > 1"><div class="label">Current Language</div><div class="input"><select size="1" ng-model="appState.lang" ng-change="forcePreview()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></div></div></div><div class="ittTab" itt-tab="" title="Style"><itt-template-select data="episode"></itt-template-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-click="saveEpisode()">Save</button></div></div>'),a.put("templates/producer/episodelist.html",'<div class="standaloneAncillaryPage"><itt-nav on-logout="logout()"></itt-nav><h1>Projects</h1><div itt-episode-list=""><div ng-if="userHasRole(\'admin\') || userHasRole(\'customer admin\')"><itt-loading ng-if="loading"></itt-loading><div ng-repeat="child in root.children | orderBy:\'name.en\'" itt-container="containers[child._id]" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'" depth="0" on-container-click="onContainerClick($container)" root-context="onContainerClick"></div><div ng-if="!(userHasRole(\'admin\') || userHasRole(\'customer admin\')) || (!loading && (failedLogin || root.children.length == 0))">Looks like you aren\'t logged in as an admin -- <a ng-click="logout();">try again</a>.</div></div></div></div>'),a.put("templates/producer/inputi18n.html",'<input ng-if="inputtype==\'input\'" ng-model="field[appState.lang]" name="{{textangularname}}" ng-required="doValidate"><text-angular ng-if="inputtype==\'textarea\'" name="{{textangularname}}" ng-required="doValidate" ng-model="field[appState.lang]" ta-paste="sanitizePastedHtml($html)" ta-default-wrap="span" ng-blur="trim()"></text-angular>'),a.put("templates/producer/inputtime.html",'<span class="floaterContainer"><input class="inputfield" ng-model="model" ng-focus="showTools(true)" ng-blur="showTools(false)" ng-model-options="{ updateOn: \'blur\' }" style="max-width: 150px" ng-class="{invalid: (fieldname == \'end_time\' && item.invalid_end_time)}"><div class="floater" ng-if="tooltip"><ul style="list-style:none; white-space:nowrap"><li style="text-align:center; font-size: 150%"><a ng-click="nudge(-5)"></a> <a ng-click="nudge(-1)"></a> <span>&nbsp;&nbsp;</span> <a ng-click="nudge(1)"></a> <a ng-click="nudge(5)"></a></li><li ng-click="setTime(appState.time)"><a>Set to current time ({{format(appState.time)}})</a></li><span ng-if="item._type != \'Scene\' && scene().start_time > 0"><li ng-if="fieldname==\'start_time\'" ng-click="setTime(scene().start_time)"><a>Beginning of scene ({{format(scene().start_time)}})</a></li><li ng-if="fieldname==\'end_time\'" ng-click="setTime(scene().end_time)"><a>End of scene ({{format(scene().end_time)}})</a></li><li ng-if="fieldname==\'end_time\' && isTranscript()" ng-click="TODO"><a>Auto (TODO)</a></li></span></ul></div></span>'),a.put("templates/producer/item.html",'<div class="itemEdit authoringForm"><form name="ittItemForm" class="doValidate"><div ng-if="appState.product == \'sxs\'" class="authoringFormScrollContainer"><itt-time-field></itt-time-field><div ng-include="itemEditor"></div></div><div ng-if="appState.product == \'producer\'"><div itt-tabs="" class="ittTabs"><div itt-tab="" class="ittTab" ng-if="selectService.showTab(item.producerItemType, \'Item\')" title="{{item.producerItemType | capitalize}}"><label ng-if="languages.length > 1" style="float:right; padding-right: 24px" for="itemLangSelect">Current Language<select id="itemLangSelect" size="1" ng-model="appState.lang" ng-change="forcePreview()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in languages"></select></label><div ng-switch="" on="item.producerItemType"><div ng-switch-when="link"><itt-time-field></itt-time-field><itt-title-field do-validate="true" data="item" itt-item-form="ittItemForm"></itt-title-field><itt-url-field data="item"></itt-url-field><itt-description-field data="item"></itt-description-field><itt-template-select data="item" item-form="itemForm"></itt-template-select><itt-image-field></itt-image-field><itt-flags data="item" flags="[\'required\', \'stop\', \'cosmetic\']"></itt-flags></div><div ng-switch-when="transcript"><itt-time-field></itt-time-field><itt-speaker-field></itt-speaker-field><itt-transcript-field data="item" itt-item-form="ittItemForm"></itt-transcript-field><itt-speaker-thumb-field></itt-speaker-thumb-field></div><div ng-switch-when="annotation"><itt-time-field></itt-time-field><itt-title-field data="item"></itt-title-field><itt-annotation-field data="item" itt-item-form="ittItemForm"></itt-annotation-field><itt-template-select data="item" item-form="itemForm"></itt-template-select><itt-speaker-field></itt-speaker-field><itt-flags data="item" item-form="itemForm" flags="[\'stop\', \'cosmetic\', \'chapter_marker\', \'invertColor\']"></itt-flags></div><div ng-switch-when="file"><itt-time-field></itt-time-field><itt-title-field do-validate="true" data="item" itt-item-form="ittItemForm"></itt-title-field><itt-file-field></itt-file-field><itt-description-field data="item"></itt-description-field><itt-flags data="item" flags="[\'required\', \'stop\', \'cosmetic\']"></itt-flags></div><div ng-switch-when="image"><itt-time-field></itt-time-field><itt-title-field do-validate="true" data="item" itt-item-form="ittItemForm"></itt-title-field><itt-image-field></itt-image-field><itt-description-field data="item"></itt-description-field><itt-template-select data="item" item-form="itemForm"></itt-template-select><itt-display-select data="item" item-form="itemForm"></itt-display-select><itt-flags data="item" flags="[\'required\', \'stop\', \'cosmetic\']"></itt-flags></div><div ng-switch-when="question"><span class="eventIcon icon-question"></span><itt-time-field></itt-time-field><itt-question-type-select data="item"></itt-question-type-select><itt-title-field do-validate="true" data="item" itt-item-form="ittItemForm"></itt-title-field><itt-question-text-field data="item" do-validate="false" itt-item-form="ittItemForm"></itt-question-text-field><itt-image-field></itt-image-field><itt-question-options></itt-question-options></div><div ng-switch-when="chapter"><itt-time-field></itt-time-field><itt-title-field do-validate="true" data="item" itt-item-form="ittItemForm"></itt-title-field><itt-description-field data="item"></itt-description-field></div><div ng-switch-when="video"><h4>{{item.producerItemType}}</h4></div><div ng-switch-default=""><h4>Default!</h4></div></div></div><div itt-tab="" class="ittTab" ng-if="selectService.showTab(item.producerItemType, \'Style\')" title="{{item.producerItemType === \'scene\' ? \'Layout\' : \'Style\'}}"><div ng-switch="" on="item.producerItemType"><div ng-switch-when="link"><itt-display-select></itt-display-select></div><div ng-switch-when="transcript"><itt-template-select data="item" item-form="itemForm"></itt-template-select></div><div ng-switch-when="annotation"><itt-display-select></itt-display-select></div><div ng-switch-when="scene"><itt-time-field></itt-time-field><itt-template-select data="item" item-form="itemForm"></itt-template-select><itt-video-position-select></itt-video-position-select><itt-display-select data="item"></itt-display-select></div><div ng-switch-when="question"><itt-template-select data="item" item-form="itemForm"></itt-template-select><itt-display-select data="item" item-form="itemForm"></itt-display-select><itt-flags data="item" flags="[\'required\', \'stop\', \'cosmetic\']"></itt-flags></div><div ng-switch-when="chapter"><h4>{{item.producerItemType}}</h4></div><div ng-switch-when="video"><h4>{{item.producerItemType}}</h4></div><div ng-switch-default=""><h4>Default!</h4></div></div></div><div itt-tab="" class="ittTab" ng-if="selectService.showTab(item.producerItemType, \'Customize\')" title="Customize"><div ng-switch="" on="item.producerItemType"><div ng-switch-when="link"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="transcript"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="annotation"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="scene"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="file"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="image"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="question"><itt-typography-select></itt-typography-select><itt-color-select></itt-color-select><itt-timestamp-select></itt-timestamp-select><itt-highlight-select></itt-highlight-select><itt-transition-select></itt-transition-select></div><div ng-switch-when="chapter"><h4>{{item.producerItemType}}</h4></div><div ng-switch-when="video"><h4>{{item.producerItemType}}</h4></div><div ng-switch-default=""><h4>Default!</h4></div></div></div></div></div><div class="ittTabFoot"><a ng-click="cancelEdit()">Cancel</a> &nbsp; &nbsp; <button ng-if="\n			item._id != \'internal:editing\' &&\n			!(item._type == \'Scene\' && item.start_time <= 0.01)\n		" ng-click="deleteEvent(item._id)">Delete</button> <button ng-click="saveEvent()" ng-disabled="blockDoubleClicks || ittItemForm.$invalid">Save</button></div></form></div>'),a.put("templates/producer/item/producer-annotation.html",""),a.put("templates/producer/item/producer-chapter.html",""),a.put("templates/producer/item/producer-file.html",""),a.put("templates/producer/item/producer-image.html",""),a.put("templates/producer/item/producer-link.html",""),a.put("templates/producer/item/producer-question.html",""),a.put("templates/producer/item/producer-scene.html",""),a.put("templates/producer/item/producer-transcript.html",""),a.put("templates/producer/item/producer-video.html",""),a.put("templates/producer/item/sxs-annotation.html",' <span class="eventIcon icon-comment"></span><div class="field"><div class="label">Comment</div><div class="input" sxs-input-i18n="item.annotation" autofocus x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-file.html",'<span class="eventIcon icon-file"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">File</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-image.html",'<span class="eventIcon icon-image"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-link.html",'<span class="eventIcon icon-link"></span><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><itt-url-field data="item"></itt-url-field><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-question.html",'<span class="eventIcon icon-question"></span><div class="field"><div class="label">Question type</div><div class="input"><select ng-model="item.data._plugin.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></div></div><div class="field"><div class="label">Question text</div><div class="input" autofocus sxs-input-i18n="item.data._plugin.questiontext" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="label">Question Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Image (optional)</div><div class="input" ng-include="\'templates/producer/upload-sxs.html\'"></div></div><div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"><div class="label">{{$index | alpha}} &nbsp;<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"></div><div class="input" sxs-input-i18n="distractor.text" x-inputtype="\'textarea\'"></div></div><div class="field"><div class="input"><button ng-click="addDistractor($event)">Add distractor</button></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when correct</div><div class="input" sxs-input-i18n="item.data._plugin.correctfeedback" x-inputtype="\'textarea\'"></div></div><div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"><div class="label">Feedback when incorrect</div><div class="input" sxs-input-i18n="item.data._plugin.incorrectfeedback" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/item/sxs-video.html",'<span class="eventIcon icon-video"></span><div class="field"><small><div style="width:20%; display:inline-block"></div><div style="width:80%; display:inline-block">Link to a video on YouTube...</div></small></div><div class="field"><div class="label">YouTube url</div><div class="input"><input ng-model="item.yturl"><small ng-if="item.url">{{item.url | stripParams}}</small> <small ng-if="item.yturl && !item.url">(No valid YouTube video found)</small></div></div><div class="field"><div class="label">Title</div><div class="input"><input ng-model="item.title.en" autofocus></div></div><div class="field"><div class="label">Description</div><div class="input" sxs-input-i18n="item.description" x-inputtype="\'textarea\'"></div></div>'),a.put("templates/producer/questionauthoring.html",'<div style="margin:1em"><p>This is a standalone editor for question items. Fill in the fields below, then copy the JSON data below into the existing authoring tool. To edit an existing question paste its JSON into the json field and the editor will separate it out into editable fields.</p><table class="authoringForm"><tr><td class="label">Question type</td><td><select ng-model="question.questiontype"><option value="mc-poll">Poll</option><option value="mc-formative">Formative</option></select></td></tr><tr><td class="label">Question text</td><td><textarea rows="4" ng-model="question.questiontext">\n				</textarea></td></tr><tr><td colspan="2">Answer choices. <span ng-if="question.questiontype == \'mc-formative\'">Check the correct answer (if more than one is selected, either will count as correct).</span>To remove an answer choice, just leave it blank.</td></tr><tr ng-repeat="distractor in question.distractors"><td class="label"><input type="checkbox" ng-model="distractor.correct" ng-if="question.questiontype == \'mc-formative\'"></td><td><input ng-model="distractor.text"></td></tr><tr><td class="label"><a ng-click="addDistractor()">add another</a></td><td></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for correct answer</td><td><input ng-model="question.correctfeedback"></td></tr><tr ng-if="question.questiontype == \'mc-formative\'"><td class="label">Feedback for incorrect answer</td><td><input ng-model="question.incorrectfeedback"></td></tr><tr><td colspan="2"><br><hr><br></td></tr><tr><td class="label">JSON data: <span ng-if="editwarning">Invalid JSON!</span></td><td><textarea rows="10" ng-model="pluginjson"></textarea></td></tr></table><br><hr><br><p class="label">Question preview:</p><div class="item"><div ng-if="preview" itt-item="questionpreview"></div></div></div>'),a.put("templates/producer/upload-masterasset.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><div ng-if="(masterAsset.original_filename) && !showUploadButtonsMaster">{{masterAsset.display_name}} <button class="button" ng-click="replaceAsset(\'Master\')">Replace this asset</button></div><div ng-if="showUploadButtonsMaster || !(masterAsset.original_filename)"><span ng-if="showUploadFieldMaster"><div itt-asset-uploader="episodeContainerId" callback="assetUploaded"></div></span> <span ng-if="!showUploadFieldMaster"><button class="button" ng-click="chooseAsset(\'Master\')">Browse uploaded assets</button> <button class="button" ng-click="toggleUpload(\'Master\')">Upload new asset</button></span></div></div>'),a.put("templates/producer/upload-poster.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><div ng-if="episode.poster && !showUploadButtonsPoster">{{episode.poster.display_name}} <button class="button" ng-click="replaceAsset(\'Poster\')">Replace this</button></div><div ng-if="showUploadButtonsPoster || !episode.poster"><span ng-if="showUploadFieldPoster"><div itt-asset-uploader="episodeContainerId" callback="posterUploaded"></div></span> <span ng-if="!showUploadFieldPoster"><button class="button" ng-click="chooseAsset(\'Poster\')">Browse uploaded</button> <button class="button" ng-click="toggleUpload(\'Poster\')">Upload new</button></span></div></div>'),a.put("templates/producer/upload-producer.html",'<div ng-if="showAssetPicker" class="floatAssetPicker"><div class="scrollContainer"><div sxs-container-assets="episodeContainerId" mime-key="{{item.producerItemType}}"></div></div><div class="controlsContainer"><button ng-click="endChooseAsset();">Cancel</button></div></div><div><ng-model ng-model="item.asset" name="itemAsset" itt-valid-asset="" item="item"></ng-model><div ng-if="item.asset && !showUploadButtons">{{item.asset.display_name}} <button class="button" ng-click="replaceAsset()">Replace</button> <button class="button" ng-click="detachAsset(); selectService.onSelectChange(item, itemForm)">Remove</button></div><div ng-if="showUploadButtons || !item.asset"><span ng-if="showUploadField"><div ng-if="canAccess" itt-asset-uploader="episodeContainerId" callback="assetUploaded" mime-types="{{mimes}}"></div></span> <span ng-if="!showUploadField"><button class="button" ng-click="chooseAsset()">Browse uploaded</button> <button class="button" ng-click="toggleUpload()">Upload new</button></span></div></div>'),
a.put("templates/producer/upload-sxs.html",'<div><div ng-if="(item.asset) && !showUploadButtons">{{item.asset.display_name}} <button class="button" ng-click="replaceAsset(item.asset._id)">Replace this asset</button></div><div ng-if="showUploadButtons || !(item.asset)"><div ng-if="item.producerItemType === \'image\'" itt-asset-uploader="" callback="assetUploaded"></div><div ng-if="item.producerItemType === \'file\'" itt-asset-uploader="" callback="assetUploaded" mime-types="application/*, text/*, audio/*, model/*" instructions="We currently accept all non-image or non-video files." error-text="Please make sure you are not trying to upload an image or video file."></div></div></div>'),a.put("templates/root.html",'<div class="rootLogin standaloneAncillaryPage" itt-login=""><div class="inner"><div ng-if="appState.user._id"><div itt-user=""></div></div><div ng-if="!appState.user._id"><form ng-submit="adminLogin()"><h1>Sign in to Telling STORY</h1><label><span>Username</span><input type="email" name="auth_key" ng-model="loginForm.auth_key"></label><label><span>Password</span><input type="password" name="password" ng-model="loginForm.password"></label><input class="submit button" type="submit" value="Sign in"><span class="error" ng-if="badlogin">Sorry, try again?</span></form></div><br style="clear:both"></div><small ng-if="!appState.user._id"><a href="{{apiDataBaseUrl}}/oauth2">OAuth</a></small></div>'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-magnet="" class="videoMagnet" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="col"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div class="col col2"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="col col1"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="clear"></div><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col col2"><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight"><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/centerVV-Mondrian.html",'<div class="scene centerVV-mondrian" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div class="static-bg__alt" ng-style="setBgImgUrl(scene.items, \'altCol\')"></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane altPane stretchToViewport"><div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div></div></div><div class="col"><div class="static-bg__main" ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div><div class="pane mainPane"><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1,\n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar,\n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div></div></div></div>'),a.put("templates/scene/centerVV-mondrial.backup.html",'<div class="scene centerVV-mondrian" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div class="pane altPane stretchToViewport"><div class="fill bgLayer bg-alt"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1,\n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar,\n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate mondrian" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col"><div class="fill bgLayer bg-main"><div ng-if="currentMainBgItems.length > 0" class="item animate" ng-repeat="item in currentMainBgItems = (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div ng-if="currentMainBgItems.length === 0"><div class="static-bg__main--mondrian"></div></div></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="content contentLayer stretchToViewport" ng-class="{isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2 )" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/centerVV.html",'<div class="scene centerVV" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div class="static-bg__main" ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div></div></div><div class="col"><div class="static-bg__alt" ng-style="setBgImgUrl(scene.items, \'altCol\')"></div><div class="pane altPane stretchToViewport"><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1,\n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar,\n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div></div></div></div>'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow,\n				isEmpty: contentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/centeredPro.html",'<div class="scene centered-pro" ng-class="scene.styleCss + \' \'+ scene.state"><div itt-item="item" class="item animate banner-pull-quote" ng-class="item.styleCss + \' \' + item.state" ng-repeat="item in (contentItems | isCurrent | filter:{templateUrl: \'templates/item/text-h1.html\'} )"></div><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent,\n				isNarrow: isNarrow,\n				isEmpty: contentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in (contentItems | isCurrent | filter:byPullquoteOrH2  )" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div></div></div></div>'),a.put("templates/scene/cornerH.html",'<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"><div class="row"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane matchVideoHeight"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="row"><div class="pane altPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/cornerV.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/debug.html","<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/endingscreen.html",'<div class="endingscreen stretchToViewport"><div class="pane introtext"><p>Thanks for watching:&nbsp; <span ng-bind-html="episode.display_title"></span></p><br></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div>'),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewportShort"><div><div class="pane introtext"><h1 ng-bind-html="episode.display_title"></h1><p id="episode--description" ng-bind-html="episode.display_description"></p><br></div><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="landingscreen-end"></div><div class="clear"></div></div></div>'),a.put("templates/scene/mirrored-twocol.html",'<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"><div class="col"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{singleitem: altContentItems.length==1, isNarrow: isNarrow, isEmpty: altContentItems.length == 0}" itt-width-watch=""><div class="item animate" ng-repeat="item in altItems = (altContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div><div class="col"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer stretchToViewport" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1,\n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar,\n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div></div></div>'),a.put("templates/scene/pip.html",'<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"><div class="pane altPane stretchToViewport"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: altContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div><div class="clear"></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div><div ng-class="{padForBottomToolbar: appState.videoControlsActive}"><div class="videoPositioner"><div itt-magnet="" class="videoMagnet"><img src="images/aspectratiopreserver-16x9.gif"></div></div><div class="pane mainPane"><div class="fill bgLayer"><div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="content contentLayer showCurrent" ng-class="{\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar,\n				isNarrow: isNarrow,\n				isEmpty: mainContentItems.length == 0\n			}" itt-width-watch=""><div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div><div class="clear"></div></div></div><div class="fill fgLayer overlay"><div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div></div></div>'),a.put("templates/searchpanel.html",'<div ng-class="episode.styleCss" class="searchPanel__wrapper"><div aria-label="sort toggle" class="searchfilters" aria-controls="sortableSearch"><div>Sorted by <button tabindex="0" class="fakeLink fake-link--search-results" ng-click="toggleSortBy(sortBy)" aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button></div></div><div class="scrollContainer"><div class="searchResults content" id="sortableSearch" itt-width-watch="" ng-class="{isNarrow: isNarrow}"><div ng-if="sortBy == \'startTime\'" class="sortByTime"><h1 ng-bind-html="episode.display_title"></h1><div ng-repeat="scene in episode.scenes"><span ng-switch="appState.product"><div ng-switch-when="producer" ng-repeat="item in sceneItems=(scene.items | orderBy:\'wtfchromesort\')" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div><div ng-switch-default="" ng-repeat="item in sceneItems=(scene.items | orderBy:\'wtfchromesort\' | filter:{cosmetic:false})" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div></span></div></div><div ng-if="sortBy == \'type\'" class="sortByType"><div ng-repeat="category in typeCategories"><h3 ng-if="matchedItems.length > 0" ng-bind-html="showTypes[category].name"></h3><div class="item animate" ng-repeat="item in matchedItems=\n						(showTypes[category].items\n						| orderBy:\'wtfchromesort\'\n						)" ng-show="\n							([item.searchableText] | filter:appState.searchText).length\n						" ng-class="item.state" itt-item="item" forcetemplate="searchresults-all"></div></div><div ng-if="(episode.items | filter:{\'searchableText\': appState.searchText||\'\', \'cosmetic\': false}).length == 0">(Nothing matched your search.)</div></div></div></div></div>'),a.put("templates/testbed-event.html",'<style>.testContentPane {\n	border: 1px solid #000;\n	position: absolute;\n	overflow: hidden;\n	top: 3em;\n	left: 2em;\n	right: 2em;\n	bottom: 10em;\n}\n.testEditorPane {\n	position: absolute;\n	bottom: 0;\n	z-index: 2;\n	left: 0;\n	right: 0;\n	height: 10em;\n	overflow-y: scroll;\n}\nlabel {\n	margin: 0 2em;\n}</style><div class="controls"><label>Content pane type:<select size="1" ng-model="testbed.contentType" ng-init="testbed.contentType=\'content\'"><option value="content">Content</option><option value="fill">Overlay</option></select></label><label ng-if="testbed.contentType == \'content\'"><input type="checkbox" ng-model="testbed.isNarrow">Narrow content pane</label><label>Item state:<select size="1" ng-model="item.state" ng-init="item.state=\'isCurrent\'"><option value="isCurrent">Current</option><option value="isPast">Past</option><option value="isFuture">Future</option></select></label><label><input type="checkbox" ng-model="testbed.showCurrent" ng-init="testbed.showCurrent = false;">Hide non-current items</label></div><div class="testContentPane allowHighlights allowSidebars hasLeftSidebar hasRightSidebar {{testbed.contentType}}" ng-class="{isNarrow: testbed.isNarrow, showCurrent: testbed.showCurrent}"><div ng-if="!(testbed.showCurrent && item.state!=\'isCurrent\')" class="item animate" itt-item="item" ng-class="item.styleCss + \' \' + item.state"></div></div><div class="testEditorPane" itt-item-editor="item"></div>'),a.put("templates/timeline-story.html",'<div class="timeline" ng-show="!isSuppressed" ng-cloak=""><button tabindex="0" ng-focus="showControls()" class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()"><span class="control-text">Play</span></button> <button tabindex="0" ng-focus="showControls()" class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()"><span class="control-text">Pause</span></button><div class="progressbarBox"><div class="pbarTop"><span ng-if="appState.product == \'producer\'"><a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()"><span class="control-text">Zoom out</span></a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click="zoomIn()"><span class="control-text">Zoom in</span></a></span></div><div class="pbarMain"><button ng-focus="showControls()" ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click="prevScene()"><span class="control-text">Previous</span></button> <button ng-focus="showControls()" tabindex="0" ng-class="{invisible: appState.time >= appState.duration-0.1}" class="button button-next" ng-click="nextScene()"><span class="control-text">Next</span></button><div class="progressbar"><div class="mask"><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="buffered" ng-style="{width: appState.bufferedPercent+\'%\'}"></div><div class="played" ng-style="{width: markerPercent(appState.time)+\'%\'}"></div></div></div><div class="progressbarContainer" style="width: {{zoomLevel}}00%"><div class="handle" ng-show="isSeeking" ng-style="{left: markerPercent(willSeekTo)+\'%\'}"><div class="tip" ng-show="seekHandleVisible">{{willSeekTo | asTime}}</div></div><div class="tooltip" ng-if="eventGroup.showTooltip" ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}"><span class="content">{{eventGroup.toolTipText}}</span></div><div class="handle sxsHandle playhead" ng-show="appState.editEvent" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\'}"><div class="tip" ng-click="">{{appState.editEvent.start_time | asTime}}</div></div></div><div class="playhead mask"><div class="progressbarContainer" ng-style="{width: zoomLevel+\'00%\'}"><div class="marker" ng-mouseover="showTooltip(eventGroup)" ng-mouseout="hideTooltip(eventGroup)" ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}" ng-if="eventGroup.stop || event.display_title || appState.product == \'producer\'" ng-class="{stop: eventGroup.stop, mini: eventGroup.layoutChange}"></div><div ng-if="appState.editEvent" class="editingItem" ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(appState.duration - appState.editEvent.end_time)+\'%\'}"></div></div></div></div></div><div class="pbarBottom"><span class="timedisplay">{{appState.time | asTime}} / {{appState.duration | asTime}} <span class="speedcontrol" ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)"><button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(-0.25)" aria-label="Slow down video"><div ng-class="{arrowLeft: appState.timeMultiplier > 0.5}"></div></button> <span class="speeddisplay" ng-click="resetSpeed()">{{appState.timeMultiplier}}x</span> <button ng-focus="showControls()" class="button-speedcontrol" ng-click="changeSpeed(0.25)" aria-label="Speed up video"><div ng-class="{arrowRight: appState.timeMultiplier < 2}"></div></button></span></span> <span style="display:inline-block;height:1em;position:relative" ng-if="episode.languages.length > 1"><select size="1" ng-model="appState.lang" class="languageSelector" ng-change="setNewLanguage()" ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"></select></span> <button ng-focus="showControls()" tabindex="0" ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"><span class="control-text">Captions</span></button> <a ng-if="appState.viewMode==\'watch\'" class="button button-fullscreen active" ng-click="viewMode(\'discover\')"><span class="control-text">Exit fullscreen</span></a> <a ng-if="appState.viewMode!=\'watch\'" class="button button-fullscreen" ng-click="viewMode(\'watch\')"><span class="control-text">Fullscreen video</span></a> <span ng-if="!appState.isTouchDevice"><button ng-focus="showControls()" tabindex="0" class="button button-mute {{audioIcon()}}" ng-click="toggleMute()"><span class="control-text">Mute</span></button><itt-volume-slider></itt-volume-slider></span></div></div></div>'),
a.put("templates/toolbar-story.html",'<div class="toolbar"><div class="buttongroup nav-item scene-nav-btns"><a ng-if="appState.productLoadedAs == \'narrative\' && !narrative.disable_navigation" class="button button-exitEpisode" href="/#/story/{{narrative.path_slug.en}}"><span>Exit</span></a> <button tabindex="0" class="button button-nav" ng-click="toggleNavPanel();"><span>Chapters</span></button> </div><div class="nav-item toolbar-logos"><img ng-src="images/customer/Narrasys_Logo.png" id="toolbar-logo-big" ng-if="episode.templateUrl === \'templates/episode/narrasys-pro.html\' && appState.windowWidth > 500">   <img ng-src="images/customer/Narrasys-Tree.png" id="toolbar-logo-small" ng-if="episode.templateUrl === \'templates/episode/narrasys-pro.html\' && appState.windowWidth <= 500"></div><div class="nav-item new-window-btn"><div ng-if="appState.isFramed && (appState.productLoadedAs == \'player\'\n	 			|| (appState.productLoadedAs == \'narrative\'\n	 			&& !narrative.disable_new_window ) )" class="escapegroup buttongroup"><a class="button button-mainframeescape" ng-click="pause()" ng-href="{{newWindowUrl}}&t={{appState.time || 0}}&access_token={{appState.user.access_token}}" target="_blank"><span>New window</span></a></div></div><div class="nav-item searchgroup buttongroup" ng-class="{cur: show.searchPanel}"><button tabindex="2" class="button button-search" ng-click="toggleSearchPanel()" aria-label="Search" aria-expanded="{{show.searchPanel}}"><span>Search</span></button><label for="searchtext" class="hidden">Search Text</label><input tabindex="2" name="searchtext" id="searchtext" ng-show="show.searchPanel" ng-model="appState.searchText" ng-model-options="{ debounce: 200 }"></div><div class="nav-item profilegroup buttongroup"><a class="button button-preview" ng-if="appState.productLoadedAs==\'producer\' && (userHasRole(\'admin\') || userHasRole(\'customer admin\'))" ng-click="toggleProducerPreview()"><span ng-if="appState.product == \'producer\'">Preview</span> <span ng-if="appState.product == \'player\'">Edit</span></a> <a class="button button-profile" ng-hide="appState.user.roles[0].role === \'guest\'" ng-click="appState.show.profilePanel = !appState.show.profilePanel"><span>Profile</span></a></div></div><div ng-cloak="" ng-show="show.navPanel" class="navPanel topDrawer" ng-class="episode.styleCss"><div class="parent" ng-repeat="parent in episode.parents" ng-bind-html="parent.display_name"></div><h2 ng-bind-html="episode.display_title" class="fakeLink" ng-click="seek(0)"></h2><div class="scene" x-ng-if="chapter.display_annotation || chapter.display_title" x-ng-repeat="chapter in episode.chapters" x-ng-class="{currentScene: chapter.isCurrent}" x-ng-click="seek(chapter.start_time)"><span class="displayTime">{{chapter.displayStartTime}}</span><p><button class="fakeLink" tabindex="0" ng-bind-html="chapter.display_annotation || chapter.display_title" x-ng-class="{sceneLink: !chapter.isCurrent}" ng-focus="showControls()"></button><br><span ng-bind-html="chapter.display_description"></span></p></div></div>'),a.put("templates/user.html",'<div class="userHome"><h2 ng-if="!inPlayer">Account</h2><h2 ng-if="inPlayer">Profile</h2><itt-nav on-logout="logout()"></itt-nav><p><i><span ng-bind="user.role_description"></span></i></p><div ng-if="!(user.name === \'guest\')" style="float:right; width: 79px"><div class="avatar" ng-click="toggleUploadAvatar()" style="cursor:pointer;cursor:hand"><img ng-src="{{user.avatar || \'/images/no-avatar.gif\'}}"></div><input ng-if="showUploadField && !uploads" style="width: 70px" type="file" accept="image/*" itt-files-handler="" on-selected="uploadAvatar(files)"><progress ng-if="uploads" style="width:79px" ng-attr-max="{{uploadStatus[0].bytesTotal}}" ng-attr-value="{{uploadStatus[0].bytesSent}}"></progress></div><div style="margin-right:80px"><label><span>Name</span><input class="userEditable" ng-model="user.name" ng-blur="updateUser()"></label><span ng-if="!isGuest()"><br><label><span>Email</span><input class="userEditable" ng-model="user.email" readonly></label></span></div></div>'),a.put("templates/video.html",'<div class="video"><itt-youtube tabindex="-1" ng-if="video.urls.youtube.length" embed-url="{{video.urls.youtube[0]}}" on-player-state-change="playerStateChange" on-ready="onReady" main-player="true" player-id="video._id"></itt-youtube><video ng-if="!video.urls.youtube || !video.urls.youtube.length" aria-label="media player"><source class="m3u8" ng-if="video.urls.m3u8[0]" ng-src="{{video.urls.m3u8[0]}}" type="application/x-mpegURL"><source class="mpeg4" ng-if="video.urls.mp4[video.curStream]" ng-src="{{video.urls.mp4[video.curStream]}}" type="video/mp4"><source class="webm" ng-if="video.urls.webm[video.curStream]" ng-src="{{video.urls.webm[video.curStream]}}" type="video/webm"><p>Oh no! Your browser does not support the HTML5 Video element.</p></video><div ng-if="poster && appState.time == 0" class="poster overlay fill" ng-style="{backgroundImage:\'url(\'+poster.url+\')\'}"></div><div ng-hide="( video.urls.youtube.length && !appState.hasBeenPlayed && appState.isTouchDevice)" ng-click="videoClick()" class="videoMask" ng-class="{\n		play: appState.timelineState == \'paused\',\n		firstplay: !appState.hasBeenPlayed && !poster,\n		rewind: (appState.time > 0 && appState.time >= video.duration - 0.3),\n		transcoding: !video.isTranscoded()\n	}"><div class="convertingMessage" ng-if="!video.isTranscoded()">This video is being converted to a web-playable format and will be ready in a&nbsp;few&nbsp;minutes</div></div></div>')}]),angular.module("com.inthetelling.story").factory("config",function(){var a=window.config?window.config:{};return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a.localStorageKey||(a.localStorageKey="storyToken"),a.youtube||(a.youtube={domain:"//gdata.youtube.com/",timeout:5e3}),a}),angular.module("com.inthetelling.story").factory("appState",["$interval","config",function(a,b){var c={};return c.init=function(){c.user=c.user||{},c.episodeId=!1,c.episodeSegmentId=!1,c.narrativeId=!1,c.timelineId=!1,c.isFramed=window.parent!=window,c.isTouchDevice=/iPad|iPod|iPhone/.test(navigator.platform)||/Android/.test(navigator.userAvent),c.isIPhone=navigator.platform.match(/iPod|iPhone/),c.windowWidth=0,c.windowHeight=0,c.viewMode=$(window).width()>480?"discover":"review",c.producerEditLayer=0,c.time=0,c.bufferedPercent=0,c.timeMultiplier=1,c.duration=0,c.timelineState="paused",c.hasBeenPlayed=!1,c.volume=100,c.muted=!1,c.hideCaptions=!1,c.show={searchPanel:!1,navPanel:!1},c.videoControlsActive=!1,c.videoControlsLocked=!1,c.itemDetail=!1,c.autoscroll=!1,c.autoscrollBlocked=!1,c.product=c.product,c.productLoadedAs=c.productLoadedAs,"sxs"===c.product||"producer"===c.product?c.crossEpisodePath=c.product:c.crossEpisodePath="episode",c.editEvent=!1,c.editEpisode=!1,c.lang=!1},c.init(),a(function(){c.windowHeight=angular.element(window).height(),c.windowWidth=angular.element(window).width()},50,0,!1),b.debugInBrowser,c}]),angular.module("com.inthetelling.story").factory("authSvc",["config","$routeParams","$http","$q","$location","ittUtils","appState","modelSvc","errorSvc",function(a,b,c,d,e,f,g,h,i){var j={},k={ADMINISTRATOR:"admin",INSTRUCTOR:"instructor",STUDENT:"student",GUEST:"guest",CUSTOMER_ADMINISTRATOR:"customer admin"},l={CUSTOMER:"Customer"};j.isGuest=function(){var a=!0;return angular.forEach(g.user.roles,function(b){b.role!==k.GUEST&&(a=!1)}),a},j.userHasRole=function(a){if(g.user&&g.user.roles)for(var b=0;b<g.user.roles.length;b++)if(g.user.roles[b].role===a){if(a!==k.ADMINISTRATOR||!f.existy(g.user.roles[b].resource_id))return!0}else if(a===k.CUSTOMER_ADMINISTRATOR&&g.user.roles[b].role===k.ADMINISTRATOR&&f.existy(g.user.roles[b].resource_id)&&g.user.roles[b].resource_type===l.CUSTOMER)return!0;return!1},j.getCustomerIdsFromRoles=function(){return g.user&&g.user.roles?g.user.roles.reduce(function(a,b){return b.role===k.ADMINISTRATOR&&f.existy(b.resource_id)&&b.resource_type===l.CUSTOMER&&a.push(b.resource_id),a},[]):void 0},j.getRoleForNarrative=function(a,b){b=void 0!==b?b:g.user.roles;var c="",d=!1;if(b)for(var e=0;e<b.length;e++){switch(b[e].role){case k.ADMINISTRATOR:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="admin",d=!0;break;case k.INSTRUCTOR:if(b[e].resource_id&&b[e].resource_id!==a)continue;c=b[e].role;break;case k.STUDENT:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="instructor"===c?c:b[e].role;break;case k.GUEST:if(b[e].resource_id&&b[e].resource_id!==a)continue;c="instructor"===c||"student"===c?c:b[e].role}if(d)break}return c},j.getDefaultProductForRole=function(a){var b="player";return"narrative"===g.productLoadedAs?(a===k.ADMINISTRATOR||a===k.INSTRUCTOR)&&(b="sxs"):i.error({data:"authSvc.getDefaultProductForRole should only be used within narratives for now"}),b},j.logout=function(){try{localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(b){}g.user={},c({method:"GET",url:a.apiDataBaseUrl+"/logout"}).success(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})}).error(function(){delete c.defaults.headers.common.Authorization,e.path("/").search({logout:1})})},j.adminLogin=function(b,e){var f=d.defer();return c({method:"POST",url:a.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:b,password:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',n(a),j.getCurrentUser().then(function(){f.resolve(a)})}).error(function(a){f.reject(a)}),f.promise};var m=d.defer();j.authenticate=function(d){if(c.defaults.headers.common.Authorization)g.user?m.resolve():j.getCurrentUser().then(function(){m.resolve()},function(){return j.authenticateViaNonce(d)});else{if(b.key){var f=b.key;return e.search("key",null),j.getAccessToken(f)}var h=j.getStoredToken();if(!h)return j.authenticateViaNonce(d);c.defaults.headers.common.Authorization='Token token="'+h+'"',j.getCurrentUser().then(function(){m.resolve()},function(){try{localStorage.removeItem(a.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(b){}return g.user={},j.authenticateViaNonce(d)})}return m.promise},j.authenticateViaNonce=function(a){var b=d.defer();return j.getNonce(a).then(function(a){j.getAccessToken(a).then(function(){b.resolve()})}),b.promise},j.getStoredToken=function(){var b={};try{if(!localStorage)return!1;localStorage.getItem(a.localStorageKey),b=angular.fromJson(localStorage.getItem(a.localStorageKey));var c=a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];return b.customer!==c&&(localStorage.removeItem(a.localStorageKey),b={}),b.token||!1}catch(d){return!1}},j.getCurrentUser=function(){var b=d.defer();return c({method:"GET",url:a.apiDataBaseUrl+"/show_user"}).success(function(a){n(a),b.resolve()}).error(function(){b.reject()}),b.promise},j.updateUser=function(b){var e=d.defer();return c({method:"PUT",url:a.apiDataBaseUrl+"/users/"+b._id,data:b}).success(function(a){n(a),e.resolve()}).error(function(){e.reject()}),e.promise};var n=function(b){if(null!==b.roles&&void 0!==b.roles&&b.roles.length>0&&b.roles[0].constructor===String){for(var d=[],e=0;e<b.roles.length;e++){var f={role:b.roles[e]};d.push(f)}b.roles=d}var i={access_token:b.access_token||b.authentication_token,customer:a.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:b.roles};angular.forEach(["_id","name","email","track_event_actions","track_episode_metrics","avatar_id"],function(a){b[a]&&(i[a]=b[a])});var k=j.getStoredToken();i.avatar_id&&k&&(c.defaults.headers.common.Authorization='Token token="'+k+'"',c.get(a.apiDataBaseUrl+"/v1/assets/"+i.avatar_id).then(function(a){h.cache("asset",a.data),g.user.avatar=a.data.url})),b["track_episode_metrics:"]&&(i.track_episode_metrics=!0),i.roles&&(i.role_description=o(i.roles[0])),b.emails&&(i.email=b.emails[0]),g.user=i;try{localStorage.setItem(a.localStorageKey,JSON.stringify({token:i.access_token,customer:i.customer}))}catch(l){}},o=function(a){return void 0===a?"User":"admin"===a.role?"Administrator":void 0===a.role?"User":"guest"===a.role?"Guest user":a.role.match(/student/i)?"Student":a.role.match(/instructor/i)?"Instructor":a};return j.getNonce=function(b){var e=d.defer(),f=a.apiDataBaseUrl+"/v1/get_nonce";return b&&(f=f+"?"+b),c.get(f).success(function(a){a.nonce?e.resolve(a.nonce):a.login_url&&null!==a.login_url?(a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url,e.reject()):("#/"!==window.location.hash&&(window.location.href="/#/"),e.reject())}).error(function(){e.reject()}),e.promise},j.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){n(a),c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',j.getCurrentUser().then(function(){e.resolve(a)})}).error(function(){e.reject()}),e.promise},j}]),angular.module("com.inthetelling.story").factory("awsSvc",["config","$routeParams","$http","$q",function(a,b,c,d){var e,f,g,h,i=1e3,j=4,k=3,l=3e4,m="public-read",n="pending",o="uploading",p="failed",q="complete",r={},s={s3:{}},t=5242880,u=0,v=0,w=0,x=[],y=0,z=[],A=0,B=0,C=[],D=!1;r.awsCache=function(){return s},r.getBucketListing=function(){var a=d.defer();return F().then(function(){s.s3.listObjects(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},r.uploadContainerFiles=function(a,b){return E("/v1/containers/"+a+"/assets",b)},r.uploadUserFiles=function(a,b){return E("/v1/users/"+a+"/assets",b)};var E=function(a,b){for(var c=[],e=0;e<b.length;e++){z.push(b[e]);var f=d.defer();C.push(f),c.push(f.promise)}return G(a),c};r.pauseUpload=function(){if(e&&!D){if(D=!0,U(),J())B=0;else{var a=0;for(B=0;v>a;){var b=x[a];b.status===q&&(B+=b.uploaded),a++}}g.notify({bytesSent:B,bytesTotal:e.size})}},r.resumeUpload=function(){if(e&&D)if(D=!1,J())L();else for(var a=0;k>a;a++)P()},r.cancelUpload=function(){e&&(D=!1,B=0,U(),J()||(r.cancelMultipartUpload(f),f=null),e=null,C[A].reject("Canceled by user"));for(var a=A+1;a<z.length;a++)C[a].reject("Canceled by user");A=z.length},r.networkError=function(){e&&U()},r.deleteObject=function(a){var b=d.defer();return F().then(function(){var c={Bucket:a.bucket,Key:a.Key};s.s3.deleteObject(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise},r.getMultipartUploads=function(){var a=d.defer();return F().then(function(){s.s3.listMultipartUploads(function(b,c){b?a.reject():a.resolve(c)})}),a.promise},r.getMultipartUploadParts=function(a,b){var c=d.defer();return F().then(function(){var d={Bucket:b.bucket,Key:b.Key,UploadId:b.UploadId};s.s3.listParts(d,function(b,d){b?c.reject():c.resolve({i:a,parts:d})})}),c.promise},r.cancelMultipartUpload=function(a){var b=d.defer();return F().then(function(){var c={Bucket:a.bucket,Key:a.Key,UploadId:a.UploadId};s.s3.abortMultipartUpload(c,function(a,c){a?b.reject():b.resolve(c)})}),b.promise};var F=function(){return s.hasOwnProperty("sessionDeferred")?s.sessionDeferred.promise:(s.sessionDeferred=d.defer(),c.get(a.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(b){if(b.access_key_id){AWS.config.update({accessKeyId:b.access_key_id,secretAccessKey:b.secret_access_key,sessionToken:b.session_token,region:a.awsRegion});var c={maxRetries:0,httpOptions:{timeout:l},params:{Bucket:b.bucket,Prefix:b.key_base}};s.s3=new AWS.S3(c),s.sessionDeferred.resolve(b)}else s.sessionDeferred.reject()}).error(function(){s.sessionDeferred.reject()}),s.sessionDeferred.promise)},G=function(a){if(z.length>A&&!e){if(e=z[A],""===e.type)return C[A].reject("Could not determine file type for file '"+e.name+"'"),e=null,A++,void G(a);H().then(function(){var b;b=J()?K():M(),b.then(function(){V(a)},function(a){C[A].reject(a)},function(a){C[A].notify(a)})})}},H=function(a){return a=a||d.defer(),e.uniqueName=I(),F().then(function(){var b={Key:s.s3.config.params.Prefix+e.uniqueName};s.s3.headObject(b,function(b){b?404!==b.statusCode?a.reject(b):J()?a.resolve():r.getMultipartUploads().then(function(b){var c=function(a){for(var d=0;d<b.Uploads.length;d++)if(b.Uploads[d].Key===s.s3.config.params.Prefix+a)return c(I());return a};e.uniqueName=c(e.uniqueName),a.resolve()}):(e.uniqueName=I(),H(a))})}),a.promise},I=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b},J=function(){return e.size<=t?!0:!1},K=function(){return g=d.defer(),L().then(function(){},function(){},function(){}),g.promise},L=function(){var a=d.defer();return F().then(function(){Q(e,"base64").then(function(a){var b={Key:s.s3.config.params.Prefix+e.uniqueName,ContentType:e.type,Body:e,ContentMD5:a,ACL:m};h=s.s3.putObject(b,function(a,b){a?g.reject():g.resolve(b)}),h.on("httpUploadProgress",function(a){g.notify({bytesSent:a.loaded,bytesTotal:a.total})}).on("error",function(){g.reject("An error occured while uploading the file, please try again.")})})},function(){},function(){}),a.promise},M=function(){return g=d.defer(),N().then(O).then(function(){for(var a=0;k>a;a++)P()}),g.promise},N=function(){var a=d.defer();return F().then(function(){var b={Key:s.s3.config.params.Prefix+e.uniqueName};s.s3.createMultipartUpload(b,function(b,c){b?a.reject():a.resolve(c)})}),a.promise},O=function(a){var b=d.defer();f=a,x=[],v=0,w=0,y=0,u=t,B=0,e.size>u*i&&(u=Math.ceil(e.size/i)),v=Math.ceil(e.size/u);for(var c=0;v>c;c++){var g={};g.start=c*u,g.end=g.start+u,g.uploaded=0,g.end>e.size&&(g.end=e.size),g.status=n,g.retries=0,x.push(g)}return b.resolve(),b.promise},P=function(){var a=d.defer(),b=y,c=!1;if(D)a.reject("Upload paused");else{for(;!c&&v>b;){var f=x[b];if(f.status===n){c=!0,f.status=o;var g=e.slice(f.start,f.end);f.cancel=function(){f.request.abort(),f.status=n,f.uploaded=0},d.all({partNumber:d.when(b+1),eTag:R(b+1,g)}).then(S,T).then(function(b){a.resolve(b)},function(b){a.reject(b)},function(b){a.update(b)})}else f.status===q&&b===y&&y++;b++}c||a.reject("All chunks uploaded")}return a.promise},Q=function(a,b){var c=d.defer(),e=new FileReader;return e.onload=function(){var a=e.result;c.resolve(AWS.util.crypto.md5(new Uint8Array(a),b))},e.readAsArrayBuffer(a),c.promise},R=function(a,b,c){return c||(c=d.defer()),F().then(function(){Q(b,"base64").then(function(d){var h={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,PartNumber:a,ContentMD5:d,Body:b};x[a-1].request=s.s3.uploadPart(h,function(d,e){d?x[a-1].retries<j?(x[a-1].request.abort(),x[a-1].retries++,R(a,b,c)):(x[a-1].status=p,c.reject(d)):c.resolve(e.ETag)}),x[a-1].request.on("httpUploadProgress",function(b){B+=b.loaded-x[a-1].uploaded,x[a-1].uploaded=b.loaded,g.notify({bytesSent:B,bytesTotal:e.size})}).on("error",function(){})})}),c.promise},S=function(a){var b=d.defer();if(x[a.partNumber-1].status=q,x[a.partNumber-1].part={ETag:a.eTag,PartNumber:a.partNumber},w++,w===v){for(var c=[],e=0;v>e;e++)c.push(x[e].part);var h={Bucket:f.Bucket,Key:f.Key,UploadId:f.UploadId,MultipartUpload:{Parts:c}};s.s3.completeMultipartUpload(h,function(a,c){a?(g.reject(a),b.reject(a)):(h={Bucket:f.Bucket,Key:f.Key,ACL:m},s.s3.putObjectAcl(h,function(a){a&&(g.reject(a),b.reject(a))}),g.resolve(c),b.resolve(c))})}else P();return b.promise},T=function(a){r.cancelMultipartUpload(f),g.reject(a)},U=function(){if(J())h.abort();else for(var a=y,b=!1;!b&&v>a;){var c=x[a];c.status===o?c.cancel():c.status===n&&(b=!0),a++}},V=function(b){var f=d.defer(),g={url:"https://s3.amazonaws.com/"+s.s3.config.params.Bucket+"/"+s.s3.config.params.Prefix+e.uniqueName,type:e.type,size:e.size,original_filename:e.name};return c.post(a.apiDataBaseUrl+b,g).success(function(a){C[A].resolve(a),e=null,A++,G(b)}).error(function(){C[A].reject(),e=null,A++,G(b)}),f.promise};return r}]),angular.module("com.inthetelling.story").factory("dataSvc",["$q","$http","$routeParams","$timeout","$rootScope","$location","ittUtils","config","authSvc","appState","modelSvc","errorSvc","mockSvc","questionAnswersSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){return C("/v3/containers/"+a+"/narratives",b).then(function(a){return a.data})["catch"](function(){})}var p={};p.checkXFrameOpts=function(a){function b(b){var e=!0;switch(!0){case/SAMEORIGIN/i.test(b):c=f.host(),d=document.createElement("a"),d.href=a,c===d.hostname&&(e=!1);break;case/ALLOW-FROM/i.test(b):var g=b.split(",");c=f.host(),angular.forEach(g,function(a){var b=a.trim().split(" ")[1],d=document.createElement("a");d.href=b,c===d.hostname&&(e=!1)});break;case/DENY/i.test(b):break;case/null/.test(b):e=!1}return e}var c,d,e=encodeURIComponent(a);return B("/x_frame_options_proxy?url="+e).then(function(a){return b(a.x_frame_options)})},p.generateNewNarrative=o,p.getNarrative=function(c){var d=a.defer(),e=k.narratives[c],j=g.getSubdomain(f.host()),l="";return g.existy(e)&&g.existy(e.subDomain)&&j!==e.subDomain&&(l="?customer="+e.subDomain),i.authenticate("narrative="+c).then(function(){b.get(h.apiDataBaseUrl+"/v3/narratives/"+c+"/resolve"+l).then(function(a){a.data.timelines.sort(function(a,b){return a.sort_order-b.sort_order}),k.cache("narrative",p.resolveIDs(a.data)),d.resolve(k.narratives[a.data._id])})}),d.promise},p.getNarrativeOverview=function(a){return A("/v3/narratives/"+a)},p.getNarrativeExportAsSpreadsheet=function(a){var b="/v3/narratives/"+a+".xlsx";window.open(b)};var q=!1;p.getUserNarratives=function(b){if(q){var c=a.defer();return c.resolve(q),c.promise}return A("/v3/users/"+b+"/narrative_purchases",function(a){return q=a,a})},p.getCustomerList=function(){return A("/v3/customers/",function(a){return angular.forEach(a,function(a){k.cache("customer",a)}),a})},p.getCustomer=function(a){return i.userHasRole("admin")||i.userHasRole("customer admin")?void(k.customers[a]||(k.cache("customer",{_id:a}),A("/v3/customers/"+a,function(a){k.cache("customer",a)}))):!1},p.getEpisode=function(a,b){if(!a)throw"no episode ID supplied to dataSvc.getEpisode";k.cache("episode",{_id:a}),c.local?(m.mockEpisode(a),e.$emit("dataSvc.getEpisode.done")):i.authenticate().then(function(){return u()}).then(function(){return x(a,b)})},p.getEpisodeOverview=function(a){return A("/v3/episodes/"+a)},p.getNarrativeList=function(){return A("/v3/narratives/")},p.createUserGroup=function(a){return E("/v3/groups",{group:{name:a}})},p.createNarrative=function(a){return delete a.templateUrl,E("/v3/narratives",a)},p.updateNarrative=function(a){return delete a.templateUrl,D("/v3/narratives/"+a._id,a)},p.createChildEpisode=function(a){return E("/v3/episodes",{episode:a})},p.createEpisodeSegment=function(a,b){return E("/v3/timelines/"+a+"/episode_segments",b)},p.storeTimeline=function(a,b){var c=["sort_order","path_slug","name","description","hidden","timeline_image_id","narrative_id","_id"],d=g.pick(b,c);return d._id?D("/v3/timelines/"+d._id,d,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a}):E("/v3/narratives/"+a+"/timelines",d,function(a){return"string"==typeof a.name&&(a.name={en:a.name}),"string"==typeof a.description&&(a.description={en:a.description}),a})},p.deleteTimeline=function(a){return G("/v3/timelines/"+a).then(function(a){return a})},p.getSingleAsset=function(b){return b?A("/v1/assets/"+b):a(function(a){a(void 0)})};var r={template:{},layout:{},style:{}},s=!1,t=a.defer(),u=function(){return s?t.promise:(s=!0,a.all([b.get(h.apiDataBaseUrl+"/v1/templates"),b.get(h.apiDataBaseUrl+"/v1/layouts"),b.get(h.apiDataBaseUrl+"/v1/styles")]).then(function(a){p.cache("templates",a[0].data),p.cache("layouts",a[1].data),p.cache("styles",a[2].data),s=!0,t.resolve()},function(){s=!1,t.reject()}),t.promise)};p.getCommon=u,p.cache=function(a,b){angular.forEach(b,function(b){"templates"===a?r.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name,customerIds:b.customer_ids}:"layouts"===a?r.layout[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name}:"styles"===a&&(r.style[b._id]={id:b._id,css_name:b.css_name,displayName:b.display_name})})},p.createTemplate=function(a){return E("/v1/templates",a)},p.resolveIDs=function(a){if(a.everyone_group&&!a.template_id&&(a.templateUrl="templates/narrative/default.html"),a.template_id&&(r.template[a.template_id]?(a.templateUrl=r.template[a.template_id].url,delete a.template_id):l.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];"Scene"===a.type&&(b=["",""]),angular.forEach(a.layout_id,function(c){r.layout[c]?"Scene"===a.type?"showCurrent"===r.layout[c].css_name?b[1]=r.layout[c].css_name:"splitRequired"===r.layout[c].css_name?b[2]=r.layout[c].css_name:b[0]=r.layout[c].css_name:b.push(r.layout[c].css_name):l.error({data:"Couldn't get layout for id "+c})}),b.length>0&&(a.layouts=b)}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){r.style[a]?c.push(r.style[a].css_name):l.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c)}return a};var v=function(a){return a.hasOwnProperty("asset_id")&&a.asset_id?a.asset_id:a.hasOwnProperty("annotation_image_id")&&a.annotation_image_id?a.annotation_image_id:a.hasOwnProperty("link_image_id")&&a.link_image_id?a.link_image_id:a.hasOwnProperty("avatar_id")&&a.avatar_id?a.avatar_id:void 0},w=function(a){for(var b={},c=0,d=a.length;d>c;c++){var e=v(a[c]);e&&(e in b||(b[e]=0))}var f=Object.keys(b);return f};p.getAssetsByAssetIds=function(a,c){var d="/v1/assets",e={};return e.asset_ids=a,b.post(h.apiDataBaseUrl+d,e).success(function(a){c(a)}).error(function(){c()})};var x=function(a,c){var d=c?"/v3/episode_segments/"+c+"/resolve":"/v3/episodes/"+a;b.get(h.apiDataBaseUrl+d).success(function(b){var d={};b&&(d=b.episode?b.episode:b),"Published"===d.status||i.userHasRole("admin")||i.userHasRole("customer admin")?(k.cache("episode",p.resolveIDs(d)),y(a,c).success(function(b){b=b||[],z(b,"Plugin",a),angular.forEach(b,function(b){b.cur_episode_id=a,k.cache("event",p.resolveIDs(b))}),k.resolveEpisodeEvents(a);var c=w(b);c=void 0!==c&&c.length>0?c:[],c.push(d.master_asset_id),d.poster_frame_id&&c.push(d.poster_frame_id),p.getAssetsByAssetIds(c,function(b){angular.forEach(b.files,function(a){k.cache("asset",a)}),k.resolveEpisodeAssets(a),e.$emit("dataSvc.getEpisode.done")})}).error(function(){l.error({data:"API call to get events failed."})})):l.error({data:"This episode has not yet been published."})}).error(function(){l.error({data:"API call to /v3/episodes/"+a+" failed (bad episode ID?)"})})};p.getContainerAncestry=function(b,c,d){return d=d||a.defer(),p.getContainer(b,c).then(function(a){var b=k.containers[a];b.parent_id?p.getContainerAncestry(b.parent_id,c,d):d.resolve(a)}),d.promise};var y=function(a,c){var d=c?"/v3/episode_segments/"+c+"/events":"/v3/episodes/"+a+"/events";return b.get(h.apiDataBaseUrl+d)},z=function(a,b,c){angular.forEach(a,function(a){"Plugin"===a.type&&!function(a){n.getUserAnswer(a._id,j.user._id).then(function(b){if(b.data){a.data._plugin.hasBeenAnswered=!0;var c=0,d=!0;angular.forEach(a.data._plugin.distractors,function(e){d&&(e.index===b.data.index&&(e.selected=!0,a.data._plugin.selectedDistractor=e.index,d=!1),c++)}),k.cache("event",p.resolveIDs(a))}})}(a)}),k.resolveEpisodeEvents(c)},A=function(c,d){var e=a.defer();return i.authenticate().then(function(){b.get(h.apiDataBaseUrl+c).then(function(a){var b=a.data;return d&&(b=d(b)),e.resolve(b)})}),e.promise},B=function(a){return i.authenticate().then(function(){return b.get(h.apiDataBaseUrl+a).then(function(a){return a.data})})},C=function(a,c){return b.post(a,c)},D=function(c,d,e){var f=a.defer();return b({method:"PUT",url:h.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),f.resolve(b)}),f.promise},E=function(c,d,e){var f=a.defer();return b({method:"POST",url:h.apiDataBaseUrl+c,data:d}).success(function(a){var b=a;e&&(b=e(b)),f.resolve(b)}),f.promise},F=function(c){var d=a.defer();return b({method:"DELETE",url:h.apiDataBaseUrl+c}).success(function(a){return d.resolve(a)}),d.promise},G=function(a){return b({method:"DELETE",url:h.apiDataBaseUrl+a}).then(function(a){return a})};p.getContainerRoot=function(){return A("/v3/containers",function(a){var b=[];return angular.forEach(a,function(a){k.cache("container",a),b.push(a._id)}),b})},p.getContainer=function(a,b){return A("/v3/containers/"+a,function(c){k.cache("container",c[0]);var d=k.containers[c[0]._id];if(p.getContainerAssets(a,b),d.children){for(var e=0;e<d.children.length;e++)d.children[e]=k.containers[d.children[e]._id];var f=!1;b||(f=!0),f&&angular.forEach(d.children,function(a){a.episodes[0]&&p.getEpisodeOverview(a.episodes[0]).then(function(b){b&&(a.status=b.status,a.title=b.title,k.cache("container",a))})})}return c[0]._id})},p.getContainerAssets=function(a,c){return b.get(h.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(b){k.containers[a].assetsHaveLoaded=!0,angular.forEach(b.files,function(a){k.cache("asset",a)}),k.resolveEpisodeAssets(c)})},p.createContainer=function(b){var c=a.defer(),d={container:{customer_id:b.customer_id,name:b.name,parent_id:b.parent_id}};return E("/v3/containers",d).then(function(a){k.cache("container",a);var b=a.parent_id;k.containers[b].children.push(k.containers[a._id]),c.resolve(a)}),c.promise},p.updateContainer=function(b){var c=a.defer();return b._id||c.reject(),D("/v3/containers/"+b._id,b,function(a){k.cache("container",a),c.resolve(a)}),c.promise},p.deleteContainer=function(a){return delete k.containers[a],F("/v3/containers/"+a)},p.createEpisode=function(b){b.status="Unpublished";var c=a.defer();return E("/v3/episodes",b).then(function(a){k.containers[a.container_id].episodes=[a._id],k.containers[a.container_id].status=a.status,c.resolve(a)}),c.promise},p.storeEpisode=function(a){var b=I(a);return b?D("/v3/episodes/"+b._id,b):!1},p.deleteEpisode=function(b){var c=a.defer();return A("/v2/episodes/"+b+"/episode_user_metrics").then(function(d){if(d.length){for(var e=[],f=0;f<d.length;f++)e.push(F("/v2/episode_user_metrics/"+d[f]._id));a.all(e).then(function(){F("/v3/episodes/"+b),c.resolve()})}else F("/v3/episodes/"+b),c.resolve()}),c.promise},p.deleteItem=function(a){return F("/v3/events/"+a)},p.createAsset=function(b,c){var d=a.defer();return c.container_id=b,c._id&&c._id.match(/internal/)&&delete c._id,c=k.deriveAsset(c),E("/v1/containers/"+b+"/assets",c).then(function(a){k.containers[a.file.container_id].episodes=[a.file._id],k.cache("asset",a.file),d.resolve(a.file)}),d.promise},p.deleteAsset=function(a){return F("/v1/assets/"+a)},p.storeItem=function(b){return b=H(b),b?b&&b._id&&!b._id.match(/internal/)?D("/v3/events/"+b._id,{event:b}):E("/v3/episodes/"+b.episode_id+"/events",{event:b}):a.reject(!1)};var H=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;var c=["_id","start_time","end_time","episode_id","chapter_marker","template_id","templateUrl","stop","required","cosmetic","sxs","title","url","noEmbed","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id","avatar_id"];b.type=a._type;for(var d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=angular.copy(a[c[d]]));if(b.start_time&&b.end_time){var e=parseFloat(b.start_time),f=parseFloat(b.end_time);if(isNaN(e)||isNaN(f))return l.error({data:"Tried to store an invalid start_time or end_time."}),!1;if(e>f)return l.error({data:"Tried to store a start_time that is after the end_time."}),!1}if(b.data&&(delete b.data._plugin.selectedDistractor,delete b.data._plugin.hasBeenAnswered,delete b.data._plugin._type,b.data._plugin.distractors.length))for(d=0;d<b.data._plugin.distractors.length;d++)delete b.data._plugin.distractors[d].selected;if(b.style_id=[],b.layout_id=[],b.style_id=K("style",a.styles),b.layout_id=K("layout",a.layouts),"Chapter"===a._type)return b;
var g=p.readCache("template","url",a.templateUrl);return g?b.template_id=g.id:b.template_id=J(a.templateUrl),b.template_id?b:(l.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)};p.prepItemForStorage=H,p.detachEventAsset=function(a,b){return(a=H(a))?(a.asset_id===b&&(a.asset_id=null),a.link_image_id===b&&(a.link_image_id=null),a.annotation_image_id===b&&(a.annotation_image_id=null),a&&a._id&&!a._id.match(/internal/)?D("/v3/events/"+a._id,{event:a}):E("/v3/episodes/"+a.episode_id+"/events",{event:a})):!1};var I=function(a){var b={};a._id&&a._id.match(/internal/)&&delete a._id;for(var c=["_id","title","description","container_id","customer_id","master_asset_id","poster_frame_id","status","languages"],d=0;d<c.length;d++)(a[c[d]]||0===a[c[d]])&&(b[c[d]]=angular.copy(a[c[d]]));b.style_id=K("style",a.styles);var e=p.readCache("template","url",a.templateUrl);return e?b.template_id=e.id:b.template_id=J(a.templateUrl),b.template_id?b:(l.error({data:"Tried to store a template with no ID: "+a.templateUrl}),!1)},J=function(a){var b={"templates/episode/episode.html":"templates/episode-default.html","templates/episode/eliterate.html":"templates/episode-eliterate.html","templates/episode/ewb.html":"templates/episode-ewb.html","templates/episode/gw.html":"templates/episode-gw.html","templates/episode/purdue.html":"templates/episode-purdue.html","templates/episode/story.html":"templates/episode-tellingstory.html","templates/item/transcript.html":"templates/transcript-default.html","templates/item/transcript-withthumbnail.html":"templates/transcript-withthumbnail.html","templates/item/transcript-withthumbnail-alt.html":"templates/transcript-withthumbnail-alt.html","templates/item/text-h1.html":"templates/text-h1.html","templates/item/text-h2.html":"templates/text-h2.html","templates/item/pullquote-noattrib.html":"templates/text-pullquote-noattrib.html","templates/item/pullquote.html":"templates/text-pullquote.html","templates/item/image.html":"templates/transmedia-image-default.html","templates/item/image-caption.html":"templates/transmedia-caption.html","templates/item/image-caption-sliding.html":"templates/transmedia-slidingcaption.html","templates/item/image-fill.html":"templates/transmedia-image-fill.html","templates/item/image-plain.html":"templates/transmedia-image-plain.html","templates/item/image-linkonly.html":"templates/transmedia-linkonly.html","templates/item/image-thumbnail.html":"templates/transmedia-thumbnail.html","templates/item/link.html":"templates/transmedia-link-default.html","templates/item/link-embed.html":"templates/transmedia-link-embed.html","templates/scene/1col.html":"templates/scene-1col.html","templates/scene/2colL.html":"templates/scene-2colL.html","templates/scene/2colR.html":"templates/scene-2colR.html","templates/scene/centered.html":"templates/scene-centered.html","templates/scene/cornerH.html":"templates/scene-cornerH.html","templates/scene/cornerV.html":"templates/scene-cornerV.html","templates/item/question-mc-formative.html":"templates/question-mc-formative.html","templates/item/question-mc-poll.html":"templates/question-mc-poll.html","templates/item/question-mc.html":"templates/question-mc.html","templates/item/question-mc-image-left.html":"templates/question-mc-image-left.html","templates/item/question-mc-image-right.html":"templates/question-mc-image-right.html","templates/item/sxs-question.html":"templates/sxs-question.html","templates/item/sxs-link.html":"templates/sxs-link.html"};if(b[a]){var c=p.readCache("template","url",b[a]);return c.id}return!1};p.readCache=function(a,b,c){var d=!1;return angular.forEach(r[a],function(a){a[b]===c&&(d=a)}),d?d:!1},h.debugInBrowser,p.getTemplates=function(){return Object.keys(r.template).map(function(a){return r.template[a]})};var K=function(a,b){var c=["colorEliterate","colorGw","colorGwsb","colorPurdue","colorUsc","colorColumbia","colorColumbiabusiness","typographyEliterate","typographyGw","typographyGwsb","typographyPurdue","typographyUsc","typographyColumbia","typographyColumbiabusiness"],d=[];return angular.forEach(b,function(b){if(b){var e=p.readCache(a,"css_name",b);if(e)d.push(e.id);else if(-1===c.indexOf(b))return l.error({data:"Tried to store a "+a+" with no ID: "+b}),!1}}),d};return p}]),angular.module("com.inthetelling.story").factory("errorSvc",["$location",function(a){var b={};return b.init=function(){b.errors=[],b.notifications=[]},b.init(),b.error=function(c){!c||401!==c.status&&403!==c.status||"/"===a.path()&&(c=void 0),c&&c.data&&("string"==typeof c.data?(c.data=c.data.replace(/\n/g,"").replace(/==/g,"").replace(/-----.*/g,""),b.errors.push({exception:c})):b.errors.push({exception:c}))},b.notify=function(a){b.notifications.push({text:a})},b}]);var DEFAULT_EPISODE_TEMPLATE_URL="templates/episode/story.html";angular.module("com.inthetelling.story").factory("modelSvc",["$interval","$filter","$location","ittUtils","config","appState","youtubeSvc",function(a,b,c,d,e,f,g){function h(){return Object.keys(j.customers).map(function(a){return j.customers[a]})}function i(){return Object.keys(j.narratives).map(function(a){return j.narratives[a]})}var j={};j.episodes={},j.assets={},j.events={},j.containers={},j.narratives={},j.customers={},j.getNarrativeByPathOrId=function(a){var b=/^[0-9a-fA-F]{24}$/.test(a);if(b)return j.narratives[a];var c;for(c in j.narratives)if(j.narratives.hasOwnProperty(c)&&a===j.narratives[c].path_slug.en)return j.narratives[c]},j.getCustomersAsArray=h,j.getNarrativesAsArray=i,j.cache=function(a,b){"narrative"===a&&(j.narratives[b._id]?angular.extend(j.narratives[b._id],b):j.narratives[b._id]=angular.copy(b)),"customer"===a&&(j.customers[b._id]?angular.extend(j.customers[b._id],b):j.customers[b._id]=angular.copy(b)),"episode"===a?j.episodes[b._id]?angular.extend(j.episodes[b._id],j.deriveEpisode(angular.copy(b))):j.episodes[b._id]=j.deriveEpisode(angular.copy(b)):"event"===a?(b.title||(b.title={}),j.events[b._id]?angular.extend(j.events[b._id],j.deriveEvent(angular.copy(b))):j.events[b._id]=j.deriveEvent(angular.copy(b))):"asset"===a?j.assets[b._id]?angular.extend(j.assets[b._id],j.deriveAsset(angular.copy(b))):j.assets[b._id]=j.deriveAsset(angular.copy(b)):"container"===a&&(j.containers[b._id]?angular.extend(j.containers[b._id],j.deriveContainer(angular.copy(b))):j.containers[b._id]=j.deriveContainer(angular.copy(b)))};var k={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/question-mc-formative.html":"templates/item/question-mc-formative.html","templates/question-mc-poll.html":"templates/item/question-mc-poll.html","templates/question-mc.html":"templates/item/question-mc.html","templates/question-mc-image-left.html":"templates/item/question-mc-image-left.html","templates/question-mc-image-right.html":"templates/item/question-mc-image-right.html","templates/sxs-question.html":"templates/item/sxs-question.html"};j.deriveEpisode=function(a){return a.templateUrl||(a.templateUrl=DEFAULT_EPISODE_TEMPLATE_URL),k[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=k[a.templateUrl]),angular.forEach(a.languages,function(b){b["default"]&&(a.defaultLanguage=b.code)}),a.defaultLanguage===!1&&(a.defaultLanguage="en"),j.setLanguageStrings(),a.styles||(a.styles=[]),angular.forEach(["eliterate","gw","gwsb","purdue","usc","columbia","columbiabusiness"],function(b){a.templateUrl==="templates/episode/"+b+".html"&&angular.forEach(["color","typography"],function(c){var d=!1;angular.forEach(a.styles,function(a){a.match(c)&&(d=!0)}),d||a.styles.push(c+b[0].toUpperCase()+b.substring(1))})}),a.title&&j.events["internal:landingscreen:"+a._id]&&(j.events["internal:landingscreen:"+a._id].title=a.title,j.events["internal:landingscreen:"+a._id]=m(j.events["internal:landingscreen:"+a._id])),a=m(a)},j.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=o(a)),a=m(a)},j.deriveContainer=function(a){if(a.haveNotLoadedChildData=!1,a.children&&a.children.length>0){a.children=a.children.sort(function(a,b){return a.name.en>b.name.en?1:-1}),a.children=a.children.sort(function(a,b){return a.sort_order-b.sort_order});var b=[];angular.forEach(a.children,function(a){j.containers[a._id]?b.push(j.containers[a._id]):(a.haveNotLoadedChildData=!0,j.containers[a._id]=angular.copy(m(a)))}),a.loadedChildData=!0}else a.children=[];return m(a)};var l=function(a){return void 0!==a?"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1:void 0};j.deriveEvent=function(a){if(a=m(a),"Scene"!==a._type){a.searchableText=(a.display_annotation||a.display_description)+" "+(a.display_title||a.display_annotator),a.cosmetic||(a.cosmetic=!1),a.sxs&&(a.cosmetic=!1),a.templateUrl||(a.templateUrl=""),a.avatar_id&&(j.assets[a.avatar_id]||(j.assets[a.avatar_id]={}),a.avatar=j.assets[a.avatar_id]),j.episodes[a.cur_episode_id]&&"templates/episode/usc.html"===j.episodes[a.cur_episode_id].templateUrl&&(""===a.templateUrl&&(a.templateUrl="templates/item/usc-badges.html"),"Link"===a._type&&("templates/transmedia-link-default.html"===a.templateUrl&&(a.templateUrl="templates/transmedia-link-noembed.html"),a.display_title.match(/ACTIVITY/)&&(a.display_description=a.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When youre finished - Come back to this page and click <b>Continue</b>).<br><br>If youd rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),a.display_title.match(/Haven't Registered/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyGuests"),a.uscReviewModeHack="uscHackOnlyGuests"),a.display_title.match(/Connect with/)&&(a.styles=a.styles?a.styles:[],a.styles.push("uscHackOnlyBadge"),a.uscReviewModeHack="uscHackOnlyBadge"))),a.isContent=!1,a.isTranscript=!1,a.noEmbed=void 0===a.noEmbed?!1:a.noEmbed,a.mixedContent=!1,a.noExternalLink=!1,a.targetTop=!1,a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,l(a)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0);var d="https"===c.protocol();"Link"===a._type&&a.url&&a.url.match(/^http:\/\//)&&d&&(a.noEmbed=!0,a.mixedContent=!0,a.showInlineDetail=!1),"Link"===a._type&&a.url&&/mailto/.test(a.url)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0,a.noEmbed=!0)}switch(k[a.templateUrl]?(a.origTemplateUrl=a.templateUrl,a.templateUrl=k[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html")):a.origTemplateUrl=a.templateUrl,a.producerItemType||("Scene"===a._type?a.producerItemType="scene":"Annotation"===a._type?a.templateUrl.match(/transcript/)?a.producerItemType="transcript":a.producerItemType="annotation":"Upload"===a._type?a.templateUrl.match(/file/)?a.producerItemType="file":a.producerItemType="image":"Link"===a._type?a.templateUrl.match(/video/)?a.producerItemType="video":a.producerItemType="link":"Plugin"===a._type?a.templateUrl.match(/question/)&&(a.producerItemType="question"):"Chapter"===a._type&&(a.producerItemType="chapter"),!a.producerItemType),a.producerItemType){case"chapter":a.isContent=!1;break;case"annotation":a.isPq=a.isHeader=a.isLongText=a.isDef=!1,/pullquote/.test(a.templateUrl)&&(a.isPq=!0),/text-h1|text-h2/.test(a.templateUrl)&&(a.isHeader=!0),/text-transmedia/.test(a.templateUrl)&&(a.isLongText=!0),a.isDef=!0}return a.displayStartTime=b("asTime")(a.start_time),a};var m=function(a){var b=f.lang?f.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(c){a[c]&&("string"==typeof a[c]?a["display_"+c]=a[c]:a[c][b]?a["display_"+c]=a[c][b]:a["display_"+c]=a[c].en)}),a};j.setLanguageStrings=function(){angular.forEach(j.events,function(a){a=m(a)}),angular.forEach(j.episodes,function(a){a=m(a)}),angular.forEach(j.containers,function(a){a=m(a)})},j.resolveEpisodeEvents=function(a){var b=[],c=[],e=[],f=j.episodes[a];angular.forEach(j.events,function(d){d.cur_episode_id===a&&("Scene"===d._type?b.push(d):"Chapter"===d._type?(e.push(d),c.push(d)):c.push(d))});var g={};angular.forEach(c,function(a){if("Annotation"===a._type&&a.chapter_marker===!0&&e.push(a),"Annotation"===a._type&&a.annotator){var b=f.defaultLanguage||"en",c=a.annotator[b];void 0===c&&(c=a.annotator[Object.keys(a.annotator).sort()[0]]),g[c]?(g[c].name=angular.extend(g[c].name,a.annotator),g[c].annotation_image_id||(g[c].annotation_image_id=a.annotation_image_id)):g[c]={name:a.annotator,annotation_image_id:a.annotation_image_id};for(var d=Object.keys(g[c].name).sort(),h=g[c].name[b]||"(untranslated)",i=0;i<d.length;i++)d[i]!==b&&(h=h+" / "+g[c].name[d[i]]);g[c].key=h}}),f.annotators=g,f.chapters=e;var h=0;f.masterAsset&&(h=f.masterAsset.duration,angular.forEach(f.scenes,function(a){a.start_time>h&&(a.start_time=h-.2)})),f.scenes=b.sort(function(a,b){return a._id.indexOf("internal:start")>-1||b._id.indexOf("internal:end")>-1?-1:b._id.indexOf("internal:start")>-1||a._id.indexOf("internal:end")>-1?1:a.start_time-b.start_time}),f.chapters=e.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(c,function(a){h>0&&a.start_time>h-.11&&(a.start_time=h-.2,a.end_time=h-.1),a.start_time<.01&&(a.start_time=.01,a.end_time<.01&&(a.end_time=.01)),a.start_time>a.end_time&&(a.end_time=a.start_time)}),f.items=c.sort(function(a,b){return a.start_time===b.start_time?"chapter"===a.producerItemType?-1:"chapter"===b.producerItemType?1:a.chapter_marker===!0?-1:b.chapter_marker===!0?1:"templates/item/text-h1.html"===a.templateUrl?-1:"templates/item/text-h1.html"===b.templateUrl?1:"templates/item/text-h2.html"===a.templateUrl?-1:"templates/item/text-h2.html"===b.templateUrl?1:a.isTranscript?-1:b.isTranscript?1:"Link"===a._type?-1:"Link"===b._type?1:"Upload"===a._type?"file"===a.producerItemType||"Annotation"===b._type?-1:1:"Upload"===b._type?1:-1:a.start_time-b.start_time});for(var i=1,k=f.scenes.length;k>i;i++)i===k-1?0!==h&&(f.scenes[i].end_time=h):f.scenes[i].end_time=f.scenes[i+1].start_time;for(var m=0,o=0,p=b.length;p>o;o++){for(var q=b[o],r=[],s={},t=m,u=c.length;u>t;t++){var v=c[t];v.start_time>=q.start_time&&v.start_time<q.end_time&&(l(v)&&(s.end_time===q.end_time&&(s.end_time=v.start_time),s=v),v.end_time<=q.end_time?(j.events[v._id].scene_id=q._id,r.push(v)):q.end_time-.25<v.start_time&&o!==p-1?v.start_time=q.end_time:(v.end_time=q.end_time,v.scene_id=q._id,r.push(v)))}j.events[q._id].items=r.sort(function(a,b){return a.start_time===b.start_time&&b.layouts?b.layouts.indexOf("sidebarL")>-1||b.layouts.indexOf("sidebarR")>-1?1:0:a.start_time-b.start_time})}f.styleCss=n(f),angular.forEach(j.events,function(b){if(b.cur_episode_id===a){b.styleCss=n(b);var c,e="templates/item/image-plain.html"===b.templateUrl,g="templates/item/image-inline-withtext.html"===b.templateUrl,h="templates/item/image-caption-sliding.html"===b.templateUrl,i="templates/item/image-thumbnail.html"===b.templateUrl,k="templates/item/image-fill.html"===b.templateUrl,l="templates/item/text-transmedia.html"===b.templateUrl,m="templates/item/text-definition.html"===b.templateUrl,o="templates/item/text-h1.html"===b.templateUrl,p="templates/item/text-h2.html"===b.templateUrl,q="templates/item/pullquote-noattrib.html"===b.templateUrl||"templates/item/pullquote.html"===b.templateUrl,r=["highlightSolid","highlightBorder","highlightSide","highlightBloom","highlightTilt","highlightNone"],s=["transitionFade","transitionPop","transitionNone","transitionSlideL","transitionSlideR"];"Scene"!==b._type&&(c=j.scene(b.scene_id),-1!==f.styles.indexOf("timestampNone")||-1!==f.styles.indexOf("timestampInline")||d.existy(c)&&d.existy(c.styles)&&(-1!==c.styles.indexOf("timestampNone")||-1!==c.styles.indexOf("timestampInline"))||(e||l||m)&&(!d.existy(b.styles)||-1===b.styles.indexOf("timestampInline")&&-1===b.styles.indexOf("timestampNone"))&&(b.styleCss+=" timestampNone"),(o||p||q)&&(b.styleCss+=" timestampNone"),d.existy(b.layouts)&&-1!==b.layouts.indexOf("showCurrent")||0!==d.intersection(f.styles,r).length||d.existy(c)&&d.existy(c.styles)&&0!==d.intersection(c.styles,r).length||d.existy(b.styles)&&0!==d.intersection(b.styles,r).length||(b.styleCss+=" highlightSolid"),0!==d.intersection(f.styles,s).length||d.existy(c)&&d.existy(c.styles)&&0!==d.intersection(c.styles,s).length||d.existy(b.styles)&&0!==d.intersection(b.styles,s).length||(e||g||h||i||q||k?d.existy(b.layouts)&&-1===b.layouts.indexOf("videoOverlay")?b.styleCss+=" transitionPop":b.styleCss+=" transitionFade":b.styleCss+=" transitionSlideL")),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")),b.styleCss=b.styleCss.replace(/timestampInline/,"")}})},j.resolveEpisodeContainers=function(a){var b=j.episodes[a];b.parents=[],delete b.previousEpisodeContainer,delete b.nextEpisodeContainer,b.navigation_depth=0},j.episode=function(a){return!j.episodes[a],j.episodes[a]},j.episodeEvents=function(a){var b=[];return angular.forEach(j.events,function(c){c.cur_episode_id===a&&b.push(c)}),b},j.sceneAtEpisodeTime=function(a,b){b=b||f.time;for(var c=j.episodes[a].scenes,d=0;d<c.length;d++)if(c[d].start_time<=b&&c[d].end_time>b)return c[d]},j.scene=function(a){return!j.events[a],j.events[a]};var n=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=j.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.cur_episode_id){var e=j.episodes[a.cur_episode_id].styles;angular.forEach(e,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}if("Scene"!==a._type&&!a.isContent&&a.layouts&&a.layouts[0].match(/Bg/))for(var f=0;f<c.length;f++)c[f].match(/transition/)&&"transitionNone"!==c[f]&&(c[f]="transitionFade");return c.join(" ")};j.resolveEpisodeAssets=function(a){if(angular.forEach(j.events,function(b){if(b.cur_episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&j.assets[c]&&(j.events[b._id].asset=j.assets[c])}}),j.episodes[a]){var b=j.episodes[a].master_asset_id;b&&j.assets[b]&&(j.episodes[a].masterAsset=j.assets[b]);var c=j.episodes[a].poster_frame_id;c&&j.assets[c]&&(j.episodes[a].poster=j.assets[c])}},j.addLandingScreen=function(a){j.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",cur_episode_id:a,episode_id:a,start_time:-.01,end_time:.01}},j.addEndingScreen=function(a){var b=j.episodes[a];if(b&&b.scenes&&b.masterAsset){b.scenes=b.scenes.sort(function(a,b){return a.start_time-b.start_time});var c=b.scenes[b.scenes.length-1];if(!c._id.match(/internal:endingscreen/)){var d=parseFloat(b.masterAsset.duration);c.end_time=d-.1,angular.forEach(c.items,function(a){a.end_time>d-.1&&(a.end_time=d-.1)}),j.events["internal:endingscreen:"+a]={_id:"internal:endingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/endingscreen.html",cur_episode_id:a,start_time:d-.1,end_time:d},j.events["internal:endingscreen:"+a]=m(j.events["internal:endingscreen:"+a]),j.resolveEpisodeEvents(a)}}};var o=function(a){var b={youtube:[],mp4:[],webm:[],m3u8:[]},c=/\.(\w+)$/;if(a.alternate_urls){for(var d=0;d<a.alternate_urls.length;d++)a.alternate_urls[d].match(/youtube/)?g.embeddableYoutubeUrl(a.alternate_urls[d])&&b.youtube.push(g.embeddableYoutubeUrl(a.alternate_urls[d])):b[a.alternate_urls[d].match(c)[1]].push(a.alternate_urls[d]);a.you_tube_url&&g.embeddableYoutubeUrl(a.you_tube_url)&&b.youtube.push(g.embeddableYoutubeUrl(a.you_tube_url));var f=/(\d+)x(\d+)\.\w+$/;angular.forEach(Object.keys(b),function(a){b[a]=b[a].sort(function(a,b){var c=a.match(f)||[0,0],d=b.match(f)||[0,0];return c[1]-d[1]})})}0===b.youtube.length&&(a.url&&g.embeddableYoutubeUrl(a.url)&&(a.you_tube_url=g.embeddableYoutubeUrl(a.url)),a.you_tube_url&&g.embeddableYoutubeUrl(a.you_tube_url)&&(b.youtube=[g.embeddableYoutubeUrl(a.you_tube_url)])),a.alternate_urls||angular.forEach(["mp4","webm","m3u8"],function(c){0!==b[c].length||a.url.match(/youtube/)||b[c].push(a.url.replace("mp4",c))}),e.youtube.disabled&&delete b.youtube;var h=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);h||delete b.m3u8;var i=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if(i){var k,l="t="+(new Date).getTime();angular.forEach(["mp4","webm"],function(a){if(b[a].length>0)for(var c=0;c<b[a].length;c++)k=b[a][c].match(/\?/)?"&":"?",b[a][c]=b[a][c]+k+l})}return a.urls=b,a.isTranscoded=function(){return j.isTranscoded(this)},a};return j.isTranscoded=function(a){return a.urls&&a.urls.youtube&&a.urls.youtube.length?!0:a.alternate_urls?!0:!1},e.debugInBrowser,j}]),angular.module("com.inthetelling.story").factory("timelineSvc",["$window","$timeout","$interval","$rootScope","$filter","config","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f,g,h,i){function j(a){return a.reduce(function(a,b){return a.hasOwnProperty(b.start_time)?a[b.start_time].push(b):a[b.start_time]=[b],a},{})}function k(a){var b=[];return angular.forEach(a,function(a,c){var d={events:a,stop:!1,start_time:c,toolTipText:"",layoutChange:!1},e=!1,f=[],g=!1,h=!1;angular.forEach(a,function(a){/internal:endingscreen|internal:landingscreen/.test(a._id)&&(h=!0),a.stop&&(e=!0),"Scene"===a.type&&(g=!0),("Chapter"===a.type||a.chapter_marker===!0)&&f.push(a)}),0===f.length&&!g&&e&&(d.stop=!0,d.toolTipText="Stop item"),g&&0===f.length&&(d.layoutChange=!0,d.toolTipText="(Layout Change)"),f.length>0&&(angular.forEach(f,function(a,b){0===b?d.toolTipText=a.display_annotation||a.display_title:d.toolTipText+=" / "+(a.display_annotation||a.display_title)}),g&&(d.toolTipText+=" (Layout Change)")),h||b.push(d)}),b}var l={};l.timelineEvents=[],l.markedEvents=[];var m,n,o,p;l.registerVideo=function(a){void 0!==o&&b(function(){l.seek(h.time)}),o=a},l.unregisterVideo=function(){o=void 0},l.setSpeed=function(a){p=a,h.timeMultiplier=p,o.setSpeed(a),v()},l.play=function(b){if(h.duration&&!(h.duration<.1)){if(!h.hasBeenPlayed)return h.hasBeenPlayed=!0,void d.$emit("video.firstPlay");if(h.time>h.duration-.1&&(l.seek(.1),l.play()),void 0!==o)h.videoControlsActive=!0,h.show.navPanel=!1,h.timelineState="buffering",a.parent!==a&&a.parent.postMessage("pauseEpisodePlayback","*"),o.play().then(function(){h.timelineState="playing",x(),t(),b||i.captureEpisodeActivity("play")});else var c=d.$watch(function(){return void 0!==o},function(a){a&&(c(),l.play())})}},l.enforceSingletonPauseListener||a.addEventListener("message",function(a){"pauseEpisodePlayback"===a.data&&l.pause()},!1),l.enforceSingletonPauseListener=!0,l.pause=function(a){h.videoControlsActive=!0,c.cancel(m),u(),m=void 0,s=void 0,h.timelineState="paused",o&&o.pause(),a||i.captureEpisodeActivity("pause")},l.stall=function(){c.cancel(m),u(),m=void 0,s=void 0,l.wasPlaying="playing"===h.timelineState,h.timelineState="buffering"},l.unstall=function(){l.wasPlaying?(h.timelineState="playing",l.play()):h.timelineState="paused",l.wasPlaying=void 0},l.startAtSpecificTime=function(a){return o&&0!==h.duration?(h.isTouchDevice&&h.hasBeenPlayed===!1&&"youtube"===o.videoType,a=C(a),0>a&&(a=0),a>h.duration&&(a=h.duration),h.time=a,l.updateEventStates(),o.startAtTime(a),void i.captureEpisodeActivity("seek",{method:"URLParameter"})):void b(function(){l.startAtSpecificTime(a)},300)},l.seek=function(a,c,d){if(!o||0===h.duration)return void b(function(){l.seek(a,c,d)},300);var e=h.time;a=C(a),0>a&&(a=0),a>h.duration&&(a=h.duration);var f="playing"===h.timelineState;if(f&&l.pause(!0),u(),h.time=a,o.seek(a,!0),l.updateEventStates(),c){var g={method:c,seekStart:e};d&&(g.event_id=d),i.captureEpisodeActivity("seek",g)}if(f){for(var j=!0,k=150,m=0;m<l.timelineEvents.length;m++){var n=l.timelineEvents[m];if(n.t>a-k&&"pause"===n.action&&(j=!1),n.t>a)break}j&&b(function(){l.play()},k)}},l.prevScene=function(){for(var a=l.markedEvents.length-1;a>=0;a--){var b=h.time;if("playing"===h.timelineState&&(b-=3),l.markedEvents[a].start_time<b){l.seek(l.markedEvents[a].start_time,"prevScene");break}}},l.nextScene=function(){for(var a=!1,b=0;b<l.markedEvents.length;b++)if(l.markedEvents[b].start_time>h.time){l.seek(l.markedEvents[b].start_time,"nextScene"),a=!0;break}a||(l.pause(),l.seek(h.duration-.01,"nextScene"))},l.toggleMute=function(){h.muted=!h.muted,o.toggleMute()},l.setVolume=function(a){h.volume=a,o.setVolume(a)};var q,r=function(){q={lastTimelineTime:0,lastVideoTime:0}};r();var s,t=function(){q.lastTimelineTime=h.time,q.lastVideoTime=h.time,v()},u=function(){b.cancel(n),r()},v=function(a){if(b.cancel(n),"playing"===h.timelineState){for(var c=o.currentTime(),d=h.time,e=0;e<l.timelineEvents.length;e++){var f=l.timelineEvents[e];if(f.t>=q.lastTimelineTime){if(f.t>d)break;if(("pause"!==f.action||!a&&f.t!==q.lastTimelineTime)&&(w(f),"pause"===f.action)){e++;break}}}var g=l.timelineEvents[e];if(q.lastVideoTime=c,q.lastTimelineTime=d,g&&"playing"===h.timelineState){var i=1e3*(l.timelineEvents[e].t-d)/p;n=b(v,i+10)}}},w=function(a){"timeline"===a.id?"pause"===a.action?(h.time=a.t,l.pause()):l.play():"enter"===a.action?(g.events[a.id].state="isCurrent",g.events[a.id].isCurrent=!0):"exit"===a.action?(g.events[a.id].state="isPast",g.events[a.id].isCurrent=!1):"preload"===a.action&&B(g.events[a.id])},x=function(){s=void 0,c.cancel(m),m=c(y,20)},y=function(){var a=new Date,b=isNaN(a-s)?0:a-s,c=parseFloat(h.time)+b/1e3*p;0>c&&(c=0,l.pause()),c>h.duration&&(c=h.duration,l.pause()),h.time=c,s=a};l.init=function(a){l.timelineEvents=[],l.markedEvents=[],l.displayMarkedEvents=[],p=1,h.duration=0,h.timelineState="paused",l.injectEvents(g.episodeEvents(a),0),c.cancel(m),u()},l.injectEvents=function(a,b){if(0!==a.length){b||(b=0),angular.forEach(a,function(a){a.start_time=+a.start_time,a.end_time=+a.end_time,"Scene"===a._type&&"producer"===h.product&&z(a),("Chapter"===a._type||a.chapter_marker===!0)&&z(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,g.events[a._id].start_time=.01),a.stop?(z(a),l.timelineEvents.push({t:a.start_time+b,id:"timeline",eventId:a._id,action:"pause"}),l.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),l.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(l.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&l.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"})),(a.asset_id||a.annotation_image_id||a.link_image_id)&&l.timelineEvents.push({t:a.start_time<3?0:a.start_time-3,id:a._id,action:"preload"})}),l.sortTimeline();var c=j(l.markedEvents,"start_time");l.displayMarkedEvents=k(c)}};var z=function(a){for(var b=!1,c=0;c<l.markedEvents.length;c++)l.markedEvents[c]._id===a._id&&(l.markedEvents[c]=angular.copy(a),b=!0);b||l.markedEvents.push(a)};l.removeEvent=function(a){l.timelineEvents=e("filter")(l.timelineEvents,function(b){return b.id===a||b.eventId===a?!1:!0}),l.markedEvents=e("filter")(l.markedEvents,{_id:"!"+a}),l.updateEventStates()},l.updateEventTimes=function(a){l.timelineEvents=e("filter")(l.timelineEvents,function(b){return b.id===a._id||b.eventId===a._id?!1:!0}),l.injectEvents([a],0)},l.updateSceneTimes=function(a){angular.forEach(g.episodes[a].scenes,function(a){l.updateEventTimes(a)})},l.sortTimeline=function(){l.timelineEvents=l.timelineEvents.sort(function(a,b){if(a.t===b.t){if(a.action===b.action)return 0;if("enter"===a.action){if("pause"===b.action)return-1;if("exit"===b.action)return 1}return"exit"===a.action?-1:"pause"===a.action?1:0}return a.t-b.t}),l.markedEvents=l.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),l.timelineEvents.length>0&&(h.duration=l.timelineEvents[l.timelineEvents.length-1].t),l.updateEventStates()},l.updateEventStates=function(){var a=h.time;angular.forEach(l.timelineEvents,function(a){if("timeline"!==a.id){var b=g.events[a.id];b&&(b.state="isFuture",b.isCurrent=!1)}}),angular.forEach(l.timelineEvents,function(b){if(b.t<=a){var c=g.events[b.id];c&&("enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1))}})};var A={},B=function(a){a.asset&&"Asset::Image"===a.asset._type&&(A[a.asset.url]||(A[a.asset.url]=new Image,A[a.asset.url].src=a.asset.url))},C=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return f.debugInBrowser,l}]),angular.module("com.inthetelling.story").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);return(c.local||e.disableAnalytics)&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(!e.disableAnalytics&&(!f.user||!f.user._id||f.user.track_episode_metrics)){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b,c,d){(d||!(e.disableAnalytics||f.user._id&&!f.user.track_event_actions))&&g.activityQueue.push({name:a,event_id:b,walltime:new Date,data:c})},g.forceCaptureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c,!0),g.flushActivityQueue()},g.captureEventActivityWithPromise=function(a,b,c){return g.captureEventActivity(a,b,c),g.flushActivityQueue()},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a);
}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){var c=a.defer();0===g.activityQueue.length&&c.resolve(""),f.episodeId||c.resolve();var d=angular.copy(g.activityQueue);g.activityQueue=[];var h=new Date,i=[],j=[];angular.forEach(d,function(a){a.age=(h-a.walltime)/1e3,delete a.walltime,a.event_id?j.push(a):i.push(a)}),i=g.dejitter(i);var k=[];return j.length>0&&k.push(b.post(e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/event_user_actions",{event_user_actions:j})),i.length>0&&k.push(b.post(e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/episode_user_metrics",{episode_user_metrics:i})),a.all(k).then(function(){c.resolve()}),c.promise},g.dejitter=function(a){if(0===a.length)return[];for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1];"seek"===d.name&&"seek"===e.name&&d.timestamp===e.data.seekStart?e.data.seekStart=d.data.seekStart:b.push(a[c])}return b.push(a[a.length-1]),b},g}]),angular.module("com.inthetelling.story").factory("youtubeSvc",["$q","$http","$timeout","config",function(a,b,c,d){var e={},f=function(e){var f="https://www.googleapis.com/youtube/v3/videos?id="+e+"&part=contentDetails,snippet&key="+d.youtube.apikey,g=a.defer(),h=c(function(){g.reject("Youtube API request timed out")},d.youtube.timeout);return b({method:"GET",url:f,transformRequest:function(a,b){var c=b();return delete c.Authorization,c}}).success(function(a){c.cancel(h),g.resolve(a)}).error(function(){g.reject()}),g.promise};e.extractYoutubeId=function(a){if(!a)return!1;a=a.replace(/%3F/,"?"),a=a.replace(/%26/,"&");var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b);return c&&c[1]?c[1]:!1},e.isYoutubeUrl=function(a){if(!a)return!1;a=a.replace(/%3F/,"?"),a=a.replace(/%26/,"&");var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;return b.test(a)},e.embedParams=function(a){return a===!1?"?controls=1&autoplay=1&modestbranding=1&showinfo=1&rel=0&iv_load_policy=3&wmode=transparent":"?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&rel=0&iv_load_policy=3&wmode=transparent"},e.createEmbedLinkFromYoutubeId=function(a,b){return a?"//www.youtube.com/embed/"+a+(b?"":e.embedParams(b)):!1},e.embeddableYoutubeUrl=function(a,b){if(!a)return!1;var c=e.extractYoutubeId(a);return e.createEmbedLinkFromYoutubeId(c,b)};var g=function(a){var b=0;return a.match(/(\d*)D/)&&(b+=parseInt(86400*a.match(/(\d*)D/)[1],10)),a.match(/(\d*)H/)&&(b+=parseInt(3600*a.match(/(\d*)H/)[1],10)),a.match(/(\d*)M/)&&(b+=parseInt(60*a.match(/(\d*)M/)[1],10)),a.match(/(\d*)S/)&&(b+=parseInt(a.match(/(\d*)S/)[1],10)),b};return e.getVideoData=function(b){var c=a.defer();return f(b).then(function(a){if(a.items[0]){var d={id:b,title:a.items[0].snippet.title,description:a.items[0].snippet.description,duration:g(a.items[0].contentDetails.duration)};c.resolve(d)}else c.reject("Bad response data from youtube getVideoData")},function(a){c.reject(a)}),c.promise},e}]),function(){function a(a,b){this.$q=b,this.$timeout=a}angular.module("com.inthetelling.story").service("YoutubePlayerApi",a),a.$inject=["$timeout","$q"],a.prototype.load=function(){if(this.dfd=this.$q.defer(),this.onYouTubeIframeAPIReady(this.dfd),this.checkForScriptTag(this.dfd)===!1){var a="//www.youtube.com/iframe_api",b=document.createElement("script");b.src=a,b.id="yt-iframe-api";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}return this.cancelIframe=this.$timeout(function(){this.dfd.reject("too long!")}.bind(this),2e3),this.dfd.promise},a.prototype.onYouTubeIframeAPIReady=function(a){window.onYouTubeIframeAPIReady=function(){a.resolve(),this.$timeout.cancel(this.cancelIframe)}.bind(this)},a.prototype.checkForScriptTag=function(a){var b=document.getElementsByTagName("script"),c=document.getElementById("yt-iframe-api"),d=!1,e=0,f=b.length;for(e;f>e;e++)if("www-widgetapi-script"===b[e].getAttribute("id")){d=!0,a.resolve();break}return c?void 0:d}}(),function(){function a(a,b,c,d,e,f){function g(a,c,d,f,g,h){var i=1;a===E&&(i=0);var j=b.host();return e.load().then(function(){return new YT.Player(a,{videoId:c,playerVars:{controls:i,enablejsapi:1,modestbranding:1,showinfo:0,rel:0,iv_load_policy:3,origin:j,wmode:"transparent"},events:{onReady:g,onStateChange:d,onPlaybackQualityChange:f,onError:h}})})}function h(a){return F[a]&&F[a].ready===!0?F[a].yt:void 0}function i(a){return null!=a}function j(a){var b;return angular.forEach(F,function(c,d){return c.yt===a?b=d:void 0}),b}function k(a,b,e,h,i,k){function l(a){F[b].yt=a,F[b].ready=!1}function n(){return g(a,e,s,u,t,v).then(l)["catch"](o)}function o(a){var b="Network timeout initializing video player. Please try again.";f.error({data:b},a)}function s(a){var b,e=E,f=a.data,g=j(a.target);g!==E&&(b=g);var i=m(b),k=m(e);g===e&&(k===YT.PlayerState.PLAYING&&y(),f===YT.PlayerState.ENDED&&p(g)),g===b&&("playing"===c.timelineState&&(d.pause(),z(b)),i===YT.PlayerState.PLAYING&&z(b)),void 0!==F[b]&&void 0===F[e]&&f!==YT.PlayerState.UNSTARTED&&"playing"===c.timelineState&&c.embedYTPlayerAvailable&&d.pause(),h(a)}function t(a){var b=j(a.target);b===E&&(c.mainYTPlayerReady=!0),b!==E&&(c.embedYTPlayerReady=!0,c.embedYTPlayerAvailable=!0),F[b].ready=!0,k(a)}function u(a){var b=j(a.target);"medium"===a.data&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&r(b,"large"),i(a)}function v(a){var b=j(a.target);5===a.data&&q(b)}g(a,e,s,u,t,v).then(l)["catch"](n)}function l(a){var b=h(a);return i(b)?b.getCurrentTime():void 0}function m(a){var b=h(a);return i(b)?b.getPlayerState():void 0}function n(a){var b=h(a);return i(b)?b.playVideo():void 0}function o(a){var b=h(a);return i(b)?b.pauseVideo():void 0}function p(a){var b=h(a);return i(b)?b.stopVideo():void 0}function q(a){var b=F[a],c=F[a].yt;if(i(c)){var e=c.getVideoData().video_id,f=c.getCurrentTime();b.isMainPlayer?(c.cueVideoById(e,f),d.play()):c.loadVideoById(e,f)}}function r(a,b){var c=h(a);i(c)&&c.setPlaybackQuality(b)}function s(a){var b=h(a);return i(b)?b.getVideoLoadedFraction():void 0}function t(a,b,c){var d=h(a);i(d)&&d.seekTo(b,c)}function u(a){var b=h(a);return i(b)?b.isMuted():void 0}function v(a){var b=h(a);return i(b)?b.mute():void 0}function w(a){var b=h(a);return i(b)?b.unMute():void 0}function x(a,b){var c=h(a);i(c)&&c.setVolume(b)}function y(){for(var a in F)if(a!==E){var b=m(a);b!==YT.PlayerState.UNSTARTED&&b!==YT.PlayerState.PAUSED&&b!==YT.PlayerState.CUED&&o(a)}}function z(a){for(var b in F)if(b!==E&&b!==a){var c=m(b);c!==YT.PlayerState.UNSTARTED&&c!==YT.PlayerState.PAUSED&&c!==YT.PlayerState.CUED&&o(b)}}function A(a){var b=h(a);i(b)&&(b.destroy(),delete F[a])}function B(){var a=(new Date).getTime(),b="xxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b}function C(b,c){var d,e=a.defer();return c?(F={},d=b,E=d,F[d]={isMainPlayer:!0}):(d=B()+b,F[b]={isMainPlayer:!1}),e.resolve(d),e.promise}var D,E,F={};return D={create:k,destroy:A,play:n,playerState:m,pause:o,pauseEmbeds:y,stop:p,reset:q,pauseOtherEmbeds:z,setPlaybackQuality:r,setPlayerId:C,getVideoLoadedFraction:s,seekTo:t,getCurrentTime:l,isMuted:u,mute:v,unMute:w,setVolume:x}}angular.module("com.inthetelling.story").factory("youTubePlayerManager",a),a.$inject=["$q","$location","appState","timelineSvc","YoutubePlayerApi","errorSvc"]}(),angular.module("com.inthetelling.story").factory("questionAnswersSvc",["$q","analyticsSvc","appState",function(a,b,c){var d={};return d.saveAnswer=function(a,c,d){return b.forceCaptureEventActivityWithPromise(a,c,d)},d.getAnswers=function(d){var e=a.defer();return b.readEventActivity(d).then(function(a){var b=a.filter(function(a){return("question-answered"===a.name||"question-answered-updated"===a.name)&&a.episode_id===c.episodeId});e.resolve(b)}),e.promise},d.getUserAnswer=function(b,c){var e=a.defer();return d.getAnswers(b).then(function(a){if(!a)return e.reject();var b=a.filter(function(a){return a.user_id===c});b.length>0?e.resolve(b[0]):e.reject()}),e.promise},d.calculateCounts=function(a){var b;return angular.forEach(a,function(a){b[a.data.index]++}),b},d.incrementAnswerCount=function(a,b){a[b]=(a[b]||0)+1},d}]),angular.module("com.inthetelling.story").factory("recursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("com.inthetelling.story").factory("mockSvc",["modelSvc",function(a){var b={};return b.keepJsLintHappy=function(){var b=a.episodes.noop;b=void 0},b.mockEpisode=function(b){a.cache("episode",{_id:b,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en","default":!0}],status:"Published",templateUrl:"templates/episode/gwsb.html",styles:["","",""]}),a.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var c={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:b,cur_episode_id:b,layouts:["",""],styles:["transitionSlideL"]},d=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/2colL.html","templates/scene/2colR.html","templates/scene/centered.html","templates/scene/1col.html"],e=0;10>e;e++){var f=angular.copy(c);f._id="scene-"+e,f.title=e/2===Math.floor(e/2)?{en:"Scene "+(e+1)+" Title"}:{en:""},f.start_time=20*e,f.end_time=20*e+20,f.templateUrl=d[e%d.length],a.cache("event",f)}var g={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:b,cur_episode_id:b,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},h=["sidebarL","sidebarR","inline"],i=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(e=0;30>e;e++){var j=angular.copy(g);j._id="transcript-"+e,j.annotation={en:"Transcript block number "+(e+1)},j.start_time=5*e,j.end_time=5*e+5,j.layouts=[h[e%h.length]]}for(e=0;10>e;e++){var k=angular.copy(g);k._id="annotation-"+e,k.start_time=6*e,k.end_time=6*e+3,k.templateUrl=i[e%i.length],a.cache("event",k)}for(e=0;10>e;e++){var l=angular.copy(g);l._id="longtext-"+e,l.start_time=7*e,l.end_time=7*e+7,l.styles=["timestampNone"],l.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},l.templateUrl="templates/item/text-transmedia.html",a.cache("event",l)}a.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),a.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),a.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),a.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var m={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/link-withimage.html",layouts:["inline"],styles:["timestampNone"],isContent:!0};for(e=0;30>e;e++){var n=angular.copy(m);n._id="link-"+e,n.required=Math.random()>.5,n.start_time=3*e,n.end_time=3*e+3,n.layouts=[h[e%h.length]],a.cache("event",n)}var o={_id:"",_type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],title:{},data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",correct:!0,index:3},{text:"",index:4}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(e=0;10>e;e++){var p=angular.copy(o);p._id="question-"+e,p.required=Math.random()>.5,p.start_time=5*e,p.end_time=5*e+5,p.layouts=[h[e%h.length]],a.cache("event",p)}var q={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",index:3},{text:"",index:4}],_type:"question"}}};for(e=0;10>e;e++){var r=angular.copy(q);r._id="question-"+e,r.required=Math.random()>.5,r.start_time=6*e,r.end_time=6*e+6,r.layouts=[h[e%h.length]],a.cache("event",r)}var s={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:b,cur_episode_id:b,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(e=0;30>e;e++){var t=angular.copy(s);t._id="upload-"+e,t.asset_id="asset2",t.title={en:"Upload number "+(e%3+1)},t.start_time=4*e,t.end_time=4*e+4,t.layouts=[h[e%h.length]],a.cache("event",t)}var u=["mainFg","altFg","videoOverlay"];for(e=0;8>e;e++){var v=angular.copy(s);v.layouts=[u[e%u.length]],v._id="filltest-"+e,v.asset_id="asset2",v.start_time=2*e,v.end_time=2*e+2,v.templateUrl="templates/item/image-fill.html",v.styles.push("cover"),a.cache("event",v)}a.resolveEpisodeEvents(b),a.resolveEpisodeAssets(b)},b}]),function(){function a(a){function b(a,b){var c=h(a);return c.name="resized"+b,c.lastModifiedDate=new Date,c}function c(b){var c=new FileReader,d=new Image;return a(function(a,d){c.onloadend=function(){a(c.result)},c.onerror=function(){d(c.error)},c.readAsDataURL(b)}).then(function(b){return d.src=b,a(function(a,b){d.onload=function(){a(d)},d.onerror=function(){b("Error Loading Image")}}).then(function(a){return a})})}function d(b,c,d,h){return a(function(a){var j=document.createElement("canvas"),k=g(j),l=0,m=0,n=b.width,o=b.height;for(e(j,n,o),k.drawImage(b,0,0,n,o);(n>c||o>d)&&!(c>.5*n||d>.5*o);)b.width=.5*b.width,b.height=.5*b.height,n=b.width,o=b.height,j=f(j,n,o);var p=i(j.width,j.height,c,d);h&&(p.height<d&&(m=(d-p.height)/2),p.width<c&&(l=(c-p.width)/2)),j=f(j,p.width,p.height,c,d,l,m),a(j.toDataURL("image/png",1))})}function e(a,b,c){a.width=b,a.height=c}function f(a,b,c,d,e,f,h){void 0===h&&(h=0),void 0===f&&(f=0);var i=document.createElement("canvas"),j=g(i);return i.width=void 0!==d?d:b,i.height=void 0!==e?e:c,j.drawImage(a,f,h,b,c),i}function g(a){var b=a.getContext("2d");return b.imageSmoothingEnabled=!0,b.mozImageSmoothingEnabled=!0,b.oImageSmoothingEnabled=!0,b.webkitImageSmoothingEnabled=!0,b}function h(a){var b=";base64,";if(-1==a.indexOf(b)){var c=a.split(","),d=c[0].split(":")[1],e=decodeURIComponent(c[1]);return new Blob([e],{type:d})}for(var c=a.split(b),d=c[0].split(":")[1],e=window.atob(c[1]),f=e.length,g=new Uint8Array(f),h=0;f>h;++h)g[h]=e.charCodeAt(h);return new Blob([g],{type:d})}function i(a,b,c,d){var e=Math.min(c/a,d/b);return{width:Math.floor(a*e),height:Math.floor(b*e)}}return{createFileFromDataURL:b,readFileToImg:c,resizeImg:d}}angular.module("com.inthetelling.story").factory("imageResize",a),a.$inject=["$q"]}(),function(){function a(){}function b(a){return a+(0>a?0:1)>>0}function c(a,b){return b.reduce(function(b,c){return f(a[c])&&(b[c]=angular.copy(a[c])),b},{})}function d(a){return(a+"").replace(/<\/?[^>]*>/gm,"")}function e(a){return a.indexOf(".")<0?null:a.split(".")[0]}function f(a){return null!=a}function g(a){return 0!=a&&f(a)}function h(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)});return b}function i(a){var b=/^(((?:http)s?:\/\/)|(?:\/\/))(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i;return b.test(a)}function j(a){return"option.value as option.name for option in $ctrl.getSelectOpts('"+a+"')"}function k(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d]==b[e]){c.push(d);break}return c}angular.module("com.inthetelling.story").service("ittUtils",a),a.prototype={getSubdomain:e,existy:f,truthy:g,generateUUID:h,isValidURL:i,stripHtmlTags:d,pick:c,bitwiseCeil:b,setNgOpts:j,intersection:k}}(),function(){function a(a,b,c,d){function e(a,b){r[a]=b}function f(a){return function(b){return e(a,b)}}function g(a){return Object.keys(s).filter(function(b){return s[b]===a.templateUrl})[0]}function h(a,b,c){var d="inline"===b.layouts[0];switch(a){case"centeredPro":y(!1);case"1col":case"centered":var e=n("admin");y(!0),q.display=[{value:"windowBg",name:t.windowBg,isDisabled:!1},{value:"videoOverlay",name:t.videoOverlay,isDisabled:!1},{value:"mainBg",name:t.mainBg,isDisabled:!e},{value:"mainFg",name:t.mainFg,isDisabled:!e},{value:"altBg",name:t.altBg,isDisabled:!0},{value:"altFg",name:t.altFg,isDisabled:!0}],d&&(b.layouts=["windowBg"]),c.position=c.position||"fill",b.layouts=b.layouts||["windowBg"];break;case"2colL":case"2colR":case"mirroredTwoCol":y(!0),q.display=[{value:"windowBg",name:t.windowBg,isDisabled:!1},{value:"videoOverlay",name:t.videoOverlay,isDisabled:!1},{value:"mainBg",name:t.mainBg,isDisabled:!1},{value:"mainFg",name:t.mainFg,isDisabled:!1},{value:"altBg",name:t.altBg,isDisabled:!1},{value:"altFg",name:t.altFg,isDisabled:!1}],d&&(b.layouts=["mainBg"]),c.position=c.position||"fill",b.layouts=b.layouts||["mainBg"];break;case"cornerV":case"centerVV":case"cornerH":y(!0),q.display=[{value:"windowBg",name:t.windowBg,isDisabled:!1},{value:"videoOverlay",name:t.videoOverlay,isDisabled:!1},{value:"mainBg",name:t.mainBg,isDisabled:!1},{value:"mainFg",name:t.mainFg,isDisabled:!1},{value:"altBg",name:t.altBg,isDisabled:!1},{value:"altFg",name:t.altFg,isDisabled:!1}],d&&(b.layouts=["altBg"]),c.position=c.position||"fill",b.layouts=b.layouts||["altBg"];break;case"pip":y(!1),c.position=c.position||"fill",b.layouts=["altBg"];break;case"centerVVMondrian":q.display=[{value:"windowBg",name:t.windowBg,isDisabled:!0},{value:"videoOverlay",name:t.videoOverlay,isDisabled:!1},{value:"mainBg",name:t.mainBg,isDisabled:!1},{value:"mainFg",name:t.mainFg,isDisabled:!1},{value:"altBg",name:t.altBg,isDisabled:!0},{value:"altFg",name:t.altFg,isDisabled:!0}],d&&(b.layouts=["mainBg"]),b.layouts=b.layouts||["mainBg"],c.position=c.position||"fill"}c.position&&(b.styles=[c.position])}function i(a){return q[a]}function j(a){return r[a]}function k(b){switch(b){case"episode":var e=a.getCustomerIdsFromRoles(),f=function(a,b){if(n("admin"))return"Episode"===b.type&&a.push({url:b.url,name:b.displayName}),a;if("Episode"===b.type&&o(b.customerIds)){var c=d.intersection(e,b.customerIds);(c.length>0||0===b.customerIds.length)&&a.push({url:b.url,name:b.displayName})}return a},g=function(a,b){return a.name<b.name?-1:a.name>b.name?1:0};return c.getTemplates().reduce(f,[]).sort(g);case"scene":y(!1),z(!1),C(!0);var h=[{url:s.centered,name:"Center 1 (+ VTSANTTM)"},{url:s.centeredPro,name:"Center 2 (+ VANT)"},{url:s["1col"],name:"Center 3 (VTSANTTM)"},{url:s.cornerV,name:"Split 1 (VTSANT | TM)"},{url:s.mirroredTwoCol,name:"Split 2 (VTM | TSANT)"},{url:s.centerVV,name:"Split 3 (VANT | TM)"},{url:s.centerVVMondrian,name:"Split 4 (VANT | TM Invert)"},{url:s.cornerH,name:"Split 5 (VTSANT / TM)"},{url:s.pip,name:"Split 6 (TM / VTSANT)"}];return n("admin")&&h.push({url:s["2colL"],name:"OLD Two Columns"},{url:s["2colR"],name:"OLD Two Columns (mirrored)"}),h;case"transcript":return B(!0),C(!0),[{url:"templates/item/transcript-withthumbnail.html",name:"Transcript"}];case"annotation":return B(!1),A(!1),C(!0),[{url:"templates/item/text-h1.html",name:"Header 1"},{url:"templates/item/text-h2.html",name:"Header 2"},{url:"templates/item/pullquote.html",name:"Pullquote"},{url:"templates/item/text-transmedia.html",name:"Long text (as transmedia)"},{url:"templates/item/text-definition.html",name:"Definition (as transmedia)"}];case"link":y(!0),z(!1),x(!0),A(!0),C(!0);var i=[{url:"templates/item/link.html",name:"Link"},{url:"templates/item/link-withimage-notitle.html",name:"Link with image / hide title"},{url:"templates/item/link-modal-thumb.html",name:"Link Modal"},{url:"templates/item/link-embed.html",name:"Embedded Link"}];return n("admin")&&i.splice(3,0,{url:"templates/item/link-descriptionfirst.html",name:"Link w/ description first"}),i;case"image":x(!0),y(!1),z(!1),A(!0),C(!0);var j=[{url:"templates/item/image-plain.html",name:"Plain Image"},{url:"templates/item/image-inline-withtext.html",name:"Inline Image with text"},{url:"templates/item/image-caption-sliding.html",name:"Image with sliding caption"},{url:"templates/item/image-thumbnail.html",name:"Image thumbnail"},{url:"templates/item/image-fill.html",name:"Background or video overlay"}];return j;case"file":return A(!0),C(!1),[{url:"templates/item/file.html",name:"Uploaded File"}];case"question":return y(!0),x(!0),A(!0),C(!0),[{url:"templates/item/question-mc-image-right.html",name:"Question with image right"}];case"chapter":A(!0)}}function l(a,c){switch(y(!1),a.producerItemType){case"scene":var d="inline"===a.layouts[0];switch(a.templateUrl){case"templates/scene/centered.html":case"templates/scene/centeredPro.html":z(!1),y(!1),a.layouts[0]="",a.layouts[1]=u.a.value;break;case"templates/scene/centerVV.html":case"templates/scene/centerVV-Mondrian.html":y(!1),z(!0),q.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],a.layouts[1]=u.a.value,(d||""===a.layouts[0])&&(a.layouts[0]="videoLeft");break;case"templates/scene/cornerV.html":case"templates/scene/cornerH.html":case"templates/scene/pip.html":y(!0),z(!0),q.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],q.display=[{value:u.a.value,name:u.a.name},{value:u.b.value,name:u.b.name}],(d||""===a.layouts[0])&&(a.layouts[0]="videoLeft",a.layouts[1]=u.a.value);break;case"templates/scene/mirrored-twocol.html":y(!0),z(!0),q.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],q.display=[{value:v.a.value,name:v.a.name},{value:v.b.value,name:v.b.name}],a.layouts[1]=v.b.value,(d||""===a.layouts[0])&&(a.layouts[0]="videoLeft");break;case"templates/scene/1col.html":y(!0),z(!1),q.display=[{value:w.a.value,name:w.a.name},{value:w.b.value,name:w.b.name}],a.layouts[0]="",d&&(a.layouts[1]=w.b.value);break;case"templates/scene/2colL.html":case"templates/scene/2colR.html":y(!0),z(!0),q.video=[{value:"",name:"Video Centered"},{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],q.display=[{value:w.a.value,name:w.a.name},{value:w.b.value,name:w.b.name}],d&&(a.layouts[0]="",a.layouts[1]=w.b.value)}break;case"link":switch(y(!0),x(!0),C(!0),a.stop===!0?(a.layouts[0]="windowFg","templates/item/link-modal-thumb.html"===a.templateUrl&&(a.templateUrl="templates/item/link-embed.html")):a.layouts[0]="inline",a.templateUrl){case"templates/item/link.html":case"templates/item/link-withimage.html":case"templates/item/link-withimage-notitle.html":case"templates/item/link-modal-thumb.html":x(!0);break;case"templates/item/link-descriptionfirst.html":case"templates/item/link-embed.html":x(!1)}break;case"transcript":y(!1),a.layouts[0]="inline";break;case"annotation":switch(a.layouts[0]="inline",a.templateUrl){case"templates/item/text-h1.html":case"templates/item/text-h2.html":B(!1),A(!1);break;case"templates/item/pullquote-noattrib.html":case"templates/item/pullquote.html":B(!0),A(!1);break;case"templates/item/text-transmedia.html":case"templates/item/text-definition.html":B(!1),A(!0)}a.stop===!0&&(a.layouts[0]="windowFg");break;case"question":q.questionType=[{value:"mc-poll",name:"Poll"},{value:"mc-formative",name:"Formative"}],a.layouts[0]="windowFg",a.stop=!0;break;case"image":y(!1);var e=g(b.scene(a.scene_id));switch(a.templateUrl){case"templates/item/image-plain.html":case"templates/item/image-inline-withtext.html":case"templates/item/image-caption-sliding.html":case"templates/item/image.html":c.pin=c.position="",a.layouts[0]="inline";break;case"templates/item/image-fill.html":a.cosmetic=!0,y(!0),q.imagePosition=[{value:"fill",name:"Fill and stretch"},{value:"contain",name:"Contain"},{value:"cover",name:"Cover and crop"},{value:"tl",name:"Top Left"},{value:"tr",name:"Top Right"},{value:"bl",name:"Bottom Left"},{value:"br",name:"Bottom Right"}],h(e,a,c)}a.stop===!0&&(a.layouts[0]="windowFg");break;case"file":switch(a.showInlineDetail=!1,a.templateUrl){case"templates/item/link.html":a.showInlineDetail=!0;break;case"templates/item/file.html":case"templates/item/link-descriptionfirst.html":case"templates/item/link-modal-thumb.html":}}}function m(a,b){switch(a){case"scene":switch(b){case"Item":return!1;case"Style":return!0;case"Customize":return n("admin")}break;case"transcript":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"annotation":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"link":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"image":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"file":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"question":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return n("admin")}break;case"chapter":switch(b){case"Item":return!0;case"Style":return!1;case"Customize":return!1}}}var n=a.userHasRole,o=d.existy,p=[{value:"en",name:"English",isDisabled:!1},{value:"es",name:"Spanish",isDisabled:!1},{value:"zh",name:"Chinese",isDisabled:!1},{value:"pt",name:"Portuguese",isDisabled:!1},{value:"fr",name:"French",isDisabled:!1},{value:"de",name:"German",isDisabled:!1},{value:"it",name:"Italian",isDisabled:!1}],q={video:[],display:[],imagePosition:[],imagePin:[],questionType:[],language:p},r={templateSelect:!0,imageUpload:!1,display:!1,videoPosition:!1,titleField:!0,speakerField:!0},s={centered:"templates/scene/centered.html",centeredPro:"templates/scene/centeredPro.html","1col":"templates/scene/1col.html","2colL":"templates/scene/2colL.html","2colR":"templates/scene/2colR.html",mirroredTwoCol:"templates/scene/mirrored-twocol.html",cornerV:"templates/scene/cornerV.html",centerVV:"templates/scene/centerVV.html",centerVVMondrian:"templates/scene/centerVV-Mondrian.html",cornerH:"templates/scene/cornerH.html",pip:"templates/scene/pip.html"},t={windowBg:"Full window background",videoOverlay:"Video overlay (16:9)",mainBg:"Text pane background",mainFg:"Text pane foreground",altBg:"Transmedia pane background",altFg:"Transmedia pane foreground"},u={a:{value:"showCurrent",name:"show only current transmedia items"},b:{value:"",name:"Show all transmedia items, highlight current ones"}},v={a:{value:"showCurrent",name:"Show only current text items"},b:{value:"",name:"Show all text items, highlight current ones"}},w={a:{value:"showCurrent",name:"Show only current items"},b:{value:"",name:"Show all items, highlight current ones"}},x=f("imageUpload"),y=f("display"),z=f("videoPosition"),A=f("titleField"),B=f("speakerField"),C=f("templateSelect");return{showTab:m,onSelectChange:l,getTemplates:k,getVisibility:j,getSelectOpts:i}}angular.module("com.inthetelling.story").service("selectService",a),a.$inject=["authSvc","modelSvc","dataSvc","ittUtils"]}(),angular.module("com.inthetelling.story").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("mainCol",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.layouts||"mainBg"!==a.layouts[0]&&"mainFg"!==a.layouts[0]||b.push(a)}),b}}).filter("altCol",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.layouts||"altBg"!==a.layouts[0]&&"altFg"!==a.layouts[0]||b.push(a)}),b}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type||a.templateUrl.match(/(transmedia|definition)/)||b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){("Annotation"!==a._type||a.templateUrl.match(/(transmedia|definition)/))&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("reviewMode",["appState",function(a){return function(b){var c=[],d="producer"===a.product;return angular.forEach(b,function(a){(d||!a.cosmetic&&(a.isContent||a.layouts.indexOf("windowFg")>-1))&&c.push(a)}),c}}]).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){
return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("i18n",["appState",function(a){return function(b){return b?"object"==typeof b?b[a.lang]||b.en||"":b:""}}]).filter("asBytes",function(){return function(a){if(!a)return"";var b=Math.floor(a/1024);if(1024>b)return b+"Kb";var c=Math.floor(b/10.24)/100;return c+"Mb"}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("stripParams",function(){return function(a){return a.substr(0,a.indexOf("?"))}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":0>a?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}).filter("alpha",function(){return function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[a%26]}}).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLocaleLowerCase():""}}).filter("vidsFromCustAdmins",function(){return function(a){var b=[];return angular.forEach(a,function(a){/video/.test(a.content_type)||b.push(a)}),b}}),angular.module("com.inthetelling.story").controller("ErrorController",["$scope","$http","config","errorSvc","appState","authSvc",function(a,b,c,d,e,f){a.errorSvc=d,a.logout=f.logout,a.user=e.user,a.dismiss=function(a){for(var b=0;b<d.errors.length;b++)d.errors[b]===a&&(d.errors.splice(b,1),b=d.errors.length);for(b=0;b<d.notifications.length;b++)d.notifications[b]===a&&(d.notifications.splice(b,1),b=d.notifications.length)}}]),angular.module("com.inthetelling.story").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.changeSpeed=function(a){var c=d.timeMultiplier+a;.5>c&&(c=.5),c>2&&(c=2),b.setSpeed(c)},a.resetSpeed=function(){b.setSpeed(1)},a.markerPercent=function(a){return void 0===a?0:a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.story").controller("PlayerController",["config","$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc","youTubePlayerManager","selectService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.viewMode=function(a){h.viewMode=a,l.captureEpisodeActivity("modeChange",{mode:a}),h.producerEditLayer=0,"review"===a?(f(function(){d.$emit("magnet.jumpToMagnet")}),h.autoscroll=!0,h.autoscrollBlocked=!1,z(),f(B)):h.autoscroll=!1,"watch"===a&&b.endSearch(),f(function(){$(window).trigger("resize")})},e.viewMode&&f(function(){b.viewMode(e.viewMode)}),e.t&&k.startAtSpecificTime(e.t),b.toggleProducerPreview=function(){h.product="producer"===h.product?"player":"producer"},e.epId?(h.init(),h.episodeId=e.epId):b.narrativeId=e.narrativeId,h.isFramed&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)<151&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:"650px"}),"*");var q=function(){if(h.isFramed&&-1!==j.episodes[h.episodeId].templateUrl.indexOf("wiley")){var a=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(c){a=!1}if(a&&localStorage.removeItem("iCanHazStorage"),a&&!localStorage.getItem("noWileyNag")){h.show.wileyNag=!0;var d=b.$watch("appState.time",function(a){a&&(h.show.wileyNag=!1,d())})}b.noWileyNag=function(){h.show.wileyNag=!1,localStorage.setItem("noWileyNag","1")}}},r=d.$on("dataSvc.getEpisode.done",function(){r(),h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,j.setLanguageStrings(),q(),document.title=j.episodes[h.episodeId].display_title,i.getContainer(j.episodes[h.episodeId].container_id,h.episodeId).then(function(){if(j.episodes[h.episodeId].master_asset_id)var a=b.$watch(function(){return j.assets[j.episodes[h.episodeId].master_asset_id]},function(c){c&&Object.keys(c).length>1&&(a(),j.addEndingScreen(h.episodeId),k.init(h.episodeId),b.loading=!1)});else b.loading=!1,"producer"===h.product&&(h.editEpisode=j.episodes[h.episodeId],h.editEpisode.templateOpts=p.getTemplates("episode")),h.videoControlsActive=!0,h.videoControlsLocked=!0;"producer"!==h.productLoadedAs||n.userHasRole("admin")||n.userHasRole("customer admin")||(h.product="player",h.productLoadedAs="player")})});j.episodes[h.episodeId]?(h.lang=e.lang?e.lang.toLowerCase():j.episodes[h.episodeId].defaultLanguage,document.title=j.episodes[h.episodeId].display_title,j.episodes[h.episodeId].master_asset_id?k.init(h.episodeId):("producer"===h.product&&(h.editEpisode=j.episodes[h.episodeId]),h.videoControlsActive=!0,h.videoControlsLocked=!0),"producer"!==h.productLoadedAs||n.userHasRole("admin")||n.userHasRole("customer admin")||(h.product="player",h.productLoadedAs="player")):(b.loading=!0,j.addLandingScreen(h.episodeId),i.getEpisode(h.episodeId,h.episodeSegmentId)),b.appState=h,b.show=h.show,b.now=new Date,b.newWindowUrl=a.apiDataBaseUrl+"/v1/new_window",h.narrativeId?b.newWindowUrl=b.newWindowUrl+"?narrative="+h.narrativeId+"&timeline="+h.timelineId:b.newWindowUrl=b.newWindowUrl+"?episode="+h.episodeId,h.videoControlsActive=!1;var s,t,u=b.$watch(function(){return h.videoControlsActive},function(a){a&&(f.cancel(s),s=f(function(){t||(h.videoControlsActive=!1)},5e3))});b.showControls=function(){f.cancel(s),h.videoControlsActive=!0,h.isTouchDevice&&b.allowControlsExit()},b.allowControlsExit=function(){f.cancel(s),s=f(function(){h.videoControlsLocked||(h.videoControlsActive=!1)},5e3)},b.toggleSearchPanel=function(){h.show.searchPanel=!h.show.searchPanel,h.windowWidth<480?b.viewMode("review"):b.viewMode(h.show.searchPanel?"review":"discover"),h.searchText="",h.show.searchPanel?f(function(){document.getElementById("searchtext").focus()}):h.embedYTPlayerAvailable&&o.pauseOtherEmbeds()},b.endSearch=function(){h.searchText="",h.show.searchPanel=!1},b.toggleNavPanel=function(){k.pause(),h.show.navPanel=!h.show.navPanel},b.seek=function(a){k.seek(a,"sceneMenu"),h.show.navPanel=!1},b.pause=function(){k.pause()};var v=d.$on("video.firstPlay",function(){k.play()});b.hidePanel=function(a){h.show[a]=!1},b.hidePanels=function(){h.show.navPanel=!1,h.show.profilePanel=!1,h.itemDetail=!1,d.$emit("player.dismissAllPanels")},b.play=function(){k.play()},b["continue"]=function(){j.episodes[h.episodeId].masterAsset.duration-h.time<.2?(k.pause(),k.seek(j.episodes[h.episodeId].masterAsset.duration-.01)):k.play()},b.userHasRole=function(a){return n.userHasRole(a)},b.logout=function(){return n.logout()},h.isTouchDevice&&"review"===h.viewMode&&(h.autoscroll=!0);var w=$(window),x=$("html,body"),y=!1,z=function(){y||(y=g(B,400),w.bind("scroll",function(){x.stop(),A(),h.autoscrollBlocked=!0}))},A=function(){w.unbind("scroll"),g.cancel(y),y=!1};b.enableAutoscroll=function(){h.autoscrollBlocked&&(h.autoscrollBlocked=!1,z())};var B=function(){if(!h.autoscrollBlocked&&h.autoscroll){var a=1/0,b=w.scrollTop();if(angular.forEach($(".isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),a!==1/0){var c=180;a>b+c&&a-b<document.documentElement.clientHeight-c||c>a&&c>b||(A(),x.animate({scrollTop:a-c},1500),f(function(){z()},1750))}}};z();var C=d.$on("userKeypress.ESC",b.hidePanels);b.$on("$destroy",function(){u(),r(),v(),C()})}]),angular.module("com.inthetelling.story").controller("EpisodeController",function(){}),angular.module("com.inthetelling.story").controller("SceneController",["$scope","$filter","ittUtils",function(a,b,c){function d(){delete a.mainContentHasLeftSidebar,delete a.mainContentHasRightSidebar,delete a.mainContentHasBothSidebars,delete a.altContentHasLeftSidebar,delete a.altContentHasRightSidebar,delete a.altContentHasBothSidebars,a.showCurrent=$.inArray("showCurrent",a.scene.layouts)>-1,a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),$.inArray("splitRequired",a.scene.layouts)>-1?a.mainContentItems=b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?a.mainContentItems=b("transcriptandrequired")(a.contentItems):a.mainContentItems=b("annotation")(a.contentItems),$.inArray("splitRequired",a.scene.layouts)>-1?a.altContentItems=b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?a.altContentItems=b("optional")(a.contentItems):a.altContentItems=b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}function e(a){var b="templates/item/pullquote.html"===a.templateUrl,c="templates/item/pullquote-noattrib.html"===a.templateUrl,d="templates/item/text-h2.html"===a.templateUrl;return b||d||c?a:!1}function f(a,d){var e,f=b("isCurrent")(a),g=b(d)(f),h=1;if(g.length>0&&c.existy(g[0].asset)){var i="url("+g[0].asset.url+")";/Bg/.test(g[0].layoutCss)&&(h=.25);var j=g[0].styleCss.match(/cover|contain/);return j&&(e=j[0]),{"background-image":i,"background-size":e,opacity:h}}return""}a.byPullquoteOrH2=e,a.setBgImgUrl=f,a.precalculateSceneValues=d}]),angular.module("com.inthetelling.story").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)};var c={ENTER:13,SPACE:32};a.seekOnKeyPress=function(b,d){var e=d,f=!0;switch(e.keyCode){case c.ENTER:a.seek(b),f=!1;break;case c.SPACE:a.seek(b),f=!1;break;default:f=!0}f||(d.stopPropagation(),d.preventDefault())}}]),angular.module("com.inthetelling.story").controller("VideoController",["$q","$scope","$rootScope","$timeout","$interval","$window","$document","appState","timelineSvc","analyticsSvc","youTubePlayerManager",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){b.video.curStream=h.isTouchDevice?0:1,b.video.urls.youtube&&b.video.urls.youtube.length?(b.videoType="youtube",h.videoType=b.videoType,b.videoNode={id:b.video._id}):(b.videoType="video",h.videoType=b.videoType,b.videoNode=a.find("video")[0],q())}function m(){p()}function n(a){var c=a.data;0>c||(h.isTouchDevice&&h.hasBeenPlayed===!1?(k.pause(b.videoNode.id),i.play()):(b.playerState=E[parseInt(c,10)],"buffering"===b.playerState&&o(),"ended"===b.playerState&&k.stop(b.videoNode.id)))}function o(){if("playing"===h.timelineState&&!h.isIPhone){b.intentionalStall||j.captureEpisodeActivity("stall"),i.stall();var a=b.$watch(function(){return b.playerState},function(b){"buffering"!==b&&(a(),i.unstall())})}}function p(){i.registerVideo(b),b.$watch(function(){return k.getVideoLoadedFraction(b.videoNode.id)},function(a){a&&(h.bufferedPercent=100*k.getVideoLoadedFraction(b.videoNode.id))})}function q(){function a(){var a=b.currentTime();b.videoNode.pause(),b.video.curStream=0,j.captureEpisodeActivity("lowBandwidth"),d(function(){b.videoNode.load(),b.seek(a),b.videoNode.play()})}function c(){D=0,h.isIPhone||(B=e(function(){"playing"===h.timelineState?(b.lastPlayheadTime===b.currentTime()&&(b.intentionalStall||j.captureEpisodeActivity("stall"),i.stall(),b.intentionalStall||2!==D++||a()),b.lastPlayheadTime=b.currentTime()):"buffering"===h.timelineState&&b.lastPlayheadTime!==b.currentTime()&&(h.timelineState="playing",i.unstall())},333))}C.playing=b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),C.pause=b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1),c(),b.getBufferPercent=function(){if(b.videoNode.buffered.length>0){var a=b.videoNode.buffered.start(b.videoNode.buffered.length-1),c=b.videoNode.buffered.end(b.videoNode.buffered.length-1);return 0>c&&(c-=a,a=0),h.bufferedPercent=c/h.duration*100,h.bufferedPercent}return 0},i.registerVideo(b)}function r(){var c=a.defer();"youtube"===b.videoType?k.play(b.videoNode.id):(b.videoNode.play(),h.embedYTPlayerAvailable&&k.pauseEmbeds());var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise}function s(){if("youtube"===b.videoType)k.seekTo(b.videoNode.id,h.time,!0),k.pause(b.videoNode.id);else{b.videoNode.pause();try{b.videoNode.currentTime=h.time}catch(a){}}}function t(a){if("youtube"===b.videoType){var c;h.isTouchDevice&&h.hasBeenPlayed===!1?c=b.$watch(function(){return h.hasBeenPlayed},function(d){d&&(c(),k.seekTo(b.videoNode.id,a,!0))}):(b.setVolume(0),k.play(b.videoNode.id),c=b.$watch(function(){return E[k.playerState(b.videoNode.id)]},function(d){"playing"===d&&(c(),k.seekTo(b.videoNode.id,a,!0),k.pause(b.videoNode.id),b.setVolume(100))}))}else b.seek(a,!0)}function u(c,e,f){f=f||a.defer();var g=!1;e&&(b.intentionalStall=!0,b.stallGracePeriod=d(function(){b.intentionalStall=!1},1500));try{if("youtube"===b.videoType){var i="playing"===h.timelineState;k.pause(b.videoNode.id),k.seekTo(b.videoNode.id,c,!0),k.pause(b.videoNode.id),i&&k.play(b.videoNode.id),f.resolve()}else b.videoNode.readyState>1?(b.videoNode.currentTime=c,f.resolve()):(b.intentionalStall=!1,d.cancel(b.stallGracePeriod),g=!0)}catch(j){b.intentionalStall=!1,d.cancel(b.stallGracePeriod),g=!0}return g&&d(function(){b.seek(c,e,f)},100),f.promise}function v(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)}function w(){return"youtube"===b.videoType?k.getCurrentTime(b.videoNode.id):b.videoNode.currentTime}function x(){"youtube"===b.videoType?k.isMuted(b.videoNode.id)?k.unMute(b.videoNode.id):k.mute(b.videoNode.id):b.videoNode.muted=!b.videoNode.muted}function y(a){"youtube"===b.videoType?k.setVolume(b.videoNode.id,a):b.videoNode.volume=a/100}function z(){e.cancel(B),d.cancel(b.stallGracePeriod),i.unregisterVideo(),"youtube"===b.videoType?A&&(A=void 0):b.videoNode&&(b.videoNode.removeEventListener("playing",C.playing),b.videoNode.removeEventListener("pause",C.pause),b.videoNode.pause(),b.videoNode.src="",b.videoNode.remove(),delete b.videoNode)}angular.extend(b,{initVideo:l,intentionalStall:!1,play:r,pause:s,startAtTime:t,seek:u,setSpeed:v,currentTime:w,toggleMute:x,setVolume:y,playerStateChange:n,onReady:m});var A,B,C={},D=0,E={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued"};b.$on("$destroy",z)}]),angular.module("com.inthetelling.story").controller("SearchPanelController",["$scope","$rootScope","$timeout","timelineSvc","modelSvc","appState",function(a,b,c,d,e,f){a.sortBy="startTime",a.toggleSortBy=function(b){a.sortBy=g(b),f.autoscroll="startTime"===a.sortBy},a.getToggledValue=function(a){return g(a)};var g=function(a){return"startTime"===a?"type":"startTime"};a.getFriendlySortText=function(a){return"startTime"===a?"time":"type"},a.indexed=!1,a.indexEvents=function(){if(!a.episode.items)return c(function(){a.indexEvents()},300),!1;a.indexed=!0,a.typeCategories=["transcript","annotation","file","image","link","video","question","other"],a.showTypes={transcript:{name:"Transcript",items:[]},annotation:{name:"Annotations",items:[]},file:{name:"Files",items:[]},image:{name:"Images",items:[]},link:{name:"Links",items:[]},video:{name:"Videos",items:[]},question:{name:"Questions",items:[]},other:{name:"Other",items:[]}};var b=function(a,b){return Array(Math.max(b-(parseInt(a,10)+"").length+1,0)).join(0)+a};angular.forEach(a.episode.items,function(c){c.wtfchromesort=b(c.start_time,5),"producer"!==f.product&&c.cosmetic||"Scene"!==c._type&&(c.producerItemType&&a.showTypes[c.producerItemType]?a.showTypes[c.producerItemType].items.push(c):a.showTypes.other.items.push(c),"annotation"===c.producerItemType&&(c.showAsHeader=!c.templateUrl.match(/(transmedia|definition)/)))})},b.$on("searchReindexNeeded",a.indexEvents)}]),function(){function a(a,b){a.narrativeResolve=b.n,a.customersResolve=b.c}angular.module("com.inthetelling.story").controller("NarrativeCtrl",a),a.$inject=["$scope","narrativeResolve"]}(),function(){function a(a,b,c){function d(){b.logout()}a.narrativesResolve=c.n,a.customersResolve=c.c,a.logout=d}angular.module("com.inthetelling.story").controller("NarrativesCtrl",a),a.$inject=["$scope","authSvc","narrativesResolve"]}(),angular.module("com.inthetelling.story").controller("EditController",["$q","$scope","$rootScope","$timeout","$window","selectService","appState","dataSvc","modelSvc","timelineSvc","authSvc","MIMES",function(a,b,c,d,e,f,g,h,i,j,k,l){b.uneditedScene=angular.copy(b.item),b.userHasRole=k.userHasRole,b.canAccess=k.userHasRole("admin")||k.userHasRole("customer admin"),b.selectService=f,b.item&&l[b.item.producerItemType]?b.mimes=l[b.item.producerItemType]:b.mimes=l["default"],b.chooseAsset=function(a){a=a||"",b.showAssetPicker=!0,b.w1=c.$on("UserSelectedAsset",function(c,d){"Poster"===a?b.attachPosterAsset(d):b.attachChosenAsset(d),b["showUploadButtons"+a]=!1,b.endChooseAsset()}),b.w2=c.$on("userKeypress.ESC",b.endChooseAsset)},b.endChooseAsset=function(){b.w1(),b.w2(),b.showAssetPicker=!1},b.toggleUpload=function(a){a=a||"",b["showUploadField"+a]=!b["showUploadField"+a]},b.addDistractor=function(){b.item.data._plugin.distractors.push({text:"",index:b.item.data._plugin.distractors.length+1})};var m=function(a){return angular.forEach(t(),function(b){return b.start_time===a?!0:void 0}),!1};b.addEvent=function(a){if("scene"===a&&m(g.time))return b.editCurrentScene();var d=B(a);d.cur_episode_id=g.episodeId,d.episode_id=g.episodeId,g.user&&g.user.avatar_id&&(d.avatar_id=g.user.avatar_id),i.cache("event",d),g.editEvent=i.events["internal:editing"],g.videoControlsActive=!0,g.videoControlsLocked=!0,i.resolveEpisodeEvents(g.episodeId),j.injectEvents([i.events["internal:editing"]]),"scene"===a&&(f.onSelectChange(g.editEvent),j.updateSceneTimes(g.episodeId)),c.$emit("searchReindexNeeded")};var n=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1},o=function(){var a=i.episodes[g.episodeId],b=angular.copy(a.items);return b.filter(n)},p=function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=d;break}return c},q=function(a,b){a=a.sort(z);var c=p(a,b),d=[];return 0===c?d:(c<a.length-1&&c>=1&&(u(a[c-1])||d.push(a[c-1])),d)},r=function(a,b){a=a.sort(z);var c=p(a,b),d=[];return 0===c?c<a.length-1&&(u(a[c+1])||d.push(a[c+1])):c<a.length-1&&(u(a[c+1])||d.push(a[c+1]),c>=1&&(u(a[c-1])||d.push(a[c-1]))),d},s=function(a,b,c){if(n(a)){var d=[],e=o();switch(b){case"create":d=r(e,a);break;case"delete":d=q(e,a);break;case"update":c&&s(c,"delete"),s(a,"create")}angular.forEach(d,function(a){h.storeItem(a).then(function(){},function(){})})}};b.saveEvent=function(){var a=angular.copy(g.editEvent);if(b.blockDoubleClicks=!0,a.cur_episode_id=g.episodeId,"Scene"===a._type){var d=A(a);angular.forEach(d,function(a){h.storeItem(a).then(function(){},function(){})})}h.storeItem(a).then(function(b){b.cur_episode_id=g.episodeId,"internal:editing"===g.editEvent._id?(j.removeEvent("internal:editing"),delete i.events["internal:editing"],i.cache("event",h.resolveIDs(b)),i.resolveEpisodeEvents(g.episodeId),j.injectEvents([i.events[b._id]]),s(b,"create")):(i.resolveEpisodeEvents(g.episodeId),j.updateEventTimes(i.events[b._id]),s(b,"update")),angular.forEach(a.removedAssets,function(a){h.deleteAsset(a)}),g.editEvent=!1,c.$emit("searchReindexNeeded")},function(){})};var t=function(){return i.episodes[g.episodeId].scenes},u=function(a){return a._id&&a._id.match(/internal/)};b.getItemsAfter=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)u(a[d])||(b<a[d].start_time||b<a[d].end_time)&&c.push(a[d]);return c},b.saveEpisode=function(){var a=angular.copy(g.editEpisode);h.storeEpisode(a).then(function(c){if(i.cache("episode",h.resolveIDs(c)),g.editEpisode._master_asset_was_changed){delete i.episodes[c._id]._master_asset_was_changed;var f=i.assets[c.master_asset_id].duration,k=f-.01;i.episodes[g.episodeId].masterAsset=i.assets[b.episode.master_asset_id],i.episodes[g.episodeId].master_asset_id=c.master_asset_id;var l=[],m=[],n=i.episodes[a._id];angular.forEach(n.scenes,function(a){a.start_time>f?m.push(a):a.end_time>f&&(a.end_time=k,l.push(a))}),angular.forEach(n.items,function(a){a.start_time>f&&(a.start_time=k),a.end_time>f&&(a.end_time=k),l.push(a)});var o=i.events["internal:endingscreen:"+a._id];o?(o.start_time=k,o.end_time=k):i.addEndingScreen(a._id),i.resolveEpisodeEvents(g.episodeId),i.resolveEpisodeAssets(g.episodeId),g.duration=f,g.editEpisode=!1,g.videoControlsLocked=!1,j.init(g.episodeId),angular.forEach(l,function(a){a._id.indexOf("internal")<0&&h.storeItem(a)}),angular.forEach(m,function(a){a._id.indexOf("internal")<0&&h.deleteItem(a._id)}),d(function(){e.location.reload()},500)}else i.resolveEpisodeEvents(g.episodeId),i.resolveEpisodeAssets(g.episodeId),g.editEpisode=!1,g.videoControlsLocked=!1},function(){})};var v=function(a,b){for(var c=0;c<a.length;c++){if(void 0===a[c]._id||"internal:editing"===a[c]._id){a.splice(c,1);break}if(b&&a[c]._id===b._id){a[c]=b;break}}return a},w=function(a,b){for(var c=1,d=a.length;d>c;c++)c===d-1?a[c].end_time=b:a[c].end_time!==a[c+1].start_time&&(a[c].end_time=a[c+1].start_time)},x=function(a,b){for(var c=!1,d=0,e=a.length;e>d;d++)if(a[d]._id===b._id){c=!0;break}c||a.push(b)},y=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]._id===b){a.splice(c,1);break}},z=function(a,b){return a.start_time-b.start_time},A=function(a,c){var d=g.duration,e=angular.copy(t()),f=[];c?x(e,b.uneditedScene):v(e,b.uneditedScene),e=e.sort(z),w(e,d),y(e,a._id),c||e.push(a),e=e.sort(z);for(var h=1,i=e.length;i>h;h++)h===i-1?e[h].end_time!==d&&(e[h].end_time=d,f.push(e[h])):e[h].end_time!==e[h+1].start_time&&(e[h].end_time=e[h+1].start_time,f.push(e[h]));return f};b.editCurrentScene=function(){angular.forEach(t(),function(a){a.isCurrent&&(g.editEvent=i.events[a._id],g.editEvent.templateOpts=f.getTemplates("scene"),g.editEvent.cur_episode_id=g.episodeId,g.editEvent.episode_id=g.episodeId,g.editEvent.producerItemType="scene",g.videoControlsActive=!0,g.videoControlsLocked=!0,f.onSelectChange(g.editEvent))})},b.editEpisode=function(){g.editEpisode=i.episodes[g.episodeId],g.editEpisode.templateOpts=f.getTemplates("episode"),g.videoControlsActive=!0,g.videoControlsLocked=!0},b.deleteEvent=function(a){if(window.confirm("Are you sure you wish to delete this item?")){var b={};b._id=a;var c=i.events[a]._type;if("Scene"===c){var d=A(b,!0);angular.forEach(d,function(a){h.storeItem(a).then(function(){},function(){})})}h.deleteItem(a).then(function(){"sxs"===g.product&&i.events[a].asset&&h.deleteAsset(i.events[a].asset._id),j.removeEvent(a),delete i.events[a],i.resolveEpisodeEvents(g.episodeId),("Scene"===c||"Chapter"===c)&&j.updateSceneTimes(g.episodeId),s(b,"delete"),g.editEvent=!1,g.videoControlsLocked=!1},function(){})}},b.cancelEventEdit=function(a){var b=a.cur_episode_id?a.cur_episode_id:a.episode_id;"internal:editing"===g.editEvent._id?(delete i.events["internal:editing"],j.removeEvent("internal:editing")):i.events[g.editEvent._id]=a,i.resolveEpisodeEvents(b),"Scene"===a._type?j.updateSceneTimes(b):j.updateEventTimes(a),g.editEvent=!1,g.videoControlsLocked=!1},b.cancelEpisodeEdit=function(a){i.episodes[g.episodeId]=a,i.deriveEpisode(i.episodes[a._id]),i.resolveEpisodeContainers(a._id),i.resolveEpisodeEvents(a._id),g.editEpisode=!1,g.videoControlsLocked=!1};var B=function(a){var b={_id:"internal:editing",start_time:g.time,episode_id:g.episodeId,isCurrent:!0,producerItemType:a,layouts:["inline"],styles:[]},c={};if("scene"===a&&(c={_type:"Scene",title:{},description:{},templateOpts:f.getTemplates(a)}),"chapter"===a&&(c={_type:"Chapter",title:{},description:{}}),"video"===a&&(c={_type:"Link",link_image_id:"",url:"",title:{},description:{},templateOpts:f.getTemplates(a)}),("comment"===a||"transcript"===a||"annotation"===a)&&(c={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:"",templateOpts:f.getTemplates(a)}),("file"===a||"image"===a)&&(c={_type:"Upload",asset_id:"",title:{},description:{},templateOpts:f.getTemplates(a)}),"link"===a&&(c={_type:"Link",link_image_id:"",url:"https://",title:{},description:{},templateOpts:f.getTemplates(a)}),"question"===a&&(c={_type:"Plugin",title:{},templateOpts:f.getTemplates(a),data:{_pluginType:"question",_version:2,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{index:1,text:""},{index:2,text:""},{index:3,text:""},{index:4,text:""}],correctfeedback:"",incorrectfeedback:""}}},c.plugin=c.data._plugin),"sxs"===g.product)c.sxs=!0,c.annotator={en:g.user.name},c.layouts=["windowFg"],c.end_time=g.time,c.stop=!0,c.templateUrl="templates/item/sxs-"+a+".html";else{var d={scene:"templates/scene/centered.html",transcript:"templates/item/transcript-withthumbnail.html",annotation:"templates/item/text-h2.html",link:"templates/item/link.html",image:"templates/item/image-plain.html",file:"templates/item/file.html",question:"templates/item/question-mc-image-right.html",video:"TODO:VIDEO"};c.templateUrl=d[a]}return angular.extend(b,c),b}}]),angular.module("com.inthetelling.story").controller("EventTestController",["$scope","$routeParams","mockSvc","modelSvc","appState",function(a,b,c,d,e){c.mockEpisode("ep1"),e.episodeId="ep1",e.product="producer",e.lang="en",a.item=d.events[b.eventId]}]),angular.module("com.inthetelling.story").directive("ittLogin",["$location","$routeParams","config","authSvc","appState","errorSvc",function(a,b,c,d,e,f){return{restrict:"A",replace:!1,link:function(g){g.userHasRole=d.userHasRole,g.appState=e,g.loginForm={auth_key:"",password:""},g.apiDataBaseUrl=c.apiDataBaseUrl,d.authenticate().then(function(){if(f.init(),b.key&&a.search("key",null),b.episode){var c=b.episode;a.search("episode",null),a.search("nonce",null),a.path("/episode/"+c)}else if(b.narrative){var d=b.narrative;if(a.search("narrative",null),a.search("nonce",null),b.timeline){var e=b.timeline;a.search("timeline",null),a.path("/story/"+d+"/"+e)}else a.path("/story/"+d)}else 0===Object.keys(b).length&&a.path("/account")},function(){}),g.adminLogin=function(){d.adminLogin(g.loginForm.auth_key,g.loginForm.password).then(function(){a.path("/projects")})["catch"](function(){g.badlogin=!0})},g.logout=function(){d.logout()}}}}]),angular.module("com.inthetelling.story").directive("autofocus",["$timeout",function(a){return{link:function(b,c){a(function(){"TEXTAREA"===c[0].tagName||"INPUT"===c[0].tagName?c[0].focus():c.find("input,textarea")[0].focus()})}}}]),angular.module("com.inthetelling.story").directive("ittMcQuestion",["questionAnswersSvc","analyticsSvc","appState",function(a,b,c){return{restrict:"E",replace:!1,scope:{plugin:"=data",qid:"=",choices:"=",correct:"=",onChoice:"=",questionType:"@",showChart:"="},templateUrl:"templates/item/question-mc-inner.html",link:function(d){d.scoreQuiz=function(a){d.plugin.distractors[a].selected=!0,d.plugin.hasBeenAnswered=!0,d.plugin.selectedDistractor=d.plugin.distractors[a].index,b.captureEventActivity("question-answered",d.qid,{answer:d.plugin.distractors[a].text,index:d.plugin.distractors[a].index,correct:!!d.plugin.distractors[a].correct})},d.feedback=function(){for(var a=0;a<d.plugin.distractors.length;a++)if(d.plugin.distractors[a].index===d.plugin.selectedDistractor)return d.plugin.distractors[a].correct?d.plugin.correctfeedback:d.plugin.incorrectfeedback},d.questionType=d.plugin.questiontype,d.chartOptions={};var e=function(a){var b=[];for(var e in a)a.hasOwnProperty(e)&&angular.forEach(d.plugin.distractors,function(d){if(d.index+""==e+""){var f=d.text;"object"==typeof f&&(f=f[c.lang]||f.en||""),b.push({data:a[e],label:f})}});return b};if(d.plugin.hasBeenAnswered===!0){void 0===d.plugin.answer_counts&&(d.plugin.answer_counts={});var f=d.plugin.answer_counts,g=e(f);d.chartData=g}d.scorePoll=function(b){a.saveAnswer("question-answered",d.qid,{answer:d.plugin.distractors[b].text,index:d.plugin.distractors[b].index,correct:!!d.plugin.distractors[b].correct}).then(function(){d.plugin.answer_counts=void 0===d.plugin.answer_counts?{}:d.plugin.answer_counts,a.incrementAnswerCount(d.plugin.answer_counts,d.plugin.distractors[b].index);var c=d.plugin.answer_counts,f=e(c);d.chartData=f,d.plugin.distractors[b].selected=!0,d.plugin.hasBeenAnswered=!0,d.plugin.selectedDistractor=d.plugin.distractors[b].index})}}}}]),angular.module("com.inthetelling.story").directive("ittFlotr2Chart",function(){var a=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:'<div class="flotContainer"><div class="chartContainer" id="chartContainer" aria-label="{{chartLabel}}"></div><div class="legendContainer" id="legendContainer"></div></div>',link:function(b,c,d){var e=function(a,c,d){b.chartLabel=k(c),$.plot(a,c,d),a.show()},f=$("#chartContainer");f.attr("id","chartContainer"+a);var g=$("#legendContainer");g.attr("id","legendContainer"+a++);var h=function(a,b){return Math.round(b.percent)+"% ("+b.data[0][1]+"): "+a},i=function(a,b){return'<div style="padding: 3px; font-size: 80%">'+Math.round(b.percent)+"%</div>"};b.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.7},formatter:i}}},legend:{show:!0,labelFormatter:h,noColumns:1,position:"sw",margin:0,backgroundColor:null,backgroundOpacity:1,sorted:"descending",container:g},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}},b.$watch(function(){return f.width()},function(a){a>0&&(f.css({height:a}),e(f,JSON.parse(b.data),b.chartOptions),b.observeData=d.$observe("data",function(a){b.data=JSON.parse(a),e(f,b.data,b.chartOptions)}),b.$on("$destroy",b.observeData))});var j=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].data;for(var d=0;d<a.length;d++)a[d].percent=a[d].data/b*100;return a},k=function(a){var b="";a=j(a);for(var c=0;c<a.length;c++)b+=Math.round(a[c].percent)+"% of users totaling "+a[c].data+" choose '"+a[c].label+"'. ";return b}}}}),angular.module("com.inthetelling.story").directive("ittTimeline",["$rootScope","$timeout","appState","timelineSvc","modelSvc",function(a,b,c,d,e){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline-story.html",controller:"TimelineController",link:function(a,f){function g(a){return a>98?100:a}function h(a){return 3>a?0:a}function i(b){var c=a.currentVolume()+b;c=g(c),"function"==typeof a.setVolume&&a.setVolume(c)}function j(b){var c=a.currentVolume()-b;c=h(c),"function"==typeof a.setVolume&&a.setVolume(c)}a.appState=c,a.timeline=d,a.handlePosition=0,a.zoomLevel=1,a.zoomOffset=0,c.isTouchDevice&&!c.hasBeenPlayed&&(a.isSuppressed=!0);var k,l,m=a.$watch(function(){return c.hasBeenPlayed},function(b){b===!0&&(a.isSuppressed=!1,m())});b(function(){k=f.find(".progressbarContainer"),l=f.find(".progressbar"),u()}),a.autoZoom=function(b){a.savedZoomLevel=a.zoomLevel;var d=b.end_time-b.start_time,e=c.duration-b.end_time;a.zoomLevel=Math.min(Math.max(Math.round(.6*e/d),1),20),p()},a.endAutoZoom=function(){
a.savedZoomLevel&&(a.zoomLevel=a.savedZoomLevel,p(),delete a.savedZoomLevel)};var n=a.$watch(function(){return c.editEvent},function(b){"producer"===c.product&&(b?a.autoZoom(b):a.endAutoZoom())});a.appState=c,a.setNewLanguage=function(){e.setLanguageStrings()},a.showSceneMenuTooltip=function(b){b&&!c.isTouchDevice?a.sceneMenuToolTip=!0:a.sceneMenuToolTip=!1},a.prevScene=function(){d.prevScene()},a.nextScene=function(){d.nextScene()},a.userChangingVolume=function(b){c.muted&&a.toggleMute();var d=angular.element(b.currentTarget),e=function(b,c){var e=(b.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),c?a.setVolume(e):a.$apply(a.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})};var o={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};a.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case o.LEFTARROW:j(1),c=!1;break;case o.RIGHTARROW:i(1),c=!1;break;case o.UPARROW:i(1),c=!1;break;case o.DOWNARROW:j(1),c=!1;break;case o.PAGEUP:i(10),c=!1;break;case o.PAGEDOWN:j(10),c=!1;break;case o.HOME:j(100),c=!1;break;case o.END:i(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},a.currentVolume=function(){return c.muted?0:c.volume},a.audioIcon=function(){return c.muted?"muted":"vol"+Math.floor(c.volume/34)},a.showTooltip=function(a){a.showTooltip=!0},a.hideTooltip=function(a){a.showTooltip=!1},a.zoomIn=function(){a.stopWatching=!0,a.zoomLevel=a.zoomLevel+1,p()},a.zoomOut=function(){a.stopWatching=!0,a.zoomLevel<=2?a.zoomLevel=1:a.zoomLevel<=3?a.zoomLevel=1.5:a.zoomLevel=a.zoomLevel/2,p()};var p=function(){a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),k.stop().animate({left:100*a.zoomOffset+"%",width:100*a.zoomLevel+"%"},1e3,function(){a.stopWatching=!1})};a.$watch(function(){return{t:c.time,d:c.duration}},function(){a.stopWatching||(a.zoomOffset=-((a.zoomLevel-1)*(c.time/c.duration)),k&&k.css({left:100*a.zoomOffset+"%"}))},!0);var q=function(d){b(function(){a.seekHandleVisible=!0},250),a.isSeeking=!0;var e=c.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(e,function(){s()}),angular.element(document).bind(e,function(){t()}),r(d)};a.$watch(function(){return c.time},function(){c.editEvent&&(a.willSeekTo=c.time)});var r=function(b){a.isSeeking&&(a.willSeekTo=(b.clientX-k.offset().left)/k.width()*c.duration,a.willSeekTo<0&&(a.willSeekTo=0),a.willSeekTo>c.duration&&(a.willSeekTo=c.duration))},s=function(){a.stopWatching=!0,a.enableAutoscroll(),d.seek(a.willSeekTo,"scrubTimeline"),p()},t=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),b(function(){a.isSeeking=!1,a.seekHandleVisible=!1})},u=function(){var a=$(f.find(".playhead"));c.isTouchDevice?(a.on("touchstart.timeline",function(a){q(a.originalEvent.targetTouches[0]),a.preventDefault()}),a.on("touchmove.timeline",function(a){r(a.originalEvent.targetTouches[0]),a.preventDefault()})):(a.on("mousedown.timeline",function(a){q(a),a.preventDefault()}),a.on("mousemove.timeline",function(a){r(a),a.preventDefault()}))};a.$on("$destroy",function(){t(),n()})}}}]),angular.module("com.inthetelling.story").directive("ittEpisode",["$interval","analyticsSvc","modelSvc","appState",function(a,b,c,d){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(e){e.episode=c.episodes[d.episodeId],b.captureEpisodeActivity("episodeLoad");var f=function(){e.episode=c.episodes[d.episodeId],null!=e.episode&&(d.playerTemplate=e.episode.templateUrl)};a(f,457)}}}]),angular.module("com.inthetelling.story").directive("ittScene",["$timeout","$interval","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl"></span>',controller:"SceneController",link:function(a,d){function e(a){var b={centered:"templates/scene/centered.html",centeredPro:"templates/scene/centeredPro.html","1col":"templates/scene/1col.html","2colL":"templates/scene/2colL.html","2colR":"templates/scene/2colR.html",mirroredTwoCol:"templates/scene/mirrored-twocol.html",cornerV:"templates/scene/cornerV.html",centerVV:"templates/scene/centerVV.html",centerVVMondrian:"templates/scene/centerVV-Mondrian.html",cornerH:"templates/scene/cornerH.html",pip:"templates/scene/pip.html"};return Object.keys(b).filter(function(c){return b[c]===a})[0]}function f(){a.scene&&(c.currSceneName=e(a.scene.templateUrl),c.sceneLayouts=a.scene.layouts)}"review"!==c.viewMode&&window.scrollTo(0,0),a.precalculateSceneValues(),a.appState=c,f();var g=function(){var b=d.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return d.find(".videoMagnet img").height()},function(a){a>0&&(c(),g())});else{d.find(".matchVideoHeight:visible").each(function(){$(this).css("height",d.find(".videoMagnet img").height())});var e=angular.element(window).height()-$("#CONTAINER").scrollTop();d.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",e-$(this).offset().top)}),d.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",e-$(this).offset().top-210)})}d.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&g()},!0),a.unwatchEdits=a.$watch(function(){return c.editEvent},a.precalculateSceneValues,!0),a.safetyBelt=b(g,1321),a.$on("$destroy",function(){a.unwatch(),a.unwatchEdits(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.story").directive("ittShowHideVisualOnly",["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ittShowHideVisualOnly,function(b){b?a.removeClass(c,"visual-hide"):a.addClass(c,"visual-hide")})}}}]),angular.module("com.inthetelling.story").animation(".visual-hide",function(){return{addClass:function(a){a.fadeTo("slow",0,function(){})},removeClass:function(a){a.fadeTo("slow",1,function(){})}}}),angular.module("com.inthetelling.story").directive("ittShowFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.ittShowFocus,function(b){a(function(){b&&c.filter(":visible").first().focus()})},!0)}}]),function(){function a(){return{scope:!0,templateUrl:"templates/toolbar-story.html"}}angular.module("com.inthetelling.story").directive("ittToolbarStory",a)}(),angular.module("com.inthetelling.story").directive("ittVolumeSlider",["appState",function(a){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(b){function c(a){return a>98?100:a}function d(a){return 3>a?0:a}function e(a){var d=b.currentVolume()+a;d=c(d),"function"==typeof b.setVolume&&b.setVolume(d)}function f(a){var c=b.currentVolume()-a;c=d(c),"function"==typeof b.setVolume&&b.setVolume(c)}b.appState=a,b.userChangingVolume=function(a){var c=angular.element(a.currentTarget),d=function(a,d){var e=(a.clientX-c.offset().left)/c.width()*100;e>98&&(e=100),3>e&&(e=0),d?b.setVolume(e):b.$apply(b.setVolume(e))};d(a,!0),c.bind("mousemove.volume",d),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),c.unbind("mousemove.volume")})};var g={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};b.onVolumeKeyDown=function(a){var b=a,c=!0;switch(b.keyCode){case g.LEFTARROW:f(1),c=!1;break;case g.RIGHTARROW:e(1),c=!1;break;case g.UPARROW:e(1),c=!1;break;case g.DOWNARROW:f(1),c=!1;break;case g.PAGEUP:e(10),c=!1;break;case g.PAGEDOWN:f(10),c=!1;break;case g.HOME:f(100),c=!1;break;case g.END:e(100),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},b.currentVolume=function(){return a.muted?0:a.volume}}}}]),function(){function a(a,b){function c(c,d,e){function f(){var a=m.height()-h;d.css("height",a),m.css("overflow-y","hidden"),i=c.$watch(function(){return m.height()},function(a,b){if(a!==b){var c=a-h;d.css("height",c)}})}function g(){var c="templates/episode/narrasys-pro.html",f="templates/episode/career-playbook.html",g=b.isYoutubeUrl(e.src);"discover"!==a.viewMode||a.playerTemplate!==c&&a.playerTemplate!==f||a.isTouchDevice||g||d.css("height",o)}var h=95,i=angular.noop,j=75,k=145,l=j+k,m=$(".w-modal"),n=$(".modal"),o=$(window).height()-l;n.length>0&&a.isTouchDevice&&(c.iframeCtrl.styles={height:o+"px"},d.css("height",o),c.$watch(function(){return d.height()},function(a,b){a!==b&&(c.iframeCtrl.styles={height:a+"px"},d.css("height",o))})),m.length>0?f():g(),c.$on("$destroy",function(){i()})}return{restrict:"E",scope:{src:"@",contenttype:"@",item:"&"},replace:!0,templateUrl:"templates/iframe.html",controller:"ittIframeCtrl",controllerAs:"iframeCtrl",bindToController:!0,link:c}}function b(a,b,c,d){function e(a){return c.isYoutubeUrl(a)?(f.isYoutube=!0,f.isLoading=!1,!0):b.isValidURL(a)?(f.isLoading=!1,f.isYoutube=!1,!0):(f.isLoading=!0,!1)}var f=this,g="allow-forms allow-same-origin allow-scripts",h=" allow-top-navigation allow-popups";f.isYoutube=!1,f.isLoading=!0,f.isTouchDevice=d.isTouchDevice,f.isTouchDevice&&/inthetelling.com\/#/.test(f.src)&&(f.iOSScroll="no"),f.watcher=a.$watchGroup([function(){return f.src},function(){return f.contenttype}],function(){f.src&&e(f.src)&&(f.contenttype?f.sandbox="text/html"===f.contenttype?g:void 0:(f.sandbox=g,f.src.match(/.pdf$/)&&delete f.sandbox,f.src.match(/inthetelling.com\/#/)&&(f.sandbox+=h),f.src.match(/inthetelling.com\/#/)&&-1===f.src.indexOf("?")&&(f.src+="?embed=1"),f.src.match(/amazonaws.com\/itt/i)&&delete f.sandbox))}),a.$on("$destroy",function(){f.watcher()})}angular.module("com.inthetelling.story").directive("ittIframe",a).controller("ittIframeCtrl",b),a.$inject=["appState","youtubeSvc"],b.$inject=["$scope","ittUtils","youtubeSvc","appState"]}(),function(){function a(){return{scope:!0,templateUrl:"templates/loading.html"}}angular.module("com.inthetelling.story").directive("ittLoading",a)}(),angular.module("com.inthetelling.story").directive("ittWidthWatch",function(){return{restrict:"A",replace:!1,link:function(a,b){var c=a.$watch(function(){return b.width()},function(b){a.isNarrow=450>b});a.$on("$destroy",c)}}}),angular.module("com.inthetelling.story").directive("ittReviewMode",["appState","$timeout",function(a,b){return{restrict:"A",replace:!1,scope:{allScenes:"=ittReviewMode"},templateUrl:"templates/episode/components/reviewmode-scenes.html",link:function(c){c.appState=a,c.scenes=[];var d=100,e=0;c.isLoading=!0;var f=[1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1/0];c.addOne=function(){if(e++,c.allScenes)c.scenes=c.allScenes.slice(0,f[e]),e<c.allScenes.length?b(c.addOne,d):(c.isLoading=!1,c.scenes=c.allScenes);else var a=c.$watch(function(){return c.allScenes},function(){c.allScenes&&(a(),c.addOne())})},b(c.addOne,d)}}}]),angular.module("com.inthetelling.story").directive("ittItem",["$http","$timeout","$interval","config","authSvc","appState","analyticsSvc","timelineSvc","modelSvc","youtubeSvc","youTubePlayerManager","selectService",function(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(m,n){m.appState=f,m.userHasRole=e.userHasRole,m.item.avatar_id&&(m.item.avatar=i.assets[m.item.avatar_id]),"internal:editing"===m.item._id?n.addClass("noTransitions"):(e.userHasRole("admin")||e.userHasRole("customer admin")||m.item.user_id===f.user._id)&&(m.item.editableByThisUser=!0),m.toggleDetailView=function(){m.item.showInlineDetail?m.item.showInlineDetail=!1:(h.pause(),m.captureInteraction(),n.width()>450?m.item.showInlineDetail=!0:f.itemDetail={item:m.item,animate:!0})};var o={ENTER:13,SPACE:32};if(m.toggleDetailOnKeyPress=function(a){var b=a,c=!0;switch(b.keyCode){case o.ENTER:m.toggleDetailView(),c=!1;break;case o.SPACE:m.toggleDetailView(),c=!1;break;default:c=!0}c||(a.stopPropagation(),a.preventDefault())},m.forceModal=function(a){void 0===a&&(a=!0),h.pause(),f.itemDetail={item:m.item,animate:a}},m.outgoingLinkOnKeyPress=function(a,b){var c=b,d=!0;switch(c.keyCode){case o.ENTER:m.outgoingLink(a),d=!1;break;case o.SPACE:m.outgoingLink(a),d=!1;break;default:d=!0}d||(b.stopPropagation(),b.preventDefault())},m.outgoingLink=function(a){if(h.pause(),m.captureInteraction(),a.match(/youtube/)&&(a=j.embeddableYoutubeUrl(a,!1),f.embedYTPlayerAvailable)){k.pauseOtherEmbeds();var c=Math.floor(k.getCurrentTime(m.item._id));c>0&&(a+="&start="+c)}m.item.targetTop?b(function(){window.location.href=a}):window.open(a)},m.editItem=function(){f.editEvent=m.item,f.editEvent.templateOpts=l.getTemplates(m.item.producerItemType),l.onSelectChange(f.editEvent,{}),f.videoControlsActive=!0,f.videoControlsLocked=!0},m.captureInteraction=function(){g.captureEventActivity("clicked",m.item._id)},"templates/item/link-embed.html"===m.item.templateUrl)var p=m.$watch(function(){return f.time>m.item.start_time},function(a){a&&(m.captureInteraction(),p())});if(m.item.asset_id&&!m.item.asset&&(m.item.asset=i.assets[m.item.asset_id]),m.item.asset&&m.item.styleCss&&m.item.styleCss.match(/fill|contain|cover/)&&(m.item.asset.cssUrl="url('"+m.item.asset.url+"');",m.item.backgroundImageStyle="background-image: url('"+m.item.asset.url+"');"),m.item.data&&(m.plugin=m.item.data._plugin,m.plugin._type=m.item.data._pluginType,"credlyBadge"===m.plugin._type)){g.captureEventActivity("viewed",m.item._id),f.user.roles&&1===f.user.roles.length&&"guest"===f.user.roles[0]?m.plugin.eligibleForBadges=!1:(m.plugin.eligibleForBadges=!0,f.user.emails?m.plugin.userEmail=f.user.emails[0]:m.plugin.userEmail="",m.plugin.totalAchieved=0),m.checkBadgeEligibility=function(){m.plugin.eligibleForBadges&&angular.forEach(m.plugin.requirements,function(a){a.achieved||g.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,m.countAchievements()}),m.countAchievements()})},m.countAchievements=function(){var a=0;angular.forEach(m.plugin.requirements,function(b){b.achieved&&(a+=1)}),m.plugin.totalAchieved=a,m.plugin.totalAchieved===m.plugin.requirements.length&&(i.episodes[f.episodeId].styleCss=i.episodes[f.episodeId].styleCss+" uscHackUserHasBadge")},m.checkBadgeEligibility();var q=0;m.badgePoll=c(function(){q++,(m.item.isCurrent||"review"===f.viewMode)&&m.checkBadgeEligibility(),q>60&&c.cancel(m.badgePoll)},1e4),m.$on("$destroy",function(){c.cancel(m.badgePoll)}),m.badger=function(){m.plugin.gettingBadge=!0,a({method:"GET",url:d.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+m.plugin.credlyBadgeId+"&email="+m.plugin.userEmail}).success(function(a){m.checkBadgeEligibility(),"Badge previously sent."===a.status&&(m.plugin.alreadyHadBadge=!0),m.plugin.gotBadge=!0}).error(function(){m.plugin.gettingBadge=!1,m.plugin.error=!0})}}}}}]),angular.module("com.inthetelling.story").directive("ittItemDetailModal",ittItemDetailModal),ittItemDetailModal.$inject=["appState"],angular.module("com.inthetelling.story").directive("ittEpisodeEditor",["$rootScope","appState","errorSvc","modelSvc","dataSvc","awsSvc","youtubeSvc","authSvc",function(a,b,c,d,e,f,g,h){return{restrict:"A",replace:!0,scope:{episode:"=ittEpisodeEditor"},templateUrl:"templates/producer/episode.html",controller:"EditController",link:function(c){c.episodeContainerId=d.episodes[b.episodeId].container_id;var f=d.containers[c.episodeContainerId];if(c.customer=d.customers[f.customer_id],c.episode.master_asset_id&&""!==c.episode.master_asset_id&&(c.masterAsset=d.assets[c.episode.master_asset_id]),c.uploadStatus=[],c.uneditedEpisode=angular.copy(c.episode),c.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:""},c.masterAsset&&c.masterAsset.urls.youtube.length&&1===Object.keys(c.masterAsset.urls).filter(function(a){return c.masterAsset.urls[a].length>0}).length?c.masterAssetType="Youtube":c.masterAsset||h.userHasRole("admin")?c.masterAssetType="Video":c.masterAssetType="Youtube",c.episode.styles)for(var i in c.itemForm)for(var j=0;j<c.episode.styles.length;j++)c.episode.styles[j].substr(0,i.length)===i&&(c.itemForm[i]=c.episode.styles[j].substr(i.length));c.langForm={en:!0,es:!1,zh:!1,pt:!1,fr:!1,de:!1,it:!1};for(var k=0;k<c.episode.languages.length;k++)c.langForm[c.episode.languages[k].code]=!0;c.langForm[c.episode.defaultLanguage]=!0,c.languageWatcher=c.$watch(function(){return[c.langForm,c.episode.defaultLanguage]},function(){var a=0,b="",d=[];for(var e in c.langForm)c.langForm[e]?(a++,b=e,d.push({code:e})):c.episode.defaultLanguage===e&&(c.episode.defaultLanguage=!1);c.languageCount=a,c.episode.defaultLanguage===!1&&(c.episode.defaultLanguage=b),angular.forEach(d,function(a){a.code===c.episode.defaultLanguage&&(a["default"]=!0)}),c.episode.languages=angular.copy(d)},!0),c.watchStyleEdits=c.$watch(function(){return c.itemForm},function(){var a=[];for(var b in c.itemForm)c.itemForm[b]&&a.push(b+c.itemForm[b]);c.episode.styles=a,d.deriveEpisode(c.episode),d.resolveEpisodeEvents(c.episode._id)},!0),c.appState=b,c.watchEdits=c.$watchGroup(["episode.templateUrl","episode.title[appState.lang]","episode.description[appState.lang]"],function(a,b){if(a[0]!==b[0]){var e=[];if(b[0]){var f=b[0].match("templates/episode/(.*).html")[1];angular.forEach(c.episode.styles,function(a){a.toLowerCase()!=="color"+f&&a.toLowerCase()!=="typography"+f&&e.push(a)})}var g=a[0].match("templates/episode/(.*).html")[1];angular.forEach(["eliterate","gw","purdue","usc","columbia","columbiabusiness"],function(a){g===a&&(e.push("color"+a[0].toUpperCase()+a.substring(1)),e.push("typography"+a[0].toUpperCase()+a.substring(1)))}),c.episode.styles=angular.copy(e)}d.deriveEpisode(c.episode),d.resolveEpisodeEvents(c.episode._id)}),c.dismissalWatcher=a.$on("player.dismissAllPanels",c.cancelEdit),c.cancelEdit=function(){c.cancelEpisodeEdit(c.uneditedEpisode)},c.attachChosenAsset=function(a){var b=d.assets[a],e=d.assets[c.episode.master_asset_id];if(c.showmessage="New video attached.",e&&b.duration<e.duration){var f=c.getItemsAfter(c.episode.items.concat(c.episode.scenes),b.duration);f.length&&(c.showmessage="Warning: this new video is shorter than the current video and we've detected that some existing content items will be impacted. If you save this edit, these events will have their start and end times adjusted to the new episode end. (If this isn't what you want, choose a different video or hit 'cancel'.)")}c.episode._master_asset_was_changed=!0,c.episode.master_asset_id=b._id,c.masterAsset=b,c.episode.masterAsset=b,d.deriveEpisode(c.episode)},c.attachPosterAsset=function(a){var b=d.assets[a];c.episode.poster_frame_id=a,c.episode.poster=b,d.deriveEpisode(c.episode)},c.assetUploaded=function(a){c.showUploadButtons=!1,c.showUploadField=!1,c.attachChosenAsset(a)},c.posterUploaded=function(a){c.showUploadButtonsPoster=!1,c.showUploadFieldPoster=!1,c.attachPosterAsset(a)},c.attachYouTube=function(a){c.showmessage="Getting video from YouTube...";var b=g.extractYoutubeId(a);b?g.getVideoData(b).then(function(b){var f={};f.you_tube_url=f.url=g.embeddableYoutubeUrl(a),f.duration=b.duration,f.name={en:b.title},f.description={en:b.description},f.content_type="video/x-youtube",e.createAsset(c.episodeContainerId,f).then(function(a){d.cache("asset",a),c.attachChosenAsset(a._id)})},function(){c.showmessage="Sorry, couldn't find that video on YouTube."}):c.showmessage="Sorry, couldn't match that to a valid YouTube url."},c.replaceAsset=function(a){a=a||"",c["showUploadButtons"+a]=!0,c["showUploadField"+a]=!1},c.selectText=function(a){a.target.select()},c.$on("$destroy",function(){c.watchEdits(),c.dismissalWatcher(),c.languageWatcher(),c.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittItemEditor",["$rootScope","$timeout","errorSvc","appState","modelSvc","timelineSvc","awsSvc","dataSvc","youtubeSvc","selectService",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/producer/item.html",controller:"EditController",link:function(b){function g(){if(b.item.styles){for(var a in b.itemForm)for(var c=0;c<b.item.styles.length;c++)b.item.styles[c].substr(0,a.length)===a&&(b.itemForm[a]=b.item.styles[c].substr(a.length));for(var d=0;d<b.item.styles.length;d++)("contain"===b.item.styles[d]||"cover"===b.item.styles[d]||"center"===b.item.styles[d]||"fill"===b.item.styles[d])&&(b.itemForm.position=b.item.styles[d]),("tl"===b.item.styles[d]||"tr"===b.item.styles[d]||"bl"===b.item.styles[d]||"br"===b.item.styles[d])&&(b.itemForm.pin=b.item.styles[d])}}f.pause(),f.seek(b.item.start_time),b.uploadStatus=[],b.uneditedItem=angular.copy(b.item),b.uneditedItem.$$hashKey=b.item.$$hashKey,b.annotators=e.episodes[d.episodeId].annotators,b.episodeContainerId=e.episodes[d.episodeId].container_id,b.languages=e.episodes[d.episodeId].languages,b.itemForm={transition:"",highlight:"",color:"",typography:"",timestamp:"",position:"",pin:""},b.item.layouts||(b.item.layouts=["inline"]),g(),b.item.producerItemType||c.error({data:"Don't have a producerItemType for item "+b.item._id}),b.itemEditor="templates/producer/item/"+d.product+"-"+b.item.producerItemType+".html",b.appState=d,b.watchEdits=b.$watch(function(){return b.item},function(a,c){c&&(a.yturl!==c.yturl&&(b.item.url=i.embeddableYoutubeUrl(a.yturl)),a=e.deriveEvent(a),"producer"!==d.product||a.noEmbed!==!0||"templates/item/link-embed.html"!==a.templateUrl&&"templates/item/link-modal-thumb.html"!==a.templateUrl||(a.templateUrl="templates/item/link.html"),a.asset?(b.item.asset.cssUrl="url('"+a.asset.url+"');",b.item.backgroundImageStyle="background-image: url('"+a.asset.url+"');"):(delete b.item.asset,delete b.item.backgroundImageStyle),(a.start_time!==c.start_time||a.start_time!==c.end_time)&&e.resolveEpisodeEvents(d.episodeId))},!0),b.watchStyleEdits=b.$watch(function(){return b.itemForm},function(){var a=[];for(var c in b.itemForm)b.itemForm[c]&&("position"===c||"pin"===c?a.push(b.itemForm[c]):a.push(c+b.itemForm[c]));b.item.styles=a,b.item.asset&&(b.item.asset.cssUrl="url('"+b.item.asset.url+"');",b.item.backgroundImageStyle="background-image: url('"+b.item.asset.url+"');")},!0),b.forcePreview=function(){d.editEvent.fnord=d.editEvent.fnord?"":"fnord"};var h=function(a){return"Annotation"===a._type&&a.templateUrl.match(/transcript/)?!0:!1};b.setItemTime=function(){"Scene"===b.item._type?(e.resolveEpisodeEvents(d.episodeId),f.updateSceneTimes(b.item.episode_id)):b.item.stop?(b.item.end_time=b.item.start_time,e.resolveEpisodeEvents(d.episodeId),f.updateEventTimes(b.item)):(e.resolveEpisodeEvents(d.episodeId),(b.item.end_time<=b.item.start_time||b.item.end_time>e.events[b.item.scene_id].end_time)&&(b.item.end_time=e.events[b.item.scene_id].end_time),f.updateEventTimes(b.item))};var k=function(a,b){return a.start_time-b.start_time};b.setItemEndTime=function(){(b.item.end_time<=b.item.start_time||b.item.end_time>e.events[b.item.scene_id].end_time)&&(b.item.end_time=e.events[b.item.scene_id].end_time),f.updateEventTimes(b.item)};var l=function(){var a=e.episodes[d.episodeId],b=angular.copy(a.items);return b.filter(h)},m=function(a,b,c){if("Chapter"===b._type)return!1;if(!a)return!1;var d,e=a.end_time;c=c.sort(k);for(var f=0,g=c.length;g>f;f++)if(c[f]._id===b._id){d=c[f+1];break}return d&&d.start_time<a.end_time&&(e=d.start_time),e},n=function(a){return"Scene"===a._type?a:e.events[b.item.scene_id]};b.switchToAutoOrCustom=function(a){if(a){var c=h(b.item)?l():[];b.item.end_time=m(n(b.item),b.item,c),b.customEndTime=!1}else b.customEndTime=!0},b.isAutoEndTime=function(){var a=h(b.item)?l():[],c=m(n(b.item),b.item,a);return b.item.end_time===c?!0:!1},b.customEndTime=!b.isAutoEndTime(),b.dismissalWatcher=a.$on("player.dismissAllPanels",b.cancelEdit),b.cancelEdit=function(){b.cancelEventEdit(b.uneditedItem)},b.assetUploaded=function(a){b.item.asset=e.assets[a],"Link"===b.item._type?b.item.link_image_id=a:"Annotation"===b.item._type?b.item.annotation_image_id=a:b.item.asset_id=a,b.showUploadButtons=!1,b.showUploadField=!1},b.replaceAsset=function(){b.showUploadButtons=!0,b.item.sxs&&(b.item.removedAssets=b.item.removedAssets||[],"Link"===b.item._type?b.item.removedAssets.push(b.item.link_image_id):"Annotation"===b.item._type?b.item.removedAssets.push(b.item.annotation_image_id):b.item.removedAssets.push(b.item.asset_id))},b.detachAsset=function(){if(b.item.asset)switch(b.item.producerItemType){case"link":b.item.asset=null,b.item.link_image_id=null,b.item.asset_id=null,b.item.annotation_image_id=null;break;case"transcript":b.item.asset=null,b.item.annotation_image_id=null;break;case"image":case"question":case"file":b.item.asset=null,b.item.asset_id=null}},b.attachChosenAsset=function(a){var c=e.assets[a];b.item&&(b.item.asset=c,j.onSelectChange(b.item,b.itemForm),"Upload"===b.item._type||"Plugin"===b.item._type?b.item.asset_id=a:"Link"===b.item._type?(b.item.link_image_id=a,b.item.asset_id=a):"Annotation"===b.item._type&&(b.item.asset_id=a,b.item.annotation_image_id=a))},b.$on("$destroy",function(){b.watchEdits(),b.dismissalWatcher(),b.watchStyleEdits()})}}}]),angular.module("com.inthetelling.story").directive("ittVideo",["$timeout","$interval","$rootScope","appState","timelineSvc","dataSvc","modelSvc",function(a,b,c,d,e,f,g){var h=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo",poster:"="},link:function(i,j){i.appState=d,i.uid=++h,a(function(){i.initVideo(j)}),i.videoClick=function(){"paused"===d.timelineState?e.play():e.pause()},i.spaceWatcher=c.$on("userKeypress.SPACE",i.videoClick),i.bufferInterval=b(function(){if(i.getBufferPercent){var a=i.getBufferPercent();a>98&&(b.cancel(i.bufferInterval),d.bufferedPercent=100)}},200);var k=0;i.pollInterval=b(function(){k++,k>360&&b.cancel(i.pollInterval);var a=g.episodes[d.episodeId];a&&a.masterAsset&&!g.isTranscoded(a.masterAsset)?f.getSingleAsset(a.master_asset_id).then(function(a){g.isTranscoded(a)&&(b.cancel(i.pollInterval),g.cache("asset",a))}):b.cancel(i.pollInterval)},1e4),i.$on("$destroy",function(){i.spaceWatcher(),b.cancel(i.bufferInterval),b.cancel(i.pollInterval)})}}}]),angular.module("com.inthetelling.story").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();Math.abs(a)>1||Math.abs(b)>1?e.offset({top:e.offset().top+a/4,left:e.offset().left+b/4}):e.offset(d.magnet.offset()),Math.abs(c)>4?e.width(Math.ceil(e.width()+c/4)):e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))})};a.$on("magnet.changeMagnet",function(a,b){g(b)});var i=function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute"),e.offset(d.magnet.offset()),e.width(Math.ceil(d.magnet.width())),e.height(Math.ceil(d.magnet.width()/f))};a.$on("magnet.jumpToMagnet",i),d.$on("$destroy",function(){d.unwatch&&d.unwatch()})}}}]),angular.module("com.inthetelling.story").directive("ittMagnet",["$rootScope","appState",function(a,b){return{restrict:"A",replace:!0,scope:!0,link:function(c,d){c.changeMagnet=function(c){a.$emit("magnet.changeMagnet",c),(b.isTouchDevice||0===b.time)&&a.$emit("magnet.jumpToMagnet")},c.unwatchVisibility=c.$watch(function(){return d.is(":visible")},function(a){a&&c.changeMagnet(d)}),"watchModeVideoMagnet"===d.attr("id")&&(c.unwatchSize=c.$watch(function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:d.is(":visible")}},function(){var a=angular.element(window),b=a.height()-46;a.width()/b>16/9?d.width(16/9*b):d.width(a.width()),c.changeMagnet(d)},!0)),c.$on("$destroy",function(){c.unwatchVisibility(),c.unwatchSize&&c.unwatchSize()})}}}]),angular.module("com.inthetelling.story").directive("ittSearchPanel",["$timeout","appState",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.appState=b,a.indexEvents()}}}]),angular.module("com.inthetelling.story").directive("ittContainer",["$timeout","$location","$route","appState","modelSvc","recursionHelper","dataSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!1,scope:{container:"=ittContainer",depth:"=depth",onContainerClick:"&",rootContext:"="},templateUrl:"templates/container.html",controller:["$scope","$location","modelSvc","authSvc",function(a,b,c,d){function e(){a.showNarrativeModal=!a.showNarrativeModal}function f(c){a.resolvingNarrative=!0,g.generateNewNarrative(c.c,c.n).then(function(c){b.path("/story/"+c._id),a.resolvingNarrative=!1})}a.toggleNarrativeModal=e,a.postNewNarrative=f,a.showNarrativeModal=!1,a.resolvingNarrative=!1,a.canAccess=d.userHasRole("admin")||d.userHasRole("customer admin"),a.customers=c.getCustomersAsArray()}],compile:function(c){return f.compile(c,function(c){c.appState=d,c.containers=e.containers,c.customer=e.customers[c.container.customer_id],c.isDemoServer=b.host().match(/demo|localhost|api-dev|client.dev/),c.selectText=function(a){a.target.select()},c.containerTypes=["customer","project","module","episode"],c.toggleChildren=function(){c.onContainerClick({$container:{container:c.container,depth:c.depth}}),c.container.children||c.container.episodes.length?c.container.showChildren=!c.container.showChildren:g.getContainer(c.container._id).then(function(a){c.container=e.containers[a],c.container.showChildren=!0})},c.renameContainer=function(){var a={};angular.forEach(["_id","customer_id","episodes","keywords","parent_id","sort_order"],function(b){a[b]=angular.copy(c.container[b])}),a.name={en:c.container.newContainerName},g.updateContainer(a).then(function(){c.container.editingContainer=!1})},c.addContainer=function(){var a={customer_id:c.container.customer_id,parent_id:c.container._id,name:{en:angular.copy(c.container.newContainerTitle)}};g.createContainer(a).then(function(a){if(2===c.depth){var b={container_id:a._id,title:angular.copy(a.name)};g.getCommon().then(function(){g.createEpisode(b).then(function(a){var b={_type:"Scene",title:{},description:{},templateUrl:"templates/scene/1col.html",start_time:0,end_time:0,episode_id:a._id};g.storeItem(b)})})}}),c.container.newContainerTitle="",c.container.addingContainer=!1},c.deleteEpisodeAndContainer=function(b){var c=e.containers[b],d=c.parent_id?c.parent_id:c.ancestry.replace(/.*\//,""),f=e.containers[d],h=[];angular.forEach(f.children,function(a){a._id!==b&&h.push(a)}),f.children=h,c.episodes.length?g.deleteEpisode(c.episodes[0]).then(function(){a(function(){g.deleteContainer(c._id)},250)}):g.deleteContainer(c._id)}})}}}]),angular.module("com.inthetelling.story").directive("ittContainerEpisodes",["modelSvc","recursionHelper","appState","dataSvc",function(a,b,c,d){
return{restrict:"A",replace:!1,scope:{container:"=ittContainerEpisodes",forAdmin:"=forAdmin",onNodeClick:"&",rootContext:"="},templateUrl:"templates/containerepisodes.html",controller:["$scope",function(a){a.selectEpisode=function(b){a.onNodeClick({node:b})}}],compile:function(e){return b.compile(e,function(b){b.containers=a.containers,b.crossEpisodePath=c.crossEpisodePath,b.episodeId=c.episodeId,b.loadChildren=function(){a.containers[b.container._id].haveNotLoadedChildData&&d.getContainer(b.container._id)},b.toggle=function(){b.container.wasClicked=!b.container.wasClicked}})}}}]),angular.module("com.inthetelling.story").directive("ittEpisodeList",function(){return{restrict:"A",replace:!0,controller:["$scope","$location","$timeout","appState","authSvc","dataSvc","modelSvc","ittUtils",function(a,b,c,d,e,f,g,h){function i(b){h.existy(a.lastClickedContainer)&&3===a.lastClickedContainer.depth&&(a.lastClickedContainer.container.showChildren=!1),a.lastClickedContainer=b}a.logout=function(){e.logout()},a.appState=d,a.loading=!0,a.containers=g.containers,a.userHasRole=e.userHasRole,f.getCustomerList(),f.getContainerRoot().then(function(b){a.root={children:[]},angular.forEach(b,function(b){a.root.children.push(g.containers[b])}),a.loading=!1},function(){a.failedLogin=!0,a.loading=!1}),a.onContainerClick=i}]}}),angular.module("com.inthetelling.story").directive("ittUser",["$q","appState","authSvc","dataSvc","awsSvc","modelSvc","imageResize",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/user.html",link:function(h,i,j){h.inPlayer=j.inPlayer,h.appState=b,h.loading=!0,h.logout=c.logout,h.canAccess=c.userHasRole("admin")||c.userHasRole("customer admin"),c.authenticate().then(function(){h.loading=!1,h.user=b.user,h.userHasRole=c.userHasRole}),h.uploadStatus=[],h.toggleUploadAvatar=function(){h.showUploadField=!h.showUploadField},h.uploadAvatar=function(c){function d(a){return g.resizeImg(a,60,60,!0).then(function(a){return a})}function i(b){return a(function(a){var d=g.createFileFromDataURL(b,c[0].name);a(d)})}function j(a){e.uploadUserFiles(b.user._id,[a])[0].then(function(a){h.showUploadField=!1,f.cache("asset",a.file),b.user.avatar_id,b.user.avatar_id=a.file._id,h.updateUser(),delete h.uploads})}h.uploadStatus[0]={bytesSent:0,bytesTotal:1},g.readFileToImg(c[0]).then(d).then(i).then(j)["catch"](function(){})},h.updateUser=function(){c.updateUser(b.user).then(function(){h.user=b.user})},h.getMyNarratives=function(){d.getUserNarratives(h.user._id).then(function(a){h.myPurchases=a,angular.forEach(h.myPurchases,function(a){a.daysUntilExpiration=Math.floor((new Date(a.expiration_date)-new Date)/864e5),d.getNarrativeOverview(a.narrative_id).then(function(a){angular.forEach(h.myPurchases,function(b){b.narrative_id===a._id&&(b.narrativeData=a)})})})})}}}}]),angular.module("com.inthetelling.story").directive("ittNarrative",ittNarrative).controller("ittNarrativeCtrl",ittNarrativeCtrl),ittNarrativeCtrl.$inject=["$scope","authSvc","appState","dataSvc","ittUtils"],function(){function a(){return{restrict:"A",replace:!0,templateUrl:"templates/narrativelist.html",scope:{narrativesData:"=",customersData:"="},controller:"NarrativeListCtrl",controllerAs:"narrativeList",bindToController:!0}}function b(a,b,c,d){function e(){g.narrativeSelect=!g.narrativeSelect}function f(b){d.createNarrative(b).then(function(b){a.path("/story/"+b._id)})}var g=this;g.narratives=g.narrativesData,g.customers=g.customersData,g.logout=b.logout,g.user=c.user,g.narrativeSelect=!1,g.toggleSelectNarrative=e,g.addNarrative=f,(b.userHasRole("admin")||b.userHasRole("customer admin"))&&(g.canAccess=!0)}angular.module("com.inthetelling.story").directive("ittNarrativeList",a).controller("NarrativeListCtrl",b),b.$inject=["$location","authSvc","appState","dataSvc"]}(),function(){function a(){return{restrict:"EA",template:'<div id="{{ittYoutubeCtrl.embedId}}"></div>',scope:{embedUrl:"@",onPlayerStateChange:"=?",onPlayerQualityChange:"=?",onReady:"=?",mainPlayer:"&",playerId:"&"},controller:"ittYoutubeCtrl",controllerAs:"ittYoutubeCtrl",bindToController:!0}}function b(a,b,c,d){var e=this;e.isMainPlayer=e.mainPlayer(),e.ytVideoID=d.extractYoutubeId(e.embedUrl);var f=e.playerId();void 0===e.onPlayerStateChange&&(e.onPlayerStateChange=angular.noop),void 0===e.onReady&&(e.onReady=angular.noop),void 0===e.onPlayerQualityChange&&(e.onPlayerQualityChange=angular.noop),c.setPlayerId(f,e.mainPlayer()).then(function(b){e.embedId=b,a(function(){c.create(b,f,e.ytVideoID,e.onPlayerStateChange,e.onPlayerQualityChange,e.onReady)},0)}),b.$on("$destroy",function(){c.destroy(e.embedId)})}angular.module("com.inthetelling.story").directive("ittYoutube",a).controller("ittYoutubeCtrl",b),b.$inject=["$timeout","$scope","youTubePlayerManager","youtubeSvc"]}(),function(){function a(a,b,c,d){return{require:"?ngModel",scope:{onValidationNotice:"&"},link:function(e,f,g,h){function i(a){return/mailto:/.test(a)}function j(){h.$validators.mixedContent=function(a,b){return c.existy(b)&&/^http:\/\//.test(b)?e.onValidationNotice({$notice:{type:"mixedContent",isValid:!1}}):e.onValidationNotice({$notice:{type:"mixedContent",isValid:!0}}),!0},h.$validators.emptyUrl=function(a,b){return h.$isEmpty(b)&&!i(b)?(e.onValidationNotice({$notice:{type:"emptyUrl",isValid:!1}}),!1):(e.onValidationNotice({$notice:{type:"emptyUrl",isValid:!0}}),!0)},h.$validators.url=function(a,b){return c.isValidURL(b)||i(b)?(e.onValidationNotice({$notice:{type:"url",isValid:!0}}),!0):(e.onValidationNotice({$notice:{type:"url",isValid:!1,payload:b}}),!1)},h.$asyncValidators.xFrameOpts=function(c,f){return h.$isEmpty(f)||b.isYoutubeUrl(f)||/^http:\/\//.test(f)||i(f)?a(function(a){return e.onValidationNotice({$notice:{type:"xFrameOpts",isValid:!0}}),a()}):d.checkXFrameOpts(f).then(function(a){if(a){var b="Embedded link template is disabled because "+f+" does not allow iframing";e.onValidationNotice({$notice:{type:"xFrameOpts",isValid:!1,payload:b}})}else e.onValidationNotice({$notice:{type:"xFrameOpts",isValid:!0}})})}}h&&j()}}}angular.module("com.inthetelling.story").directive("ittValidItemUrl",a),a.$inject=["$q","youtubeSvc","ittUtils","dataSvc"]}(),function(){function a(){return{restrict:"EA",template:'<div ng-if="routeLoadingCtrl.isLoading" class="loading routeLoading"> 	<div class="spinner"> 		<div class="rotating pie"></div> 		<div class="filler pie"></div> 		<div class="mask"></div> 	</div><span class="loading__text">Loading</span> </div>',scope:{isLoading:"=?"},controller:["$rootScope","$scope","$timeout","errorSvc",function(a,b,c,d){var e=this;e.isLoading=e.isLoading||!1;var f;a.$on("$routeChangeStart",function(){f=c(function(){e.isLoading=!0},500)}),a.$on("$routeChangeSuccess",function(){c.cancel(f),e.isLoading=!1}),a.$on("$locationChangeSuccess",function(){c.cancel(f),e.isLoading=!1}),a.$on("$routeChangeError",function(){c.cancel(f),e.isLoading=!1}),b.$watch(function(){return d.errors.length},function(a,b){a!==b&&a>0&&(c.cancel(f),e.isLoading=!1)})}],controllerAs:"routeLoadingCtrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittRouteLoading",a)}(),function(){function a(a){return{require:"?ngModel",link:function(b,c,d,e){e&&(e.$validators.supportUrl=function(b){return e.$isEmpty(b)||a.isValidURL(b)})}}}angular.module("com.inthetelling.story").directive("ittValidUrl",a),a.$inject=["ittUtils"]}(),angular.module("com.inthetelling.story").directive("sxsAddContent",["appState",function(a){return{restrict:"A",replace:!0,scope:{},templateUrl:"templates/producer/addcontent.html",controller:"EditController",link:function(b){b.appState=a,b.expand=function(){b.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){b.collapse()})},b.collapse=function(){b.expanded=!1}}}}]),angular.module("com.inthetelling.story").directive("sxsInputTime",["appState","$rootScope","$timeout","modelSvc","timelineSvc",function(a,b,c,d,e){return{scope:{item:"=sxsInputTime"},templateUrl:"templates/producer/inputtime.html",link:function(f,g,h){f.parse=function(c){var d;if(void 0===c||""===c)d=a.time;else if(isNaN(c)){var e=c.split(":");2===e.length?(isNaN(e[0])&&(e[0]=0),isNaN(e[1])&&(e[1]=0),d=60*+e[0]+ +e[1]):d=a.time}else d=c;return.01>d&&(d=.01),b.$emit("searchReindexNeeded"),d},f.format=function(a){var b=Math.floor(a/60),c=Math.round(a%60*100)/100;return 10>c&&(c="0"+c),b+":"+c},f.fieldname=angular.copy(h.inputField),f.realValue=angular.copy(f.item[h.inputField]),f.model=f.format(f.realValue),f.appState=a,f.scene="Scene"===f.item.type?f.item:d.events[f.item.scene_id],"Scene"===f.item._type?f.scene=function(){return f.item}:f.scene=function(){return d.sceneAtEpisodeTime(f.item.cur_episode_id,a.time)};var i=d.episodes[f.item.cur_episode_id].masterAsset.duration;f.$watch(function(){return f.parse(f.model)},function(a){f.setTime(a),"start_time"===h.inputField&&f.item.stop&&(f.item.end_time=a)}),f.nudge=function(a){c.cancel(j),g.find(".inputfield").focus();var b=a/30;f.setTime(f.item[h.inputField]+b),"start_time"===h.inputField&&e.seek(f.item[h.inputField]+b)},f.setTime=function(a){0>a&&(a=0),a>i&&(a=i),f.item.stop&&(f.item.end_time=a),f.realValue=a,f.item[h.inputField]=f.realValue,f.model=f.format(a),f.item.invalid_end_time=f.item.start_time>f.item.end_time};var j;f.showTools=function(a){a?f.tooltip=!0:j=c(function(){f.tooltip=!1},300)},f.isTranscript=function(){return!1}}}}]),angular.module("com.inthetelling.story").directive("sxsAnnotatorAutocomplete",["modelSvc","$timeout","appState",function(a,b,c){return{require:"ngModel",templateUrl:"templates/producer/annotator-autocomplete.html",scope:{annotators:"=sxsAnnotatorAutocomplete",item:"=item"},link:function(d,e,f,g){d.appState=c,d.hasAnnotator=function(){return Object.keys(d.item.annotator).length>0},angular.forEach(d.annotators,function(b){b.annotation_image_id&&(b.imageUrl=a.assets[b.annotation_image_id].url)}),d.annotator={name:d.item.annotator},d.annotators[d.item.annotator]&&d.annotators[d.item.annotator].annotation_image_id&&(d.annotator.imageUrl=a.assets[d.annotators[d.item.annotator].annotation_image_id].url),d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1,e.find(".annotatorChooser").bind("keydown",function(a){switch(a.which){case 40:d.preselectedItem=(d.preselectedItem+1)%Object.keys(d.filteredAnnotators).length;break;case 38:d.preselectedItem=(d.preselectedItem-1)%Object.keys(d.filteredAnnotators).length;break;case 13:a.preventDefault(),d.preselectedItem>-1&&d.selectByIndex(d.preselectedItem)}}),d.handleAutocomplete=function(){if(d.annotator.name="",d.searchText){d.preselectedItem=-1;var a={};angular.forEach(d.annotators,function(b){b.key.toLowerCase().indexOf(d.searchText.toLowerCase())>-1&&(a[b.key]=b)}),d.filteredAnnotators=a,1===Object.keys(d.filteredAnnotators).length&&(d.preselectedItem=0)}else d.filteredAnnotators=angular.copy(d.annotators),d.preselectedItem=-1},d.selectByIndex=function(a){if(!(0>a)){var b=Object.keys(d.filteredAnnotators).sort();d.select(d.filteredAnnotators[b[a]])}},d.select=function(b){d.preselectedItem=-1,b.annotation_image_id?(d.item.annotation_image_id=b.annotation_image_id,d.item.asset=a.assets[b.annotation_image_id],d.annotator.imageUrl=d.item.asset.url):(delete d.annotator.imageUrl,delete d.item.asset),g.$setViewValue(b.name),d.searchText=""},d.autoCompleting=!1,d.showAutocomplete=function(){var a=e.find(".annotatorChooser")[0];a.setSelectionRange(0,a.value.length),d.autoCompleting=!0},d.hideAutocomplete=function(){b(function(){d.preselectedItem>-1?d.selectByIndex(d.preselectedItem):""!==d.searchText&&d.addNewAnnotator(),d.autoCompleting=!1},300)},d.addNewAnnotator=function(){var a=d.searchText;d.item.annotator={},d.item.annotator[c.lang]=a,d.searchText="",d.handleAutocomplete()},d.uploadAnnotatorImage=function(){window.alert("TODO")}}}}]),angular.module("com.inthetelling.story").directive("sxsInputI18n",["appState","$timeout","textAngularManager",function(a,b,c){return{templateUrl:"templates/producer/inputi18n.html",scope:{field:"=sxsInputI18n",inputtype:"=inputtype",doValidate:"=",onEmitName:"&"},link:function(d,e,f){d.field||(d.field={en:""}),d.appState=a,d.textangularname="ta"+(new Date).getUTCMilliseconds()+"y"+Math.random().toString(16),d.onEmitName({$taName:d.textangularname}),"textarea"===d.inputtype&&(b(function(){if(void 0!==f.autofocus){var a=c.retrieveEditor(d.textangularname).scope;a.displayElements.text.trigger("focus")}}),d.trim=function(){var b=d.field[a.lang];b&&(b=b.replace(/<br\/>/g,"<br>"),b=b.replace(/<div>/g,"<br>"),b=b.replace(/<\/?(span|div)>/g,""),b=b.replace(/(<br>)*$/,""),d.field[a.lang]=b)},d.sanitizePastedHtml=function(a){var b=document.createElement("div");return b.innerHTML=a,b.textContent})}}}]),function(){function a(){return{template:['<div class="">','	<ul class="nav nav-tabs">','		<li ng-repeat="pane in panes" class="tab-pane"><p class="ittTabLabel" ng-class="{cur:pane.selected}" ng-click="select(pane)">{{pane.title}}</p></li>',"	</ul>",'	<div class="tab-content"><ng-transclude></ng-transclude></div>',"</div>"],transclude:!0,restrict:"EA",scope:{},controller:"TabzCtrl"}}function b(a){function b(a){angular.forEach(c,function(a){a.selected=!1}),a.selected=!0}var c=a.panes=[];a.select=b;var d=this;d.addPane=function(a){0===c.length&&b(a),c.push(a)}}function c(){return{template:'<div ng-show="selected"><ng-transclude></ng-transclude></div>',require:"^^ittTabs",transclude:!0,scope:{title:"@"},link:function(a,b,c,d){d.addPane(a)}}}angular.module("com.inthetelling.story").directive("ittTabs",a).controller("TabzCtrl",b).directive("ittTab",c),b.$inject=["$scope"]}(),angular.module("com.inthetelling.story").controller("ContainerAssetsTestController",["$scope","$routeParams",function(a,b){a.containerId=b.containerId}]).directive("sxsContainerAssets",["$routeParams","$rootScope","recursionHelper","dataSvc","modelSvc","awsSvc","appState","authSvc","MIMES",function(a,b,c,d,e,f,g,h,i){return{restrict:"A",replace:!1,scope:{containerId:"=sxsContainerAssets",mimeKey:"@"},templateUrl:"templates/producer/container-assets.html",compile:function(a){return c.compile(a,function(a){a.appState=g,e.containers[a.containerId]?(a.container=e.containers[a.containerId],a.container.assetsHaveLoaded||d.getContainerAssets(a.containerId)):d.getContainer(a.containerId).then(function(){a.container=e.containers[a.containerId],d.getContainerAssets(a.containerId)}),a.canAccess=h.userHasRole("admin")||h.userHasRole("customer admin"),a.isCustAdmin=h.userHasRole("customer admin"),i[a.mimeKey]?(a.mimes=i[a.mimeKey],h.userHasRole("admin")&&(a.mimes+=",video/*")):a.mimes=i["default"],a.assets=e.assets,a.uploadStatus=[],a.up=function(){a.showParent=!0},a.toggleImages=function(){a.onlyImages=!a.onlyImages},a.toggleGrid=function(){a.gridView=!a.gridView},a.assetClick=function(a){b.$emit("UserSelectedAsset",a)},a.uploadAsset=function(b){var c=b.files;a.uploadStatus[0]={bytesSent:0,bytesTotal:1},a.uploads=f.uploadContainerFiles(a.containerId,c),a.uploads[0].then(function(c){e.cache("asset",c.file),b.value="",delete a.uploads},function(){},function(b){a.uploadStatus[0]=b})}})}}}]),angular.module("com.inthetelling.story").directive("ittAssetUploader",ittAssetUploader),ittAssetUploader.$inject=["$timeout","awsSvc","appState","modelSvc"],function(){function a(){return{restrict:"EA",transclude:!0,scope:{modalClass:"@"},template:'<div class="itt__modal"><div class="{{modalClass}}"><ng-transclude></ng-transclude></div></div>'}}angular.module("com.inthetelling.story").directive("ittModal",a)}(),function(){function a(){return{restrict:"EA",transclude:!0,scope:{canAccess:"=?",onEdit:"&"},template:'<div class="pencil__wrapper"> 	<div ng-transclude></div> 	<div class="wrapped"><span class="edit-pencil" ng-click="onEdit()" ng-if="showPencil"></span></div> </div>',link:function(a,b){a.showPencil=!1,a.canAccess===!0&&(b.mouseenter(function(){a.$apply(function(){a.showPencil=!0})}),b.mouseleave(function(){a.$apply(function(){a.showPencil=!1})}))}}}angular.module("com.inthetelling.story").directive("ittEditPencil",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="narrative__edit"> <h2>Narrative Settings</h2> 	<form name="nEditForm"> 		<div ng-show="nEditor.canAccess"> 			<label for="nCustomer">Customer 				<itt-validation-tip ng-if="nEditForm.customer.$invalid" text="A customer must be set"></itt-validation-tip> 			</label> 			<select id="nCustomer" name="customer" required ng-model="nEditor.selectedCustomer" ng-change="nEditor.selectCustomer(nEditor.selectedCustomer)" ng-options="cust.name for cust in nEditor._customers track by cust._id"></select></br> 		</div> 		<label id="nName">Narrative Title 			<itt-validation-tip ng-if="nEditForm.name.$invalid" text="Title is required"></itt-validation-tip> 		</label> 		<input for="nName" type="text" name="name" placeholder="Add Narrative Title" ng-model="nEditor._narrative.name.en" required> 		<label for="nDescription">Description</label> 		<textarea id="nDescription" name="description" placeholder="Add a Description" ng-model="nEditor._narrative.description.en"></textarea> 		<label for="nPath">Url Path Name 			<itt-validation-tip ng-if="nEditForm.path.$invalid"  text="Url Path Name is required"></itt-validation-tip> 		</label> 		<input id="nPath" type="text" name="path" placeholder="link-to-narrative" ng-model="nEditor._narrative.path_slug.en" required/> 		<label for="nSupportUrl">Support Url 			<itt-validation-tip ng-if="nEditForm.supportUrl.$invalid" text="Not a valid URL"></itt-validation-tip> 		</label> 		<input id="nSupportUrl" type="text" name="supportUrl" itt-valid-url placeholder="link for support" ng-model="nEditor._narrative.support_url"/> 		<label for="nNewWindow">Disable New Window</label> 		<input id="nNewWindow" type="checkbox" ng-model="nEditor._narrative.disable_new_window"/> 		<label for="nDisableNav">Disable Navigation</label> 		<input id="nDisableNav" type="checkbox" ng-model="nEditor._narrative.disable_navigation"/> 		<label for="nGuestAccess">Enable Guest Access</label> 		<input id="nGuestAccess" type="checkbox" ng-model="nEditor._narrative.guest_access_allowed"/> 		<div class="ancillaryNav"> 			<button class="done" ng-click="nEditor.handleUpdate(nEditor._narrative)" ng-disabled="nEditForm.$invalid">Save</button> 			<button class="done" ng-click="nEditor.onDone()">Cancel</button> 		</div> 	</form> </div>',scope:{narrative:"=",customers:"=",containerId:"=?",customerId:"=?",name:"=?",path:"=?",onDone:"&",onUpdate:"&"},controllerAs:"nEditor",bindToController:!0,controller:["ittUtils","authSvc",function(a,b){function c(){h(g._name)&&(h(g._narrative)?g._narrative.name=g._name:g._narrative={name:g._name}),h(g._path)&&(h(g._narrative)?g._narrative.path_slug=g._path:g._narrative={path_slug:g._path}),f()}function d(a){g.selectedCustomer=a}function e(b){h(g.selectedCustomer)&&(b.customer_id=g.selectedCustomer._id);var c=["name","description","customer_id","guest_access_allowed","path_slug","support_url","disable_navigation","disable_new_window","_id"],d=a.pick(b,c);h(g._containerId)?g.onUpdate({data:{n:d,c:g._containerId}}):g.onUpdate({n:d})}function f(){if(1===g._customers.length)g.selectedCustomer=g._customers[0];else if(h(g._narrative)||h(g._customerId)){var a=g._customerId||g._narrative.customer_id;g.selectedCustomer=g._customers.filter(function(b){return b._id===a})[0]}else g._customers.unshift({name:"Select a Customer"})}var g=this,h=a.existy;g._narrative=angular.copy(this.narrative),g._customerId=angular.copy(this.customerId),g._customers=angular.copy(this.customers),g._containerId=angular.copy(this.containerId),g._name=angular.copy(this.name),g._path=angular.copy(this.path),g.handleUpdate=e,g.selectCustomer=d,g.canAccess=b.userHasRole("admin")||b.userHasRole("customer admin"),c()}]}}angular.module("com.inthetelling.story").directive("ittNarrativeEditor",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="narrative__edit"> 	<form name="tlEditForm"> 		<label for="tlName">Name 			<itt-validation-tip ng-if="tlEditForm.name.$invalid" text="Name is required"></itt-validation-tip> 		</label> 		<input type="text" name="name" ng-model="tEditor._timeline.name.en" id="tlName" required> 		<label for="tlDescription">Description</label> 		<textarea id="tlDescription" name="description" placeholder="Insert Description..." ng-model="tEditor._timeline.description.en"></textarea> 		<label for="tlPath">Path 			<itt-validation-tip ng-if="tlEditForm.path.$invalid" text="Path is required"></itt-validation-tip> 		</label> 		<input id="tlPath" type="text" name="path" placeholder="path-to-episode" ng-model="tEditor._timeline.path_slug.en" required> 		<label>Hidden</label> 		<input type="checkbox" ng-model="tEditor._timeline.hidden"/> 		<div class="ancillaryNav"> 			<button class="button" ng-disabled="tlEditForm.$invalid" ng-click="tEditor.onUpdate({t: tEditor._timeline})">Save</button> 			<button class="button" ng-click="tEditor.confirmDelete()">Delete</button> 			<button class="button" ng-click="tEditor.onDone()">cancel</button> 		</div> 	</form> </div> <itt-modal modal-class="timeline__delete" ng-if="tEditor.underDelete"> 		<h2>Are you sure?</h2> 		<p>delete: </p> 		<p class="under__delete"><strong>{{tEditor._timeline.name.en}}?</strong></p> 		<button ng-click="tEditor.onDelete({t: tEditor._timeline})">yes</button> 		<button ng-click="tEditor.underDelete = false">no</button> </itt-modal>',scope:{timeline:"=",onUpdate:"&",onDelete:"&",onDone:"&"},controller:["ittUtils",function(a){function b(){c.underDelete=!0}var c=this,d=a.existy;c.confirmDelete=b,c.underDelete=!1,d(c.timeline)&&c.timeline.isTemp===!0?c._timeline=c.timeline:c._timeline=angular.copy(c.timeline)}],controllerAs:"tEditor",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittTimelineEditor",a)}(),function(){function a(){return{restrict:"EA",scope:!0,template:'<div class="field"> 	<div class="label">Start</div> 	<div class="input"> 		<span sxs-input-time="item" x-input-field="start_time"></span> 		<span ng-if="!(item.stop || item._type === \'Scene\' || item._type === \'Chapter\')"> 			<span class="label"> &nbsp; &nbsp; &nbsp; End</span> 			<span sxs-input-time="item" x-input-field="end_time"></span> 		</span> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittTimeField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",modelOpts:"=?",doValidate:"=?",ittItemForm:"=?"},template:'<div class="field" ng-if="$ctrl.isVisible(\'titleField\')"> 	<div class="label">Title [{{$ctrl.lang}}] 		<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Title is a required field"></itt-validation-tip> 	</div> 	<div class="input" ng-model-options="$ctrl.modelOpts" do-validate="$ctrl.doValidate" sxs-input-i18n="$ctrl.data.title" on-emit-name="$ctrl.onName($taName)" x-inputtype="\'input\'" autofocus></div> </div>',controller:["appState","ittUtils","selectService",function(a,b,c){function d(a){e.textAreaName=a}var e=this;e.lang=a.lang,e.isVisible=c.getVisibility,e.onName=d,b.existy(e.modelOpts)||(e.modelOpts={updateOn:"default"})}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittTitleField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"="},template:'<div class="field"> 	<div class="label">URL 		<itt-validation-tip ng-if="$ctrl.mixedContent.inform" text="Only HTTPS links can be embedded"></itt-validation-tip> 		<itt-validation-tip ng-if="$ctrl.emptyUrl.inform" text="Url cannot be blank"></itt-validation-tip> 		<itt-validation-tip ng-if="$ctrl.url.inform && $ctrl.url.payload" text="{{$ctrl.url.payload}} is not a valid URL"></itt-validation-tip> 		<itt-validation-tip ng-if="$ctrl.xFrameOpts.inform" text="{{$ctrl.xFrameOpts.payload}}" do-info="true"></itt-validation-tip> 	</div> 	<div class="input"> 		<input type="text" name="itemUrl" ng-model="$ctrl.data.url" ng-model-options="{ updateOn: \'blur\' }"  itt-valid-item-url on-validation-notice="$ctrl.handleValidationMessage($notice)"/> 	</div> </div>',controller:[function(){function a(a){switch(a.type){case"emptyUrl":case"url":a.isValid||(c.data.noEmbed=!1);break;case"xFrameOpts":case"mixedContent":a.isValid?c.data.noEmbed=!1:(c.data.noEmbed=!0,c.data.showInlineDetail=!1,c.data.templateOpts=c.data.templateOpts.map(function(a){return("Embedded Link"===a.name||"Link Modal"===a.name)&&(a.isDisabled=!0),a}))}c.mixedContent.inform?c.data.templateOpts=c.data.templateOpts.map(function(a){return("Embedded Link"===a.name||"Link Modal"===a.name)&&(a.isDisabled=!0),a}):"xFrameOpts"!==a.type&&(c.data.templateOpts=c.data.templateOpts.map(function(a){return a.isDisabled=!1,a}))}function b(b){c[b.type]={inform:!b.isValid},null!=b.payload&&(c[b.type].payload=b.payload),null!==c.xFrameOpts.payload&&"xFrameOpts"!==b.type&&(c.xFrameOpts.payload=null),a(b)}var c=this;c.handleValidationMessage=b,c.emptyUrl=c.url=c.xFrameOpts=c.mixedContent={}}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittUrlField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",modelOpts:"=?"},template:'<div class="field"> 	<div class="label">Description [{{descriptionField.lang}}]</div> 	<div class="input" ng-model-options="descriptionField.modelOpts" sxs-input-i18n="descriptionField.data.description" x-inputtype="\'textarea\'"></div> </div>',controller:["appState","ittUtils",function(a,b){var c=this;c.lang=a.lang,b.existy(c.modelOpts)||(c.modelOpts={updateOn:"default"})}],controllerAs:"descriptionField",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittDescriptionField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",itemForm:"=?"},template:'<div class="field" ng-if="$ctrl.isVisible(\'templateSelect\')"> 	<div class="label">{{$ctrl.labelText}}</div> 	<div class="input" ng-class="{layouts: $ctrl.labelText === \'Template\' && $ctrl.data.producerItemType === \'scene\'}"> 		<select ng-model="$ctrl.data.templateUrl" ng-change="$ctrl.onSelectChange($ctrl.data, $ctrl.itemForm)" ng-options="option.url as option.name for option in $ctrl.data.templateOpts" itt-options-disabled="option.isDisabled for option in $ctrl.data.templateOpts"></select> 	</div> </div>',controller:["selectService",function(a){var b=this;b.isVisible=a.getVisibility,b.onSelectChange=a.onSelectChange,b.getSelectOpts=a.getSelectOpts,b.labelText="Template",b.data.hasOwnProperty("producerItemType")||(b.data.producerItemType="episode",b.labelText="Theme")}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittTemplateSelect",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field" ng-show="selectService.getVisibility(\'imageUpload\')"> 	<div class="label">Image 		<itt-validation-tip ng-if="ittItemForm.itemAsset.$invalid" text="Image is required"></itt-validation-tip> 	</div> 	<div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div> </div>'}}angular.module("com.inthetelling.story").directive("ittImageField",a)}(),function(){function a(){return{restrict:"EA",scope:{flags:"=",data:"=",itemForm:"=?"},template:'<div class="field"> 	<div class="label">Flags</div> 	<div class="input"> 		<span ng-repeat="flag in $ctrl._flags"> 			<span ng-if="flag !== \'invertColor\'"> 				<label for="{{$ctrl._ids[flag]}}"></label> 				<input id="{{$ctrl._ids[flag]}}" type="checkbox" itt-dynamic-model="\'$ctrl.data.\' + flag" ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}} 			</span> 			<span ng-if="flag === \'invertColor\'"> 				<label for="{{$ctrl._ids[flag]}}"></label> 				<input id="{{$ctrl._ids[flag]}}" type="checkbox" ng-model="$ctrl.itemForm.color" ng-true-value="\'Invert\'" ng-false-value="\'\'" ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}} 			</span> 		</span> 	</div> </div>',controller:["$scope","selectService","ittUtils",function(a,b,c){function d(){h.data.hasOwnProperty("stop")&&b.onSelectChange(h.data,h.itemForm)}function e(a){return"templates/item/text-h1.html"===a||"templates/item/text-h2.html"===a}function f(){return h.data.templateUrl}function g(a){a&&("templates/item/image-fill.html"===h.data.templateUrl?h._flags=h._flags.filter(function(a){return"stop"!==a}):h._flags=h.flags,e(a)?(h._flags=h.flags,c.existy(h.itemForm)&&"internal:editing"===h.data._id&&(h.itemForm.color="Invert")):(c.existy(h.itemForm)&&"internal:editing"===h.data._id&&(h.itemForm.color=""),h._flags=h._flags.filter(function(a){return"chapter_marker"!==a&&"invertColor"!==a})))}var h=this;h._flags=angular.copy(h.flags),h.handleChange=d,h._displays={required:"Required",stop:"Stop item",cosmetic:"Cosmetic",chapter_marker:"Chapter Event",invertColor:"Invert Color"},h._ids={required:"itemRequired",stop:"itemStop",cosmetic:"itemCosmetic",chapter_marker:"itemChapter",invertColor:"Invert"},a.$watch(f,g)}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittFlags",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field" ng-if="selectService.getVisibility(\'speakerField\')"> 	<div class="label">Speaker [{{appState.lang}}]</div> 	<div class="input"> 		<div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittSpeakerField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",ittItemForm:"="},template:'<div class="field"> 	<div class="label">Transcript [{{$ctrl.lang}}] 		<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Transcript is a required field"></itt-validation-tip> 	</div> 	<div class="input" sxs-input-i18n="$ctrl.data.annotation" do-validate="true" x-inputtype="\'textarea\'" on-emit-name="$ctrl.onName($taName)" autofocus></div> </div>',controller:["appState",function(a){function b(a){c.textAreaName=a}var c=this;c.onName=b,c.lang=a.lang,c.textAreaName=""}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittTranscriptField",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field"> 	<div class="label">Speaker thumbnail</div> 	<div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div> </div>'}}angular.module("com.inthetelling.story").directive("ittSpeakerThumbField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",ittItemForm:"="},template:'<div class="field">\n	<div class="label">Annotation Text [{{$ctrl.lang}}]\n		<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Annotation Text is a required field"></itt-validation-tip>\n	</div>\n	<div class="input" sxs-input-i18n="$ctrl.data.annotation" do-validate="true" x-inputtype="\'textarea\'" on-emit-name="$ctrl.onName($taName)" autofocus></div>\n</div>',controller:["appState",function(a){function b(a){c.textAreaName=a}var c=this;c.onName=b,c.lang=a.lang,c.textAreaName=""}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittAnnotationField",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"="},template:'<div class="field"> 	<div class="label">Question type</div> 	<div class="input"> 	<select ng-model="$ctrl.data.data._plugin.questiontype" ng-options="{{$ctrl.setNgOpts(\'questionType\')}}"></select> 	</div> </div>',controller:["selectService","ittUtils",function(a,b){function c(){a.onSelectChange(d.data,{})}var d=this;d.setNgOpts=b.setNgOpts,d.getSelectOpts=a.getSelectOpts,c()}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittQuestionTypeSelect",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",doValidate:"=?",ittItemForm:"=?"},template:'<div class="field"> 	<div class="label">Question text 		<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Question Text is a required field"></itt-validation-tip> 	</div> 	<div class="input" do-validate="$ctrl.doValidate" on-emit-name="$ctrl.onName($taName)" sxs-input-i18n="$ctrl.data.data._plugin.questiontext" x-inputtype="\'textarea\'"></div> </div>',
controller:[function(){function a(a){b.textAreaName=a}var b=this;b.onName=a}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittQuestionTextField",a)}(),function(){function a(){return{restrict:"EA",scope:!0,template:'<div class="field"><div class="label">Answers</div></div> <div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index"> 	<div class="label"> 		{{$index | alpha}} &nbsp; 		<input type="checkbox" ng-model="distractor.correct" ng-if="item.data._plugin.questiontype == \'mc-formative\'"> 	</div> 	<div class="input" sxs-input-i18n="distractor.text" x-inputtype="\'textarea\'"></div> </div> <div class="field"> 	<div class="input"> 		<button ng-click="addDistractor($event)">Add distractor</button> 	</div> </div> <div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"> 	<div class="label">Feedback when correct</div> 	<div class="input" sxs-input-i18n="item.data._plugin.correctfeedback" x-inputtype="\'textarea\'"></div> </div> <div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'"> 	<div class="label">Feedback when incorrect</div> 	<div class="input" sxs-input-i18n="item.data._plugin.incorrectfeedback" x-inputtype="\'textarea\'"></div> </div>'}}angular.module("com.inthetelling.story").directive("ittQuestionOptions",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",itemForm:"=?"},template:'<div class="field" ng-if="$ctrl.getVisibility(\'display\')">	<div class="label">Display</div>	<div class="input">		<select ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)"			ng-model="$ctrl.data.layouts[$ctrl.layoutIndex]"			ng-options="{{$ctrl.setNgOpts(\'display\')}}"			itt-options-disabled="option.isDisabled for option in $ctrl.getSelectOpts(\'display\')">		</select>	</div></div><div class="field" ng-if="$ctrl.isImageFillTemplate">	<div class="label">Position</div>		<div class="input">		<select ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)" ng-model="$ctrl.itemForm.position" ng-options="{{$ctrl.setNgOpts(\'imagePosition\')}}"></select>	</div></div>',controller:["$scope","selectService","ittUtils",function(a,b,c){function d(){return f.data.templateUrl}function e(a){f.isImageFillTemplate=a&&"templates/item/image-fill.html"===a}var f=this;f.getVisibility=b.getVisibility,f.getSelectOpts=b.getSelectOpts,f.onItemFormUpdate=b.onSelectChange,f.setNgOpts=c.setNgOpts,f.layoutIndex="image"===f.data.producerItemType?0:1,a.$watch(d,e)}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittDisplaySelect",a)}(),function(){function a(){return{restrict:"EA",scope:!0,template:'<div class="field" ng-if="selectService.getVisibility(\'videoPosition\')"> 	<div class="label">Video Postion</div> 	<div class="input"> 		<select ng-model="item.layouts[0]" ng-options="option.value as option.name for option in selectService.getSelectOpts(\'video\')"></select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittVideoPositionSelect",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field"> 	<div class="label">Typography</div> 	<div class="input"> 		<select size="1" ng-model="itemForm.typography"> 			<option value="">(Default)</option> 			<option value="Sans">Sans</option> 			<option value="Serif">Serif</option> 			<option value="Book">Book</option> 			<option value="Swiss">Swiss</option> 		</select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittTypographySelect",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field"> 	<div class="label">Color</div> 	<div class="input"> 		<select size="1" ng-model="itemForm.color"> 			<option value="">(Default)</option> 			<option value="Invert">Invert</option> 			<option value="Sepia">Sepia</option> 			<option value="Solarized">Solarized</option> 			<option value="Vivid">Vivid</option> 		</select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittColorSelect",a)}(),function(){function a(){return{restrict:"EA",scope:!0,template:'<div class="field"> 	<div class="label"><span ng-if="episode">Display </span>Timestamp</div> 	<div class="input"> 		<select size="1" ng-model="itemForm.timestamp"> 			<option ng-if="episode" value="">(Default)</option> 			<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option> 			<option ng-if="item._type !== \'Scene\'" value="">(Inherit from layout)</option> 			<option value="None">Off</option> 			<option value="Inline">On</option> 		</select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittTimestampSelect",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field"> 	<div class="label">Highlight<span ng-if="episode"> Style</spann></div> 	<div class="input"> 		<select size="1" ng-model="itemForm.highlight"> 			<option ng-if="episode" value="">(Default)</option> 			<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option> 			<option ng-if="item._type !== \'Scene\' && !episode" value="">(Inherit from layout)</option> 			<option value="None">No highlight</option> 			<option value="Solid">Solid</option> 			<option value="Border">Border</option> 			<option value="Side">Side</option> 			<option value="Bloom">Translucent</option> 			<option value="Tilt">Tilt</option> 		</select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittHighlightSelect",a)}(),function(){function a(){return{restrict:"EA",template:'<div class="field"> 	<div class="label">Transition</div> 	<div class="input"> 		<select size="1" ng-model="itemForm.transition"> 			<option ng-if="episode" value="">(Default)</option> 			<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option> 			<option ng-if="item._type !== \'Scene\' && !episode" value="">(Inherit from layout)</option> 			<option value="None">No transition</option> 			<option value="Fade">Fade</option> 			<option value="SlideL">Slide left</option> 			<option value="SlideR">Slide right</option> 			<option value="Pop">Pop</option> 		</select> 	</div> </div>'}}angular.module("com.inthetelling.story").directive("ittTransitionSelect",a)}(),function(){function a(){return{restrict:"EA",scope:!0,template:'<div class="field"> 	<div class="label">File 		<itt-validation-tip ng-if="ittItemForm.itemAsset.$invalid" text="File is required"></itt-validation-tip> 	</div> 	<div class="input" ng-include="\'templates/producer/upload-producer.html\'"></div> </div>'}}angular.module("com.inthetelling.story").directive("ittFileField",a)}(),function(){function a(a,b){return{restrict:"A",terminal:!0,priority:1e5,link:function(c,d){var e=b(d.attr("itt-dynamic-model"))(c);d.removeAttr("itt-dynamic-model"),d.attr("ng-model",e),a(d)(c)}}}angular.module("com.inthetelling.story").directive("ittDynamicModel",a),a.$inject=["$compile","$parse"]}(),function(){function a(a){return{restrict:"EA",require:"^ngModel",scope:{item:"="},link:function(b,c,d,e){function f(){return b.item}function g(b){var c=b.templateUrl,d=b.asset;switch(c){case"templates/item/file.html":case"templates/item/image-plain.html":case"templates/item/image-inline.html":case"templates/item/image-inline-withtext.html":case"templates/item/image-caption-sliding.html":case"templates/item/image.html":case"templates/item/image-fill.html":case"templates/item/link-withimage-notitle.html":a.existy(d)?e.$setValidity("itemAsset",!0):e.$setValidity("itemAsset",!1);break;case"templates/item/link.html":case"templates/item/link-withimage.html":case"templates/item/link-modal-thumb.html":case"templates/item/link-descriptionfirst.html":case"templates/item/link-embed.html":e.$setValidity("itemAsset",!0)}}e&&(e.$validators.itemAsset=function(){return!0},b.$watch(f,g,!0))}}}angular.module("com.inthetelling.story").directive("ittValidAsset",a),a.$inject=["ittUtils"]}(),function(){function a(){return{scope:{onSelected:"&"},restrict:"A",link:function(a,b){b.bind("change",function(){a.$apply(function(){a.onSelected({files:b[0].files})})})}}}angular.module("com.inthetelling.story").directive("ittFilesHandler",a)}(),function(){function a(a){function b(a,b,c,d,e){for(var f,g=c.find("option"),h=0,i=0,j=g.length;j>h;h++){var k=angular.element(g[h]);""!=k.val()&&(f={},f[b]=d[i],k.attr("disabled",e(a,f)),i++)}}function c(c,d,e){var f=e.ittOptionsDisabled.match(/^\s*(.+)\s+for\s+(.+)\s+in\s+(.+)?\s*/),g=f[3],h=a(f[1]);c.$watch(g,function(a){a&&b(c,f[2],d,a,h)},!0),c.$watch(e.ngModel,function(e){var i=a(g)(c);e&&b(c,f[2],d,i,h)})}return{restrict:"EA",priority:0,require:"ngModel",link:c}}angular.module("com.inthetelling.story").directive("ittOptionsDisabled",a),a.$inject=["$parse"]}(),function(){function a(){return{restrict:"EA",template:'<div class="field">\n	<div class="label">Languages</div>\n	<div class="input">\n	<label>\n		<input type="checkbox" ng-model="langForm.en">English\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.es">Spanish\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.zh">Chinese\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.pt">Portuguese\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.fr">French\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.de">German\n	</label>\n	<label>\n		<input type="checkbox" ng-model="langForm.it">Italian\n	</label>\n	</div>\n</div>'}}angular.module("com.inthetelling.story").directive("ittLanguageFlags",a)}(),function(){function a(){return{restrict:"EA",scope:{data:"=",langForm:"=?"},template:'<div class="field">\n	<div class="label">Default Language</div>\n	<div class="input">\n		<select ng-model="$ctrl.data.defaultLanguage" ng-options="{{$ctrl.setNgOpts()}}" itt-options-disabled="option.isDisabled for option in $ctrl.langOpts"></select>\n	</div>\n</div>',controller:["$scope","selectService","ittUtils",function(a,b){function c(){return"option.value as option.name for option in $ctrl.langOpts"}function d(){return f.langForm}function e(a){f.langOpts=f.langOpts.map(function(b){return angular.forEach(a,function(a,c){b.value===c&&(b.isDisabled=!a)}),b})}var f=this;f.getSelectOpts=b.getSelectOpts,f.setNgOpts=c,f.langOpts=b.getSelectOpts("language"),a.$watch(d,e,!0)}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittLanguageSelect",a)}(),function(){function a(){return{restrict:"EA",scope:{text:"@",doInfo:"=?"},template:'<span class="tooltip-static">\n	<i class="fa fa-info-circle" ng-class="{\'error-red\': !doInfo, \'info-blue\': doInfo}"></i>\n	<span class="tooltip-text">{{text}}</span>\n</span>'}}angular.module("com.inthetelling.story").directive("ittValidationTip",a)}(),angular.module("com.inthetelling.story").directive("ittNarrativeTimeline",["$routeParams","$timeout","dataSvc","appState","authSvc","modelSvc","errorSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,templateUrl:"templates/player-timeline.html",link:function(b){d.init(),c.getNarrative(a.narrativePath).then(function(c){d.narrativeId=c._id,b.narrative=c;var f=e.getRoleForNarrative(c._id),h=e.getDefaultProductForRole(f);d.product=h,angular.forEach(c.timelines,function(c){(c._id===a.timelinePath||c.path_slug.en===a.timelinePath)&&(d.timelineId=c._id,c.episode_segments[0]&&(d.episodeId=c.episode_segments[0].episode_id,d.episodeSegmentId=c.episode_segments[0]._id,b.showPlayer=!0))}),d.episodeId||g.error({data:"Sorry, no episode was found in this timeline."})})}}}]),function(){function a(){return{restrict:"EA",scope:{onLogout:"&"},template:'<div>\n	<header class="nav__header">\n		<div class="nav__item">\n			<img src="images/Narrasys_Banner.svg"/>\n		</div>\n		<div class="nav__item">\n			<div class="nav__controls">\n				<div class="navControls__item item--left">\n					<div class="nav__user" ng-click="$ctrl.goToAccounts()">\n						<img ng-src="{{$ctrl.appState.user.avatar}}">\n						<a class="nav__button" ng-if="$ctrl.appState.user">{{$ctrl.appState.user.name}}</a>\n					</div>\n					<a class="nav__button" ng-if="$ctrl.currentPath !== \'/projects\'" href="/#/projects">My Projects</a>\n					<a class="nav__button" ng-if="$ctrl.currentPath !== \'/stories\'" href="/#/stories">My Narratives</a>\n				</div>\n				<div class="navControls__item item--right">\n					<a class="nav__button" ng-click="$ctrl.onLogout()">Log out</a>\n				<div>\n			</div>\n		</div>\n	</header>\n</div>',controller:["$location","appState",function(a,b){function c(){a.url("/account")}this.currentPath=a.path(),this.appState=b,this.goToAccounts=c}],controllerAs:"$ctrl",bindToController:!0}}angular.module("com.inthetelling.story").directive("ittNav",a)}();