"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error-404.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"}),$(document).on("keydown",function(b){"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&(27===b.keyCode&&(a.$emit("userKeypress.ESC"),b.preventDefault()),32===b.which&&(a.$emit("userKeypress.SPACE"),b.preventDefault()))})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.responseInterceptors.push(["$q",function(){function a(a){return a}function b(a){throw a}return function(c){return c.then(a,b)}}])}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){return function(c,d){a(c,d);var e=b.get("errorSvc");e.error(c,d)}}])}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/copyright.html",'TELLING STORY player &#169; {{now | date:\'yyyy\'}} <a href="http://inthetelling.com">IN THE TELLING</a>. All rights reserved. <a href="/privacy.html" target="_new">Privacy Policy</a>'),a.put("templates/episode/components/discovermode.html",'<div class="discoverMode" ng-show="appState.viewMode == \'discover\'">\n	<div class="fill windowBg bgLayer">\n		<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'">\n		</div>\n	</div>\n	<div itt-scene="scene" episode="episode"></div>\n	<div ng-if="(scene.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="fill overlay windowFg fgLayer">\n		<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowFg\'">\n		</div>\n	</div>\n</div>\n\n'),a.put("templates/episode/components/reviewmode.html",'<div class="reviewMode" ng-show="appState.viewMode == \'review\'">\n	<div itt-magnet id="reviewModeVideoMagnet" class="videoMagnet">\n		<img src="images/aspectratiopreserver-16x9.gif">\n	</div>\n	<div class="scene" ng-class="{navigable: scene.title}" ng-repeat="scene in episode.scenes" ng-if="!scene._internal">\n		<div class="pane mainPane">\n			<div class="content allowHighlights">\n				<h1 class="sceneTitle" ng-if="scene.title">{{scene.title}}</h1>\n\n				<div ng-if="appState.windowWidth < 480" class="item animate" ng-repeat="item in scene.items | isContent | filter:{cosmetic:false} | orderBy:\'start_time\'" ng-class="item.state" itt-item="item" forceTemplate="review-annotation">\n				</div>\n\n				<div ng-if="appState.windowWidth >= 480" class="item animate" ng-repeat="item in scene.items | isContent | annotation | filter:{cosmetic:false} | orderBy:\'start_time\'" ng-class="item.state" itt-item="item" forceTemplate="review-annotation">\n				</div>\n\n			</div>\n		</div>\n		<div ng-if="appState.windowWidth >= 480" class="pane altPane">\n			<div class="content allowHighlights">\n				<img ng-if="$index == 1" src="images/aspectratiopreserver-16x9.gif" class="videoPadding">\n				<!-- contentAlt -->\n				<div class="item animate" ng-repeat="item in scene.items | isContent | transmedia | filter:{cosmetic:false}" ng-class="item.state" itt-item="item" forceTemplate="review-transmedia">\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/episode/components/video.html",'<div itt-magnetized class="pane videoContainer">\n	<div class="video contentLayer" itt-video="episode.masterAsset.video"></div>\n	<div class="pane fill overlay fgLayer">\n		<div ng-class="item.styleCss + \' \' + item.state" itt-item="item" class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent">\n		</div>\n	</div>\n</div>\n'),a.put("templates/episode/components/watchmode.html",'<span ng-if="appState.viewMode == \'watch\'">\n	<div class="watchMode">\n		<div itt-magnet id="watchModeVideoMagnet" class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<span ng-if="!appState.hideCaptions">\n		<div class="item watchModeCaption animate" ng-repeat="item in scene.items | transcript | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item" forceTemplate="caption">\n		</div>\n	</span>\n</span>\n'),a.put("templates/episode/eliterate.html",'<div class="episode episode-eliterate" ng-class="episode.styleCss">\n\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<a class="eliterate logo" href="http://www.mindwires.com">\n			<img src="images/customer/eliterate-mindwires.svg" alt="Mindwires logo">\n		</a>\n\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n\n	</div>\n	<div class="banner-logo">\n		<img src="images/customer/eliterate-logo.svg" alt="E-Literate">\n	</div>\n\n</div>\n'),a.put("templates/episode/episode.html",'<div class="episode" ng-class="episode.styleCss">\n\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n</div>\n'),a.put("templates/episode/ewb.html",'<div class="episode episode-ewb" ng-class="episode.styleCss">\n\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n	<div class="banner-logo">\n		<img src="images/customer/ewb-logo.svg" alt="Engineers Without Borders">\n	</div>\n\n</div>\n'),a.put("templates/episode/gw.html",'<div class="episode episode-gw" ng-class="episode.styleCss">\n\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n	<div class="banner-logo">\n		<img src="images/customer/gw-logo.svg" alt="George Washington">\n	</div>\n\n</div>\n'),a.put("templates/episode/purdue.html",'<div class="episode episode-purdue" ng-class="episode.styleCss">\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n	<div class="banner-logo">\n		<img src="images/customer/purdue-logo.svg" alt="Purdue">\n	</div>\n\n</div>\n'),a.put("templates/episode/story.html",'<div class="episode episode-story" ng-class="episode.styleCss">\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n	<div class="banner-logo">\n		<img src="images/customer/tellingstory-logo.svg" alt="Telling STORY">\n	</div>\n\n</div>\n'),a.put("templates/episode/usc.html",'<div class="episode episode-usc" ng-class="episode.styleCss">\n	<span ng-include="\'templates/episode/components/reviewmode.html\'"></span>\n	<span ng-repeat="scene in episode.scenes | isCurrent">\n		<span ng-include="\'templates/episode/components/watchmode.html\'"></span>\n		<span ng-include="\'templates/episode/components/discovermode.html\'"></span>\n	</span>\n\n	<span ng-include="\'templates/episode/components/video.html\'"></span>\n\n	<div ng-if="appState.viewMode != \'watch\'" class="branding footer">\n		<!-- <img class="logo" src="images/customer/usc-footer.svg" alt="USC logo" style="margin-top:1em"> -->\n		<a class="itt logo" href="http://inthetelling.com">\n			<img src="images/itt.svg" alt="In The Telling logo">\n		</a>\n		<span class="copyright" ng-include="\'templates/copyright.html\'"></span>\n	</div>\n\n	<div class="banner-logo">\n		<img src="images/customer/usc-logo.svg" alt="USC">\n	</div>\n\n</div>\n'),a.put("templates/episodelist.html",'Episode list\n\n<div ng-controller="EpisodeListController">\n	<div ng-repeat="episode in episodes">\n		({{episode._id}}) {{episode.title}} -\n		<a href="#episode/{{episode._id}}">Episode</a> -\n		<a ng-click="authenticate(episode._id)">OAuth</a>\n		<br>\n	</div>\n</div>\n\n<div x-ng-controller="ErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/error-404.html",'<div class="errors">\n	<div class="error">\n		<h3>Error: no such route</h3>\n		<p><i>404. File not found. Sorry!</i></p>\n	</div>\n</div>\n'),a.put("templates/error.html",'<span ng-if="errors.length || notifications.length" class="errors">\n	<div class="error" ng-repeat="error in errors">\n		<a style="float: right;" ng-click="dismiss(error)">[x]</a>\n		<h3>Error: {{error.cause || error.exception.data || \'(unknown reason)\'}}</h3>\n		<p ng-if="error.exception.config.url">\n			<i>(While trying to load {{error.exception.config.url}})</i>\n		</p>\n		<p ng-if="error.exception.status == 401">\n			Please\n			<span ng-if="user.login_url">\n				<a ng-if="user.login_via_top_window_only" ng-click="resetAuth();" ng-href="{{user.login_url}}" target="_top">click here</a>\n				<a ng-if="!user.login_via_top_window_only" ng-click="resetAuth();" ng-href="{{user.login_url}}">click here</a>\n				to log back in.\n			</span>\n			<span ng-if="!user.login_url">\n				<a ng-click="resetAuth(); reload();">reset your session</a> and start over.\n			</span>\n		</p>\n		<a style="font-size: small" ng-click="showDetails= !showDetails">(show details)</a>\n		<pre ng-if="showDetails" style="font-size: small" ng-bind="error | pretty"></pre>\n	</div>\n	<div class="notification" ng-repeat="notification in notifications">\n		<a style="float: right;" ng-click="dismiss(notification)">[x]</a>\n		<p>{{notification}}</p>\n	</div>\n</span>\n'),a.put("templates/item/caption.html",'<div class="itemTemplate itemCaption">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName" ng-bind-html="item.annotator"></div>\n	</div>\n	<div class="text" ng-bind-html="item.annotation"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/debug.html",'<div class="itemTemplate">\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/edit.html",'<!-- <div ng-if="item" class="itemEdit">\n\n	<ul class="tabs">\n		<li><a ng-class="{active: !visibleTab || visibleTab == 0}" ng-click="visibleTab=0">Edit item content</a>\n		</li>\n		<li><a ng-class="{active: visibleTab ==1}" ng-click="visibleTab=1">Edit item appearance</a>\n		</li>\n	</ul>\n\n	<div class="tabcontents" ng-if="!visibleTab || visibleTab ==0">\n		<span ng-if="item.type==\'Annotation\'">\n			<label class="labelrow">\n				<span class="label">Speaker</span>\n				<span class="field">\n					<input type="text" ng-model="item.annotator">\n				</span>\n			</label>\n			<label class="labelrow">\n				<span class="label">Transcript</span>\n				<span class="field">\n					<textarea rows="5" ng-model="item.annotation"></textarea>\n				</span>\n			</label>\n		</span>\n\n		<span ng-if="item.type!=\'Annotation\'">\n			<label class="labelrow">\n				<span class="label">Title</span>\n				<span class="field">\n					<input type="text" ng-model="item.title">\n				</span>\n			</label>\n			<label class="labelrow">\n				<span class="label">Description</span>\n				<span class="field">\n					<textarea rows="5" ng-model="item.description"></textarea>\n				</span>\n			</label>\n			<div class="labelrow">\n				<span class="label"></span>\n				<label class="field">\n					<input type="checkbox" ng-model="item.required">Students are\n					<span ng-if="!item.required">not</span>\n					required to view this item\n				</label>\n			</div>\n		</span>\n\n		<span ng-if="item.type == \'Link\'">\n			<label class="labelrow">\n				<span class="label">Link</span>\n				<span class="field">\n					<input type="text" ng-model="item.url">\n				</span>\n			</label>\n		</span>\n\n		<span ng-if="item.type == \'Upload\'">\n			<label class="labelrow">[TODO: select from asset container / upload new asset]\n				<br>{{item.asset.url}}</label>\n		</span>\n\n\n		<label class="labelrow">\n			<span class="label">Start time</span>\n			<span class="field">\n				<input type="text" ng-model="item.start_time">\n			</span>\n		</label>\n		<div class="labelrow">\n			<span class="label">End time</span>\n			<label style="float:left;">\n				<input type="checkbox" ng-init="item.noEndTime = true" ng-model="item.noEndTime">\n				<span ng-if="item.noEndTime">Automatic</span>\n			</label>\n			<span class="field">\n				<input ng-if="!item.noEndTime" type="text" ng-model="item.end_time">\n			</span>\n		</div>\n		<div class="labelrow">\n			<span class="label">Stop item</span>\n			<label class="field">\n				<input type="checkbox" ng-model="item.stop">Timeline will\n				<span ng-if="!item.stop">not</span>\n				pause when this item enters\n			</label>\n		</div>\n	</div>\n\n	<div class="tabcontents" ng-if="visibleTab == 1">\n\n		<fieldset>\n			<legend>Item preview</legend>\n			<div class="itemPreview" ng-include="item.templateUrl"></div>\n		</fieldset>\n		<div>\n			TODO: improve editor UI(!); include remaining templates; style, layout options\n		</div>\n		<div class="labelrow">\n			<span class="label">Template</span>\n			<span class="field">\n				<select ng-model="item.templateUrl">\n					<option value="templates/item/item.html">Generic item</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/pullquote-noattrib.html">Pullquote (without attribution)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/pullquote.html">Pullquote (with attribution)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/text-h1.html">Primary header</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/text-h2.html">Secondary header</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript.html">Transcript</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript-withthumbnail.html">Transcript (with thumbnail)</option>\n					<option ng-if="item._type == \'Annotation\'" value="templates/item/transcript-withthumbnail-alt.html">Transcript (with thumbnail / alt)</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/link.html">Default link</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/image-fill.html">Plain image</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload.html">Upload (generic)</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-inline.html">Inline image</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-thumbnail.html">Image thumbnail</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-caption.html">Image with caption</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-caption-sliding.html">Image with sliding caption</option>\n					<option ng-if="item._type != \'Annotation\'" value="templates/item/upload-linkonly.html">External link, no inline framing</option>\n				</select>\n			</span>\n		</div>\n\n		<div class="labelrow">\n			<span class="label">Cosmetic</span>\n			<label class="field">\n				<input type="checkbox" ng-model="item.cosmetic">\n				<span ng-if="item.cosmetic">This is a decorative item, not to be included in search, bibliography, etc.</span>\n				<span ng-if="!item.cosmetic">This is a content item.</span>\n\n			</label>\n		</div>\n\n\n		<div class="labelrow">\n			<span class="label">Layout</span>\n			<label class="field">\n				<select size="1" ng-model="item.layouts[0]">\n					<option value="" disabled>Content layouts:</option>\n\n					<option value="inline">Inline</option>\n					<option value="sidebarL">TODO Left sidebar</option>\n					<option value="sidebarR">TODO Right sidebar</option>\n					<option value="burstL">TODO Burst left margin</option>\n					<option value="burstR">TODO Burst right margin</option>\n					<option value="burst">TODO Burst both margins</option>\n					<option value="windowFg">Full screen</option>\n					<option value="" disabled>Decorative layouts:</option>\n					<option value="windowBg">Full screen background</option>\n					<option value="mainBg">Background of main content pane</option>\n					<option value="altBg">Background of secondary content pane</option>\n					<option value="mainFg">Foreground of main content pane</option>\n					<option value="altFg">Foreground of secondary content pane</option>\n					<option value="videoOverlay">Overlay video</option>\n				</select>\n			</label>\n		</div>\n\n		<div class="labelrow">\n			<span class="label">Styles</span>\n			<div class="field">\n				<label>\n					<input type="checkbox" ng-model="item.customstyles">\n					<span ng-if="item.customstyles">Customize the appearance of this item</span>\n					<span ng-if="!item.customstyles">Use this episode\'s default item styles</span>\n				</label>\n\n				<div ng-if="item.customstyles">\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTransition">\n						<option value="">Default transition</option>\n						<option value="transitionNone">No transition</option>\n						<option value="transitionFade">Fade in / fade out</option>\n						<option value="transitionSlideL">Slide to left</option>\n						<option value="transitionSlideR">Slide to right</option>\n						<option value="transitionPop">"Pop" in and out</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTypography">\n						<option value="">Default typography</option>\n						<option value="typographySerif">Serif</option>\n						<option value="typographySans">Sans</option>\n						<option value="typographyBook">Book</option>\n						<option value="typographySwiss">Swiss</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customColor">\n						<option value="">Default colors</option>\n						<option value="colorInvert">Invert colors</option>\n						<option value="colorSepia">Sepia colors</option>\n						<option value="colorSolarized">Solarized colors</option>\n						<option value="colorVivid">Vivid colors</option>\n					</select>\n\n					<select ng-change="updateStyles()" size="1" ng-model="item.customTimestamp">\n						<option value="">Default timestamp</option>\n						<option value="timestampNone">No timestamp</option>\n						<option value="timestampSmall">Small timestamp</option>\n						<option value="timestampInline">Inline timestamp</option>\n						<option value="timestampSidebar">Sidebar timestamp</option>\n\n					</select>\n\n\n				</div>\n\n\n				<!-- \n		<br>styleCss:\n		<input type="text" ng-model="item.styleCss">\n		<br>layoutCss: -->\n			</div>\n		</div>\n\n\n	</div>\n\n\n	<input type="button" ng-click="save()" value="Save">\n	<input type="button" ng-click="cancelEdit()" value="Cancel">\n	<a ng-click="itemEditDebug=!itemEditDebug">Debug</a>\n	<pre style="max-height: 200px; overflow-y: scroll" ng-if="itemEditDebug">{{item | pretty}}</pre>\n\n</div>\n -->'),a.put("templates/item/image-caption-sliding.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="captionContainer touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n		<div class="caption slidingcaption">\n			<div class="title" ng-bind-html="item.title"></div>\n			<div class="text" ng-bind-html="item.description"></div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/image-caption.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="captionContainer touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n		<div class="caption">\n			<div class="title" ng-bind-html="item.title"></div>\n			<div class="text" ng-bind-html="item.description"></div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/image-fill.html",'<!-- one or the other of .item background-image and fillImg will be made invisible, depending on fill type -->\n<div class="itemTemplate imageFill" style="{{item.backgroundImage}}">\n	<img class="fillImg" ng-src="{{item.asset.url}}">\n</div>\n'),a.put("templates/item/image-inline.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="touchable">\n		<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/image-linkonly.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="outgoingLink(item.asset.url)" ng-bind-html="item.title || \'(Untitled)\'"></a>\n		</div>\n		<div class="text" ng-bind-html="item.description"></div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/image-plain.html",'<div class="itemTemplate imagePlain">\n<div class="touchable">\n	<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n	<div class="touchableIndicator"></div>\n</div>\n</div>'),a.put("templates/item/image-thumbnail.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click="toggleDetailView()">\n		<img ng-src="{{item.asset.url}}">\n		<div class="touchableIndicator"></div>\n	</div>\n	<div class="text">\n		<div class="title" ng-bind-html="item.title"></div>\n		<div class="text" ng-bind-html="item.description"></div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/image.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-click="toggleDetailView()" ng-bind-html="item.title || \'(Untitled)\'"></a>\n		</div>\n		<div ng-bind-html="item.description"></div>\n	</div>\n	<div class="itemDetail" x-ng-if="item.showInlineDetail">\n		<div class="touchable" style="position:relative">\n			<img x-ng-click="forceModal()" ng-src="{{item.asset.url}}">\n			<div class="touchableIndicator"></div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/link-embed.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title" ng-bind-html="item.title"></div>\n		<div ng-bind-html="item.description"></div>\n	</div>\n	<div class="iframeContainer">\n		<iframe ng-src="{{item.url}}"></iframe>\n	</div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/link.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-if="item.noEmbed" class="escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.title ||\'(Untitled)\'"></a>\n			<a ng-if="!item.noEmbed" ng-click="toggleDetailView()"ng-bind-html="item.title ||\'(Untitled)\'"></a>\n		</div>\n		<div ng-bind-html="item.description"></div>\n	</div>\n	<div class="itemDetail" ng-if="item.showInlineDetail">\n		<a ng-if="!item.noExternalLink" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a>\n		<div class="iframeContainer">\n			<iframe ng-src="{{item.url}}"></iframe>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>'),a.put("templates/item/modal.html",'<div class="modal" ng-click="dismiss();">\n	<div ng-if="item._type == \'Link\'" class="modalmenu">\n		<a href="{{item.url}}" target="_blank" class="escapelink">(new window)</a>\n	</div>\n	<div ng-if="item._type == \'Link\'" class="iframeContainer">\n		<iframe x-ng-src="{{item.url}}"></iframe>\n	</div>\n	<div class="modalimage" ng-if="item._type == \'Upload\'">\n		<img ng-src="{{item.asset.url}}">\n	</div>\n</div>\n'),a.put("templates/item/multiplechoice.html",'<!-- WIP -->\n<div class="itemTemplate multipleChoice">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName" ng-bind-html="item.annotator"></div>\n	</div>\n\n	<div class="multipleChoiceQuestion">\n		<!-- begin plugin.  TODO make this its own directive -->\n		<p>{{plugin.question}}</p>\n\n		<div ng-repeat="distractor in plugin.distractors">\n			<label ng-click="setChoice($index)" ng-class="{\n				correct: plugin.hasBeenAnswered && distractor.correct,\n				incorrect: plugin.hasBeenAnswered && !distractor.correct\n			}">\n				<input type="radio" name="fnord" ng-disabled="plugin.hasBeenAnswered" ng-model="$parent.plugin.selectedDistractor" value="{{$index}}">{{distractor.text}}\n			</label>\n		</div>\n\n		<input type="button" ng-disabled="plugin.hasBeenAnswered" value="Check your answer" ng-click="scoreQuiz()">\n		<!-- end plugin -->\n\n		<p ng-repeat="distractor in plugin.distractors" ng-if="distractor.selected">{{distractor.feedback}}</p>\n	</div>\n\n	<div class="clear"></div>\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<a ng-if="itemDebug" ng-click="resetQuestion()">(Reset question)</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/item/pullquote-noattrib.html",'<div class="itemTemplate headerItem">\n	<div class="pullquote" ng-bind-html="item.annotation"></div>\n</div>\n'),a.put("templates/item/pullquote.html",'<div class="itemTemplate headerItem">\n	<div class="pullquote" ng-bind-html="item.annotation"></div>\n	<div class="pullquoteSpeaker" ng-bind-html="item.annotator"></div>\n</div>\n'),a.put("templates/item/review-annotation.html",'<div>\n	<div ng-if="item.isTranscript" class="itemTemplate">\n		<div class="itemHead">\n			<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n			<div class="authorName" ng-bind-html="item.annotator"></div>\n		</div>\n		<div class="text" ng-bind-html="item.annotation"></div>\n	</div>\n	<div ng-if="!item.isTranscript" ng-include="item.templateUrl"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/review-transmedia.html",'<div class="itemTemplate">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="category">\n			<!--{{item.category}}-->\n			<span ng-if="item.required">(Required viewing)</span>\n		</div>\n	</div>\n	<div class="text">\n		<div class="title">\n			<a ng-if="item.noEmbed" class="escapelink" ng-click="outgoingLink(item.url)" ng-bind-html="item.title || \'(Untitled)\'"></a>\n			<a ng-if="!item.noEmbed" ng-click="toggleDetailView()" ng-bind-html="item.title || \'(Untitled)\'"></a>\n		</div>\n		<div ng-bind-html="item.description"></div>\n	</div>\n	<div class="itemDetail" ng-if="item.showInlineDetail && item._type == \'Link\'">\n		<a ng-if="!item.noExternalLink" ng-click="outgoingLink(item.url)" class="escapelink">(new window)</a>\n		<div class="iframeContainer">\n			<iframe ng-src="{{item.url}}"></iframe>\n		</div>\n	</div>\n	<div class="itemDetail" ng-if="item.showInlineDetail && item._type != \'Link\'">\n		<div class="touchable" style="position:relative">\n			<img ng-click="forceModal()" ng-src="{{item.asset.url}}">\n			<div class="touchableIndicator"></div>\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>'),a.put("templates/item/searchresults.html",'<div>\n	<span class="displayTime">\n		<a ng-click="seek(item.start_time, item._id)">{{item.displayStartTime}}</a>\n	</span>\n	<span class="type" ng-bind-html="(item.title || item.annotator) | highlightSubstring: searchText"></span>\n	<div class="description" ng-bind-html="(item.description || item.annotation) | highlightSubstring: searchText"></div>\n\n</div>\n'),a.put("templates/item/text-h1.html",'<div class="itemTemplate headerItem">\n	<h2 ng-bind-html="item.annotation"></h2>\n</div>\n'),a.put("templates/item/text-h2.html",'<div class="itemTemplate headerItem">\n	<h3 ng-bind-html="item.annotation"></h3>\n</div>\n'),a.put("templates/item/transcript-withthumbnail-alt.html",'<div class="itemTemplate transcriptWithThumbnail">\n	<div class="icon" style="float:right; margin-right: 0.5em;">\n		<img ng-src="{{item.asset.url}}">\n	</div>\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n	</div>\n	<div class="authorName" ng-bind-html="item.annotator"></div>\n	<div class="text" ng-bind-html="item.annotation"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/transcript-withthumbnail.html",'<div class="itemTemplate transcriptWithThumbnail">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n	</div>\n	<div class="icon" style="float:left; margin-right: 0.5em;">\n		<img ng-src="{{item.asset.url}}">\n		<div class="clear"></div>\n	</div>\n	<div class="authorName" ng-bind-html="item.annotator"></div>\n	<div class="text" ng-bind-html="item.annotation"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/transcript.html",'<div class="itemTemplate transcript">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		<div class="authorName" ng-bind-html="item.annotator"></div>\n	</div>\n	<div class="text" ng-bind-html="item.annotation"></div>\n	<div class="clear"></div>\n</div>\n'),a.put("templates/item/usc-badges.html",'<!-- WIP -->\n\n<div class="itemTemplate uscBadges" ng-if="true || plugin.eligibleForBadges">\n	<div class="itemHead">\n		<div class="startTime displayTime" x-ng-click="seek(item.start_time)">{{item.displayStartTime}}</div>\n		This is for testing the credly badge.\n	</div>\n\n\n	<h3>{{plugin.achievement}}</h3>\n\n	<div ng-repeat="req in plugin.requirements">\n		{{req.name}}:\n		<i ng-if="req.achieved">Complete</i>\n		<i ng-if="!req.achieved">Incomplete</i>\n	</div>\n\n\n	<p ng-if="plugin.totalAchieved != plugin.requirements.length">\n		You have completed {{plugin.totalAchieved}} of {{plugin.requirements.length}} parts of this achievement\n	</p>\n\n	<div ng-if="plugin.totalAchieved == plugin.requirements.length && ! plugin.gotBadge">\n		<p>YOU WIN THE INTERNETS</p>\n\n		You\'re eligible for a badge from credly.com. Enter your email address to claim it:\n		<input type="text" ng-model="plugin.userEmail">\n		<input type="button" value="Go" ng-click="badger()">\n\n		<span ng-if="plugin.gettingBadge">Getting your badge...</span>\n\n	</div>\n	<div ng-if="plugin.gotBadge">\n		Your badge is in the mail.\n		<span ng-if="plugin.alreadyHadBadge">(It looks like you\'ve already acquired this badge; you might want to check your spam folder for an email from credly.com.)</span>\n	</div>\n\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/player.html",'<div class="player" ng-class="{\n	isFramed: appState.isFramed,\n	producer: appState.producer,\n	editBgLayer: editLayer.bgLayer,\n	editFgLayer: editLayer.fgLayer,\n	editContentLayer: editLayer.contentLayer,\n	editScene: editLayer.scene\n	}">\n	<div class="toolbar">\n		<div class="modegroup buttongroup">\n			<a class="button button-watch" ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')">\n				<span>Watch</span>\n			</a>\n			<a class="button button-discover" ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')">\n				<span>Discover</span>\n			</a>\n			<a class="button button-review" ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')">\n				<span>Review</span>\n			</a>\n		</div>\n		<!-- <div ng-if="appState.producer && appState.viewMode == \'discover\'" class="buttongroup">\n			<a class="button" ng-click="editLayer(\'scene\');">Scene<span>Edit the scene layout (TODO)</span></a>\n			<a class="button" ng-click="editLayer(\'bgLayer\');">BG<span>Edit the background layer</span></a>\n			<a class="button" ng-click="editLayer(\'contentLayer\');">C<span>Edit the content layer</span></a>\n			<a class="button" ng-click="editLayer(\'fgLayer\');">FG<span>Edit the foreground layer</span></a>\n			<a class="button" ng-click="editLayer(\'\');">All<span>Show everything</span></a>\n		</div> -->\n		<div ng-if="appState.isFramed" class="escapegroup buttongroup">\n			<a ng-click="framebreaker($event);" class="button button-mainframeescape" ng-href="{{framebreakerUrl}}" target="_new">\n				<span>New window</span>\n			</a>\n		</div>\n		<div class="searchgroup buttongroup" ng-class="{cur: show.searchPanel}">\n			<a class="button button-search" ng-click="toggleSearchPanel()">\n				<span>Search</span>\n			</a>\n			<input id="searchtext" type="text" ng-model="searchText" />\n		</div>\n	</div>\n	<div itt-episode></div>\n\n	<div class="toolbar-bottom" ng-mouseenter="showControls();" ng-click="showControls();" ng-mouseleave="allowControlsExit()" ng-show="appState.videoControlsActive">\n		<div class="toolbar-bottom-fill">\n			<div ng-show="show.navPanel" class="navPanel" ng-class="episode.styleCss">\n				<div class="scene" x-ng-if="scene.title" x-ng-repeat="scene in episode.scenes" x-ng-class="{currentScene: scene.isCurrent}" x-ng-click="seek(scene.start_time)">\n					<span class="displayTime">{{scene.displayTime}}</span>\n					<p>\n						<a ng-bind-html="scene.title"></a>\n						<br>\n						<span ng-bind-html="scene.description"></span>\n					</p>\n				</div>\n			</div>\n\n			<!-- <div ng-if="appState.editing" itt-item-editor="appState.editing"></div> -->\n			<div itt-timeline></div>\n		</div>\n	</div>\n	<div class="toolbar-bottom-controltrigger" ng-mouseenter="showControls();" ng-click="showControls();"></div>\n</div>\n\n<div class="autoscroll" ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click="enableAutoscroll()">\n	<img src="/images/autoscroll.svg" width="32" height="32">\n</div>\n\n<div ng-show="show.navPanel || show.searchPanel || show.helpPanel" class="modal-backdrop" ng-click="hidePanels()"></div>\n\n<!-- ITEM DETAIL -->\n<div ng-show="appState.itemDetail" class="modal-backdrop" ng-click="appState.itemDetail=false"></div>\n<div ng-if="appState.itemDetail" itt-item-detail-modal="appState.itemDetail"></div>\n\n<!-- SEARCH -->\n<div ng-show="show.searchPanel" class="searchPanel">\n	<div ng-if="show.searchPanel" itt-search-panel>This will be the search panel</div>\n</div>\n\n<!-- HELP -->\n<div ng-if="show.helpPanel" class="helpPanel">\n	<div class="arrow-up"></div>\n	<p>Welcome to TELLING STORY! You can switch at any time between these views &#8212; don\'t worry, you won\'t lose your place:</p>\n	<ul>\n		<li class="video">\n			<h3>Watch</h3>\n			<p>Just the video, no frills.</p>\n		</li>\n		<li class="directed">\n			<h3>Discover</h3>\n			<p>The guided, synchronized view of the video and related content.</p>\n		</li>\n		<li class="explore">\n			<h3>Review</h3>\n			<p>Read the full transcript and all the related transmedia in one convenient list.</p>\n		</li>\n	</ul>\n	<a class="goAway" x-ng-click="noMoreHelp()" href="javascript:void 1;">Don\'t show this again</a>\n</div>\n\n<div ng-if="loading" class="loading">\n	<div class="spinner">\n		<div class="rotating pie"></div>\n		<div class="filler pie"></div>\n		<div class="mask"></div>\n	</div>\n	Loading\n</div>\n\n\n<div ng-controller="ErrorController" ng-include="\'templates/error.html\'"></div>\n<!-- \n<a href="javascript:void 1;" ng-click="showDebug=!showDebug">DEBUG:</a>\n<pre ng-if="showDebug === true">{{appState | pretty }}</pre>\n<pre ng-if="showDebug === true">{{episode | pretty}}</pre>\n -->\n'),a.put("templates/producer/episode.html",'<div class="producer">\n\n	TODO?\n</div>\n'),a.put("templates/scene/1col.html",'<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div itt-magnet class="videoMagnet" ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}">\n		<img src=" images/aspectratiopreserver-16x9.gif">\n	</div>\n	<div class="col">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar\n			}">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item"\n				></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colL.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div class="clear"></div>\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n			</div>\n			<div class="clear "></div>\n		</div>\n		<div class="fill fgLayer overlay">\n			<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/2colR.html",'<div class="scene twocol" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="videoPositioner">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n	</div>\n	<div class="col col1">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif" class="matchVideoHeight ">\n				<div class="clear"></div>\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col col2">\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (mainContentItems | isCurrent).length == 1\n					: (mainContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: mainContentHasLeftSidebar, \n				hasRightSidebar: mainContentHasRightSidebar\n			}">\n				<img src="images/aspectratiopreserver-16x9.gif " class="matchVideoHeight ">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear "></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/centered.html",'<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: (contentItems | isCurrent).length == 1,\n				allowHighlights: !showCurrent\n			}">\n				<div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerH.html",'<!--\nVideo, Main, Alt:\n___________\n|V/M |M/V |\n|____|____|\n|A        |\n|         |\n|_________|\nshowCurrent is forced in Main.\n-->\n\n<div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="row">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane matchVideoHeight">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="row">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar\n			}">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/cornerV.html",'<!--\nVideo, Main, Alt:\n___________    ___________\n|V   |A   |    |A   |V   |\n|____|    |    |    |____|\n|M   |    |    |    |M   |\n|    |    |    |    |    |\n|____|____|    |____|____|\nshowCurrent is forced in main.\n-->\n\n<div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state">\n	<div class="col">\n		<div itt-magnet class="videoMagnet">\n			<img src="images/aspectratiopreserver-16x9.gif">\n		</div>\n		<div class="pane mainPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{singleitem: mainItems.length==1}">\n				<div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n	<div class="col">\n		<div class="pane altPane stretchToViewport">\n			<div class="fill bgLayer">\n				<div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n			<div class="content contentLayer" ng-class="{\n				singleitem: showCurrent\n					? (altContentItems | isCurrent).length == 1\n					: (altContentItems).length == 1, \n				allowHighlights: !showCurrent,\n				hasLeftSidebar: altContentHasLeftSidebar, \n				hasRightSidebar: altContentHasRightSidebar\n			}">\n				<div \n					class="item animate" \n					ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" \n					ng-class="item.styleCss + \' \' + item.state" itt-item="item">\n				</div>\n				<div class="clear"></div>\n			</div>\n			<div class="fill fgLayer overlay">\n				<div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("templates/scene/debug.html","\n<pre>{{scene | pretty}}</pre>"),a.put("templates/scene/landingscreen.html",'<div class="landingscreen stretchToViewport">\n	<div class="pane introtext">\n		<h1 ng-bind-html="episode.title"></h1>\n		<p ng-bind-html="episode.description"></p>\n	</div>\n	<div itt-magnet class="videoMagnet">\n		<img src="images/aspectratiopreserver-16x9.gif">\n	</div>\n	<div class="clear"></div>\n</div>\n\n'),a.put("templates/searchpanel.html",'<div ng-class="episode.styleCss">\n	<div class="searchfilters">\n		<label ng-show="sortBy!==\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" ng-model="sortBy" value="startTime">Sorted by type\n		</label>\n		<label ng-show="sortBy===\'startTime\'">\n			<input type="radio" name="searchsort" id="searchsort" ng-model="sortBy" value="type">Sorted by time\n		</label>\n	</div>\n	<div class="scrollContainer">\n		<div class="searchResults">\n			<div ng-if="sortBy == \'startTime\'">\n				<div ng-repeat="scene in episode.scenes">\n					<h3 ng-if="sceneItems.length > 0 && scene.title" ng-bind-html="scene.title"></h3>\n					<div  class="item" ng-repeat="item in sceneItems=\n						(scene.items \n						| orderBy:\'startTime\' \n						| filter:{\'searchableText\': searchText, \'cosmetic\': false}\n						)" ng-include="\'templates/item/searchresults.html\'">\n					</div>\n				</div>\n			</div>\n\n			<!-- sorted by type -->\n			<div ng-if="sortBy == \'type\'">\n				<div ng-repeat="(typeID,showType) in searchTypes" ng-if="showType">\n					<h3 ng-if="typeItems.length > 0">{{searchTypeNames[typeID]}}</h3>\n					<div class="item" ng-repeat="item in typeItems=\n						(episode.items \n						| orderBy:\'startTime\' \n'+"						| filter:{'type': typeID, 'searchableText': searchText, 'cosmetic': false}\n						)\" ng-include=\"'templates/item/searchresults.html'\">\n					</div>\n				</div>\n			</div>\n			<div ng-if=\"(episode.items | filter:{'searchableText': searchText, 'cosmetic': false}).length == 0\">\n				(Nothing matched your search.)\n			</div>\n		</div>\n	</div>\n</div>\n"),a.put("templates/timeline.html",'<div class="timeline">\n\n	<div class="progressbarBox">\n		<div class="pbarTop">\n			<!-- \n\n			UI confused too many people; remove this until it\'s needed by sxs, producer, or multiple-episode nav\n\n			<a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click="zoomOut()">\n				<span class="control-text">Zoom out</span>\n			</a>\n			<a class="button button-zoomin" ng-click="zoomIn()">\n				<span class="control-text">Zoom in</span>\n			</a>\n			-->\n		</div>\n		<div class="pbarMain">\n			<div class="progressbar">\n				<div class="mask">\n					<div class="progressbarContainer" style="width: {{zoomLevel}}00%">\n						<div class="played" ng-style="{width: markerPercent(appState.time)+\'%\'}"></div>\n						<!-- <div class="buffered" style="width: TODO%"></div> -->\n					</div>\n				</div>\n				<!-- unmasked parts of timeline -->\n				<div class="progressbarContainer" style="width: {{zoomLevel}}00%;">\n					<div class="handle" ng-show="isSeeking " ng-style="{left: markerPercent(willSeekTo)+\'%\'}">\n						<div class="tip">{{willSeekTo | asTime}}</div>\n					</div>\n					<div class="tooltip" ng-if="event.showTooltip" ng-repeat="event in timeline.markedEvents " ng-style="{left: markerPercent(event.start_time)+\'%\'}">\n						<span class="content" ng-bind-html="event.title"></span>\n						<div class="tooltip-arrow"></div>\n					</div>\n				</div>\n				<div class="playhead mask">\n					<!-- interactive parts of timeline -->\n					<div class="progressbarContainer " ng-style="{width: zoomLevel+\'00%\'}">\n						<div class="marker" ng-mouseover="showTooltip(event);" ng-mouseout="hideTooltip(event)" ng-repeat="event in timeline.markedEvents" ng-style="{left: markerPercent(event.start_time)+\'%\'}"></div>\n					</div>\n				</div>\n			</div>\n			<a ng-class="{invisible: appState.time == 0}" class="button button-prev" ng-click="prevScene()">\n				<span class="control-text">Previous</span>\n			</a>\n			<div class="tooltip sceneMenuTooltip" ng-if="sceneMenuToolTip">\n				<span class="content">Scene-by-scene navigation</span>\n				<div class="tooltip-arrow"></div>\n			</div>\n\n			<a class="button-scenemenu" ng-click="toggleNavPanel();" ng-mouseover="showSceneMenuTooltip(true)" ng-mouseout="showSceneMenuTooltip(false)">\n				<span class="control-text">Scenes</span>\n			</a>\n			<a ng-class="{invisible: appState.time == appState.duration}" class="button button-next" ng-click="nextScene()">\n				<span class="control-text">Next</span>\n			</a>\n		</div>\n		<div class="pbarBottom">\n			<span class="timedisplay">\n				{{appState.time | asTime}} / {{appState.duration | asTime}}\n				<!-- playback rate not currently supported in youtube or on iOS -->\n				<span ng-if="appState.videoType == \'video\' && !(appState.isTouchDevice)">\n					<a class="button-speedcontrol" ng-if="appState.timeMultiplier == 1" ng-click="setSpeed(1.25)">&nbsp;</a>\n					<a class="button-speedcontrol" ng-if="appState.timeMultiplier == 1.25" ng-click="setSpeed(1.5)">x1.25</a>\n					<a class="button-speedcontrol" ng-if="appState.timeMultiplier == 1.5" ng-click="setSpeed(2)">x1.5</a>\n					<a class="button-speedcontrol" ng-if="appState.timeMultiplier == 2" ng-click="setSpeed(0.75)">x2</a>\n					<a class="button-speedcontrol" ng-if="appState.timeMultiplier == 0.75" ng-click="setSpeed(1)">x0.75</a>\n				</span>\n			</span>\n\n			<a ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}">\n				<span class="control-text">Captions</span>\n			</a>\n\n			<!-- <a ng-if="!appState.isTouchDevice" class="button button-fullscreen" ng-class="{active: appState.isInFullscreenMode}" ng-click="toggleFullscreen()">\n    <span class="control-text">Fullscreen</span>\n</a>\n -->\n			<span ng-if="!appState.isTouchDevice">\n				<a class="button button-mute {{audioIcon()}}" ng-click="toggleMute()">\n					<span class="control-text">Mute</span>\n				</a>\n				<div class="volumebar" ng-mousedown="userChangingVolume($event)">\n					<div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div>\n				</div>\n			</span>\n		</div>\n	</div>\n\n	<a class="button button-play" ng-if="appState.timelineState == \'paused\'" ng-click="play()">\n		<span class="control-text">Play</span>\n	</a>\n	<a class="button button-pause" ng-if="appState.timelineState != \'paused\'" ng-click="pause()">\n		<span class="control-text">Pause</span>\n	</a>\n\n\n</div>\n'),a.put("templates/video.html",'<div class="video">\n	<iframe id="ytplayer{{uid}}" ng-if="video.youtube" ng-src="{{video.youtube + \'?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&wmode=opaque&rel=0\'}}"></iframe>\n	<video ng-if="!video.youtube">\n		<source class="mpeg4" ng-if="video.mpeg4" ng-src="{{video.mpeg4}}" type="video/mp4" />\n		<source class="webm" ng-if="video.webm" ng-src="{{video.webm}}" type="video/webm" />\n		<p>Oh no! Your browser does not support the HTML5 Video element.</p>\n	</video>\n	<div ng-click="videoClick()" class="videoMask" ng-class="{\n		play: appState.timelineState == \'paused\',\n		buffering: appState.timelineState == \'buffering\',\n		firstplay: !appState.hasBeenPlayed,\n		endofvideo: appState.time == video.duration\n	}">\n</div>\n')
}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.player").factory("appState",["$interval","$filter","config",function(a){var b={};return b.init=function(){b.user={},b.episodeId=!1,b.isFramed=window.parent!=window,b.isTouchDevice=navigator.platform.match(/iPad|iPod|iPhone/)||navigator.userAgent.match(/Android/),b.windowWidth=0,b.windowHeight=0,b.viewMode=angular.element(window).width()>480?"discover":"review",b.time=0,b.timeMultiplier=1,b.duration=0,b.timelineState="paused",b.hasBeenPlayed=!1,b.volume=100,b.muted=!1,b.hideCaptions=!1,b.show={searchPanel:!1,helpPanel:!1,navPanel:!1},b.videoControlsActive=!1,b.itemDetail=!1,b.autoscroll=!1,b.autoscrollBlocked=!1,b.editing=!1},b.init(),a(function(){b.windowHeight=angular.element(window).height(),b.windowWidth=angular.element(window).width()},50,0,!1),b.isTouchDevice&&(document.getElementById("CONTAINER").className="touchDevice"),b}]),angular.module("com.inthetelling.player").factory("authSvc",["config","$routeParams","$http","$q","$location","appState",function(a,b,c,d,e,f){var g={};return g.roles=[],g.userHasRole=function(a){for(var b=0;b<g.roles.length;b++)if(g.roles[b]===a)return!0;return!1},g.authenticate=function(){var a=d.defer();if(b.key){var h=b.key;e.search("key",null),g.getAccessToken(h).then(function(){a.resolve()})}else if(c.defaults.headers.common.Authorization)a.resolve();else if(localStorage&&localStorage.storyAuth){var i=angular.fromJson(localStorage.storyAuth);f.user=i,c.defaults.headers.common.Authorization='Token token="'+i.access_token+'"',a.resolve()}else g.getNonce().then(function(b){g.getAccessToken(b).then(function(){a.resolve()})});return a.promise},g.getNonce=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){a.nonce?b.resolve(a.nonce):a.login_url?a.login_via_top_window_only?window.top.location.href=a.login_url:window.location.href=a.login_url:b.reject()}).error(function(){b.reject()}),b.promise},g.getAccessToken=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){f.user=a;try{localStorage.setItem("storyAuth",JSON.stringify(a))}catch(b){}g.roles=a.roles,c.defaults.headers.common.Authorization='Token token="'+a.access_token+'"',e.resolve(a)}).error(function(){e.reject()}),e.promise},g}]),angular.module("com.inthetelling.player").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc","errorSvc",function(a,b,c,d,e,f,g,h){var i={};i.getEpisodeList=function(){var c=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+"/v1/episodes").success(function(a){c.resolve(a)}).error(function(){})}),c.promise},i.getEpisode=function(a){g.episodes[a]||(g.cache("episode",{_id:a}),c.local||f.authenticate().then(function(){m().then(function(){p(a)},function(){})},function(){}))};var j={template:{},layout:{},style:{}},k=!1,l=a.defer(),m=function(){if(k===!0)l.resolve();else{if("in progress"===k)return l.promise;k="in progress",a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){n("templates",a[0].data),n("layouts",a[1].data),n("styles",a[2].data),k=!0,l.resolve()},function(){k=!1,l.reject()})}return l.promise},n=function(a,b){angular.forEach(b,function(b){"templates"===a?j.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types?b.event_types[0]:void 0,displayName:b.name}:"layouts"===a?j.layout[b._id]={id:b._id,css:b.css_name,displayName:b.display_name}:"styles"===a&&(j.style[b._id]={id:b._id,css:b.css_name,displayName:b.display_name})})},o=function(a){if(a.template_id&&(j.template[a.template_id]?(a.templateUrl=j.template[a.template_id].url,delete a.template_id):h.error({data:"Couldn't get templateUrl for id "+a.template_id})),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){j.layout[a]?b.push(j.layout[a].css):h.error({data:"Couldn't get layout for id "+a})}),b.length>0&&(a.layouts=b),delete a.layout_id}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){j.style[a]?c.push(j.style[a].css):h.error({data:"Couldn't get style for id "+a})}),c.length>0&&(a.styles=c),delete a.style_id}return a},p=function(a){b.get(e.apiDataBaseUrl+"/v1/episodes/"+a).success(function(b){"Published"===b.status||f.userHasRole("admin")?(g.cache("episode",o(b)),q(a),r(b.container_id,a)):h.error({data:"This episode has not yet been published."})}).error(function(){h.error({data:"API call to /v1/episodes/"+a+" failed (bad episode ID?)"})})},q=function(a){b.get(e.apiDataBaseUrl+"/v2/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",o(a))}),g.resolveEpisodeEvents(a)})},r=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&r(a[0].parent_id,c)}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)})};return i}]),angular.module("com.inthetelling.player").factory("errorSvc",function(){var a={};return a.errors=[],a.notifications=[],a.init=function(){a.errors=[]},a.error=function(b){b&&b.data&&a.errors.push({exception:b,cause:b.data.error})},a.notify=function(b){a.notifications.push(b)},a}),angular.module("com.inthetelling.player").factory("modelSvc",["$interval","$filter","config","appState",function(a,b,c,d){var e={};e.episodes={},e.assets={},e.events={},e.containers={},e.cache=function(a,b){"episode"===a?e.episodes[b._id]?angular.extend(e.episodes[b._id],e.deriveEpisode(angular.copy(b))):e.episodes[b._id]=e.deriveEpisode(angular.copy(b)):"event"===a?e.events[b._id]?angular.extend(e.events[b._id],e.deriveEvent(angular.copy(b))):e.events[b._id]=e.deriveEvent(angular.copy(b)):"asset"===a?e.assets[b._id]?angular.extend(e.assets[b._id],e.deriveAsset(angular.copy(b))):e.assets[b._id]=e.deriveAsset(angular.copy(b)):"container"===a&&(e.containers[b._id]?angular.extend(e.containers[b._id],angular.copy(b)):e.containers[b._id]=angular.copy(b))};var f={"templates/episode-default.html":"templates/episode/episode.html","templates/episode-eliterate.html":"templates/episode/eliterate.html","templates/episode-ewb.html":"templates/episode/ewb.html","templates/episode-gw.html":"templates/episode/gw.html","templates/episode-purdue.html":"templates/episode/purdue.html","templates/episode-tellingstory.html":"templates/episode/story.html","templates/scene-1col.html":"templates/scene/1col.html","templates/scene-2colL.html":"templates/scene/2colL.html","templates/scene-2colR.html":"templates/scene/2colR.html","templates/scene-centered.html":"templates/scene/centered.html","templates/scene-cornerH.html":"templates/scene/cornerH.html","templates/scene-cornerV.html":"templates/scene/cornerV.html","templates/transcript-default.html":"templates/item/transcript.html","templates/transcript-withthumbnail.html":"templates/item/transcript-withthumbnail.html","templates/transcript-withthumbnail-alt.html":"templates/item/transcript-withthumbnail-alt.html","templates/text-h1.html":"templates/item/text-h1.html","templates/text-h2.html":"templates/item/text-h2.html","templates/text-pullquote-noattrib.html":"templates/item/pullquote-noattrib.html","templates/text-pullquote.html":"templates/item/pullquote.html","templates/transmedia-caption.html":"templates/item/image-caption.html","templates/transmedia-image-default.html":"templates/item/image.html","templates/transmedia-slidingcaption.html":"templates/item/image-caption-sliding.html","templates/transmedia-image-fill.html":"templates/item/image-fill.html","templates/transmedia-image-plain.html":"templates/item/image-plain.html","templates/transmedia-linkonly.html":"templates/item/image-linkonly.html","templates/transmedia-thumbnail.html":"templates/item/image-thumbnail.html","templates/transmedia-link-default.html":"templates/item/link.html","templates/transmedia-link-frameicide.html":"templates/item/link.html","templates/transmedia-link-noembed.html":"templates/item/link.html","templates/transmedia-link-embed.html":"templates/item/link-embed.html","templates/transmedia-link-youtube.html":"templates/item/link.html","templates/transmedia-embed-youtube.html":"templates/item/link-embed.html","templates/transmedia-link-icon.html":"templates/item/link.html","templates/upload-demo-inline.html":"templates/item/debug.html","templates/upload-demo.html":"templates/item/debug.html"};e.deriveEpisode=function(a){return f[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl]),e.events["internal:landingscreen:"+a._id].title=a.title,a},e.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=h(a)),a},e.deriveEvent=function(a){return"Scene"!==a._type&&(a.layouts?(a.layoutCss=a.layouts[0],("inline"===a.layouts[0]||a.layouts[0].match(/sidebar/)||a.layouts[0].match(/burst/))&&(a.isContent=!0)):a.isContent=!0,"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0),a.templateUrl.match(/noembed/)&&(a.noEmbed=!0),(a.templateUrl.match(/link-youtube/)||a.templateUrl.match(/-embed/))&&(a.noExternalLink=!0),a.templateUrl.match(/frameicide/)&&(a.targetTop=!0)),f[a.templateUrl]&&(a.origTemplateUrl=a.templateUrl,a.templateUrl=f[a.templateUrl],a.isContent||"templates/item/image-plain.html"!==a.templateUrl||(a.templateUrl="templates/item/image-fill.html"),"templates/item/image-plain.html"===a.templateUrl&&(a.styles?a.styles.push("timestampNone"):a.styles=["timestampNone"])),a.displayStartTime=b("asTime")(a.start_time),a},e.resolveEpisodeEvents=function(a){var b=[],c=[];angular.forEach(e.events,function(d){d.episode_id===a&&("Scene"===d._type?b.push(d):c.push(d))}),e.episodes[a].scenes=b.sort(function(a,b){return a.start_time-b.start_time}),e.episodes[a].items=c.sort(function(a,b){return a.start_time-b.start_time}),angular.forEach(b,function(a){var b=[];angular.forEach(c,function(c){c.start_time>=a.start_time&&c.start_time<a.end_time&&(e.events[c._id].scene_id=a._id,b.push(c))}),e.events[a._id].items=b.sort(function(a,b){return a.start_time-b.start_time})}),e.episodes[a].styleCss=g(e.episodes[a]),angular.forEach(e.events,function(b){b.episode_id===a&&(b.styleCss=g(b),b.layouts&&(b.styleCss=b.styleCss+" "+b.layouts.join(" ")))})},e.episode=function(a){return!e.episodes[a],e.episodes[a]},e.episodeEvents=function(a){var b=[];return angular.forEach(e.events,function(c){c.episode_id===a&&b.push(c)}),b},e.scene=function(a){return!e.events[a],e.events[a]};var g=function(a){var b={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},c=[];if(angular.forEach(a.styles,function(a){c.push(a),angular.forEach(b,function(c,d){0===a.indexOf(d)&&(b[d]=a)})}),a.scene_id){var d=e.events[a.scene_id].styles;angular.forEach(d,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||(c.push(a),b[e]=a)})})}if(a.episode_id){var f=e.episodes[a.episode_id].styles;angular.forEach(f,function(a){angular.forEach(b,function(d,e){b[e]||0!==a.indexOf(e)||c.push(a)})})}return c.join(" ")};e.resolveEpisodeAssets=function(a){angular.forEach(e.events,function(b){if(b.episode_id===a){var c=b.asset_id||b.link_image_id||b.annotation_image_id;c&&e.assets[c]&&(e.events[b._id].asset=e.assets[c])}}),e.episodes[a].masterAsset=e.assets[e.episodes[a].master_asset_id]},e.addLandingScreen=function(a){e.events["internal:landingscreen:"+a]={_id:"internal:landingscreen:"+a,_type:"Scene",_internal:!0,templateUrl:"templates/scene/landingscreen.html",episode_id:a,start_time:0,end_time:.001}};var h=function(a){var b={};if(a.alternate_urls){for(var e=/\.(\w+)$/,f=0;f<a.alternate_urls.length;f++)if(a.alternate_urls[f].match(/youtube/))b.youtube=i(a.alternate_urls[f]);else switch(a.alternate_urls[f].match(e)[1]){case"mp4":b.mpeg4=j(b.mpeg4,a.alternate_urls[f]);break;case"m3u8":b.m3u8=j(b.m3u8,a.alternate_urls[f]);break;case"webm":b.webm=j(b.webm,a.alternate_urls[f])}a.you_tube_url&&(b.youtube=i(a.you_tube_url))}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:i(a.you_tube_url)};var g=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);return(d.isTouchDevice||g)&&(b.youtube=void 0),c.disableYoutube&&(b.youtube=void 0),a.video=b,a},i=function(a){if(!a)return void 0;var b=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,c=a.match(b)[1];return"//www.youtube.com/embed/"+c},j=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,e=a.match(c)||[0,0],f=b.match(c)||[0,0];return d.isTouchDevice||d.isFramed?Math.floor(e[1])>Math.floor(f[1])?b:a:Math.floor(e[1])<Math.floor(f[1])?b:a};return e}]),angular.module("com.inthetelling.player").factory("timelineSvc",["$timeout","$interval","$rootScope","modelSvc","appState","analyticsSvc",function(a,b,c,d,e,f){var g={};g.timelineEvents=[],g.markedEvents=[];var h,i,j,k;g.registerVideo=function(b){void 0!==j&&a(function(){g.seek(e.time)}),j=b},g.setSpeed=function(a){k=a,e.timeMultiplier=k,j.setSpeed(a)},g.play=function(){return e.hasBeenPlayed?void("playing"!==e.timelineState&&(e.videoControlsActive=!0,e.show.navPanel=!1,e.timelineState="buffering",j.play().then(function(){e.timelineState="playing",s(),h=b(s,20),o(),f.captureEpisodeActivity("play")}))):(e.hasBeenPlayed=!0,void c.$emit("video.firstPlay"))},g.pause=function(c){e.videoControlsActive=!0,b.cancel(h),p(),h=void 0,n=void 0,e.timelineState="paused",j.pause(),c&&a(g.play,1e3*c*Math.abs(k)),f.captureEpisodeActivity("pause")},g.seek=function(b,c,d){if(!j||0===e.duration)return void a(function(){g.seek(b)},300);p();var h=e.time;if(b=t(b),0>b&&(b=0),b>e.duration&&(b=e.duration),e.time=b,g.updateEventStates(),j.seek(b),"playing"===e.timelineState&&(g.pause(),g.play()),c){var i={method:c,seekStart:h};d&&(i.event_id=d),f.captureEpisodeActivity("seek",i)}},g.toggleMute=function(){e.muted=!e.muted,j.toggleMute()},g.setVolume=function(a){e.volume=a,j.setVolume(a)};var l,m=function(){l={lastTimelineTime:0,lastVideoTime:0}};m();var n,o=function(){l.lastTimelineTime=e.time,l.lastVideoTime=e.time,q()},p=function(){a.cancel(i),m()},q=function(){if(a.cancel(i),"playing"===e.timelineState){for(var b=j.currentTime(),c=e.time,d=0;d<g.timelineEvents.length;d++){var f=g.timelineEvents[d];if(f.t>=l.lastTimelineTime){if(f.t>c)break;if("pause"===f.action&&f.t===l.lastTimelineTime);else if(r(f),"pause"===f.action){d++;break}}}var h=g.timelineEvents[d];if(l.lastVideoTime=b,l.lastTimelineTime=c,h&&"playing"===e.timelineState){var k=1e3*(g.timelineEvents[d].t-c);i=a(q,k+10)}}},r=function(a){"timeline"===a.id?"pause"===a.action?(e.time=a.t,g.pause()):g.play():"enter"===a.action?(d.events[a.id].state="isCurrent",d.events[a.id].isCurrent=!0):(d.events[a.id].state="isPast",d.events[a.id].isCurrent=!1)},s=function(){var a=new Date,b=isNaN(a-n)?0:a-n,c=parseFloat(e.time)+b/1e3*k;0>c&&(c=0,g.pause()),c>e.duration&&(c=e.duration,g.pause()),e.time=c,n=a};g.init=function(a){g.timelineEvents=[],g.markedEvents=[],k=1,e.duration=0,e.timelineState="paused",g.injectEvents(d.episodeEvents(a),0),b.cancel(h),p()},g.injectEvents=function(a,b){0!==a.length&&(angular.forEach(a,function(a){"Scene"===a._type&&a.title&&g.markedEvents.push(a),0!==a.start_time||a._id.match("internal")||(a.start_time=.01,d.events[a._id].start_time=.01),a.stop?(g.timelineEvents.push({t:a.start_time+b,id:"timeline",action:"pause"}),g.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),g.timelineEvents.push({t:a.start_time+b+.01,id:a._id,action:"exit"})):(g.timelineEvents.push({t:a.start_time+b,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&g.timelineEvents.push({t:a.end_time+b,id:a._id,action:"exit"}))}),g.timelineEvents=g.timelineEvents.sort(function(a,b){return a.t===b.t?"enter"===b.action?1:"exit"===b.action?-1:0:a.t-b.t}),g.markedEvents=g.markedEvents.sort(function(a,b){return a.start_time-b.start_time}),e.duration=g.timelineEvents[g.timelineEvents.length-1].t,g.updateEventStates())},g.updateEventStates=function(){var a=e.time;angular.forEach(g.timelineEvents,function(a){if("timeline"!==a.id){var b=d.events[a.id];b.state="isFuture",b.isCurrent=!1}}),angular.forEach(g.timelineEvents,function(b){if(b.t<=a){var c=d.events[b.id];"enter"===b.action?(c.state="isCurrent",c.isCurrent=!0):"exit"===b.action&&(c.state="isPast",c.isCurrent=!1)}})};var t=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)};return g}]),angular.module("com.inthetelling.player").factory("analyticsSvc",["$q","$http","$routeParams","$interval","config","appState",function(a,b,c,d,e,f){var g={};g.activityQueue=[];var h=d(function(){g.flushActivityQueue()},1e4);c.local&&d.cancel(h),g.captureEpisodeActivity=function(a,b){if(f.user.track_episode_metrics){var c={name:a,walltime:new Date,timestamp:f.time};b&&(c.data=b),g.activityQueue.push(c)}},g.captureEventActivity=function(a,b){f.user.track_event_actions&&g.activityQueue.push({name:a,event_id:b,walltime:new Date})},g.readEpisodeActivity=function(c){var d=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/episodes/"+c+"/episode_user_metrics"}).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},g.readEventActivity=function(c,d){var f=a.defer();return b({method:"GET",url:e.apiDataBaseUrl+"/v2/events/"+c+"/event_user_actions"}).success(function(a){if(d){for(var b=!1,c=0;c<a.length;c++){var e=a[c];e.name===d&&(b=!0)}f.resolve(b)}else f.resolve(a)}).error(function(){f.reject()}),f.promise},g.flushActivityQueue=function(){if(0!==g.activityQueue.length){var a=angular.copy(g.activityQueue);g.activityQueue=[];var b=new Date,c=[],d=[];angular.forEach(a,function(a){a.age=(b-a.walltime)/1e3,delete a.walltime,a.event_id?d.push(a):c.push(a)}),d.length&&i("event_user_actions",{event_user_actions:d}),c.length&&i("episode_user_metrics",{episode_user_metrics:c})}};var i=function(a,c){b({method:"POST",url:e.apiDataBaseUrl+"/v2/episodes/"+f.episodeId+"/"+a,data:c}).success(function(){}).error(function(){})};return g}]),angular.module("com.inthetelling.player").filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"===a._type&&b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}).filter("transcriptandrequired",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||a.required)&&b.push(a)}),b}}).filter("transcriptandoptional",function(){return function(a){var b=[];return angular.forEach(a,function(a){(a.isTranscript||!a.isTranscript&&!a.required)&&b.push(a)}),b}}).filter("required",function(){return function(a){var b=[];return angular.forEach(a,function(a){!a.isTranscript&&a.required&&b.push(a)}),b}}).filter("optional",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript||a.required||b.push(a)}),b}}).filter("highlightSubstring",function(){return function(a,b){return a?b||angular.isNumber(b)?(""+a).replace(RegExp(""+b,"gi"),'<span class="ui-match">$&</span>'):a:void 0}}).filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("asPercent",function(){return function(a){return isNaN(a)?Math.floor(100*a)+"%":"0%"}}).filter("asTime",function(){return function(a){return isNaN(a)?"0:00":Math.floor(a/60)+":"+("0"+Math.floor(a)%60).slice(-2)}}),angular.module("com.inthetelling.player").controller("ErrorController",["$scope","errorSvc","appState",function(a,b,c){a.errors=b.errors,a.notifications=b.notifications,a.user=c.user,a.dismiss=function(b){for(var c=[],d=0;d<a.errors.length;d++)a.errors[d]!==b&&c.push(a.errors[d]);for(a.errors=c,c=[],d=0;d<a.notifications.length;d++)a.notifications[d]!==b&&c.push(a.notifications[d]);a.notifications=c},a.resetAuth=function(){localStorage.removeItem("storyAuth")},a.reload=function(){window.location.reload(!0)}}]),angular.module("com.inthetelling.player").controller("EpisodeListController",["$scope","config","dataSvc","appState",function(a,b,c,d){c.getEpisodeList().then(function(b){a.episodes=b}),a.authenticate=function(a){localStorage&&localStorage.removeItem("storyAuth"),d.user={},window.location=b.apiDataBaseUrl+"/pages/launch_oauth2?episode="+a}}]),angular.module("com.inthetelling.player").controller("TimelineController",["$scope","timelineSvc","modelSvc","appState",function(a,b,c,d){a.play=b.play,a.pause=b.pause,a.setSpeed=function(a){b.setSpeed(a)},a.markerPercent=function(a){return a/d.duration*100},a.toggleMute=function(){b.toggleMute()},a.setVolume=function(a){b.setVolume(a)},a.toggleFullscreen=function(){e()?f():g()};var e=function(){return document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen};a.$watch(function(){return e()},function(a){d.isInFullscreenMode=a});var f=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},g=function(){var a=document.getElementById("CONTAINER");a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.player").controller("PlayerController",["$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","errorSvc","authSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.viewMode=function(a){g.viewMode=a,k.captureEpisodeActivity("modeChange",{mode:a}),"review"===a?(g.autoscroll=!0,g.autoscrollBlocked=!1,e(y)):g.autoscroll=!1},d.viewMode&&a.viewMode(d.viewMode),d.t&&j.seek(d.t,"URLParameter"),g.init(),l.init(),g.episodeId=d.epId,i.addLandingScreen(g.episodeId),h.getEpisode(g.episodeId),a.framebreaker=function(){m.getNonce().then(function(c){var d=""+b.absUrl();d=d+(d.match(/\?/)?"&":"?")+"key="+c,a.framebreakerUrl=d;try{window.open(d).focus()}catch(e){a.framebreaker=function(){},l.notify("Your web browser has a popup blocker enabled, which has prevented us from opening this episode in a new window automatically.  Please click the 'new window' again; it will work this time. (Sorry for the inconvenience!)   If you wish, you can change your browser settings to allow popup windows for this website.")}})};var n=a.$watch(function(){return i.episodes[g.episodeId].title},function(a,b){a!==b&&(document.title="STORY: "+a,n())});a.loading=!0;var o=a.$watch(function(){return i.episodes[g.episodeId].items},function(b){b&&(j.init(g.episodeId),a.loading=!1,o())});a.episode=i.episode(g.episodeId),a.appState=g,a.show=g.show,a.now=new Date,g.videoControlsActive=!1;var p,q;a.$watch(function(){return g.videoControlsActive},function(a){a&&(q=e(function(){p||(g.videoControlsActive=!1)},5e3))}),a.showControls=function(){e.cancel(q),g.videoControlsActive=!0,g.isTouchDevice&&a.allowControlsExit()},a.keepControls=function(){p=!0},a.allowControlsExit=function(){p=!1,e.cancel(q),q=e(function(){g.show.navPanel||(g.videoControlsActive=!1)},5e3)},a.toggleSearchPanel=function(){g.show.searchPanel=!g.show.searchPanel},a.toggleNavPanel=function(){j.pause(),g.show.navPanel=!g.show.navPanel},a.seek=function(a){j.seek(a,"sceneMenu")};var r=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(s){r=!1}r&&localStorage.removeItem("iCanHazStorage"),c.$on("video.firstPlay",function(){r&&!localStorage.getItem("noMoreHelp")?g.show.helpPanel=!0:j.play()}),a.hidePanels=function(){g.show.helpPanel=!1,g.show.navPanel=!1,g.show.searchPanel=!1},a.noMoreHelp=function(){g.show.helpPanel=!1,localStorage.setItem("noMoreHelp","1"),j.play()};var t,u=$(window),v=$("html,body"),w=function(){t=f(y,400),u.bind("scroll",function(){v.stop(),x(),g.autoscrollBlocked=!0})},x=function(){u.unbind("scroll"),f.cancel(t)};a.enableAutoscroll=function(){g.autoscrollBlocked&&(g.autoscrollBlocked=!1,w())};var y=function(){if(!g.autoscrollBlocked&&g.autoscroll){var a=1/0,b=u.scrollTop();if(angular.forEach($(".content .item.isCurrent:visible"),function(c){var d=c.getBoundingClientRect().top+b;a>d&&(a=d)}),1/0!==a){var c=$(window).height()/5;a>b+c&&b+c+c+c>a||c>a&&c>b||(x(),v.animate({scrollTop:a-c},1500),e(function(){w()},1750))}}};w(),c.$on("userKeypress.ESC",function(){g.show.searchPanel=!1,g.show.helpPanel=!1,g.show.navPanel=!1,g.itemDetail=!1})}]),angular.module("com.inthetelling.player").controller("EpisodeController",["$scope","$routeParams","modelSvc","appState",function(a,b,c,d){a.episode=c.episode(d.episodeId),a.appState=d}]),angular.module("com.inthetelling.player").controller("SceneController",["$scope","$filter",function(a,b){a.precalculateSceneValues=function(){$.inArray("showCurrent",a.scene.layouts)>-1&&(a.showCurrent=!0),a.contentItems=b("isContent")(a.scene.items),a.mainFgItems=b("itemLayout")(a.scene.items,"mainFg"),a.mainBgItems=b("itemLayout")(a.scene.items,"mainBg"),a.altFgItems=b("itemLayout")(a.scene.items,"altFg"),a.altBgItems=b("itemLayout")(a.scene.items,"altBg"),a.mainContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("transcriptandoptional")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("transcriptandrequired")(a.contentItems):b("annotation")(a.contentItems),a.altContentItems=$.inArray("splitRequired",a.scene.layouts)>-1?b("required")(a.contentItems):$.inArray("splitOptional",a.scene.layouts)>-1?b("optional")(a.contentItems):b("transmedia")(a.contentItems);for(var c=0;c<a.mainContentItems.length;c++)($.inArray("burstL",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarL",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasLeftSidebar=!0),($.inArray("burstR",a.mainContentItems[c].layouts)>-1||$.inArray("sidebarR",a.mainContentItems[c].layouts)>-1||$.inArray("burst",a.mainContentItems[c].layouts)>-1)&&(a.mainContentHasRightSidebar=!0),a.mainContentHasLeftSidebar&&a.mainContentHasRightSidebar&&(a.mainContentHasBothSidebars=!0,c=a.mainContentItems.length);for(c=0;c<a.altContentItems.length;c++)($.inArray("burstL",a.altContentItems[c].layouts)>-1||$.inArray("sidebarL",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasLeftSidebar=!0),($.inArray("burstR",a.altContentItems[c].layouts)>-1||$.inArray("sidebarR",a.altContentItems[c].layouts)>-1||$.inArray("burst",a.altContentItems[c].layouts)>-1)&&(a.altContentHasRightSidebar=!0),a.altContentHasLeftSidebar&&a.altContentHasRightSidebar&&(a.altContentHasBothSidebars=!0,c=a.altContentItems.length)}}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope","timelineSvc",function(a,b){a.seek=function(c){b.seek(c,"clickedOnItem",a.item._id)}}]),angular.module("com.inthetelling.player").controller("VideoController",["$q","$scope","$timeout","$window","$document","appState","timelineSvc",function(a,b,c,d,e,f,g){var h=document.createElement("script");h.src="//www.youtube.com/iframe_api",angular.element(e[0].head).append(h),d.onYouTubeIframeAPIReady=function(){b.youtubeIsReady=!0},b.$on("$destroy",function(){b.YTPlayer=void 0}),b.initVideo=function(a){if(b.video.youtube)if(b.videoType="youtube",b.videoNode=a.find("iframe")[0],b.youtubeIsReady)b.initYoutube(b.videoNode.id);else var c=b.$watch(function(){return b.youtubeIsReady},function(a){a&&(b.initYoutube(b.videoNode.id),c())});else b.videoType="video",b.videoNode=a.find("video")[0],b.initHTML5Video();g.registerVideo(b),f.videoType=b.videoType},b.initYoutube=function(){var a=["ended","playing","paused","buffering","","cued"];b.YTPlayer=new window.YT.Player(b.videoNode.id,{events:{onStateChange:function(c){b.playerState=a[c.data]}}})},b.initHTML5Video=function(){b.videoNode.addEventListener("playing",function(){b.playerState="playing"},!1),b.videoNode.addEventListener("waiting",function(){b.playerState="waiting"},!1),b.videoNode.addEventListener("stalled",function(){b.playerState="stalled"},!1),b.videoNode.addEventListener("pause",function(){b.playerState="pause"},!1)},b.play=function(){var c=a.defer();"youtube"===b.videoType?b.YTPlayer.playVideo():b.videoNode.play();var d=b.$watch(function(){return b.playerState},function(a){"playing"===a&&(d(),c.resolve())});return c.promise},b.pause=function(){if("youtube"===b.videoType)b.YTPlayer.seekTo(f.time,!0),b.YTPlayer.pauseVideo();else{b.videoNode.pause();try{b.videoNode.currentTime=f.time}catch(a){}}},b.seek=function(a){try{"youtube"===b.videoType?(b.YTPlayer.seekTo(a,!0),"paused"===f.timelineState&&b.pause()):b.videoNode.currentTime=a}catch(d){c(function(){b.seek(a)},100)}},b.setSpeed=function(a){0>=a||"youtube"===b.videoType||(b.videoNode.playbackRate=a)},b.currentTime=function(){return"youtube"===b.videoType?b.YTPlayer.getCurrentTime():b.videoNode.currentTime},b.toggleMute=function(){"youtube"===b.videoType?b.YTPlayer.isMuted()?b.YTPlayer.unMute():b.YTPlayer.mute():b.videoNode.muted=!b.videoNode.muted},b.setVolume=function(a){"youtube"===b.videoType?b.YTPlayer.setVolume(a):b.videoNode.volume=a/100}}]),angular.module("com.inthetelling.player").controller("SearchPanelController",["$scope","timelineSvc",function(a,b){a.searchTypes={Annotation:!0,Link:!0,Upload:!0},a.searchTypeNames={Annotation:"Transcript",Link:"Link",Upload:"Image"},a.sortBy="startTime",a.seek=function(c,d){a.enableAutoscroll(),b.seek(c,"clickedOnEventInSearch",d)},a.indexEvents=function(){angular.forEach(a.episode.items,function(a){a.searchableText=(a.annotation||a.description)+" "+(a.title||a.annotator)})}}]),angular.module("com.inthetelling.player").directive("ittTimeline",["appState","timelineSvc",function(a,b){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(c,d){c.appState=a,c.timeline=b,c.handlePosition=0,c.zoomLevel=1,c.zoomOffset=0;var e=d.find(".progressbarContainer"),f=d.find(".progressbar");c.showSceneMenuTooltip=function(b){c.sceneMenuToolTip=b&&!a.isTouchDevice?!0:!1},c.prevScene=function(){for(var c=b.markedEvents.length-1;c>=0;c--){var d=a.time;if("playing"===a.timelineState&&(d-=3),b.markedEvents[c].start_time<d){b.seek(b.markedEvents[c].start_time,"prevScene");break}}},c.nextScene=function(){for(var c=!1,d=0;d<b.markedEvents.length;d++)if(b.markedEvents[d].start_time>a.time){b.seek(b.markedEvents[d].start_time,"nextScene"),c=!0;break}c||b.seek(a.duration,"nextScene")},c.userChangingVolume=function(b){a.muted&&c.toggleMute();var d=angular.element(b.currentTarget),e=function(a,b){var e=(a.clientX-d.offset().left)/d.width()*100;e>98&&(e=100),3>e&&(e=0),b?c.setVolume(e):c.$apply(c.setVolume(e))};e(b,!0),d.bind("mousemove.volume",e),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),d.unbind("mousemove.volume")})},c.currentVolume=function(){return a.muted?0:a.volume},c.audioIcon=function(){return a.muted?"muted":"vol"+Math.floor(a.volume/34)},c.showTooltip=function(a){a.showTooltip=!0},c.hideTooltip=function(a){a.showTooltip=!1},c.zoomIn=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel+1,g()},c.zoomOut=function(){c.stopWatching=!0,c.zoomLevel=c.zoomLevel-1,c.zoomLevel<1&&(c.zoomLevel=1),g()
};var g=function(){c.zoomOffset=-((c.zoomLevel-1)*(a.time/a.duration)),e.animate({left:100*c.zoomOffset+"%",width:100*c.zoomLevel+"%"},1e3,function(){c.stopWatching=!1})};c.$watch(function(){return{t:a.time,d:a.duration}},function(){c.stopWatching||(c.zoomOffset=-((c.zoomLevel-1)*(a.time/a.duration)),e.css({left:100*c.zoomOffset+"%"}))},!0);var h=function(b){c.isSeeking=!0;var d=a.isTouchDevice?"touchend.timeline":"mouseup.timeline";f.bind(d,function(){j()}),angular.element(document).bind(d,function(){k()}),i(b)},i=function(b){c.isSeeking&&(c.willSeekTo=(b.clientX-e.offset().left)/e.width()*a.duration,c.willSeekTo<0&&(c.willSeekTo=0),c.willSeekTo>a.duration&&(c.willSeekTo=a.duration))},j=function(){c.stopWatching=!0,b.seek(c.willSeekTo,"scrubTimeline"),g()},k=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),f.off("mouseup.timeline"),f.off("touchend.timeline"),c.$apply(function(){c.isSeeking=!1})},l=function(){var b=$(d.find(".playhead"));a.isTouchDevice?(b.on("touchstart.timeline",function(a){h(a.originalEvent.targetTouches[0]),a.preventDefault()}),b.on("touchmove.timeline",function(a){i(a.originalEvent.targetTouches[0]),a.preventDefault()})):(b.on("mousedown.timeline",function(a){h(a),a.preventDefault()}),b.on("mousemove.timeline",function(a){i(a),a.preventDefault()}))};l(),c.$on("$destroy",function(){k()})}}}]),angular.module("com.inthetelling.player").directive("ittEpisode",["analyticsSvc",function(a){return{restrict:"A",replace:!0,template:'<span ng-include="episode.templateUrl"></span>',controller:"EpisodeController",link:function(){a.captureEpisodeActivity("episodeLoad")}}}]),angular.module("com.inthetelling.player").directive("ittScene",["$timeout","$interval","appState",function(a,b,c){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-include="scene.templateUrl">Loading Item...</span>',controller:"SceneController",link:function(a,d){a.precalculateSceneValues();var e=function(){var b=d.find(".videoMagnet img");if(null===b.height())var c=a.$watch(function(){return d.find(".videoMagnet img").height()},function(a){a>0&&(c(),e())});else{d.find(".matchVideoHeight:visible").each(function(){$(this).css("height",d.find(".videoMagnet img").height())});var f=angular.element(window).height()-$("#CONTAINER").scrollTop()-45;d.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",f-$(this).offset().top)})}d.find(".content").each(function(){var a=$(this);a.outerWidth()>550?a.addClass("allowSidebars"):a.removeClass("allowSidebars")})};a.unwatch=a.$watch(function(){return{winWidth:c.windowWidth,winHeight:c.windowHeight,newMode:c.viewMode}},function(b){"discover"===b.newMode&&a.scene.isCurrent&&e()},!0),a.safetyBelt=b(e,1300),a.$on("$destroy",function(){a.unwatch(),b.cancel(a.safetyBelt)})}}}]),angular.module("com.inthetelling.player").directive("ittItem",["$http","$timeout","config","appState","analyticsSvc","timelineSvc","modelSvc",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{item:"=ittItem"},template:function(a,b){return b.forcetemplate?"<div ng-include=\"'templates/item/"+b.forcetemplate+".html'\"></div>":'<div ng-include="item.templateUrl"></div>'},controller:"ItemController",link:function(h,i){if(h.item.asset_id&&!h.item.asset&&(h.item.asset=g.assets[h.item.asset_id]),h.item.styleCss.match(/fill|contain|cover/)&&(h.item.backgroundImage="background-image: url('"+h.item.asset.url+"');"),h.item.data&&(h.plugin=h.item.data._plugin,h.plugin._type=h.item.data._pluginType,"multiplechoice"===h.plugin._type&&(h.setChoice=function(a){h.plugin.hasBeenAnswered||(h.plugin.selectedDistractor=a)},h.scoreQuiz=function(){h.plugin.distractors[h.plugin.selectedDistractor].selected=!0,h.plugin.hasBeenAnswered=!0,e.captureEventActivity("question-answered",h.item._id)},h.resetQuestion=function(){h.plugin.selectedDistractor=void 0,h.plugin.hasBeenAnswered=!1;for(var a=0;a<h.plugin.distractors.length;a++)h.plugin.distractors[a].selected=!1}),"credlyBadge"===h.plugin._type)){var j=d.user;j.roles.length&&"guest"!==j.roles[0]&&(h.plugin.eligibleForBadges=!0,h.plugin.userEmail=j.emails[0],h.plugin.totalAchieved=0,angular.forEach(h.plugin.requirements,function(a){e.readEventActivity(a.eventId,a.activity).then(function(b){a.achieved=b,b&&h.plugin.totalAchieved++})})),h.badger=function(){h.plugin.gettingBadge=!0,a({method:"GET",url:c.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+h.plugin.credlyBadgeId+"&email="+h.plugin.userEmail}).success(function(a){"Badge previously sent."===a.status&&(h.plugin.alreadyHadBadge=!0),h.plugin.gotBadge=!0}).error(function(){})}}h.toggleDetailView=function(){h.item.showInlineDetail?h.item.showInlineDetail=!1:(h.captureInteraction(),i.closest(".content").width()>400?h.item.showInlineDetail=!0:(f.pause(),d.itemDetail=h.item))},h.forceModal=function(){f.pause(),d.itemDetail=h.item},h.outgoingLink=function(a){f.pause(),h.captureInteraction(),h.item.targetTop?b(function(){window.location.href=a}):window.open(a)},h.captureInteraction=function(){e.captureEventActivity("clicked",h.item._id)}}}}]),angular.module("com.inthetelling.player").directive("ittItemDetailModal",["appState","timelineSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},templateUrl:"templates/item/modal.html",link:function(b){b.dismiss=function(){a.itemDetail=!1}}}}]),angular.module("com.inthetelling.player").directive("ittItemEditor",["modelSvc","appState",function(a,b){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/item/edit.html",controller:"ItemController",link:function(c){c.item.layouts||(c.item.layouts=[]),c.$watch(function(){return c.item.end_time},function(a){c.item.noEndTime=""===a}),c.save=function(){c.item=a.deriveEvent(c.item);for(var d in c.item)c.item.hasOwnProperty(d)&&(a.events[c.item._id][d]=angular.copy(c.item[d]));a.resolveEpisodeEvents(c.item.episode_id),b.editing=!1},c.updateStyles=function(){c.item.styles=[],angular.forEach([c.item.customTransition,c.item.customTypography,c.item.customColor,c.item.customTimestamp],function(a){a&&c.item.styles.push(a)}),c.item.styleCss=c.item.styles.join(" ")},c.cancelEdit=function(){b.editing=!1}}}}]),angular.module("com.inthetelling.player").directive("ittVideo",["$timeout","$rootScope","appState","timelineSvc",function(a,b,c,d){var e=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(f,g){f.appState=c,f.uid=++e,a(function(){if(f.video)f.initVideo(g);else var a=f.$watch(function(){return f.video},function(b){b&&(f.initVideo(g),a())})}),f.videoClick=function(){"paused"===c.timelineState?d.play():d.pause()},b.$on("userKeypress.SPACE",f.videoClick)}}}]),angular.module("com.inthetelling.player").directive("ittMagnetized",["$rootScope","$timeout","appState",function(a,b,c){return{restrict:"A",replace:!0,scope:!0,link:function(d,e){var f=16/9,g=function(a){d.unwatch&&d.unwatch(),d.magnet=$(a),d.unwatch=d.$watch(function(){return{top:d.magnet.offset().top-e.offset().top,left:d.magnet.offset().left-e.offset().left,width:d.magnet.width()-e.width(),winWidth:c.windowWidth,winHeight:c.windowHeight}},h,!0)},h=function(){b(function(){e.css("position","fixed"===d.magnet.css("position")?"fixed":"absolute");var a=d.magnet.offset().top-e.offset().top,b=d.magnet.offset().left-e.offset().left,c=d.magnet.width()-e.width();e.offset(Math.abs(a)>1||Math.abs(b)>1?{top:e.offset().top+a/4,left:e.offset().left+b/4}:d.magnet.offset()),e.width(Math.abs(c)>4?e.width()+c/4:d.magnet.width()),e.height(d.magnet.width()/f)})};a.$on("magnet.changeMagnet",function(a,b){g(b)}),d.$on("$destroy",function(){d.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittMagnet",["$rootScope","$timeout",function(a){return{restrict:"A",replace:!0,scope:!0,link:function(b,c){b.unwatch=b.$watch(function(){return c.is(":visible")},function(b){b&&a.$emit("magnet.changeMagnet",c)}),b.$on("$destroy",function(){b.unwatch()})}}}]),angular.module("com.inthetelling.player").directive("ittSearchPanel",function(){return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/searchpanel.html",controller:"SearchPanelController",link:function(a){a.indexEvents()}}});