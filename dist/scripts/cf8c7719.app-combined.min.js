"use strict";angular.module("com.inthetelling.player",["ngRoute","ngAnimate"]).config(["$routeProvider",function(a){a.when("/episodes",{title:"Telling STORY: All episodes",templateUrl:"templates/episodelist.html"}).when("/episode/:epId",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).when("/episode/:epId/:viewMode",{title:"Telling STORY",controller:"PlayerController",templateUrl:"templates/player.html",reloadOnSearch:!1}).otherwise({title:"Telling STORY: Error",controller:"ErrorController",templateUrl:"templates/error.html"})}]).run(["$rootScope",function(a){a.$on("$routeChangeSuccess",function(a,b){document.title=b.title?b.title:"Telling STORY"})}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self",/.*/,/^https?:\/\/platformuniv-p.edgesuite.net/])}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"]}]),angular.module("com.inthetelling.player").run(["$templateCache",function(a){a.put("templates/episode/episode.html",'<div>\n	Episode template\n	<div ng-show="appState.viewMode == \'discover\'">\n		WindowBg\n		<div itt-item="item" ng-show="appState.viewMode == \'discover\'" class="animate" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowBg\'"></div>\n	</div>\n\n\n	<div itt-scene="scene" class="animate" ng-repeat="scene in episode.scenes | isCurrent" ng-show="appState.viewMode == \'discover\'"></div>\n\n	<div ng-show="appState.viewMode == \'review\'">\n		Review mode\n		<div class="animate" ng-repeat="scene in episode.scenes">\n			<b>{{scene.title}}</b> {{scene.state}} ({{scene.start_time}} - {{scene.end_time}})\n			<div ng-class="contentMain">\n				contentMain\n				<div class="animate" ng-repeat="item in scene.items | annotation | filter:{cosmetic:false}" itt-item="item"></div>\n			</div>\n			<div ng-class="contentAlt">\n				contentAlt\n				<div class="animate" ng-repeat="item in scene.items | transmedia | filter:{cosmetic:false}" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n\n	<div class="videoContainer">\n		Video Container\n		<div itt-video="episode.masterAsset.video"></div>\n\n		<div>Video Overlays\n			<div itt-item="item" class="animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"></div>\n		</div>\n	</div>\n\n	<div ng-show="appState.viewMode == \'watch\'">\n		Captions\n		<div class="animate" ng-repeat="item in episode.items | transcript | isCurrent" itt-item="item"></div>\n	</div>\n\n	<div ng-show="appState.viewMode == \'discover\'">\n		WindowFg\n		<div itt-item="item" ng-show="appState.viewMode == \'discover\'" class="animate" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"></div>\n	</div>\n\n\n</div>\n'),a.put("templates/episodelist.html",'Episode list\n<div ng-controller="EpisodeListController">\n	<div ng-repeat="episode in episodes">\n		({{episode._id}}) <a href="#episode/{{episode._id}}">{{episode.title}}</a>\n		<br>\n	</div>\n</div>\n\n<div x-ng-controller="ErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/error.html",'<div x-ng-if="error" class="error">\n	<h2>Error</h2>\n	<p>Sorry, but something went wrong and we weren\'t able to continue:<br>{{error.message}}</p>\n	<span style="color:#FFF">\n		<pre>{{error.details}}</pre>\n	</span>\n</div>'),a.put("templates/item/edit.html",'<div ng-if="item" style="position:fixed; bottom: 0; left:0;right:0;background-color:#FFF;">\n	Editing item\n\n	<span ng-if="item.type==\'Annotation\'">\n		<br>Speaker:\n		<input type="text" ng-model="item.annotator">\n		<br>TODO: generate list of speakers to choose from based on those already used in this episode, with an \'add\' button for new ones\n\n		<br>Annotation:\n		<textarea ng-model="item.annotation"></textarea>\n	</span>\n	<span ng-if="item.type != \'Annotation\'">\n		<br>Title:\n		<input type="text" ng-model="item.title">\n		<br>Description:\n		<textarea ng-model="item.description"></textarea>\n\n		<span ng-if="item.type == \'Link\'">\n			<br>URL:\n			<input type="text" ng-model="item.url">\n		</span>\n		<span ng-if="item.type == \'Upload\'">\n			<br>TODO: edit/replace asset:\n			<pre>{{item.asset | pretty}}</pre>\n		</span>\n	</span>\n\n	<br>Start time:\n	<input type="text" ng-model="item.start_time">\n	<br>End time:\n	<input type="text" ng-model="item.end_time">\n	<br>Cosmetic:\n	<input type="checkbox" ng-model="item.cosmetic">\n	<br>Stop:\n	<input type="checkbox" ng-model="item.stop">\n	<br>Required:\n	<input type="checkbox" ng-model="item.required">\n	<br>TODO: templateUrl\n	<br>\n	<input type="button" ng-click="save()" value="Save">\n	<input type="button" ng-click="cancelEdit()" value="Cancel">\n	<a ng-click="itemEditDebug=!itemEditDebug">Debug</a>\n	<pre style="max-height: 200px; overflow-y: scroll" ng-if="itemEditDebug">{{item | pretty}}</pre>\n\n</div>\n'),a.put("templates/item/item.html",'<div ng-class="item.styleCss + \' \' + item.state">\n	{{item.start_time}}-{{item.end_time}}: {{item.title}}\n	<br>{{item.annotation}} {{item.description}}\n	<br>\n\n	<a ng-click="edit()">Edit</a>\n\n	<a ng-click="itemDebug=!itemDebug">Debug</a>\n	<pre ng-if="itemDebug">{{item | pretty}}</pre>\n</div>\n'),a.put("templates/player.html",'<a href="#episodes">All episodes</a>\n<h2>{{episode.title}}</h2>\n\n<div itt-timeline></div>\n<div>\n	<a ng-class="{cur: appState.viewMode == \'watch\'}" ng-click="viewMode(\'watch\')">Watch</a>\n	<a ng-class="{cur: appState.viewMode == \'discover\'}" ng-click="viewMode(\'discover\')">Discover</a>\n	<a ng-class="{cur: appState.viewMode == \'review\'}" ng-click="viewMode(\'review\')">Review</a>\n</div>\n\n<div itt-episode></div>\n\n<div itt-item-editor="appState.editing"></div>\n\n<hr>\n\n\n<a href="javascript:void 1;" ng-click="showDebug=!showDebug">DEBUG:</a>\n<pre ng-if="showDebug === true">{{appState | pretty }}</pre>\n<pre ng-if="showDebug === true">{{episode | pretty}}</pre>\n\n\n<div x-ng-controller="ErrorController" x-ng-include="\'templates/error.html\'"></div>\n'),a.put("templates/scene/landingscreen.html","<div>\n	This is the landing screen. So far it is just a stub.\n</div>\n"),a.put("templates/scene/scene.html",'<div ng-class="scene.state">\n\n	<div ng-if="landingscreen">\n		This is the landing screen. {{episode.title}}\n		<p>{{episode.description}}</p>\n	</div>\n	<div ng-if="!landingscreen">\n		<h3>Scene:{{scene.title}}</h3>\n		<p>{{scene.start_time}} - {{scene.end_time}}</p>\n\n		(sample scene panes:)\n\n		<div>\n			<div>Main pane background items\n				<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'mainBg\'" itt-item="item"></div>\n			</div>\n			<div>Transcript+text items (current only):\n				<div class="animate" ng-repeat="item in scene.items | annotation | isCurrent" itt-item="item"></div>\n			</div>\n			<div>Main pane foreground items\n				<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'mainFg\'" itt-item="item"></div>\n			</div>\n		</div>\n\n		<div>\n			<div>Alt pane background items\n				<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'altBg\'" itt-item="item"></div>\n			</div>\n			<div>Transmedia items:\n				<div class="animate" ng-repeat="item in scene.items | transmedia" itt-item="item"></div>\n			</div>\n			<div>Alt pane background items\n				<div class="animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'altFg\'" itt-item="item"></div>\n			</div>\n		</div>\n	</div>\n\n	<a ng-click="debugScene=!debugScene">Debug scene</a>\n	<pre ng-if="debugScene">{{scene | pretty}}</pre>\n</div>\n'),a.put("templates/timeline.html",'<div>\n	Timeline: {{appState.time}} (duration is {{appState.duration}})\n\n	<br>\n\n	<a ng-click="play()">Play</a>\n	<a ng-click="pause()">Pause</a>\n\n	<div>Playback speed is {{appState.timeMultiplier}}. Set to:\n		<a ng-click="setSpeed(0.5)">0.5x</a>\n		<a ng-click="setSpeed(1)">1x</a>\n		<a ng-click="setSpeed(1.5)">1.5x</a>\n		<a ng-click="setSpeed(2)">2x</a>\n		<a ng-click="setSpeed(5)">5x</a>\n\n	</div>\n'),a.put("templates/video.html",'<div>\n	<iframe id="ytplayer{{uid}}" ng-show="video.youtube" ng-src="{{video.youtube + \'?enablejsapi=1&controls=0&modestbranding=1&showinfo=0\'}}"></iframe>\n	<video ng-show="!video.youtube">\n		<source class="mpeg4" ng-if="video.mpeg4" ng-src="{{video.mpeg4}}" type="video/mp4" />\n		<source class="webm" ng-if="video.webm" ng-src="{{video.webm}}" type="video/webm" />\n		<p>Oh no! Your browser does not support the HTML5 Video element.</p>\n	</video>\n\n	<pre>{{video | pretty}}</pre>\n</div>\n')}]),angular.module("com.inthetelling.player").factory("config",function(){var a=window.config;return a.apiDataBaseUrl||(a.apiDataBaseUrl="//"+window.location.host),a}),angular.module("com.inthetelling.player").factory("authSvc",["config","$routeParams","$http","$q","$location",function(a,b,c,d,e){var f={};f.roles=[],f.userHasRole=function(a){for(var b=0;b<f.roles.length;b++)if(f.roles[b]===a)return!0;return!1},f.authenticate=function(){var a=d.defer();if(b.key){var c=b.key;e.search("key",null),h(c).then(function(){a.resolve()})}else g().then(function(b){h(b).then(function(){a.resolve()})});return a.promise};var g=function(){var b=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_nonce").success(function(a){b.resolve(a.nonce)}).error(function(){b.reject()}),b.promise},h=function(b){var e=d.defer();return c.get(a.apiDataBaseUrl+"/v1/get_access_token/"+b).success(function(a){var b=a.acess_token;f.roles=a.roles,c.defaults.headers.get={Authorization:'Token token="'+b+'"'},e.resolve(a)}).error(function(){e.reject()}),e.promise};return f}]),angular.module("com.inthetelling.player").factory("dataSvc",["$q","$http","$routeParams","$timeout","config","authSvc","modelSvc",function(a,b,c,d,e,f,g){var h={};h.getEpisodeList=function(){var c=a.defer();return f.authenticate().then(function(){b.get(e.apiDataBaseUrl+"/v1/episodes").success(function(a){c.resolve(a)}).error(function(){})}),c.promise},h.getEpisode=function(a){g.episodes[a]||(g.cache("episode",{_id:a}),f.authenticate().then(function(){l().then(function(){o(a)},function(){})},function(){}))};var i={template:{},layout:{},style:{}},j=!1,k=a.defer(),l=function(){if(j===!0)k.resolve();else{if("in progress"===j)return k.promise;j="in progress",a.all([b.get(e.apiDataBaseUrl+"/v1/templates"),b.get(e.apiDataBaseUrl+"/v1/layouts"),b.get(e.apiDataBaseUrl+"/v1/styles")]).then(function(a){m("templates",a[0].data),m("layouts",a[1].data),m("styles",a[2].data),j=!0,k.resolve()},function(){j=!1,k.reject()})}return k.promise},m=function(a,b){angular.forEach(b,function(b){"templates"===a?i.template[b._id]={id:b._id,url:b.url,type:b.applies_to_episodes?"Episode":b.event_types[0],displayName:b.name}:"layouts"===a?i.layout[b._id]={id:b._id,css:b.css_name,displayName:b.display_name}:"styles"===a&&(i.style[b._id]={id:b._id,css:b.css_name,displayName:b.display_name})})},n=function(a){if(a.template_id&&i.template[a.template_id]&&(a.templateUrl=i.template[a.template_id].url,delete a.template_id),a.layout_id){var b=[];angular.forEach(a.layout_id,function(a){i.layout[a]&&b.push(i.layout[a].css)}),b.length>0&&(a.layouts=b),delete a.layout_id}if(a.style_id){var c=[];angular.forEach(a.style_id,function(a){i.style[a]&&c.push(i.style[a].css)}),c.length>0&&(a.styles=c),delete a.style_id}return a},o=function(a){b.get(e.apiDataBaseUrl+"/v1/episodes/"+a).success(function(b){("Published"===b.status||f.userHasRole("admin"))&&(g.cache("episode",n(b)),p(a),q(b.container_id,a))}).error(function(){})},p=function(a){b.get(e.apiDataBaseUrl+"/v2/episodes/"+a+"/events").success(function(b){angular.forEach(b,function(a){g.cache("event",n(a))}),g.resolveEpisodeEvents(a)}).error(function(){})},q=function(a,c){b.get(e.apiDataBaseUrl+"/v1/containers/"+a).success(function(a){g.cache("container",a[0]),a[0].parent_id&&q(a[0].parent_id,c)}).error(function(){}),b.get(e.apiDataBaseUrl+"/v1/containers/"+a+"/assets").success(function(a){angular.forEach(a.files,function(a){g.cache("asset",a)}),g.resolveEpisodeAssets(c)}).error(function(){})};return h}]),angular.module("com.inthetelling.player").factory("modelSvc",function(){var a={};a.episodes={},a.assets={},a.events={},a.appState={viewMode:"discover",time:0,timeMultiplier:1,duration:0,timelineState:"paused",editing:!1,blerg:"fnord"},a.containers={},a.cache=function(b,c){"episode"===b?a.episodes[c._id]?angular.extend(a.episodes[c._id],a.deriveEpisode(angular.copy(c))):a.episodes[c._id]=a.deriveEpisode(angular.copy(c)):"event"===b?a.events[c._id]?angular.extend(a.events[c._id],a.deriveEvent(angular.copy(c))):a.events[c._id]=a.deriveEvent(angular.copy(c)):"asset"===b?a.assets[c._id]?angular.extend(a.assets[c._id],a.deriveAsset(angular.copy(c))):a.assets[c._id]=a.deriveAsset(angular.copy(c)):"container"===b&&(a.containers[c._id]?angular.extend(a.containers[c._id],angular.copy(c)):a.containers[c._id]=angular.copy(c))},a.deriveEpisode=function(a){return a},a.deriveAsset=function(a){return"Asset::Video"===a._type&&(a=c(a)),a},a.deriveEvent=function(a){return a.layouts&&(a.layout=a.layouts[0],("inline"===a.layout||a.layout.match(/sidebar/)||a.layout.match(/burst/))&&(a.isContent=!0)),"Annotation"===a._type&&a.templateUrl.match(/transcript/)&&(a.isTranscript=!0),a},a.resolveEpisodeEvents=function(c){var d=[],e=[];angular.forEach(a.events,function(a){a.episode_id===c&&("Scene"===a._type?d.push(a):e.push(a))}),a.episodes[c].scenes=d.sort(function(a,b){return a.start_time>b.start_time}),a.episodes[c].items=e.sort(function(a,b){return a.start_time>b.start_time}),angular.forEach(d,function(b){var c=[];angular.forEach(e,function(d){d.start_time>=b.start_time&&d.start_time<b.end_time&&(a.events[d._id].scene_id=b._id,c.push(d))}),a.events[b._id].items=c.sort(function(a,b){return a.start_time>b.start_time})}),a.episodes[c].styleCss=b(a.episodes[c]),angular.forEach(a.events,function(a){a.episode_id===c&&(a.styleCss=b(a))})},a.episode=function(b){return!a.episodes[b],a.episodes[b]},a.episodeEvents=function(b){var c=[];return angular.forEach(a.events,function(a){a.episode_id===b&&c.push(a)}),c},a.scene=function(b){return!a.events[b],a.events[b]};var b=function(b){var c={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},d=[];if(angular.forEach(b.styles,function(a){d.push(a),angular.forEach(c,function(b,d){0===a.indexOf(d)&&(c[d]=a)})}),b.scene_id){var e=a.events[b.scene_id].styles;angular.forEach(e,function(a){angular.forEach(c,function(b,e){c[e]||0!==a.indexOf(e)||(d.push(a),c[e]=a)})})}if(b.episode_id){var f=a.episodes[b.episode_id].styles;angular.forEach(f,function(a){angular.forEach(c,function(b,e){c[e]||0!==a.indexOf(e)||d.push(a)})})}return d.join(" ")};a.resolveEpisodeAssets=function(b){angular.forEach(a.events,function(c){if(c.episode_id===b){var d=c.asset_id||c.link_image_id||c.annotation_image_id;d&&a.assets[d]&&(a.events[c._id].asset=a.assets[d])}}),a.episodes[b].masterAsset=a.assets[a.episodes[b].master_asset_id]},a.addLandingScreen=function(b){a.events["internal:landingscreen:"+b]={_id:"internal:landingscreen:"+b,_type:"Scene",templateUrl:"templates/scene/landingscreen.html",episode_id:b,start_time:0,end_time:0,stop:!0}};var c=function(a){var b={};if(a.alternate_urls){for(var c=/\.(\w+)$/,e=0;e<a.alternate_urls.length;e++)if(a.alternate_urls[e].match(/youtube/))b.youtube=a.alternate_urls[e];else switch(a.alternate_urls[e].match(c)[1]){case"mp4":b.mpeg4=d(b.mpeg4,a.alternate_urls[e]);break;case"m3u8":b.m3u8=d(b.m3u8,a.alternate_urls[e]);break;case"webm":b.webm=d(b.webm,a.alternate_urls[e])}a.you_tube_url&&(b.youtube=a.you_tube_url)}else b={mpeg4:a.url.replace(".mp4",".m3u8"),webm:a.url.replace(".mp4",".webm"),youtube:a.you_tube_url};var f=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);return(f||navigator.platform.indexOf("iPad")>-1)&&b.mpeg4&&(b.youtube=void 0),a.video=b,a},d=function(a,b){if(!a&&b)return b;if(!b)return a;if(!a&&!b)return"";var c=/(\d+)x(\d+)\.\w+$/,d=a.match(c)||[0,0],e=b.match(c)||[0,0];return Math.floor(d[1])<Math.floor(e[1])?b:a};return a}),angular.module("com.inthetelling.player").factory("timelineSvc",["$timeout","$interval","modelSvc",function(a,b,c){var d={};d.timelineEvents=[];var e,f,g,h,i;d.registerVideo=function(b,e){void 0!==g&&a(function(){d.seek(c.appState.time)}),f=b,g=e},d.setSpeed=function(a){i=a,c.appState.timeMultiplier=i,f.setSpeed(g,a),l()},d.play=function(){angular.isDefined(e)||(c.appState.timelineState="playing",f.play(g),h=b(p,1e3),n(),e=b(n,20),l())},d.pause=function(l){b.cancel(e),b.cancel(h),a.cancel(j),e=void 0,k=void 0,h=void 0,c.appState.timelineState="paused",f.pause(g),l&&a(d.play,1e3*l*Math.abs(i))},d.seek=function(b){if(a.cancel(j),0===c.appState.duration)return void a(function(){d.seek(b)},300);var e=c.appState.time;b=o(b),0>b&&(b=0),b>c.appState.duration&&(b=c.appState.duration),c.appState.time=b,b>e?d.updateEventStates(e,b):d.updateEventStates(b,e),f.seek(g,b),l()};var j,k,l=function(b){if(a.cancel(j),"playing"===c.appState.timelineState){var e=c.appState.time;if(!b){var f;for(f=0;f<d.timelineEvents.length;f++)if(d.timelineEvents[f].t>e){b=f;break}}if(!(void 0===b||0>b||b>d.timelineEvents.length)){var g=Math.abs(d.timelineEvents[b].t-e)/Math.abs(i)*1e3;j=a(function(){var a=d.timelineEvents[b].t;for(c.appState.time=a;d.timelineEvents[b].t===a;)m(d.timelineEvents[b]),b+=1;l(b)},g)}}},m=function(a){"timeline"===a.id?"pause"===a.action?d.pause():d.play():"enter"===a.action?(c.events[a.id].state="isCurrent",c.events[a.id].isCurrent=!0):(c.events[a.id].state="isPast",c.events[a.id].isCurrent=!1)},n=function(){var a=new Date,b=isNaN(a-k)?0:a-k,e=parseFloat(c.appState.time)+b/1e3*i;0>e&&(e=0,d.pause()),e>c.appState.duration&&(e=c.appState.duration,d.pause()),c.appState.time=e,k=a};d.init=function(a){d.timelineEvents=[],c.appState.time=0,i=1,c.appState.duration=0,c.appState.timelineState="paused",l(),d.injectEvents(c.episodeEvents(a),0)},d.injectEvents=function(a){0!==a.length&&(angular.forEach(a,function(a){a.stop?(d.timelineEvents.push({t:a.start_time,id:"timeline",action:"pause"}),d.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),d.timelineEvents.push({t:a.start_time+.01,id:a._id,action:"exit"})):(0===a.start_time&&(a.start_time=.01),d.timelineEvents.push({t:a.start_time,id:a._id,action:"enter"}),(a.end_time||0===a.end_time)&&d.timelineEvents.push({t:a.end_time,id:a._id,action:"exit"}))}),d.timelineEvents=d.timelineEvents.sort(function(a,b){return a.t>b.t}),c.appState.duration=d.timelineEvents[d.timelineEvents.length-1].t,d.updateEventStates(0,c.appState.duration))},d.updateEventStates=function(){var a=c.appState.time;angular.forEach(d.timelineEvents,function(b){if("timeline"!==b.id){var d=c.events[b.id];d.end_time<a?(d.state="isPast",d.isCurrent=!1):d.start_time>a?(d.state="isFuture",d.isCurrent=!1):(d.state="isCurrent",d.isCurrent=!0)}})};var o=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return a;var b=a.match(/^(\d+)[m:]([\d\.]+)s?$/);return b?parseFloat(60*b[1])+parseFloat(b[2]):(b=a.match(/^([\d\.]+)s$/))?parseFloat(b[1]):(b=a.match(/^([\d\.]+)m$/),b?parseFloat(60*b[1]):void 0)},p=function(){var a=f.currentTime(g),b=c.appState.time,e=a-b;Math.abs(e)>1?d.seek(a):Math.abs(e)>.1?(i=e/c.appState.timeMultiplier+c.appState.timeMultiplier,0>i&&(i=0)):i=c.appState.timeMultiplier,l()};return d}]),angular.module("com.inthetelling.player").factory("youtubeSvc",["$window","$document",function(a,b){var c={},d=document.createElement("script");return d.src="//www.youtube.com/iframe_api",angular.element(b[0].head).append(d),a.onYouTubeIframeAPIReady=function(){c.youtubeIsReady=!0},c.players=[],c.createPlayer=function(a){if(c.youtubeIsReady){if(!c.players[a.id]){var b=new YT.Player(a.id,{events:{onStateChange:function(){}}});c.players[a.id]=b}return c.players[a.id]}},c}]),angular.module("com.inthetelling.player").filter("pretty",function(){return function(a){return JSON.stringify(a,void 0,2)}}).filter("itemLayout",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.layouts&&a.layouts[0]===b&&c.push(a)}),c}}).filter("annotation",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"===a._type&&b.push(a)}),b}}).filter("transmedia",function(){return function(a){var b=[];return angular.forEach(a,function(a){"Annotation"!==a._type&&b.push(a)}),b}}).filter("transcript",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isTranscript&&b.push(a)}),b}}).filter("isCurrent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isCurrent&&b.push(a)}),b}}).filter("isContent",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.isContent&&b.push(a)}),b}}),angular.module("com.inthetelling.player").controller("ErrorController",["$scope","$rootScope","$location",function(a,b){b.$on("error",function(b,c){a.error=c})}]),angular.module("com.inthetelling.player").controller("EpisodeListController",["$scope","dataSvc",function(a,b){b.getEpisodeList().then(function(b){a.episodes=b})}]),angular.module("com.inthetelling.player").controller("TimelineController",["$scope","timelineSvc",function(a,b){a.play=b.play,a.pause=b.pause,a.setSpeed=function(a){b.setSpeed(a)},a.$on("$destroy",function(){b.pause()})}]),angular.module("com.inthetelling.player").controller("PlayerController",["$scope","$routeParams","$timeout","dataSvc","modelSvc","timelineSvc",function(a,b,c,d,e,f){b.viewMode&&(e.appState.viewMode=b.viewMode),b.t&&f.seek(b.t),d.getEpisode(b.epId),e.addLandingScreen(b.epId);var g=a.$watch(function(){return e.episodes[b.epId].title},function(a,b){a!==b&&(document.title="STORY: "+a,g())}),h=a.$watch(function(){return e.episodes[b.epId].items},function(a,c){a!==c&&(f.init(b.epId),h())});a.episode=e.episode(b.epId),a.appState=e.appState,a.viewMode=function(a){e.appState.viewMode=a}}]),angular.module("com.inthetelling.player").controller("EpisodeController",["$scope","modelSvc","$routeParams","timelineSvc",function(a,b,c){a.episode=b.episode(c.epId),a.appState=b.appState}]),angular.module("com.inthetelling.player").controller("SceneController",["$scope",function(){}]),angular.module("com.inthetelling.player").controller("ItemController",["$scope",function(){}]),angular.module("com.inthetelling.player").controller("VideoController",["$scope","$timeout","$window","$document","modelSvc","timelineSvc","youtubeSvc",function(a,b,c,d,e,f,g){a.$on("$destroy",function(){a.YTPlayer=void 0}),a.registerVideo=function(b){a.video.youtube?(a.videoType="youtube",a.YTPlayer=g.createPlayer(b.find("iframe")[0]),f.registerVideo(a,b.find("iframe")[0])):(a.videoType="video",f.registerVideo(a,b.find("video")[0]))},a.play=function(b){"youtube"===a.videoType?a.YTPlayer.playVideo():b.play()},a.pause=function(b){"youtube"===a.videoType?(a.YTPlayer.seekTo(e.appState.time,!0),a.YTPlayer.pauseVideo()):(b.currentTime=e.appState.time,b.pause())},a.seek=function(c,d){try{"youtube"===a.videoType?(a.YTPlayer.seekTo(d,!0),"paused"===e.appState.timelineState&&a.pause(c)):c.currentTime=d}catch(f){b(function(){a.seek(c,d)},100)}},a.setSpeed=function(b,c){0>=c||"youtube"===a.videoType||(b.playbackRate=c)},a.currentTime=function(b){return"youtube"===a.videoType?a.YTPlayer.getCurrentTime():b.currentTime}}]),angular.module("com.inthetelling.player").directive("ittTimeline",["modelSvc","timelineSvc",function(a){return{restrict:"A",replace:!0,templateUrl:"templates/timeline.html",controller:"TimelineController",link:function(b){b.appState=a.appState}}}]),angular.module("com.inthetelling.player").directive("ittEpisode",function(){return{restrict:"A",replace:!0,templateUrl:"templates/episode/episode.html",controller:"EpisodeController",link:function(){}}}),angular.module("com.inthetelling.player").directive("ittScene",function(){return{restrict:"A",replace:!0,scope:{scene:"=ittScene"},templateUrl:"templates/scene/scene.html",controller:"SceneController",link:function(a){a.scene.templateUrl.match(/landingscreen/)&&(a.landingscreen=!0)}}}),angular.module("com.inthetelling.player").directive("ittItem",["modelSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItem"},templateUrl:"templates/item/item.html",controller:"ItemController",link:function(b){b.edit=function(){a.appState.editing=angular.copy(b.item)}}}}]),angular.module("com.inthetelling.player").directive("ittItemEditor",["modelSvc",function(a){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},templateUrl:"templates/item/edit.html",controller:"ItemController",link:function(b){b.save=function(){for(var c in b.item)b.item.hasOwnProperty(c)&&(a.events[b.item._id][c]=angular.copy(b.item[c]));a.appState.editing=!1},b.cancelEdit=function(){a.appState.editing=!1}}}}]),angular.module("com.inthetelling.player").directive("ittVideo",function(){var a=0;return{restrict:"A",replace:!0,templateUrl:"templates/video.html",controller:"VideoController",scope:{video:"=ittVideo"},link:function(b,c){if(b.uid=++a,b.video)b.registerVideo(c);else var d=b.$watch(function(){return b.video},function(a){a&&(b.registerVideo(c),d())})}}});