webpackJsonp([0],{"+Pmc":function(e,t){e.exports=" <a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=\"itemTemplate imageFill\" ng-style=\"{'background-image': 'url(' + item.asset.cssBgUrl + ')'}\"> <img class=fillImg ng-src={{item.asset.url}}> </div> "},"+tHN":function(e,t){e.exports='<div itt-magnetized class="pane videoContainer"> <span ng-if="episode.swap && episode.replacingMasterAsset" style=visibility:hidden> <itt-video class="video contentLayer" media-src-arr=episode.swap.mediaSrcArr poster=episode.poster player-id=episode.swap._id main-player=true> </itt-video> </span> <span ng-if="episode.masterAsset && !episode.replacingMasterAsset"> <itt-video class="video contentLayer" media-src-arr=episode.masterAsset.mediaSrcArr poster=episode.poster player-id=episode.masterAsset._id main-player=true> </itt-video> </span> <div class="pane fill overlay fgLayer"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in episode.items | itemLayout:\'videoOverlay\' | isCurrent"> </div> </div> </div> '},"/w+Y":function(e,t,i){e.exports='<div class="landingscreen stretchToViewportShort"> <div> <div class="pane introtext"> <h1 ng-bind-html=episode.display_title></h1> <p id=episode--description ng-bind-html=episode.display_description></p> <br> </div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+"> </div> <div class=landingscreen-end></div> <div class=clear></div> </div> </div> "},"00PB":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class=item__title> <h2 class="item__title item__title--transmedia" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></h2> </div> </div> <div class="text item__text item__text--transmedia" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '},"0BWP":function(e,t,i){e.exports="<div ng-show=\"appState.viewMode == 'review'\" class=searchMode> <div itt-magnet id=searchVideoMagnet class=videoMagnet> <img src="+i("rXKF")+"> </div> <div itt-search-panel></div> </div> "},"0YuG":function(e,t){e.exports=angular},"1tPm":function(e,t){e.exports="<div class=errors> <div class=error> <h3>Error: no such route</h3> <p><i>404. File not found. Sorry!</i></p> </div> </div> "},"2AAL":function(e,t){e.exports='<div class=""> <np-modal wrapper-class=responsive-modal__wrapper modal-class=narrative__modal ng-if="$ctrl.narrativeSelect || $ctrl.narrativeToEdit"> <h3>{{$ctrl.narrativeSelect ? \'Add\' : \'Edit\'}} Narrative</h3> <np-narrative-editor customers=$ctrl.selectedCustomer narrative=$ctrl.narrativeToEdit hide-path-slug=$ctrl.narrativeSelect on-done=$ctrl.closeAddOrEditModal($undo) on-update=$ctrl.addOrUpdateNarrative($narrative)> </np-narrative-editor> </np-modal> <div ng-repeat="customer in $ctrl.customersData" ng-click="$ctrl.customerRowClick(customer, $event)" ng-class=$ctrl.setRowClasses(customer)> <span ng-click="$ctrl.toggleRow(customer, $event)" ng-class="customer.showNarratives ? \'isOpen\' : \'isClosed\'"> </span> <a>{{customer.name}}</a> <div ng-if="customer.isActive === true"> <div ng-if=$ctrl.canAccess style=padding-left:1em> <np-tooltip tip-text="Add Narrative"> <a class="icon__button button__add-inverted" ng-click=$ctrl.setSelectedNarrative(customer)></a> </np-tooltip> </div> </div> <div ng-repeat="narrative in customer.narratives" style=padding-left:2em ng-if="customer.showNarratives === true" ng-click="$ctrl.toggleNarrativeRow(narrative, $event)" ng-class="$ctrl.setNarrativeRowClasses(customer, narrative)"> <div> <np-edit-pencil can-access=true on-edit="$ctrl.setNarrativeToEdit($event, narrative, customer)"> <a>{{narrative.name.en}}</a> </np-edit-pencil> <p ng-if=narrative.description> <small>{{narrative.description.en}}</small> </p> <div ng-if="$ctrl.narrativeRow._id === narrative._id"> <np-tooltip tip-text="Go to Narrative"> <a ng-click="$ctrl.gotoNarrative(narrative._id, $event)" class="icon__button button__generateNarrative" title="Go to Narrative"></a> </np-tooltip> <a> <np-guest-accessible-url narrative=narrative clipboard-mode="Click to Copy"> </np-guest-accessible-url> </a> </div> </div> </div> </div> </div> '},"3/az":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="pullquote item__text item__text--pullquote" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> <div class=pullquoteSpeaker ng-if=item.display_annotator> — <span ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></span></div> </div> '},"3u31":function(e,t){e.exports="<input ng-if=\"inputtype=='input'\" ng-model=field[appState.lang] name={{textangularname}} ng-required=doValidate> <text-angular ng-if=\"inputtype=='textarea'\" name={{textangularname}} ng-required=doValidate ng-model=field[appState.lang] ta-paste=sanitizePastedHtml($html) ta-default-wrap=span ng-blur=trim()></text-angular> "},"45E6":function(e,t){e.exports='<div ng-show="!appState.editEvent && !appState.editEpisode" class=controlPanel ng-class="{\n\tisProducer: appState.product == \'producer\',\n\tisSxS: appState.product == \'sxs\'\n}"> <div ng-if="appState.product == \'producer\'" class=editButtonPanel> <a class="button button-episode" ng-click=editEpisode()>Edit episode</a> <a class="button button-scene" ng-if="playbackService.getMetaProp(\'time\') > 0  && playbackService.getMetaProp(\'time\') < (playbackService.getMetaProp(\'duration\') - 0.1) && appState.viewMode == \'discover\'" ng-click=editCurrentScene()>Edit Layout</a> </div> <div class="producer addButtonPanel" ng-show="!item && playbackService.getMetaProp(\'time\') > 0 && playbackService.getMetaProp(\'time\') < (playbackService.getMetaProp(\'duration\') - 0.1) "> <span ng-if=expanded style="padding:0 1em" class="animate transitionExpandW"> <span ng-if="appState.product == \'sxs\'"> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Comment</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')">File</a> <a class="button button-video" ng-click="addEvent(\'video\')">Video</a> </span> <span ng-if="appState.product == \'producer\'"> <a class="button button-scene" ng-click="addEvent(\'scene\')">Layout</a> <a class="button button-comment" ng-click="addEvent(\'transcript\')">Transcript</a> <a class="button button-comment" ng-click="addEvent(\'annotation\')">Annotation</a> <a class="button button-link" ng-click="addEvent(\'link\')">Link</a> <a class="button button-image" ng-click="addEvent(\'image\')">Image</a> <a class="button button-file" ng-click="addEvent(\'file\')" ng-if="userHasRole(\'admin\') || userHasRole(\'customer admin\')">File</a> <a class="button button-question" ng-click="addEvent(\'question\')">Question</a> <a class="button button-chapter" ng-click="addEvent(\'chapter\')">Chapter</a> </span> </span> <span ng-if=!expanded> <a class="button button-add" ng-click=expand()>Add</a> </span> </div> </div> '},"5EdM":function(e,t){e.exports="<div class=\"itemEdit authoringForm\"> <form name=ittItemForm class=doValidate> <div ng-if=\"appState.product == 'sxs'\" class=authoringFormScrollContainer> <itt-time-field></itt-time-field> <div np-dynamic-event-template component-name={{sxsItemComponentFieldName}}></div> </div> <div ng-if=\"appState.product == 'producer'\"> <div itt-tabs class=ittTabs> <div itt-tab class=ittTab ng-if=\"selectService.showTab(item.producerItemType, 'Item')\" title=\"{{item.producerItemType | capitalize}}\"> <label ng-if=\"languages.length > 1\" style=float:right;padding-right:24px for=itemLangSelect>Current Language <select id=itemLangSelect size=1 ng-model=appState.lang ng-change=forcePreview() ng-options=\"language.code as ('['+language.code.toUpperCase()+']') for language in languages\"> </select> </label> <div ng-switch on=item.producerItemType> <div ng-switch-when=link> <itt-time-field></itt-time-field> <itt-title-field do-validate=true data=item itt-item-form=ittItemForm></itt-title-field> <np-url-field data=item itt-item-form=ittItemForm></np-url-field> <itt-description-field data=item></itt-description-field> <np-template-select data=item item-form=itemForm></np-template-select> <itt-image-field></itt-image-field> <np-flags data=item component-name={{item.component_name}} item-form=itemForm flags=\"['required', 'stop', 'cosmetic']\"></np-flags> </div> <div ng-switch-when=transcript> <itt-time-field></itt-time-field> <itt-speaker-field></itt-speaker-field> <itt-transcript-field data=item itt-item-form=ittItemForm></itt-transcript-field> <itt-speaker-thumb-field></itt-speaker-thumb-field> </div> <div ng-switch-when=annotation> <itt-time-field></itt-time-field> <itt-title-field data=item></itt-title-field> <itt-annotation-field data=item itt-item-form=ittItemForm></itt-annotation-field> <np-template-select data=item item-form=itemForm></np-template-select> <itt-speaker-field></itt-speaker-field> <np-flags data=item component-name={{item.component_name}} item-form=itemForm flags=\"['stop', 'cosmetic', 'chapter_marker', 'invertColor']\"></np-flags> </div> <div ng-switch-when=file> <itt-time-field></itt-time-field> <itt-title-field do-validate=true data=item itt-item-form=ittItemForm></itt-title-field> <itt-file-field></itt-file-field> <itt-description-field data=item></itt-description-field> <np-flags data=item component-name={{item.component_name}} item-form=itemForm flags=\"['required', 'stop', 'cosmetic']\"></np-flags> </div> <div ng-switch-when=image> <itt-time-field></itt-time-field> <itt-title-field do-validate=true data=item itt-item-form=ittItemForm></itt-title-field> <itt-image-field></itt-image-field> <itt-description-field data=item></itt-description-field> <np-template-select data=item item-form=itemForm></np-template-select> <itt-display-select data=item item-form=itemForm></itt-display-select> <np-flags data=item component-name={{item.component_name}} item-form=itemForm flags=\"['required', 'stop', 'cosmetic']\"></np-flags> </div> <div ng-switch-when=question> <span class=\"eventIcon icon-question\"></span> <itt-time-field></itt-time-field> <itt-title-field do-validate=true data=item itt-item-form=ittItemForm></itt-title-field> <itt-question-text-field data=item do-validate=false itt-item-form=ittItemForm></itt-question-text-field> <itt-question-type-select data=item></itt-question-type-select> <itt-image-field></itt-image-field> <itt-question-options></itt-question-options> </div> <div ng-switch-when=chapter> <itt-time-field></itt-time-field> <itt-title-field do-validate=true data=item itt-item-form=ittItemForm></itt-title-field> <itt-description-field data=item></itt-description-field> </div> <div ng-switch-when=video> <h4>{{item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> <div itt-tab class=ittTab ng-if=\"selectService.showTab(item.producerItemType, 'Style')\" title=\"{{item.producerItemType === 'scene' ? 'Layout' : 'Style'}}\"> <div ng-switch on=item.producerItemType> <div ng-switch-when=link> <itt-display-select></itt-display-select> </div> <div ng-switch-when=transcript> <np-template-select data=item item-form=itemForm></np-template-select> </div> <div ng-switch-when=annotation> <itt-display-select></itt-display-select> </div> <div ng-switch-when=scene> <itt-time-field></itt-time-field> <np-template-select data=item item-form=itemForm></np-template-select> <itt-video-position-select data=item></itt-video-position-select> <itt-display-select data=item></itt-display-select> </div> <div ng-switch-when=question> <np-template-select data=item item-form=itemForm></np-template-select> <itt-display-select data=item item-form=itemForm></itt-display-select> <np-flags data=item component-name={{item.component_name}} item-form=itemForm flags=\"['required', 'stop', 'cosmetic']\"></np-flags> </div> <div ng-switch-when=chapter> <h4>{{item.producerItemType}}</h4> </div> <div ng-switch-when=video> <h4>{{item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> <div itt-tab class=ittTab ng-if=\"selectService.showTab(item.producerItemType, 'Customize')\" title=Customize> <div ng-switch on=item.producerItemType> <div ng-switch-when=link> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=transcript> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=annotation> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=scene> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=file> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=image> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=question> <itt-typography-select></itt-typography-select> <itt-color-select></itt-color-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> <div ng-switch-when=chapter> <h4>{{item.producerItemType}}</h4> </div> <div ng-switch-when=video> <h4>{{item.producerItemType}}</h4> </div> <div ng-switch-default> <h4>Default!</h4> </div> </div> </div> </div> </div> <div class=ittTabFoot> <a ng-click=cancelEdit()>Cancel</a> &nbsp; &nbsp; <button ng-if=\"\n\t\t\titem._id != 'internal:editing' &&\n\t\t\t!(item._type == 'Scene' && item.start_time <= 0.01)\n\t\t\" ng-click=deleteEvent(item._id)>Delete </button> <button ng-click=saveEvent() ng-disabled=\"blockDoubleClicks || ittItemForm.$invalid\">Save</button> </div> </form> </div> "},"5Ei1":function(e,t){e.exports='<div class=userHome> <div class=user__info> <div class=user__item> <div class=user__label>Role</div> <h4>{{user.role_description}}</h4> <hr> </div> <div clas=user__item> <div class=user__label>Name</div> <np-edit-pencil can-access=true on-edit=toggleEditing() ng-if=!isEditing> <p>{{user.name}}</p> </np-edit-pencil> <div ng-if=isEditing> <input class=userEditable ng-model=user.name> <button class=button ng-click="updateUser(); toggleEditing()">save</button> <button class=button ng-click=toggleEditing()>cancel</button> </div> <hr> </div> <div class=user__item ng-if=!isTrueGuest()> <div class=user__label>Email</div> <div>{{user.email}}</div> <hr> </div> <div class=user__item ng-if=!isTrueGuest()> <div class=user__avatar> <div class=user__label>Avatar</div> <div> <img ng-src="{{appState.user.avatar || appState.noAvatar }}"> </div> <div ng-if="showUploadField && !uploads"> <input type=file accept=image/* itt-files-handler on-selected=uploadAvatar(files)> </div> <button class=button ng-click=toggleUploadAvatar()>{{showUploadField ? \'cancel\' : \'replace\'}}</button> </div> </div> </div> </div> '},"5Tuk":function(e,t,i){e.exports=i.p+"images/Narrasys-Tree.cc1cd923afd67c6dc362c6aa5c3b5399.png"},"6mC1":function(e,t,i){e.exports='<div class="scene onecol" ng-class="scene.styleCss + \' \'+ scene.state"> <div itt-magnet class=videoMagnet ng-class="{hasLeftSidebar: mainContentHasLeftSidebar, hasRightSidebar: mainContentHasRightSidebar}"> <img src='+i("rXKF")+'> </div> <div class=col> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (mainContentItems | isCurrent).length == 1\n\t\t\t\t\t: (mainContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (contentItems | isCurrent) : contentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},"7/ac":function(e,t,i){e.exports='<div class=toolbar> <div class="buttongroup nav-item scene-nav-btns"> <a ng-if="appState.productLoadedAs == \'narrative\' && !narrative.disable_navigation" class="button button-exitEpisode" href=/#/story/{{narrative.path_slug.en}}> <span>Exit</span> </a> <button tabindex=0 class="button button-nav" ng-click=toggleNavPanel();> <span>Chapters</span> </button> </div> <div class="nav-item toolbar-logos"> <img src='+i("teY+")+" id=toolbar-logo-big ng-if=\"episode.template.displayName === 'Narrasys Professional' && appState.windowWidth > 500\"> <img src="+i("5Tuk")+' id=toolbar-logo-small ng-if="episode.template.displayName === \'Narrasys Professional\' && appState.windowWidth <= 500"/> </div> <div class="nav-item new-window-btn"> <div ng-if="appState.isFramed && (appState.productLoadedAs == \'player\'\n\t \t\t\t|| (appState.productLoadedAs == \'narrative\'\n\t \t\t\t&& !narrative.disable_new_window ) )" class="escapegroup buttongroup"> <a class="button button-mainframeescape" ng-click=pause() ng-href={{calcNewWindowUrl()}} target=_blank> <span>New window</span> </a> </div> </div> <div class="nav-item searchgroup buttongroup" ng-class="{cur: show.searchPanel}"> <button tabindex=2 class="button button-search" ng-click=toggleSearchPanel() aria-label=Search aria-expanded={{show.searchPanel}}> <span>Search</span> </button> <label for=searchtext class=hidden>Search Text</label> <input tabindex=2 name=searchtext id=searchtext type=text ng-show=show.searchPanel ng-model=appState.searchText ng-model-options="{ debounce: 200 }"/> </div> <div class="nav-item socialshare social-buttongroup"> <itt-social-share ng-if=socialShareInfo subdomain={{socialShareInfo.subDomain}} paths="{narrative: socialShareInfo.narrative, timeline: socialShareInfo.timeline}" share-title={{socialShareInfo.tlTitle}} providers="[\'facebook\', \'linkedin\', \'twitter\', \'google\', \'reddit\', \'email\']"> </itt-social-share> </div> <div class="nav-item profilegroup buttongroup"> <a class="button button-preview" ng-if="appState.productLoadedAs==\'producer\' && (userHasRole(\'admin\') || userHasRole(\'customer admin\'))" ng-click=toggleProducerPreview()> <span ng-if="appState.product == \'producer\'">Preview</span> <span ng-if="appState.product == \'player\'">Edit</span> </a> <a class="button button-profile" ng-hide=isTrueGuest() ng-click="appState.show.profilePanel = !appState.show.profilePanel"> <span>Profile</span> </a> </div> </div> <div ng-cloak ng-show=show.navPanel class="navPanel topDrawer" ng-class=episode.styleCss> <div class=parent ng-repeat="parent in episode.parents" ng-bind-html=parent.display_name></div> <h2 ng-bind-html=episode.display_title class=fakeLink ng-click=seek(0)></h2> <div class=scene x-ng-if="chapter.display_annotation || chapter.display_title" x-ng-repeat="chapter in episode.chapters" x-ng-class="{currentScene: chapter.isCurrent}" x-ng-click=seek(chapter.start_time)> <span class=displayTime>{{chapter.displayStartTime}}</span> <p> <button class=fakeLink tabindex=0 ng-bind-html="chapter.display_annotation || chapter.display_title" x-ng-class="{sceneLink: !chapter.isCurrent}" ng-focus=showControls()></button> <br> <span ng-bind-html=chapter.display_description></span> </p> </div> </div> '},"8WnQ":function(e,t){e.exports="<div class=modal ng-style=modalStyle ng-click=dismiss();> <span ng-if=\"item._type == 'Link'\" ng-click=$event.stopPropagation()> <div class=modalmenu> <a href={{item.url}} target=_blank class=escapelink>(new window)</a> </div> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </span> <span ng-if=\"item._type == 'Upload'\"> <span ng-switch=\"item.asset.content_type.indexOf('image/')\"> <span ng-switch-when=-1> <div class=modalmenu> <a href={{item.asset.url}} target=_blank class=escapelink>(new window)</a> </div> <itt-iframe x-src={{item.asset.url}} item=item x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-default> <div class=modalimage ng-if=\"item._type == 'Upload'\"> <img ng-src={{item.asset.url}}> </div> </span> </span> </span> </div> "},"9DBX":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="thumbnail touchable" x-ng-class="{fullsize: item.showInlineDetail || item.isActive}" x-ng-click=toggleDetailView()> <img ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class="text item__text"> <div class="title item__title item__title--image-thumbnail" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--image text--image-thumbnail" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '},"9Hwp":function(e,t){e.exports=' <div ng-if=showAssetPicker class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets container-id={{episodeContainerId}}></sxs-container-assets> </div> <div class=controlsContainer> <button ng-click=endChooseAsset();>Cancel</button> </div> </div> <div> <div ng-if="episode.poster && !showUploadButtonsPoster"> {{episode.poster.display_name}} <button class=button ng-click="replaceAsset(\'Poster\')">Replace this</button> </div> <div ng-if="showUploadButtonsPoster || !episode.poster"> <span ng-if=showUploadFieldPoster> <itt-asset-uploader container-id={{episodeContainerId}} callback=posterUploaded(data)></itt-asset-uploader> </span> <span ng-if=!showUploadFieldPoster> <button class=button ng-click="chooseAsset(\'Poster\')">Browse uploaded</button> <button class=button ng-click="toggleUpload(\'Poster\')">Upload new</button> </span> </div> </div> '},AEnZ:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class=category> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="item__text--link text--description-first" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> <div class="title item__title item__title--link title--description-first"> <a tabindex=0 ng-if="handleOutgoingLinkDisplay() && !item.targetTop" class="escapelink item__escape-link item__link--escape-link escape-link--description-first" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex=0 ng-if="handleOutgoingLinkDisplay() && item.targetTop" target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> <a tabindex=0 ng-if=!handleOutgoingLinkDisplay() ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--description-first">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> </div> '},Ambl:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="item__text item__text--h2"> <h2 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h2> </div> </div> '},CKMt:function(e,t){e.exports=' <div class=np-video ng-if="$ctrl.mediaSrcArr.length > 0" ng-class="{\'np--embed\': $ctrl.mainPlayer === false}"> <div class=np-video__overlay-ui ng-if=$ctrl.showMask() ng-class=$ctrl.setCssClass() ng-click=$ctrl.videoClick()> </div> <div class=np-video__wrapper> <div class=np-video__element ng-bind-html=::$ctrl.playerElement></div> </div> <div class="poster overlay fill" ng-if="$ctrl.poster && $ctrl.playbackService.getMetaProp(\'time\') === 0" ng-style="{backgroundImage:\'url(\'+$ctrl.poster.url+\')\'}"> </div> </div> <div ng-if="$ctrl.mediaSrcArr.length < 1" class=np-video__empty> <div ng-if="$ctrl.isTranscoded === false"> <h3>Video is currently transcoding.</h3> <p>The page will refresh when the transcode is complete!</p> </div> <h1 ng-if="$ctrl.isTranscoded === true"> No video source available... </h1> </div> '},DC6m:function(e,t){e.exports='<div ng-class=episode.styleCss class=searchPanel__wrapper> <div aria-label="sort toggle" class=searchfilters aria-controls=sortableSearch> <div> Sorted by <button tabindex=0 class="fakeLink fake-link--search-results" ng-click=toggleSortBy(sortBy) aria-label="toggles sort to {{getToggledValue(sortBy)}}">{{getFriendlySortText(sortBy)}}</button> </div> </div> <div class=scrollContainer> <div class="searchResults content" id=sortableSearch itt-width-watch ng-class="{isNarrow: isNarrow}"> <div ng-if="sortBy == \'startTime\'" class=sortByTime> <h1 ng-bind-html=episode.display_title></h1> <div ng-repeat="scene in episode.scenes"> <span ng-switch=appState.product> <div ng-switch-when=producer ng-repeat="item in scene.items" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> <div ng-switch-default ng-repeat="item in scene.items | filter: {cosmetic: false }" ng-show="([item.searchableText] | filter:appState.searchText).length" class="item animate" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> </span> </div> </div> <div ng-if="sortBy == \'type\'" class=sortByType> <div ng-repeat="category in typeCategories"> <h3 ng-if="matchedItems.length > 0" ng-bind-html=showTypes[category].name></h3> <div class="item animate" ng-repeat="item in matchedItems=(showTypes[category].items | orderBy:\'start_time\')" ng-show="([item.searchableText] | filter:appState.searchText).length" ng-class=item.state itt-item=item forcetemplate=searchresults-all> </div> </div> <div ng-if="(episode.items | filter:{\'searchableText\': appState.searchText||\'\', \'cosmetic\': false}).length == 0"> (Nothing matched your search.) </div> </div> </div> </div> </div> '},DJti:function(e,t){},EKl2:function(e,t){e.exports='<span class="eventIcon icon-image"></span> <div class=field> <div class=label>Title </div> <div class=input> <input type=text ng-model=item.title.en autofocus> </div> </div> <div class=field> <div class=label>Image </div> <div class=input np-upload-sxs-template> </div> </div> <div class=field> <div class=label>Description </div> <div class=input sxs-input-i18n=item.description x-inputtype="\'textarea\'"></div> </div> '},ETbY:function(e,t,i){e.exports=" <div ng-if=\"appState.viewMode == 'watch'\" style=padding-bottom:100%> <div class=watchMode> <div itt-magnet id=watchModeVideoMagnet class=videoMagnet> <img src="+i("rXKF")+'> </div> </div> <span class=watchModeCaptions ng-class="{padForBottomToolbar: appState.videoControlsActive}"> <div class="item watchModeCaption" ng-if="item.isCurrent && !appState.hideCaptions" ng-repeat="item in episode.items | transcript" ng-class=item.state itt-item=item forcetemplate=caption> </div> </span> </div> '},Ec80:function(e,t,i){e.exports='<div class=ios-iframe-overlay ng-if=showIframeIOSOverlay ng-click=iframeIOSOverlayHandler()></div> <div ng-class="{\n\tisTouchDevice: appState.isTouchDevice,\n\tisFramed: appState.isFramed,\n\tisProducer: (appState.product == \'producer\'),\n\tisSxS: (appState.product == \'sxs\'),\n\n\tcanEditContent: (!appState.editEvent && !appState.editEpisode) && (appState.product == \'producer\' || appState.product == \'sxs\')\n\t}"> <div class=player> <np-toolbar-story></np-toolbar-story> <np-loading ng-if=loading></np-loading> <div ng-show=!loading itt-episode ng-class="{\n\t\tpadForEditing: appState.editEvent || appState.editEpisode,\n\t\tshowBackgroundOnly: appState.producerEditLayer < 0,\n\t\tshowForegroundOnly: appState.producerEditLayer > 0,\n\t}"></div> <div class=toolbar-bottom itt-show-hide-visual-only=appState.videoControlsActive ng-mouseenter=showControls(); ng-click=showControls(); ng-mouseleave=allowControlsExit()> <div class=toolbar-bottom-fill> <div ng-show="appState.editEvent || appState.editEpisode" class="navPanel editPanel"> <div ng-if=appState.editEvent itt-item-editor=appState.editEvent></div> <div ng-if=appState.editEpisode itt-episode-editor=appState.editEpisode></div> </div> <div itt-timeline></div> </div> </div> <div class=toolbar-bottom-controltrigger ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls()></div> </div> <div class="animate transitionFade" ng-if="appState.videoControlsActive && (appState.product == \'sxs\' || appState.product == \'producer\')" ng-mouseenter=showControls(); ng-click=showControls(); ng-focus=showControls() sxs-add-content></div> <div class=autoscroll ng-if="appState.autoscroll && appState.autoscrollBlocked" ng-click=enableAutoscroll()> <img src='+i("WeeJ")+" width=32 height=32> </div> <div ng-show=show.navPanel class=modal-backdrop ng-click=\"hidePanel('navPanel')\"></div> <div ng-show=show.profilePanel class=modal-backdrop ng-click=\"hidePanel('profilePanel')\"></div> <div ng-show=appState.itemDetail class=modal-backdrop ng-click=\"appState.itemDetail=false\"></div> <div ng-if=appState.itemDetail itt-item-detail-modal=appState.itemDetail></div> <div ng-if=show.profilePanel> <np-modal modal-class=account__modal wrapper-class=account__modal--wrapper> <button ng-hide=\"appState.isFramed ||  !(userHasRole('admin') || userHasRole('customer admin'))\" class=button ng-click=\"editInfo = !editInfo\">{{editInfo ? 'Done Editing' : 'Edit Profile'}}</button> <a class=button ng-click=\"show.profilePanel = false\">close</a> <np-nav ng-if=\"!editInfo && ((userHasRole('admin') || userHasRole('customer admin')) && !appState.isFramed)\" on-logout=$parent.logout() in-player=true></np-nav> <div ng-if=\"editInfo || appState.isFramed ||  !(userHasRole('admin') || userHasRole('customer admin'))\"> <div itt-user></div> </div> </np-modal> </div> <div ng-cloak ng-if=\"show.wileyNag &&  (appState.productLoadedAs == 'player'\n\t \t\t\t|| (appState.productLoadedAs == 'narrative'\n\t \t\t\t&& !narrative.disable_new_window ) )\" class=\"wileyNag animate transitionFade\"> <div> <span style=float:right>⤴</span> <span style=float:right;display:inline-block;padding:5px>Go here for best view</span> </div> <a class=goAway ng-click=noWileyNag()>Don't show this again</a> </div> </div> "},GAbr:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser> <span>Edit item</span> </a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text> <div class=title ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-if=item.asset.url class=touchable style=float:right;max-width:50%;padding-right:.5em> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question> <div class=clear></div> </div> </div> '},"I/G4":function(e,t,i){e.exports='<div class="scene pip" ng-class="scene.styleCss + \' \'+ scene.state"> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in (altBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in (altFgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> <div ng-class="{padForBottomToolbar: appState.videoControlsActive}"> <div class=videoPositioner> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in (mainBgItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer showCurrent" ng-class="{\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in mainContentItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> </div> <div class=clear></div> </div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> '},IiAB:function(e,t,i){e.exports=i.p+"images/no-avatar.a012e2f1c64d5ed04112b126c8c347ba.gif"},Ip2Z:function(e,t){e.exports='<div style=position:relative ng-show=!hasAnnotator()> <input class=annotatorChooser type=text ng-model=searchText ng-focus=showAutocomplete() ng-blur=hideAutocomplete() ng-change=handleAutocomplete()> <div class="autocompleteList animate transitionFade" ng-if=autoCompleting> <div class=autocompleteItem ng-repeat="annotator in filteredAnnotators" ng-click=select(annotator) ng-class="{selected: ($index == preselectedItem)}" style=white-space:nowrap> <img ng-src={{annotator.imageUrl}}> <span ng-bind-html="(annotator.key | highlightSubstring: searchText) || \'(New speaker)\'"></span> </div> </div> </div> <div style=position:relative ng-show=hasAnnotator()> <div sxs-input-i18n=item.annotator x-inputtype="\'input\'"></div> <a style=position:absolute;top:3px;right:10px ng-click="item.annotator={}">(x)</a> </div> '},IrCW:function(e,t){e.exports="<span> <div ng-if=showPlayer> <itt-player-container></itt-player-container> </div> </span> "},KCjZ:function(e,t,i){e.exports=' <div class="scene centerVV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div class=static-bg__main ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> <div class=col> <div class=static-bg__alt ng-style="setBgImgUrl(scene.items, \'altCol\')"></div> <div class="pane altPane stretchToViewport"> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> </div> </div> </div> '},KIuG:function(e,t,i){e.exports=' <div class="scene centerVV-mondrian" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div class=static-bg__alt ng-style="setBgImgUrl(scene.items, \'mainCol\')"></div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane altPane stretchToViewport"> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate centerVV-h2" ng-repeat="item in mainItems = (mainContentItems | isCurrent | filter:byPullquoteOrH2)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> <div class=col> <div class=static-bg__main ng-style="setBgImgUrl(scene.items, \'altCol\')"></div> <div class="pane mainPane"> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> </div> </div> </div> '},"L+g8":function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <a ng-click=outgoingLink(item.asset.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <div class=text ng-bind-html=item.description.en></div> <div class=clear></div> </div> '},LrgT:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <div class="title item__title item__title--link title--link-with-image"> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-with-image" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> <span ng-if=item.targetTop> <div class="title item__title item__title--link title--link-with-image"> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <div class="title item__title item__title--link title--link-with-image"> <a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class="fakeLink item__link--fake-link" tabindex=0 ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <img ng-if=item.asset.url ng-click=toggleDetailView() ng-src={{item.asset.url}}> </span> <div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},NEUm:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class=clear></div> </div> '},ORN5:function(e,t){e.exports='<span class="eventIcon icon-question"></span> <div class=field> <div class=label>Question type </div> <div class=input> <select ng-model=item.data._plugin.questiontype> <option value=mc-poll>Poll</option> <option value=mc-formative>Formative</option> </select> </div> </div> <div class=field> <div class=label>Question text </div> <div class=input autofocus sxs-input-i18n=item.data._plugin.questiontext x-inputtype="\'textarea\'"></div> </div> <div class=field> <div class=label>Question Title </div> <div class=input> <input type=text ng-model=item.title.en autofocus> </div> </div> <div class=field> <div class=label>Image (optional) </div> <div class=input np-upload-sxs-template> </div> </div> <div class=field ng-repeat="distractor in item.data._plugin.distractors track by $index"> <div class=label> {{$index | alpha}} &nbsp; <input type=checkbox ng-model=distractor.correct ng-if="item.data._plugin.questiontype == \'mc-formative\'"> </div> <div class=input sxs-input-i18n=distractor.text x-inputtype="\'textarea\'"></div> </div> <div class=field> <div class=input> <button ng-click=addDistractor($event)>Add distractor</button> </div> </div> <div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"> <div class=label>Feedback when correct </div> <div class=input sxs-input-i18n=item.data._plugin.correctfeedback x-inputtype="\'textarea\'"></div> </div> <div class=field ng-if="item.data._plugin.questiontype == \'mc-formative\'"> <div class=label>Feedback when incorrect </div> <div class=input sxs-input-i18n=item.data._plugin.incorrectfeedback x-inputtype="\'textarea\'"></div> </div> '},OklN:function(e,t){e.exports='<span ng-class="{\'sxs-item\': item.sxs}"> <a ng-if=item.editableByThisUser class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div ng-style="\n    item.sxs?{background:\'url(\'+item.avatar.url+\') no-repeat scroll right top / 40px 40px\',minHeight:\'40px\'}:{}\n    " ng-class="{isCosmetic: item.cosmetic}" class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" ng-if="item._type !== \'Chapter\' && !item.chapter_marker" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> <div ng-if="item.display_annotator && item.producerItemType !== \'annotation\' || item.isPq" class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> <div ng-if="item.producerItemType == \'annotation\' && item.display_title && !item.isHeader && !item.isPq" class=authorName ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <span ng-if="item._type != \'Annotation\' && item._type !== \'Chapter\'"> <a tabindex=0 ng-if=handleOutgoingLinkDisplay() class="fakeLink escapelink item__link--escape-link item__link--fake-link" ng-click=outgoingLink(item.url) ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText"></a> <a tabindex=0 role=button class="fakeLink item__link--fake-link" ng-if=!handleOutgoingLinkDisplay() x-ng-keypress=toggleDetailOnKeyPress($event) ng-click="item.showInlineDetail=!item.showInlineDetail" ng-bind-html="(item.display_title || \'(Untitled)\') | highlightSubstring: appState.searchText" aria-label="Toggle detail display of {{item.display_title}}"></a> </span> <span ng-if="item._type === \'Chapter\' || item.chapter_marker"> <h2 class=searchChapter ng-bind-html="(item.display_annotation || item.display_title) | highlightSubstring: appState.searchText"></h2> </span> </div> <div class="text item__text"> <div ng-class="{showAsHeader: item.showAsHeader}" ng-if=!item.chapter_marker ng-bind-html="item.display_annotation || item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <span ng-switch=item.producerItemType> <span ng-switch-when=file> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe ng-if="appState.viewMode == \'review\'" x-src={{item.asset.url}} x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-when=link> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe ng-if="!item.isVideoUrl && appState.viewMode == \'review\'" x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if="item.isVideoUrl && appState.viewMode == \'review\'" media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </span> <span ng-switch-when=video> <span ng-switch-when=file> <itt-video ng-if="item.isVideoUrl && appState.viewMode == \'review\'" media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> </span> </span> <span ng-switch-when=image> <div class=touchable style=position:relative> <img ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> </span> <span ng-switch-when=question> <div ng-if=item.asset.url class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question> </span> <span ng-switch-default> <span ng-if="item.data._pluginType == \'credlyBadge\'" np-usc-badges-template></span> </span> </span> </div> </div> </span> '},Qgv7:function(e,t){e.exports=' <div class=container ng-if=$ctrl.container ng-class="{\n     hoverIndicator: $ctrl.depth === 3,\n     isActive: $ctrl.container.isActive,\n     \'container__row--odd\': $ctrl.container.evenOdd === false,\n     \'container__row--even\': $ctrl.container.evenOdd === true\n     }" ng-style="{\'text-indent\': 1 * $ctrl.depth + \'em\' }" ng-if=$ctrl.container._id> <span ng-class="{\n\tisOpen: $ctrl.container.showChildren && $ctrl.depth !== 3,\n\tisClosed: !$ctrl.container.showChildren && $ctrl.depth !== 3\n\t}" ng-click=$ctrl.onToggleChildren(false)> </span> <np-modal modal-class=narrative__modal ng-if=$ctrl.showNarrativeModal> <np-narrative-editor customers=$ctrl.customers container-info="{\n      containerId: $ctrl.container._id,\n      customerId: $ctrl.container.customer_id,\n      name: $ctrl.container.name\n      }" hide-path-slug=::true on-done=$ctrl.toggleNarrativeModal($undo) on-update=$ctrl.postNewNarrative($data)> </np-narrative-editor> <itt-route-loading is-loading=$ctrl.resolvingNarrative></itt-route-loading> </np-modal> <div ng-class="{hoverIndicator: $ctrl.depth !== 3, isActive: $ctrl.container.isActive && depth !== 3}"> <div ng-if="$ctrl.depth === 3"> <np-tooltip tip-text={{$ctrl.container.status}} class=published__state ng-style="$ctrl.container.isActive && { \'top\':\'17.5px\' }" style=text-indent:0> <span ng-class="{\n          isPublished: $ctrl.container.status === \'Published\',\n          isUnPublished: $ctrl.container.status !== \'Published\'\n          }"></span> </np-tooltip> </div> <div class=delete-button__container ng-style="$ctrl.depth != 3 && {\'padding-right\': \'5.5px\'}" ng-if="$ctrl.isAdmin && $ctrl.depth > 0 && $ctrl.container.isActive && !$ctrl.container.editingContainer"> <np-tooltip tip-text="Delete {{$ctrl.containerType}}?"> <a ng-click=$ctrl.deleteContainer($ctrl.container._id) class=delete__button></a> </np-tooltip> </div> <span ng-if=!$ctrl.container.editingContainer ng-style="$ctrl.depth === 3 ? {\'text-indent\': \'4em\'} : \'\'"> <np-edit-pencil ng-if="$ctrl.depth !== 0" can-access=true on-edit="$ctrl.container.editingContainer = true"> <a ng-click=$ctrl.onToggleChildren(true)>{{$ctrl.container.name.en}}</a> </np-edit-pencil> <a ng-if="$ctrl.depth === 0" ng-click=$ctrl.onToggleChildren(true)>{{$ctrl.container.name.en}}</a> </span> <div ng-if="$ctrl.depth === 0"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <div> <np-tooltip tip-text="Add Project"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Link Status Report"> <a ng-if=$ctrl.isAdmin class="icon__button button__link-status" ng-click=$ctrl.getLinkStatusReport($ctrl.container.customer_id)></a> </np-tooltip> </div> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <div ng-if="$ctrl.depth === 1"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <div> <np-tooltip tip-text="Add Module"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <div ng-if="$ctrl.depth === 2"> <div ng-if=!$ctrl.container.addingContainer> <div ng-if=$ctrl.container.isActive class=button__row> <np-tooltip tip-text="Add Episode"> <a class="icon__button button__add-inverted" ng-click="$ctrl.container.addingContainer = true"></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> <div ng-if=$ctrl.container.addingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerTitle type=text autofocus>&nbsp; </label> <button ng-click="$ctrl.container.addingContainer = false">Cancel</button> <button ng-disabled=!$ctrl.container.newContainerTitle ng-click=$ctrl.addContainer($ctrl.container)>Add</button> </div> </div> <span ng-if=$ctrl.container.editingContainer> <label>Name:&nbsp; <input ng-model=$ctrl.container.newContainerName ng-init="$ctrl.container.newContainerName = $ctrl.container.name.en" type=text autofocus>&nbsp; </label> <button ng-click="$ctrl.container.editingContainer = false">Cancel</button> <button ng-disabled="!$ctrl.container.newContainerName || $ctrl.container.newContainerName == $ctrl.container.name.en" ng-click=$ctrl.renameContainer()>Save</button> </span> </div> <div ng-if="$ctrl.depth == 3 && $ctrl.container.isActive" class=container style=text-indent:4em> <div class=episode__button-row> <div class=episode__button> <np-tooltip tip-text="Go to editor"> <a class="icon__button button__editor" ng-if=$ctrl.isDemoServer href=#/editor/{{$ctrl.container.episodes[0]}}></a> </np-tooltip> <np-tooltip tip-text="Go to producer"> <a class="icon__button button__producer" href=#/producer/{{$ctrl.container.episodes[0]}}></a> </np-tooltip> <np-tooltip tip-text="Go to assets"> <a class="icon__button button__assets" ng-href=#/assets/{{$ctrl.container._id}}></a> </np-tooltip> <np-tooltip tip-text="Generate new narrative"> <a ng-if=$ctrl.canAccess class="icon__button button__generateNarrative" title="Generate new narrative" ng-click=$ctrl.toggleNarrativeModal()></a> </np-tooltip> </div> </div> </div> <np-container ng-if="$ctrl.depth < 3 && $ctrl.container.showChildren" ng-repeat="child in $ctrl.container.children" depth="$ctrl.depth + 1" container=$ctrl.containers[child._id] containers=$ctrl.modelSvc.containers on-container-remove="$ctrl.onContainerRemove({ $container })" on-container-click="$ctrl.onContainerClick({ $container })" on-container-add="$ctrl.onContainerAdd({ $container })"> </np-container> </div> '},Tc0T:function(e,t,i){e.exports=' <div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=col> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},Twex:function(e,t,i){e.exports='<div class="scene centered" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: (contentItems | isCurrent).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: contentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in (contentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},UGDl:function(e,t){e.exports="<div class=iframeContainer> <np-loading ng-if=$ctrl.isLoading></np-loading> <iframe ng-if=!ctrl.isLoading ng-src={{$ctrl.src}} ng-attr-scrolling={{$ctrl.iOSScroll}} ng-style=$ctrl.styles ng-attr-sandbox={{$ctrl.sandbox}}> </iframe> </div> "},"V+JG":function(e,t){e.exports='<div class="itemEdit authoringForm"> <form name=ittEpisodeForm class=doValidate> <div ng-if="appState.product == \'producer\'"> <div class=ittTabs itt-tabs> <div class=ittTab itt-tab title=Episode> <div class=field ng-hide="!userHasRole(\'admin\')"> <div class=label>Master asset type</div> <div class=input> <select size=1 ng-model=masterAssetType> <option value=Video>Native Video</option> <option value=WebUrl>Youtube / Kaltura / Wistia</option> </select> </div> </div> <div class=field ng-if="masterAssetType == \'Video\' && userHasRole(\'admin\')"> <div class=label>Video</div> <div class=input np-upload-masterasset-template></div> </div> <np-url-field label="Video URL" ng-if="masterAssetType === \'WebUrl\'" data=::masterAsset.mediaSrcArr[0] context=episode on-attach=attachMediaSrc($url)> </np-url-field> <div class=field ng-if=showmessage> <div class=input ng-bind-html=showmessage></div> </div> <itt-title-field data=episode model-opts="{ debounce: 500 }" do-validate=true itt-item-form=ittEpisodeForm></itt-title-field> <itt-description-field data=episode model-opts="{debounce: 50}"></itt-description-field> <div class=field ng-if="userHasRole(\'admin\')"> <div class=label>Poster image </div> <div class=input np-upload-poster-template> </div> </div> <div class=field> <div class=label>Status</div> <div class=input> <select size=1 ng-model=episode.status> <option value=Published>Published</option> <option value=Unpublished>Unpublished</option> </select> </div> </div> <itt-language-flags></itt-language-flags> <itt-language-select ng-if="languageCount > 1" data=episode lang-form=langForm> </itt-language-select> <div class=field ng-if="episode.languages.length > 1"> <div class=label>Current Language</div> <div class=input> <select size=1 ng-model=appState.lang ng-change=forcePreview() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"> </select> </div> </div> <div class=field ng-if="userHasRole(\'admin\') && episode.languages.length > 1"> <div class=label>Translations</div> <div class=input ng-if="doCheckForTranslations == null"> {{translationMessage(episode.languages)}} <button ng-click=beginBackgroundTranslations(episode._id)>Begin translation</button> </div> <div ng-if="doCheckForTranslations === true"> {{afterTranslationAttempt}} </div> </div> <itt-upload-transcripts ng-if="episode.master_asset_id && !episode._master_asset_was_changed  && (userHasRole(\'admin\') || userHasRole(\'customer admin\'))" episode-id={{episode._id}}> </itt-upload-transcripts> </div> <div class=ittTab itt-tab title=Style> <np-template-select data=episode on-episode-edit=updateEpisodeTemplate($data)></np-template-select> <itt-timestamp-select></itt-timestamp-select> <itt-highlight-select></itt-highlight-select> <itt-transition-select></itt-transition-select> </div> </div> </div> <div class=ittTabFoot> <a ng-click=cancelEdit()>Cancel</a> &nbsp; &nbsp; <button ng-click=saveEpisode() ng-disabled="blockDoubleClicks || ittEpisodeForm.$invalid">Save</button> </div> </form> </div> '},VCZZ:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text item__text--question-mc"> <div class="title item__title item__title--question-mc" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-if=item.asset.url class=touchable style=float:right;max-width:50%;padding-right:.5em> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <itt-mc-question show-chart="item.data._plugin.questiontype == \'mc-poll\'" choices=item.data._plugin.distractors on-choice=save data=item.data._plugin qid=item._id></itt-mc-question> <div class=clear></div> </div> </div> '},WeeJ:function(e,t,i){e.exports=i.p+"images/autoscroll.417c83d1f0b2eb6bceb7e048e66ede9d.svg"},Wu6Y:function(e,t){e.exports="<span class=floaterContainer> <input class=inputfield ng-model=model name=time ng-focus=showTools(true) ng-blur=showTools(false) ng-model-options=\"{ updateOn: 'blur' }\" style=max-width:150px ng-class=\"{invalid: (fieldname == 'end_time' && item.invalid_end_time)}\"> <div class=floater ng-if=tooltip> <ul style=list-style:none;white-space:nowrap> <li style=text-align:center;font-size:150%> <a ng-click=nudge(-5)>«</a> <a ng-click=nudge(-1)>‹</a> <span> &nbsp;&nbsp; </span> <a ng-click=nudge(1)>›</a> <a ng-click=nudge(5)>»</a> </li> <li ng-click=\"setTime(playbackService.getMetaProp('time'))\"> <a>Set to current time ({{::format(playbackService.getMetaProp('time'))}})</a> </li> <span ng-if=\"item._type != 'Scene' && scene().start_time > 0\"> <li ng-if=\"fieldname=='start_time'\" ng-click=setTime(scene().start_time)> <a>Beginning of layout ({{format(scene().start_time)}})</a> </li> <li ng-if=\"fieldname=='end_time'\" ng-click=setTime(scene().end_time)> <a>End of layout ({{format(scene().end_time)}})</a> </li> <li ng-if=\"fieldname=='end_time' && isTranscript()\" ng-click=TODO> <a>Auto (TODO)</a> </li> </span> </ul> </div> </span> "},aqvw:function(e,t){e.exports=' <div ng-if=showAssetPicker class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets container-id={{episodeContainerId}} mime-key={{item.producerItemType}}></sxs-container-assets> </div> <div class=controlsContainer> <button ng-click=endChooseAsset();>Cancel</button> </div> </div> <div> <ng-model ng-model=item.asset name=itemAsset itt-valid-asset item=item></ng-model> <div ng-if="item.asset && !showUploadButtons"> {{item.asset.display_name}} <button class=button ng-click=replaceAsset()>Replace</button> <button class=button ng-click="detachAsset(); selectService.onSelectChange(item, itemForm)">Remove</button> </div> <div ng-if="showUploadButtons || !item.asset"> <span ng-if=showUploadField> <itt-asset-uploader container-id={{episodeContainerId}} ng-if=canAccess callback=assetUploaded(data) mime-types={{mimes}}> </itt-asset-uploader> </span> <span ng-if=!showUploadField> <button class=button ng-click=chooseAsset()>Browse uploaded</button> <button class=button ng-click=toggleUpload()>Upload new</button> </span> </div> </div> '},bINW:function(e,t,i){e.exports=' <div class="scene cornerV" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{singleitem: altContentItems.length==1, isNarrow: isNarrow, isEmpty: altContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in altItems = (altContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=col> <div class="pane altPane stretchToViewport"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (mainContentItems | isCurrent).length == 1\n\t\t\t\t\t: (mainContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: mainContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: mainContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: mainContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (mainContentItems | isCurrent) : mainContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},c1a4:function(e,t){e.exports='<span class="eventIcon icon-video"></span> <np-url-field data=item label="Video url" context=editor-video itt-item-form=ittItemForm></np-url-field> <itt-title-field do-validate=false data=item itt-item-form=ittItemForm></itt-title-field> <itt-description-field data=item></itt-description-field> '},cKYu:function(e,t){e.exports='<div ng-if=$ctrl.showParent> <sxs-container-assets container-id={{$ctrl.container.parent_id}}></sxs-container-assets> </div> <div class=containerAssets> <div ng-if="$ctrl.appState.product != \'sxs\' && $ctrl.container.parent_id && !$ctrl.showParent"> <a class=goUp ng-click=$ctrl.up()>Parent container</a> </div> <div class=title>{{$ctrl.container.display_name}} - Asset Library </div> <div class=controls> <a ng-click=$ctrl.toggleImages()> <span ng-if=$ctrl.onlyImages>Images</span> <span ng-if=!$ctrl.onlyImages>All</span> </a> &nbsp; <a ng-click=$ctrl.toggleGrid()> <span ng-if=$ctrl.gridView>▦</span> <span ng-if=!$ctrl.gridView>☰</span> </a> </div> <div class=scrollPane ng-if=!$ctrl.hideItems> <div ng-if=$ctrl.gridView> <div class=grid ng-repeat="asset in $ctrl.isCustAdmin ? ($ctrl.assets | vidsFromCustAdmins) : $ctrl.assets" ng-if="asset.container_id == $ctrl.containerId && !($ctrl.onlyImages && asset._type != \'Asset::Image\')" ng-click=$ctrl.assetClick(asset._id)> <div ng-if="asset._type == \'Asset::Image\'"> <img class=thumbnail ng-src={{asset.url}}> </div> <div ng-if="asset._type != \'Asset::Image\'"> <div class=thumbnail>{{asset._type}}</div> </div> {{asset.display_name}} <span ng-if=asset.tags[0]> - {{asset.tags[0] | tagName}}</span> </div> </div> <table ng-if=!$ctrl.gridView> <tr ng-repeat="asset in $ctrl.isCustAdmin ? ($ctrl.assets | vidsFromCustAdmins) : $ctrl.assets" ng-if="asset.container_id == $ctrl.containerId && !($ctrl.onlyImages && asset._type != \'Asset::Image\')" ng-click=$ctrl.assetClick(asset._id)> <td> <div ng-if="asset._type == \'Asset::Image\'"> <img class=thumbnail ng-src={{asset.url}}> </div> </td> <td>{{asset.size |asBytes}}</td> <td>{{asset.content_type}}</td> <td> {{asset.display_name}} </td> <td ng-if=asset.tags[0]>{{asset.tags[0] | tagName}}</td> <td ng-if=$ctrl.isAdmin class=delete-button__container> <np-tooltip tip-text="Delete Asset"> <a ng-click="$ctrl.requestDeleteAsset(asset, $event)" class=delete__button></a> </np-tooltip> </td> </tr> </table> </div> <br> <np-modal class=modal__center-center ng-if="$ctrl.assetToDelete != null"> <h4>Delete</h4> {{$ctrl.assetToDelete.display_name}}? <div> <button ng-click=$ctrl.deleteAsset($ctrl.assetToDelete._id)>Delete</button> <button ng-click="$ctrl.assetToDelete = null">cancel</button> </div> </np-modal> <itt-asset-uploader container-id={{$ctrl.container._id}} mime-types={{$ctrl.mimes}} multiple=true ng-if="$ctrl.canAccess && $ctrl.context !== \'narrative\'"> </itt-asset-uploader> </div> '},d3rl:function(e,t){e.exports='<div class="itemTemplate uscBadges"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> </div> <span np-usc-badges-inner-template></span> </div> '},eHBc:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate transcript"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> </div> <div class=icon style=float:left;margin-right:.5em> <img ng-if=item.asset.url ng-src={{item.asset.url}}> <div class=clear></div> </div> <div class="authorName item__title" ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--transcript" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> <div class=clear></div> </div> '},es1d:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="captionContainer touchable"> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> <div class="caption slidingcaption"> <div class="title item__title item__title--image item__title--image-caption-sliding" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="text item__text item__text--image item__text--image-caption-sliding" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=clear></div> </div> '},foaR:function(e,t){e.exports=' <div> <div ng-if="(item.asset) && !showUploadButtons"> {{item.asset.display_name}} <button class=button ng-click=replaceAsset(item.asset._id)> Replace this asset </button> </div> <div ng-if="showUploadButtons || !(item.asset)"> <itt-asset-uploader ng-if="item.producerItemType === \'image\'" callback=assetUploaded(data)></itt-asset-uploader> <itt-asset-uploader ng-if="item.producerItemType === \'file\'" callback=assetUploaded(data) mime-types="application/*, text/*, audio/*, model/*" instructions="We currently accept all non-image or non-video files." error-text="Please make sure you are not trying to upload an image or video file."> </itt-asset-uploader> </div> </div> '},g3Y4:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <a ng-if=handleOutgoingLinkDisplay() class=escapelink ng-click=outgoingLink(item.url) ng-bind-html="item.title.en ||\'(Untitled)\'"></a> <h3 ng-if=!handleOutgoingLinkDisplay() ng-bind-html="item.title.en ||\'(Untitled)\'"></h3> <div class=text ng-bind-html=item.description.en></div> <div class=itemDetail ng-if="item.url && !handleOutgoingLinkDisplay() && item.url != \'https://\'"> <div class=modalmenu> <a ng-click=outgoingLink(item.url) class=escapelink>(new window)</a> </div> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> </div> '},hJPG:function(e,t){e.exports='<div class="question item__text"> <p ng-bind-html="plugin.questiontext | i18n"></p> <div ng-if=!showChart> <div ng-repeat="distractor in choices"> <div ng-if="(distractor.text | i18n) != \'\'"> <label ng-class="{\n\t\t\t\t\tcorrect: plugin.hasBeenAnswered && distractor.correct,\n\t\t\t\t\tincorrect: plugin.hasBeenAnswered && !distractor.correct\n\t\t\t\t}"> <input ng-change=scoreQuiz($index) type=radio name=fnord ng-model=index ng-disabled=plugin.hasBeenAnswered value={{$index}} ng-checked=distractor.selected> <span ng-bind-html="distractor.text | i18n"></span> </label> </div> </div> <div ng-if=plugin.hasBeenAnswered ng-bind-html="feedback() | i18n"></div> </div> <div ng-if=showChart> <div ng-if=!plugin.hasBeenAnswered ng-repeat="distractor in plugin.distractors"> <div ng-if="(distractor.text | i18n) != \'\'"> <label> <input ng-change=scorePoll($index) type=radio name=fnord ng-disabled=plugin.hasBeenAnswered ng-model=$parent.plugin.selectedDistractor value={{$index}}> <span ng-bind-html="distractor.text | i18n"></span> </label> </div> </div> <br> <div ng-if=plugin.hasBeenAnswered> <p ng-if=plugin.selectedDistractor>Here\'s how others answered this question. (Your choice was: <b ng-repeat="distractor in plugin.distractors | filter:{ index: plugin.selectedDistractor }" ng-bind-html="distractor.text | i18n"></b>) </p> <itt-flotr2-chart type={{chartType}} title="" data={{chartData}} options={{chartOptions}}></itt-flotr2-chart> </div> </div> </div> '},"hY+2":function(e,t){e.exports='<span ng-if="$ctrl.errorSvc.errors.length || $ctrl.errorSvc.notifications.length" class=errors> <div class=error ng-repeat="error in $ctrl.errorSvc.errors" ng-click=$ctrl.dismiss(error)> <h3><i class="fa fa-exclamation-triangle error-red"></i>Error: <span ng-bind-html="error.cause || error.exception.data.error || error.exception.data.base[0] || error.exception.data || \'(unknown reason)\'"></span></h3> <p ng-if=error.exception.config.url> <i>(While trying to load {{error.exception.config.url}})</i> </p> <p ng-if="error.exception.status == 401"> Please <span ng-if=$ctrl.user.login_url> <a ng-if=$ctrl.user.login_via_top_window_only ng-click=$ctrl.logout(); ng-href={{$ctrl.user.login_url}} target=_top>click here</a> <a ng-if=!$ctrl.user.login_via_top_window_only ng-click=$ctrl.logout(); ng-href={{$ctrl.user.login_url}}>click here</a> to log back in. </span> <span ng-if=!$ctrl.user.login_url> <a ng-click=logout();>reset your session</a> and start over. </span> </p> </div> <div class=notification ng-repeat="notification in $ctrl.errorSvc.notifications"> <a style=float:right ng-click=$ctrl.dismiss(notification)>[x]</a> <p><i class="fa fa-info-circle info-blue"></i> <strong> Note: </strong> {{notification.text}}</p> </div> </span> '},ibgO:function(e,t){e.exports=' <span class="eventIcon icon-comment"></span> <div class=field> <div class=label>Comment </div> <div class=input sxs-input-i18n=item.annotation autofocus x-inputtype="\'textarea\'"></div> </div> '},j8FC:function(e,t){e.exports='<div class=timeline ng-show=!isSuppressed ng-cloak> <button tabindex=0 ng-focus=showControls() class=button ng-class=setBtnClass() ng-click=timelineBtnClick()> <span class=control-text>{{controlText}}</span> </button> <div class=progressbarBox> <div class=pbarTop> <span ng-if="appState.product == \'producer\'"> <a class="button button-zoomout" ng-if="zoomLevel != 1" ng-click=zoomOut()> <span class=control-text>Zoom out</span> </a> <small ng-if="zoomLevel != 1">Zoom: {{zoomLevel*100}}%</small> <a class="button button-zoomin" ng-click=zoomIn()> <span class=control-text>Zoom in</span> </a> </span> </div> <div class=pbarMain> <button ng-focus=showControls() ng-class="{invisible: playbackService.getMetaProp(\'time\') == 0}" class="button button-prev" ng-click=prevScene()> <span class=control-text>Previous</span> </button> <button ng-focus=showControls() tabindex=0 ng-class="{invisible: playbackService.getMetaProp(\'time\')>= playbackService.getMetaProp(\'duration\')- 0.1}" class="button button-next" ng-click=nextScene()> <span class=control-text>Next</span> </button> <div class=progressbar> <div class=mask> <div class=progressbarContainer style=width:{};> <div class=buffered ng-style="{width: playbackService.getMetaProp(\'bufferedPercent\')+\'%\'}"></div> <div class=played ng-style="{width: markerPercent(playbackService.getMetaProp(\'time\'))+\'%\'}"></div> </div> </div> <div class=progressbarContainer style=width:{};> <div class=handle ng-show=isSeeking ng-style="{left: markerPercent(willSeekTo)+\'%\'}"> <div class=tip ng-show=seekHandleVisible>{{willSeekTo | asTime}}</div> </div> <div class=tooltip ng-if=eventGroup.showTooltip ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}"> <span class=content ng-bind-html=eventGroup.toolTipText></span> </div> <div class="handle sxsHandle playhead" ng-show=appState.editEvent ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\'}"> <div class=tip ng-click="">{{appState.editEvent.start_time | asTime}}</div> </div> </div> <div class="playhead mask"> <div class=progressbarContainer ng-style="{width: zoomLevel+\'00%\'}"> <div class=marker ng-mouseover=showTooltip(eventGroup) ng-mouseout=hideTooltip(eventGroup) ng-repeat="eventGroup in timeline.displayMarkedEvents" ng-style="{left: markerPercent(eventGroup.start_time)+\'%\'}" ng-if="eventGroup.stop || eventGroup.toolTipText || appState.product == \'producer\' && eventGroup.toolTipText != null" ng-class="{stop: eventGroup.stop && !eventGroup.multiStop, mini: eventGroup.layoutChange, multi: eventGroup.multiStop}"> </div> <div ng-if=appState.editEvent class=editingItem ng-style="{left: markerPercent(appState.editEvent.start_time)+\'%\', right: markerPercent(playbackService.getMetaProp(\'duration\') - appState.editEvent.end_time)+\'%\'}"></div> </div> </div> </div> </div> <div class=pbarBottom> <span class=timedisplay> {{playbackService.getMetaProp(\'time\')| asTime}} / {{playbackService.getMetaProp(\'duration\') | asTime}} <span class=speedcontrol> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(-0.25) aria-label="Slow down video"> <div ng-class="{arrowLeft: playbackService.getMetaProp(\'timeMultiplier\') > 0.5}"></div> </button> <span class=speeddisplay ng-click=resetSpeed()>{{playbackService.getMetaProp(\'timeMultiplier\')}}x</span> <button ng-focus=showControls() class=button-speedcontrol ng-click=changeSpeed(0.25) aria-label="Speed up video"> <div ng-class="{arrowRight: playbackService.getMetaProp(\'timeMultiplier\') < 2}"></div> </button> </span> </span> <span style=display:inline-block;height:1em;position:relative ng-if="episode.languages.length > 1"> <select size=1 ng-model=appState.lang class=languageSelector ng-change=setNewLanguage() ng-options="language.code as (\'[\'+language.code.toUpperCase()+\']\') for language in episode.languages"> </select> </span> <button ng-focus=showControls() tabindex=0 ng-if="appState.viewMode == \'watch\'" class="button button-captions" ng-click="appState.hideCaptions=!appState.hideCaptions" ng-class="{active: !appState.hideCaptions}"> <span class=control-text>Captions</span> </button> <a ng-if="appState.viewMode==\'watch\'" class="button button-fullscreen active" ng-click="viewMode(\'discover\')"> <span class=control-text>Exit fullscreen</span> </a> <a ng-if="appState.viewMode!=\'watch\'" class="button button-fullscreen" ng-click="viewMode(\'watch\')"> <span class=control-text>Fullscreen video</span> </a> <span ng-if=!appState.isTouchDevice> <button ng-focus=showControls() tabindex=0 class="button button-mute {{audioIcon()}}" ng-click=toggleMute()> <span class=control-text>Mute</span> </button> <itt-volume-slider></itt-volume-slider> </span> </div> </div> </div> '},jiyv:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text ng-bind-html=item.annotation.en></div> <div class=clear></div> </div> '},"k/N7":function(e,t,i){e.exports='<div class="scene centered-pro" ng-class="scene.styleCss + \' \'+ scene.state"> <div itt-item=item class="item animate banner-pull-quote" ng-class="item.styleCss + \' \' + item.state" ng-repeat="item in (contentItems | isCurrent | filter:{component_name: headerOneComponentTemplate} )"> </div> <div class=col> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems| isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: (contentItems | isCurrent).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: contentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in (contentItems | isCurrent | filter:centeredProTransmedia  )" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> <div class=clear></div> </div> </div> </div> </div> '},k5l5:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || appState.noAvatar }}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div class=text> <div class=title ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <a class=escapelink ng-click=outgoingLink(item.url)>New window</a> <div ng-if=!handleOutgoingLinkDisplay()> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <div class=sxs-video> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> </div> <div class=clear></div> </div> '},k90U:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <div class="title item__title item__title--link title--link-modal"> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-modal" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> <span ng-if=item.targetTop> <div class="title item__title item__title--link title--link-modal"> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-if=item.asset.url ng-src={{item.asset.url}}> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <div class="title item__title item__title--link title--link-modal"> <a role=button x-ng-keypress=toggleDetailOnKeyPress($event) class="fakeLink item__link--fake-link" tabindex=0 ng-click=forceModal(false) ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <img ng-if=item.asset.url ng-click=forceModal(false) ng-src={{item.asset.url}}> </span> <div class="item__text item__text--link text--link-modal" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if="item.showInlineDetail && appState.viewMode === \'review\'"> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-modal">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},kCnN:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class="itemTemplate headerItem"> <div class=category></div> <div class="item__text item__text--h1"> <h1 ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></h1> </div> </div> '},kLTS:function(e,t){e.exports='<span class="eventIcon icon-file"></span> <div class=field> <div class=label>Title </div> <div class=input> <input type=text ng-model=item.title.en autofocus> </div> </div> <div class=field> <div class=label>File </div> <div class=input np-upload-sxs-template> </div> </div> <div class=field> <div class=label>Description </div> <div class=input sxs-input-i18n=item.description x-inputtype="\'textarea\'"></div> </div> '},kr2K:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <span ng-if=handleOutgoingLinkDisplay()> <span ng-if=!item.targetTop> <a tabindex=0 ng-if=item.asset.url x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-src={{item.asset.url}} class=img--link-with-image-no-title> </a> </span> <span ng-if=item.targetTop> <a tabindex=0 target=_top x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)> <img ng-src={{item.asset.url}} class=img--link-with-image-no-title> </a> </span> </span> <span ng-if=!handleOutgoingLinkDisplay()> <img ng-click=toggleDetailView() ng-src={{item.asset.url}} class=img--link-with-image-no-title> </span> <div class="item__text item__text--link text--link-with-image" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url) class="escapelink item__link--escape-link escape-link--link-with-image">(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> </div> <div class=clear></div> '},l1Qu:function(e,t){},lvPu:function(e,t,i){e.exports='<div class="endingscreen stretchToViewport"> <div class="pane introtext"> <p>Thanks for watching:&nbsp; <span ng-bind-html=episode.display_title></span> </p> <br> </div> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+"> </div> </div> "},lw8s:function(e,t){e.exports='<div ng-if="(episode.items | isCurrent | itemLayout:\'windowFg\').length > 0" class="overlay windowFg fgLayer animate transitionFade"> <div class="content w-modal"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate timestampNone" ng-repeat="item in episode.items | isCurrent | itemLayout:\'windowFg\'"> </div> <a ng-if=!appState.editEvent class=button-continue ng-click=continue()> <span>Continue</span> </a> </div> </div> '},mOi1:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="title item__title item__title--link title--link-embed" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class="item__text--link text--link-embed" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <a tabindex=0 class="escapelink item__link--escape-link escape-link--link-embed" x-ng-keypress=outgoingLinkOnKeyPress(item.url,$event) ng-click=outgoingLink(item.url)>(new window)</a> <itt-iframe ng-if=!item.isVideoUrl x-src={{item.url}} item=item></itt-iframe> <itt-video ng-if=item.isVideoUrl media-src-arr=[item.url] player-id=item._id main-player=false> </itt-video> <div class=clear></div> </div> '},oN2c:function(e,t){e.exports='<div class=discoverMode ng-if="appState.viewMode == \'discover\'"> <div class="fill windowBg bgLayer"> <div ng-class="item.styleCss + \' \' + item.state" itt-item=item class="item animate" ng-repeat="item in scene.items | isCurrent | itemLayout:\'windowBg\'"> </div> </div> <div itt-scene=scene episode=episode class=scene__container></div> </div> '},olHH:function(e,t){e.exports='<div itt-login style=margin:2em> <a style="animation:delayedFadeIn 5s" href=/#/ >Home</a> </div> '},pkcl:function(e,t){e.exports=' <div ng-if=showAssetPicker class=floatAssetPicker> <div class=scrollContainer> <sxs-container-assets container-id={{episodeContainerId}}></sxs-container-assets> </div> <div class=controlsContainer> <button ng-click=endChooseAsset();>Cancel</button> </div> </div> <div> <div ng-if="(masterAsset.original_filename) && !showUploadButtonsMaster"> {{masterAsset.display_name}} <button class=button ng-click="replaceAsset(\'Master\')"> Replace</button> <button class=button ng-click=detachMasterAsset()>Remove</button> </div> <div ng-if="showUploadButtonsMaster || !(masterAsset.original_filename)"> <span ng-if=showUploadFieldMaster> <itt-asset-uploader container-id={{episodeContainerId}} callback=assetUploaded(data)></itt-asset-uploader> </span> <span ng-if=!showUploadFieldMaster> <button class=button ng-click="chooseAsset(\'Master\')">Browse uploaded assets</button> <button class=button ng-click="toggleUpload(\'Master\')">Upload new asset</button> </span> </div> </div> '},qBCb:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text"> <div class="title item__title item__title--image-inline-with-text" ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></div> <div class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <div class="item__text item__text--image text--inline-with-text" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> <div class=clear></div> </div> </div> '},qMue:function(e,t){e.exports='<div class=narrative> <div> <np-edit-pencil can-access=$ctrl.canAccess on-edit=$ctrl.toggleEditNarrativeModal()> <h2 ng-bind-html=$ctrl.narrative.name.en></h2> </np-edit-pencil> <p ng-bind-html=$ctrl.narrative.description.en></p> <p>Total Duration: {{$ctrl.totalNarrativeDuration | asTime}}</p> </div> <div class=episode__button-row> <div ng-if=$ctrl.canAccess> <np-tooltip tip-text="Add Timeline" ng-class="{overlay: $ctrl.timelineUnderEdit || $ctrl.tmpTimeline}"> <a class="icon__button button__add-inverted" ng-click="$ctrl.addTmpTimeline(null, $ctrl.narrative.timelines)"></a> </np-tooltip> <np-tooltip tip-text="Export links to spreadsheet"> <a class="icon__button button__export-spreadsheet" ng-click=$ctrl.exportToSpreadsheet($ctrl.narrative._id)> </a> </np-tooltip> <np-guest-accessible-url narrative=$ctrl.narrative sub-domain={{$ctrl.narrative.narrative_subdomain}} clipboard-mode="Click to copy URL"> </np-guest-accessible-url> </div> </div> <np-modal ng-if=$ctrl.showEpisodeList> <np-episode-list depth=0 context=narrative class="admin episodePicker" on-episode-select=$ctrl.onEpisodeSelect(node) on-cancel="$ctrl.toggleEpisodeList(); $ctrl.doneEditingTimeline()"> </np-episode-list> </np-modal> <np-modal wrapper-class=responsive-modal__wrapper modal-class=narrative__modal ng-if="$ctrl.editingNarrative || $ctrl.timelineUnderEdit != null"> <div ng-if=$ctrl.editingNarrative> <np-narrative-editor narrative=$ctrl.narrative customers=$ctrl.customers on-done=$ctrl.toggleEditNarrativeModal($undo) on-update=$ctrl.updateNarrative($narrative)> </np-narrative-editor> </div> <div ng-if="$ctrl.timelineUnderEdit != null"> <np-timeline-editor class=tl__editor timeline=$ctrl.timelineUnderEdit narrative=$ctrl.narrative container-id={{$ctrl.customers[0].root_container_id}} on-done=$ctrl.doneEditingTimeline() on-update="$ctrl.editorAction($timeline, $ctrl.timelineUnderEdit)" on-delete=$ctrl.deleteTimeline($timeline)> </np-timeline-editor> </div> </np-modal> <div ui-tree=$ctrl.treeOpts ng-if="$ctrl.narrative.timelines.length !== 0"> <div ui-tree-nodes ng-model=$ctrl.narrative.timelines> <div class="storyTimeline hoverIndicator" ng-class-even="\'container__row--even\'" ng-class-odd="\'container__row--odd\'" ng-mouseenter="rowHover = true" ng-mouseleave="rowHover = false" ui-tree-node ng-repeat="timeline in $ctrl.narrative.timelines |\n               filter: ($ctrl.canAccess === false || undefined) && {hidden: false}"> <div ng-class="{\'timeline--hidden\': timeline.hidden}"> <span ng-show="$ctrl.canAccess && rowHover" class=tlDrag__handle ui-tree-handle> <i class="fa fa-arrows"></i> </span> <div class=tl__wrapper> <np-edit-pencil can-access=$ctrl.canAccess force="rowHover && $ctrl.canAccess" on-edit=$ctrl.toggleEditingTimeline(timeline)> <h3> <i ng-if=timeline.hidden class="fa fa-eye-slash"></i> <a href=/#/story/{{$ctrl.narrative._id}}/{{timeline._id}}>{{timeline.name.en}}</a> </h3> </np-edit-pencil> <p>{{timeline.episode_segments[0].end_time | asTime}}</p> <p>{{timeline.description.en}}</p> <div class=tl__addButton> <div ng-if="rowHover && $ctrl.canAccess" class=episode__button-row> <div> <np-tooltip tip-text="Insert Timeline"> <a class="icon__button button__add-inverted" ng-click="$ctrl.addTmpTimeline(timeline, $ctrl.narrative.timelines)"></a> </np-tooltip> <np-guest-accessible-url narrative=$ctrl.narrative timeline=timeline clipboard-mode="Copy to Clipboard"> </np-guest-accessible-url> </div> </div> </div> </div> </div> </div> </div> </div> </div> <a ng-if=$ctrl.narrative.support_url target=_blank ng-href={{$ctrl.narrative.support_url}}>Support</a> '},rFfA:function(e,t,i){e.exports=i.p+"images/Narrasys_Banner.02a409f34b80c72134169a171c9c8852.svg"},rXKF:function(e,t,i){e.exports=i.p+"images/aspectratiopreserver-16x9.81dd48a755a6e8f01bfc872a4d2ab76a.gif"},rw5t:function(e,t){e.exports='<div class="itemTemplate sxs-item"> <a class=edit-event ng-click=editItem() ng-if=item.editableByThisUser>[Edit]</a> <div class=avatar> <img ng-src="{{item.avatar.url || \'/images/no-avatar.gif\'}}"> </div> <div class=itemHead> <div class=authorName ng-bind-html="item.display_annotator | highlightSubstring: appState.searchText"></div> </div> <div> <b ng-bind-html=item.title.en></b> <p style=text-align:center> </p><div ng-if=item.asset.url class=touchable> <img x-ng-click=forceModal() ng-src={{item.asset.url}}> <div class=touchableIndicator></div> </div> <p></p> </div> <div class=text ng-bind-html=item.description.en></div> <div class=clear></div> </div> '},sLHl:function(e,t){e.exports='<span class="eventIcon icon-link"></span> <itt-title-field do-validate=false data=item itt-item-form=ittItemForm></itt-title-field> <np-url-field data=item context=editor itt-item-form=ittItemForm></np-url-field> <itt-description-field data=item></itt-description-field> '},sbOf:function(e,t,i){e.exports=' <div class="scene cornerH" ng-class="scene.styleCss + \' \'+ scene.state"> <div class=row> <div itt-magnet class=videoMagnet> <img src='+i("rXKF")+'> </div> <div class="pane mainPane matchVideoHeight"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in mainBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer" ng-class="{singleitem: mainContentItems.length==1, isNarrow: isNarrow, isEmpty: mainContentItems.length == 0}" itt-width-watch> <div class="item animate" ng-repeat="item in mainItems = (mainContentItems | isCurrent)" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in mainFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> <div class=row> <div class="pane altPane"> <div class="fill bgLayer"> <div class="item animate" ng-repeat="item in altBgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> <div class="content contentLayer stretchToViewport" ng-class="{\n\t\t\t\tsingleitem: showCurrent\n\t\t\t\t\t? (altContentItems | isCurrent).length == 1\n\t\t\t\t\t: (altContentItems).length == 1,\n\t\t\t\tallowHighlights: !showCurrent,\n\t\t\t\thasLeftSidebar: altContentHasLeftSidebar,\n\t\t\t\thasRightSidebar: altContentHasRightSidebar,\n\t\t\t\tisNarrow: isNarrow,\n\t\t\t\tisEmpty: altContentItems.length == 0\n\t\t\t}" itt-width-watch> <div class="item animate" ng-repeat="item in showCurrent ? (altContentItems | isCurrent) : altContentItems" ng-class="item.styleCss + \' \' + item.state" itt-item=item> </div> <div class=clear></div> </div> <div class="fill fgLayer overlay"> <div class="item animate" ng-repeat="item in altFgItems | isCurrent" ng-class="item.styleCss + \' \' + item.state" itt-item=item></div> </div> </div> </div> </div> '},"teY+":function(e,t,i){e.exports=i.p+"images/Narrasys_Logo.df561103178efc6ff2c87d7f47387f90.png"},wI96:function(e,t){e.exports='<div class="rootLogin standaloneAncillaryPage" itt-login> <np-nav on-logout=logout()></np-nav> <div class=inner> <div ng-if=appState.user._id> <div itt-user></div> </div> <div ng-if=!appState.user._id> <form ng-submit=adminLogin()> <h1>Sign in to Narrative Producer</h1> <label> <span>Username</span> <input type=email name=auth_key ng-model=loginForm.auth_key> </label> <label> <span>Password</span> <input type=password name=password ng-model=loginForm.password> </label> <input class="submit button" type=submit value="Sign in"> <span class=error ng-if=badlogin>Sorry, try again?</span> </form> </div> <br style=clear:both> </div> <small ng-if=!appState.user._id><a href={{apiDataBaseUrl}}/oauth2>OAuth</a></small> </div> '},"wJ/0":function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div class=itemTemplate> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="category item__title"> <span ng-if=item.required>(Required viewing)</span> </div> </div> <div class="text item__text item__text--file"> <div class="title item__title item__title--file"> <a role=button tabindex=0 x-ng-keypress=toggleDetailOnKeyPress($event) ng-click=toggleDetailView() ng-bind-html="item.display_title || \'(Untitled)\' | highlightSubstring: appState.searchText"></a> </div> <div class="item__text item__text--file" ng-bind-html="item.display_description | highlightSubstring: appState.searchText"></div> </div> <div class=itemDetail ng-if=item.showInlineDetail> <span ng-switch="item.asset.content_type.indexOf(\'image/\')"> <span ng-switch-when=-1> <a tabindex=0 x-ng-keypress=outgoingLinkOnKeyPress(item.asset.url,$event) ng-click=outgoingLink(item.asset.url) class="escapelink item__link--escape-link">(new window)</a> <itt-iframe x-src={{item.asset.url}} item=item x-contenttype={{item.asset.content_type}}></itt-iframe> </span> <span ng-switch-default> <img ng-src={{item.asset.url}}> </span> </span> </div> <div class=clear></div> </div> '},wZyx:function(e,t){e.exports='<span class=itt-socialshare> <span ng-if=!$ctrl.expanded> <a class="button button-facebook" ng-click="$ctrl.onShare(\'facebook\')"></a> <a class="button button-linkedin" ng-click="$ctrl.onShare(\'linkedin\')"></a> <a class="button button-share" ng-click=$ctrl.toggleExpanded()></a> </span> <div class=socialshare__row ng-if=$ctrl.expanded> <button class=socialshare__exit ng-click=$ctrl.toggleExpanded()> </button> <div class=socialshare__row--expanded> <div> <p>Share episode</p> <a ng-repeat="provider in $ctrl.providers" class=button ng-click=$ctrl.onShare(provider) ng-class="\'button-\' + provider"> </a> </div> <div> <p>Copy link</p> <div class=socialshare__clipboard> <np-clipboard light=true custom-notice=true on-copy=$ctrl.ontextCopied($event) source-text={{$ctrl.stubUrl}}> </np-clipboard> <div ng-if=$ctrl.textCopied> <span class="button button-text-copied"></span> <span class=text--notice>(Link copied to clipboard)</span> </div> </div> </div> <np-modal wrapper-class=email-modal__wrapper modal-class=email-modal__content ng-if=$ctrl.emailshareExpanded> <form name=emailshareForm> <div class=socialshare__email-row> <div class=socialshare__email-from> <span> <label for=ssFromName>From name</label> <input type=text id=ssFromName ng-model=email.from_name required/> </span> <span> <label for=ssFromEmail>From email</label> <input type=email id=ssFromEmail ng-model=email.from_email_address required/> </span> </div> <div class=socialshare__email-to> <span> <label for=ssToName>To name</label> <input id=ssToName type=text ng-model=email.to_name required/> </span> <span> <label for=ssToEmail>To email</label> <input type=email id=ssToEmail ng-model=email.to_email_address required/> </span> </div> <div class=socialshare__email-subject> <span> <label for=ssSubject>Subject</label> <input type=text id=ssSubject ng-init="email.subject = $ctrl.shareTitle" ng-model=email.subject required/> </span> </div> <div class=socialshare__email-message> <label for=ssMessage>Message</label> <textarea id=ssMessage ng-model=email.message required></textarea> </div> <div class=socialshare__email-sender-copy> <span> <input type=checkbox id=ssSenderCopy ng-init="email.sender_copy = true" ng-model=email.sender_copy /> <label for=ssSenderCopy>Send me a copy</label> </span> </div> <div class=socialshare__email-buttons> <button ng-click="$ctrl.handleEmailShare(email, emailshareForm)" type=submit>Send email</button> <button ng-click=$ctrl.toggleEmailshare()>Close</button> </div> </div> </form> </np-modal> </div> </div> </span> '},wmst:function(e,t){e.exports='<div class=assetUploader> <div ng-if=$ctrl.uploads.length> <div class=uploadList ng-repeat="upload in $ctrl.uploads"> <span class=uploadName> {{$ctrl.uploadStatus[$index].name}}: </span> <span class=uploadProgress> <span ng-if=$ctrl.uploadStatus[$index].done>Upload complete</span> <div ng-if=$ctrl.uploadStatus[$index].error>Error</div> <span ng-if="!$ctrl.uploadStatus[$index].done && !$ctrl.uploadStatus[$index].error"> <progress ng-attr-max={{$ctrl.uploadStatus[$index].bytesTotal}} ng-attr-value={{$ctrl.uploadStatus[$index].bytesSent}}> </progress> <span ng-switch=$ctrl.uploadStatus[$index].percent> <span ng-switch-when=100>...</span> <span ng-switch-default>{{$ctrl.uploadStatus[$index].percent}}%</span> </span> </span> </span> <div ng-if=$ctrl.uploadStatus[$index].error>{{$ctrl.uploadStatus[$index].error}}</div> </div> <span ng-if="$ctrl.uploadsinprogress > 0">{{$ctrl.uploadsinprogress}} files remaining <button ng-if=!$ctrl.paused ng-click=$ctrl.pauseUpload()>Pause</button> <button ng-if=$ctrl.paused ng-click=$ctrl.resumeUpload()>Resume</button> <button ng-click=$ctrl.cancelUpload()>Cancel</button> </span> </div> <div ng-if=$ctrl.errormessage class=error-red ng-bind-html=$ctrl.errormessage></div> <div class=uploadDropTarget> <a style=float:right ng-click="$ctrl.showInstructions = !$ctrl.showInstructions">(?)</a> Drag and drop <span ng-if=$ctrl.multiple>files</span> <span ng-if=!$ctrl.multiple>a file</span> here <br> <small> or choose <span ng-if=$ctrl.multiple>files</span> <span ng-if=!$ctrl.multiple>a file</span> to upload: <input class=uploadFileInput type=file multiple=true itt-files-handler on-selected=$ctrl.handleUploads(files)> </small> <div ng-if=$ctrl.showInstructions style=text-align:left> <small>{{$ctrl.manPage}}</small> </div> </div> </div> '},zMT9:function(e,t,i){"use strict";function authSvc_authSvc(e,t,i,a,r,s,o,l){function isTrueGuest(){var e=!0;return angular.forEach(s.user.roles,function(t){t.role!==d.GUEST&&(e=!1)}),e}var c={},d={ADMINISTRATOR:"admin",INSTRUCTOR:"instructor",STUDENT:"student",GUEST:"guest",CUSTOMER_ADMINISTRATOR:"customer admin"},u={CUSTOMER:"Customer"};c.isTrueGuest=isTrueGuest,c.userHasRole=function(e){if(s.user&&s.user.roles)for(var t=0;t<s.user.roles.length;t++)if(s.user.roles[t].role===e){if(e!==d.ADMINISTRATOR||!r.existy(s.user.roles[t].resource_id))return!0}else if(e===d.CUSTOMER_ADMINISTRATOR&&s.user.roles[t].role===d.ADMINISTRATOR&&r.existy(s.user.roles[t].resource_id)&&s.user.roles[t].resource_type===u.CUSTOMER)return!0;return!1},c.getCustomerIdsFromRoles=function(){if(s.user&&s.user.roles)return s.user.roles.reduce(function(e,t){return t.role===d.ADMINISTRATOR&&r.existy(t.resource_id)&&t.resource_type===u.CUSTOMER&&e.push(t.resource_id),e},[])},c.getRoleForNarrative=function(e,t){t=void 0!==t?t:s.user.roles;var i="",n=!1;if(t)for(var a=0;a<t.length;a++){switch(t[a].role){case d.ADMINISTRATOR:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="admin",n=!0;break;case d.INSTRUCTOR:if(t[a].resource_id&&t[a].resource_id!==e)continue;i=t[a].role;break;case d.STUDENT:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="instructor"===i?i:t[a].role;break;case d.GUEST:if(t[a].resource_id&&t[a].resource_id!==e)continue;i="instructor"===i||"student"===i?i:t[a].role}if(n)break}return i},c.getDefaultProductForRole=function(e){var t="player";return"narrative"===s.productLoadedAs?e!==d.ADMINISTRATOR&&e!==d.INSTRUCTOR||(t="sxs"):l.error({data:"authSvc.getDefaultProductForRole should only be used within narratives for now"}),t},c.logout=function(){try{localStorage.removeItem(n.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(e){}s.user={},t({method:"GET",url:n.apiDataBaseUrl+"/logout"}).success(function(){delete t.defaults.headers.common.Authorization,a.path("/").search({logout:1})}).error(function(){delete t.defaults.headers.common.Authorization,a.path("/").search({logout:1})})},c.adminLogin=function(e,a){var r=i.defer();return t({method:"POST",url:n.apiDataBaseUrl+"/auth/identity/callback",data:$.param({auth_key:e,password:a}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){t.defaults.headers.common.Authorization='Token token="'+e.access_token+'"',m(e),c.getCurrentUser().then(function(){r.resolve(e)})}).error(function(e){r.reject(e)}),r.promise};var p=i.defer();c.authenticate=function(i){if(t.defaults.headers.common.Authorization)s.user._id?p.resolve():c.getCurrentUser().then(function(){p.resolve()},function(){return c.authenticateViaNonce(i)});else{if(e.key){var r=e.key;return a.search("key",null),c.getAccessToken(r)}var o=c.getStoredToken();if(!o)return c.authenticateViaNonce(i);t.defaults.headers.common.Authorization='Token token="'+o+'"',c.getCurrentUser().then(function(){p.resolve()},function(){try{localStorage.removeItem(n.localStorageKey),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_tellit-api_session=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}catch(e){}return s.user={},c.authenticateViaNonce(i)})}return p.promise},c.authenticateViaNonce=function(e){var t=i.defer();return c.getNonce(e).then(function(e){c.getAccessToken(e).then(function(){t.resolve()})}),t.promise},c.getStoredToken=function(){var e={};try{if(!localStorage)return!1;localStorage.getItem(n.localStorageKey),e=angular.fromJson(localStorage.getItem(n.localStorageKey));var t=n.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1];return e.customer!==t&&(localStorage.removeItem(n.localStorageKey),e={}),e.token||!1}catch(e){return!1}},c.getCurrentUser=function(){var e=i.defer();return t({method:"GET",url:n.apiDataBaseUrl+"/show_user"}).success(function(t){m(t),e.resolve()}).error(function(){e.reject()}),e.promise},c.updateUser=function(e){var a=i.defer();return t({method:"PUT",url:n.apiDataBaseUrl+"/users/"+e._id,data:e}).success(function(e){m(e),a.resolve()}).error(function(){a.reject()}),a.promise};var m=function(e){if(null!==e.roles&&void 0!==e.roles&&e.roles.length>0&&e.roles[0].constructor===String){for(var i=[],a=0;a<e.roles.length;a++){var r={role:e.roles[a]};i.push(r)}e.roles=i}var l={access_token:e.access_token||e.authentication_token,customer:n.apiDataBaseUrl.match(/\/\/([^\.]*)./)[1],roles:e.roles};angular.forEach(["_id","name","email","track_event_actions","track_episode_metrics","avatar_id"],function(t){e[t]&&(l[t]=e[t])});var d=c.getStoredToken();l.avatar_id&&d&&(t.defaults.headers.common.Authorization='Token token="'+d+'"',t.get(n.apiDataBaseUrl+"/v1/assets/"+l.avatar_id).then(function(e){o.cache("asset",e.data),s.user.avatar=e.data.url})),e["track_episode_metrics:"]&&(l.track_episode_metrics=!0),l.roles&&(l.role_description=v(l.roles[0])),e.emails&&(l.email=e.emails[0]),s.user=l;try{localStorage.setItem(n.localStorageKey,JSON.stringify({token:l.access_token,customer:l.customer}))}catch(e){}},v=function(e){return void 0===e?"User":"admin"===e.role?"Administrator":void 0===e.role?"User":"guest"===e.role?"Guest user":e.role.match(/student/i)?"Student":e.role.match(/instructor/i)?"Instructor":e};return c.getNonce=function(e){var a=i.defer(),r=n.apiDataBaseUrl+"/v1/get_nonce";return e&&(r=r+"?"+e),t.get(r).success(function(e){e.nonce?a.resolve(e.nonce):e.login_url&&null!==e.login_url?(e.login_via_top_window_only?window.top.location.href=e.login_url:window.location.href=e.login_url,a.reject()):("#/"!==window.location.hash&&(window.location.href="/#/"),a.reject())}).error(function(){a.reject()}),a.promise},c.getAccessToken=function(e){var a=i.defer();return t.get(n.apiDataBaseUrl+"/v1/get_access_token/"+e).success(function(e){m(e),t.defaults.headers.common.Authorization='Token token="'+e.access_token+'"',c.getCurrentUser().then(function(){a.resolve(e)})}).error(function(){a.reject()}),a.promise},c}function awsSvc_awsSvc(e,t){var i,a,r,s,o={},l={s3:{}},c=0,d=0,u=0,p=[],m=0,v=[],g={},h=0,f=0,y=[],_=!1;o.awsCache=function(){return l},o.getBucketListing=function(){var e=t.defer();return b().then(function(){l.s3.listObjects(function(t,i){t?e.reject():e.resolve(i)})}),e.promise},o.uploadContainerFiles=function(e,t,i){return S("/v1/containers/"+e+"/assets",t,i)},o.uploadUserFiles=function(e,t){return S("/v1/users/"+e+"/assets",t)};var S=function(e,i,n){for(var a=[],r=0;r<i.length;r++){v.push(i[r]),null!=n&&(g[i[r].name]=[n]);var s=t.defer();y.push(s),a.push(s.promise)}return T(e),a};o.pauseUpload=function(){if(i&&!_){if(_=!0,O(),w())f=0;else{var e=0;for(f=0;e<d;){var t=p[e];"complete"===t.status&&(f+=t.uploaded),e++}}r.notify({bytesSent:f,bytesTotal:i.size})}},o.resumeUpload=function(){if(i&&_)if(_=!1,w())I();else for(var e=0;e<3;e++)$()},o.cancelUpload=function(){i&&(_=!1,f=0,O(),w()||(o.cancelMultipartUpload(a),a=null),i=null,y[h].reject("Canceled by user"));for(var e=h+1;e<v.length;e++)y[e].reject("Canceled by user");h=v.length},o.networkError=function(){i&&O()},o.deleteObject=function(e){var i=t.defer();return b().then(function(){var t={Bucket:e.bucket,Key:e.Key};l.s3.deleteObject(t,function(e,t){e?i.reject():i.resolve(t)})}),i.promise},o.getMultipartUploads=function(){var e=t.defer();return b().then(function(){l.s3.listMultipartUploads(function(t,i){t?e.reject():e.resolve(i)})}),e.promise},o.getMultipartUploadParts=function(e,i){var n=t.defer();return b().then(function(){var t={Bucket:i.bucket,Key:i.Key,UploadId:i.UploadId};l.s3.listParts(t,function(t,i){t?n.reject():n.resolve({i:e,parts:i})})}),n.promise},o.cancelMultipartUpload=function(e){var i=t.defer();return b().then(function(){var t={Bucket:e.bucket,Key:e.Key,UploadId:e.UploadId};l.s3.abortMultipartUpload(t,function(e,t){e?i.reject():i.resolve(t)})}),i.promise};var b=function(){return l.hasOwnProperty("sessionDeferred")?l.sessionDeferred.promise:(l.sessionDeferred=t.defer(),e.get(n.apiDataBaseUrl+"/v1/aws/s3/upload_session").success(function(e){if(e.access_key_id){AWS.config.update({accessKeyId:e.access_key_id,secretAccessKey:e.secret_access_key,sessionToken:e.session_token,region:n.awsRegion});var t={maxRetries:0,httpOptions:{timeout:3e4},params:{Bucket:e.bucket,Prefix:e.key_base}};l.s3=new AWS.S3(t),l.sessionDeferred.resolve(e)}else l.sessionDeferred.reject()}).error(function(){l.sessionDeferred.reject()}),l.sessionDeferred.promise)},T=function(e){if(v.length>h&&!i){if(i=v[h],""===i.type)return y[h].reject("Could not determine file type for file '"+i.name+"'"),i=null,h++,void T(e);E().then(function(){var t;t=w()?k():x(),t.then(function(){D(e)},function(e){y[h].reject(e)},function(e){y[h].notify(e)})})}},E=function(e){return e=e||t.defer(),i.uniqueName=C(),b().then(function(){var t={Key:l.s3.config.params.Prefix+i.uniqueName};l.s3.headObject(t,function(t){t?404!==t.statusCode?e.reject(t):w()?e.resolve():o.getMultipartUploads().then(function(t){var n=function(e){for(var i=0;i<t.Uploads.length;i++)if(t.Uploads[i].Key===l.s3.config.params.Prefix+e)return n(C());return e};i.uniqueName=n(i.uniqueName),e.resolve()}):(i.uniqueName=C(),E(e))})}),e.promise},C=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})},w=function(){return i.size<=5242880},k=function(){return r=t.defer(),I().then(function(e){},function(e){},function(e){}),r.promise},I=function(){var e=t.defer();return b().then(function(){L(i,"base64").then(function(e){var t={Key:l.s3.config.params.Prefix+i.uniqueName,ContentType:i.type,Body:i,ContentMD5:e,ACL:"public-read"};s=l.s3.putObject(t,function(e,t){e?r.reject():r.resolve(t)}),s.on("httpUploadProgress",function(e){r.notify({bytesSent:e.loaded,bytesTotal:e.total})}).on("error",function(e,t){r.reject("An error occured while uploading the file, please try again.")})})},function(e){},function(e){}),e.promise},x=function(){return r=t.defer(),P().then(A).then(function(){for(var e=0;e<3;e++)$()}),r.promise},P=function(){var e=t.defer();return b().then(function(){var t={Key:l.s3.config.params.Prefix+i.uniqueName,ContentType:i.type,ACL:"public-read"};l.s3.createMultipartUpload(t,function(t,i){t?e.reject():e.resolve(i)})}),e.promise},A=function(e){var n=t.defer();a=e,p=[],d=0,u=0,m=0,c=5242880,f=0,i.size>1e3*c&&(c=Math.ceil(i.size/1e3)),d=Math.ceil(i.size/c);for(var r=0;r<d;r++){var s={};s.start=r*c,s.end=s.start+c,s.uploaded=0,s.end>i.size&&(s.end=i.size),s.status="pending",s.retries=0,p.push(s)}return n.resolve(),n.promise},$=function(){var e=t.defer(),n=m,a=!1;if(_)e.reject("Upload paused");else{for(;!a&&n<d;){var r=p[n];if("pending"===r.status){a=!0,r.status="uploading";var s=i.slice(r.start,r.end);r.cancel=function(){r.request.abort(),r.status="pending",r.uploaded=0},t.all({partNumber:t.when(n+1),eTag:N(n+1,s)}).then(M,U).then(function(t){e.resolve(t)},function(t){e.reject(t)},function(t){e.update(t)})}else"complete"===r.status&&n===m&&m++;n++}a||e.reject("All chunks uploaded")}return e.promise},L=function(e,i){var n=t.defer(),a=new FileReader;return a.onload=function(){var e=a.result;n.resolve(AWS.util.crypto.md5(new Uint8Array(e),i))},a.readAsArrayBuffer(e),n.promise},N=function(e,n,s){return s||(s=t.defer()),b().then(function(){L(n,"base64").then(function(t){var o={Bucket:a.Bucket,Key:a.Key,UploadId:a.UploadId,PartNumber:e,ContentMD5:t,Body:n};p[e-1].request=l.s3.uploadPart(o,function(t,i){t?p[e-1].retries<4?(p[e-1].request.abort(),p[e-1].retries++,N(e,n,s)):(p[e-1].status="failed",s.reject(t)):s.resolve(i.ETag)}),p[e-1].request.on("httpUploadProgress",function(t){f+=t.loaded-p[e-1].uploaded,p[e-1].uploaded=t.loaded,r.notify({bytesSent:f,bytesTotal:i.size})}).on("error",function(e,t){})})}),s.promise},M=function(e){var i=t.defer();if(p[e.partNumber-1].status="complete",p[e.partNumber-1].part={ETag:e.eTag,PartNumber:e.partNumber},++u===d){for(var n=[],s=0;s<d;s++)n.push(p[s].part);var o={Bucket:a.Bucket,Key:a.Key,UploadId:a.UploadId,MultipartUpload:{Parts:n}};l.s3.completeMultipartUpload(o,function(e,t){e?(r.reject(e),i.reject(e)):(r.resolve(t),i.resolve(t))})}else $();return i.promise},U=function(e){o.cancelMultipartUpload(a),r.reject(e)},O=function(){if(w())s.abort();else for(var e=m,t=!1;!t&&e<d;){var i=p[e];"uploading"===i.status?i.cancel():"pending"===i.status&&(t=!0),e++}},D=function(a){var r=t.defer(),s={url:"https://s3.amazonaws.com/"+l.s3.config.params.Bucket+"/"+l.s3.config.params.Prefix+i.uniqueName,type:i.type,size:i.size,original_filename:i.name};return g[i.name]&&(Object.assign(s,{tags:g[i.name]}),g[i.name]=null),e.post(n.apiDataBaseUrl+a,s).success(function(e){y[h].resolve(e),i=null,h++,T(a)}).error(function(){y[h].reject(),i=null,h++,T(a)}),r.promise};return o}function errorSvc_errorSvc(e){var t={};return t.init=function(){t.errors=[],t.notifications=[]},t.init(),t.error=function(i,n){!i||401!==i.status&&403!==i.status||"/"===e.path()&&(i=void 0),i&&i.data&&("string"==typeof i.data?(i.data=i.data.replace(/\n/g,"").replace(/==/g,"").replace(/-----.*/g,""),t.errors.push({exception:i})):t.errors.push({exception:i}))},t.notify=function(e){t.notifications.push({text:e})},t}function ittUtils_ittUtils(e){function ngTimeout(t,i){return e(t,i||0)}function cancelNgTimeout(t){e.cancel(t)}return{getSubdomain:getSubdomain,existy:existy,truthy:truthy,generateUUID:ittUtils_generateUUID,isValidURL:isValidURL,stripHtmlTags:stripHtmlTags,pick:pick,bitwiseCeil:bitwiseCeil,setNgOpts:ittUtils_setNgOpts,intersection:intersection,parseTime:ittUtils_parseTime,renameKey:renameKey,ngTimeout:ngTimeout,cancelNgTimeout:cancelNgTimeout,capitalize:capitalize,slugify:slugify}}function capitalize(e){if(existy(e))return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}function bitwiseCeil(e){return e+(e<0?0:1)>>0}function pick(e,t){return t.reduce(function(t,i){return existy(e[i])&&(t[i]=angular.copy(e[i])),t},{})}function omit(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return Object.keys(e).reduce(function(i,n){return-1===t.indexOf(n)&&(i[n]=e[n]),i},{})}function stripHtmlTags(e){return String(e).replace(/<\/?[^>]*>/gm,"")}function getSubdomain(e){return e.indexOf(".")<0?null:e.split(".")[0]}function existy(e){return null!=e}function truthy(e){return 0!=e&&existy(e)}function ittUtils_generateUUID(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})}function isValidURL(e){return/^(((?:http)s?:\/\/)|(?:\/\/))(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i.test(e)}function ittUtils_setNgOpts(e){return"option.value as option.name for option in $ctrl.getSelectOpts('"+e+"')"}function intersection(e,t){for(var i=[],n=0;n<e.length;n++)for(var a=0;a<t.length;a++)if(e[n]==t[a]){i.push(n);break}return i}function ittUtils_parseTime(e){if(!isNaN(parseFloat(e))&&isFinite(e))return e;var t=e.match(/^(\d+)[m:]([\d\.]+)s?$/);return t?parseFloat(60*t[1])+parseFloat(t[2]):(t=e.match(/^([\d\.]+)s$/))?parseFloat(t[1]):(t=e.match(/^([\d\.]+)m$/),t?parseFloat(60*t[1]):void 0)}function renameKey(e,t,i){i.hasOwnProperty(e)&&!i.hasOwnProperty(t)&&e!==t&&(i[t]=i[e],delete i[e])}function slugify(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]/g,"")}function componentTemplateNameify(e){return"np"+e.split("-").map(function(e){return capitalize(e)}).join("")+"Template"}function imageResizeSvc_imageResize(e){function createFileFromDataURL(e,t){var i=_dataURLToBlob(e);return i.name="resized"+t,i.lastModifiedDate=new Date,i}function readFileToImg(t){var i=new Image;return readFileToDataURI(t).then(function(t){return i.src=t,e(function(e,t){i.onload=function(){e(i)},i.onerror=function(){t("Error Loading Image")}}).then(function(e){return e})})}function readFileToDataURI(t){var i=new FileReader;return e(function(e,n){i.onloadend=function(){e(i.result)},i.onerror=function(){n(i.error)},i.readAsDataURL(t)}).then(function(e){return e})}function resizeImg(t,i,n,a){return e(function(e){var r=document.createElement("canvas"),s=_getContext(r),o=0,l=0,c=t.width,d=t.height;for(_setCanvasWH(r,c,d),s.drawImage(t,0,0,c,d);(c>i||d>n)&&!(.5*c<i||.5*d<n);)t.width=.5*t.width,t.height=.5*t.height,c=t.width,d=t.height,r=_resizeImgWithCanvas(r,c,d);var u=_calculateNewDimensions(r.width,r.height,i,n);a&&(u.height<n&&(l=(n-u.height)/2),u.width<i&&(o=(i-u.width)/2)),r=_resizeImgWithCanvas(r,u.width,u.height,i,n,o,l),e(r.toDataURL("image/png",1))})}function calcAspectRatio(e,t){return e/t}function getImageTagType(e,t){return calcAspectRatio(e,t)>1.25?c:l}function _setCanvasWH(e,t,i){e.width=t,e.height=i}function _resizeImgWithCanvas(e,t,i,n,a,r,s){void 0===n&&(n=t),void 0===a&&(a=i),void 0===r&&(r=0),void 0===s&&(s=0);var o=document.createElement("canvas"),l=_getContext(o);return o.width=n,o.height=a,l.drawImage(e,r,s,t,i),o}function _getContext(e){var t=e.getContext("2d");return t.imageSmoothingEnabled=!0,t.mozImageSmoothingEnabled=!0,t.oImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t}function _dataURLToBlob(e){if(-1==e.indexOf(";base64,")){var t=e.split(","),i=t[0].split(":")[1],n=decodeURIComponent(t[1]);return new Blob([n],{type:i})}for(var a=e.split(";base64,"),r=a[0].split(":")[1],s=window.atob(a[1]),o=s.length,l=new Uint8Array(o),c=0;c<o;++c)l[c]=s.charCodeAt(c);return new Blob([l],{type:r})}function _calculateNewDimensions(e,t,i,n){var a=Math.min(i/e,n/t);return{width:Math.floor(e*a),height:Math.floor(t*a)}}return{calcAspectRatio:calcAspectRatio,createFileFromDataURL:createFileFromDataURL,readFileToDataURI:readFileToDataURI,readFileToImg:readFileToImg,resizeImg:resizeImg,getImageTagType:getImageTagType}}function mockSvc_mockSvc(e){var t={};return t.keepJsLintHappy=function(){e.episodes.noop},t.mockEpisode=function(t){e.cache("episode",{_id:t,created_at:"2014-04-10T02:02:15Z",description:{en:"The Business Case for Sustainability"},master_asset_id:"masterasset",title:{en:"Test Episode"},languages:[{code:"en",default:!0}],status:"Published",templateUrl:"templates/episode/gwsb.html",styles:["","",""]}),e.cache("asset",{_id:"masterasset",_type:"Asset::Video",alternate_urls:["https://www.youtube.com/watch?v=dTAAsCNK7RA&list=RDHCffYp01sXKH8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg.m3u8","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.webm","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_416x234.mp4","https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/9aPKP5AJNJdH-UEQ2EB9jg_960x540.mp4"],attachment:"Sustainability_Pays_for_Demo_1.mp4",base_path:"development/Test Customer/SLIC/The Business Case/Sustainability Pays sXs",content_type:"video/mp4",duration:"443.199313",extension:"mp4",file_size:338886327,filename:"Sustainability_Pays_for_Demo_1.mp4",frame_rate:"10000000/417083",frame_rate_d:417083,frame_rate_n:1e7,height:720,name:"Sustainability Pays for Demo 1",original_filename:"Sustainability_Pays_for_Demo_1.mp4",start_time:"0.000000",status:"complete",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays%20sXs/Sustainability_Pays_for_Demo_1.mp4",width:1280});for(var i={_id:"-",_type:"Scene",description:{en:"Scene <b>description</b> Description"},keywords:[],start_time:0,end_time:200,type:"Scene",episode_id:t,cur_episode_id:t,layouts:["",""],styles:["transitionSlideL"]},n=["templates/scene/cornerH.html","templates/scene/cornerV.html","templates/scene/centered.html","templates/scene/onecol.html"],a=0;a<10;a++){var r=angular.copy(i);r._id="scene-"+a,r.title=a/2===Math.floor(a/2)?{en:"Scene "+(a+1)+" Title"}:{en:""},r.start_time=20*a,r.end_time=20*a+20,r.templateUrl=n[a%n.length],e.cache("event",r)}var s={_id:"",_type:"Annotation",annotation:{en:"Transcript text: <b>html</b> included!"},annotation_image_id:"asset3",annotator:{en:"Speaker Name"},cosmetic:!1,episode_id:t,cur_episode_id:t,required:!1,stop:!1,type:"Annotation",templateUrl:"templates/item/transcript-withthumbnail.html",styles:["colorInvert"]},o=["sidebarL","sidebarR","inline"],l=["templates/item/text-h1.html","templates/item/pullquote.html","templates/item/text-h2.html"];for(a=0;a<30;a++){var c=angular.copy(s);c._id="transcript-"+a,c.annotation={en:"Transcript block number "+(a+1)},c.start_time=5*a,c.end_time=5*a+5,c.layouts=[o[a%o.length]]}for(a=0;a<10;a++){var d=angular.copy(s);d._id="annotation-"+a,d.start_time=6*a,d.end_time=6*a+3,d.templateUrl=l[a%l.length],e.cache("event",d)}for(a=0;a<10;a++){var u=angular.copy(s);u._id="longtext-"+a,u.start_time=7*a,u.end_time=7*a+7,u.styles=["timestampNone"],u.annotation={en:"A way a long a last a loved along the riverrun, past Eve and Adam's, from swerve of shore to bend of bay, brings us by a commodius vicus of recirculation back to Howth Castle and Environs. Sir Tristram, <i>violer d'amores</i>, fr'over the short sea, had passencore rearrived from North Armorica on this side the scraggy isthmus of Europe Minor to wielderfight his penisolate war"},u.templateUrl="templates/item/text-transmedia.html",e.cache("event",u)}e.cache("asset",{_id:"asset1",_type:"Asset::Image",url:"https://s3.amazonaws.com/itt.uploads/development/Test%20Customer/SLIC/The%20Business%20Case/Sustainability%20Pays/Sustainability_Scorecard_1.jpg",extension:"jpg",name:"Sustainability Scorecard 1"}),e.cache("asset",{_id:"asset2",_type:"Asset::Image",url:"http://placehold.it/350x350",extension:"jpg",name:"350x350 placeholder"}),e.cache("asset",{_id:"asset3",_type:"Asset::Image",url:"http://placehold.it/64x64",extension:"jpg",name:"64x64 placeholder"}),e.cache("asset",{_id:"asset4",_type:"Asset::Image",url:"http://placehold.it/900x900",extension:"jpg",name:"900x900 placeholder"});var p={_id:"",_type:"Link",link_image_id:"asset1",url:"https://luminarydigitalmedia.com",title:{en:"Link Title"},description:{en:"Link Description <i>lorem</i> ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy lorem ipsum dolor frog a frog oh lord it's amet lorem ipsum buddy"},cosmetic:!1,stop:!1,type:"Link",episode_id:t,cur_episode_id:t,layouts:["inline"],styles:["timestampNone"],isContent:!0};for(a=0;a<30;a++){var m=angular.copy(p);m._id="link-"+a,m.required=Math.random()>.5,m.start_time=3*a,m.end_time=3*a+3,m.layouts=[o[a%o.length]],e.cache("event",m)}var v={_id:"",_type:"Plugin",producerItemType:"question",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],title:{},data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-formative",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",correct:!0,index:3},{text:"",index:4}],correctfeedback:"Great!",incorrectfeedback:"Doh!",_type:"question"}}};for(a=0;a<10;a++){var g=angular.copy(v);g._id="question-"+a,g.required=Math.random()>.5,g.start_time=5*a,g.end_time=5*a+5,g.layouts=[o[a%o.length]],e.cache("event",g)}var h={_id:"",_type:"Plugin",type:"Plugin",producerItemType:"question",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/question-mc.html",style_id:[],layout_id:[],data:{_id:"",_pluginType:"question",_version:2,_plugin:{questiontext:"Some question text?",questiontype:"mc-poll",distractors:[{text:"a",index:1},{text:"b",index:2},{text:"c",index:3},{text:"",index:4}],_type:"question"}}};for(a=0;a<10;a++){var f=angular.copy(h);f._id="question-"+a,f.required=Math.random()>.5,f.start_time=6*a,f.end_time=6*a+6,f.layouts=[o[a%o.length]],e.cache("event",f)}var y={_type:"Upload",description:{en:"Description of an upload item"},required:!1,cosmetic:!0,stop:!1,type:"Upload",episode_id:t,cur_episode_id:t,templateUrl:"templates/item/image-caption.html",styles:["transitionFade","tl"],layouts:["inline"]};for(a=0;a<30;a++){var _=angular.copy(y);_._id="upload-"+a,_.asset_id="asset2",_.title={en:"Upload number "+(a%3+1)},_.start_time=4*a,_.end_time=4*a+4,_.layouts=[o[a%o.length]],e.cache("event",_)}var S=["mainFg","altFg","videoOverlay"];for(a=0;a<8;a++){var b=angular.copy(y);b.layouts=[S[a%S.length]],b._id="filltest-"+a,b.asset_id="asset2",b.start_time=2*a,b.end_time=2*a+2,b.templateUrl="templates/item/image-fill.html",b.styles.push("cover"),e.cache("event",b)}e.resolveEpisodeEvents(t),e.resolveEpisodeAssets(t)},t}function createInstance(e,t){var i;switch(e){case"Link":i=new F;break;case"Annotation":i=new R;break;case"Bookmark":i=new V;break;case"Chapter":i=new B;break;case"Image":i=new j;break;case"Plugin":i=new H;break;case"Scene":i=new q;break;case"Text":i=new W;break;case"Upload":i=new K;break;case"Narrative":i=new M;break;case"Asset":i=new U;break;case"Customer":i=new N;break;case"Timeline":i=new L;break;case"Episode":i=new P;break;case"Container":i=new A;break;case"LayoutTemplate":i=new x;break;case"ItemTemplate":i=new I;break;case"EpisodeTemplate":return i=new k,Object.assign(i,t),t.css_configuration&&(i.css_configuration=Object.assign(new E,t.css_configuration)),t.fonts&&(i.fonts=Object.assign(new C,t.fonts)),i;case"Layout":i=new T;break;case"Style":i=new b}return Object.assign(i,t),i}function ittUser(e,t,i,n,a,r,s){return{restrict:"A",replace:!0,scope:{},template:ie.a,link:function(o,l,c){function toggleEditing(){o.isEditing=!o.isEditing}o.inPlayer=c.inPlayer,o.appState=t,o.loading=!0,o.logout=i.logout,o.canAccess=i.userHasRole("admin")||i.userHasRole("customer admin"),i.authenticate().then(function(){o.loading=!1,o.user=t.user,o.userHasRole=i.userHasRole}),o.isEditing=!1,o.toggleEditing=toggleEditing,o.uploadStatus=[],o.toggleUploadAvatar=function(){o.showUploadField=!o.showUploadField},o.uploadAvatar=function(i){function _resizeWithService(e){return s.resizeImg(e,60,60,!0).then(function(e){return e})}function _avatarFileFromImg(t){return e(function(e){e(s.createFileFromDataURL(t,i[0].name))})}function _postToAWS(e){a.uploadUserFiles(t.user._id,[e])[0].then(function(e){o.showUploadField=!1,r.cache("asset",e.file),t.user.avatar_id,t.user.avatar_id=e.file._id,o.updateUser(),delete o.uploads})}o.uploadStatus[0]={bytesSent:0,bytesTotal:1},s.readFileToImg(i[0]).then(_resizeWithService).then(_avatarFileFromImg).then(_postToAWS).catch(function(e){})},o.updateUser=function(){i.updateUser(t.user).then(function(){o.user=t.user})},o.getMyNarratives=function(){n.getUserNarratives(o.user._id).then(function(e){o.myPurchases=e,angular.forEach(o.myPurchases,function(e){e.daysUntilExpiration=Math.floor((new Date(e.expiration_date)-new Date)/864e5),n.getNarrativeOverview(e.narrative_id).then(function(e){angular.forEach(o.myPurchases,function(t){t.narrative_id===e._id&&(t.narrativeData=e)})})})})}}}}function ittRouteLoading(){return{restrict:"EA",template:['<div ng-if="routeLoadingCtrl.isLoading" class="loading routeLoading">','\t<div class="spinner">','\t\t<div class="rotating pie"></div>','\t\t<div class="filler pie"></div>','\t\t<div class="mask"></div>','\t</div><span class="loading__text">Loading</span>',"</div>"].join(" "),scope:{isLoading:"=?"},controller:["$rootScope","$scope","$timeout","errorSvc",function(e,t,i,n){var a=this;a.isLoading=a.isLoading||!1;var r;e.$on("$routeChangeStart",function(){r=i(function(){a.isLoading=!0},500)}),e.$on("$routeChangeSuccess",function(){i.cancel(r),a.isLoading=!1}),e.$on("$locationChangeSuccess",function(){i.cancel(r),a.isLoading=!1}),e.$on("$routeChangeError",function(){i.cancel(r),a.isLoading=!1}),t.$watch(function(){return n.errors.length},function(e,t){e!==t&&e>0&&(i.cancel(r),a.isLoading=!1)})}],controllerAs:"routeLoadingCtrl",bindToController:!0}}function ittValidationTip(){return{restrict:"EA",scope:{text:"@",doInfo:"=?"},template:['<span class="tooltip-static">',"\t<i class=\"fa fa-info-circle\" ng-class=\"{'error-red': !doInfo, 'info-blue': doInfo}\"></i>",'\t<span class="tooltip-text">{{text}}</span>',"</span>"].join("\n")}}function ittFilesHandler(){return{scope:{onSelected:"&"},restrict:"A",link:function(e,t){t.bind("change",function(){e.$apply(function(){e.onSelected({files:t[0].files})})})}}}function ittLogin(e,t,i,a,r){return{restrict:"A",replace:!1,link:function(s){s.userHasRole=i.userHasRole,s.appState=a,s.loginForm={auth_key:"",password:""},s.apiDataBaseUrl=n.apiDataBaseUrl,i.authenticate().then(function(){if(r.init(),t.key&&e.search("key",null),t.episode){var i=t.episode;e.search("episode",null),e.search("nonce",null),e.path("/episode/"+i)}else if(t.narrative){var n=t.narrative;if(e.search("narrative",null),e.search("nonce",null),t.timeline){var a=t.timeline;e.search("timeline",null),e.path("/story/"+n+"/"+a)}else e.path("/story/"+n)}else 0===Object.keys(t).length&&e.path("/account")},function(){}),s.adminLogin=function(){i.adminLogin(s.loginForm.auth_key,s.loginForm.password).then(function(){e.path("/projects")}).catch(function(e){s.badlogin=!0})},s.logout=function(){i.logout()}}}}function dataSvc_dataSvc(e,t,i,a,r,s,o,l,c,d,u,p,m){function sendSocialshareEmail(e,t){return I("/v3/timelines/"+e+"/share_via_email",t)}function beginBackgroundTranslations(e){return w("/v3/episodes/"+e+"/update_translations")}function batchUploadTranscripts(e,t,i){var n={transformRequest:angular.identity,headers:{"Content-type":void 0}};return s.existy(i)&&Object.keys(i).length>0&&Object.assign(n,{params:i}),I("/v3/episodes/"+e+"/events/import_subtitles",t,n)}function generateNewNarrative(e,t){return I("/v3/containers/"+e+"/narratives",t).then(function(e){return e.data}).catch(function(e){})}function getCustomerLinkStatusReportSpreadsheet(e){var t="/v3/customers/"+e+"/link_status.xlsx";window.open(t)}function getAssetsByAssetIds(e){var t=Object.create(null);return t.asset_ids=e,I("/v1/assets",t).then(function(e){return e.data.files})}function fetchAndCacheAssetsByIds(e){return getAssetsByAssetIds(e).then(function(t){return t.forEach(function(e){c.cache("asset",e)}),e.reduce(function(e,t){return e.push(c.assets[t]),e},[])})}function deleteContainer(e){return L("/v3/containers/"+e)}function readCache(e,t,i){return c.readDataCache(e,t,i)}function getEpisodeTemplatesAdmin(){if(o.userHasRole("admin"))return v.getTemplates().reduce(function(e,t){return t instanceof k&&e.push({id:t.id,name:t.displayName,customer_ids:t.customer_ids}),e},[])}function getEpisodeTemplatesByCustomerIds(e){return v.getTemplates().reduce(function(t,i){if(i instanceof k){intersection(e,i.customer_ids).length>0&&t.push({id:i.id,name:i.displayName,customer_ids:i.customer_ids})}return t},[])}function fetchTemplates(){return w("/v1/templates").then(function(e){return v.cache("templates",e)}).then(function(){return v.getTemplates()})}function getTemplate(e){return c.dataCache.template[e]}var v=Object.create(null);v.sendSocialshareEmail=sendSocialshareEmail,v.beginBackgroundTranslations=beginBackgroundTranslations,v.batchUploadTranscripts=batchUploadTranscripts,v.generateNewNarrative=generateNewNarrative,v.getNarrative=function(i){var a=e.defer(),l=c.narratives[i],d=s.getSubdomain(r.host()),u="";return s.existy(l)&&s.existy(l.narrative_subdomain)&&d!==l.narrative_subdomain&&(u="?customer="+l.narrative_subdomain),o.authenticate("narrative="+i).then(function(){t.get(n.apiDataBaseUrl+"/v3/narratives/"+i+"/resolve"+u).then(function(e){e.data.timelines.sort(function(e,t){return e.sort_order-t.sort_order}),c.cache("narrative",v.resolveIDs(e.data)),a.resolve(c.narratives[e.data._id])})}),a.promise},v.getNarrativeOverview=function(e){return C("/v3/narratives/"+e)},v.getNarrativeExportAsSpreadsheet=function(e){var t="/v3/narratives/"+e+".xlsx";window.open(t)},v.getCustomerLinkStatusReportSpreadsheet=getCustomerLinkStatusReportSpreadsheet;var g=!1;v.getUserNarratives=function(t){if(g){var i=e.defer();return i.resolve(g),i.promise}return C("/v3/users/"+t+"/narrative_purchases",function(e){return g=e,e})},v.getCustomerList=function(){return C("/v3/customers/",function(e){return angular.forEach(e,function(e){c.cache("customer",e)}),e})},v.getCustomer=function(t,i){return o.userHasRole("admin")||o.userHasRole("customer admin")?c.customers[t]?i?e(function(e){e(c.customers[t])}):void 0:w("/v3/customers/"+t).then(function(e){return c.cache("customer",e),c.customers[e._id]}).catch(function(e){}):e(function(e){e({})})},v.getEpisode=function(e,t){if(!e)throw"no episode ID supplied to dataSvc.getEpisode";c.cache("episode",{_id:e}),i.local?(u.mockEpisode(e),a.$emit("dataSvc.getEpisode.done")):o.authenticate().then(function(){return y()}).then(function(){return b(e,t)})},v.getEpisodeOverview=function(e){return C("/v3/episodes/"+e)},v.getNarrativeList=function(e){return s.existy(e)?C("/v3/narratives?customer_id="+e._id).then(function(t){c.assocNarrativesWithCustomer(e,t)}):C("/v3/narratives/")},v.createUserGroup=function(e){return A("/v3/groups",{group:{name:e}})},v.createNarrative=function(e){return I("/v3/narratives",e)},v.updateNarrative=function(e){return x("/v3/narratives/"+e._id,e)},v.createChildEpisode=function(e){return A("/v3/episodes",{episode:e})},v.createEpisodeSegment=function(e,t){return A("/v3/timelines/"+e+"/episode_segments",t)},v.storeTimeline=function(e,t){var i=["sort_order","path_slug","name","description","hidden","timeline_image_ids","narrative_id","_id"],n=s.pick(t,i);return n._id?P("/v3/timelines/"+n._id,n,function(e){return"string"==typeof e.name&&(e.name={en:e.name}),"string"==typeof e.description&&(e.description={en:e.description}),e}):A("/v3/narratives/"+e+"/timelines",n,function(e){return"string"==typeof e.name&&(e.name={en:e.name}),"string"==typeof e.description&&(e.description={en:e.description}),e})},v.deleteTimeline=function(e){return L("/v3/timelines/"+e).then(function(e){return e})},v.getSingleAsset=function(t){return t?C("/v1/assets/"+t):e(function(e){e(void 0)})};var h=!1,f=e.defer(),y=function(){return h?f.promise:(h=!0,e.all([t.get(n.apiDataBaseUrl+"/v1/templates"),t.get(n.apiDataBaseUrl+"/v1/layouts"),t.get(n.apiDataBaseUrl+"/v1/styles")]).then(function(e){v.cache("templates",e[0].data),v.cache("layouts",e[1].data),v.cache("styles",e[2].data),h=!0,f.resolve()},function(){h=!1,f.reject()}),f.promise)};v.getCommon=y,v.cache=function(e,t){angular.forEach(t,function(t){"templates"===e?t.applies_to_episodes?c.dataCache.template[t._id]=createInstance("EpisodeTemplate",{id:t._id,url:t.url,type:"Episode",displayName:t.name,customer_ids:t.customer_ids,css_configuration:t.css_configuration,fonts:t.fonts,pro_episode_template:t.pro_episode_template}):t.event_types&&t.event_types&&"Scene"===t.event_types[0]?c.dataCache.template[t._id]=createInstance("LayoutTemplate",{id:t._id,url:t.url,type:"Scene",displayName:t.name,component_name:t.component_name}):c.dataCache.template[t._id]=createInstance("ItemTemplate",{id:t._id,url:t.url,type:t.event_types&&t.event_types[0],displayName:t.name,component_name:t.component_name}):"layouts"===e?c.dataCache.layout[t._id]=createInstance("Layout",{id:t._id,css_name:t.css_name,displayName:t.display_name}):"styles"===e&&(c.dataCache.style[t._id]=createInstance("Style",{id:t._id,css_name:t.css_name,displayName:t.display_name}))})},v.createTemplate=function(e){return A("/v1/templates",e)},v.resolveIDs=function(e){if(e.layout_id){var t=[];"Scene"===e.type&&(t=["",""]),angular.forEach(e.layout_id,function(i){c.dataCache.layout[i]?"Scene"===e.type?"showCurrent"===c.dataCache.layout[i].css_name?t[1]=c.dataCache.layout[i].css_name:"splitRequired"===c.dataCache.layout[i].css_name?t[2]=c.dataCache.layout[i].css_name:t[0]=c.dataCache.layout[i].css_name:t.push(c.dataCache.layout[i].css_name):d.error({data:"Couldn't get layout for id "+i})}),t.length>0&&(e.layouts=t)}if(e.style_id){var i=[];angular.forEach(e.style_id,function(e){c.dataCache.style[e]?i.push(c.dataCache.style[e].css_name):d.error({data:"Couldn't get style for id "+e})}),i.length>0&&(e.styles=i)}return e};var _=function(e){return e.hasOwnProperty("asset_id")&&e.asset_id?e.asset_id:e.hasOwnProperty("annotation_image_id")&&e.annotation_image_id?e.annotation_image_id:e.hasOwnProperty("link_image_id")&&e.link_image_id?e.link_image_id:e.hasOwnProperty("avatar_id")&&e.avatar_id?e.avatar_id:void 0},S=function(e){for(var t={},i=0,n=e.length;i<n;i++){var a=_(e[i]);a&&(a in t||(t[a]=0))}return Object.keys(t)};v.getAssetsByAssetIds=getAssetsByAssetIds,v.fetchAndCacheAssetsByIds=fetchAndCacheAssetsByIds;var b=function(e,i){var r=i?"/v3/episode_segments/"+i+"/resolve":"/v3/episodes/"+e;t.get(n.apiDataBaseUrl+r).success(function(t){var n=Object.create(null);if(t&&(n=t.episode?t.episode:t),"Published"===n.status||o.userHasRole("admin")||o.userHasRole("customer admin")){var r=c.dataCache.template[n.template_id];n.template=r,c.cache("episode",v.resolveIDs(n)),r&&m.setTheme(r),T(e,i).success(function(t){t=t||[],E(t,"Plugin",e),angular.forEach(t,function(t){t.cur_episode_id=e,c.cache("event",v.resolveIDs(t))}),c.resolveEpisodeEvents(e);var i=S(t);i=void 0!==i&&i.length>0?i:[],i.push(n.master_asset_id),n.poster_frame_id&&i.push(n.poster_frame_id),getAssetsByAssetIds(i).then(function(t){t.forEach(function(e){c.cache("asset",e)}),c.resolveEpisodeAssets(e),a.$emit("dataSvc.getEpisode.done")})}).error(function(){d.error({data:"API call to get events failed."})})}else d.error({data:"This episode has not yet been published."})}).error(function(){d.error({data:"API call to /v3/episodes/"+e+" failed (bad episode ID?)"})})};v.getContainerAncestry=function(t,i,n){return n=n||e.defer(),v.getContainer(t,i).then(function(e){var t=c.containers[e];t.parent_id?v.getContainerAncestry(t.parent_id,i,n):n.resolve(e)}),n.promise};var T=function(e,i){var a=i?"/v3/episode_segments/"+i+"/events":"/v3/episodes/"+e+"/events";return t.get(n.apiDataBaseUrl+a)},E=function(e,t,i){angular.forEach(e,function(e){"Plugin"===e.type&&function(e){p.getUserAnswer(e._id,l.user._id).then(function(t){if(t.data){e.data._plugin.hasBeenAnswered=!0;var i=0,n=!0;angular.forEach(e.data._plugin.distractors,function(a){n&&(a.index===t.data.index&&(a.selected=!0,e.data._plugin.selectedDistractor=a.index,n=!1),i++)}),c.cache("event",v.resolveIDs(e))}})}(e)}),c.resolveEpisodeEvents(i)},C=function(i,a){var r=e.defer();return o.authenticate().then(function(){t.get(n.apiDataBaseUrl+i).then(function(e){var t=e.data;return a&&(t=a(t)),r.resolve(t)})}),r.promise},w=function(e){return o.authenticate().then(function(){return t.get(n.apiDataBaseUrl+e).then(function(e){return e.data})})},I=function(e,i,n){return n?t.post(e,i,n):t.post(e,i)},x=function(e,i){return t.put(n.apiDataBaseUrl+e,i)},P=function(i,a,r){var s=e.defer();return t({method:"PUT",url:n.apiDataBaseUrl+i,data:a}).success(function(e){var t=e;r&&(t=r(t)),s.resolve(t)}),s.promise},A=function(i,a,r){var s=e.defer();return t({method:"POST",url:n.apiDataBaseUrl+i,data:a}).success(function(e){var t=e;r&&(t=r(t)),s.resolve(t)}),s.promise},$=function(i){var a=e.defer();return t({method:"DELETE",url:n.apiDataBaseUrl+i}).success(function(e){return a.resolve(e)}),a.promise},L=function(e){return t({method:"DELETE",url:n.apiDataBaseUrl+e}).then(function(e){return e})};v.getContainerRoot=function(){return C("/v3/containers",function(e){var t=[];return angular.forEach(e,function(e){c.cache("container",e),t.push(e._id)}),t})},v.getContainer=function(e,t){return C("/v3/containers/"+e,function(i){c.cache("container",i[0]);var n=c.containers[i[0]._id];if(v.getContainerAssets(e,t),n.children){for(var a=0;a<n.children.length;a++)n.children[a]=c.containers[n.children[a]._id];var r=!1;t||(r=!0),r&&angular.forEach(n.children,function(e){e.episodes[0]&&v.getEpisodeOverview(e.episodes[0]).then(function(t){t&&(e.status=t.status,e.title=t.title,c.cache("container",e))})})}return i[0]._id})},v.getContainerAssets=function(e,i){return t.get(n.apiDataBaseUrl+"/v1/containers/"+e+"/assets").success(function(t){c.containers[e].assetsHaveLoaded=!0,angular.forEach(t.files,function(e){c.cache("asset",e)}),c.resolveEpisodeAssets(i)})},v.createContainer=function(t){var i=e.defer(),n={container:{customer_id:t.customer_id,name:t.name,parent_id:t.parent_id}};return A("/v3/containers",n).then(function(e){c.cache("container",e);var t=c.containers[e._id],n=t.parent_id;c.containers[n].children.push(t),i.resolve(t)}),i.promise},v.updateContainer=function(t){var i=e.defer();return t._id||i.reject(),P("/v3/containers/"+t._id,t,function(e){c.cache("container",e),i.resolve(e)}),i.promise},v.deleteContainer=deleteContainer,v.createEpisode=function(t){t.status="Unpublished";var i=e.defer();return A("/v3/episodes",t).then(function(e){c.containers[e.container_id].episodes=[e._id],c.containers[e.container_id].status=e.status,i.resolve(e)}),i.promise},v.storeEpisode=function(t){var i=M(t);return null!=i?P("/v3/episodes/"+i._id,i):e.reject(!1)},v.deleteItem=function(e){return $("/v3/events/"+e)},v.createAsset=function(t,i){var n=e.defer();return i.container_id=t,i._id&&i._id.match(/internal/)&&delete i._id,i=c.deriveAsset(i),A("/v1/containers/"+t+"/assets",i).then(function(e){c.containers[e.file.container_id].episodes=[e.file._id],c.cache("asset",e.file),n.resolve(e.file)}),n.promise},v.deleteAsset=function(e){return $("/v1/assets/"+e)},v.storeItem=function(t){return t=N(t),t?t&&t._id&&!t._id.match(/internal/)?P("/v3/events/"+t._id,{event:t}):A("/v3/episodes/"+t.episode_id+"/events",{event:t}):e.reject({})};var N=function(e){var t={};e._id&&e._id.match(/internal/)&&delete e._id;var i=["_id","start_time","end_time","episode_id","chapter_marker","template_id","stop","required","cosmetic","sxs","title","url","target","url_status","annotator","annotation","description","data","asset_id","link_image_id","annotation_image_id","avatar_id"];t.type=e._type;for(var n=0;n<i.length;n++)void 0!==e[i[n]]&&(t[i[n]]=angular.copy(e[i[n]]));if(t.start_time&&t.end_time){var a=parseFloat(t.start_time),r=parseFloat(t.end_time);if(isNaN(a)||isNaN(r))return d.error({data:"Tried to store an invalid start_time or end_time."}),!1;if(a>r)return d.error({data:"Tried to store a start_time that is after the end_time."}),!1}if(t.data&&(delete t.data._plugin.selectedDistractor,delete t.data._plugin.hasBeenAnswered,delete t.data._plugin._type,t.data._plugin.distractors.length))for(n=0;n<t.data._plugin.distractors.length;n++)delete t.data._plugin.distractors[n].selected;if(t.style_id=[],t.layout_id=[],t.style_id=U("style",e.styles),t.layout_id=U("layout",e.layouts),"Chapter"===e._type)return t;var s=v.readCache("template","component_name",e.component_name);return null!=s&&(t.template_id=s.id),t.template_id?t:(d.error({data:"Tried to store a template with no ID: "+e.templateUrl}),!1)};v.prepItemForStorage=N,v.detachMasterAsset=function(t){var i=M(t);return i.master_asset_id=null,i?P("/v3/episodes/"+i._id,i):e.reject(!1)},v.detachEventAsset=function(e,t){return!!(e=N(e))&&(e.asset_id===t&&(e.asset_id=null),e.link_image_id===t&&(e.link_image_id=null),e.annotation_image_id===t&&(e.annotation_image_id=null),e&&e._id&&!e._id.match(/internal/)?P("/v3/events/"+e._id,{event:e}):A("/v3/episodes/"+e.episode_id+"/events",{event:e}))};var M=function(e){e._id&&e._id.match(/internal/)&&delete e._id;var t=["_id","title","description","container_id","customer_id","master_asset_id","poster_frame_id","status","languages","template_id"],i=pick(e,t);i.style_id=U("style",e.styles);var n=v.readCache("template","id",e.template_id);return n&&n.id?(i.template_id=n.id,i):(d.error({data:"Tried to store a template with no ID: "+e.template_id}),null)};v.readCache=readCache,n.debugInBrowser,v.getTemplates=function(){return Object.keys(c.dataCache.template).map(function(e){return c.dataCache.template[e]})},v.getEpisodeTemplatesAdmin=getEpisodeTemplatesAdmin,v.getEpisodeTemplatesByCustomerIds=getEpisodeTemplatesByCustomerIds,v.fetchTemplates=fetchTemplates,v.getTemplate=getTemplate;var U=function(e,t){var i=[];return angular.forEach(t,function(t){if(t){var n=v.readCache(e,"css_name",t);if(null==n)return d.error({data:"Tried to store a "+e+" with no ID: "+t}),!1;i.push(n.id)}}),i};return v}function modelSvc_modelSvc(e,t,i,a,r,s){function readCache(e,t,i){var n=l.dataCache[e];for(var a in n)if(n.hasOwnProperty(a)&&n[a][t]===i)return n[a];return null}function mainVideoNewWindowUrl(e,t,i,a,r){void 0===r&&(r="episode");var s=n.apiDataBaseUrl+"/v1/new_window";return t&&i?s+"?narrative="+t+"&timeline="+i+"&access_token="+e+"&t="+(a||0):s+"?"+r+"="+t+"&access_token="+e+"&t="+(a||0)}function assocNarrativesWithCustomer(e,t){return t.forEach(function(e){l.cache("narrative",e)}),e.narratives=cachedNarrativesByCustomer(e),l.cache("customer",e),e}function cachedNarrativesByCustomer(e){return Object.keys(l.narratives).reduce(function(t,i){return l.narratives[i].customer_id===e._id&&t.push(l.narratives[i]),t},[])}function getCustomersAsArray(){return Object.keys(l.customers).map(function(e){return l.customers[e]})}function getNarrativesAsArray(){return Object.keys(l.narratives).map(function(e){return l.narratives[e]})}function _sortItems(e){return e.sort(function(e,t){return e.start_time===t.start_time?"chapter"===e.producerItemType?-1:"chapter"===t.producerItemType?1:!0===e.chapter_marker?-1:!0===t.chapter_marker?1:e.component_name===o.HEADER_ONE_TEMPLATE?-1:t.component_name===o.HEADER_ONE_TEMPLATE?1:e.component_name===o.HEADER_TWO_TEMPLATE?-1:t.component_name===o.HEADER_TWO_TEMPLATE?1:e.isTranscript?-1:t.isTranscript?1:"Link"===e._type?-1:"Link"===t._type?1:"Upload"===e._type?"file"===e.producerItemType||"Annotation"===t._type?-1:1:"Upload"===t._type?1:-1:e.start_time-t.start_time})}function isOnExistingSceneStart(e){return getEpisodeScenes().some(function(t){return t.start_time===i.parseTime(e)})}function getEpisodeScenes(){return Object.keys(l.events).reduce(function(e,t){return"Scene"===l.events[t]._type&&l.events[t].episode_id===a.episodeId&&e.push(l.events[t]),e},[])}function assocEventWithAsset(e,t){l.events[e]&&l.assets[t]&&(l.events[e].asset=l.assets[t])}var l=Object.create(null);l.episodes={},l.assets={},l.events={},l.containers={},l.narratives={},l.customers={},l.dataCache={template:{},layout:{},style:{}},l.readDataCache=readCache,l.mainVideoNewWindowUrl=mainVideoNewWindowUrl,l.getNarrativeByPathOrId=function(e){if(/^[0-9a-fA-F]{24}$/.test(e))return l.narratives[e];var t;for(t in l.narratives)if(l.narratives.hasOwnProperty(t)&&e===l.narratives[t].path_slug.en)return l.narratives[t]},l.assocNarrativesWithCustomer=assocNarrativesWithCustomer,l.cachedNarrativesByCustomer=cachedNarrativesByCustomer,l.getCustomersAsArray=getCustomersAsArray,l.getNarrativesAsArray=getNarrativesAsArray,l.cache=function(e,t){if("narrative"===e){var i=createInstance("Narrative",t);i.timelines&&i.timelines.length>0&&(i.timelines=i.timelines.map(function(e){return createInstance("Timeline",e)})),l.narratives[t._id]?angular.extend(l.narratives[t._id],i):l.narratives[t._id]=angular.copy(i)}if("customer"===e){var i=createInstance("Customer",t);l.customers[t._id]?angular.extend(l.customers[t._id],i):l.customers[t._id]=angular.copy(i)}if("episode"===e){var i=createInstance("Episode",t);l.episodes[t._id]?angular.extend(l.episodes[t._id],l.deriveEpisode(angular.copy(i))):l.episodes[t._id]=l.deriveEpisode(angular.copy(i))}else if("event"===e){var i=createInstance(t._type,t);t.title||(t.title={}),l.events[t._id]?angular.extend(l.events[t._id],l.deriveEvent(angular.copy(i))):l.events[t._id]=l.deriveEvent(angular.copy(i))}else if("asset"===e){var i=createInstance("Asset",t);l.assets[t._id]?angular.extend(l.assets[t._id],l.deriveAsset(angular.copy(i))):l.assets[t._id]=l.deriveAsset(angular.copy(i))}else if("container"===e){var i=createInstance("Container",t);l.containers[t._id]?angular.extend(l.containers[t._id],l.deriveContainer(angular.copy(i))):l.containers[t._id]=l.deriveContainer(angular.copy(i))}},l.deriveEpisode=function(e){if(angular.forEach(e.languages,function(t){t.default&&(e.defaultLanguage=t.code)}),!1===e.defaultLanguage&&(e.defaultLanguage="en"),l.setLanguageStrings(),e.styles||(e.styles=[]),e.title&&l.events["internal:landingscreen:"+e._id]&&(l.events["internal:landingscreen:"+e._id].title=e.title,l.events["internal:landingscreen:"+e._id]=d(l.events["internal:landingscreen:"+e._id])),e.template){var t="Career Playbook"===e.template.displayName||"Narrasys Professional"===e.template.displayName;e.template&&t&&(a.resizeIframeReviewMode=!0)}return e=d(e)},l.deriveAsset=function(e){var t=Object.assign({},e);return"Asset::Video"===t._type&&(t=s.resolveVideo(t)),t.url&&(t.cssBgUrl=t.url.replace(/\"/g,'\\"')),t=d(t)},l.deriveContainer=function(e){if(e.haveNotLoadedChildData=!1,e.children&&e.children.length>0){e.children=e.children.sort(function(e,t){return e.name.en>t.name.en?1:-1}),e.children=e.children.sort(function(e,t){return e.sort_order-t.sort_order});var t=[];angular.forEach(e.children,function(e){var i=createInstance("Container",e);l.containers[e._id]?t.push(l.containers[e._id]):(i.haveNotLoadedChildData=!0,l.containers[e._id]=angular.copy(d(i)))}),e.loadedChildData=!0}else e.children=[];return d(e)};var c=function(e){if(void 0!==e)return"Annotation"===e._type&&e.component_name===o.TRANSCRIPT_TEMPLATE};l.deriveEvent=function(i){var n=readCache("template","id",i.template_id);if(null!=n&&(i.component_name=n.component_name),i=d(i),"Scene"!==i._type){i.searchableText=(i.display_annotation||i.display_description)+" "+(i.display_title||i.display_annotator),i.cosmetic||(i.cosmetic=!1),i.sxs&&(i.cosmetic=!1),i.avatar_id&&(l.assets[i.avatar_id]||(l.assets[i.avatar_id]={}),i.avatar=l.assets[i.avatar_id]),l.episodes[i.cur_episode_id]&&"University of Southern California"===l.episodes[i.cur_episode_id].template.displayName&&(i.component_name=o.USC_BADGES_TEMPLATE,"Link"===i._type&&(i.display_title.match(/ACTIVITY/)&&(i.display_description=i.display_description+'<div class="uscWindowFgOnly">Remember! You need to complete this activity to earn a Friends of USC Scholars badge. (When you’re finished - Come back to this page and click <b>Continue</b>).<br><br>If you’d rather <b>not</b> do the activity, clicking Continue will take you back to the micro-lesson and you can decide where you want to go from there.</div>'),i.display_title.match(/Haven't Registered/)&&(i.styles=i.styles?i.styles:[],i.styles.push("uscHackOnlyGuests"),i.uscReviewModeHack="uscHackOnlyGuests"),i.display_title.match(/Connect with/)&&(i.styles=i.styles?i.styles:[],i.styles.push("uscHackOnlyBadge"),i.uscReviewModeHack="uscHackOnlyBadge"))),i.isContent=!1,i.isTranscript=!1,i.mixedContent=!1,i.targetTop=!1,i.isVideoUrl=!1,i.layouts?(i.layoutCss=i.layouts[0],("inline"===i.layouts[0]||i.layouts[0].match(/sidebar/)||i.layouts[0].match(/burst/))&&(i.isContent=!0)):i.isContent=!0,c(i)&&(i.isTranscript=!0);var a="https"===t.protocol();"Link"===i._type&&i.url&&i.url.match(/^http:\/\//)&&a&&(i.mixedContent=!0,i.showInlineDetail=!1),"Link"===i._type&&s.isVideoUrl(i.url)&&(i.isVideoUrl=!0),"Link"===i._type&&i.url&&/mailto/.test(i.url)&&(i.target="_blank")}switch(i.producerItemType||("Scene"===i._type?i.producerItemType="scene":"Annotation"===i._type?i.component_name===o.TRANSCRIPT_TEMPLATE?i.producerItemType="transcript":i.producerItemType="annotation":"Upload"===i._type?i.component_name===o.FILE_TEMPLATE?i.producerItemType="file":i.producerItemType="image":"Link"===i._type?i.component_name&&i.component_name.match(/video/)?i.producerItemType="video":i.producerItemType="link":"Plugin"===i._type?i.component_name&&i.component_name.match(/question/)&&(i.producerItemType="question"):"Chapter"===i._type&&(i.producerItemType="chapter"),i.producerItemType),i.producerItemType){case"chapter":i.isContent=!1;break;case"annotation":i.isPq=i.isHeader=i.isLongText=i.isDef=!1,i.component_name===o.PULLQUOTE_TEMPLATE&&(i.isPq=!0),/header-two|header-one/.test(i.component_name)&&(i.isHeader=!0),i.component_name===o.TEXT_TRANSMEDIA_TEMPLATE&&(i.isLongText=!0),i.component_name===o.TEXT_DEFINITION_TEMPLATE&&(i.isDef=!0)}return i.displayStartTime=e("asTime")(i.start_time),i};var d=function(e){var t=a.lang?a.lang:"en";return angular.forEach(["title","annotator","annotation","description","name"],function(i){e[i]&&("string"==typeof e[i]?e["display_"+i]=e[i]:e[i][t]?e["display_"+i]=e[i][t]:e["display_"+i]=e[i].en)}),e};l.setLanguageStrings=function(){angular.forEach(l.events,function(e){e=d(e)}),angular.forEach(l.episodes,function(e){e=d(e)}),angular.forEach(l.containers,function(e){e=d(e)})},l.resolveEpisodeEvents=function(e){var t=[],n=[],a=[],r=l.episodes[e];angular.forEach(l.events,function(i){i.cur_episode_id===e&&("Scene"===i._type?t.push(i):"Chapter"===i._type?(a.push(i),n.push(i)):n.push(i))});var s={};angular.forEach(n,function(e){if("Annotation"===e._type&&!0===e.chapter_marker&&a.push(e),"Annotation"===e._type&&e.annotator){var t=r.defaultLanguage||"en",i=e.annotator[t];void 0===i&&(i=e.annotator[Object.keys(e.annotator).sort()[0]]),s[i]?(s[i].name=angular.extend(s[i].name,e.annotator),s[i].annotation_image_id||(s[i].annotation_image_id=e.annotation_image_id)):s[i]={name:e.annotator,annotation_image_id:e.annotation_image_id};for(var n=Object.keys(s[i].name).sort(),o=s[i].name[t]||"(untranslated)",l=0;l<n.length;l++)n[l]!==t&&(o=o+" / "+s[i].name[n[l]]);s[i].key=o}}),r.annotators=s,r.chapters=a;var d=0;r.masterAsset&&(d=r.masterAsset.duration,angular.forEach(r.scenes,function(e){e.start_time>d&&(e.start_time=d-.2)})),r.scenes=t.sort(function(e,t){return e._id.indexOf("internal:start")>-1||t._id.indexOf("internal:end")>-1?-1:t._id.indexOf("internal:start")>-1||e._id.indexOf("internal:end")>-1?1:e.start_time-t.start_time}),r.chapters=a.sort(function(e,t){return e.start_time-t.start_time}),angular.forEach(n,function(e){d>0&&e.start_time>d-.11&&(e.start_time=d-.2,e.end_time=d-.1),e.start_time<.01&&(e.start_time=.01,e.end_time<.01&&(e.end_time=.01)),e.start_time>e.end_time&&(e.end_time=e.start_time)}),r.items=_sortItems(n);for(var p=1,m=r.scenes.length;p<m;p++)p===m-1?0!==d&&(r.scenes[p].end_time=d):r.scenes[p].end_time=r.scenes[p+1].start_time;for(var v=0,g=t.length;v<g;v++){for(var h=t[v],f=[],y={},_=0,S=n.length;_<S;_++){var b=n[_];b.start_time>=h.start_time&&b.start_time<h.end_time&&(c(b)&&(y.end_time===h.end_time&&(y.end_time=b.start_time),y=b),b.end_time<=h.end_time?(l.events[b._id].scene_id=h._id,f.push(b)):h.end_time-.25<b.start_time&&v!==g-1?b.start_time=h.end_time:(b.end_time=h.end_time,b.scene_id=h._id,f.push(b)))}l.events[h._id].items=_sortItems(f)}return r.styleCss=u(r),r.templateCss=r.styleCss,r instanceof P&&r.template.pro_episode_template&&(r.templateCss="professional "+r.templateCss),r.template&&"Wiley"===r.template.displayName&&(r.templateCss+=" wiley-endscreentext "),angular.forEach(l.events,function(t){if(t.cur_episode_id===e){t.styleCss=u(t);var n,a=t.component_name===o.IMAGE_PLAIN_TEMPLATE,s=t.component_name===o.IMAGE_INLINE_WITHTEXT_TEMPLATE,c=t.component_name===o.SLIDING_CAPTION,d=t.component_name===o.IMAGE_THUMBNAIL_TEMPLATE,p=t.component_name===o.IMAGE_FILL_TEMPLATE,m=t.component_name===o.TEXT_TRANSMEDIA_TEMPLATE,v=t.component_name===o.TEXT_DEFINITION_TEMPLATE,g=t.component_name===o.HEADER_ONE_TEMPLATE,h=t.component_name===o.HEADER_TWO_TEMPLATE,f=t.component_name===o.PULLQUOTE_TEMPLATE,y=["highlightSolid","highlightBorder","highlightSide","highlightBloom","highlightTilt","highlightNone"],_=["transitionFade","transitionPop","transitionNone","transitionSlideL","transitionSlideR"];"Scene"!==t._type&&(n=l.scene(t.scene_id),-1!==r.styles.indexOf("timestampNone")||-1!==r.styles.indexOf("timestampInline")||i.existy(n)&&i.existy(n.styles)&&(-1!==n.styles.indexOf("timestampNone")||-1!==n.styles.indexOf("timestampInline"))||(a||m||v)&&(!i.existy(t.styles)||-1===t.styles.indexOf("timestampInline")&&-1===t.styles.indexOf("timestampNone"))&&(t.styleCss+=" timestampNone"),(g||h||f)&&(t.styleCss+=" timestampNone"),i.existy(t.layouts)&&-1!==t.layouts.indexOf("showCurrent")||0!==i.intersection(r.styles,y).length||i.existy(n)&&i.existy(n.styles)&&0!==i.intersection(n.styles,y).length||i.existy(t.styles)&&0!==i.intersection(t.styles,y).length||(t.styleCss+=" highlightSolid"),0!==i.intersection(r.styles,_).length||i.existy(n)&&i.existy(n.styles)&&0!==i.intersection(n.styles,_).length||i.existy(t.styles)&&0!==i.intersection(t.styles,_).length||(a||s||c||d||f||p?i.existy(t.layouts)&&-1===t.layouts.indexOf("videoOverlay")?t.styleCss+=" transitionPop":t.styleCss+=" transitionFade":t.styleCss+=" transitionSlideL")),t.layouts&&(t.styleCss=t.styleCss+" "+t.layouts.join(" ")),t.styleCss=t.styleCss.replace(/timestampInline/,"")}}),r},l.resolveEpisodeContainers=function(e){var t=l.episodes[e];t.parents=[],delete t.previousEpisodeContainer,delete t.nextEpisodeContainer,t.navigation_depth=0},l.episode=function(e){return l.episodes[e],l.episodes[e]},l.episodeEvents=function(e){var t=[];return angular.forEach(l.events,function(i){i.cur_episode_id===e&&t.push(i)}),t},l.isOnExistingSceneStart=isOnExistingSceneStart,l.getEpisodeScenes=getEpisodeScenes,l.sceneAtEpisodeTime=function(e,t){t=t||r.getMetaProp("time");for(var i=l.episodes[e].scenes,n=0;n<i.length;n++)if(i[n].start_time<=t&&i[n].end_time>t)return i[n]},l.scene=function(e){return l.events[e],l.events[e]};var u=function(e){var t={typography:!1,color:!1,highlight:!1,timestamp:!1,transition:!1},i=[];if(angular.forEach(e.styles,function(e){i.push(e),angular.forEach(t,function(i,n){0===e.indexOf(n)&&(t[n]=e)})}),e.scene_id){var n=l.events[e.scene_id].styles;angular.forEach(n,function(e){angular.forEach(t,function(n,a){t[a]||0!==e.indexOf(a)||(i.push(e),t[a]=e)})})}if(e.cur_episode_id){var a=l.episodes[e.cur_episode_id].styles;angular.forEach(a,function(e){angular.forEach(t,function(n,a){t[a]||0!==e.indexOf(a)||i.push(e)})})}if("Scene"!==e._type&&!e.isContent&&e.layouts&&e.layouts[0].match(/Bg/))for(var r=0;r<i.length;r++)i[r].match(/transition/)&&"transitionNone"!==i[r]&&(i[r]="transitionFade");return i.join(" ")};return l.assocEventWithAsset=assocEventWithAsset,l.resolveEpisodeAssets=function(e){if(angular.forEach(l.events,function(t){if(t.cur_episode_id===e){var i=t.asset_id||t.link_image_id||t.annotation_image_id;i&&l.assets[i]&&(l.events[t._id].asset=l.assets[i])}}),l.episodes[e]){var t=l.episodes[e].master_asset_id;t&&l.assets[t]&&(l.episodes[e].masterAsset=l.assets[t]);var i=l.episodes[e].poster_frame_id;i&&l.assets[i]&&(l.episodes[e].poster=l.assets[i])}},l.addLandingScreen=function(e){l.events["internal:landingscreen:"+e]=createInstance("Scene",{_id:"internal:landingscreen:"+e,_type:"Scene",_internal:!0,cur_episode_id:e,episode_id:e,start_time:-.01,end_time:.01,component_name:o.LANDINGSCREEN_TEMPLATE})},l.addEndingScreen=function(e){var t=l.episodes[e];if(t&&t.scenes&&t.masterAsset){t.scenes=t.scenes.sort(function(e,t){return e.start_time-t.start_time});var i=t.scenes[t.scenes.length-1];if(!i._id.match(/internal:endingscreen/)){var n=parseFloat(t.masterAsset.duration);i.end_time=n-.1,angular.forEach(i.items,function(e){e.end_time>n-.1&&(e.end_time=n-.1)}),l.events["internal:endingscreen:"+e]=createInstance("Scene",{_id:"internal:endingscreen:"+e,_type:"Scene",_internal:!0,cur_episode_id:e,start_time:n-.1,end_time:n,component_name:o.ENDINGSCREEN_TEMPLATE}),l.events["internal:endingscreen:"+e]=d(l.events["internal:endingscreen:"+e]),l.resolveEpisodeEvents(e)}}},l.isTranscoded=function(e){return e.mediaSrcArr.length>0},n.debugInBrowser,l}function selectService_selectService(e,t,i,n){function _setVisibility(e,t){c[e]=t}function _partialVis(e){return function(t){return _setVisibility(e,t)}}function _setAvailableImageOptsForLayout(e,t,i){var n="inline"===t.layouts[0];switch(-1!==t.layouts.indexOf("videoOverlay")&&(b(!1),i.position="fill"),e){case"centeredPro":h(!0),f(!0),l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!1},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!0},{value:"mainFg",name:u.textFg,isDisabled:!0},{value:"altBg",name:u.transmediaBg,isDisabled:!0},{value:"altFg",name:u.transmediaFg,isDisabled:!0}],n&&(t.layouts=["windowBg"]),t.layouts=t.layouts||["windowBg"],i.position=i.position||"fill";break;case"1col":case"centered":var r=a("admin");h(!0),l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!1},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!r},{value:"mainFg",name:u.textFg,isDisabled:!r},{value:"altBg",name:u.transmediaBg,isDisabled:!0},{value:"altFg",name:u.transmediaFg,isDisabled:!0}],n&&(t.layouts=["windowBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["windowBg"];break;case"mirroredTwoCol":h(!0),l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!1},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!1},{value:"mainFg",name:u.textFg,isDisabled:!1},{value:"altBg",name:u.transmediaBg,isDisabled:!1},{value:"altFg",name:u.transmediaFg,isDisabled:!1}],n&&(t.layouts=["mainBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["mainBg"];break;case"cornerV":case"centerVV":case"cornerH":h(!0),l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!1},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!1},{value:"mainFg",name:u.textFg,isDisabled:!1},{value:"altBg",name:u.transmediaBg,isDisabled:!1},{value:"altFg",name:u.transmediaFg,isDisabled:!1}],n&&(t.layouts=["altBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["altBg"];break;case"pip":h(!0),l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!0},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!0},{value:"mainFg",name:u.textFg,isDisabled:!0},{value:"altBg",name:u.transmediaBg,isDisabled:!1},{value:"altFg",name:u.transmediaFg,isDisabled:!1}],n&&(t.layouts=["altBg"]),i.position=i.position||"fill",t.layouts=t.layouts||["altBg"];break;case"centerVVMondrian":l.display=[{value:"windowBg",name:u.windowBg,isDisabled:!0},{value:"videoOverlay",name:u.videoOverlay,isDisabled:!1},{value:"mainBg",name:u.textBg,isDisabled:!1},{value:"mainFg",name:u.textFg,isDisabled:!1},{value:"altBg",name:u.transmediaBg,isDisabled:!0},{value:"altFg",name:u.transmediaFg,isDisabled:!0}],n&&(t.layouts=["mainBg"]),t.layouts=t.layouts||["mainBg"],i.position=i.position||"fill"}i.position&&(t.styles=[i.position])}function getSceneName(e){return Object.keys(d).filter(function(t){return d[t]===e.component_name})[0]}function getSelectOpts(e){return l[e]}function getVisibility(e){return c[e]}function setupItemForm(e,t){var i={transition:"",highlight:"",color:"",typography:"",timestamp:""},n={position:""};if("item"===t&&(i=angular.extend(n,i)),!r(e))return i;for(var a in i)for(var s=0;s<e.length;s++)e[s].substr(0,a.length)===a&&(i[a]=e[s].substr(a.length));if("episode"===t)return i;for(var o=0;o<e.length;o++)"contain"!==e[o]&&"cover"!==e[o]&&"center"!==e[o]&&"fill"!==e[o]&&"tl"!==e[o]&&"tr"!==e[o]&&"bl"!==e[o]&&"br"!==e[o]||(i.position=e[o]);return i}function getTemplates(e,n){var r=function(e){return e.reduce(function(e,i){var n=t.readDataCache("template","component_name",i.component_name);return null!=n&&(Object.assign(i,{template_id:n.id,name:n.displayName}),e.push(i)),e},[])};switch(e){case"episode":var s=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0};return y(!0),i.getEpisodeTemplatesByCustomerIds(n).sort(s);case"scene":h(!1),f(!1),S(!0),b(!1);return r([{component_name:d.centered},{component_name:d.centeredPro},{component_name:d["1col"]},{component_name:d.cornerV},{component_name:d.mirroredTwoCol},{component_name:d.centerVV},{component_name:d.centerVVMondrian},{component_name:d.cornerH},{component_name:d.pip}]);case"transcript":return _(!0),S(!0),b(!1),r([{component_name:o.TRANSCRIPT_TEMPLATE}]);case"annotation":_(!1),y(!1),S(!0),b(!1);return r([{component_name:o.HEADER_ONE_TEMPLATE},{component_name:o.HEADER_TWO_TEMPLATE},{component_name:o.PULLQUOTE_TEMPLATE},{component_name:o.TEXT_TRANSMEDIA_TEMPLATE},{component_name:o.TEXT_DEFINITION_TEMPLATE}]);case"link":h(!0),f(!1),g(!0),y(!0),S(!0),b(!1);var l=[{component_name:o.LINK_TEMPLATE},{component_name:o.LINK_WITHIMAGE_NOTITLE_TEMPLATE},{component_name:o.LINK_MODAL_THUMB_TEMPLATE},{component_name:o.LINK_EMBED_TEMPLATE}];return a("admin")&&l.splice(3,0,{component_name:o.LINK_DESCRIPTION_FIRST_TEMPLATE}),r(l);case"image":g(!0),h(!1),f(!1),y(!0),S(!0),b(!1);return r([{component_name:o.IMAGE_PLAIN_TEMPLATE},{component_name:o.IMAGE_INLINE_WITHTEXT_TEMPLATE},{component_name:o.SLIDING_CAPTION},{component_name:o.IMAGE_THUMBNAIL_TEMPLATE},{component_name:o.IMAGE_FILL_TEMPLATE}]);case"file":return y(!0),S(!1),b(!1),r([{component_name:o.FILE_TEMPLATE}]);case"question":return h(!0),g(!0),y(!0),S(!0),b(!1),r([{component_name:o.QUESTION_TEMPLATE}]);case"chapter":y(!0)}}function onSelectChange(e,i){switch(h(!1),e.producerItemType){case"scene":var n="inline"===e.layouts[0];switch(e.component_name){case o.CENTERED_TEMPLATE:case o.CENTERED_PRO_TEMPLATE:f(!1),h(!1),e.layouts[0]="",e.layouts[1]=p.a.value;break;case o.CENTER_VV_TEMPLATE:case o.CENTER_VV_MONDRIAN_TEMPLATE:h(!1),f(!0),l.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],e.layouts[1]=p.a.value,(n||""===e.layouts[0])&&(e.layouts[0]="videoLeft");break;case o.CORNER_V_TEMPLATE:case o.CORNER_H_TEMPLATE:case o.PIP_TEMPLATE:h(!0),f(!0),l.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],l.display=[{value:p.a.value,name:p.a.name},{value:p.b.value,name:p.b.name}],(n||""===e.layouts[0])&&(e.layouts[0]="videoLeft",e.layouts[1]=p.a.value);break;case o.MIRRORED_TWOCOL_TEMPLATE:h(!0),f(!0),l.video=[{value:"videoLeft",name:"Video on Left"},{value:"videoRight",name:"Video on Right"}],l.display=[{value:m.a.value,name:m.a.name},{value:m.b.value,name:m.b.name}],(n||""===e.layouts[0])&&(e.layouts[0]="videoLeft",e.layouts[1]=m.b.value);break;case o.ONECOL_TEMPLATE:h(!0),f(!1),l.display=[{value:v.a.value,name:v.a.name},{value:v.b.value,name:v.b.name}],e.layouts[0]="",n&&(e.layouts[1]=v.b.value)}break;case"link":switch(h(!0),g(!0),S(!0),!0===e.stop?(e.layouts[0]="windowFg",e.component_name===o.LINK_MODAL_THUMB_TEMPLATE&&(e.component_name=o.LINK_EMBED_TEMPLATE)):e.layouts[0]="inline",e.component_name){case o.LINK_TEMPLATE:case o.LINK_WITHIMAGE_NOTITLE_TEMPLATE:case o.LINK_MODAL_THUMB_TEMPLATE:g(!0);break;case o.LINK_DESCRIPTION_FIRST_TEMPLATE:case o.LINK_EMBED_TEMPLATE:g(!1)}break;case"transcript":h(!1),e.layouts[0]="inline";break;case"annotation":switch(e.layouts[0]="inline",e.component_name){case o.HEADER_ONE_TEMPLATE:case o.HEADER_TWO_TEMPLATE:_(!1),y(!1);break;case o.PULLQUOTE_TEMPLATE:_(!0),y(!1);break;case o.TEXT_TRANSMEDIA_TEMPLATE:case o.TEXT_DEFINITION_TEMPLATE:_(!1),y(!0)}!0===e.stop&&(e.layouts[0]="windowFg");break;case"question":l.questionType=[{value:"mc-poll",name:"Poll"},{value:"mc-formative",name:"Formative"}],e.layouts[0]="windowFg",e.stop=!0;break;case"image":h(!1);var a=getSceneName(t.scene(e.scene_id));switch(e.component_name){case o.IMAGE_PLAIN_TEMPLATE:case o.IMAGE_INLINE_WITHTEXT_TEMPLATE:case o.SLIDING_CAPTION:case o.IMAGE_THUMBNAIL_TEMPLATE:i.pin=i.position="",e.layouts[0]="inline";break;case o.IMAGE_FILL_TEMPLATE:e.cosmetic=!0,h(!0),b(!0),l.imagePosition=[{value:"fill",name:"Fill and stretch"},{value:"contain",name:"Contain"},{value:"cover",name:"Cover and crop"},{value:"tl",name:"Top Left"},{value:"tr",name:"Top Right"},{value:"bl",name:"Bottom Left"},{value:"br",name:"Bottom Right"}],_setAvailableImageOptsForLayout(a,e,i)}!0===e.stop&&(e.layouts[0]="windowFg");break;case"file":switch(e.showInlineDetail=!1,e.component_name){case o.LINK_TEMPLATE:e.showInlineDetail=!0;break;case o.FILE_TEMPLATE:case o.LINK_DESCRIPTION_FIRST_TEMPLATE:case o.LINK_MODAL_THUMB_TEMPLATE:}!0===e.stop&&(e.layouts[0]="windowFg")}}function showTab(e,t){switch(e){case"scene":switch(t){case"Item":return!1;case"Style":return!0;case"Customize":return a("admin")}break;case"transcript":case"annotation":case"link":case"image":case"file":case"question":switch(t){case"Item":return!0;case"Style":return!1;case"Customize":return a("admin")}break;case"chapter":switch(t){case"Item":return!0;case"Style":case"Customize":return!1}}}var a=e.userHasRole,r=n.existy,s=[{value:"en",name:"English",isDisabled:!1},{value:"es",name:"Spanish",isDisabled:!1},{value:"zh",name:"Chinese",isDisabled:!1},{value:"pt",name:"Portuguese",isDisabled:!1},{value:"fr",name:"French",isDisabled:!1},{value:"de",name:"German",isDisabled:!1},{value:"it",name:"Italian",isDisabled:!1}],l={video:[],display:[],imagePosition:[],imagePin:[],questionType:[],language:s},c={templateSelect:!0,imageUpload:!1,display:!1,videoPosition:!1,bgImagePosition:!1,titleField:!0,speakerField:!0},d={centered:o.CENTERED_TEMPLATE,centeredPro:o.CENTERED_PRO_TEMPLATE,"1col":o.ONECOL_TEMPLATE,mirroredTwoCol:o.MIRRORED_TWOCOL_TEMPLATE,cornerV:o.CORNER_V_TEMPLATE,centerVV:o.CENTER_VV_TEMPLATE,centerVVMondrian:o.CENTER_VV_MONDRIAN_TEMPLATE,cornerH:o.CORNER_H_TEMPLATE,pip:o.PIP_TEMPLATE},u={windowBg:"Full window background",videoOverlay:"Video overlay (16:9)",textBg:"Text pane background",textFg:"Text pane foreground",transmediaBg:"Transmedia pane background",transmediaFg:"Transmedia pane foreground"},p={a:{value:"showCurrent",name:"show only current transmedia items"},b:{value:"",name:"Show all transmedia items, highlight current ones"}},m={a:{value:"showCurrent",name:"Show only current text items"},b:{value:"",name:"Show all text items, highlight current ones"}},v={a:{value:"showCurrent",name:"Show only current items"},b:{value:"",name:"Show all items, highlight current ones"}},g=_partialVis("imageUpload"),h=_partialVis("display"),f=_partialVis("videoPosition"),y=_partialVis("titleField"),_=_partialVis("speakerField"),S=_partialVis("templateSelect"),b=_partialVis("bgImagePosition");return{showTab:showTab,onSelectChange:onSelectChange,getTemplates:getTemplates,getVisibility:getVisibility,getSelectOpts:getSelectOpts,setupItemForm:setupItemForm,getSceneName:getSceneName}}function ittNarrativeTimeline(){return{restrict:"A",replace:!0,template:Rt.a,controller:Vt}}function ittPlayerContainer(){return{template:jt.a,controller:"PlayerController"}}function PlayerController(e,t,i,n,a,r,s,o,l,c,u,p,m,v,g){function calcNewWindowUrl(){var e=s.narrativeId||s.episodeId,t=s.timelineId;return l.mainVideoNewWindowUrl(s.user.access_token,e,t,v.getMetaProp("time"))}function iframeIOSOverlayHandler(){window.open(calcNewWindowUrl())}e.episodeTheme=g,e.viewMode=function(t){s.viewMode=t,u.captureEpisodeActivity("modeChange",{mode:t}),s.producerEditLayer=0,"review"===t?(a(function(){i.$emit(d)}),s.autoscroll=!0,s.autoscrollBlocked=!1,C(),a(k)):s.autoscroll=!1,"watch"===t&&e.endSearch(),a(function(){$(window).trigger("resize")})},n.viewMode&&a(function(){e.viewMode(n.viewMode)}),e.toggleProducerPreview=function(){s.product="producer"===s.product?"player":"producer"},n.epId?(s.init(),s.episodeId=n.epId):e.narrativeId=n.narrativeId,s.isFramed&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)<151&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:"650px"}),"*");var h=function(){if(s.isFramed&&-1!==l.episodes[s.episodeId].template.displayName.indexOf("Wiley")){var t=!0;try{localStorage.setItem("iCanHazStorage",1)}catch(e){t=!1}if(t&&localStorage.removeItem("iCanHazStorage"),t&&!localStorage.getItem("noWileyNag")){s.show.wileyNag=!0;var i=e.$watch(function(){return v.getMetaProp("time")},function(e){e&&(s.show.wileyNag=!1,i())})}e.noWileyNag=function(){s.show.wileyNag=!1,localStorage.setItem("noWileyNag","1")}}},f=i.$on("dataSvc.getEpisode.done",function(){s.lang=n.lang?n.lang.toLowerCase():l.episodes[s.episodeId].defaultLanguage,l.setLanguageStrings(),h(),document.title=l.episodes[s.episodeId].display_title;var t=l.episodes[s.episodeId].container_id;o.getContainer(t,s.episodeId).then(function(){if(l.episodes[s.episodeId].master_asset_id)var n=e.$watch(function(){return l.assets[l.episodes[s.episodeId].master_asset_id]},function(t){t&&Object.keys(t).length>1&&(n(),l.addEndingScreen(s.episodeId),c.init(s.episodeId),e.loading=!1,i.$emit(d))});else{if(e.loading=!1,"producer"===s.product){s.editEpisode=l.episodes[s.episodeId];var a=l.containers[t].customer_id;s.editEpisode.templateOpts=m.getTemplates("episode",[a])}s.videoControlsActive=!0,s.videoControlsLocked=!0}"producer"!==s.productLoadedAs||p.userHasRole("admin")||p.userHasRole("customer admin")||(s.product="player",s.productLoadedAs="player")})});l.episodes[s.episodeId]?(s.lang=n.lang?n.lang.toLowerCase():l.episodes[s.episodeId].defaultLanguage,document.title=l.episodes[s.episodeId].display_title,l.episodes[s.episodeId].master_asset_id?c.init(s.episodeId):("producer"===s.product&&(s.editEpisode=l.episodes[s.episodeId]),s.videoControlsActive=!0,s.videoControlsLocked=!0),"producer"!==s.productLoadedAs||p.userHasRole("admin")||p.userHasRole("customer admin")||(s.product="player",s.productLoadedAs="player")):(e.loading=!0,l.addLandingScreen(s.episodeId),o.getEpisode(s.episodeId,s.episodeSegmentId)),e.appState=s,e.playbackService=v,e.show=s.show,e.now=new Date,e.showIframeIOSOverlay=s.isIframedIOS(),e.iframeIOSOverlayHandler=iframeIOSOverlayHandler,e.calcNewWindowUrl=calcNewWindowUrl,s.videoControlsActive=!1;var y,_=e.$watch(function(){return s.videoControlsActive},function(e){e&&(a.cancel(y),y=a(function(){s.videoControlsActive=!1},5e3))});e.showControls=function(){a.cancel(y),s.videoControlsActive=!0,s.isTouchDevice&&e.allowControlsExit()},e.allowControlsExit=function(){a.cancel(y),y=a(function(){s.videoControlsLocked||(s.videoControlsActive=!1)},5e3)},e.toggleSearchPanel=function(){s.show.searchPanel=!s.show.searchPanel,s.windowWidth<480?e.viewMode("review"):e.viewMode(s.show.searchPanel?"review":"discover"),s.searchText="",s.show.searchPanel&&a(function(){document.getElementById("searchtext").focus()})},e.endSearch=function(){s.searchText="",s.show.searchPanel=!1},e.toggleNavPanel=function(){c.pause(),s.show.navPanel=!s.show.navPanel},e.seek=function(e){c.seek(e,"sceneMenu"),s.show.navPanel=!1},e.pause=function(){c.pause()};var S=i.$on("video.firstPlay",function(){c.play()});e.hidePanel=function(e){s.show[e]=!1},e.hidePanels=function(){s.show.navPanel=!1,s.show.profilePanel=!1,s.itemDetail=!1,i.$emit("player.dismissAllPanels")},e.play=function(){c.play()},e.continue=function(){l.episodes[s.episodeId].masterAsset.duration-v.getMetaProp("time")<.2?(c.pause(),c.seek(l.episodes[s.episodeId].masterAsset.duration-.01)):c.play()},e.userHasRole=p.userHasRole,e.logout=p.logout,e.isTrueGuest=p.isTrueGuest,s.isTouchDevice&&"review"===s.viewMode&&(s.autoscroll=!0);var b=$(window),T=$("html,body"),E=!1,C=function(){E||(E=r(k,400),b.bind("scroll",function(){T.stop(),w(),s.autoscrollBlocked=!0}))},w=function(){b.unbind("scroll"),r.cancel(E),E=!1};e.enableAutoscroll=function(){s.autoscrollBlocked&&(s.autoscrollBlocked=!1,C())};var k=function(){if(!s.autoscrollBlocked&&s.autoscroll){var e=1/0,t=b.scrollTop();if(angular.forEach($(".isCurrent:visible"),function(i){var n=i.getBoundingClientRect().top+t;n<e&&(e=n)}),e!==1/0){e>t+180&&e-t<document.documentElement.clientHeight-180||e<180&&t<180||(w(),T.animate({scrollTop:e-180},1500),a(function(){C()},1750))}}};C();var I=i.$on("userKeypress.ESC",e.hidePanels);e.$on("$destroy",function(){_(),f(),S(),I()})}function ittSearchPanel(e){return{restrict:"A",replace:!0,scope:!0,template:qt.a,controller:"SearchPanelController",link:function(t){t.appState=e,t.indexEvents()}}}function SearchPanelController(e,t,i,n){e.sortBy="startTime",e.toggleSortBy=function(t){e.sortBy=a(t),n.autoscroll="startTime"===e.sortBy},e.getToggledValue=function(e){return a(e)};var a=function(e){return"startTime"===e?"type":"startTime"};e.getFriendlySortText=function(e){return"startTime"===e?"time":"type"},e.indexed=!1,e.indexEvents=function(){if(!e.episode.items)return i(function(){e.indexEvents()},300),!1;e.indexed=!0,e.typeCategories=["transcript","annotation","file","image","link","video","question","other"],e.showTypes={transcript:{name:"Transcript",items:[]},annotation:{name:"Annotations",items:[]},file:{name:"Files",items:[]},image:{name:"Images",items:[]},link:{name:"Links",items:[]},video:{name:"Videos",items:[]},question:{name:"Questions",items:[]},other:{name:"Other",items:[]}},angular.forEach(e.episode.items,function(t){"producer"!==n.product&&t.cosmetic||"Scene"!==t._type&&(t.producerItemType&&e.showTypes[t.producerItemType]?e.showTypes[t.producerItemType].items.push(t):e.showTypes.other.items.push(t),"annotation"===t.producerItemType&&(t.showAsHeader=!t.component_name.match(/(transmedia|definition)/)))})},t.$on("searchReindexNeeded",e.indexEvents)}function ittTab(){return{template:'<div ng-show="selected"><ng-transclude></ng-transclude></div>',require:"^^ittTabs",transclude:!0,scope:{title:"@"},link:function(e,t,i,n){n.addPane(e)}}}function ittTabs(){return{template:['<div class="">','\t<ul class="nav nav-tabs">','\t\t<li ng-repeat="pane in panes" class="tab-pane"><p class="ittTabLabel" ng-class="{cur:pane.selected}" ng-click="select(pane)">{{pane.title}}</p></li>',"\t</ul>",'\t<div class="tab-content"><ng-transclude></ng-transclude></div>',"</div>"].join(""),transclude:!0,restrict:"EA",scope:{},controller:["$scope",function(e){function select(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0}var t=e.panes=[];e.select=select,this.addPane=function(e){0===t.length&&select(e),t.push(e)}}]}}function ittVolumeSlider(e){return{restrict:"E",scope:!0,template:'<div ng-focus="showControls()" role="slider" aria-label="volume" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{currentVolume()}}" aria-valuetext="{{currentVolume()}}" tabindex="0" class="volumebar" ng-mousedown="userChangingVolume($event)" ng-keydown="onVolumeKeyDown($event)" aria-labelledby="volumeControlDescription"> <div class="volume" ng-style="{width: currentVolume()+\'%\'}"></div> <div id="volumeControlDescription" class="screen-reader-offscreen"> Use left and right arrows to increase or decrease the volume by 1. Use page up and page down to increase or decrease the volume by 10. Use home and end to move to the volume to the lowest and highest setting.  </div> ',multiElement:!1,link:function(t){function adjustHigh(e){return e>98?100:e}function adjustLow(e){return e<3?0:e}function incrementVolume(e){var i=t.currentVolume()+e;i=adjustHigh(i),"function"==typeof t.setVolume&&t.setVolume(i)}function decrementVolume(e){var i=t.currentVolume()-e;i=adjustLow(i),"function"==typeof t.setVolume&&t.setVolume(i)}t.userChangingVolume=function(e){var i=angular.element(e.currentTarget),n=function(e,n){var a=(e.clientX-i.offset().left)/i.width()*100;a>98&&(a=100),a<3&&(a=0),n?t.setVolume(a):t.$apply(t.setVolume(a))};n(e,!0),i.bind("mousemove.volume",n),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),i.unbind("mousemove.volume")})};var i={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};t.onVolumeKeyDown=function(e){var t=e,n=!0;switch(t.keyCode){case i.LEFTARROW:decrementVolume(1),n=!1;break;case i.RIGHTARROW:case i.UPARROW:incrementVolume(1),n=!1;break;case i.DOWNARROW:decrementVolume(1),n=!1;break;case i.PAGEUP:incrementVolume(10),n=!1;break;case i.PAGEDOWN:decrementVolume(10),n=!1;break;case i.HOME:decrementVolume(100),n=!1;break;case i.END:incrementVolume(100),n=!1;break;default:n=!0}n||(e.stopPropagation(),e.preventDefault())},t.currentVolume=function(){return e.getMetaProp("muted")?0:e.getMetaProp("volume")}}}}function ittShowHideVisualOnly(e){return{restrict:"A",multiElement:!0,link:function(t,i,n){t.$watch(n.ittShowHideVisualOnly,function(t){t?e.removeClass(i,"visual-hide"):e.addClass(i,"visual-hide")})}}}function visualHideAnimation(){return{addClass:function(e){e.fadeTo("slow",0,function(){})},removeClass:function(e){e.fadeTo("slow",1,function(){})}}}function ittWidthWatch(){return{restrict:"A",replace:!1,link:function(e,t){var i=e.$watch(function(){return t.width()},function(t){e.isNarrow=t<450});e.$on("$destroy",i)}}}function EditController(e,t,i,n,a,r,s,l,c,d,u,p,m,v){function onFormativeChecked(t){angular.forEach(e.item.data._plugin.distractors,function(e){e!==t&&(e.correct=void 0)})}function updateEpisodeTemplate(t){v.updateEpisodeTemplate(t.episode,t.templateId).then(function(t){return e.episode=t})}e.uneditedScene=angular.copy(e.item),e.userHasRole=d.userHasRole,e.canAccess=d.userHasRole("admin")||d.userHasRole("customer admin"),e.selectService=a,e.item&&u[e.item.producerItemType]?e.mimes=u[e.item.producerItemType]:e.mimes=u.default,e.chooseAsset=function(i){i=i||"",e.showAssetPicker=!0,e.w1=t.$on("UserSelectedAsset",function(t,n){"Poster"===i?e.attachPosterAsset(n):e.attachChosenAsset(n),e["showUploadButtons"+i]=!1,e.endChooseAsset()}),e.w2=t.$on("userKeypress.ESC",e.endChooseAsset)},e.endChooseAsset=function(){e.w1(),e.w2(),e.showAssetPicker=!1},e.toggleUpload=function(t){t=t||"",e["showUploadField"+t]=!e["showUploadField"+t]},e.addDistractor=function(){e.item.data._plugin.distractors.push({text:"",index:e.item.data._plugin.distractors.length+1})},e.onFormativeChecked=onFormativeChecked,e.addEvent=function(i){if("scene"===i){var n=Math.round(100*p.getMetaProp("time"))/100;if(l.isOnExistingSceneStart(n))return e.editCurrentScene(n)}var s=P(i);s.cur_episode_id=r.episodeId,s.episode_id=r.episodeId,r.user&&r.user.avatar_id&&(s.avatar_id=r.user.avatar_id),l.cache("event",s),r.editEvent=l.events["internal:editing"],r.videoControlsActive=!0,r.videoControlsLocked=!0,l.resolveEpisodeEvents(r.episodeId),c.injectEvents([l.events["internal:editing"]]),"scene"===i&&(a.onSelectChange(r.editEvent),c.updateSceneTimes(r.episodeId)),t.$emit("searchReindexNeeded")};var g=function(e){return"Annotation"===e._type&&e.component_name===o.TRANSCRIPT_TEMPLATE},h=function(){var e=l.episodes[r.episodeId];return angular.copy(e.items).filter(g)},f=function(e,t){for(var i=0,n=0,a=e.length;n<a;n++)if(e[n]._id===t._id){i=n;break}return i},y=function(e,t){e=e.sort(I);var i=f(e,t),n=[];return 0===i?n:(i<e.length-1&&i>=1&&(T(e[i-1])||n.push(e[i-1])),n)},_=function(e,t){e=e.sort(I);var i=f(e,t),n=[];return 0===i?i<e.length-1&&(T(e[i+1])||n.push(e[i+1])):i<e.length-1&&(T(e[i+1])||n.push(e[i+1]),i>=1&&(T(e[i-1])||n.push(e[i-1]))),n},S=function(e,t,i){if(g(e)){var n=[],a=h();switch(t){case"create":n=_(a,e);break;case"delete":n=y(a,e);break;case"update":i&&S(i,"delete"),S(e,"create")}angular.forEach(n,function(e){s.storeItem(e).then(function(){},function(e){})})}};e.saveEvent=function(){var i=angular.copy(r.editEvent);if(e.blockDoubleClicks=!0,i.cur_episode_id=r.episodeId,"Scene"===i._type){var n=x(i);angular.forEach(n,function(e){s.storeItem(e).then(function(){},function(e){})})}s.storeItem(i).then(function(e){e.cur_episode_id=r.episodeId;var n="update";if("internal:editing"===r.editEvent._id){c.removeEvent("internal:editing"),delete l.events["internal:editing"],l.cache("event",s.resolveIDs(e)),l.resolveEpisodeEvents(r.episodeId),n="create";var a=e.asset_id||e.link_image_id||e.annotation_image_id;a&&i.asset&&i.asset._id===a&&l.assocEventWithAsset(e._id,a)}"Scene"===e._type?(c.timelineEvents=[],c.injectEvents(l.episodeEvents(r.episodeId),0),l.episodes[r.episodeId].setCurrentScene(l.events[e._id])):(l.resolveEpisodeEvents(r.episodeId),c.updateEventTimes(l.events[e._id])),S(e,n),angular.forEach(i.removedAssets,function(e){s.deleteAsset(e)}),r.editEvent=!1,t.$emit("searchReindexNeeded")},function(e){})};var b=l.getEpisodeScenes,T=function(e){return e._id&&e._id.match(/internal/)};e.getItemsAfter=function(e,t){for(var i=[],n=0,a=e.length;n<a;n++)T(e[n])||(t<e[n].start_time||t<e[n].end_time)&&i.push(e[n]);return i};var E=function(e,t){for(var i=0;i<e.length;i++){if(void 0===e[i]._id||"internal:editing"===e[i]._id){e.splice(i,1);break}if(t&&e[i]._id===t._id){e[i]=t;break}}return e},C=function(e,t){for(var i=1,n=e.length;i<n;i++)i===n-1?e[i].end_time=t:e[i].end_time!==e[i+1].start_time&&(e[i].end_time=e[i+1].start_time)},w=function(e,t){for(var i=!1,n=0,a=e.length;n<a;n++)if(e[n]._id===t._id){i=!0;break}i||e.push(t)},k=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]._id===t){e.splice(i,1);break}},I=function(e,t){return e.start_time-t.start_time},x=function(t,i){var n=p.getMetaProp("duration"),a=angular.copy(b()),r=[];i?w(a,e.uneditedScene):E(a,e.uneditedScene),a=a.sort(I),C(a,n),k(a,t._id),i||a.push(t),a=a.sort(I);for(var s=1,o=a.length;s<o;s++)s===o-1?a[s].end_time!==n&&(a[s].end_time=n,r.push(a[s])):a[s].end_time!==a[s+1].start_time&&(a[s].end_time=a[s+1].start_time,r.push(a[s]));return r};e.editCurrentScene=function(e){var t=l.sceneAtEpisodeTime(r.episodeId,e);r.editEvent=l.events[t._id],r.editEvent.templateOpts=a.getTemplates("scene"),r.editEvent.cur_episode_id=r.episodeId,r.editEvent.episode_id=r.episodeId,r.editEvent.producerItemType="scene",r.videoControlsActive=!0,r.videoControlsLocked=!0,a.onSelectChange(r.editEvent)},e.editEpisode=function(){v.setEpisodeToEdit()},e.deleteEvent=function(e){if(window.confirm("Are you sure you wish to delete this item?")){var t={};t._id=e;var i=l.events[e]._type;if("Scene"===i){var n=x(t,!0);angular.forEach(n,function(e){s.storeItem(e).then(function(){},function(e){})})}s.deleteItem(e).then(function(){"sxs"===r.product&&l.events[e].asset&&s.deleteAsset(l.events[e].asset._id),c.removeEvent(e),delete l.events[e],l.resolveEpisodeEvents(r.episodeId),"Scene"!==i&&"Chapter"!==i||c.updateSceneTimes(r.episodeId),S(t,"delete"),r.editEvent=!1,r.videoControlsLocked=!1},function(e){})}},e.cancelEventEdit=function(e){var t=e.cur_episode_id?e.cur_episode_id:e.episode_id;"internal:editing"===r.editEvent._id?(delete l.events["internal:editing"],c.removeEvent("internal:editing")):(e.renderTemplate=!0,l.events[r.editEvent._id]=e),l.resolveEpisodeEvents(t),"Scene"===e._type?c.updateSceneTimes(t):c.updateEventTimes(e),r.editEvent=!1,r.videoControlsLocked=!1},e.cancelEpisodeEdit=function(e){l.episodes[r.episodeId]=e,l.deriveEpisode(l.episodes[e._id]),l.resolveEpisodeContainers(e._id),l.resolveEpisodeEvents(e._id),m.setTheme(e.template),r.editEpisode=!1,r.videoControlsLocked=!1};var P=function(e){var t={_id:"internal:editing",start_time:p.getMetaProp("time"),episode_id:r.episodeId,isCurrent:!0,producerItemType:e,layouts:["inline"],styles:[]},i=Object.create(null);if("scene"===e&&(i={_type:"Scene",title:{},description:{}}),"chapter"===e&&(i={_type:"Chapter",title:{},description:{}}),"video"===e&&(i={_type:"Link",link_image_id:"",url:"",title:{},description:{}}),"comment"!==e&&"transcript"!==e&&"annotation"!==e||(i={_type:"Annotation",annotation:{},annotator:{},annotation_image_id:""}),"file"!==e&&"image"!==e||(i={_type:"Upload",asset_id:"",title:{},description:{}}),"link"===e&&(i={_type:"Link",link_image_id:"",url:"https://",title:{},target:"_self",description:{},url_status:{}}),"question"===e&&(i={_type:"Plugin",title:{},data:{_pluginType:"question",_version:2,_plugin:{questiontext:"",questiontype:"mc-formative",distractors:[{index:1,text:""},{index:2,text:""},{index:3,text:""},{index:4,text:""}],correctfeedback:"",incorrectfeedback:""}}},i.plugin=i.data._plugin),"sxs"===r.product)i.sxs=!0,i.annotator={en:r.user.name},i.layouts=["windowFg"],i.end_time=r.time,i.stop=!0;else{var n={scene:o.CENTERED_TEMPLATE,transcript:o.TRANSCRIPT_TEMPLATE,annotation:o.HEADER_TWO_TEMPLATE,link:o.LINK_TEMPLATE,image:o.IMAGE_PLAIN_TEMPLATE,file:o.FILE_TEMPLATE,question:o.QUESTION_TEMPLATE,video:"TODO:VIDEO"},s=l.readDataCache("template","component_name",n[e]);i.templateOpts=a.getTemplates(e),i.template_id=s.id,i.component_name=n[e]}return angular.extend(t,i),createInstance(i._type,t)};e.updateEpisodeTemplate=updateEpisodeTemplate}function ittEpisode(){return{restrict:"EA",replace:!1,template:Xt,controller:Jt}}function ittEpisodeEditor(e,t,i,n,a,r,s,o,l,c,d){return{restrict:"A",replace:!0,scope:{episode:"=ittEpisodeEditor"},template:ei.a,controller:"EditController",link:function(c){function translationMessage(e){var t="",i=e.filter(function(e){return void 0==e.default||(t="Translate from "+e.code+" to: ",!1)}).map(function(e){return e=e.code}).join(", ");return t+i}function beginBackgroundTranslations(e){function handleSuccess(e){"Request for translations queued"===e.status?c.afterTranslationAttempt=e.status+", check back later!":c.afterTranslationAttempt="Something went wrong...",c.doCheckForTranslations=!0}function handleError(e){}a.beginBackgroundTranslations(e).then(handleSuccess).catch(handleError)}function waitForDuration(e,i,n){return function(a){"player ready"===a&&(o.unregisterStateChangeListener(waitForDuration),t(function(){e({duration:o.getMetaProp("duration","replaceMe"),url:i,type:n}),c.episode.swap={}},0))}}function createAssetFromTmp(e){var t=Object.create(null);t.content_type=e.type,t.duration=e.duration,t.url=e.url,t.name=c.episode.title,t.description=c.episode.description,a.createAsset(c.episodeContainerId,t).then(function(e){n.cache("asset",e),o.renamePid("replaceMe",e._id),c.attachChosenAsset(e._id)}).catch(function(e){})}function attachMediaSrc(e){var t,i=l.checkUrl(e),n=i.type;if(("wistia"!==n||r.userHasRole("admin"))&&n.length>0){t=i.mimeType,c.episode.replacingMasterAsset=!0,c.showmessage="Getting "+n+" video...";var a=l.parseInput(e);c.episode.swap={_id:"replaceMe",mediaSrcArr:[a]};var s=waitForDuration(createAssetFromTmp,a,t);o.registerStateChangeListener(s)}}function detachMasterAsset(){c.episode.masterAsset=null,i.editEpisode.masterAsset=null,i.editEpisode._master_asset_was_changed=!0,d.detatchMasterAsset(c.episode)}function saveEpisode(){d.saveEpisode(c.episode)}c.translationMessage=translationMessage,c.beginBackgroundTranslations=beginBackgroundTranslations,c.episodeContainerId=n.episodes[i.episodeId].container_id;var u=n.containers[c.episodeContainerId];c.customer=n.customers[u.customer_id],c.episode.master_asset_id&&""!==c.episode.master_asset_id&&(c.masterAsset=n.assets[c.episode.master_asset_id]),c.uploadStatus=[],c.uneditedEpisode=angular.copy(c.episode),c.itemForm=s.setupItemForm(c.episode.styles,"episode"),!r.userHasRole("admin")||c.masterAsset&&/video\/x-/.test(c.masterAsset.content_type)?c.masterAssetType="WebUrl":c.masterAssetType="Video",c.langForm={en:!0,es:!1,zh:!1,pt:!1,fr:!1,de:!1,it:!1};for(var p=0;p<c.episode.languages.length;p++)c.langForm[c.episode.languages[p].code]=!0;c.langForm[c.episode.defaultLanguage]=!0,c.languageWatcher=c.$watch(function(){return[c.langForm,c.episode.defaultLanguage]},function(){var e=0,t="",i=[];for(var n in c.langForm)c.langForm[n]?(e++,t=n,i.push({code:n})):c.episode.defaultLanguage===n&&(c.episode.defaultLanguage=!1);c.languageCount=e,!1===c.episode.defaultLanguage&&(c.episode.defaultLanguage=t),angular.forEach(i,function(e){e.code===c.episode.defaultLanguage&&(e.default=!0)}),c.episode.languages=angular.copy(i)},!0),c.watchStyleEdits=c.$watch(function(){return c.itemForm},function(){var e=[];for(var t in c.itemForm)c.itemForm[t]&&e.push(t+c.itemForm[t]);c.episode.styles=e,n.deriveEpisode(c.episode),n.resolveEpisodeEvents(c.episode._id)},!0),c.appState=i,c.watchEdits=c.$watchGroup(["episode.title[appState.lang]","episode.description[appState.lang]"],function(){n.deriveEpisode(c.episode),n.resolveEpisodeEvents(c.episode._id)}),c.dismissalWatcher=e.$on("player.dismissAllPanels",c.cancelEdit),c.cancelEdit=function(){c.cancelEpisodeEdit(c.uneditedEpisode)},c.attachChosenAsset=function(e){c.episode.replacingMasterAsset=!1;var t=n.assets[e],i=n.assets[c.episode.master_asset_id];if(c.showmessage="New video attached.",i&&t.duration<i.duration){c.getItemsAfter(c.episode.items.concat(c.episode.scenes),t.duration).length&&(c.showmessage="Warning: this new video is shorter than the current video and we've detected that some existing content items will be impacted. If you save this edit, these events will have their start and end times adjusted to the new episode end. (If this isn't what you want, choose a different video or hit 'cancel'.)")}c.episode._master_asset_was_changed=!0,c.episode.master_asset_id=t._id,c.masterAsset=t,c.episode.masterAsset=t,n.deriveEpisode(c.episode)},c.attachPosterAsset=function(e){var t=n.assets[e];c.episode.poster_frame_id=e,c.episode.poster=t,n.deriveEpisode(c.episode)},c.assetUploaded=function(e){c.showUploadButtons=!1,c.showUploadField=!1,c.attachChosenAsset(e)},c.posterUploaded=function(e){c.showUploadButtonsPoster=!1,c.showUploadFieldPoster=!1,c.attachPosterAsset(e)},c.attachMediaSrc=attachMediaSrc,c.replaceAsset=function(e){e=e||"",c["showUploadButtons"+e]=!0,c["showUploadField"+e]=!1},c.detachMasterAsset=detachMasterAsset,c.saveEpisode=saveEpisode,c.selectText=function(e){e.target.select()},c.$on("$destroy",function(){c.watchEdits(),c.dismissalWatcher(),c.languageWatcher(),c.watchStyleEdits()})}}}function ittItem(e,t,i,a,r,s,l,c,d,u,p,m){return{restrict:"A",replace:!1,scope:{item:"=ittItem"},template:function(e,t){return'<div ng-if="item.renderTemplate" np-dynamic-event-template component-name="'+(t.forcetemplate?t.forcetemplate:"{{item.component_name}}")+'"></div>'},controller:"ItemController",link:function(v,g){function handleOutgoingLinkDisplay(){if(null!=v.item.url&&null!=v.item.url_status&&null!=v.item.target){var e=v.item,t=e.url,i=e.target,n=e.url_status,a=m.mixedContentUrl(t);return!m.urlIsEmbeddable(t,n)||"_blank"===i||a}}v.appState=r,v.userHasRole=a.userHasRole,v.item.avatar_id&&(v.item.avatar=c.assets[v.item.avatar_id]),"internal:editing"===v.item._id?g.addClass("noTransitions"):(a.userHasRole("admin")||a.userHasRole("customer admin")||v.item.user_id===r.user._id)&&(v.item.editableByThisUser=!0),v.handleOutgoingLinkDisplay=handleOutgoingLinkDisplay,v.toggleDetailView=function(){v.item.showInlineDetail?v.item.showInlineDetail=!1:(l.pause(),v.captureInteraction(),g.width()>450?v.item.showInlineDetail=!0:r.itemDetail={item:v.item,animate:!0})};var h={ENTER:13,SPACE:32};if(v.toggleDetailOnKeyPress=function(e){var t=e,i=!0;switch(t.keyCode){case h.ENTER:case h.SPACE:v.toggleDetailView(),i=!1;break;default:i=!0}i||(e.stopPropagation(),e.preventDefault())},v.forceModal=function(e){void 0===e&&(e=!0),l.pause(),r.itemDetail={item:v.item,animate:e}},v.outgoingLinkOnKeyPress=function(e,t){var i=t,n=!0;switch(i.keyCode){case h.ENTER:case h.SPACE:v.outgoingLink(e),n=!1;break;default:n=!0}n||(t.stopPropagation(),t.preventDefault())},v.outgoingLink=function(e){if(l.pause(),v.captureInteraction(),p.isVideoUrl(e)){u.pause(v.item._id);var i=Math.floor(u.getCurrentTime(v.item._id))||0;e=p.getOutgoingUrl(e,i)}v.item.targetTop?t(function(){window.location.href=e}):window.open(e)},v.editItem=function(){r.editEvent=v.item,r.editEvent.templateOpts=d.getTemplates(v.item.producerItemType);var e=d.setupItemForm(r.editEvent.styles,"item");d.onSelectChange(r.editEvent,e),r.videoControlsActive=!0,r.videoControlsLocked=!0},v.captureInteraction=function(){s.captureEventActivity("clicked",v.item._id)},v.item.component_name===o.LINK_EMBED_TEMPLATE)var f=v.$watch(function(){return u.getMetaProp("time")>v.item.start_time},function(e){e&&(v.captureInteraction(),f())});if(v.item.asset_id&&!v.item.asset&&(v.item.asset=c.assets[v.item.asset_id]),v.item.data&&(v.plugin=v.item.data._plugin,v.plugin._type=v.item.data._pluginType,"credlyBadge"===v.plugin._type)){s.captureEventActivity("viewed",v.item._id),r.user.roles&&1===r.user.roles.length&&"guest"===r.user.roles[0]?v.plugin.eligibleForBadges=!1:(v.plugin.eligibleForBadges=!0,r.user.emails?v.plugin.userEmail=r.user.emails[0]:v.plugin.userEmail="",v.plugin.totalAchieved=0),v.checkBadgeEligibility=function(){v.plugin.eligibleForBadges&&angular.forEach(v.plugin.requirements,function(e){e.achieved||s.readEventActivity(e.eventId,e.activity).then(function(t){e.achieved=t,v.countAchievements()}),v.countAchievements()})},v.countAchievements=function(){var e=0;angular.forEach(v.plugin.requirements,function(t){t.achieved&&(e+=1)}),v.plugin.totalAchieved=e,v.plugin.totalAchieved===v.plugin.requirements.length&&(c.episodes[r.episodeId].styleCss=c.episodes[r.episodeId].styleCss+" uscHackUserHasBadge")},v.checkBadgeEligibility();var y=0;v.badgePoll=i(function(){y++,(v.item.isCurrent||"review"===r.viewMode)&&v.checkBadgeEligibility(),y>60&&i.cancel(v.badgePoll)},1e4),v.$on("$destroy",function(){i.cancel(v.badgePoll)}),v.badger=function(){v.plugin.gettingBadge=!0,e({method:"GET",url:n.apiDataBaseUrl+"/v1/send_credly_badge?badge_id="+v.plugin.credlyBadgeId+"&email="+v.plugin.userEmail}).success(function(e){v.checkBadgeEligibility(),"Badge previously sent."===e.status&&(v.plugin.alreadyHadBadge=!0),v.plugin.gotBadge=!0}).error(function(){v.plugin.gettingBadge=!1,v.plugin.error=!0})}}}}}function ItemController(e,t){e.seek=function(i){t.seek(i,"clickedOnItem",e.item._id)};var i={ENTER:13,SPACE:32};e.seekOnKeyPress=function(t,n){var a=n,r=!0;switch(a.keyCode){case i.ENTER:case i.SPACE:e.seek(t),r=!1;break;default:r=!0}r||(n.stopPropagation(),n.preventDefault())}}function ittItemEditor(e,t,i,n,a,r){return{restrict:"A",replace:!0,scope:{item:"=ittItemEditor"},template:Ai.a,controller:"EditController",link:function(s){a.pause(),a.seek(s.item.start_time),s.uploadStatus=[],s.uneditedItem=angular.copy(s.item),s.annotators=n.episodes[i.episodeId].annotators,s.episodeContainerId=n.episodes[i.episodeId].container_id,s.languages=n.episodes[i.episodeId].languages,s.itemForm=r.setupItemForm(s.item.styles,"item"),s.item.layouts||(s.item.layouts=["inline"]),s.item.producerItemType||t.error({data:"Don't have a producerItemType for item "+s.item._id}),s.sxsItemComponentFieldName=i.product+"-"+s.item.producerItemType+"-field",s.appState=i,s.watchEdits=s.$watch(function(){return s.item},function(e,t){t&&(!1===e.chapter_marker&&a.removeEvent(e._id),e=n.deriveEvent(e),e.renderTemplate=e.template_id===t.template_id,"producer"!==i.product||"_blank"!==e.target||e.component_name!==o.LINK_EMBED_TEMPLATE&&e.component_name!==o.LINK_MODAL_THUMB_TEMPLATE||(e.component_name=o.LINK_TEMPLATE),e.start_time===t.start_time&&e.start_time===t.end_time&&!0!==e.stop||n.resolveEpisodeEvents(i.episodeId))},!0),s.watchStyleEdits=s.$watch(function(){return s.itemForm},function(){var e=[];for(var t in s.itemForm)s.itemForm[t]&&("position"===t?e.push(s.itemForm[t]):e.push(t+s.itemForm[t]));s.item.styles=e},!0),s.forcePreview=function(){i.editEvent.fnord=i.editEvent.fnord?"":"fnord"};var l=function(e){return"Annotation"===e._type&&e.component_name===o.TRANSCRIPT_TEMPLATE};s.setItemTime=function(){"Scene"===s.item._type?(n.resolveEpisodeEvents(i.episodeId),a.updateSceneTimes(s.item.episode_id)):s.item.stop?(s.item.end_time=s.item.start_time,n.resolveEpisodeEvents(i.episodeId),a.updateEventTimes(s.item)):(n.resolveEpisodeEvents(i.episodeId),(s.item.end_time<=s.item.start_time||s.item.end_time>n.events[s.item.scene_id].end_time)&&(s.item.end_time=n.events[s.item.scene_id].end_time),a.updateEventTimes(s.item))};var c=function(e,t){return e.start_time-t.start_time};s.setItemEndTime=function(){(s.item.end_time<=s.item.start_time||s.item.end_time>n.events[s.item.scene_id].end_time)&&(s.item.end_time=n.events[s.item.scene_id].end_time),a.updateEventTimes(s.item)};var d=function(){var e=n.episodes[i.episodeId];return angular.copy(e.items).filter(l)},u=function(e,t,i){if("Chapter"===t._type)return!1;if(!e)return!1;var n,a=e.end_time;i=i.sort(c);for(var r=0,s=i.length;r<s;r++)if(i[r]._id===t._id){n=i[r+1];break}return n&&n.start_time<e.end_time&&(a=n.start_time),a},p=function(e){return"Scene"===e._type?e:n.events[s.item.scene_id]};s.switchToAutoOrCustom=function(e){if(e){var t=l(s.item)?d():[];s.item.end_time=u(p(s.item),s.item,t),s.customEndTime=!1}else s.customEndTime=!0},s.isAutoEndTime=function(){var e=l(s.item)?d():[],t=u(p(s.item),s.item,e);return s.item.end_time===t},s.customEndTime=!s.isAutoEndTime(),s.dismissalWatcher=e.$on("player.dismissAllPanels",s.cancelEdit),s.cancelEdit=function(){s.cancelEventEdit(s.uneditedItem)},s.assetUploaded=function(e){s.item.asset=n.assets[e],"Link"===s.item._type?s.item.link_image_id=e:"Annotation"===s.item._type?s.item.annotation_image_id=e:s.item.asset_id=e,s.showUploadButtons=!1,s.showUploadField=!1},s.replaceAsset=function(){s.showUploadButtons=!0,s.item.sxs&&(s.item.removedAssets=s.item.removedAssets||[],"Link"===s.item._type?s.item.removedAssets.push(s.item.link_image_id):"Annotation"===s.item._type?s.item.removedAssets.push(s.item.annotation_image_id):s.item.removedAssets.push(s.item.asset_id))},s.detachAsset=function(){if(s.item.asset)switch(s.item.producerItemType){case"link":s.item.asset=null,s.item.link_image_id=null,s.item.asset_id=null,s.item.annotation_image_id=null;break;case"transcript":s.item.asset=null,s.item.annotation_image_id=null;break;case"image":case"question":case"file":s.item.asset=null,s.item.asset_id=null}},s.attachChosenAsset=function(e){var t=n.assets[e];s.item&&(s.item.asset=t,r.onSelectChange(s.item,s.itemForm),"Upload"===s.item._type||"Plugin"===s.item._type?s.item.asset_id=e:"Link"===s.item._type?(s.item.link_image_id=e,s.item.asset_id=e):"Annotation"===s.item._type&&(s.item.asset_id=e,s.item.annotation_image_id=e))},s.$on("$destroy",function(){s.watchEdits(),s.dismissalWatcher(),s.watchStyleEdits()})}}}function ittItemDetailModal(e){return{restrict:"A",replace:!0,scope:{item:"=ittItemDetailModal"},template:Li.a,link:function(t){t.item=t.item.item,t.item.animate||(t.modalStyle={transition:"none"});var i={bottom:"0","padding-top":"5%"},n={"overflow-y":"auto",top:"40%",height:"85%","z-index":"11"};t.item.isVideoUrl?t.modalStyle=angular.extend(t.modalStyle,{"padding-top":"5%"}):"image"===t.item.producerItemType?t.modalStyle=angular.extend(t.modalStyle,n):t.modalStyle=angular.extend(t.modalStyle,i),t.dismiss=function(){e.itemDetail=!1}}}}function ittIframe(e){return{restrict:"E",scope:{src:"@",contenttype:"@",item:"&"},replace:!0,template:Mi.a,controller:["$scope","ittUtils","appState",function(e,t,i){function validateFrameUrl(e){return t.isValidURL(e)?(n.isLoading=!1,!0):(n.isLoading=!0,!1)}var n=this,a="allow-forms allow-same-origin allow-scripts";n.isLoading=!0,n.isTouchDevice=i.isTouchDevice,n.isTouchDevice&&/inthetelling.com\/#/.test(n.src)&&(n.iOSScroll="no"),n.watcher=e.$watchGroup([function(){return n.src},function(){return n.contenttype}],function(){n.src&&validateFrameUrl(n.src)&&(n.contenttype?n.sandbox="text/html"===n.contenttype?a:void 0:(n.sandbox=a,n.src.match(/.pdf$/)&&delete n.sandbox,n.src.match(/inthetelling.com\/#/)&&(n.sandbox+=" allow-top-navigation allow-popups"),n.src.match(/inthetelling.com\/#/)&&-1===n.src.indexOf("?")&&(n.src+="?embed=1"),n.src.match(/amazonaws.com\/itt/i)&&delete n.sandbox))}),e.$on("$destroy",function(){n.watcher()})}],controllerAs:"$ctrl",bindToController:!0,link:function(t,i){var n=95,a=angular.noop,r=$(".w-modal"),s=$(".modal"),o=$(window).height()-220;s.length>0&&e.isTouchDevice&&(t.$ctrl.styles={height:o+"px"},i.css("height",o),t.$watch(function(){return i.height()},function(e,n){e!==n&&(t.$ctrl.styles={height:e+"px"},i.css("height",o))})),r.length>0?function(){var e=r.height()-n;i.css("height",e),r.css("overflow-y","hidden"),a=t.$watch(function(){return r.height()},function(e,t){if(e!==t){var a=e-n;i.css("height",a)}})}():function(){"discover"===e.viewMode&&e.resizeIframeReviewMode&&!e.isTouchDevice&&i.css("height",o)}(),t.$on("$destroy",function(){a()})}}}function autofocus(e){return{link:function(t,i){e(function(){"TEXTAREA"===i[0].tagName||"INPUT"===i[0].tagName?i[0].focus():i.find("input,textarea")[0].focus()})}}}function ittAnnotationField(){return{restrict:"EA",scope:{data:"=",ittItemForm:"="},template:['<div class="field">','\t<div class="label">Annotation Text [{{$ctrl.appState.lang}}]','\t\t<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Annotation Text is a required field"></itt-validation-tip>',"\t</div>",'\t<div class="input" sxs-input-i18n="$ctrl.data.annotation" do-validate="true" x-inputtype="\'textarea\'" on-emit-name="$ctrl.onName($taName)" autofocus></div>',"</div>"].join("\n"),controller:["appState",function(e){function onName(e){t.textAreaName=e}var t=this;t.onName=onName,t.appState=e,t.textAreaName=""}],controllerAs:"$ctrl",bindToController:!0}}function ittColorSelect(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Color</div>','\t<div class="input">','\t\t<select size="1" ng-model="itemForm.color">','\t\t\t<option value="">(Default)</option>','\t\t\t<option value="Invert">Invert</option>','\t\t\t<option value="Sepia">Sepia</option>','\t\t\t<option value="Solarized">Solarized</option>','\t\t\t<option value="Vivid">Vivid</option>',"\t\t</select>","\t</div>","</div>"].join(" ")}}function ittDescriptionField(){return{restrict:"EA",scope:{data:"=",modelOpts:"=?"},template:['<div class="field">','\t<div class="label">Description [{{descriptionField.lang}}]</div>','\t<div class="input" ng-model-options="descriptionField.modelOpts" sxs-input-i18n="descriptionField.data.description" x-inputtype="\'textarea\'"></div>',"</div>"].join(" "),controller:["appState","ittUtils",function(e,t){var i=this;i.lang=e.lang,t.existy(i.modelOpts)||(i.modelOpts={updateOn:"default"})}],controllerAs:"descriptionField",bindToController:!0}}function ittDisplaySelect(){return{restrict:"EA",scope:{data:"=",itemForm:"=?"},template:['<div class="field" ng-if="$ctrl.getVisibility(\'display\')">','\t<div class="label">Display</div>','\t<div class="input">','\t\t<select ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)"','\t\t\tng-model="$ctrl.data.layouts[$ctrl.layoutIndex]"',"\t\t\tng-options=\"{{::$ctrl.setNgOpts('display')}}\">","\t\t</select>","\t</div>","</div>",'<div class="field" ng-if="$ctrl.getVisibility(\'bgImagePosition\')">','\t<div class="label">Position</div>','\t\t<div class="input">','\t\t<select ng-change="$ctrl.onItemFormUpdate($ctrl.data, $ctrl.itemForm)" ng-model="$ctrl.itemForm.position" ng-options="{{$ctrl.setNgOpts(\'imagePosition\')}}"></select>',"\t</div>","</div>"].join(""),controller:["$scope","selectService",function(e,t){function setNgOpts(e){return"option.value as option.name \n        disable when option.isDisabled\n        for option in $ctrl.getSelectOpts('"+e+"')"}function watchTemplate(){return i.data.component_name}function handleChange(e){i.isImageFillTemplate=e&&e===o.IMAGE_FILL_TEMPLATE}var i=this;i.getVisibility=t.getVisibility,i.getSelectOpts=t.getSelectOpts,i.onItemFormUpdate=t.onSelectChange,i.setNgOpts=setNgOpts,i.layoutIndex="image"===i.data.producerItemType?0:1,e.$watch(watchTemplate,handleChange)}],controllerAs:"$ctrl",bindToController:!0}}function ittDynamicModel(e,t){return{restrict:"A",terminal:!0,priority:1e5,link:function(i,n){var a=t(n.attr("itt-dynamic-model"))(i);n.removeAttr("itt-dynamic-model"),n.attr("ng-model",a),e(n)(i)}}}function ittFileField(){return{restrict:"EA",scope:!0,template:['<div class="field">','\t<div class="label">File','\t\t<itt-validation-tip ng-if="ittItemForm.itemAsset.$invalid" text="File is required"></itt-validation-tip>',"\t</div>",'\t<div class="input" np-upload-producer-template></div>',"</div>"].join(" ")}}function ittHighlightSelect(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Highlight<span ng-if="episode"> Style</spann></div>','\t<div class="input">','\t\t<select size="1" ng-model="itemForm.highlight">','\t\t\t<option ng-if="episode" value="">(Default)</option>','\t\t\t<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option>','\t\t\t<option ng-if="item._type !== \'Scene\' && !episode" value="">(Inherit from layout)</option>','\t\t\t<option value="None">No highlight</option>','\t\t\t<option value="Solid">Solid</option>','\t\t\t<option value="Border">Border</option>','\t\t\t<option value="Side">Side</option>','\t\t\t<option value="Bloom">Translucent</option>','\t\t\t<option value="Tilt">Tilt</option>',"\t\t</select>","\t</div>","</div>"].join(" ")}}function ittImageField(){return{restrict:"EA",template:['<div class="field" ng-show="selectService.getVisibility(\'imageUpload\')">','\t<div class="label">Image','\t\t<itt-validation-tip ng-if="ittItemForm.itemAsset.$invalid" text="Image is required"></itt-validation-tip>',"\t</div>",'\t<div class="input" np-upload-producer-template></div>',"</div>"].join(" ")}}function ittLanguageFlags(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Languages</div>','\t<div class="input">',"\t<label>",'\t\t<input type="checkbox" ng-model="langForm.en">English',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.es">Spanish',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.zh">Chinese',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.pt">Portuguese',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.fr">French',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.de">German',"\t</label>","\t<label>",'\t\t<input type="checkbox" ng-model="langForm.it">Italian',"\t</label>","\t</div>","</div>"].join("\n")}}function ittLanguageSelect(){return{restrict:"EA",scope:{data:"=",langForm:"=?"},template:['<div class="field">','\t<div class="label">Default Language</div>','\t<div class="input">','\t\t<select ng-model="$ctrl.data.defaultLanguage" ng-options="{{::$ctrl.setNgOpts()}}"></select>',"\t</div>","</div>"].join("\n"),controller:["$scope","selectService",function(e,t){function setNgOpts(){return"option.value as option.name disable when option.isDisabled for option in $ctrl.langOpts"}function watchLangForm(){return i.langForm}function handleUpdates(e){i.langOpts=i.langOpts.map(function(t){return angular.forEach(e,function(e,i){t.value===i&&(t.isDisabled=!e)}),t})}var i=this;i.getSelectOpts=t.getSelectOpts,i.setNgOpts=setNgOpts,i.langOpts=t.getSelectOpts("language"),e.$watch(watchLangForm,handleUpdates,!0)}],controllerAs:"$ctrl",bindToController:!0}}function ittShowFocus(e){return function(t,i,n){t.$watch(n.ittShowFocus,function(t){e(function(){t&&i.filter(":visible").first().focus()})},!0)}}function ittSpeakerField(){return{restrict:"EA",template:'\n      <div class="field" ng-if="selectService.getVisibility(\'speakerField\')">\n      \t<div class="label">Speaker [{{appState.lang}}]</div>\n      \t<div class="input">\n      \t\t<div sxs-annotator-autocomplete="annotators" item="item" ng-model="item.annotator"></div>\n      \t</div>\n      </div>'}}function ittSpeakerThumbField(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Speaker thumbnail</div>','\t<div class="input" np-upload-producer-template></div>',"</div>"].join(" ")}}function ittTimeField(){return{restrict:"EA",scope:!0,template:['<div class="field" ng-if="!(item._type===\'Scene\' && item.start_time <= 0.1)">','\t<div class="label">Start</div>','\t<div class="input">','  <itt-validation-tip ng-if="ittItemForm.time.$invalid" text="{{item.validationMessage}}"></itt-validation-tip>','\t\t<span sxs-input-time="item" x-input-field="start_time"></span>',"\t\t<span ng-if=\"!(item.stop || item._type === 'Scene' || item._type === 'Chapter')\">",'\t\t\t<span class="label"> &nbsp; &nbsp; &nbsp; End</span>','\t\t\t<span sxs-input-time="item" x-input-field="end_time"></span>',"\t\t</span>","\t</div>","</div>"].join(" ")}}function ittTimestampSelect(){return{restrict:"EA",scope:!0,template:['<div class="field">','\t<div class="label"><span ng-if="episode">Display </span>Timestamp</div>','\t<div class="input">','\t\t<select size="1" ng-model="itemForm.timestamp">','\t\t\t<option ng-if="episode" value="">(Default)</option>','\t\t\t<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option>','\t\t\t<option ng-if="item._type !== \'Scene\'" value="">(Inherit from layout)</option>','\t\t\t<option value="None">Off</option>','\t\t\t<option value="Inline">On</option>',"\t\t</select>","\t</div>","</div>"].join(" ")}}function ittTitleField(){return{restrict:"EA",scope:{data:"=",modelOpts:"=?",doValidate:"=?",ittItemForm:"=?"},template:['<div class="field" ng-if="$ctrl.isVisible(\'titleField\')">','\t<div class="label">Title [{{$ctrl.appState.lang}}]','\t\t<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Title is a required field"></itt-validation-tip>',"\t</div>",'\t<div class="input" ng-model-options="$ctrl.modelOpts" do-validate="$ctrl.doValidate" sxs-input-i18n="$ctrl.data.title" on-emit-name="$ctrl.onName($taName)" x-inputtype="\'input\'" autofocus></div>',"</div>"].join(" "),controller:["appState","ittUtils","selectService",function(e,t,i){function onName(e){n.textAreaName=e}var n=this;n.appState=e,n.isVisible=i.getVisibility,n.onName=onName,t.existy(n.modelOpts)||(n.modelOpts={updateOn:"default"})}],controllerAs:"$ctrl",bindToController:!0}}function ittTranscriptField(){return{restrict:"EA",scope:{data:"=",ittItemForm:"="},template:['<div class="field">','\t<div class="label">Transcript [{{$ctrl.appState.lang}}]','\t\t<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Transcript is a required field"></itt-validation-tip>',"\t</div>",'\t<div class="input" sxs-input-i18n="$ctrl.data.annotation" do-validate="true" x-inputtype="\'textarea\'" on-emit-name="$ctrl.onName($taName)" autofocus></div>',"</div>"].join(" "),controller:["appState",function(e){function onName(e){t.textAreaName=e}var t=this;t.onName=onName,t.appState=e,t.textAreaName=""}],controllerAs:"$ctrl",bindToController:!0}}function ittTransitionSelect(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Transition</div>','\t<div class="input">','\t\t<select size="1" ng-model="itemForm.transition">','\t\t\t<option ng-if="episode" value="">(Default)</option>','\t\t\t<option ng-if="item._type === \'Scene\'" value="">(Inherit from episode)</option>','\t\t\t<option ng-if="item._type !== \'Scene\' && !episode" value="">(Inherit from layout)</option>','\t\t\t<option value="None">No transition</option>','\t\t\t<option value="Fade">Fade</option>','\t\t\t<option value="SlideL">Slide left</option>','\t\t\t<option value="SlideR">Slide right</option>','\t\t\t<option value="Pop">Pop</option>',"\t\t</select>","\t</div>","</div>"].join(" ")}}function ittTypographySelect(){return{restrict:"EA",template:['<div class="field">','\t<div class="label">Typography</div>','\t<div class="input">','\t\t<select size="1" ng-model="itemForm.typography">','\t\t\t<option value="">(Default)</option>','\t\t\t<option value="Sans">Sans</option>','\t\t\t<option value="Serif">Serif</option>','\t\t\t<option value="Book">Book</option>','\t\t\t<option value="Swiss">Swiss</option>',"\t\t</select>","\t</div>","</div>"].join(" ")}}function ittValidAsset(e){return{restrict:"EA",require:"^ngModel",scope:{item:"="},link:function(t,i,n,a){function watchItem(){return t.item}function handleChanges(t){var i=t.component_name,n=t.asset;switch(i){case o.FILE_TEMPLATE:case o.IMAGE_PLAIN_TEMPLATE:case o.IMAGE_INLINE_WITHTEXT_TEMPLATE:case o.SLIDING_CAPTION:case o.IMAGE_FILL_TEMPLATE:case o.LINK_WITHIMAGE_NOTITLE_TEMPLATE:e.existy(n)?a.$setValidity("itemAsset",!0):a.$setValidity("itemAsset",!1);break;case o.LINK_TEMPLATE:case o.LINK_MODAL_THUMB_TEMPLATE:case o.LINK_DESCRIPTION_FIRST_TEMPLATE:case o.LINK_EMBED_TEMPLATE:a.$setValidity("itemAsset",!0)}}a&&(a.$validators.itemAsset=function(){return!0},t.$watch(watchItem,handleChanges,!0))}}}function ittValidEpisodeUrl(e,t,i){return{require:"?ngModel",scope:{onValidationNotice:"&"},link:function(n,a,r,s){function watchFields(){return c}function handleUpdates(e){n.onValidationNotice({$notice:e})}function episodeUrl(t){if(c={},s.$isEmpty(t))return c.error={showInfo:!0,message:"Field cannot be blank."},!1;if(e.isVideoUrl(t)){var n=e.checkUrl(t).type;return"html5"===n||"wistia"===n&&!i.userHasRole("admin")?(c[n]={showInfo:!0,message:o(n)+" video currently not supported"},!1):(c[n]={showInfo:!0,message:o(n)+" detected",doInfo:!0},!0)}return c.error={showInfo:!0,message:t+" is not a valid episode URL"},!1}var o=t.capitalize,l={showInfo:!1,message:"",doInfo:!1},c={kaltura:l,youtube:l,html5:l,error:l};s.$validators={episodeUrl:episodeUrl},n.$watch(watchFields,handleUpdates,!0)}}}function ittValidPathslug(e,t){return{require:["^ngModel","^npGuestAccessibleUrl"],restrict:"EA",link:function(i,n,a,r){function validPathslug(e){if(c[c.type].error=null,l.$isEmpty(e))return c[c.type].error="Slug cannot be empty",!0;var t=s(e);return-1!==_gatherPathSlugs(u,p).indexOf(t)&&(c[c.type].error=t+" is already taken."),!0}function _gatherPathSlugs(e,t){return e.reduce(function(e,i){if(i.path_slug&&i.path_slug.en)if(o(t)){if(t!==i._id)return e.push(i.path_slug.en),e}else e.push(i.path_slug.en);return e},[])}var s=t.slugify,o=t.existy,l=r[0],c=r[1],d=e.customers[c.narrative.customer_id]||c.customer,u="narrative"===c.type?e.cachedNarrativesByCustomer(d):c.narrative.timelines,p=c[c.type]._id;l&&(l.$validators={validPathslug:validPathslug})}}}function ittValidUrl(e){return{require:"?ngModel",link:function(t,i,n,a){a&&(a.$validators.supportUrl=function(t){return a.$isEmpty(t)||e.isValidURL(t)})}}}function sxsAddContent(e,t){return{restrict:"A",replace:!0,template:Ga.a,controller:"EditController",link:function(i){i.appState=e,i.playbackService=t,i.expand=function(){i.expanded=!0,angular.element(document).one("mouseup.addcontent",function(){i.collapse()})},i.collapse=function(){i.expanded=!1}}}}function sxsAnnotatorAutocomplete(e,t,i){return{require:"ngModel",template:Ya.a,scope:{annotators:"=sxsAnnotatorAutocomplete",item:"=item"},link:function(n,a,r,s){n.appState=i,n.hasAnnotator=function(){if(n.item.annotator)return Object.keys(n.item.annotator).length>0},angular.forEach(n.annotators,function(e){e.annotation_image_id&&(e.imageUrl=t.assets[e.annotation_image_id].url)}),n.annotator={name:n.item.annotator},n.annotators[n.item.annotator]&&n.annotators[n.item.annotator].annotation_image_id&&(n.annotator.imageUrl=t.assets[n.annotators[n.item.annotator].annotation_image_id].url),n.filteredAnnotators=function(e){var t=Object.keys(e).map(function(t){return e[t]}),i=t.pop(),n=t.sort(function(e,t){return e.key.toLowerCase()<t.key.toLowerCase()?-1:e.key.toLowerCase()>t.key.toLowerCase()?1:0});return n.push(i),n.reduce(function(e,t){return e[t.key]=t,e},{})}(angular.copy(n.annotators)),n.preselectedItem=-1,a.find(".annotatorChooser").bind("keydown",function(e){switch(e.which){case 40:n.preselectedItem=(n.preselectedItem+1)%Object.keys(n.filteredAnnotators).length;break;case 38:n.preselectedItem=(n.preselectedItem-1)%Object.keys(n.filteredAnnotators).length;break;case 13:e.preventDefault(),n.preselectedItem>-1&&n.selectByIndex(n.preselectedItem)}}),n.handleAutocomplete=function(){if(n.annotator.name="",n.searchText){n.preselectedItem=-1;var e={};angular.forEach(n.annotators,function(t){t.key.toLowerCase().indexOf(n.searchText.toLowerCase())>-1&&(e[t.key]=t)}),n.filteredAnnotators=e,1===Object.keys(n.filteredAnnotators).length&&(n.preselectedItem=0)}else n.filteredAnnotators=angular.copy(n.annotators),n.preselectedItem=-1},n.selectByIndex=function(e){if(!(e<0)){var t=Object.keys(n.filteredAnnotators).sort();n.select(n.filteredAnnotators[t[e]])}},n.select=function(e){n.preselectedItem=-1,e.annotation_image_id?(n.item.annotation_image_id=e.annotation_image_id,n.item.asset=t.assets[e.annotation_image_id],n.annotator.imageUrl=n.item.asset.url):(delete n.annotator.imageUrl,delete n.item.asset),s.$setViewValue(e.name),n.searchText=""},n.autoCompleting=!1,n.showAutocomplete=function(){var e=a.find(".annotatorChooser")[0];e.setSelectionRange(0,e.value.length),n.autoCompleting=!0},n.hideAutocomplete=function(){e(function(){n.preselectedItem>-1?n.selectByIndex(n.preselectedItem):""!==n.searchText&&n.addNewAnnotator(),n.autoCompleting=!1},300)},n.addNewAnnotator=function(){var e=n.searchText;n.item.annotator={},n.item.annotator[i.lang]=e,n.searchText="",n.handleAutocomplete()},n.uploadAnnotatorImage=function(){window.alert("TODO")}}}}function sxsInputI18n(e,t,i){return{template:hr.a,scope:{field:"=sxsInputI18n",inputtype:"=inputtype",doValidate:"=",onEmitName:"&"},link:function(n,a,r){n.field||(n.field={en:""}),n.appState=t,n.textangularname="ta"+(new Date).getUTCMilliseconds()+"y"+Math.random().toString(16),n.onEmitName({$taName:n.textangularname}),"textarea"===n.inputtype&&(e(function(){if(void 0!==r.autofocus){i.retrieveEditor(n.textangularname).scope.displayElements.text.trigger("focus")}}),n.trim=function(){var e=n.field[t.lang];e&&(e=e.replace(/<br\/>/g,"<br>"),e=e.replace(/<div>/g,"<br>"),e=e.replace(/<\/?(span|div)>/g,""),e=e.replace(/(<br>)*$/,""),n.field[t.lang]=e)},n.sanitizePastedHtml=function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent})}}}function sxsInputTime(e,t,i,n,a,r,s){return{require:"?^^form",scope:{item:"=sxsInputTime"},template:yr.a,link:function(o,l,c,d){function watchModel(){return parse(o.model)}function handleUpdates(e){setTime(e),"start_time"===c.inputField&&o.item.stop&&(o.item.end_time=e)}function handelValidation(e){if(o.item.validationMessage=null,d.time.$setValidity("time",!0),"Scene"!==o.item._type)return!0;var t=!1,i=validateStartTime(e),n=validateSceneStartTime(e);return t=i&&n,t||d&&(d.time.$setValidity("time",!1),d.time.$setViewValue(format(e)),d.time.$render(),n||(o.item.validationMessage="Scenes cannot share the same start time."),i||(o.item.validationMessage="For a start time <=0:00.1, please edit the first layout")),t}function validateSceneStartTime(e){var t,i=!0;return o.item.start_time!==e&&(t=n.isOnExistingSceneStart(e),i=!t),i}function validateStartTime(e){return u(e)&&e>.1}function setTime(e){!1!==handelValidation(e)&&(e>m&&(e=m),o.item.stop&&(o.item.end_time=e),o.realValue=e,o.item[c.inputField]=o.realValue,o.model=o.format(e),o.item.invalid_end_time=o.item.start_time>o.item.end_time)}function parse(t){var i;if(void 0===t||""===t)i=r.getMetaProp("time");else if(isNaN(t)){var n=t.split(":");2===n.length?(isNaN(n[0])&&(n[0]=0),isNaN(n[1])&&(n[1]=0),i=60*Number(n[0])+Number(n[1])):i=r.getMetaProp("time")}else i=t;return i<.01&&(i=.01),e.$emit("searchReindexNeeded"),i}function format(e){var t=Math.floor(e/60),i=Math.round(e%60*100)/100;return i<10&&(i="0"+i),t+":"+i}function nudge(e){t.cancel(p),l.find(".inputfield").focus();var i=e/30;setTime(o.item[c.inputField]+i),"start_time"===c.inputField&&a.seek(o.item[c.inputField]+i)}function showTools(e){e?o.tooltip=!0:p=t(function(){o.tooltip=!1},300)}function isTranscript(){return!1}var u=s.existy;angular.extend(o,{fieldname:angular.copy(c.inputField),realValue:angular.copy(o.item[c.inputField]),playbackService:r,model:format(angular.copy(o.item[c.inputField])),appState:i,parse:parse,format:format,nudge:nudge,setTime:setTime,showTools:showTools,isTranscript:isTranscript}),function(){"Scene"===o.item._type?o.scene=function(){return o.item}:o.scene=function(){return n.sceneAtEpisodeTime(o.item.cur_episode_id,r.getMetaProp("time"))}}(),o.$watch(watchModel,handleUpdates);var p,m=n.episodes[o.item.cur_episode_id].masterAsset.duration}}}function ittScene(e,t){return{restrict:"A",replace:!1,scope:{scene:"=ittScene",episode:"=episode"},template:'<span ng-if="scene.renderTemplate" np-dynamic-event-template component-name="{{scene.component_name}}"></span>',controller:"SceneController",link:function(i,n){function twiddleScene(){e(function(){n.find(".matchVideoHeight:visible").each(function(){$(this).css("height",n.find(".videoMagnet img").height())});var e=angular.element(window).height()-$("#CONTAINER").scrollTop();n.find(".stretchToViewport:visible").each(function(){$(this).css("min-height",e-$(this).offset().top)}),n.find(".stretchToViewportShort:visible").each(function(){$(this).css("min-height",e-$(this).offset().top-210)})},100)}"review"!==t.viewMode&&window.scrollTo(0,0),i.precalculateSceneValues(),i.appState=t,i.headerOneComponentTemplate=o.HEADER_ONE_TEMPLATE,window.addEventListener("resize",function(){return twiddleScene()}),twiddleScene(),i.unwatchEdits=i.$watch(function(){return t.editEvent},i.precalculateSceneValues,!0),i.$on("$destroy",function(){i.unwatchEdits()})}}}function SceneController(e,t,i){function precalculateSceneValues(){delete e.mainContentHasLeftSidebar,delete e.mainContentHasRightSidebar,delete e.mainContentHasBothSidebars,delete e.altContentHasLeftSidebar,delete e.altContentHasRightSidebar,delete e.altContentHasBothSidebars,e.showCurrent=$.inArray("showCurrent",e.scene.layouts)>-1,e.contentItems=t("isContent")(e.scene.items),e.mainFgItems=t("itemLayout")(e.scene.items,"mainFg"),e.mainBgItems=t("itemLayout")(e.scene.items,"mainBg"),e.altFgItems=t("itemLayout")(e.scene.items,"altFg"),e.altBgItems=t("itemLayout")(e.scene.items,"altBg"),$.inArray("splitRequired",e.scene.layouts)>-1?e.mainContentItems=t("transcriptandoptional")(e.contentItems):$.inArray("splitOptional",e.scene.layouts)>-1?e.mainContentItems=t("transcriptandrequired")(e.contentItems):e.mainContentItems=t("annotation")(e.contentItems),$.inArray("splitRequired",e.scene.layouts)>-1?e.altContentItems=t("required")(e.contentItems):$.inArray("splitOptional",e.scene.layouts)>-1?e.altContentItems=t("optional")(e.contentItems):e.altContentItems=t("transmedia")(e.contentItems);for(var i=0;i<e.mainContentItems.length;i++)($.inArray("burstL",e.mainContentItems[i].layouts)>-1||$.inArray("sidebarL",e.mainContentItems[i].layouts)>-1||$.inArray("burst",e.mainContentItems[i].layouts)>-1)&&(e.mainContentHasLeftSidebar=!0),($.inArray("burstR",e.mainContentItems[i].layouts)>-1||$.inArray("sidebarR",e.mainContentItems[i].layouts)>-1||$.inArray("burst",e.mainContentItems[i].layouts)>-1)&&(e.mainContentHasRightSidebar=!0),e.mainContentHasLeftSidebar&&e.mainContentHasRightSidebar&&(e.mainContentHasBothSidebars=!0,i=e.mainContentItems.length);for(i=0;i<e.altContentItems.length;i++)($.inArray("burstL",e.altContentItems[i].layouts)>-1||$.inArray("sidebarL",e.altContentItems[i].layouts)>-1||$.inArray("burst",e.altContentItems[i].layouts)>-1)&&(e.altContentHasLeftSidebar=!0),($.inArray("burstR",e.altContentItems[i].layouts)>-1||$.inArray("sidebarR",e.altContentItems[i].layouts)>-1||$.inArray("burst",e.altContentItems[i].layouts)>-1)&&(e.altContentHasRightSidebar=!0),e.altContentHasLeftSidebar&&e.altContentHasRightSidebar&&(e.altContentHasBothSidebars=!0,i=e.altContentItems.length)}function centeredProTransmedia(e){var t=e.component_name===o.PULLQUOTE_TEMPLATE,i=e.component_name===o.HEADER_TWO_TEMPLATE,n=e.component_name===o.TEXT_TRANSMEDIA_TEMPLATE,a=e.component_name===o.TEXT_DEFINITION_TEMPLATE;return!!(t||i||n||a)&&e}function byPullquoteOrH2(e){var t=e.component_name===o.PULLQUOTE_TEMPLATE,i=e.component_name===o.HEADER_TWO_TEMPLATE;return!(!t&&!i)&&e}function setBgImgUrl(e,n){var a,r,s,o=t("isCurrent")(e),l=t(n)(o),c=1;if(l.length>0&&i.existy(l[0].asset)){switch(s="url("+l[0].asset.cssBgUrl+")",/Bg/.test(l[0].layoutCss)&&(c=.25),l[0].styles[0]){case"cover":return a="cover",{"background-image":s,"background-size":a,opacity:c};case"contain":return a="contain",r="center",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"fill":return a="100% 100%",r="50% 50%",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"tl":return a="auto",r="top left",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"tr":return a="auto",r="top right",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"bl":return a="auto",r="bottom left",{"background-image":s,"background-size":a,opacity:c,"background-position":r};case"br":return a="auto",r="bottom right",{"background-image":s,"background-size":a,opacity:c,"background-position":r}}return""}}e.byPullquoteOrH2=byPullquoteOrH2,e.centeredProTransmedia=centeredProTransmedia,e.setBgImgUrl=setBgImgUrl,e.precalculateSceneValues=precalculateSceneValues}function timelineSvc_timelineSvc(e,t,i,a,r,s,o,l,c){function _onPlayerStateChange(t){if("ended"!==l.getTimelineState()||"unstarted"!==t&&"video cued"!==t)switch(l.setTimelineState(t),t){case"reset":_resetClocks(),l.resetPlaybackService();break;case"unstarted":break;case"ended":l.setMetaProp("time",l.getMetaProp("duration"));var i=r.episodes[s.episodeId],n=i.scenes[i.scenes.length-1];i.setCurrentScene(n);break;case"playing":var a=l.getCurrentTime(),c=l.getMetaProp("time"),u=l.getMetaProp("resetInProgress");Math.abs(c-a)>.75&&!1===u&&(l.setMetaProp("time",a),S(!0)),T(),y(),s.videoControlsActive=!0,s.show.navPanel=!1,e.parent!==e&&e.parent.postMessage("pauseEpisodePlayback","*"),o.captureEpisodeActivity("play");break;case"paused":case"buffering":_resetClocks();break;case"video cued":var p=l.getMetaProp("startAtTime"),m=l.getMetaProp("hasResumedFromStartAt");p>0&&!1===m&&d.startAtSpecificTime(p);break;case"player ready":d.updateEventStates()}}function _resetClocks(){i.cancel(u),s.videoControlsActive=!0,_(),u=void 0,f=void 0}function _doEndingSequence(){_resetClocks(),l.handleTimelineEnd(),o.captureEpisodeActivity("pause")}function restartEpisode(){d.seek(.01),d.play()}function nextScene(){for(var e=!1,t=l.getMetaProp("time"),i=l.getMetaProp("duration"),n=d.markedEvents.length,a=0;a<n;a++)if(d.markedEvents[a].start_time>t){handleScene(a,"nextScene"),e=!0;break}e||(d.pause(),d.seek(i-.01,"nextScene"))}function handleScene(e,t){var i=d.markedEvents[e],n=i.start_time;.01===n&&"prevScene"!==t&&(n+=.1),d.seek(n,t),!0===i.stop&&d.pause()}function prevScene(){var e=l.getMetaProp("time");"playing"===l.getTimelineState()&&(e-=3);for(var t=d.markedEvents.length-1,i=t;i>=0;i--)if(d.markedEvents[i].start_time<e){d.seek(d.markedEvents[i].start_time,"prevScene"),i===t&&--i,handleScene(i,"prevScene");break}}function groupByStartTime(e){return e.reduce(function(e,t){return e.hasOwnProperty(t.start_time)?e[t.start_time].push(t):e[t.start_time]=[t],e},{})}function prepGroupedEvents(e){var t=[];return angular.forEach(e,function(e,i){var n={events:e,stop:!1,multiStop:!1,start_time:i,toolTipText:null,layoutChange:!1},a=!1,r=[],s=!1,o=!1;angular.forEach(e,function(e){/internal:endingscreen|internal:landingscreen/.test(e._id)&&(o=!0),e.stop&&(a=!0),"Scene"===e.type&&(s=!0),"Chapter"!==e.type&&!0!==e.chapter_marker||r.push(e)}),0===r.length&&!s&&a&&(n.toolTipText="Stop item"),a&&(n.stop=!0),n.events.length>1&&a&&(n.multiStop=!0),s&&0===r.length&&(n.layoutChange=!0,n.toolTipText="(Layout Change)"),r.length>0&&(angular.forEach(r,function(e,t){0===t?n.toolTipText=e.display_annotation||e.display_title:n.toolTipText+=" / "+(e.display_annotation||e.display_title)}),s&&(n.toolTipText+=" (Layout Change)"),n.multiStop&&(n.toolTipText+=" / (Stop item)")),o||t.push(n)}),t}var d=Object.create(null);d.timelineEvents=[],d.markedEvents=[],d.enforceSingletonPauseListener||e.addEventListener("message",function(e){"pauseEpisodePlayback"===e.data&&d.pause()},!1),d.enforceSingletonPauseListener=!0;var u,p,m,v=c.parseTime;d.setSpeed=function(e){m=e,l.setMetaProp("timeMultiplier",m),l.setSpeed(m),S()},d.restartEpisode=restartEpisode,d.play=function(){var e=l.getMetaProp("duration");!e||e<.1||l.play()},d.pause=function(e){_resetClocks(),l.pause(),e||o.captureEpisodeActivity("pause")},d.startAtSpecificTime=function(e){s.isTouchDevice&&!1===l.getMetaProp("hasBeenPlayed")&&"youtube"===l.getMetaProp("videoType")||(e=v(e),e<0&&(e=0),e>l.getMetaProp("duration")&&l.setMetaProp("duration",e),l.setMetaProp("time",e),l.setMetaProp("hasResumedFromStartAt",!0),d.updateEventStates(),o.captureEpisodeActivity("seek",{method:"URLParameter"}))},d.seek=function(e,i,n){if(!0===l.getMetaProp("ready")){l.pauseOtherPlayers();var a=l.getMetaProp("duration");if("ended"===l.getTimelineState()&&l.setTimelineState("paused"),0===a)return void t(function(){d.seek(e)},300);var r={method:"",seekStart:l.getMetaProp("time")};e=v(e),e<0&&(e=0),e>a&&l.setMetaProp("duration",e),_(),l.setMetaProp("time",e),l.seek(e),d.updateEventStates(),c.existy(i)&&(r.method=i,c.existy(n)&&(r.event_id=n),o.captureEpisodeActivity("seek",r))}},d.nextScene=nextScene,d.handleScene=handleScene,d.prevScene=prevScene,d.toggleMute=function(){l.toggleMute()},d.setVolume=function(e){l.setVolume(e)};var g,h=function(){g={lastTimelineTime:0,lastVideoTime:0,running:!1}};h();var f,y=function(){g.running||(g.running=!0,g.lastTimelineTime=l.getMetaProp("time"),g.lastVideoTime=l.getMetaProp("time"),S())},_=function(){t.cancel(p),h()},S=function(e){t.cancel(p);for(var i=l.getCurrentTime(),n=l.getMetaProp("time"),a=0;a<d.timelineEvents.length;a++){var r=d.timelineEvents[a];if(r.t>=g.lastTimelineTime){if(r.t>n)break;if("pause"!==r.action||!e&&r.t!==g.lastTimelineTime){if(b(r),"pause"===r.action){a++;break}}else;}}var s=d.timelineEvents[a],o=d.timelineEvents[d.timelineEvents.length-1];if(!c.existy(s)&&c.existy(o)&&/internal:endingscreen/.test(o.id)&&_doEndingSequence(),g.lastVideoTime=i,g.lastTimelineTime=n,s&&"playing"===l.getTimelineState()){var u=1e3*(d.timelineEvents[a].t-n)/m;p=t(S,u+10)}},b=function(e){"timeline"===e.id?"pause"===e.action?(l.setMetaProp("time",e.t),d.pause()):d.play():"enter"===e.action?(r.events[e.id].state="isCurrent",r.events[e.id].isCurrent=!0):"exit"===e.action?(r.events[e.id].state="isPast",r.events[e.id].isCurrent=!1):"preload"===e.action&&k(r.events[e.id])},T=function(){f=void 0,i.cancel(u),u=i(E,20)},E=function(){var e=new Date,t=Number.isNaN(e-f)?0:e-f;g.running||y();var i=parseFloat(l.getMetaProp("time"))+t/1e3*m;i<0&&(i=0,d.pause());var n=l.getMetaProp("duration");i>n&&(i=n),l.setMetaProp("time",i),f=e};d.init=function(e){d.timelineEvents=[],d.markedEvents=[],d.displayMarkedEvents=[],m=1;var t=r.episode(e);l.seedPlayer(t.masterAsset.mediaSrcArr,t.masterAsset._id,!0),l.setTimelineState("unstarted"),l.setMetaProp("duration",0),d.injectEvents(r.episodeEvents(e),0),l.registerStateChangeListener(_onPlayerStateChange),i.cancel(u),_()},d.injectEvents=function(e,t){if(0!==e.length){t||(t=0),angular.forEach(e,function(e){if(e.start_time=Number(e.start_time),e.end_time=Number(e.end_time),"Scene"===e._type&&("producer"===s.product&&C(e),/internal:(landing|ending)screen/.test(e._id)&&C(e)),"Chapter"!==e._type&&!0!==e.chapter_marker||C(e),0!==e.start_time||e._id.match("internal")||(e.start_time=.01,r.events[e._id].start_time=.01),e.stop)C(e),d.timelineEvents.push({t:e.start_time+t,id:"timeline",eventId:e._id,action:"pause"}),d.timelineEvents.push({t:e.start_time+t,id:e._id,action:"enter"}),d.timelineEvents.push({t:e.start_time+t+.01,id:e._id,action:"exit"});else if(d.timelineEvents.push({t:e.start_time+t,id:e._id,action:"enter"}),e.end_time||0===e.end_time){if(/internal:endingscreen/.test(e._id))return;d.timelineEvents.push({t:e.end_time+t,id:e._id,action:"exit"})}(e.asset_id||e.annotation_image_id||e.link_image_id)&&d.timelineEvents.push({t:e.start_time<3?0:e.start_time-3,id:e._id,action:"preload"})}),d.sortTimeline();var i=groupByStartTime(d.markedEvents);d.displayMarkedEvents=prepGroupedEvents(i)}};var C=function(e){for(var t=!1,i=0;i<d.markedEvents.length;i++)d.markedEvents[i]._id===e._id&&(d.markedEvents[i]=angular.copy(e),t=!0);t||d.markedEvents.push(e)};d.removeEvent=function(e){d.timelineEvents=a("filter")(d.timelineEvents,function(t){return t.id!==e&&t.eventId!==e}),d.markedEvents=a("filter")(d.markedEvents,{_id:"!"+e});var t=groupByStartTime(d.markedEvents);d.displayMarkedEvents=prepGroupedEvents(t),d.updateEventStates()},d.updateEventTimes=function(e){d.timelineEvents=a("filter")(d.timelineEvents,function(t){return t.id!==e._id&&t.eventId!==e._id}),d.injectEvents([e],0)},d.updateSceneTimes=function(e){angular.forEach(r.episodes[e].scenes,function(e){d.updateEventTimes(e)})},d.sortTimeline=function(){d.timelineEvents=d.timelineEvents.sort(function(e,t){if(e.t===t.t){if(e.action===t.action)return 0;if("enter"===e.action){if("pause"===t.action)return-1;if("exit"===t.action)return 1}return"exit"===e.action?-1:"pause"===e.action?1:0}return e.t-t.t}),d.markedEvents=d.markedEvents.sort(function(e,t){return e.start_time-t.start_time}),d.timelineEvents.length>0&&l.setMetaProp("duration",d.timelineEvents[d.timelineEvents.length-1].t),d.updateEventStates()},d.updateEventStates=function(){var e=l.getMetaProp("time");angular.forEach(d.timelineEvents,function(e){if("timeline"!==e.id){var t=r.events[e.id];t&&t.setFuture()}}),angular.forEach(d.timelineEvents,function(t){if(t.t<=e){var i=r.events[t.id];i&&("enter"===t.action?i.setCurrent():"exit"===t.action&&i.setPast())}})};var w={},k=function(e){e.asset&&"Asset::Image"===e.asset._type&&(w[e.asset.url]||(w[e.asset.url]=new Image,w[e.asset.url].src=e.asset.url))};return n.debugInBrowser,d}function ittTimeline(e,t,i,n,a){return{restrict:"A",replace:!0,scope:!0,template:ws.a,controller:"TimelineController",link:function(r,s){function adjustHigh(e){return e>98?100:e}function adjustLow(e){return e<3?0:e}function incrementVolume(e){var t=r.currentVolume()+e;t=adjustHigh(t),"function"==typeof r.setVolume&&r.setVolume(t)}function decrementVolume(e){var t=r.currentVolume()-e;t=adjustLow(t),"function"==typeof r.setVolume&&r.setVolume(t)}r.appState=t,r.timeline=i,r.handlePosition=0,r.zoomLevel=1,r.zoomOffset=0,t.isTouchDevice&&!a.getMetaProp("hasBeenPlayed")&&(r.isSuppressed=!0);var o,l,c=r.$watch(function(){return a.getMetaProp("hasBeenPlayed")},function(e){!0===e&&(r.isSuppressed=!1,c())});e(function(){o=s.find(".progressbarContainer"),l=s.find(".progressbar"),f()}),r.autoZoom=function(e){r.savedZoomLevel=r.zoomLevel;var t=e.end_time-e.start_time,i=a.getMetaProp("duration")-e.end_time;r.zoomLevel=Math.min(Math.max(Math.round(.6*i/t),1),20),p()},r.endAutoZoom=function(){r.savedZoomLevel&&(r.zoomLevel=r.savedZoomLevel,p(),delete r.savedZoomLevel)};var d=r.$watch(function(){return t.editEvent},function(e){"producer"===t.product&&(e?r.autoZoom(e):r.endAutoZoom())});r.appState=t,r.setNewLanguage=function(){n.setLanguageStrings()},r.showSceneMenuTooltip=function(e){e&&!t.isTouchDevice?r.sceneMenuToolTip=!0:r.sceneMenuToolTip=!1},r.prevScene=function(){i.prevScene()},r.nextScene=function(){i.nextScene()},r.userChangingVolume=function(e){a.getMetaProp("muted")&&r.toggleMute();var t=angular.element(e.currentTarget),i=function(e,i){var n=(e.clientX-t.offset().left)/t.width()*100;n>98&&(n=100),n<3&&(n=0),i?r.setVolume(n):r.$apply(r.setVolume(n))};i(e,!0),t.bind("mousemove.volume",i),angular.element(document).bind("mouseup.volume",function(){angular.element(document).unbind("mouseup.volume"),t.unbind("mousemove.volume")})};var u={PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40};r.onVolumeKeyDown=function(e){var t=e,i=!0;switch(t.keyCode){case u.LEFTARROW:decrementVolume(1),i=!1;break;case u.RIGHTARROW:case u.UPARROW:incrementVolume(1),i=!1;break;case u.DOWNARROW:decrementVolume(1),i=!1;break;case u.PAGEUP:incrementVolume(10),i=!1;break;case u.PAGEDOWN:decrementVolume(10),i=!1;break;case u.HOME:decrementVolume(100),i=!1;break;case u.END:incrementVolume(100),i=!1;break;default:i=!0}i||(e.stopPropagation(),e.preventDefault())},r.currentVolume=function(){return a.getMetaProp("muted")?0:a.getMetaProp("volume")},r.audioIcon=function(){return a.getMetaProp("muted")?"muted":"vol"+Math.floor(a.getMetaProp("volume")/34)},r.showTooltip=function(e){e.showTooltip=!0},r.hideTooltip=function(e){e.showTooltip=!1},r.zoomIn=function(){r.stopWatching=!0,r.zoomLevel=r.zoomLevel+1,p()},r.zoomOut=function(){r.stopWatching=!0,r.zoomLevel<=2?r.zoomLevel=1:r.zoomLevel<=3?r.zoomLevel=1.5:r.zoomLevel=r.zoomLevel/2,p()};var p=function(){r.zoomOffset=-(r.zoomLevel-1)*(a.getMetaProp("time")/a.getMetaProp("duration")),o.stop().animate({left:100*r.zoomOffset+"%",width:100*r.zoomLevel+"%"},1e3,function(){r.stopWatching=!1})};r.$watch(function(){return{t:a.getMetaProp("time"),d:a.getMetaProp("duration")}},function(){r.stopWatching||(r.zoomOffset=-(r.zoomLevel-1)*(a.getMetaProp("time")/a.getMetaProp("duration")),o&&o.css({left:100*r.zoomOffset+"%"}))},!0);var m=function(i){a.pauseOtherPlayers(),e(function(){r.seekHandleVisible=!0},250),r.isSeeking=!0;var n=t.isTouchDevice?"touchend.timeline":"mouseup.timeline";l.bind(n,function(){g()}),angular.element(document).bind(n,function(){h()}),v(i)};r.$watch(function(){return a.getMetaProp("time")},function(){t.editEvent&&(r.willSeekTo=a.getMetaProp("time"))});var v=function(e){if(r.isSeeking){var t=a.getMetaProp("duration");r.willSeekTo=(e.clientX-o.offset().left)/o.width()*t,r.willSeekTo<0&&(r.willSeekTo=0),r.willSeekTo>t&&(r.willSeekTo=t)}},g=function(){r.stopWatching=!0,r.enableAutoscroll(),i.seek(r.willSeekTo,"scrubTimeline"),p()},h=function(){angular.element(document).off("mouseup.timeline"),angular.element(document).off("touchend.timeline"),l.off("mouseup.timeline"),l.off("touchend.timeline"),e(function(){r.isSeeking=!1,r.seekHandleVisible=!1})},f=function(){var e=$(s.find(".playhead"));t.isTouchDevice?(e.on("touchstart.timeline",function(e){m(e.originalEvent.targetTouches[0]),e.preventDefault()}),e.on("touchmove.timeline",function(e){v(e.originalEvent.targetTouches[0]),e.preventDefault()})):(e.on("mousedown.timeline",function(e){m(e),e.preventDefault()}),e.on("mousemove.timeline",function(e){v(e),e.preventDefault()}))};r.$on("$destroy",function(){h(),d()})}}}function TimelineController(e,t,i,n,a,r,s){function setBtnClass(){var t=_getTimelineState();return!0===n.allowPlayback(t)?(e.controlText="play","button-play"):(e.controlText="pause","button-pause")}function timelineBtnClick(){n.togglePlayback(null,i.restartEpisode,a.captureEpisodeActivity.bind(a))}function _getTimelineState(){return n.getTimelineState()}e.playbackService=n,e.timelineBtnClick=timelineBtnClick,e.setBtnClass=setBtnClass,t.$on("userKeypress.SPACE",timelineBtnClick),e.changeSpeed=function(e){var t=n.getMetaProp("timeMultiplier")+e;t<.5&&(t=.5),t>2&&(t=2),i.setSpeed(t)},e.resetSpeed=function(){i.setSpeed(1)},e.markerPercent=function(e){return void 0===e?0:e/n.getMetaProp("duration")*100},e.toggleMute=function(){i.toggleMute()},e.setVolume=function(e){i.setVolume(e)},e.$on("$destroy",function(){i.pause()})}function ittVideo(){return{replace:!1,template:xs.a,scope:{poster:"=?",mainPlayer:"=",mediaSrcArr:"=",playerId:"="},controller:["$scope","$timeout","$interval","$sce","$rootScope","$routeParams","playbackService","ittUtils","timelineSvc","modelSvc","dataSvc","appState","analyticsSvc",function(e,t,i,n,a,r,s,o,l,c,d,u,p){function onInit(){if(!v(m.mediaSrcArr)||0===m.mediaSrcArr.length)return void(m.transcodedInterval=i(checkTranscoded,1e4));s.seedPlayer(m.mediaSrcArr,m.playerId,m.mainPlayer),m.playerElement=n.trustAsHtml(s.getPlayerDiv(m.playerId)),t(function(){s.createInstance(m.playerId),!0===m.mainPlayer&&(r.t&&s.setMetaProp("startAtTime",o.parseTime(r.t),m.playerId),"true"===r.autoplay&&s.setMetaProp("autoplay",!0,m.playerId))},0)}function videoClick(){s.togglePlayback(m.playerId,l.restartEpisode,p.captureEpisodeActivity.bind(p))}function setCssClass(){var e={},t={"np--embed":!1===m.mainPlayer},i={play:playerIsPaused()},n={firstplay:showUnstartedOverlay()},a={rewind:showReplayOverlay()};return angular.extend(e,t,i,n,a),e}function showMask(){return!(v(u.iOSVersion)&&u.iOSVersion.length&&"youtube"===s.getMetaProp("videoType",m.playerId)&&showUnstartedOverlay())||u.iOSVersion[0]>9}function playerIsPaused(){return"paused"===s.getPlayerState(m.playerId)&&!showReplayOverlay()}function showUnstartedOverlay(){return!1===s.getMetaProp("hasBeenPlayed",m.playerId)}function showReplayOverlay(){var e=s.getMetaProp("time",m.playerId),t=s.getMetaProp("duration",m.playerId);return!0===m.mainPlayer&&e>0&&e>=t-.3}function onDestroy(){s.handle$Destroy(m.playerId)}function checkTranscoded(){var e=c.episodes[u.episodeId];e&&e.masterAsset&&!c.isTranscoded(e.masterAsset)?d.getSingleAsset(e.master_asset_id).then(function(e){c.cache("asset",e);var t=c.assets[e._id];c.isTranscoded(t)&&(m.isTranscoded=!0,i.cancel(m.transcodedInterval),m.mediaSrcArr=t.mediaSrcArr,a.$broadcast("dataSvc.getEpisode.done"),onInit())}):i.clear(m.transcodedInterval)}var m=this;m.isTranscoded=!1,m.transcodedInterval=angular.noop,m.playbackService=s,m.videoClick=videoClick,m.playerIsPaused=playerIsPaused,m.showUnstartedOverlay=showUnstartedOverlay,m.showReplayOverlay=showReplayOverlay,m.setCssClass=setCssClass,m.showMask=showMask,m.appState=u;var v=o.existy;e.$on("$destroy",onDestroy),onInit()}],bindToController:!0,controllerAs:"$ctrl"}}function playbackService_playbackService(e,t,i,n,a,r,s,o,l){function handleTimelineEnd(e){e=_setPid(e),h(p[e])&&p[e].handleTimelineEnd(e)}function seedPlayer(e,t,i){if(!0!==i||!h(p[t])){var n=s.parseMediaSrcArr(e),a=_getPlayerManagerFromMediaSrc(n);p[t]=a,u=!1,i&&(c=t,"wistia"!==a.type&&_pollBufferedPercent()),a.seedPlayerManager(t,i,n[0].mediaSrcArr)}}function createInstance(e){p[e].create(e)}function play(e){angular.forEach(v,function(t){t.pauseOtherPlayers(_setPid(e))}),!0===getMetaProp("ready",_setPid(e))&&p[_setPid(e)].play(_setPid(e))}function pause(e){!0===getMetaProp("ready",_setPid(e))&&p[_setPid(e)].pause(_setPid(e))}function seek(e,t){!0===getMetaProp("ready",_setPid(t))&&p[_setPid(t)].seekTo(_setPid(t),parseFloat(e))}function allowPlayback(e){return"paused"===e||"unstarted"===e||"video cued"===e||"ended"===e||"player ready"===e}function togglePlayback(e,t,i){e=_setPid(e);var n=getPlayerState(e);if(getMetaProp("time",e)>=getMetaProp("duration",e)&&e===c)return t();!0===allowPlayback(n)?play(e):(pause(e),i("pause"))}function pauseOtherPlayers(e){angular.forEach(v,function(t){t.pauseOtherPlayers(_setPid(e))}),angular.forEach(p,function(t,i){i!==e&&i!==c&&t.setMetaProp(i,"playerState","2")})}function registerStateChangeListener(e){for(var t=m.length;t--;)if(e.toString()===m[t].toString())return;m.push(e)}function unregisterStateChangeListener(e){m=m.filter(function(t){return t.toString()!==e.toString()})}function getCurrentTime(e){if(h(p[_setPid(e)]))return p[_setPid(e)].getCurrentTime(_setPid(e))}function getPlayerDiv(e){return p[_setPid(e)].getPlayerDiv(_setPid(e))}function getPlayerState(e){return p[_setPid(e)].getPlayerState(_setPid(e))}function setSpeed(e,t){return p[_setPid(t)].setSpeed(_setPid(t),e)}function toggleMute(e){return p[_setPid(e)].toggleMute(_setPid(e))}function setVolume(e,t){p[_setPid(t)].setVolume(_setPid(t),e)}function getMetaProp(e,t){var i=_setPid(t);if(h(p[i]))return p[i].getMetaProp(i,e)}function setMetaProp(e,t,i){var n=_setPid(i);h(p[n])&&p[n].setMetaProp(n,e,t)}function getTimelineState(){return g}function setTimelineState(e){g=e}function freezeMetaProps(e){p[_setPid(e)].freezeMetaProps(_setPid(e))}function unFreezeMetaProps(e){p[_setPid(e)].unFreezeMetaProps(_setPid(e))}function resetPlaybackService(){u=!0,p={},angular.forEach(v,function(e){e.resetPlayerManager()}),c="",g="",e.cancel(d)}function handle$Destroy(e){e!==c?!1===u&&_handleEmbedDestroy(e):_emitStateChange("reset")}function stop(e){p[_setPid(e)].stop(_setPid(e))}function renamePid(e,t){h(p[e])&&p[e].renamePid(e,t),e===c&&(c=t),r.renameKey(e,t,p)}function _getBufferedPercent(e){return e=_setPid(e),p[e].getBufferedPercent(e)}function _handleEmbedDestroy(e){setMetaProp("startAtTime",getCurrentTime(e),e),setMetaProp("hasResumedFromStartAt",!1,e),setMetaProp("ready",!1,e),freezeMetaProps(e)}function _setPid(e){return h(e)?e:c}function _emitStateChange(e){angular.forEach(m,function(t){t(e)})}function _onPlayerReady(e){var t=l[getMetaProp("playerState",e)],i=getMetaProp("startAtTime",e),n=getMetaProp("hasResumedFromStartAt",e),a=getMetaProp("resetInProgress",e);if(setMetaProp("ready",!0,e),e===c&&!1===a&&(setMetaProp("playerState","5",e),_emitStateChange("video cued")),0===i&&!0===getMetaProp("autoplay",e)&&(play(e),setMetaProp("autoplay",!1,e)),i>0&&!1===n){if(seek(i,e),!0===a)return play(e),void setMetaProp("resetInProgress",!1,e);!0===getMetaProp("autoplay",e)&&(play(e),setMetaProp("autoplay",!1,e)),e!==c&&(setMetaProp("hasResumedFromStartAt",!0,e),"playing"===t&&play(e))}}function _stateChangeCB(e){var t=e.state,i=e.emitterId;switch(t){case"unstarted":case"ended":break;case"playing":!1===getMetaProp("hasBeenPlayed",i)&&setMetaProp("hasBeenPlayed",!0,i);break;case"paused":case"buffering":case"video cued":break;case"player ready":_onPlayerReady(i)}"player ready"!==t&&setMetaProp("playerState",o[t],i),i===c&&_emitStateChange(t)}function _pollBufferedPercent(){d=e(function(){setMetaProp("bufferedPercent",_getBufferedPercent(c),c)},200)}function _getPlayerManagerFromMediaSrc(e){for(var t=v.length,i=null;t--;)if(e.length>0&&v[t].type===e[0].type){i=v[t];break}return i}var c,d,u,p={},m=[],v=[i,t,n,a],g="",h=r.existy;return angular.forEach(v,function(e){e.registerStateChangeListener(_stateChangeCB)}),{seedPlayer:seedPlayer,createInstance:createInstance,play:play,pause:pause,seek:seek,getCurrentTime:getCurrentTime,getPlayerState:getPlayerState,toggleMute:toggleMute,setVolume:setVolume,getPlayerDiv:getPlayerDiv,setSpeed:setSpeed,registerStateChangeListener:registerStateChangeListener,unregisterStateChangeListener:unregisterStateChangeListener,getMetaProp:getMetaProp,setMetaProp:setMetaProp,getTimelineState:getTimelineState,setTimelineState:setTimelineState,freezeMetaProps:freezeMetaProps,unFreezeMetaProps:unFreezeMetaProps,pauseOtherPlayers:pauseOtherPlayers,handle$Destroy:handle$Destroy,resetPlaybackService:resetPlaybackService,stop:stop,allowPlayback:allowPlayback,togglePlayback:togglePlayback,renamePid:renamePid,handleTimelineEnd:handleTimelineEnd}}function playerManagerCommons(e){var t=e.existy;return function(i){function getStateChangeListeners(){return a}function getPlayer(e){if(t(n[e]))return n[e]}function setInstance(e,t){getPlayer(e).instance=t}function setPlayer(e,t){n[e]=t}function getMetaProp(e,i){if(t(n[e])&&t(n[e].meta))return n[e].meta[i]}function setMetaProp(e){return function(i,a,s){if(-1===e.indexOf(a))throw new Error(a+" is not a valid prop for"+r+" meta info");if(t(n[i]&&n[i].meta))try{n[i].meta[a]=s}catch(e){}}}function getMetaObj(e){if(t(n[e])&&t(n[e].meta))return n[e].meta}function createMetaObj(e,t){var i=angular.copy(t);return i.meta=angular.extend(i.meta,e),i}function getPlayerDiv(e){return getMetaProp(e,"div")}function pauseOtherPlayers(e,i){return function(a){Object.keys(n).forEach(function(n){if(n!==a){var r=i(n);t(r)&&"playing"===r&&e(n)}})}}function getInstance(e){return function(t){if(!0===e(t))return getPlayer(t).instance}}function registerStateChangeListener(e){for(var t=a.length;t--;)if(e.toString()===a[t].toString())return;a.push(e)}function unregisterStateChangeListener(e){a=a.filter(function(t){return t.toString()!==e.toString()})}function resetPlayerManager(e){return function(){angular.forEach(_getPlayers(),function(t,i){_destroyInstance(i,!0,e)}),n={}}}function renamePid(t,i){e.renameKey(t,i,n)}function handleTimelineEnd(e){return function(t){return e(t)}}function _destroyInstance(e,i,n){t(i)||(i=!1),n(e),!0===i&&setPlayer(e,{})}function _getPlayers(){return n}var n=i.players,a=[],r=i.type;return{commonMetaProps:Ps,getPlayer:getPlayer,setPlayer:setPlayer,getMetaProp:getMetaProp,setInstance:setInstance,setMetaProp:setMetaProp,createMetaObj:createMetaObj,getMetaObj:getMetaObj,getPlayerDiv:getPlayerDiv,getInstance:getInstance,registerStateChangeListener:registerStateChangeListener,unregisterStateChangeListener:unregisterStateChangeListener,getStateChangeListeners:getStateChangeListeners,pauseOtherPlayers:pauseOtherPlayers,resetPlayerManager:resetPlayerManager,renamePid:renamePid,handleTimelineEnd:handleTimelineEnd}}}function urlService_urlService(e,t,i,a){function parseInput(e){var t=checkUrl(e).type;if(t.length>0)return r[t].parseInput(e)}function parseMediaSrcArr(e){return Object.keys(r).reduce(function(t,i){var n=r[i].parseMediaSrc(e);return n.mediaSrcArr.length>0&&t.push(n),t},[])}function isVideoUrl(e){return checkUrl(e).type.length>0}function checkUrl(e){return Object.keys(r).reduce(function(t,i){return r[i].canPlay(e)&&(t.type=i,t.mimeType=r[i].getMimeType(e)),t},{type:"",mimeType:""})}function getOutgoingUrl(e,t){var i=checkUrl(e).type;if(i.length>0)return r[i].getOutgoingUrl(e,t)}function resolveVideo(t){var r={youtube:[],mp4:[],webm:[],m3u8:[],kaltura:[],wistia:[]},s=/\.(\w+)$/;if(t.alternate_urls){for(var o=0;o<t.alternate_urls.length;o++)t.alternate_urls[o].match(/youtube/)?e.embeddableYoutubeUrl(t.alternate_urls[o])&&r.youtube.push(e.embeddableYoutubeUrl(t.alternate_urls[o])):r[t.alternate_urls[o].match(s)[1]].push(t.alternate_urls[o]);t.you_tube_url&&e.embeddableYoutubeUrl(t.you_tube_url)&&r.youtube.push(e.embeddableYoutubeUrl(t.you_tube_url));var l=/(\d+)x(\d+)\.\w+$/;angular.forEach(Object.keys(r),function(e){r[e]=r[e].sort(function(e,t){return(e.match(l)||[0,0])[1]-(t.match(l)||[0,0])[1]})})}if(0===r.youtube.length&&(t.url&&e.embeddableYoutubeUrl(t.url)&&(r.youtube=[e.embeddableYoutubeUrl(t.url)]),t.you_tube_url&&e.embeddableYoutubeUrl(t.you_tube_url)&&(r.youtube=[e.embeddableYoutubeUrl(t.you_tube_url)])),t.alternate_urls||angular.forEach(["mp4","webm","m3u8"],function(e){0!==r[e].length||t.url.match(/youtube/)||r[e].push(t.url.replace("mp4",e))}),n.youtube.disabled&&delete r.youtube,/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)||delete r.m3u8,/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)){var c,d="t="+(new Date).getTime();angular.forEach(["mp4","webm"],function(e){if(r[e].length>0)for(var t=0;t<r[e].length;t++)c=r[e][t].match(/\?/)?"&":"?",r[e][t]=r[e][t]+c+d})}return i.canPlay(t.url)&&r.kaltura.push(t.url),a.canPlay(t.url)&&r.wistia.push(t.url),t.urls=r,t.mediaSrcArr=_resolveMediaSrcArray(r),t}function _resolveMediaSrcArray(e){return Object.keys(e).reduce(function(t,i){return t=t.concat(e[i])},[])}var r={youtube:e,html5:t,kaltura:i,wistia:a};return{parseMediaSrcArr:parseMediaSrcArr,checkUrl:checkUrl,getOutgoingUrl:getOutgoingUrl,parseInput:parseInput,isVideoUrl:isVideoUrl,resolveVideo:resolveVideo}}function html5PlayerManager(e,t,i,n,a){function html5Ending(e){stop(e);var t=y(e);onEnded.call(t)}function create(e){Object.isFrozen(g(e).meta)&&unFreezeMetaProps(e);var t=document.getElementById(e);_attachEventListeners(t),t.onStateChange=_onStateChange,t.controls=!0,r===e&&(r=e,t.controls=!1),t.load(),g(e).instance=t}function freezeMetaProps(e){Object.freeze(S(e))}function unFreezeMetaProps(e){var t,i,n;n=S(e),t={};for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(o=!0),g(e).meta=t}function seedPlayerManager(e,t,i){if(!(l(g(e))&&b(e,"startAtTime")>0)){t&&(s={},r=e);var n=_initPlayerDiv(e,i),a={mainPlayer:t,videoObj:n.videoObj,div:n.videoElm};h(e,_(a,p))}}function onSeeked(e){var t=getPlayerState(this.id);("playing"===t||"buffering"===t&&!0===n.isIEOrEdge)&&onPlaying.call(this);var i=e.target,a=i.currentTime,r=i.duration;Math.floor(r-a)<=.5&&onEnded.call(this)}function onEnded(){var e=y(this.id);T(this.id,"playerState",0),_emitStateChange(e)}function onCanPlay(){var e=y(this.id);!1===b(this.id,"ready")&&(_emitStateChange(e,6),T(this.id,"duration",e.duration))}function onPlaying(){var e=y(this.id);T(this.id,"playerState",1),_emitStateChange(e)}function onPause(){var e=y(this.id);if(!0===o)return void(o=!1);T(this.id,"playerState",2),_emitStateChange(e)}function onBuffering(){var e=y(this.id);T(this.id,"playerState",3),_emitStateChange(e)}function play(t){var i=y(t),n=b(t,"time"),a=b(t,"ready"),s=e(function(){var o;l(i)&&4===i.readyState&&!0===a&&(o=b(t,"time"),t===r&&n<=o&&(i.currentTime=n),i.play(),e.cancel(s))},10)}function pause(e){y(e).pause()}function stop(e){T(e,"time",b(e,"duration")),pause(e)}function getCurrentTime(e){var t=y(e);if(void 0!==t)return t.currentTime}function getPlayerState(e){var i=g(e);if(l(i))return t[i.meta.playerState]}function seek(e,t){y(e).currentTime=t}function setSpeed(e,t){y(e).playbackRate=t}function toggleMute(e){var t=y(e);t.muted=!t.muted,T(e,"muted",t.muted)}function setVolume(e,t){y(e).volume=t/100,T(e,"volume",t)}function getBufferedPercent(e){var t=y(e);if(t&&-1!==b(e,"playerState")&&t.buffered.length>0){var i=t.buffered.length,n=t.buffered.start(i-1),a=t.buffered.end(i-1);return a<0&&(a-=n,n=0),a/b(e,"duration")*100}}function _initPlayerDiv(e,t){var i=_getHtml5VideoObject(t);return{videoObj:i,videoElm:_drawPlayerDiv(e,i,0)}}function _drawPlayerDiv(e,t,i){var n=document.createElement("video");n.id=e,Object.keys(t).forEach(function(e){var a,r,s,o;a=e,"mp4"===a&&(a="mpeg4"),r=t[e][i],l(r)&&(s="m3u8"===e?"application/x-mpegURL":"video/"+e,o=document.createElement("source"),o.setAttribute("type",s),o.setAttribute("src",r),o.setAttribute("class",a),n.appendChild(o))});var a=document.createElement("p");return a.innerText="Oh no! Your browser does not support the HTML5 Video element.",n.appendChild(a),n.outerHTML}function _formatPlayerStateChangeEvent(e,i){return{emitterId:i,state:t[e]}}function _emitStateChange(e,t){var i,n=g(e.id);i=t||n.meta.playerState,e.onStateChange(_formatPlayerStateChangeEvent(i,e.id))}function _onStateChange(e){angular.forEach(P(),function(t){t(e)})}function _getHtml5VideoObject(e){var t=/(mp4|m3u8|webm)/;return e.reduce(function(e,i){return e[i.match(t)[1]].push(i),e},{mp4:[],webm:[],m3u8:[]})}function _attachEventListeners(e){var t={pause:onPause,playing:onPlaying,waiting:onBuffering,seeked:onSeeked,canplay:onCanPlay,ended:onEnded};Object.keys(t).forEach(function(i){!function(i){e.addEventListener(i,t[i])}(i)})}function _removeEventListeners(e){var t,i=y(e);l(i)&&(t=i,t.removeEventListener("pause",onPause),t.removeEventListener("playing",onPlaying),t.removeEventListener("waiting",onBuffering),t.removeEventListener("seeked",onSeeked),t.removeEventListener("canplay",onCanPlay),t.removeEventListener("ended",onEnded))}var r,s={},o=!1,l=i.existy,c=a({players:s,type:"html5"}),d=c.commonMetaProps,u={videoObj:{},videoType:"html5"},p={instance:null,meta:{}};angular.extend(p.meta,u,d);var m=Object.keys(p.meta),v=function(e){return l(g(e))&&l(g(e).instance)},g=c.getPlayer,h=c.setPlayer,f=c.getPlayerDiv,y=c.getInstance(v),_=c.createMetaObj,S=c.getMetaObj,b=c.getMetaProp,T=c.setMetaProp(m),E=c.registerStateChangeListener,C=c.unregisterStateChangeListener,w=c.pauseOtherPlayers(pause,getPlayerState),k=c.resetPlayerManager(_removeEventListeners),I=c.renamePid,x=c.handleTimelineEnd(html5Ending),P=c.getStateChangeListeners;return{type:"html5",getMetaProp:b,setMetaProp:T,getMetaObj:S,getPlayerDiv:f,pauseOtherPlayers:w,registerStateChangeListener:E,unregisterStateChangeListener:C,resetPlayerManager:k,renamePid:I,seedPlayerManager:seedPlayerManager,create:create,getPlayerState:getPlayerState,play:play,pause:pause,seekTo:seek,getCurrentTime:getCurrentTime,getBufferedPercent:getBufferedPercent,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,freezeMetaProps:freezeMetaProps,unFreezeMetaProps:unFreezeMetaProps,stop:stop,handleTimelineEnd:x}}function html5UrlService_html5UrlService(e){function getMimeType(e){return"video/"+e.match(/(mp4|m3u8|webm)/)[0]}function getOutgoingUrl(e,t){return i(t)&&t>0&&(e+="#t="+t),e}function parseMediaSrc(e){return e.reduce(function(e,t){return isHTML5VideoUrl(t)&&e.mediaSrcArr.push(t),e},{type:t,mediaSrcArr:[]})}function isHTML5VideoUrl(e){return/(.mp4|.m3u8|.webm)/.test(e)}function parseInput(e){if(isHTML5VideoUrl(e))return e}var t="html5",i=e.existy;return{type:t,getMimeType:getMimeType,parseMediaSrc:parseMediaSrc,canPlay:isHTML5VideoUrl,parseInput:parseInput,getOutgoingUrl:getOutgoingUrl}}function youTubePlayerManager(e,t,i,n,a,r,s){function seedPlayerManager(e,t,i){if(!(_existy(f(e))&&T(e,"startAtTime")>0)){t&&(l={},o=e);var n={mainPlayer:t,div:_getPlayerDiv(e),ytId:r.extractYoutubeId(i[0])};y(e,S(n,p))}}function create(e){function handleSuccess(i){f(e).instance=i,E(e,"ytId",t)}function tryAgain(){return _createInstance(e,t,onPlayerStateChange,onPlayerQualityChange,onReady,onError).then(handleSuccess).catch(handleFail)}function handleFail(e){n.error({data:"Network timeout initializing video player. Please try again."},e)}function onPlayerStateChange(e){var t=_getPidFromInstance(e.target);E(t,"playerState",e.data);var i=_formatPlayerStateChangeEvent(e,t),n=T(t,"bufferInterval");e.data===YT.PlayerState.ENDED&&e.target.stopVideo(),e.data===YT.PlayerState.BUFFERING?(n=$(function(){e.target.getPlayerState()===YT.PlayerState.BUFFERING&&_reset(t)},7e3),E(t,"bufferInterval",n)):L(n),_emitStateChange(i)}function onReady(e){var t=_getPidFromInstance(e.target),i=_formatPlayerStateChangeEvent({data:"6"},t);E(t,"duration",e.target.getDuration()),_emitStateChange(i)}function onPlayerQualityChange(e){var t=_getPidFromInstance(e.target);"medium"===e.data&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&setPlaybackQuality(t,"large")}function onError(e){var t=_getPidFromInstance(e.target);5===e.data&&_reset(t)}var t=T(e,"ytId");_createInstance(e,t,onPlayerStateChange,onPlayerQualityChange,onReady,onError).then(handleSuccess).catch(tryAgain)}function setSpeed(e,t){var i=_(e);_existy(i)&&i.getAvailablePlaybackRates().length>1&&i.setPlaybackRate(t)}function getCurrentTime(e){var t=_(e);if(_existy(t))return _tryCommand(t,"getCurrentTime")}function playerState(e){var t=_(e);if(_existy(t))return a[_tryCommand(t,"getPlayerState")]}function play(e){var t=_(e);_existy(t)&&_tryCommand(t,"playVideo")}function pause(e){var t=_(e);_existy(t)&&_tryCommand(t,"pauseVideo")}function stop(e){var t=_(e);_existy(t)&&_tryCommand(t,"stopVideo")}function setPlaybackQuality(e,t){var i=_(e);_existy(i)&&i.setPlaybackQuality(t)}function getVideoLoadedFraction(e){var t=_(e);if(_existy(t))return 100*t.getVideoLoadedFraction()}function seekTo(e,t){var i=_(e),n=T(e,"ytId"),r=a[T(e,"playerState")],s=playerState(e);if(_existy(i))if("video cued"===s)switch(r){case"paused":case"playing":i.cueVideoById(n,t);break;case"video cued":e===o?(t>.1&&!1===T(e,"autoplay")&&C(_seekPauseListener),_tryCommand(i,"seekTo",t)):i.cueVideoById(n,t)}else _tryCommand(i,"seekTo",t,!0)}function toggleMute(e){var t=_(e);t.isMuted()?(t.unMute(),E(e,"muted",!1)):(t.mute(),E(e,"muted",!0))}function setVolume(e,t){var i=_(e);_existy(i)&&(i.setVolume(t),E(e,"volume",t))}function _seekPauseListener(e){"playing"===e.state&&(w(_seekPauseListener),pause(e.emitterId))}function _reset(e){var t=_(e),i=T(e,"mainPlayer");if(_existy(t)){var n=t.getVideoData().video_id,a=t.getCurrentTime();!0===i?t.cueVideoById(n,a):t.loadVideoById(n,a)}}function _createInstance(t,n,a,r,s,l){var c=1;t===o&&(c=0);var d=e.host();return i.load().then(function(){return new YT.Player(t,{videoId:n,playerVars:{controls:c,fs:c,enablejsapi:1,modestbranding:1,showinfo:0,rel:0,iv_load_policy:3,origin:d,wmode:"transparent"},events:{onReady:s,onStateChange:a,onPlaybackQualityChange:r,onError:l}})})}function _existy(e){return null!=e}function _getPidFromInstance(e){return e.getIframe().id}function _formatPlayerStateChangeEvent(e,t){return{emitterId:t,state:a[e.data]}}function _emitStateChange(e){N().forEach(function(t){t(e)})}function _getPlayerDiv(e){return'<div id="'+e+'"></div>'}function _tryCommand(e,t,i,n){var a;try{_existy(i)&&_existy(n)?e[t](i,n):_existy(i)?e[t](i):a=e[t]()}catch(e){}if(_existy(a))return a}var o,l={},c=s({players:l,type:"youtube"}),d=c.commonMetaProps,u={ytId:"",videoType:"youtube",bufferInterval:null},p={instance:null,meta:{}};angular.extend(p.meta,u,d);var m=Object.keys(p.meta),v=function(e){return _existy(f(e))&&!0===T(e,"ready")},g=function(e){_tryCommand(_(e),"destroy")},h=function(e){E(e,"time",T(e,"duration")),t.ngTimeout(function(){"ended"!==playerState(e)&&stop(e)},500)},f=c.getPlayer,y=c.setPlayer,_=c.getInstance(v),S=c.createMetaObj,b=c.getMetaObj,T=c.getMetaProp,E=c.setMetaProp(m),C=c.registerStateChangeListener,w=c.unregisterStateChangeListener,k=c.pauseOtherPlayers(pause,playerState),I=c.getPlayerDiv,x=c.resetPlayerManager(g),P=c.renamePid,A=c.handleTimelineEnd(h),$=t.ngTimeout,L=t.cancelNgTimeout,N=c.getStateChangeListeners;return{type:"youtube",getMetaProp:T,setMetaProp:E,getMetaObj:b,getPlayerDiv:I,pauseOtherPlayers:k,registerStateChangeListener:C,unregisterStateChangeListener:w,resetPlayerManager:x,renamePid:P,seedPlayerManager:seedPlayerManager,create:create,play:play,pause:pause,seekTo:seekTo,getCurrentTime:getCurrentTime,getPlayerState:playerState,getBufferedPercent:getVideoLoadedFraction,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,setPlaybackQuality:setPlaybackQuality,freezeMetaProps:angular.noop,unFreezeMetaProps:angular.noop,stop:stop,handleTimelineEnd:A}}function YTScriptLoader(e,t){function load(){var n;return e(function(e,a){if(n=t(a,i),"undefined"==typeof YT||void 0===YT.Player){var r=document.createElement("script");r.src="//www.youtube.com/iframe_api",r.id="yt-iframe-api";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(r,s)}else t.cancel(n),e();window.onYouTubeIframeAPIReady=function(){t.cancel(n),e()}})}var i=2e3;return{load:load}}function youtubeUrlService_youtubeUrlService(e){function getMimeType(){return i}function getOutgoingUrl(e,i){return e=embeddableYoutubeUrl(e,!1),t(i)&&i>0&&(e+="&start="+i),e}function extractYoutubeId(e){if(!e)return!1;e=e.replace(/%3F/,"?"),e=e.replace(/%26/,"&");var t=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,i=e.match(t);return!(!i||!i[1])&&i[1]}function isYoutubeUrl(e){return!!e&&(e=e.replace(/%3F/,"?"),e=e.replace(/%26/,"&"),/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i.test(e))}function parseMediaSrc(e){return e.reduce(function(e,t){return isYoutubeUrl(t)&&e.mediaSrcArr.push(t),e},{type:"youtube",mediaSrcArr:[]})}function embedParams(e){return!1===e?"?controls=1&autoplay=1&modestbranding=1&showinfo=1&rel=0&iv_load_policy=3&wmode=transparent":"?enablejsapi=1&controls=0&modestbranding=1&showinfo=0&rel=0&iv_load_policy=3&wmode=transparent"}function createEmbedLinkFromYoutubeId(e,t){return!!e&&"//www.youtube.com/embed/"+e+(t?"":embedParams(t))}function embeddableYoutubeUrl(e,t){return!!e&&createEmbedLinkFromYoutubeId(extractYoutubeId(e),t)}var t=e.existy,i="video/x-youtube";return{type:"youtube",getMimeType:getMimeType,extractYoutubeId:extractYoutubeId,isYoutubeUrl:isYoutubeUrl,canPlay:isYoutubeUrl,parseMediaSrc:parseMediaSrc,embedParams:embedParams,createEmbedLinkFromYoutubeId:createEmbedLinkFromYoutubeId,embeddableYoutubeUrl:embeddableYoutubeUrl,parseInput:embeddableYoutubeUrl,getOutgoingUrl:getOutgoingUrl}}function kalturaPlayerManager(e,t,i,n,a){function create(e){function handleSuccess(){}function readyCallback(e){var t=document.getElementById(e);g(e).instance=t,_attachEventListeners(t,e)}var t=b(e,"ktObj");_createKWidget(e,t.partnerId,t.entryId,t.uiconfId,readyCallback).then(handleSuccess)}function seedPlayerManager(e,t,i){if(!(o(g(e))&&b(e,"startAtTime")>0)){t&&(s={},r=e);var n=a.getKalturaObject(i[0]),l={mainPlayer:t,div:_getPlayerDiv(e),ktObj:n};h(e,_(l,u))}}function onMediaReady(e){_emitStateChange(e,6),T(e,"duration",_kdpEval(e,"duration"))}function onPlaying(e){T(e,"playerState",1),!0===b(e,"ready")&&_emitStateChange(e)}function onPaused(e){T(e,"playerState",2),_emitStateChange(e)}function onBufferEnd(e){var i=t[b(this.id,"playerState")],n=b(this.id,"bufferTimeout");o(n)&&A(n),"buffering"===i&&play(this.id)}function onBufferStart(){var e=this.id,t=P(function(){_reset(e)},15e3);T(this.id,"bufferTimeout",t),T(this.id,"playerState",3),_emitStateChange(this.id)}function onPlayerPlayEnd(e){T(e,"playerState",0),_emitStateChange(e)}function onMediaError(e){}function onUpdatedPlaybackRate(e){}function onPlayerUpdatePlayhead(e){T(this.id,"time",e)}function play(e){_sendKdpNotice(e,"doPlay")}function pause(e){_sendKdpNotice(e,"doPause")}function seekTo(e,t){t>60&&t%10==0&&(t-=.5),_sendKdpNotice(e,"doSeek",t)}function stop(e){_sendKdpNotice(e,"doStop")}function getPlayerState(e){return t[b(e,"playerState")]}function getCurrentTime(e){return _kdpEval(e,"video.player.currentTime")||0}function getBufferedPercent(e){if(!0===b(e,"ready"))return 100*_kdpEval(e,"video.buffer.percent")}function toggleMute(e){var t=b(e,"muted");!1===t?(T(e,"lastVol",b(e,"volume")),setVolume(e,0)):setVolume(e,b(e,"lastVol")),T(e,"muted",!t)}function setSpeed(e,t){_sendKdpNotice(e,"playbackRateChangeSpeed",t)}function setVolume(e,t){_sendKdpNotice(e,"changeVolume",t/100),T(e,"volume",t)}function _reset(e,t){var i=t||b(e,"time");T(e,"startAtTime",i),T(e,"hasResumedFromStartAt",!1),T(e,"resetInProgress",!0),_sendKdpNotice(e,"changeMedia",{entryId:b(e,"ktObj").entryId}),T(e,"ready",!1)}function _sendKdpNotice(e,t,i){var n=y(e);try{o(i)?n.sendNotification(t,i):n.sendNotification(t)}catch(e){}}function _createKWidget(e,t,i,a,s){var o={targetId:e,wid:"_"+t,uiconf_id:a,readyCallback:s,entry_id:i,flashvars:{"playbackRateSelector.plugin":!0,"controlBarContainer.plugin":!1,"largePlayBtn.plugin":!1,"loadingSpinner.plugin":!0,"closedCaptions.displayCaptions":!1}},l={"EmbedPlayer.NativeControls":!0,"EmbedPlayer.DisableHTML5FlashFallback":!0};return e!==r&&angular.extend(o.flashvars,l),n.load(t,a).then(function(){KWidget.embed(o)})}function _getPlayerDiv(e){return'<div id="'+e+'"></div>'}function _attachEventListeners(e,t){var i={playerPlayed:onPlaying,playerPaused:onPaused,bufferStartEvent:onBufferStart,bufferEndEvent:onBufferEnd,playerPlayEnd:onPlayerPlayEnd,mediaError:onMediaError,mediaReady:onMediaReady,updatedPlaybackRate:onUpdatedPlaybackRate,playerUpdatePlayhead:onPlayerUpdatePlayhead};Object.keys(i).forEach(function(n){!function(n){e.kBind(n+"."+t,i[n])}(n)})}function _removeEventListeners(e){y(e).kUnbind("."+e)}function _emitStateChange(e,t){var i;i=t||b(e,"playerState"),$().forEach(function(t){t(_formatPlayerStateChangeEvent(i,e))})}function _kdpEval(e,t){var i=y(e);if(o(i))return i.evaluate("{"+t+"}")}function _formatPlayerStateChangeEvent(e,i){return{emitterId:i,state:t[e]}}var r,s={},o=e.existy,l=i({players:s,type:"kaltura"}),c=l.commonMetaProps,d={ktObj:{},videoType:"kaltura",bufferTimeout:null,seekTimeout:null,lastVol:100},u={instance:null,meta:{}};angular.extend(u.meta,d,c);var p=Object.keys(u.meta),m=function(e){return o(g(e))&&!0===b(e,"ready")},v=function(e){},g=l.getPlayer,h=l.setPlayer,f=l.getPlayerDiv,y=l.getInstance(m),_=l.createMetaObj,S=l.getMetaObj,b=l.getMetaProp,T=l.setMetaProp(p),E=l.registerStateChangeListener,C=l.unregisterStateChangeListener,w=l.pauseOtherPlayers(pause,getPlayerState),k=l.resetPlayerManager(_removeEventListeners),I=l.renamePid,x=l.handleTimelineEnd(v),P=e.ngTimeout,A=e.cancelNgTimeout,$=l.getStateChangeListeners;return{type:"kaltura",getMetaProp:b,setMetaProp:T,getMetaObj:S,getPlayerDiv:f,pauseOtherPlayers:w,registerStateChangeListener:E,unregisterStateChangeListener:C,resetPlayerManager:k,renamePid:I,seedPlayerManager:seedPlayerManager,create:create,getPlayerState:getPlayerState,play:play,pause:pause,seekTo:seekTo,getCurrentTime:getCurrentTime,getBufferedPercent:getBufferedPercent,toggleMute:toggleMute,setVolume:setVolume,setSpeed:setSpeed,freezeMetaProps:angular.noop,unFreezeMetaProps:angular.noop,stop:stop,handleTimelineEnd:x}}function kalturaScriptLoader(e,t){function load(t,a){return e(function(e){var r=a+t;n(i[r])||(i[r]="ready"),"undefined"==typeof KWidget?_loadScript(t,a,i,e):"ready"===i[r]?_loadScript(t,a,i,e):e()})}function _loadScript(e,t,i,n){var a=_getScriptTagSrc(e,t),r=_appendScript(a,e);r.onload=n,i[t+e]=r}function _getScriptTagSrc(e,t){return"https://cdnapisec.kaltura.com/p/"+e+"/sp/"+e+"00/embedIframeJs/uiconf_id/"+t+"/partner_id/"+e}function _appendScript(e,t){var i=document.createElement("script");i.src=e,i.id=t;var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(i,n),i}var i={},n=t.existy;return{load:load}}function kalturaUrlService_kalturaUrlService(){function getMimeType(){return t}function parseInput(e){return buildAutoEmbedURLFromKalturaObject(getKalturaObject(e),1024,768)}function parseMediaSrc(t){return t.reduce(function(e,t){return isKalturaUrl(t)&&e.mediaSrcArr.push(t),e},{type:e,mediaSrcArr:[]})}function isKalturaUrl(e){var t=["partnerId","uiconfId","entryId","uniqueObjId"],i=getKalturaObject(e);return t.every(function(e){return i.hasOwnProperty(e)&&null!=i[e]})}function getKalturaObject(e){var t,i={},n=[];return null==e?{partnerId:null,uiconfId:null,entryId:null,uniqueObjId:null}:("<script"===e.substring(0,7)?(n=/^.*?src\=.https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*?)\".*/g.exec(e),null!=n?(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.entryId=t.entry_id,i.uniqueObjId=t.playerId):i=getKalturaObjectFromDynamicEmbedCode(e)):"<div"===e.substring(0,4)?i=getKalturaObjectFromDynamicEmbedCode(e):"<iframe"===e.substring(0,7)?null!=(n=/^.*?src\=.https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*?)\".*/g.exec(e))&&(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.uniqueObjId=t.playerId,i.entryId=t.entry_id):"<object"===e.substring(0,7)?null!=(n=/^.*\n*?.*?id\=.(.*?)\"(.*?\n*)*?data\=.*?https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/kwidget\/wid\/_(.*?)\/uiconf_id\/(.*?)\/entry_id\/(.*?)\".*/g.exec(e))&&(i.uniqueObjId=n[1],i.partnerId=n[3],i.uiconfId=n[4],i.entryId=n[5]):"http"===e.substring(0,4)&&null!=(n=/^https?\:\/\/(?:www|cdnapi|cdnapisec)\.kaltura\.com\/p\/(.*?)\/sp\/(.*?)00.*?\/embedIframeJs\/uiconf_id\/(.*?)\/partner_id\/(.*?)\?(.*)/g.exec(decodeURIComponent(e)))&&(i.partnerId=n[1],i.uiconfId=n[3],t=parseUrlParams(n[5]),i.entryId=t.entry_id,i.uniqueObjId=t.playerId),i)}function buildAutoEmbedURLFromKalturaObject(e,t,i){return"https://cdnapisec.kaltura.com/p/"+e.partnerId+"/sp/"+e.partnerId+"00/embedIframeJs/uiconf_id/"+e.uiconfId+"/partner_id/"+e.partnerId+"?entry_id="+e.entryId+"&playerId="+e.uniqueObjId+"&autoembed=true&width="+t+"&height="+i}function parseUrlParams(e){return"&"==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),JSON.parse('{"'+e.replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}function getKalturaObjectFromDynamicEmbedCode(e){var t={},i=/^(?:.|\n|\r)*?kWidget\..*?mbed\(({(?:.|\n|\r)*})\).*?/g.exec(e);if(null!=i){var n=JSON.parse(i[1]);t.uniqueObjId=n.targetId,t.partnerId=n.wid.substring(1),t.uiconfId=n.uiconf_id,t.entryId=n.entry_id}return t}var e="kaltura",t="video/x-"+e;return{type:e,getMimeType:getMimeType,canPlay:isKalturaUrl,parseMediaSrc:parseMediaSrc,getKalturaObject:getKalturaObject,buildAutoEmbedURLFromKalturaObject:buildAutoEmbedURLFromKalturaObject,parseInput:parseInput,getOutgoingUrl:function(){}}}function questionAnswersSvc_questionAnswersSvc(e,t,i){var n={};return n.saveAnswer=function(e,i,n){return t.forceCaptureEventActivityWithPromise(e,i,n)},n.getAnswers=function(n){var a=e.defer();return t.readEventActivity(n).then(function(e){var t=e.filter(function(e){return("question-answered"===e.name||"question-answered-updated"===e.name)&&e.episode_id===i.episodeId});a.resolve(t)}),a.promise},n.getUserAnswer=function(t,i){var a=e.defer();return n.getAnswers(t).then(function(e){if(!e)return a.reject();var t=e.filter(function(e){return e.user_id===i});t.length>0?a.resolve(t[0]):a.reject()}),a.promise},n.calculateCounts=function(e){var t;return angular.forEach(e,function(e){t[e.data.index]++}),t},n.incrementAnswerCount=function(e,t){e[t]=(e[t]||0)+1},n}function ittFlotr2Chart(){var e=1;return{restrict:"E",scope:{type:"@",height:"@",width:"@",title:"=title",options:"@",data:"@"},template:'<div class="flotContainer"><div class="chartContainer" id="chartContainer" aria-label="{{chartLabel}}"></div><div class="legendContainer" id="legendContainer"></div></div>',link:function(t,i,n){var a=function(e,i,n){t.chartLabel=d(i),$.plot(e,i,n),e.show()},r=$("#chartContainer");r.attr("id","chartContainer"+e);var s=$("#legendContainer");s.attr("id","legendContainer"+e++);var o=function(e,t){return Math.round(t.percent)+"% ("+t.data[0][1]+"): "+e},l=function(e,t){return'<div style="padding: 3px; font-size: 80%">'+Math.round(t.percent)+"%</div>"};t.chartOptions={series:{pie:{show:!0,label:{show:!0,background:{opacity:.7},formatter:l}}},legend:{show:!0,labelFormatter:o,noColumns:1,position:"sw",margin:0,backgroundColor:null,backgroundOpacity:1,sorted:"descending",container:s},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%y.0, %s",shifts:{x:20,y:0},defaultTheme:!1}},t.$watch(function(){return r.width()},function(e){e>0&&(r.css({height:e}),a(r,JSON.parse(t.data),t.chartOptions),t.observeData=n.$observe("data",function(e){t.data=JSON.parse(e),a(r,t.data,t.chartOptions)}),t.$on("$destroy",t.observeData))});var c=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].data;for(var n=0;n<e.length;n++)e[n].percent=e[n].data/t*100;return e},d=function(e){var t="";e=c(e);for(var i=0;i<e.length;i++)t+=Math.round(e[i].percent)+"% of users totaling "+e[i].data+" choose '"+e[i].label+"'. ";return t}}}}function ittQuestionOptions(){return{restrict:"EA",scope:!0,template:['<div class="field"><div class="label">Answers</div></div>','<div class="field" ng-repeat="distractor in item.data._plugin.distractors track by $index">','\t<div class="label">',"\t\t{{$index | alpha}} &nbsp;",'\t\t<input type="checkbox" ng-model="distractor.correct" ng-change="onFormativeChecked(distractor)" ng-if="item.data._plugin.questiontype == \'mc-formative\'">',"\t</div>",'\t<div class="input" sxs-input-i18n="distractor.text" x-inputtype="\'textarea\'"></div>',"</div>",'<div class="field">','\t<div class="input">','\t\t<button ng-click="addDistractor($event)">Add distractor</button>',"\t</div>","</div>",'<div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'">','\t<div class="label">Feedback when correct</div>','\t<div class="input" sxs-input-i18n="item.data._plugin.correctfeedback" x-inputtype="\'textarea\'"></div>',"</div>",'<div class="field" ng-if="item.data._plugin.questiontype == \'mc-formative\'">','\t<div class="label">Feedback when incorrect</div>','\t<div class="input" sxs-input-i18n="item.data._plugin.incorrectfeedback" x-inputtype="\'textarea\'"></div>',"</div>"].join(" ")}}function ittQuestionTextField(){return{restrict:"EA",scope:{data:"=",doValidate:"=?",ittItemForm:"=?"},template:['<div class="field">','\t<div class="label">Question text','\t\t<itt-validation-tip ng-if="$ctrl.ittItemForm[$ctrl.textAreaName].$invalid" text="Question Text is a required field"></itt-validation-tip>',"\t</div>",'\t<div class="input" do-validate="$ctrl.doValidate" on-emit-name="$ctrl.onName($taName)" sxs-input-i18n="$ctrl.data.data._plugin.questiontext" x-inputtype="\'textarea\'"></div>',"</div>"].join(" "),controller:[function(){function onName(t){e.textAreaName=t}var e=this;e.onName=onName}],controllerAs:"$ctrl",bindToController:!0}}function ittQuestionTypeSelect(){return{restrict:"EA",scope:{data:"="},template:['<div class="field">','\t<div class="label">Template</div>','\t<div class="input">','\t<select ng-model="$ctrl.data.data._plugin.questiontype" ng-options="{{$ctrl.setNgOpts(\'questionType\')}}"></select>',"\t</div>","</div>"].join(" "),controller:["selectService","ittUtils",function(e,t){var i=this;i.setNgOpts=t.setNgOpts,i.getSelectOpts=e.getSelectOpts,function(){e.onSelectChange(i.data,{})}()}],controllerAs:"$ctrl",bindToController:!0}}function ittMcQuestion(e,t,i){return{restrict:"E",replace:!1,scope:{plugin:"=data",qid:"=",choices:"=",correct:"=",onChoice:"=",questionType:"@",showChart:"="},template:qs.a,link:function(n){n.scoreQuiz=function(e){n.plugin.distractors[e].selected=!0,n.plugin.hasBeenAnswered=!0,n.plugin.selectedDistractor=n.plugin.distractors[e].index,t.captureEventActivity("question-answered",n.qid,{answer:n.plugin.distractors[e].text,index:n.plugin.distractors[e].index,correct:!!n.plugin.distractors[e].correct})},n.feedback=function(){for(var e=0;e<n.plugin.distractors.length;e++)if(n.plugin.distractors[e].index===n.plugin.selectedDistractor)return n.plugin.distractors[e].correct?n.plugin.correctfeedback:n.plugin.incorrectfeedback},n.questionType=n.plugin.questiontype,n.chartOptions={};var a=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&angular.forEach(n.plugin.distractors,function(n){if(n.index+""==a+""){var r=n.text;"object"==typeof r&&(r=r[i.lang]||r.en||""),t.push({data:e[a],label:r})}});return t};if(!0===n.plugin.hasBeenAnswered){void 0===n.plugin.answer_counts&&(n.plugin.answer_counts={});var r=n.plugin.answer_counts,s=a(r);n.chartData=s}n.scorePoll=function(t){e.saveAnswer("question-answered",n.qid,{answer:n.plugin.distractors[t].text,index:n.plugin.distractors[t].index,correct:!!n.plugin.distractors[t].correct}).then(function(){n.plugin.answer_counts=void 0===n.plugin.answer_counts?{}:n.plugin.answer_counts,e.incrementAnswerCount(n.plugin.answer_counts,n.plugin.distractors[t].index);var i=n.plugin.answer_counts,r=a(i);n.chartData=r,n.plugin.distractors[t].selected=!0,n.plugin.hasBeenAnswered=!0,n.plugin.selectedDistractor=n.plugin.distractors[t].index})}}}}function textAngularConfig(e){e.decorator("taOptions",["taRegisterTool","$delegate",function(e,t){return t.defaultFileDropHandler=function(e,t){},t.toolbar=[["h1","h2","h3"],["bold","italics","underline","strikeThrough"],["ul","ol"],["undo","redo","clear"]],t}])}function routerConfig(e){e.when("/",{title:"Narrative Producer",template:"<np-root-template></np-root-template>"}).when("/auth",{template:"<np-auth-template></np-auth-template>",reloadOnSearch:!1}).when("/account",{template:['<div class="standaloneAncillaryPage">','\t<np-nav on-logout="logout()"></np-nav>',"\t<h1>My Account</h1>","\t<div itt-user></div>","</div>"].join(""),controller:["$scope","authSvc",function(e,t){e.logout=t.logout}]}).when("/stories",{title:"Available Narratives",template:"<np-narratives-container></np-narratives-container>"}).when("/story/:narrativePath",{title:"Narrative",template:"<np-narrative-container></np-narrative-container>",resolve:{narrativeResolve:["$route","$q","authSvc","dataSvc","modelSvc","ittUtils",function(e,t,i,n,a,r){var s,o=e.current.params.narrativePath,l=a.getNarrativeByPathOrId(o);return r.existy(l)&&r.existy(l.path_slug)&&r.existy(l.timelines)&&(l.path_slug.en===o||l._id===o)?(s=a.customers[l.customer_id],t(function(e){return e({n:l,c:[s]})})):n.getNarrative(o).then(function(e){return n.getCustomer(e.customer_id,!0).then(function(t){return{n:e,c:[t]}})})}]}}).when("/story/:narrativePath/:timelinePath",{template:"<div itt-narrative-timeline></div>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="narrative"}]}}).when("/projects",{title:"Available projects",template:"<np-projects-container></np-projects-container>"}).when("/episode/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="player"}]}}).when("/episode/:epId/:viewMode",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="player",e.productLoadedAs="player"}]}}).when("/sxs/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="sxs",e.productLoadedAs="sxs"}]}}).when("/editor/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["appState",function(e){e.init(),e.product="sxs",e.productLoadedAs="sxs"}]}}).when("/producer/:epId",{title:"Narrative Producer",template:"<itt-player-container></itt-player-container>",resolve:{product:["$route","appState",function(e,t){t.init(),t.episodeId=t.episodeId=e.current.params.epId,t.product="producer",t.productLoadedAs="producer"}]}}).when("/assets/:containerId",{title:"Container Assets test",template:"<np-assets-resolve></np-assets-resolve>"}).otherwise({title:"Narrative Producer: Error",controller:"ErrorController",template:"<np-error-404-template></np-error-404-template>"})}function xDomainConfig(e){e.resourceUrlWhitelist(["self",/.*/,/^http(s)?:\/\/platformuniv-p.edgesuite.net/,/^http(s)?:\/\/themes.googleusercontent.com/])}function authInterceptorConfig(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"],e.interceptors.push(["$q","errorSvc",function(e,t){return{responseError:function(i){return i.data&&i.data.path_slug?e(function(e,t){return t(i)}):(t.error(i),e.reject(i))}}}])}function debugInfoConfig(e){var t=!1,i=window.location.hostname;0!==i.indexOf("localhost")&&0!==i.indexOf("api-dev")&&0!==i.indexOf("np-dev")||(t=!0),!1===t&&e.debugInfoEnabled(!1)}function runFunction(e,t){e.$on("$routeChangeSuccess",function(e,i){document.title=i.title?i.title:"Narrative Producer",t.init()});var i=!1;$(document).on("keydown",function(t){i||"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.attributes.contenteditable||(i=!0,27===t.keyCode&&(e.$emit("userKeypress.ESC"),t.preventDefault()),32===t.which&&(e.$emit("userKeypress.SPACE"),t.preventDefault()))}),$(document).on("keyup",function(){i=!1})}Object.defineProperty(t,"__esModule",{value:!0});var n=(i("l1Qu"),i("DJti"),i("oXgf"),i("oTj3"),i("wdTO"),i("ihzJ"),{localStorageKey:"storyToken",apiDataBaseUrl:"//"+window.location.host,youtube:{domain:"//gdata.youtube.com/",timeout:5e3},disableAnalytics:!1,debugInBrowser:!0});authSvc_authSvc.$inject=["$routeParams","$http","$q","$location","ittUtils","appState","modelSvc","errorSvc"];var a=i("IiAB"),r={noAvatarImg:a,user:{},episodeId:!1,episodeSegmentId:!1,narrativeId:!1,timelineId:!1,resizeIframeReviewMode:!1,isFramed:window.parent!=window,isTouchDevice:/iPad|iPod|iPhone/.test(navigator.platform)||/Android/.test(navigator.userAgent),isIEOrEdge:/Trident|Edge/.test(navigator.userAgent)||/Trident|Edge/.test(navigator.platform),isIPhone:/iPod|iPhone/.test(navigator.platform),iOSVersion:"",windowWidth:0,windowHeight:0,viewMode:$(window).width()>480?"discover":"review",producerEditLayer:0,hideCaptions:!1,show:{searchPanel:!1,navPanel:!1},videoControlsActive:!1,videoControlsLocked:!1,itemDetail:!1,autoscroll:!1,autoscrollBlocked:!1,crossEpisodePath:"",product:"",productLoadedAs:"",editEvent:!1,editEpisode:!1,lang:!1},s=function(){function AppState(e){this.$interval=e,this.initService()}return AppState.getIOSVersion=function(e){var t=/iP(hone|od|ad)/,i=/OS (\d+)_(\d+)_?(\d+)?/;if(t.test(e.platform)||t.test(e.userAgent)){var n=e.appVersion.match(i);return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3]||0,10)]}},AppState.prototype.init=function(){var e;e="sxs"===this.product||"producer"===this.product?this.product:"episode";var t={crossEpisodePath:e,iOSVersion:AppState.getIOSVersion(navigator),product:this.product,productLoadedAs:this.productLoadedAs,user:this.user||{}};Object.assign(this,r,t)},AppState.prototype.initService=function(){this.init(),this.watchWidth()},AppState.prototype.watchWidth=function(){var e=this;this.$interval(function(){e.windowHeight=angular.element(window).height(),e.windowWidth=angular.element(window).width()},50,0,!1),n.debugInBrowser},AppState.prototype.isIframedIOS=function(){return this.isFramed&&this.isIOS()},AppState.prototype.isIOS=function(){return this.iOSVersion&&this.iOSVersion[0]&&this.iOSVersion[0]>0},AppState.Name="appState",AppState.$inject=["$interval"],AppState}();awsSvc_awsSvc.$inject=["$http","$q"],errorSvc_errorSvc.$inject=["$location"],ittUtils_ittUtils.$inject=["$timeout"];var o,l=(function(){function StopWatchUtil(){}StopWatchUtil.of=function(){return new StopWatchUtil},StopWatchUtil.prototype.start=function(e){this._label=e,this._start=window.performance.now()},StopWatchUtil.prototype.stop=function(){window.performance.now(),null!=this._label&&this._label}}(),"social_image_square"),c="social_image_wide",d="magnet.updateMagnet";!function(e){e.LANDINGSCREEN_TEMPLATE="layout-landingscreen",e.ENDINGSCREEN_TEMPLATE="layout-endingscreen",e.CENTERED_TEMPLATE="layout-centered",e.ONECOL_TEMPLATE="layout-onecol",e.CORNER_H_TEMPLATE="layout-corner-h",e.CORNER_V_TEMPLATE="layout-corner-v",e.PIP_TEMPLATE="layout-pip",e.MIRRORED_TWOCOL_TEMPLATE="layout-mirrored-twocol",e.CENTERED_PRO_TEMPLATE="layout-centered-pro",e.CENTER_VV_TEMPLATE="layout-center-vv",e.CENTER_VV_MONDRIAN_TEMPLATE="layout-center-vv-mondrian",e.FILE_TEMPLATE="item-file",e.IMAGE_THUMBNAIL_TEMPLATE="item-image-thumbnail",e.SLIDING_CAPTION="item-image-caption-sliding",e.IMAGE_FILL_TEMPLATE="item-image-fill",e.IMAGE_INLINE_WITHTEXT_TEMPLATE="item-image-inline-withtext",e.IMAGE_PLAIN_TEMPLATE="item-image-plain",e.LINK_TEMPLATE="item-link",e.LINK_DESCRIPTION_FIRST_TEMPLATE="item-link-descriptionfirst",e.LINK_EMBED_TEMPLATE="item-link-embed",e.LINK_MODAL_THUMB_TEMPLATE="item-link-modal-thumb",e.LINK_WITHIMAGE_NOTITLE_TEMPLATE="item-link-withimage-notitle",e.PULLQUOTE_TEMPLATE="item-pullquote",e.QUESTION_TEMPLATE="item-question-mc",e.SXS_ANNOTAITON_TEMPLATE="item-sxs-annotation",e.SXS_FILE_TEMPLATE="item-sxs-file",e.SXS_LINK_TEMPLATE="item-sxs-link",e.SXS_QUESTION_TEMPLATE="item-sxs-question",e.SXS_VIDEO_TEMPLATE="item-sxs-video",e.SXS_IMAGE_TEMPLATE="item-sxs-image",e.TEXT_DEFINITION_TEMPLATE="item-text-definition",e.TEXT_TRANSMEDIA_TEMPLATE="item-text-transmedia",e.HEADER_ONE_TEMPLATE="item-header-one",e.HEADER_TWO_TEMPLATE="item-header-two",e.TRANSCRIPT_TEMPLATE="item-transcript",e.USC_BADGES_TEMPLATE="item-usc-badges",e.USC_BADGES_INNER_TEMPLATE="item-usc-badges-inner"}(o||(o={})),imageResizeSvc_imageResize.$inject=["$q"],mockSvc_mockSvc.$inject=["modelSvc"];var u=function(){function UploadsService(e,t){this.$q=e,this.awsSvc=t,this.uploadsDisplay={social_image_square:null,social_image_wide:null},this.uploadQueue=[]}return UploadsService.prototype.uploadTaggedFiles=function(e,t){var i=this;return this.$q(function(n,a){for(var r=0,s=e;r<s.length;r++){var o=s[r],l=o.file,c=o.tag;i.uploadsDisplay[c]={bytesSent:0,bytesTotal:1,percent:0,name:l[0].name},i.uploadQueue.push(i.uploadToAws(t,l,c))}return i.$q.all(i.uploadQueue).then(function(e){return n(e)}).catch(function(e){return a(e)})})},UploadsService.prototype.resetUploads=function(){this.uploadsDisplay={social_image_square:null,social_image_wide:null},this.uploadQueue=[]},UploadsService.prototype.uploadToAws=function(e,t,i){var n=this;return this.awsSvc.uploadContainerFiles(e,t,i)[0].then(function(e){return e}).catch(function(e){}).finally(null,function(e){n.uploadsDisplay[i].bytesSent=e.bytesSent,n.uploadsDisplay[i].bytesTotal=e.bytesTotal,n.uploadsDisplay[i].percent=Math.ceil(e.bytesSent/e.bytesTotal*100)})},UploadsService.Name="uploadsService",UploadsService.$inject=["$q","awsSvc"],UploadsService}(),p='\n<div class="field">\n  <div class="label">Batch Upload Transcripts\n  </div>\n  <div class="input">\n    <div ng-if="!$ctrl.showUploader">\n      <span><button ng-click="$ctrl.showUploader = true">Batch Upload Transcripts</button></span>\n    </div>\n\n\n    <itt-asset-uploader\n      ng-if="$ctrl.showUploader"\n      episode-id="{{$ctrl.episodeId}}"\n      mime-types="{{$ctrl.mimes}}"\n      on-filedrop="$ctrl.handleTranscriptFiles(data)"\n      file-receive="$ctrl.transcripts"\n      callback="$ctrl.onUploadComplete()">\n    </itt-asset-uploader>\n\n    <np-modal\n      wrapper-class="responsive-modal__wrapper"\n      modal-class="responsive-modal__content"\n      ng-if="$ctrl.showOptions">\n      <div class="smart-sentences__wrapper">\n        <div><p>\n          Thank you for using this new feature currently in Beta! Are you sure you want to proceed? Once saved,\n          transcript entries must be individually edited or deleted. This page will automatically refresh after\n          transcripts have successfully uploaded.</p>\n        </div>\n        <div class="smart-sentences__input">\n          <div>\n            <input class="smart-sentences__input" id="groupParam" type="checkbox" ng-model="$ctrl.selectedParam"\n                   ng-false-value="\'none\'"\n                   ng-true-value="\'group_into_sentences\'"/>\n          </div>\n          <div>\n            <label class="smart-sentences__input"\n                   for="groupParam">Group transcript segments into complete sentences (recommended for closed caption\n              transcripts)</label>\n          </div>\n        </div>\n        <div>\n          <button ng-click="$ctrl.commenseUpload()">upload transcripts</button>\n          <button ng-click="$ctrl.cancelUpload()">cancel</button>\n        </div>\n      </div>\n\n    </np-modal>\n  </div>\n</div>',m=function(){function UploadTranscriptsController(e,t,i,n){this.MIMES=e,this.modelSvc=t,this.dataSvc=i,this.timelineSvc=n,this.showOptions=!1,this.showUploader=!1,this.selectedParam="none",this.maxDuration=null,this.transcripts={},this._maxDurParam="max_subtitle_duration"}return UploadTranscriptsController.prototype.$onInit=function(){this.mimes=this.MIMES.transcripts},UploadTranscriptsController.prototype.cancelUpload=function(){this.files=null,this.showUploader=!1,this.showOptions=!1},UploadTranscriptsController.prototype.handleTranscriptFiles=function(e){this.showOptions=!0,this.files=e},UploadTranscriptsController.prototype.commenseUpload=function(){var e=this.formatParams(),t=this.files,i=this._handleTranscripts(this.episodeId,t[0],e);this.transcripts={payload:{promises:i,files:t,type:"TRANSCRIPT_UPLOAD"}}},UploadTranscriptsController.prototype.onUploadComplete=function(){this.cancelUpload(),window.location.reload()},UploadTranscriptsController.prototype.formatParams=function(){var e={};return"none"!==this.selectedParam&&(e[this.selectedParam]=!0),existy(this.maxDuration)&&(e[this._maxDurParam]=this.maxDuration),e},UploadTranscriptsController.prototype._handleTranscripts=function(e,t,i){var n=new FormData;return n.append("subtitles",t),this.dataSvc.batchUploadTranscripts(e,n,i)},UploadTranscriptsController.$inject=["MIMES","modelSvc","dataSvc","timelineSvc"],UploadTranscriptsController}(),v=function(){function UploadTranscripts(){this.bindings={episodeId:"@"},this.template=p,this.controller=m}return UploadTranscripts.Name="ittUploadTranscripts",UploadTranscripts}(),g=i("wmst"),h=i.n(g),f=function(){function AssetUploaderController(e,t,i,n,a,r){this.$timeout=e,this.$element=t,this.awsSvc=i,this.appState=n,this.modelSvc=a,this.dataSvc=r,this.multiple=!1,this.uploadsinprogress=0,this.paused=!1,this.uploadStatus=[],this.uploads=[]}return AssetUploaderController.prototype.$onInit=function(){void 0===this.instructions?this.manPage="We support uploads of most common file formats, \n      including .doc, .docx, .jpeg, .jpg, .pdf, .png, .ppt, .pptx, .rtf, .txt, and .zip.":this.manPage=this.instructions,null==this.mimeTypes?this.mimeTypesArr=["application/*","image/*","video/*","text/*","audio/*","model/*"]:this.mimeTypesArr=this.mimeTypes.split(","),void 0===this.errorText&&(this.errorText="Whoops! You may want to try that again!"),this.mimeTypesArr=this.mimeTypesArr.map(function(e){return e.trim()})},AssetUploaderController.prototype.$postLink=function(){var e=this;this.$timeout(function(){e.droptarget=e.$element.find(".uploadDropTarget"),e.fileinput=e.$element.find(".uploadFileInput"),e.uploadsinprogress=0,e.droptarget[0].addEventListener("drop",function(t){return e.handleDrop(t)}),e.droptarget[0].addEventListener("dragover",function(t){return e.handleDragOver(t)}),e.droptarget[0].addEventListener("dragenter",function(t){return e.handleDragEnter(t)}),e.droptarget[0].addEventListener("dragleave",function(t){return e.handleDragLeave(t)})})},AssetUploaderController.prototype.$onChanges=function(e){if(e.fileReceive){var t=e.fileReceive.currentValue,i=t.payload;if(null!=i)switch(i.type){case"TRANSCRIPT_UPLOAD":var n=i.promises,a=i.files;this.commenseUploads(a,n)}}},AssetUploaderController.prototype.pauseUpload=function(){this.awsSvc.pauseUpload(),this.paused=!0},AssetUploaderController.prototype.resumeUpload=function(){this.awsSvc.resumeUpload(),this.paused=!1},AssetUploaderController.prototype.cancelUpload=function(){this.awsSvc.cancelUpload()},AssetUploaderController.strStartsWith=function(e,t){return 0===e.indexOf(t)},AssetUploaderController.strEndsWith=function(e,t){return e.substring(e.length-t.length,e.length)===t},AssetUploaderController.prototype.handleUploads=function(e){return this.multiple&&(e.length>1||this.uploads.length>0)?(this.errormessage="You may only upload one file at a time here.",!1):this.checkMimeType(e)?this.onFiledrop?void this.onFiledrop({data:e}):void this.commenseUploads(e):void(this.errormessage=this.errorText)},AssetUploaderController.prototype.commenseUploads=function(e,t){var i=this.setupUploadDisplay(e,t),n=i.oldstack,a=i.newstack;this.processUploads(n,a,e)},AssetUploaderController.prototype.setupUploadDisplay=function(e,t){var i=this.uploads.length,n=this.uploads.length+e.length;return this.uploadsinprogress=this.uploadsinprogress+e.length,this.uploadStatus.push({bytesSent:0,bytesTotal:1,percent:0,name:e[0].name}),this.containerId?this.uploads=this.uploads.concat(this.awsSvc.uploadContainerFiles(this.containerId,e)):this.episodeId?this.uploads=this.uploads.concat(t):this.uploads=this.uploads.concat(this.awsSvc.uploadUserFiles(this.appState.user._id,e)),{oldstack:i,newstack:n}},AssetUploaderController.prototype.checkMimeType=function(e){var t=this,i=!1;return Array.from(e).forEach(function(e){var n=e.type;if(t.episodeId){var a=e.name.match(/(vtt|srt)/);a&&a.length&&(n="text/"+a[0])}t.mimeTypesArr.forEach(function(e){if(AssetUploaderController.strEndsWith(e,"*")){var a=e.slice(0,-1);AssetUploaderController.strStartsWith(n,a)&&(i=!0)}else n===e&&(i=!0);t.errorText=n+" uploads are not allowed here."})}),i},AssetUploaderController.prototype.processUploads=function(e,t,i){for(var n=this,a=e;a<t;a+=1)!function(t){n.uploadStatus[t]={bytesSent:0,bytesTotal:1,percent:0,name:i[t-e].name},n.uploads[t].then(function(e){if(n.episodeId&&n.callback)return n.callback({data:e}),n.uploadStatus[t].done=!0,void n.oneDone();n.modelSvc.cache("asset",e.file),n.callback&&n.callback({data:e.file._id}),n.uploadStatus[t].done=!0,n.oneDone()}).catch(function(e){n.uploadStatus[t].error=e}).finally(null,function(e){n.uploadStatus[t].bytesSent=e.bytesSent,n.uploadStatus[t].bytesTotal=e.bytesTotal,n.uploadStatus[t].percent=Math.ceil(e.bytesSent/e.bytesTotal*100)})}(a)},AssetUploaderController.prototype.oneDone=function(){this.uploadsinprogress=this.uploadsinprogress-1,0===this.uploadsinprogress&&(this.fileinput.value="",this.paused=!1)},AssetUploaderController.prototype.handleDrop=function(e){e.preventDefault(),e.stopPropagation(),this.handleDragLeave(e),this.handleUploads(e.dataTransfer.files)},AssetUploaderController.prototype.handleDragOver=function(e){return e.preventDefault(),e.dataTransfer.dropEffect="move",this.handleDragEnter(e),!1},AssetUploaderController.prototype.handleDragEnter=function(e){this.droptarget.addClass("droppable")},AssetUploaderController.prototype.handleDragLeave=function(e){this.droptarget.removeClass("droppable")},AssetUploaderController.$inject=["$timeout","$element","awsSvc","appState","modelSvc","dataSvc"],AssetUploaderController}(),y=function(){function AssetUploader(){this.bindings={containerId:"@?",episodeId:"@?",callback:"&?",onFiledrop:"&?",fileReceive:"<?",mimeTypes:"@?",instructions:"@?",errorText:"@?",multiple:"<?"},this.template=h.a,this.controller=f}return AssetUploader.Name="ittAssetUploader",AssetUploader}(),_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function __(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)}}(),S=function(){function UIAsset(){}return UIAsset}(),b=(function(){function NpComponentTemplateDirective(){this.restrict="A"}NpComponentTemplateDirective.factory=function(){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(NpComponentTemplateDirective.bind.apply(NpComponentTemplateDirective,[void 0].concat(e)))};return e.$inject=NpComponentTemplateDirective.$inject,e},NpComponentTemplateDirective.$inject=[]}(),function(e){function IStyle(){return null!==e&&e.apply(this,arguments)||this}return _(IStyle,e),IStyle}(S)),T=function(e){function ILayout(){return null!==e&&e.apply(this,arguments)||this}return _(ILayout,e),ILayout}(S),E=(function(){function ITemplateImage(){}}(),function(){function ICssConfiguration(){}return ICssConfiguration}()),C=function(){function IFont(){}return IFont}(),w=function(){function ITemplate(){}return ITemplate}(),k=function(e){function IEpisodeTemplate(){return null!==e&&e.apply(this,arguments)||this}return _(IEpisodeTemplate,e),IEpisodeTemplate}(w),I=function(e){function IItemTemplate(){return null!==e&&e.apply(this,arguments)||this}return _(IItemTemplate,e),IItemTemplate}(w),x=function(e){function ILayoutTemplate(){return null!==e&&e.apply(this,arguments)||this}return _(ILayoutTemplate,e),ILayoutTemplate}(w),P=function(){function IEpisode(){}return IEpisode.prototype.setCurrentScene=function(e){if(this.scenes&&this.scenes.length){var t=this.scenes.indexOf(e),i=this.scenes.slice(0,t),n=this.scenes.slice(t+1);e.setCurrent(),i.length>0&&i.forEach(function(e){return e.setPast()}),n.length>0&&n.forEach(function(e){return e.setFuture()}),this.scenes=i.concat([e],n)}},IEpisode}(),A=function(){function IContainer(){}return IContainer}(),L=function(){function ITimeline(){this.timeline_image_ids=[]}return ITimeline}(),N=(function(e){function ITempTimeline(){return null!==e&&e.apply(this,arguments)||this}_(ITempTimeline,e)}(L),function(){function ICustomer(){}return ICustomer}()),M=function(){function INarrative(){this.narrative_image_ids=[]}return INarrative}(),U=function(){function IAsset(){}return IAsset}(),O=function(){function IEvent(){this.layouts=["inline"],this.renderTemplate=!0}return IEvent.prototype.setFuture=function(){this.state="isFuture",this.isCurrent=!1},IEvent.prototype.setPast=function(){this.state="isPast",this.isCurrent=!1},IEvent.prototype.setCurrent=function(){this.isCurrent=!0,this.state="isCurrent"},IEvent}(),D=function(){function ILinkStatus(){}return ILinkStatus}(),F=function(e){function ILink(){return null!==e&&e.apply(this,arguments)||this}return _(ILink,e),ILink}(O),R=function(e){function IAnnotation(){var t=null!==e&&e.apply(this,arguments)||this;return t.chapter_marker=!1,t}return _(IAnnotation,e),IAnnotation}(O),V=function(e){function IBookmark(){return null!==e&&e.apply(this,arguments)||this}return _(IBookmark,e),IBookmark}(O),B=function(e){function IChapter(){return null!==e&&e.apply(this,arguments)||this}return _(IChapter,e),IChapter}(O),j=function(e){function IImage(){return null!==e&&e.apply(this,arguments)||this}return _(IImage,e),IImage}(O),H=(function(){function IPluginData(){}}(),function(e){function IPlugin(){return null!==e&&e.apply(this,arguments)||this}return _(IPlugin,e),IPlugin}(O)),q=function(e){function IScene(){return null!==e&&e.apply(this,arguments)||this}return _(IScene,e),IScene}(O),W=function(e){function IText(){return null!==e&&e.apply(this,arguments)||this}return _(IText,e),IText}(O),K=function(e){function IUpload(){return null!==e&&e.apply(this,arguments)||this}return _(IUpload,e),IUpload}(O),z=i("Qgv7"),G=i.n(z),Q=function(){function ContainerController(e,t,i,n,a,r,s){this.$timeout=e,this.$location=t,this.appState=i,this.modelSvc=n,this.dataSvc=a,this.authSvc=r,this.episodeEdit=s,this.containerTypes=["customer","project","module","episode"]}return Object.defineProperty(ContainerController.prototype,"isAdmin",{get:function(){return this.authSvc.userHasRole("admin")},enumerable:!0,configurable:!0}),Object.defineProperty(ContainerController.prototype,"canAccess",{get:function(){return this.isAdmin||this.authSvc.userHasRole("customer admin")},enumerable:!0,configurable:!0}),Object.defineProperty(ContainerController.prototype,"containerType",{get:function(){if(this.depth>0)return capitalize(this.containerTypes[this.depth])},enumerable:!0,configurable:!0}),ContainerController.prototype.$onInit=function(){this.customers=this.modelSvc.getCustomersAsArray()},ContainerController.prototype.toggleNarrativeModal=function(){this.showNarrativeModal=!this.showNarrativeModal},ContainerController.prototype.postNewNarrative=function(e){var t=this,i=e.narrative,n=e.containerId;this.resolvingNarrative=!0,this.dataSvc.generateNewNarrative(n,i).then(function(e){t.modelSvc.cache("narrative",e),t.$location.path("/story/"+e._id),t.resolvingNarrative=!1})},ContainerController.prototype.getLinkStatusReport=function(e){this.dataSvc.getCustomerLinkStatusReportSpreadsheet(e)},ContainerController.prototype.selectText=function(e){e.target.select()},ContainerController.prototype.onToggleChildren=function(e){var t=this.container;this.onContainerClick({$container:{container:t,bool:e}})},ContainerController.prototype.renameContainer=function(){var e=this,t=createInstance("Container",pick(this.container,["_id","customer_id","episodes","keywords","parent_id","sort_order"]));t.name={en:this.container.newContainerName},this.dataSvc.updateContainer(t).then(function(){e.container.editingContainer=!1})},ContainerController.prototype.addContainer=function(e){var t=this,i={customer_id:this.container.customer_id,parent_id:this.container._id,name:{en:angular.copy(this.container.newContainerTitle)}};this.dataSvc.createContainer(i).then(function(i){if(2===t.depth)return t.episodeEdit.addEpisodeToContainer(i).then(function(e){return t.onContainerAdd({$container:e})}).catch(function(e){});t.onContainerAdd({$container:e})}),this.container.newContainerTitle="",this.container.addingContainer=!1,existy(e.showChildren)&&!1!==e.showChildren||this.onToggleChildren(!1)},ContainerController.prototype.deleteContainer=function(){this.onContainerRemove({$container:this.container})},ContainerController.$inject=["$timeout","$location","appState","modelSvc","dataSvc","authSvc","episodeEdit"],ContainerController}(),Y=function(){function Container(){this.bindings={container:"<",containers:"<",depth:"<",onContainerClick:"&",onContainerAdd:"&",onContainerRemove:"&"},this.template=G.a,this.controller=Q}return Container.Name="npContainer",Container}(),X='\n<div ng-if="$ctrl.context === \'episode\' && $ctrl.userHasRole(\'admin\') || $ctrl.userHasRole(\'customer admin\')">\n  <np-loading ng-if="$ctrl.loading"></np-loading>\n\n  <np-container\n    ng-repeat="child in $ctrl.root.children"\n    depth="0"\n    container="child"\n    containers="$ctrl.modelSvc.containers"\n    on-container-remove="$ctrl.onRequestContainerRemove($container)"\n    on-container-click="$ctrl.onContainerClick($container)"\n    on-container-add="$ctrl.onContainerAdd($container)">\n  </np-container>\n  \n  <np-modal class="modal__center-center" ng-if="$ctrl.containerToDelete != null">\n    <h4>Delete</h4>\n    {{$ctrl.containerToDelete.name.en}}?\n    <div>\n      <button ng-click="$ctrl.removeContainer($ctrl.containerToDelete)">Delete</button>\n      <button ng-click="$ctrl.containerToDelete = null">cancel</button>\n    </div>\n  </np-modal>\n  \n  <div ng-if="$ctrl.showAdmin">\n    Looks like you aren\'t logged in as an admin -- <a ng-click="logout();">try again</a>.\n  </div>\n</div>\n\n\x3c!--for the add timeline modal in /story/:id--\x3e\n<div ng-if="$ctrl.context === \'narrative\'">\n      Choose an episode:\n      <button ng-click="$ctrl.onCancel()">cancel</button>\n      <np-container-episodes\n        ng-repeat="child in $ctrl.root.children"\n        depth="0"\n        on-node-click="$ctrl.selectEpisode(node)"\n        for-admin="true"\n        container="$ctrl.containers[child._id]">\n      </np-container-episodes>\n</div>\n',J=function(e,t){return void 0===t&&(t=[]),t.push(e._id),e.children&&e.children.length>0&&e.children.forEach(function(e){J(e,t)}),t},Z=function(){function EpisodeListController(e,t,i,n,a){this.$location=e,this.$timeout=t,this.authSvc=i,this.dataSvc=n,this.modelSvc=a}return Object.defineProperty(EpisodeListController.prototype,"showAdmin",{get:function(){return!(this.userHasRole("admin")||this.userHasRole("customer admin")||!this.loading&&(this.failedLogin||0===this.root.children.length))},enumerable:!0,configurable:!0}),EpisodeListController.prototype.$onInit=function(){var e=this;this.loading=!0,this.containers=this.modelSvc.containers,this.dataSvc.getCustomerList(),this.dataSvc.getContainerRoot().then(function(t){e.root={children:[]},t.forEach(function(t){e.root.children.push(e.modelSvc.containers[t])}),e.walkContainers(e.root.children,!0,!0),e.loading=!1}).catch(function(t){e.failedLogin=!0,e.loading=!1})},EpisodeListController.prototype.selectEpisode=function(e){this.onEpisodeSelect({node:e})},EpisodeListController.prototype.logout=function(){this.authSvc.logout()},EpisodeListController.prototype.userHasRole=function(e){return this.authSvc.userHasRole(e)},EpisodeListController.prototype.onContainerAdd=function(e){this.walkContainers(this.root.children,!e.evenOdd,!1)},EpisodeListController.prototype.onRequestContainerRemove=function(e){this.containerToDelete=e},EpisodeListController.prototype.removeContainer=function(e){var t=this;this.dataSvc.deleteContainer(e._id).then(function(){return t.removeContainerSuccess(e)}).catch(function(e){}).finally(function(){return t.containerToDelete=null})},EpisodeListController.prototype.removeContainerSuccess=function(e){this.modelSvc.containers=omit.apply(void 0,[this.modelSvc.containers].concat(J(e))),this.walkContainers(this.root.children,!e.evenOdd,!0)},EpisodeListController.prototype.walkContainers=function(e,t,i){var n=this,a=t;return e.sort(function(e,t){return e.name.en.toLowerCase()<t.name.en.toLowerCase()?-1:e.name.en.toLowerCase()>t.name.en.toLowerCase()?1:0}),e.forEach(function(e){var t=n.modelSvc.containers[e._id];null!=t&&(t.evenOdd=a,a=!a,t.isActive&&i&&(n.lastClickedContainer={container:t,bool:!1}),t.showChildren&&t.children&&(a=n.walkContainers(t.children,a,i)))}),a},EpisodeListController.prototype.onContainerClick=function(e){var t=this;e.container.children?(!1===e.bool&&(e.container.showChildren=!e.container.showChildren),this.walkContainers(this.root.children,!0,!1)):this.dataSvc.getContainer(e.container._id).then(function(i){e.container=t.modelSvc.containers[i],!1===e.bool&&(e.container.showChildren=!0),t.walkContainers(t.root.children,!0,!1)}),!0===e.bool&&(existy(this.lastClickedContainer)?this.lastClickedContainer.container!==e.container?(this.lastClickedContainer.container.isActive=!1,this.lastClickedContainer=e,this.lastClickedContainer.container.isActive=!0):this.lastClickedContainer.container.isActive=!this.lastClickedContainer.container.isActive:(this.lastClickedContainer=e,this.lastClickedContainer.container.isActive=!0))},EpisodeListController.$inject=["$location","$timeout","authSvc","dataSvc","modelSvc"],EpisodeListController}(),ee=function(){function EpisodeList(){this.bindings={context:"@",onCancel:"&?",onEpisodeSelect:"&?"},this.template=X,this.controller=Z}return EpisodeList.Name="npEpisodeList",EpisodeList}(),te=i("5Ei1"),ie=i.n(te);i("IiAB");ittUser.$inject=["$q","appState","authSvc","dataSvc","awsSvc","modelSvc","imageResize"];var ne='\n\x3c!-- consider breaking these into separate templates altogether, since they have different purposes --\x3e\n\x3c!-- used in narrative creation --\x3e\n<div ng-style="{\'text-indent\': 1 * $ctrl.depth + \'em\'}">\n  <div ng-if="!$ctrl.container.episodes.length"\n      class="container"\n      ng-class="{isOpen: $ctrl.container.wasClicked, isClosed: !$ctrl.container.wasClicked}"\n      ng-click="$ctrl.toggle();$ctrl.loadChildren()"\n      ng-bind-html="$ctrl.container.display_name">\n  </div>\n  <div ng-if="$ctrl.container.episodes.length" ng-style="{\'text-indent\': $ctrl.depth === 3 ? \'4em\' : \'\'}">\n    <span class="hoverIndicator">\n      <a\n        ng-click="$ctrl.onNodeClick({node: $ctrl.container.episodes[0]})"\n        ng-bind-html="$ctrl.containers[$ctrl.container._id].display_name"></a>({{$ctrl.container.status}})\n    </span>\n  </div>\n</div>\n<np-container-episodes\n  ng-if="$ctrl.container.wasClicked"\n  ng-repeat="child in $ctrl.container.children" \n  container="$ctrl.containers[child._id]"\n  for-admin="true"\n  depth="$ctrl.depth + 1"\n  on-node-click="$ctrl.onNodeClick({ node: node })">\n</np-container-episodes>\n',ae=function(){function ContainerEpisodesController(e,t,i){this.modelSvc=e,this.appState=t,this.dataSvc=i}return ContainerEpisodesController.prototype.$onInit=function(){this.containers=this.modelSvc.containers,this.crossEpisodePath=this.appState.crossEpisodePath,this.episodeId=this.appState.episodeId},ContainerEpisodesController.prototype.loadChildren=function(){this.containers[this.container._id].haveNotLoadedChildData&&this.dataSvc.getContainer(this.container._id)},ContainerEpisodesController.prototype.toggle=function(){this.container.wasClicked=!this.container.wasClicked},ContainerEpisodesController.$inject=["modelSvc","appState","dataSvc"],ContainerEpisodesController}(),re=function(){function ContainerEpisodes(){this.bindings={container:"<",forAdmin:"<",depth:"<",onNodeClick:"&"},this.template=ne,this.controller=ae}return ContainerEpisodes.Name="npContainerEpisodes",ContainerEpisodes}(),se='\n<div ng-mouseenter="$ctrl.mouseEvent(true)" ng-mouseleave="$ctrl.mouseEvent(false)">\n\t<span class="pencil__content" ng-transclude></span>\n\t<span style="text-indent: 0">\n\t\t<span class="edit-pencil" ng-click="$ctrl.sendEdit($event)" ng-if="$ctrl.showPencil || $ctrl.force"></span>\n\t</span>\n</div>\n',oe=function(){function EditPencilController(){this.showPencil=!1}return EditPencilController.prototype.sendEdit=function(e){this.showPencil=!1,this.onEdit({$event:e})},EditPencilController.prototype.mouseEvent=function(e){this.canAccess&&(this.showPencil=e)},EditPencilController.$inject=[],EditPencilController}(),le=function(){function EditPencil(){this.transclude=!0,this.bindings={canAccess:"<?",force:"<?",onEdit:"&"},this.template=se,this.controller=oe}return EditPencil.Name="npEditPencil",EditPencil}(),ce='\n<div ng-class="$ctrl.wrapperClass">\n  <div ng-class="$ctrl.modalClass">\n    <ng-transclude></ng-transclude>\n  </div>\n</div>\n',de=function(){function ModalController(){}return ModalController.prototype.$onInit=function(){null==this.wrapperClass&&(this.wrapperClass="itt__modal")},ModalController}(),ue=function(){function Modal(){this.transclude=!0,this.bindings={modalClass:"@?",wrapperClass:"@?"},this.template=ce,this.controller=de}return Modal.Name="npModal",Modal}(),pe=i("rFfA"),me=i("5Tuk"),ve='\n<div>\n\t<header class="nav__header">\n\t\t<div class="nav__item">\n\t\t\t<img ng-if="!$ctrl.inPlayer" ng-src="{{::$ctrl.bannerImg}}"/>\n\t\t\t<img ng-if="$ctrl.inPlayer" ng-src="{{::$ctrl.logo}}"/>\n\t\t</div>\n\t\t<div class="nav__item" ng-if="$ctrl.appState.user._id">\n\t\t\t<div class="nav__controls">\n\t\t\t\t<div class="navControls__item item--left">\n\t\t\t\t\t<div class="nav__user" ng-click="$ctrl.goToAccounts()">\n\t\t\t\t\t\t<img ng-src="{{$ctrl.appState.user.avatar || $ctrl.noAvatar}}">\n\t\t\t\t\t\t<a class="nav__button" ng-if="$ctrl.appState.user">{{$ctrl.appState.user.name}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class="nav__button"\n\t\t\t\t\t  ng-if="$ctrl.currentPath !== \'/projects\' && $ctrl.canAccess" href="/#/projects">My Projects</a>\n\t\t\t\t\t<a class="nav__button"\n\t\t\t\t\t  ng-if="$ctrl.currentPath !== \'/stories\' && $ctrl.canAccess" href="/#/stories">My Narratives</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="navControls__item item--right">\n\t\t\t\t\t<a class="nav__button" ng-click="$ctrl.onLogout()">Log out</a>\n\t\t\t\t\t<a class="nav__button" \n\t\t\t\t\t  ng-if="$ctrl.canAccess" target="_blank" rel="noopener noreferrer" href="https://support.narrasys.com">Help</a>\n\t\t\t\t<div>\n\t\t\t</div>\n\t\t</div>\n\t</header>\n</div>\n',ge=function(){function NavController(e,t,i){this.$location=e,this.appState=t,this.authSvc=i,this.bannerImg=pe,this.logo=me}return Object.defineProperty(NavController.prototype,"currentPath",{get:function(){return this.$location.path()},enumerable:!0,configurable:!0}),Object.defineProperty(NavController.prototype,"noAvatar",{get:function(){return this.appState.noAvatarImg},enumerable:!0,configurable:!0}),NavController.prototype.$onInit=function(){var e=this;this.authSvc.authenticate().then(function(){e.canAccess=e.authSvc.userHasRole("admin")||e.authSvc.userHasRole("customer admin")||e.authSvc.userHasRole("instructor")})},NavController.prototype.goToAccounts=function(){this.canAccess&&this.$location.url("/account")},NavController.$inject=["$location","appState","authSvc"],NavController}(),he=function(){function Nav(){this.bindings={inPlayer:"<?",onLogout:"&?"},this.template=ve,this.controller=ge}return Nav.Name="npNav",Nav}(),fe='\n<span class="ittTooltip" ng-mouseenter="$ctrl.mouseAction(true)" ng-mouseleave="$ctrl.mouseAction(false)">\n\t<ng-transclude></ng-transclude>\n\t<span\n\t  ng-if="$ctrl.showTip" ng-class="$ctrl.css" style="text-indent: 0;">{{$ctrl.tipText}}</span>\n</span>\n',ye=function(){function TooltipController(){}return TooltipController.prototype.$onInit=function(){null==this.css&&(this.css="ittTooltip__text")},TooltipController.prototype.mouseAction=function(e){this.showTip=e},TooltipController}(),_e=function(){function Tooltip(){this.transclude=!0,this.bindings={tipText:"@",css:"@?"},this.template=fe,this.controller=ye}return Tooltip.Name="npTooltip",Tooltip}();ittLogin.$inject=["$location","$routeParams","authSvc","appState","errorSvc"],dataSvc_dataSvc.$inject=["$q","$http","$routeParams","$rootScope","$location","ittUtils","authSvc","appState","modelSvc","errorSvc","mockSvc","questionAnswersSvc","episodeTheme"],modelSvc_modelSvc.$inject=["$filter","$location","ittUtils","appState","playbackService","urlService"];var Se='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\t<div>\n\t\t<sxs-container-assets container-id="{{$ctrl.containerId}}" mime-key="assetLib"></sxs-container-assets>\n\t</div>\n</div>\n',be=function(){function AssetsResolveController(e,t){this.$routeParams=e,this.authSvc=t}return AssetsResolveController.prototype.$onInit=function(){this.containerId=this.$routeParams.containerId},AssetsResolveController.prototype.logout=function(){this.authSvc.logout()},AssetsResolveController.$inject=["$routeParams","authSvc"],AssetsResolveController}(),Te=function(){function AssetsResolve(){this.bindings={},this.template=Se,this.controller=be}return AssetsResolve.Name="npAssetsResolve",AssetsResolve}(),Ee=i("hY+2"),Ce=i.n(Ee),we=function(){function ErrorNoticeController(e,t,i){this.errorSvc=e,this.appState=t,this.authSvc=i}return Object.defineProperty(ErrorNoticeController.prototype,"user",{get:function(){return this.appState.user},enumerable:!0,configurable:!0}),ErrorNoticeController.prototype.$onInit=function(){},ErrorNoticeController.prototype.logout=function(){this.authSvc.logout()},ErrorNoticeController.prototype.dismiss=function(e){for(var t=0;t<this.errorSvc.errors.length;t+=1)this.errorSvc.errors[t]===e&&(this.errorSvc.errors.splice(t,1),t=this.errorSvc.errors.length);for(var t=0;t<this.errorSvc.notifications.length;t+=1)this.errorSvc.notifications[t]===e&&(this.errorSvc.notifications.splice(t,1),t=this.errorSvc.notifications.length)},ErrorNoticeController.$inject=["errorSvc","appState","authSvc"],ErrorNoticeController}(),ke=function(){function ErrorNotice(){this.bindings={},this.template=Ce.a,this.controller=we}return ErrorNotice.Name="npErrorNotice",ErrorNotice}(),Ie=(i("0YuG"),angular.module("np.filters",[]).filter("itemLayout",function(){return function(e,t){var i=[];return angular.forEach(e,function(e){e.layouts&&e.layouts[0]===t&&i.push(e)}),i}}).filter("mainCol",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.layouts||"mainBg"!==e.layouts[0]&&"mainFg"!==e.layouts[0]||t.push(e)}),t}}).filter("altCol",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.layouts||"altBg"!==e.layouts[0]&&"altFg"!==e.layouts[0]||t.push(e)}),t}}).filter("annotation",function(){return function(e){var t=[];return angular.forEach(e,function(e){"Annotation"!==e._type||e.component_name.match(/(transmedia|definition)/)||t.push(e)}),t}}).filter("transmedia",function(){return function(e){var t=[];return angular.forEach(e,function(e){("Annotation"!==e._type||e.component_name.match(/(transmedia|definition)/))&&t.push(e)}),t}}).filter("transcript",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isTranscript&&t.push(e)}),t}}).filter("isCurrent",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isCurrent&&t.push(e)}),t}}).filter("isContent",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isContent&&t.push(e)}),t}}).filter("reviewMode",["appState",function(e){return function(t){var i=[],n="producer"===e.product;return angular.forEach(t,function(e){(n||!e.cosmetic&&(e.isContent||e.layouts.indexOf("windowFg")>-1))&&i.push(e)}),i}}]).filter("transcriptandrequired",function(){return function(e){var t=[];return angular.forEach(e,function(e){(e.isTranscript||e.required)&&t.push(e)}),t}}).filter("transcriptandoptional",function(){return function(e){var t=[];return angular.forEach(e,function(e){(e.isTranscript||!e.isTranscript&&!e.required)&&t.push(e)}),t}}).filter("required",function(){return function(e){var t=[];return angular.forEach(e,function(e){!e.isTranscript&&e.required&&t.push(e)}),t}}).filter("optional",function(){return function(e){var t=[];return angular.forEach(e,function(e){e.isTranscript||e.required||t.push(e)}),t}}).filter("highlightSubstring",function(){return function(e,t){if(e)return t||angular.isNumber(t)?e.toString().replace(new RegExp(t.toString(),"gi"),'<span class="ui-match">$&</span>'):e}}).filter("pretty",function(){return function(e){return JSON.stringify(e,void 0,2)}}).filter("i18n",["appState",function(e){return function(t){return t?"object"==typeof t?t[e.lang]||t.en||"":t:""}}]).filter("asBytes",function(){return function(e){if(!e)return"";var t=Math.floor(e/1024);return t<1024?t+"Kb":Math.floor(t/10.24)/100+"Mb"}}).filter("asPercent",function(){return function(e){return isNaN(e)?Math.floor(100*e)+"%":"0%"}}).filter("stripParams",function(){return function(e){return e.substr(0,e.indexOf("?"))}}).filter("asTime",function(){return function(e){return isNaN(e)?"0:00":e<0?"0:00":Math.floor(e/60)+":"+("0"+Math.floor(e)%60).slice(-2)}}).filter("alpha",function(){return function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")[e%26]}}).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLocaleLowerCase():""}}).filter("vidsFromCustAdmins",function(){return function(e){var t=[];return angular.forEach(e,function(e){/video/.test(e.content_type)||t.push(e)}),t}}).filter("langDisplay",["ittUtils",function(e){var t=e.existy,i={en:"English",es:"Spanish",zh:"Chinese",pt:"Portuguese",fr:"French",de:"German",it:"Latin"};return function(e){return t(e)?i[e]:""}}]).filter("slugify",["ittUtils",function(e){return function(t){return e.existy(t)?e.slugify(t):""}}]).filter("tagName",[function(){var e=(t={},t[l]="Square",t[c]="Wide",t);return function(t){if(t&&e.hasOwnProperty(t))return e[t]};var t}]),'\n<div class="loading">\n\t<div class="spinner">\n\t\t<div class="rotating pie"></div>\n\t\t<div class="filler pie"></div>\n\t\t<div class="mask"></div>\n\t</div>\n\tLoading\n</div>\n\n'),xe=function(){function Loading(){this.template=Ie}return Loading.Name="npLoading",Loading}(),Pe=function(){function DynamicEventTemplate(e){this.$compile=e,this.restrict="A"}return DynamicEventTemplate.factory=function(){var e=function(e){return new DynamicEventTemplate(e)};return e.$inject=DynamicEventTemplate.$inject,e},DynamicEventTemplate.prototype.link=function(e,t,i){var n="<span np-"+i.componentName+"-template></span>",a=this.$compile(n)(e);t.append(a)},DynamicEventTemplate.Name="npDynamicEventTemplate",DynamicEventTemplate.$inject=["$compile"],DynamicEventTemplate}(),Ae=i("olHH"),$e=i.n(Ae),Le=function(){function AuthTemplate(){this.restrict="EA",this.template=$e.a,this.scope=!0}return AuthTemplate.factory=function(){return function(){return new AuthTemplate}},AuthTemplate.Name="npAuthTemplate",AuthTemplate}(),Ne=i("1tPm"),Me=i.n(Ne),Ue=function(){function Error404Template(){this.restrict="EA",this.template=Me.a,this.scope=!0}return Error404Template.factory=function(){return function(){return new Error404Template}},Error404Template.Name="npError404Template",Error404Template}(),Oe=i("wI96"),De=i.n(Oe),Fe=function(){function RootTemplate(){this.restrict="EA",this.template=De.a,this.scope=!0}return RootTemplate.factory=function(){return function(){return new RootTemplate}},RootTemplate.Name="npRootTemplate",RootTemplate}(),Re=i("cKYu"),Ve=i.n(Re),Be=function(){function SxsContainerAssetsController(e,t,i,n,a,r,s,o){this.$rootScope=e,this.$q=t,this.dataSvc=i,this.modelSvc=n,this.awsSvc=a,this.appState=r,this.MIMES=s,this.authSvc=o}return SxsContainerAssetsController.prototype.$onInit=function(){var e=this;this.$q(function(t,i){e.modelSvc.containers[e.containerId]?(e.container=e.modelSvc.containers[e.containerId],e.container.assetsHaveLoaded?t():e.dataSvc.getContainerAssets(e.containerId).then(t)):e.dataSvc.getContainer(e.containerId).then(function(){e.container=e.modelSvc.containers[e.containerId],e.dataSvc.getContainerAssets(e.containerId).then(t)})}).then(function(t){"narrative"===e.context?e.assets=Object.keys(e.modelSvc.assets).reduce(function(t,i){var n=e.modelSvc.assets[i];return(n.tags&&n.tags[0]===l||n.tags[0]===c)&&(t[i]=n),t},{}):e.assets=e.modelSvc.assets,e.isCustAdmin=e.authSvc.userHasRole("customer admin"),e.isAdmin=e.authSvc.userHasRole("admin"),e.canAccess=e.isCustAdmin||e.isAdmin,e.MIMES[e.mimeKey]?(e.mimes=e.MIMES[e.mimeKey],e.isAdmin&&(e.mimes+=",video/*")):e.mimes=e.MIMES.default})},SxsContainerAssetsController.prototype.up=function(){this.showParent=!0},SxsContainerAssetsController.prototype.toggleImages=function(){this.onlyImages=!this.onlyImages},SxsContainerAssetsController.prototype.toggleGrid=function(){this.gridView=!this.gridView},SxsContainerAssetsController.prototype.assetClick=function(e){if(this.context&&"narrative"===this.context)return void this.onAssetSelect({$assetId:e});this.$rootScope.$emit("UserSelectedAsset",e)},SxsContainerAssetsController.prototype.requestDeleteAsset=function(e,t){t.stopPropagation(),this.assetToDelete=e},SxsContainerAssetsController.prototype.deleteAsset=function(e){var t=this;this.dataSvc.deleteAsset(e).then(function(){t.assets=omit(t.assets,e),t.modelSvc.assets=omit(t.modelSvc.assets,e)}).catch(function(e){}).finally(function(){return t.assetToDelete=null})},SxsContainerAssetsController.$inject=["$rootScope","$q","dataSvc","modelSvc","awsSvc","appState","MIMES","authSvc"],SxsContainerAssetsController}(),je=function(){function SxsContainerAssets(){this.bindings={containerId:"@",mimeKey:"@?",context:"@?",onAssetSelect:"&?"},this.template=Ve.a,this.controller=Be}return SxsContainerAssets.Name="sxsContainerAssets",SxsContainerAssets}(),He=angular.module("np.shared",["np.filters"]);[Le,Ue,Fe].forEach(function(e){He.directive(e.Name,e.factory())}),He.service(s.Name,s).service(u.Name,u).factory("authSvc",authSvc_authSvc).factory("awsSvc",awsSvc_awsSvc).factory("dataSvc",dataSvc_dataSvc).factory("errorSvc",errorSvc_errorSvc).factory("imageResize",imageResizeSvc_imageResize).factory("ittUtils",ittUtils_ittUtils).factory("mockSvc",mockSvc_mockSvc).factory("modelSvc",modelSvc_modelSvc).component(je.Name,new je).component(y.Name,new y).component(Y.Name,new Y).component(ee.Name,new ee).directive("ittUser",ittUser).component(re.Name,new re).component(le.Name,new le).component(ue.Name,new ue).component(he.Name,new he).directive("ittRouteLoading",ittRouteLoading).component(_e.Name,new _e).directive("ittValidationTip",ittValidationTip).directive("ittFilesHandler",ittFilesHandler).directive("ittLogin",ittLogin).directive(Pe.Name,Pe.factory()).component(xe.Name,new xe).component(Te.Name,new Te).component(ke.Name,new ke);var qe='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\n\t<h1>Projects</h1>\n  <np-episode-list class="np-container" context="episode"></np-episode-list>\n</div>\n',We=function(){function ProjectsContainerController(e){this.authSvc=e}return ProjectsContainerController.prototype.$onInit=function(){},ProjectsContainerController.prototype.logout=function(){this.authSvc.logout()},ProjectsContainerController.$inject=["authSvc"],ProjectsContainerController}(),Ke=function(){function ProjectsContainer(){this.template=qe,this.controller=We}return ProjectsContainer.Name="npProjectsContainer",ProjectsContainer}(),ze=angular.module("np.projects",[]);[Ke].forEach(function(e){ze.component(e.Name,new e)});var Ge='\n<div ng-if="$ctrl.narrative.enable_social_sharing" class="socialshare-filedrop">\n\n  <div ng-repeat="(tag, imgObj) in $ctrl.images" ng-class="\'itt-filedrop__\' + tag">\n    <itt-filedrop\n      on-error="$ctrl.display[tag].error"\n      on-drop="$ctrl.handleImage(files, tag)">\n      \n      <itt-filedrop-target>\n        <div class="itt-filedrop__wrapper" ng-if="imgObj.path == null">\n          <span class="itt-filedrop__placeholder --default-image-opacity" ng-class="tag + \'--default\'"></span>\n        </div>\n      </itt-filedrop-target>\n\n      <itt-filedrop-preview>\n        <div ng-if="imgObj.path">\n          <div class="socialshare__img">\n            <itt-upload-progress upload="$ctrl.uploadsService.uploadsDisplay[tag]"></itt-upload-progress>\n            <img\n              ng-class="{\n                \'--drop-error\': $ctrl.display[tag].error,\n                \'--default-image-opacity\': $ctrl.display[tag].defaultFromNarrative\n              }"\n              ng-src="{{imgObj.path}}"/>\n          </div>\n        </div>\n      </itt-filedrop-preview> \n\n    </itt-filedrop> \n    <div>{{$ctrl.display[tag].text}}</div>\n  </div>\n\n  \x3c!--begin social controls--\x3e\n  <div class="socialshare__controls">\n    <button\n      ng-disabled="$ctrl.isUsingDefaultImages()"\n      ng-click="$ctrl.resetImgs()">\n      {{$ctrl.isUsingDefaultImages() ? \'Default images in use\' : \'Use default images\'}}\n    </button>\n    <button ng-click="$ctrl.toggleBrowseUploaded()">Browse uploaded</button>\n    <label class="button" for="fileBtn">Upload new</label>\n\n    <input id="fileBtn" type="file" accept="image/*" itt-files-handler on-selected="$ctrl.handleImage(files)"/>\n  </div>\n  \x3c!--end social controls--\x3e\n\n  \x3c!--begin browse uploaded--\x3e\n  <np-modal wrapper-class="responsive-modal__wrapper" modal-class="narrative__modal" ng-if="$ctrl.browseUploaded">\n    <div class="scrollContainer">\n      <sxs-container-assets\n        container-id="{{$ctrl.containerId}}"\n        on-asset-select="$ctrl.uploadedAssetSelected($assetId)"\n        context="narrative">\n      </sxs-container-assets>\n    </div>\n    <div class="controlsContainer">\n      <button ng-click="$ctrl.toggleBrowseUploaded()">Cancel</button>\n    </div>\n  </np-modal>\n  \x3c!--end browse uploaded--\x3e\n</div>\n',Qe={social_image_square:"Recommend 576 x 576",social_image_wide:"Recommend 1200 x 630"},Ye={social_image_square:{file:null,path:null},social_image_wide:{file:null,path:null}},Xe={social_image_square:{text:Qe[l],error:!1,defaultFromNarrative:!1},social_image_wide:{text:Qe[c],error:!1,defaultFromNarrative:!1}},Je=function(){function EnableSocialshareController(e,t,i,n,a,r){this.$q=e,this.$timeout=t,this.uploadsService=i,this.imageResize=n,this.dataSvc=a,this.modelSvc=r,this.browseUploaded=!1,this.files={social_image_square:{file:null},social_image_wide:{file:null}}}return EnableSocialshareController.prototype.$onInit=function(){null==this.timeline?this.type="narrative":this.type="timeline",this.model=this[this.type],this.setInitialDisplay(),this.fetchAssetsOnInit()},EnableSocialshareController.prototype.resetImgs=function(){var e=this;if("timeline"===this.type)return this.narrative.narrative_image_ids&&2===this.narrative.narrative_image_ids.length?this.narrative.narrative_image_ids.forEach(function(t){var i=e.modelSvc.assets[t],n=i.tags[0];e.images[n]={assetId:i._id,path:i.url},e.display[n].defaultFromNarrative=!0}):this.setInitialDisplay(),void(this.timeline.timeline_image_ids=[]);this.narrative.narrative_image_ids=[],this.images=Object.assign({},Ye)},EnableSocialshareController.prototype.isUsingDefaultImages=function(){var e=!0===this.display[l].defaultFromNarrative&&!0===this.display[c].defaultFromNarrative,t=null==this.images[l].path&&null==this.images[c].path;return e||t},EnableSocialshareController.prototype.toggleBrowseUploaded=function(){this.browseUploaded=!this.browseUploaded},EnableSocialshareController.prototype.uploadedAssetSelected=function(e){var t=this.modelSvc.assets[e];this.setImageFromAsset(t,!1),this.browseUploaded=!1},EnableSocialshareController.prototype.handleImage=function(e,t){var i=this;this.checkAspectRatio(e[0]).then(function(n){var a=n.images,r=n.tag;if(null!=t&&t!==r)return i.$q.reject({currTag:t,tag:r,errorType:"TAG_MISMATCH"});i.files[r].file=e,i.images=Object.assign({},i.images,a),i.model[r]={file:e},i.setValidity()}).catch(function(e){return i.handleTagmismatchError(e.errorType,e.currTag,e.tag)})},EnableSocialshareController.prototype.setInitialDisplay=function(){this.display=angular.copy(Xe),this.images=angular.copy(Ye)},EnableSocialshareController.prototype.fetchAssetsOnInit=function(){"narrative"===this.type&&this.fetchNarrativeImageAssets(),"timeline"===this.type&&this.fetchImageAssetsTimeline()},EnableSocialshareController.prototype.fetchNarrativeImageAssets=function(){this.narrative&&this.narrative.narrative_image_ids&&this.narrative.narrative_image_ids.length>0&&this.getImageAssets("narrative").then(function(){})},EnableSocialshareController.prototype.fetchImageAssetsTimeline=function(){var e=this,t={narrative:[],timeline:[]};this.timeline.timeline_image_ids&&this.timeline.timeline_image_ids.length>0?(t.timeline=this.timeline.timeline_image_ids.slice(),t.use="timeline"):t.use="narrative",this.narrative.narrative_image_ids&&this.narrative.narrative_image_ids.length>0&&(t.narrative=this.narrative.narrative_image_ids.slice());var i=t.narrative.concat(t.timeline),n=i.reduce(function(t,i){return e.modelSvc.assets[i]||t.push(i),t},[]),a=function(){t[t.use].forEach(function(i){e.setImageFromAsset(e.modelSvc.assets[i],"narrative"===t.use)})};n.length>0?this.dataSvc.fetchAndCacheAssetsByIds(n).then(a):a()},EnableSocialshareController.prototype.getImageAssets=function(e,t){var i=this;return void 0===t&&(t=!1),this.$q(function(n){var a=[];return i[e][e+"_image_ids"].forEach(function(e){e&&i.modelSvc.assets[e]?i.setImageFromAsset(i.modelSvc.assets[e],t):a.push(e)}),a.length>0&&i.dataSvc.fetchAndCacheAssetsByIds(a).then(function(e){return e.forEach(function(e){return i.setImageFromAsset(e,t)}),n()}),n()})},EnableSocialshareController.prototype.handleTagmismatchError=function(e,t,i){var n=this;this.display[t].error=!0,this.display[t].text="The aspect ratio is not correct.",this.$timeout(function(){n.display[t].error=!1,n.display[t].text=Qe[t]},3e3)},EnableSocialshareController.prototype.checkAspectRatio=function(e){var t=this;return this.imageResize.readFileToImg(e).then(function(i){var n=t.imageResize.getImageTagType(i.width,i.height);return{images:(a={},a[n]={name:e.name,path:i.src},a),tag:n};var a})},EnableSocialshareController.prototype.setImageFromAsset=function(e,t){void 0===t&&(t=!1);var i=e.tags[0],n=this.images[i];if(this.images[i]={assetId:e._id,path:e.url},this.display[i].defaultFromNarrative=!1,t)return this.display[i].defaultFromNarrative=!0,void this.setValidity();n&&n.assetId&&this.removeImageId(n.assetId),this.addImageId(e._id),this.setValidity()},EnableSocialshareController.prototype.setValidity=function(){var e=this.images,t=e.social_image_square,i=e.social_image_wide,n=this.display[l].defaultFromNarrative!==this.display[c].defaultFromNarrative,a="string"==typeof t.path&&"string"==typeof i.path,r=null==t.path&&null==i.path,s=!n&&(a||r);this.editorForm.$setValidity(this.editorForm.$name,s,this.editorForm)},EnableSocialshareController.prototype.removeImageId=function(e){this.model[this.type+"_image_ids"]=this.model[this.type+"_image_ids"].filter(function(t){return e!==t})},EnableSocialshareController.prototype.addImageId=function(e){this.model[this.type+"_image_ids"].includes(e)||this.model[this.type+"_image_ids"].push(e)},EnableSocialshareController.$inject=["$q","$timeout","uploadsService","imageResize","dataSvc","modelSvc"],EnableSocialshareController}(),Ze=function(){function EnableSocialshare(){this.bindings={containerId:"@?",narrative:"<",timeline:"<?",editorForm:"<"},this.template=Ge,this.controller=Je}return EnableSocialshare.Name="ittEnableSocialshare",EnableSocialshare}(),et='\n<div ng-if="!$ctrl.clipboardMode">\n  <div ng-if="$ctrl.narrative.guest_access_allowed === true">\n    <label for="{{$ctrl.display.id[$ctrl.type]}}">Guest Accessible URL:\n      <itt-validation-tip ng-if="$ctrl[$ctrl.type].error" text="{{$ctrl[$ctrl.type].error}}"></itt-validation-tip>\n      <p class="--break-word">\n        <small ng-class="{ \'error-red\': $ctrl[$ctrl.type].error, unselectable: $ctrl[$ctrl.type].error }">\n          {{$ctrl.formatGuestAccessibleUrl()}}\n        </small>\n      </p>\n    </label>\n    <input\n      id="{{$ctrl.display.id[$ctrl.type]}}"\n      type="text"\n      name="path"\n      placeholder="{{$ctrl.display.placeholder}}"\n      itt-valid-pathslug\n      narrative-id="{{$ctrl.narrative._id}}"\n      ng-model="$ctrl[$ctrl.type].path_slug.en">\n  </div>\n</div>\n<np-clipboard\n  ng-if="$ctrl.clipboardMode"\n  source-text="{{$ctrl.formatUrlToCopy()}}"\n  on-copy="$event.stopPropagation()">\n</np-clipboard>\n',tt=function(){function GuestAccessibleUrlController(){this.protocol="https://",this.domain=".narrasys.com/"}return GuestAccessibleUrlController.prototype.$onInit=function(){this.type=existy(this.timeline)?"timeline":"narrative",this.display={id:{timeline:"tlPath",narrative:"nPath"},placeholder:"human-friendly-link-to "+this.type};var e=existy(this.subDomain)&&this.subDomain||existy(this.narrative.narrative_subdomain)&&this.narrative.narrative_subdomain;this.pathPrefix=this.protocol+e+this.domain},GuestAccessibleUrlController.prototype.formatLTIUrl=function(){if(existy(this.narrative))return"timeline"===this.type?this.pathPrefix+"auth/lti?narrative="+this.narrative._id+"&timeline="+this.timeline._id:this.pathPrefix+"auth/lti?narrative="+this.narrative._id},GuestAccessibleUrlController.prototype.formatGuestAccessibleUrl=function(){var e=existy(this.narrative),t=e&&existy(this.narrative.path_slug)&&existy(this.narrative.path_slug.en),i=existy(this.timeline),n=i&&existy(this.timeline.path_slug)&&existy(this.timeline.path_slug.en);return"timeline"===this.type&&n?this.pathPrefix+"#/story/"+this.narrative.path_slug.en+"/"+slugify(this.timeline.path_slug.en):t?this.pathPrefix+"#/story/"+slugify(this.narrative.path_slug.en):void 0},GuestAccessibleUrlController.prototype.formatUrlToCopy=function(){return existy(this.narrative)&&!1===this.narrative.guest_access_allowed?this.formatLTIUrl():this.formatGuestAccessibleUrl()},GuestAccessibleUrlController.$inject=[],GuestAccessibleUrlController}(),it=function(){function GuestAccessibleUrl(){this.bindings={narrative:"<",timeline:"<?",customer:"<?",clipboardMode:"@?",subDomain:"@?"},this.template=et,this.controller=tt}return GuestAccessibleUrl.Name="npGuestAccessibleUrl",GuestAccessibleUrl}(),nt=i("wZyx"),at=i.n(nt),rt=function(){function SocialShareController(e,t){this.Socialshare=e,this.dataSvc=t,this.stubUrl="https://thecareerplaybook.narrasys.com/narratives/jim-citrin",this.expanded=!1,this.emailshareExpanded=!1,this.textCopied=!1,this.email={}}return SocialShareController.prototype.$onInit=function(){this.subdomain&&this.paths&&this.paths.narrative&&this.paths.timeline&&(this.stubUrl=SocialShareController.formatShareUrl(this.subdomain,this.paths.narrative,this.paths.timeline.url))},SocialShareController.prototype.onShare=function(e){var t={provider:e,attrs:{}};switch(e){case"email":return void this.toggleEmailshare();case"linkedin":case"twitter":case"reddit":Object.assign(t.attrs,{socialshareText:this.shareTitle},{socialshareUrl:this.stubUrl});break;default:Object.assign(t.attrs,{socialshareUrl:this.stubUrl})}this.Socialshare.share(t),this.closeAll()},SocialShareController.prototype.toggleExpanded=function(){this.expanded=!this.expanded,this.textCopied=!1,this.emailshareExpanded=!1},SocialShareController.prototype.ontextCopied=function(e){this.textCopied=!0},SocialShareController.prototype.handleEmailShare=function(e,t){var i=this;if(t.$invalid)return void t.$error.required.forEach(function(e){e.$setTouched()});this.dataSvc.sendSocialshareEmail(this.paths.timeline.id,e).then(function(e){return i.closeAll()}).catch(function(e){})},SocialShareController.formatShareUrl=function(e,t,i){return"https://"+e+".narrasys.com/narratives/"+t+"/"+i},SocialShareController.prototype.closeAll=function(){this.expanded=!1,this.textCopied=!1,this.emailshareExpanded=!1},SocialShareController.prototype.toggleEmailshare=function(){this.emailshareExpanded=!this.emailshareExpanded},SocialShareController.$inject=["Socialshare","dataSvc"],SocialShareController}(),st=function(){function SocialShare(){this.bindings={providers:"<",subdomain:"@",shareTitle:"@",paths:"<"},this.template=at.a,this.controller=rt}return SocialShare.Name="ittSocialShare",SocialShare}(),ot='\n<np-tooltip tip-text="{{$ctrl.tipText}}" ng-click="$ctrl.bubbleEvent($event)">\n   <a class="icon__button" ng-class="$ctrl.light ? \'button__clipboard--light\' : \'button__clipboard\'"></a>\n</np-tooltip>\n',lt=function(){function ClipboardController(e){this.$timeout=e}return ClipboardController.copyText=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},ClipboardController.prototype.$onInit=function(){null==this.tipText&&(this.tipText="Click to copy URL"),this._defaultText=this.tipText},ClipboardController.prototype.bubbleEvent=function(e){var t=this;ClipboardController.copyText(this.sourceText),this.onCopy({$event:e}),null==this.customNotice&&(this.tipText="Copied",this.$timeout(function(){t.tipText=t._defaultText},1500))},ClipboardController.$inject=["$timeout"],ClipboardController}(),ct=function(){function Clipboard(){this.transclude=!0,this.bindings={sourceText:"@",tipText:"@?",light:"<?",customNotice:"<?",onCopy:"&"},this.template=ot,this.controller=lt}return Clipboard.Name="npClipboard",Clipboard}(),dt='\n<div class="itt-filedrop itt-filedrop--border" ng-class="{\'--drop-error\': $ctrl.onError}"> \n  <div ng-transclude="target"></div>\n  \n   <div class="itt-filedrop__wrapper" ng-if="$ctrl.onError">\n    <span class="itt-filedrop__placeholder --drop-error"></span>\n   </div>\n  \n  <div ng-if="!$ctrl.error" ng-transclude="preview"></div>\n</div>\n',ut=function(){function FiledropController(e){this.$element=e}return FiledropController.prototype.$postLink=function(){this.attachListeners()},FiledropController.prototype.$onDestroy=function(){this.removeListeners()},FiledropController.prototype.attachListeners=function(){var e=this;this.$element[0].addEventListener("drop",function(t){return e.handleDrop(t)}),this.$element[0].addEventListener("dragover",function(t){return e.handleDragOver(t)}),this.$element[0].addEventListener("dragenter",function(t){return e.handleDragEnter(t)}),this.$element[0].addEventListener("dragleave",function(t){return e.handleDragLeave(t)})},FiledropController.prototype.removeListeners=function(){var e=this;this.$element[0].removeEventListener("drop",function(t){return e.handleDrop(t)}),this.$element[0].removeEventListener("dragover",function(t){return e.handleDragOver(t)}),this.$element[0].removeEventListener("dragenter",function(t){return e.handleDragEnter(t)}),this.$element[0].removeEventListener("dragleave",function(t){return e.handleDragLeave(t)})},FiledropController.prototype.handleDrop=function(e){e.preventDefault(),e.stopPropagation(),this.handleDragLeave(e),this.onDrop({files:e.dataTransfer.files})},FiledropController.prototype.handleDragOver=function(e){return e.preventDefault(),e.dataTransfer.dropEffect="move",this.handleDragEnter(e),!1},FiledropController.prototype.handleDragEnter=function(e){this.$element.children().addClass("itt-filedrop--droppable")},FiledropController.prototype.handleDragLeave=function(e){this.$element.children().removeClass("itt-filedrop--droppable")},FiledropController.$inject=["$element"],FiledropController}(),pt=function(){function Filedrop(){this.transclude={target:"ittFiledropTarget",preview:"ittFiledropPreview"},this.bindings={onError:"<",onDrop:"&"},this.template=dt,this.controller=ut}return Filedrop.Name="ittFiledrop",Filedrop}(),mt='\n\n<div class="upload-progress" ng-if="$ctrl.upload != null">\n  <h5>{{$ctrl.upload.name}} - {{$ctrl.upload.percent}}%</h5>\n  <progress\n    ng-attr-max="{{$ctrl.upload.bytesTotal}}"\n    ng-attr-value="{{$ctrl.upload.bytesSent}}">\n  </progress>\n</div>\n\n',vt=function(){function UploadProgress(){this.bindings={upload:"<"},this.template=mt}return UploadProgress.Name="ittUploadProgress",UploadProgress}(),gt='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n  <np-loading ng-if="$ctrl.narrative == null && $ctrl.customers == null"></np-loading>\n  <np-narrative-detail\n    ng-if="$ctrl.narrative && $ctrl.customers"\n    class="np-narrative-container"\n    narrative="$ctrl.narrative"\n    customers="$ctrl.customers">\n  </np-narrative-detail> \n</div>\n',ht=function(){function NarrativeContainerController(e,t,i,n,a){this.$q=e,this.$routeParams=t,this.modelSvc=i,this.dataSvc=n,this.authSvc=a}return NarrativeContainerController.prototype.$onInit=function(){var e=this;this._resolveNarrative().then(function(t){var i=t.n,n=t.c;e.narrative=i,e.customers=n})},NarrativeContainerController.prototype.logout=function(){this.authSvc.logout()},NarrativeContainerController.prototype._resolveNarrative=function(){var e,t=this,i=this.$routeParams.narrativePath,n=this.modelSvc.getNarrativeByPathOrId(i);return existy(n)&&existy(n.path_slug)&&existy(n.timelines)&&(n.path_slug.en===i||n._id===i)?(e=this.modelSvc.customers[n.customer_id],this.$q.resolve({n:n,c:[e]})):this.dataSvc.getNarrative(i).then(function(e){return t.dataSvc.getCustomer(e.customer_id,!0).then(function(t){return{n:e,c:[t]}})})},NarrativeContainerController.$inject=["$q","$routeParams","modelSvc","dataSvc","authSvc"],NarrativeContainerController}(),ft=function(){function NarrativeContainer(){this.template=gt,this.controller=ht}return NarrativeContainer.Name="npNarrativeContainer",NarrativeContainer}(),yt=i("qMue"),_t=i.n(yt),St=function(){function NarrativeDetailController(e,t,i,n,a){var r=this;this.$routeParams=e,this.authSvc=t,this.appState=i,this.dataSvc=n,this.modelSvc=a,this.treeOpts={accept:function(){return!0},dropped:function(e){var t=e.dest.index;t!==e.source.index&&(r.narrative.timelines=NarrativeDetailController._updateSortOrder(t,r.narrative.timelines),r._persistTimelineSortUpdate(r.narrative.timelines[t]))}}}return NarrativeDetailController.prototype.$onInit=function(){this.isOwner=!1,this.user=this.appState.user,(this.authSvc.userHasRole("admin")||this.authSvc.userHasRole("customer admin"))&&(this.canAccess=!0),this._setTotalNarrativeDuration(this.narrative.timelines)},NarrativeDetailController.prototype.logout=function(){this.authSvc.logout()},NarrativeDetailController.prototype.toggleEditNarrativeModal=function(e){var t=this;existy(this.customers[0])&&existy(this.customers[0].narratives)&&this.customers[0].narratives.length>1?this.editingNarrative=!this.editingNarrative:this.dataSvc.getNarrativeList(this.customers[0]).then(function(){t.editingNarrative=!t.editingNarrative}),null!=e&&(this.narrative=e)},NarrativeDetailController.prototype.toggleEditingTimeline=function(e){this.timelineUnderEdit=e},NarrativeDetailController.prototype.doneEditingTimeline=function(){var e=this;this.timelineUnderEdit=null,this.narrative.timelines=this.narrative.timelines.filter(function(t){return t!==e.tmpTimeline}),this.tmpTimeline=null},NarrativeDetailController.prototype.toggleOwnership=function(){this.isOwner=!this.isOwner},NarrativeDetailController.prototype.toggleEpisodeList=function(){this.showEpisodeList=!this.showEpisodeList},NarrativeDetailController.prototype.updateNarrative=function(e){var t=this;this.dataSvc.updateNarrative(e).then(function(e){t.editingNarrative=!1,angular.extend(t.narrative,e.data);var i=t.modelSvc.customers[e.data.customer_id];t.modelSvc.assocNarrativesWithCustomer(i,[e.data])})},NarrativeDetailController.prototype.updateTimeline=function(e,t){var i=this;this.dataSvc.storeTimeline(this.narrative._id,e).then(function(e){angular.extend(t,e),i.doneEditingTimeline()})},NarrativeDetailController.prototype.addTmpTimeline=function(e,t){var i,n,a,r,s;existy(e)?(r=t.indexOf(e),s=r+1,n=t[r],i=n.sort_order,t.slice(-1)[0]===n?i+=100:(a=t[r+1].sort_order,i=bitwiseCeil((a+i)/2))):(i=0,s=0);var o=createInstance("Timeline",{name:{en:""},description:{en:""},hidden:!1,sort_order:i,isTemp:!0,index:s}),l=t.slice(0,s),c=t.slice(s,t.length);l.push(o),this.narrative.timelines=l.concat(c),this.tmpTimeline=o,this.toggleEpisodeList()},NarrativeDetailController.prototype.onEpisodeSelect=function(e){var t=this;this.dataSvc.getEpisodeOverview(e).then(function(e){return t.tmpTimeline.parent_episode=e,existy(e.description)&&(t.tmpTimeline.description.en=stripHtmlTags(e.description.en)),t.tmpTimeline.name.en=stripHtmlTags(e.title.en),e}).then(function(e){t.dataSvc.getSingleAsset(e.master_asset_id).then(function(e){t.tmpTimeline.duration=e?e.duration:0,t.toggleEpisodeList(),t.persistTmpTimeline(t.tmpTimeline)})})},NarrativeDetailController.prototype.persistTmpTimeline=function(e){var t=this;this.narrative.timelines=NarrativeDetailController._updateSortOrder(e.index,this.narrative.timelines);var i=function(i){return t.dataSvc.storeTimeline(t.narrative._id,e).then(function(e){return{d:e,e:i}})},n=function(i){var n=i.d,a=i.e;t.dataSvc.createEpisodeSegment(n._id,{episode_id:a._id,start_time:0,end_time:e.duration,sort_order:0,timeline_id:n._id}).then(function(e){n.episode_segments=[e],angular.forEach(t.narrative.timelines,function(e){e.sort_order===n.sort_order&&angular.extend(e,n,{isTemp:!1})}),t.tmpTimeline=null,t.doneEditingTimeline(),t._setTotalNarrativeDuration(t.narrative.timelines)})},a=function(e){};this.dataSvc.createChildEpisode({parent_id:e.parent_episode._id}).then(i).then(n).catch(a)},NarrativeDetailController.prototype.editorAction=function(e,t){!0===e.isTemp?this.persistTmpTimeline(e):this.updateTimeline(e,t)},NarrativeDetailController.prototype.deleteTimeline=function(e){var t=this;this.dataSvc.deleteTimeline(e._id).then(function(){t.narrative.timelines=t.narrative.timelines.filter(function(t){return e._id!==t._id}),t.doneEditingTimeline(),t._setTotalNarrativeDuration(t.narrative.timelines)})},NarrativeDetailController.prototype.exportToSpreadsheet=function(e){this.dataSvc.getNarrativeExportAsSpreadsheet(e)},NarrativeDetailController._updateSortOrder=function(e,t){var i=t.slice(),n=i.length,a=0;e>0&&(a=e===n-1?i[e-1].sort_order+100:bitwiseCeil((i[e-1].sort_order+i[e+1].sort_order)/2));var r=a;i[e].sort_order=a;var s=e+1;for(a+=1;s<n;s+=1)r>=i[s].sort_order&&(i[s].sort_order=a),r=a,a+=1;return i},NarrativeDetailController.prototype._setTotalNarrativeDuration=function(e){this.totalNarrativeDuration=e.map(function(e){return e.episode_segments.map(function(e){return e.end_time})[0]}).reduce(function(e,t){return e+t},0)},NarrativeDetailController.prototype._persistTimelineSortUpdate=function(e){this.dataSvc.storeTimeline(this.narrative._id,e).then(function(t){angular.extend(e,t)})},NarrativeDetailController.$inject=["$routeParams","authSvc","appState","dataSvc","modelSvc"],NarrativeDetailController}(),bt=function(){function NarrativeDetail(){this.bindings={narrative:"<",customers:"<"},this.template=_t.a,this.controller=St}return NarrativeDetail.Name="npNarrativeDetail",NarrativeDetail}(),Tt='\n<div class="narrative__edit">\n  <h2>Narrative Settings</h2>\n  <form name="nEditForm">\n    <div ng-show="$ctrl.containerInfo && $ctrl.canAccess">\n      <label for="nCustomer">Customer\n        <itt-validation-tip ng-if="nEditForm.customer.$invalid" text="A customer must be set"></itt-validation-tip>\n      </label>\n      <select id="nCustomer" name="customer" required ng-model="$ctrl.selectedCustomer"\n              ng-change="$ctrl.selectCustomer($ctrl.selectedCustomer)"\n              ng-options="cust.name for cust in $ctrl.customers track by cust._id"></select></br>\n    </div>\n    <div ng-if="$ctrl.selectedCustomer && $ctrl.containerInfo == null">\n      <h5>{{$ctrl.selectedCustomer.name}}</h5>\n    </div>\n    <label id="nName">Narrative Title\n      <itt-validation-tip ng-if="nEditForm.name.$invalid" text="Title is required"></itt-validation-tip>\n    </label>\n    <input for="nName" type="text" name="name" placeholder="Add Narrative Title"\n           ng-model="$ctrl.narrative.name.en" required>\n    <label for="nDescription">Description</label>\n    <textarea id="nDescription" name="description" placeholder="Add a Description"\n              ng-model="$ctrl.narrative.description.en"></textarea>\n    <div ng-if="!$ctrl.hidePathSlug">\n      <np-guest-accessible-url\n        narrative="$ctrl.narrative"\n        sub-domain="{{$ctrl.narrative.narrative_subdomain}}"\n        customer="$ctrl.selectedCustomer">\n      </np-guest-accessible-url>\n    </div>\n    <label for="nSupportUrl">Support Url\n      <itt-validation-tip ng-if="nEditForm.supportUrl.$invalid" text="Not a valid URL"></itt-validation-tip>\n    </label>\n    <input id="nSupportUrl" type="text" name="supportUrl" itt-valid-url placeholder="link for support"\n           ng-model="$ctrl.narrative.support_url"/>\n    <div class="narrative-flags">\n      <div>\n        <input id="nNewWindow" type="checkbox" ng-model="$ctrl.narrative.disable_new_window"/>\n        <label for="nNewWindow">Disable New Window</label>\n      </div>\n      <div>\n        <input id="nDisableNav" type="checkbox" ng-model="$ctrl.narrative.disable_navigation"/>\n        <label for="nDisableNav">Disable Navigation</label>\n      </div>\n      <div>\n        <input\n          id="nGuestAccess"\n          type="checkbox"\n          ng-change="$ctrl.guestAccessEffects()"\n          ng-model="$ctrl.narrative.guest_access_allowed"/>\n        <label for="nGuestAccess">Enable Guest Access</label>\n      </div>\n      <div ng-if="$ctrl.trueAdmin && $ctrl.narrative._id">\n        <input\n          id="socialshare-checkbox"\n          type="checkbox"\n          ng-disabled="$ctrl.narrative.disableSocialshare"\n          ng-model="$ctrl.narrative.enable_social_sharing"/>\n        <label for="socialshare-checkbox">Enable Socialshare</label>\n      </div>\n    </div>\n    <itt-enable-socialshare\n      ng-if="$ctrl.trueAdmin && $ctrl.narrative._id"\n      container-id="{{$ctrl.selectedCustomer.root_container_id}}"\n      editor-form="nEditForm"\n      narrative="$ctrl.narrative">\n    </itt-enable-socialshare>\n    <div class="ancillaryNav">\n      <button class="done" ng-click="$ctrl.handleUpdate($ctrl.narrative)"\n              ng-disabled="nEditForm.$invalid || $ctrl.narrative.error">Save\n      </button>\n      <button class="done" ng-click="$ctrl.cancel()">Cancel</button>\n    </div>\n  </form>\n</div>\n',Et=function(){function NarrativeEditorController(e,t){this.authSvc=e,this.uploadsService=t}return NarrativeEditorController.prototype.$onInit=function(){this.narrative&&(null==this.narrative.social_image_square&&null==this.narrative.social_image_wide||(this.narrative.social_image_wide=null,this.narrative.social_image_square=null)),this._narrative=angular.copy(this.narrative),this._setNameFromContainer(),this._setCustomer(),this.guestAccessEffects()},NarrativeEditorController.prototype.cancel=function(){this.narrative=angular.copy(this._narrative),this.onDone({$undo:this.narrative})},NarrativeEditorController.prototype.trueAdmin=function(){return this.authSvc.userHasRole("admin")},NarrativeEditorController.prototype.canAccess=function(){return this.trueAdmin()||this.authSvc.userHasRole("customer admin")},NarrativeEditorController.prototype.guestAccessEffects=function(){null!=this.narrative&&(!1===this.narrative.guest_access_allowed?(this.narrative.enable_social_sharing=!1,this.narrative.disableSocialshare=!0):this.narrative.disableSocialshare=!1)},NarrativeEditorController.prototype.selectCustomer=function(e){this.selectedCustomer=e},NarrativeEditorController.prototype.handleUpdate=function(e){var t=this;existy(this.selectedCustomer)&&(e.customer_id=this.selectedCustomer._id);var i=["name","description","customer_id","guest_access_allowed","enable_social_sharing","narrative_image_ids","path_slug","support_url","disable_navigation","disable_new_window","_id"],n=createInstance("Narrative",pick(e,i)),a=[];if(e.social_image_square&&a.push({file:e.social_image_square.file,tag:l}),e.social_image_wide&&a.push({file:e.social_image_wide.file,tag:c}),a.length>0)this.uploadsService.uploadTaggedFiles(a,this.selectedCustomer.root_container_id).then(function(e){e.forEach(function(e){return n.narrative_image_ids.push(e.file._id)}),t.uploadsService.resetUploads(),t.onUpdate({$narrative:n})});else if(existy(this.containerInfo)){var r=this.containerInfo.containerId;this.onUpdate({$data:{narrative:n,containerId:r}})}else this.onUpdate({$narrative:n})},NarrativeEditorController.prototype._setNameFromContainer=function(){existy(this.containerInfo)&&(existy(this.narrative)?this.narrative.name=this.containerInfo.name:this.narrative={name:this.containerInfo.name})},NarrativeEditorController.prototype._setCustomer=function(){if(this.customers&&1===this.customers.length)this.selectCustomer(this.customers[0]);else if(existy(this.narrative)||existy(this.containerInfo)){var e=existy(this.containerInfo)&&this.containerInfo.customerId||this.narrative.customer_id;this.selectCustomer(this.customers.filter(function(t){return t._id===e})[0])}else this.customers.unshift({name:"Select a Customer"})},NarrativeEditorController.$inject=["authSvc","uploadsService"],NarrativeEditorController}(),Ct=function(){function NarrativeEditor(){this.bindings={narrative:"<?",customers:"<",containerInfo:"<?",hidePathSlug:"<?",onDone:"&",onUpdate:"&"},this.template=Tt,this.controller=Et}return NarrativeEditor.Name="npNarrativeEditor",NarrativeEditor}(),wt=i("2AAL"),kt=i.n(wt),It=function(){function NarrativeListController(e,t,i,n,a){this.$location=e,this.authSvc=t,this.appState=i,this.dataSvc=n,this.modelSvc=a,this.narrativeSelect=!1,this.user=null,this.canAccess=!1}return NarrativeListController.prototype.$onInit=function(){this.user=this.appState.user,(this.authSvc.userHasRole("admin")||this.authSvc.userHasRole("customer admin"))&&(this.canAccess=!0),this._updateAllEvenOdd()},NarrativeListController.prototype.logout=function(){this.authSvc.logout()},NarrativeListController.prototype.setSelectedNarrative=function(e){var t=this,i=existy(e.narratives)&&e.narratives.length>1;this.selectedCustomer=[e],i?this.narrativeSelect=!this.narrativeSelect:this.dataSvc.getNarrativeList(e).then(function(){t.narrativeSelect=!t.narrativeSelect})},NarrativeListController.prototype.customerRowClick=function(e,t){t.stopPropagation(),e.isActive=!e.isActive,this.narrativeRow=null,this.customersData.forEach(function(t){e._id!==t._id&&(t.isActive=!1)})},NarrativeListController.prototype.gotoNarrative=function(e,t){t.stopPropagation(),this.$location.path("/story/"+e)},NarrativeListController.prototype.toggleRow=function(e,t){t.stopPropagation(),e.showNarratives=!e.showNarratives,e.showNarratives?this._toggleNarrativesOpened(e):(e.showNarratives=!1,this._toggleNarrativesClosed())},NarrativeListController.prototype.setRowClasses=function(e){return{hoverIndicator:!e.showNarratives,"container__row--even":!1===e.evenOdd,"container__row--odd":!0===e.evenOdd,isActive:e.isActive}},NarrativeListController.prototype.setNarrativeRowClasses=function(e,t){return{hoverIndicator:e.showNarratives,"container__row--even":!1===t.evenOdd,"container__row--odd":!0===t.evenOdd,isActive:t===this.narrativeRow}},NarrativeListController.prototype.setNarrativeToEdit=function(e,t,i){e.stopPropagation(),this.narrativeToEdit=t,this.selectedCustomer=[i]},NarrativeListController.prototype.closeAddOrEditModal=function(e,t){if(this.narrativeSelect=!1,this.selectedCustomer=[],this.narrativeToEdit=null,e&&t)return void this.$location.path("/story/"+e._id);if(e)for(var i=0;i<this.customersData.length;i+=1)if(this.customersData[i]._id===e.customer_id)for(var n=0;n<this.customersData[i].narratives.length;n+=1)if(this.customersData[i].narratives[n]._id===e._id){this.customersData[i].narratives[n]=e;break}},NarrativeListController.prototype.addOrUpdateNarrative=function(e){var t=this,i=null==e._id?"createNarrative":"updateNarrative";this._addOrUpdateNarr(e,i).then(function(e){return t.closeAddOrEditModal(e,!0)}).catch(function(e){return t._handleErr(e)})},NarrativeListController.prototype.toggleNarrativeRow=function(e,t){t.stopPropagation(),null===this.narrativeRow?this.narrativeRow=e:e===this.narrativeRow?this.narrativeRow=null:this.narrativeRow=e,this.customersData.forEach(function(e){e.isActive=!1})},NarrativeListController.prototype._toggleNarrativesOpened=function(e){existy(e.narratives)&&0!==e.narratives.length||this._fetchAndCacheNarratives(e),existy(e.narratives)&&e.narratives.length>=1&&this._updateAllEvenOdd()},NarrativeListController.prototype._fetchAndCacheNarratives=function(e){var t=this;this.dataSvc.getNarrativeList(e).then(function(){t._updateAllEvenOdd()})},NarrativeListController.prototype._updateAllEvenOdd=function(){for(var e=1,t=this.customersData.length;e<=t;e+=1){e-1==0&&(this.customersData[0].evenOdd=!1);var i=this.customersData[e],n=this.customersData[e-1],a=null;if(existy(n.narratives)&&n.narratives.length>0&&!0===n.showNarratives&&(this._updateNarrativeEvenOdd(n),a=n.narratives[n.narratives.length-1]),!existy(i))return;existy(a)?i.evenOdd=!a.evenOdd:i.evenOdd=!n.evenOdd}},NarrativeListController.prototype._updateNarrativeEvenOdd=function(e){e.narratives=e.narratives.sort(function(e,t){var i=e.name.en.toLowerCase(),n=t.name.en.toLowerCase();return i<n?-1:i>n?1:0}).reduce(function(t,i,n){return 0===n?(i.evenOdd=!e.evenOdd,t.push(i),t):(i.evenOdd=!t[n-1].evenOdd,t.push(i),t)},[])},NarrativeListController.prototype._toggleNarrativesClosed=function(){this._updateAllEvenOdd()},NarrativeListController.prototype._addOrUpdateNarr=function(e,t){var i=this;return this.dataSvc[t](e).then(function(e){var n=e.data,a=i.modelSvc.customers[n.customer_id];a=i.modelSvc.assocNarrativesWithCustomer(a,[n]);var r=i.customersData.filter(function(e){return e._id===a._id});if(1===r.length&&(i._updateNarrativeEvenOdd(a),r[0]=a,"createNarrative"===t))return n})},NarrativeListController.prototype._handleErr=function(e){e.data.path_slug&&(this.narrativeToEdit.error="path slug is already taken")},NarrativeListController.$inject=["$location","authSvc","appState","dataSvc","modelSvc","ittUtils"],NarrativeListController}(),xt=function(){function NarrativeList(){this.bindings={customersData:"<"},this.template=kt.a,this.controller=It}return NarrativeList.Name="npNarrativeList",NarrativeList}(),Pt='\n<div class="standaloneAncillaryPage">\n\t<np-nav on-logout="$ctrl.logout()"></np-nav>\n\t<h1>Narratives</h1>\n\t<np-loading ng-if="$ctrl.customersData == null"></np-loading>\n\t<np-narrative-list\n\t  ng-if="$ctrl.customersData"\n\t  class="np-narrative-container"\n\t  customers-data="$ctrl.customersData">\n\t</np-narrative-list>\n</div>\n',At=function(){function NarrativesContainerController(e,t,i,n){this.$q=e,this.authSvc=t,this.dataSvc=i,this.modelSvc=n}return NarrativesContainerController.prototype.$onInit=function(){var e=this;this._resolveCustomers().then(function(t){return e.customersData=e.modelSvc.getCustomersAsArray()})},NarrativesContainerController.prototype.logout=function(){this.authSvc.logout()},NarrativesContainerController.prototype._resolveCustomers=function(){var e=this,t=this.modelSvc.getCustomersAsArray();return Object.keys(t).length>0?this.$q.resolve(t):this.authSvc.authenticate().then(function(){return e.dataSvc.getCustomerList()}).then(function(e){return e})},NarrativesContainerController.$inject=["$q","authSvc","dataSvc","modelSvc"],NarrativesContainerController}(),$t=function(){function NarrativesContainer(){this.bindings={},this.template=Pt,this.controller=At}return NarrativesContainer.Name="npNarrativesContainer",NarrativesContainer}(),Lt='\n<div class="timeline__edit">\n  <form name="tlEditForm">\n    <label for="tlName">Name\n      <itt-validation-tip ng-if="tlEditForm.name.$invalid" text="Name is required"></itt-validation-tip>\n    </label>\n    <input type="text" name="name" ng-model="$ctrl._timeline.name.en" id="tlName" required>\n    <label for="tlDescription">Description</label>\n    <textarea id="tlDescription" name="description" placeholder="Insert Description..."\n              ng-model="$ctrl._timeline.description.en"></textarea>\n    <np-guest-accessible-url narrative="$ctrl.narrative" timeline="$ctrl._timeline"></np-guest-accessible-url>\n    <label>Hidden</label>\n    <input type="checkbox" ng-model="$ctrl._timeline.hidden"/>\n    <itt-enable-socialshare\n      ng-if="$ctrl.trueAdmin"\n      narrative="$ctrl.narrative"\n      container-id="{{$ctrl.containerId}}"\n      editor-form="tlEditForm"\n      timeline="$ctrl._timeline">\n    </itt-enable-socialshare>\n    <div class="ancillaryNav">\n      <button class="button" ng-disabled="tlEditForm.$invalid || $ctrl._timeline.error"\n              ng-click="$ctrl.handleUpdate($ctrl._timeline)">Save\n      </button>\n      <button class="button" ng-click="$ctrl.confirmDelete()">Delete</button>\n      <button class="button" ng-click="$ctrl.onDone()">Cancel</button>\n    </div>\n  </form>\n</div>\n<np-modal modal-class="modal__center-center" ng-if="$ctrl.underDelete">\n  <h2>Are you sure?</h2>\n  <p>delete: </p>\n  <p class="under__delete"><strong>{{$ctrl._timeline.name.en}}?</strong></p>\n  <button ng-click="$ctrl.onDelete({ $timeline: $ctrl._timeline })">yes</button>\n  <button ng-click="$ctrl.underDelete = false">no</button>\n</np-modal>\n',Nt=function(){function TimelineEditorController(e,t,i){this.$location=e,this.uploadsService=t,this.authSvc=i,this.underDelete=!1}return TimelineEditorController.prototype.$onInit=function(){this.host=this.$location.protocol()+":"+n.apiDataBaseUrl,this.trueAdmin=this.authSvc.userHasRole("admin"),existy(this.timeline)&&!0===this.timeline.isTemp?this._timeline=this.timeline:this._timeline=angular.copy(this.timeline)},TimelineEditorController.prototype.handleUpdate=function(e){var t=this,i=["_id","name","description","hidden","sort_order","path_slug","episode_segments","timeline_image_ids"],n=pick(e,i),a=[];e.social_image_square&&a.push({file:e.social_image_square.file,tag:l}),e.social_image_wide&&a.push({file:e.social_image_wide.file,tag:c}),a.length>0?this.uploadsService.uploadTaggedFiles(a,this.containerId).then(function(e){e.forEach(function(e){return n.timeline_image_ids.push(e.file._id)}),t.uploadsService.resetUploads(),t.onUpdate({$timeline:n})}):this.onUpdate({$timeline:n})},TimelineEditorController.prototype.confirmDelete=function(){this.underDelete=!0},TimelineEditorController.$inject=["$location","uploadsService","authSvc"],TimelineEditorController}(),Mt=function(){function TimelineEditor(){this.bindings={timeline:"<",narrative:"<",containerId:"@?",onUpdate:"&",onDelete:"&",onDone:"&"},this.template=Lt,this.controller=Nt}return TimelineEditor.Name="npTimelineEditor",TimelineEditor}(),Ut=angular.module("np.stories",[]);[Ze,it,st,ct,pt,vt,ft,bt,Ct,xt,$t,Mt].forEach(function(e){Ut.component(e.Name,new e)});var Ot=function(){function AnalyticsService(e,t,i,n,a,r){this.$q=e,this.$http=t,this.$routeParams=i,this.$interval=n,this.appState=a,this.playbackService=r,this.activityQueue=[],this.pollLength=1e4}return AnalyticsService.prototype.startPolling=function(){var e=this;this.pollInterval=this.$interval(function(){return e.flushActivityQueue()},this.pollLength)},AnalyticsService.prototype.stopPolling=function(){this.flushActivityQueue(),this.$interval.cancel(this.pollInterval)},AnalyticsService.prototype.captureEpisodeActivity=function(e,t){if(!this.appState.user||!this.appState.user._id||this.appState.user.track_episode_metrics){var i={name:e,walltime:new Date,timestamp:this.playbackService.getMetaProp("time")||0};t&&(i.data=t),this.activityQueue.push(i)}},AnalyticsService.prototype.captureEventActivity=function(e,t,i,a){!a&&(n.disableAnalytics||this.appState.user._id&&!this.appState.user.track_event_actions)||this.activityQueue.push({name:e,event_id:t,walltime:new Date,data:i})},AnalyticsService.prototype.readEpisodeActivity=function(e){return this.$http.get(n.apiDataBaseUrl+"/v2/episodes/"+e+"/episode_user_metrics").then(function(e){return e}).catch(function(e){})},AnalyticsService.prototype.readEventActivity=function(e,t){return this.$http.get(n.apiDataBaseUrl+"/v2/events/"+e+"/event_user_actions").then(function(e){return e.data}).then(function(e){if(!t)return e;for(var i=0;i<e.length;i++){if(e[i].name===t)return!0}})},AnalyticsService.prototype.forceCaptureEventActivityWithPromise=function(e,t,i){return this.captureEventActivity(e,t,i,!0),this.flushActivityQueue()},AnalyticsService.prototype.flushActivityQueue=function(){var e=this;return this.$q(function(t){if(0===e.activityQueue.length)return t("");e.appState.episodeId||t();var i=angular.copy(e.activityQueue);e.activityQueue=[];var a=new Date,r=[],s=[];angular.forEach(i,function(e){e.age=(+a-+e.walltime)/1e3,delete e.walltime,e.event_id?s.push(e):r.push(e)}),r=e.dejitter(r);var o=[];if(s.length>0){var l=n.apiDataBaseUrl+"/v2/episodes/"+e.appState.episodeId+"/event_user_actions";o.push(e.$http.post(l,{event_user_actions:s}))}return r.length>0&&o.push(e.$http.post(n.apiDataBaseUrl+"/v2/episodes/"+e.appState.episodeId+"/episode_user_metrics",{episode_user_metrics:r})),e.$q.all(o)})},AnalyticsService.prototype.dejitter=function(e){if(0===e.length)return[];for(var t=[],i=0;i<e.length-1;i++){var n=e[i],a=e[i+1];"seek"===n.name&&"seek"===a.name&&n.timestamp===a.data.seekStart?a.data.seekStart=n.data.seekStart:t.push(e[i])}return t.push(e[e.length-1]),t},AnalyticsService.Name="analyticsSvc",AnalyticsService.$inject=["$q","$http","$routeParams","$interval","appState","playbackService"],AnalyticsService}(),Dt=function(){function ValidationService(e,t,i,n,a,r){this.$http=e,this.$location=t,this.$q=i,this.authSvc=n,this.ittUtils=a,this.urlService=r}return ValidationService.parseCSP=function(e){if(null!=e)return e.split(";").reduce(function(e,t){var i=t.trim().split(/\s+/g),n=i.shift();return n&&(e[n]=i),e},{})},ValidationService.prototype.checkXFrameOpts=function(e){var t=this,i=encodeURIComponent(e);return this.SANE_GET("/x_frame_options_proxy?url="+i).then(function(e){return t.handleSuccess(e)}).then(function(i){return t.canEmbed(i,e)}).catch(function(e){return ValidationService.handleErrors(e)})},ValidationService.prototype.urlIsEmbeddable=function(e,t){var i=this.xFrameHeaderCanEmbed(e,t.x_frame_options),n=this.cspCanEmbed(e,t.content_security_policy);return i&&n},ValidationService.prototype.mixedContent=function(e,t){return this.mixedContentUrl(e)?(t.validatedFields.mixedContent={message:"Mixed Content Detected",showInfo:!0},!0):(t.validatedFields.mixedContent={message:"",showInfo:!1},!1)},ValidationService.prototype.mixedContentUrl=function(e){return this.ittUtils.existy(e)&&/^http:\/\//.test(e)},ValidationService.prototype.validateUrl=function(e,t){var i=this.urlService.isVideoUrl(e)||this.ittUtils.isValidURL(e)||ValidationService.emailOrPlaceholder(e);return""!==e||ValidationService.emailOrPlaceholder(e)?i?(t.validatedFields.url={showInfo:!1},!0):(t.validatedFields.url={showInfo:!0,message:e+" is not a valid URL"},!1):(t.validatedFields.url={showInfo:!0,message:"Url cannot be blank"},!1)},ValidationService.prototype.inspectHeadersAsync=function(e,t,i,n){var a=this;return null!=i?this.$q(function(n){var r={canEmbed:a.urlIsEmbeddable(e,i),location:i.location,urlStatus:{content_security_policy:i.content_security_policy,x_frame_options:i.x_frame_options,response_code:i.response_code,err:i.err}};return n(a.handleXframeOptsObj(e,r,t))}):""===e||this.urlService.isVideoUrl(e)||ValidationService.emailOrPlaceholder(e)?this.$q(function(i){t.validatedFields.iframeHeaders={showInfo:!1};var n={canEmbed:!0,location:null,urlStatus:{content_security_policy:null,x_frame_options:null,response_code:null,err:null}};return"kaltura"===a.urlService.checkUrl(e).type&&(n.location=a.urlService.parseInput(e)),i(n)}):this.checkXFrameOpts(e).then(function(i){return a.handleXframeOptsObj(e,i,t)})},ValidationService.emailOrPlaceholder=function(e){return/mailto:/.test(e)||"https://"===e},ValidationService.handleErrors=function(e){return{canEmbed:!1}},ValidationService.prototype.cspCanEmbed=function(e,t){if(null==t)return!0;var i=ValidationService.parseCSP(t),n=i["frame-ancestors"];if(null==n||0===n.length)return!0;var a=this.$location.host();if(1===n.length){var r=n[0];if("'self'"===r&&e.includes(a)||r.includes(a))return!0;if("'none'"===r)return!1}for(var s=0,o=n;s<o.length;s++){if(o[s].includes(a))return!0}return!1},ValidationService.prototype.xFrameHeaderCanEmbed=function(e,t){var i=!1;if(null==t||"null"===t)return!0;switch(!0){case/SAMEORIGIN/i.test(t):var n=this.$location.host(),a=document.createElement("a");a.href=e,n===a.hostname&&(i=!0);break;case/ALLOW-FROM/i.test(t):var r=t.split(",");n=this.$location.host(),angular.forEach(r,function(e){var t=e.trim().split(" ")[1],a=document.createElement("a");a.href=t,n===a.hostname&&(i=!0)});break;case/DENY/i.test(t):}return i},ValidationService.prototype.handleXframeOptsObj=function(e,t,i){var n="";return this.ittUtils.existy(t.location)&&(n=e+" redirected to "+t.location,i.validatedFields[301]={showInfo:!0,message:n,doInfo:!0}),this.ittUtils.existy(t.urlStatus.response_code)&&422===t.urlStatus.response_code?(n=e+" cannot be found",i.validatedFields[404]={showInfo:!0,message:n},this.$q.reject("404")):(null!=t.urlStatus.err&&999!==t.urlStatus.response_code?i.validatedFields.iframeHeaders={showInfo:!0,message:e+" cannot be embedded: "+t.urlStatus.err}:t.canEmbed||this.mixedContentUrl(e)?i.validatedFields.iframeHeaders={showInfo:!1}:(n="Embedded link template is disabled because "+e+" does not allow iframing",t.location&&(n+=". "+i.validatedFields[301].message,i.validatedFields[301]={}),i.validatedFields.iframeHeaders={showInfo:!0,message:n,doInfo:!0}),t)},ValidationService.prototype.handleSuccess=function(e){return this.ittUtils.existy(e.x_frame_options)&&(e.x_frame_options=e.x_frame_options.toUpperCase()),e},ValidationService.prototype.canEmbed=function(e,t){var i={content_security_policy:e.content_security_policy,x_frame_options:e.x_frame_options,err:e.err,response_code:e.response_code},n=Object.create(null),a=e.location;return 999===e.response_code?n.canEmbed=!1:n.canEmbed=this.urlIsEmbeddable(t,e),Object.assign(n,{location:a},{urlStatus:i}),n},ValidationService.prototype.SANE_GET=function(e){var t=this;return this.authSvc.authenticate().then(function(){return t.$http.get(n.apiDataBaseUrl+e).then(function(e){return e.data})})},ValidationService.Name="validationSvc",ValidationService.$inject=["$http","$location","$q","authSvc","ittUtils","urlService"],ValidationService}();selectService_selectService.$inject=["authSvc","modelSvc","dataSvc","ittUtils"];var Ft=i("IrCW"),Rt=i.n(Ft),Vt=function(){function NarrativeTimelineCtrl(e,t,i,n,a,r,s){this.$scope=e,this.$routeParams=t,this.$location=i,this.dataSvc=n,this.appState=a,this.authSvc=r,this.errorSvc=s}return NarrativeTimelineCtrl.prototype.$onInit=function(){var e=this;this.disableSocialShareOnDev(),this.dataSvc.getNarrative(this.$routeParams.narrativePath).then(function(t){e.appState.narrativeId=t._id,e.$scope.narrative=t;var i=e.authSvc.getRoleForNarrative(t._id),n=e.authSvc.getDefaultProductForRole(i),a=Object.create(null),r="",s="";e.appState.product=n,angular.forEach(t.timelines,function(t){t._id!==e.$routeParams.timelinePath&&t.path_slug.en!==e.$routeParams.timelinePath||(a=t,r=t.name.en,s=t._id,e.appState.timelineId=t._id,t.episode_segments[0]&&(e.appState.episodeId=t.episode_segments[0].episode_id,e.appState.episodeSegmentId=t.episode_segments[0]._id,e.$scope.showPlayer=!0))});var o=t.path_slug.en,l=a.path_slug.en,c=t.narrative_subdomain;!0===t.enable_social_sharing&&!0===e.$scope.enableSocialSharing&&(e.$scope.socialShareInfo={subDomain:c,tlTitle:r,narrative:o,timeline:{url:l,id:s}}),e.appState.episodeId||e.errorSvc.error({data:"Sorry, no episode was found in this timeline."})})},NarrativeTimelineCtrl.prototype.disableSocialShareOnDev=function(){this.$scope.enableSocialSharing=!/api-dev|np-dev|demo/.test(this.$location.host())},NarrativeTimelineCtrl.$inject=["$scope","$routeParams","$location","dataSvc","appState","authSvc","errorSvc"],NarrativeTimelineCtrl}(),Bt=i("Ec80"),jt=i.n(Bt);PlayerController.$inject=["$scope","$location","$rootScope","$routeParams","$timeout","$interval","appState","dataSvc","modelSvc","timelineSvc","analyticsSvc","authSvc","selectService","playbackService","episodeTheme"];var Ht=i("DC6m"),qt=i.n(Ht);ittSearchPanel.$inject=["appState"],SearchPanelController.$inject=["$scope","$rootScope","$timeout","appState"];var Wt=i("7/ac"),Kt=i.n(Wt),zt=function(){function ToolbarStory(){this.restrict="EA",this.template=Kt.a,this.scope=!0}return ToolbarStory.factory=function(){return function(){return new ToolbarStory}},ToolbarStory.Name="npToolbarStory",ToolbarStory}();ittVolumeSlider.$inject=["playbackService"];var Gt=function(){function MagnetStore(e){this._bcr=e}return MagnetStore.of=function(e){return new MagnetStore(e)},Object.defineProperty(MagnetStore.prototype,"bcr",{get:function(){return this._bcr},enumerable:!0,configurable:!0}),MagnetStore}(),Qt=function(){function Magnet(e,t,i,n){this.$rootScope=e,this.$timeout=t,this.appState=i,this.playbackService=n,this.restrict="A"}return Magnet.factory=function(){var e=function(e,t,i,n){return new Magnet(e,t,i,n)};return e.$inject=Magnet.$inject,e},Magnet.prototype.link=function(e,t,i){var n=this,a={magnetBoundingClientRect:null,size:null,appState:null},r=function(e){return e+(void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)},s=function(){var e=t[0].getBoundingClientRect(),i=e.top,a=e.left,s=e.width,o=i;return"review"!==n.appState.viewMode&&(o=r(i)),{left:a,width:s,top:o}},o=function(){return{viewMode:n.appState.viewMode,videoPosition:n.appState.editEvent.styleCss}},l=function(){return{w:angular.element(window).width(),h:angular.element(window).height(),v:t.is(":visible")}},c=function(e){if(e){var t=Gt.of(e);return 0===n.playbackService.getMetaProp("time")?void n.$rootScope.$emit("magnet.jumpToMagnet",t.bcr):void n.$rootScope.$emit("magnet.changeMagnet",t.bcr)}p().then(function(e){var t=Object.assign({},e);"review"!==n.appState.viewMode&&(t.top=r(t.top));var i=Gt.of(t);if(0===n.playbackService.getMetaProp("time"))return void n.$rootScope.$emit("magnet.jumpToMagnet",i.bcr);n.$rootScope.$emit("magnet.changeMagnet",i.bcr)})},u=function(){var e=angular.element(window),i=e.height()-46;e.width()/i>16/9?t.width(16/9*i):t.width(e.width()),c()},p=function(e){return void 0===e&&(e=100),n.$timeout(function(){var e=t[0].getBoundingClientRect();return{top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width}},e).then(function(e){return e})},m=function(e){e&&c(e)},v=function(){n.appState.isIOS()&&"review"===n.appState.viewMode||c()},g=function(){window.removeEventListener("resize",v),Object.keys(a).forEach(function(e){a[e]&&a[e]()})};this.$rootScope.$on(d,function(){return c()}),function(){window.addEventListener("resize",v),n.appState.isIOS()?(p(500).then(function(e){return c(e)}),a.appState=e.$watchCollection(o,function(e,t){if(e.videoPosition!==t.videoPosition)return void n.$timeout(function(){return c()},500);e.viewMode&&c()})):a.magnetBoundingClientRect=e.$watchCollection(s,m),"watchModeVideoMagnet"===t.attr("id")&&(a.size=e.$watch(l,u,!0))}(),e.$on("$destroy",g)},Magnet.Name="ittMagnet",Magnet.$inject=["$rootScope","$timeout","appState","playbackService"],Magnet}(),Yt=function(){function Magnetized(e,t){this.$rootScope=e,this.appState=t,this.restrict="A"}return Magnetized.factory=function(){var e=function(e,t){return new Magnetized(e,t)};return e.$inject=Magnetized.$inject,e},Magnetized.prototype.link=function(e,t,i){var n=this,a=function(e,i){if(null!=e){"review"===n.appState.viewMode?t.css("position","fixed"):t.css("position","absolute");var a=e.top,r=e.left,s=e.width;!0===i?(t.css("transition-timing-function","cubic-bezier(0.4, 0, 1, 1)"),t.css("transition-duration","0.25s")):(t.css("transition-duration","unset"),t.css("transition-timing-function","unset"));var o=s/854;0!==o&&t.css("transform","translate("+Math.abs(r)+"px, "+Math.abs(a)+"px) scale("+o+")")}};this.$rootScope.$on("magnet.changeMagnet",function(e,t){return a(t,!0)}),this.$rootScope.$on("magnet.jumpToMagnet",function(e,t){return a(t,!1)})},Magnetized.Name="ittMagnetized",Magnetized.$inject=["$rootScope","appState"],Magnetized}();ittShowHideVisualOnly.$inject=["$animate"],EditController.$inject=["$scope","$rootScope","$timeout","$window","selectService","appState","dataSvc","modelSvc","timelineSvc","authSvc","MIMES","playbackService","episodeTheme","episodeEdit"];var Xt=(i("5Nri"),i("VUCL"),i("mcSx"),i("cs5V"),'\n<div class="episode episode-template" ng-class="episode.templateCss" ng-hide="episodeTheme.sheetLoading">\n\n  <div\n    class="fill"\n    ng-if="episode.template.css_configuration.fill_class != null"\n    ng-class="episode.template.css_configuration.fill_class">\n    \n    <div ng-if="episode.template.css_configuration.fill_class === \'gwsb-seal\'" class="fill"></div>\n  </div>\n  <span np-reviewmode-template></span>\n  <span np-watchmode-template></span>\n  <span\n    np-discovermode-template\n    ng-class="{\'colorInvert DiscoverModeOnly\': episode.template.displayName === \'Middlebury\'}"\n    ng-repeat="scene in episode.scenes | isCurrent">\n  </span>\n  <span np-video-template></span>\n  <span np-windowfg-template></span>\n  <np-episode-footer template-data="episode.template"></np-episode-footer>\n</div>\n'),Jt=function(){function EpisodeController(e,t,i,n,a,r,s){this.$scope=e,this.$interval=t,this.analyticsSvc=i,this.modelSvc=n,this.appState=a,this.dataSvc=r,this.timelineSvc=s}return EpisodeController.prototype.$onInit=function(){var e=this;this.$scope.episode=this.modelSvc.episodes[this.appState.episodeId],this.loadEpisodeForPlayer();var t=function(){e.$scope.episode=e.modelSvc.episodes[e.appState.episodeId]};this.$interval(t,457)},EpisodeController.prototype.$onDestroy=function(){this.analyticsSvc.captureEpisodeActivity("episodeUnload"),this.analyticsSvc.stopPolling()},EpisodeController.prototype.loadEpisodeForPlayer=function(){this.analyticsSvc.startPolling(),this.analyticsSvc.captureEpisodeActivity("episodeLoad")},EpisodeController.$inject=["$scope","$interval","analyticsSvc","modelSvc","appState","dataSvc","timelineSvc"],EpisodeController}(),Zt=i("V+JG"),ei=i.n(Zt);ittEpisodeEditor.$inject=["$rootScope","$timeout","appState","modelSvc","dataSvc","authSvc","selectService","playbackService","urlService","episodeTheme","episodeEdit"];var ti=i("01M/"),ii=function(){function EpisodeTheme(e){this.$q=e,this.linkId="np-template-theme",this._sheetLoading=!1}return Object.defineProperty(EpisodeTheme.prototype,"sheetLoading",{get:function(){return this._sheetLoading},set:function(e){this._sheetLoading=e},enumerable:!0,configurable:!0}),EpisodeTheme.prototype.setTheme=function(e){var t=this;return this.loadThemeStyleSheet(e.id).then(function(){return t.loadFontFamily(e.fonts)})},EpisodeTheme.prototype.loadThemeStyleSheet=function(e){return null!=this.linkTag?this._changeHref(e):this._appendLinkTag(e),this._imgLoadEvtHack()},EpisodeTheme.prototype.loadFontFamily=function(e){null!=e&&ti.load(e)},EpisodeTheme._getHrefPath=function(e){return"https:"+n.apiDataBaseUrl+"/v1/templates/"+e+".css"},EpisodeTheme.prototype._imgLoadEvtHack=function(){var e=this;return this.sheetLoading=!0,this.$q(function(t){e.imgElm=document.createElement("img"),e.imgElm.src=e.linkTag.href,document.body.appendChild(e.imgElm),e.imgElm.onerror=function(){return document.body.removeChild(e.imgElm),e.sheetLoading=!1,t(void 0)}})},EpisodeTheme.prototype._changeHref=function(e){this.linkTag.setAttribute("href",EpisodeTheme._getHrefPath(e))},EpisodeTheme.prototype._appendLinkTag=function(e){var t=document.createElement("link");t.setAttribute("id",this.linkId),t.setAttribute("rel","stylesheet"),t.setAttribute("href",EpisodeTheme._getHrefPath(e)),this.linkTag=t,document.head.appendChild(this.linkTag)},EpisodeTheme.Name="episodeTheme",EpisodeTheme.$inject=["$q"],EpisodeTheme}(),ni=function(){function EpisodeEditService(e,t,i,n,a,r,s,o){this.$timeout=e,this.appState=t,this.selectService=i,this.modelSvc=n,this.dataSvc=a,this.episodeTheme=r,this.playbackService=s,this.timelineSvc=o}return EpisodeEditService.prototype.updateEpisodeTemplate=function(e,t){var i=this.dataSvc.getTemplate(t),n=createInstance("Episode",e);n.template=i,n.template_id=i.id;var a=this.modelSvc.deriveEpisode(n);this.modelSvc.cache("episode",a);var r=this.modelSvc.resolveEpisodeEvents(a._id);return this.episodeTheme.setTheme(i).then(function(){return r})},EpisodeEditService.prototype.addEpisodeToContainer=function(e){var t=this,i={container_id:e._id,title:angular.copy(e.name)};return this.dataSvc.fetchTemplates().then(function(){return t.dataSvc.getEpisodeTemplatesByCustomerIds([e.customer_id])}).then(function(e){if(1===e.length)i.template_id=e[0].id;else{var t=e.filter(function(e){return"Unbranded"!==e.name});i.template_id=t[0].id}}).then(function(){return t.dataSvc.createEpisode(i).then(function(e){return{_type:"Scene",title:{},description:{},templateUrl:"templates/scene/onecol.html",component_name:o.ONECOL_TEMPLATE,start_time:0,end_time:0,episode_id:e._id}}).then(function(e){return t.dataSvc.storeItem(e)}).then(function(){return e})})},EpisodeEditService.prototype.setEpisodeToEdit=function(){var e=this.modelSvc.episodes[this.appState.episodeId],t=this.modelSvc.containers[e.container_id].customer_id;this.appState.editEpisode=e,this.appState.editEpisode.templateOpts=this.selectService.getTemplates("episode",[t]),this.appState.videoControlsActive=!0,this.appState.videoControlsLocked=!0},EpisodeEditService.prototype.detatchMasterAsset=function(e){this.dataSvc.detachMasterAsset(e).then(function(e){window.location.reload()})},EpisodeEditService.prototype.saveEpisode=function(e){var t=this,i=angular.copy(this.appState.editEpisode);this.dataSvc.storeEpisode(i).then(function(n){if(t.modelSvc.cache("episode",t.dataSvc.resolveIDs(n)),t.appState.editEpisode._master_asset_was_changed){delete t.modelSvc.episodes[n._id]._master_asset_was_changed;var a=t.modelSvc.assets[n.master_asset_id].duration,r=a-.01;t.modelSvc.episodes[t.appState.episodeId].masterAsset=t.modelSvc.assets[e.master_asset_id],t.modelSvc.episodes[t.appState.episodeId].master_asset_id=n.master_asset_id;var s=[],o=[],l=t.modelSvc.episodes[i._id];angular.forEach(l.scenes,function(e){e.start_time>a?o.push(e):e.end_time>a&&(e.end_time=r,s.push(e))}),angular.forEach(l.items,function(e){e.start_time>a&&(e.start_time=r),e.end_time>a&&(e.end_time=r),s.push(e)});var c=t.modelSvc.events["internal:endingscreen:"+i._id];c?(c.start_time=r,c.end_time=r):t.modelSvc.addEndingScreen(i._id),t.modelSvc.resolveEpisodeEvents(t.appState.episodeId),t.modelSvc.resolveEpisodeAssets(t.appState.episodeId),t.playbackService.setMetaProp("duration",a),t.appState.editEpisode=!1,t.appState.videoControlsLocked=!1,t.timelineSvc.init(t.appState.episodeId),angular.forEach(s,function(e){e._id.indexOf("internal")<0&&t.dataSvc.storeItem(e)}),angular.forEach(o,function(e){e._id.indexOf("internal")<0&&t.dataSvc.deleteItem(e._id)}),t.$timeout(function(){window.location.reload()},500)}else t.modelSvc.resolveEpisodeEvents(t.appState.episodeId),t.modelSvc.resolveEpisodeAssets(t.appState.episodeId),t.appState.editEpisode=!1,t.appState.videoControlsLocked=!1}).catch(function(e){})},EpisodeEditService.Name="episodeEdit",EpisodeEditService.$inject=["$timeout","appState","selectService","modelSvc","dataSvc","episodeTheme","playbackService","timelineSvc"],EpisodeEditService}(),ai='\n{{$ctrl.copyrightOrg}} player &#169;\n<span ng-bind-html="$ctrl.now | date:\'yyyy\'"></span>\n<a\n  ng-href="//{{$ctrl.orgLinkUrl}}"\n  target="_blank"\n  rel="noopener noreferrer">{{$ctrl.orgLinkText}}</a>. All rights reserved.\n<br>\n<a href="/privacy.html" target="_blank">Privacy</a>\n<span ng-if="$ctrl.supportUrl"> -\n\t<a ng-href="{{$ctrl.supportUrl}}">Support</a>\n</span>\n',ri=function(){function CopyrightController(){this.now=new Date,this.itt={copyrightOrg:"TELLING STORY",orgLinkUrl:"inthetelling.com",orgLinkText:"IN THE TELLING"},this.np={copyrightOrg:"Narrative",orgLinkUrl:"narrasys.com",orgLinkText:"Narrasys"}}return Object.defineProperty(CopyrightController.prototype,"copyrightOrg",{get:function(){return this[this.org].copyrightOrg},enumerable:!0,configurable:!0}),Object.defineProperty(CopyrightController.prototype,"orgLinkUrl",{get:function(){return this[this.org].orgLinkUrl},enumerable:!0,configurable:!0}),Object.defineProperty(CopyrightController.prototype,"orgLinkText",{get:function(){return this[this.org].orgLinkText},enumerable:!0,configurable:!0}),CopyrightController}(),si=function(){function Copyright(){this.bindings={org:"@",supportUrl:"@"},this.template=ai,this.controller=ri}return Copyright.Name="npCopyright",Copyright}(),oi='\n<div ng-if="$ctrl.appState.viewMode != \'watch\'" ng-class="$ctrl.brandingDivClass">\n\n  <div ng-if="$ctrl.proTemplate" class="branding--content">\n    <np-copyright org="np" class="professional__copyright"></np-copyright>  \n    <div class="professional__logo"></div>\n  </div>\n  \n  <a\n    ng-if="!$ctrl.proTemplate"\n    ng-repeat="logoImg in $ctrl.logos"\n    ng-class="logoImg.css_class"\n    ng-href="{{logoImg.url}}"\n    target="_blank"\n    rel="noopener noreferrer">\n      <img ng-src="{{logoImg.src}}" alt="{{logoImg.alt_text}}"/>\n  </a>\n  <np-copyright ng-if="!$ctrl.proTemplate" class="copyright" org="np"></np-copyright>\n</div>\n\n<div ng-if="$ctrl.bannerLogo != null" ng-class="$ctrl.bannerLogo.css_class">\n  <img\n    ng-if="$ctrl.bannerLogo.src"\n    ng-src="{{$ctrl.bannerLogo.src}}"\n    alt="{{ctrl.bannerLogo.alt_text}}"/>\n</div>\n',li=function(){function EpisodeFooterController(e){this.appState=e}return Object.defineProperty(EpisodeFooterController.prototype,"proTemplate",{get:function(){if(this.templateData)return this.templateData.pro_episode_template},enumerable:!0,configurable:!0}),Object.defineProperty(EpisodeFooterController.prototype,"bannerLogo",{get:function(){if(this.templateData&&null!=this.templateData.css_configuration)return this.templateData.css_configuration.legacy_banner_logo},enumerable:!0,configurable:!0}),Object.defineProperty(EpisodeFooterController.prototype,"logos",{get:function(){if(this.templateData&&null!=this.templateData.css_configuration)return this.templateData.css_configuration.legacy_logos},enumerable:!0,configurable:!0}),EpisodeFooterController.prototype.$onChanges=function(e){e.templateData.isFirstChange()||(this.templateData.pro_episode_template?this.brandingDivClass="professional__branding":this.brandingDivClass="branding footer")},EpisodeFooterController.$inject=["appState"],EpisodeFooterController}(),ci=function(){function EpisodeFooter(){this.bindings={templateData:"<"},this.template=oi,this.controller=li}return EpisodeFooter.Name="npEpisodeFooter",EpisodeFooter}(),di=angular.module("np.episode",[]),ui=[ii,ni],pi=[si,ci];ui.forEach(function(e){di.service(e.Name,e)}),pi.forEach(function(e){di.component(e.Name,new e)}),di.directive("ittEpisode",ittEpisode).directive("ittEpisodeEditor",ittEpisodeEditor);var mi=i("oN2c"),vi=i.n(mi),gi=function(){function DiscovermodeTemplate(){this.restrict="EA",this.template=vi.a,this.scope=!0}return DiscovermodeTemplate.factory=function(){return function(){return new DiscovermodeTemplate}},DiscovermodeTemplate.Name="npDiscovermodeTemplate",DiscovermodeTemplate}(),hi=i("0BWP"),fi=i.n(hi),yi=function(){function ReviewmodeTemplate(){this.restrict="EA",this.template=fi.a,this.scope=!0}return ReviewmodeTemplate.factory=function(){return function(){return new ReviewmodeTemplate}},ReviewmodeTemplate.Name="npReviewmodeTemplate",ReviewmodeTemplate}(),_i=i("+tHN"),Si=i.n(_i),bi=function(){function VideoTemplate(){this.restrict="EA",this.template=Si.a,this.scope=!0}return VideoTemplate.factory=function(){return function(){return new VideoTemplate}},VideoTemplate.Name="npVideoTemplate",VideoTemplate}(),Ti=i("ETbY"),Ei=i.n(Ti),Ci=function(){function WatchmodeTemplate(){this.restrict="EA",this.template=Ei.a,this.scope=!0}return WatchmodeTemplate.factory=function(){return function(){return new WatchmodeTemplate}},WatchmodeTemplate.Name="npWatchmodeTemplate",WatchmodeTemplate}(),wi=i("lw8s"),ki=i.n(wi),Ii=function(){function WindowfgTemplate(){this.restrict="EA",this.template=ki.a,this.scope=!0}return WindowfgTemplate.factory=function(){return function(){return new WindowfgTemplate}},WindowfgTemplate.Name="npWindowfgTemplate",WindowfgTemplate}(),xi=angular.module("np.viewModes",[]);[gi,yi,bi,Ci,Ii].forEach(function(e){xi.directive(e.Name,e.factory())}),ittItem.$inject=["$http","$timeout","$interval","authSvc","appState","analyticsSvc","timelineSvc","modelSvc","selectService","playbackService","urlService","validationSvc"],ItemController.$inject=["$scope","timelineSvc"];var Pi=i("5EdM"),Ai=i.n(Pi);ittItemEditor.$inject=["$rootScope","errorSvc","appState","modelSvc","timelineSvc","selectService"];var $i=i("8WnQ"),Li=i.n($i);ittItemDetailModal.$inject=["appState"];var Ni=i("UGDl"),Mi=i.n(Ni);ittIframe.$inject=["appState"];var Ui=i("wJ/0"),Oi=i.n(Ui),Di=componentTemplateNameify(o.FILE_TEMPLATE),Fi=function(){function FileTemplate(){this.restrict="EA",this.template=Oi.a,this.scope=!0}return FileTemplate.factory=function(){return function(){return new FileTemplate}},FileTemplate.Name=Di,FileTemplate}(),Ri=i("kCnN"),Vi=i.n(Ri),Bi=componentTemplateNameify(o.HEADER_ONE_TEMPLATE),ji=function(){function HeaderOneTemplate(){this.restrict="EA",this.template=Vi.a,this.scope=!0}return HeaderOneTemplate.factory=function(){return function(){return new HeaderOneTemplate}},HeaderOneTemplate.Name=Bi,HeaderOneTemplate}(),Hi=i("Ambl"),qi=i.n(Hi),Wi=componentTemplateNameify(o.HEADER_TWO_TEMPLATE),Ki=function(){function HeaderTwoTemplate(){this.restrict="EA",this.template=qi.a,this.scope=!0}return HeaderTwoTemplate.factory=function(){return function(){return new HeaderTwoTemplate}},HeaderTwoTemplate.Name=Wi,HeaderTwoTemplate}(),zi=i("9DBX"),Gi=i.n(zi),Qi=componentTemplateNameify(o.IMAGE_THUMBNAIL_TEMPLATE),Yi=function(){function ImageThumbnailTemplate(){this.restrict="EA",this.template=Gi.a,this.scope=!0}return ImageThumbnailTemplate.factory=function(){return function(){return new ImageThumbnailTemplate}},ImageThumbnailTemplate.Name=Qi,ImageThumbnailTemplate}(),Xi=i("es1d"),Ji=i.n(Xi),Zi=componentTemplateNameify(o.SLIDING_CAPTION),en=function(){function ImageCaptionSlidingTemplate(){this.restrict="EA",this.template=Ji.a,this.scope=!0}return ImageCaptionSlidingTemplate.factory=function(){return function(){return new ImageCaptionSlidingTemplate}},ImageCaptionSlidingTemplate.Name=Zi,ImageCaptionSlidingTemplate}(),tn=i("+Pmc"),nn=i.n(tn),an=componentTemplateNameify(o.IMAGE_FILL_TEMPLATE),rn=function(){function ImageFillTemplate(){this.restrict="EA",this.template=nn.a,this.scope=!0}return ImageFillTemplate.factory=function(){return function(){return new ImageFillTemplate}},ImageFillTemplate.Name=an,ImageFillTemplate}(),sn=i("qBCb"),on=i.n(sn),ln=componentTemplateNameify(o.IMAGE_INLINE_WITHTEXT_TEMPLATE),cn=function(){function ImageInlineWithtextTemplate(){this.restrict="EA",this.template=on.a,this.scope=!0}return ImageInlineWithtextTemplate.factory=function(){return function(){return new ImageInlineWithtextTemplate}},ImageInlineWithtextTemplate.Name=ln,ImageInlineWithtextTemplate}(),dn=i("NEUm"),un=i.n(dn),pn=componentTemplateNameify(o.IMAGE_PLAIN_TEMPLATE),mn=function(){function ImagePlainTemplate(){this.restrict="EA",this.template=un.a,this.scope=!0}return ImagePlainTemplate.factory=function(){return function(){return new ImagePlainTemplate}},ImagePlainTemplate.Name=pn,ImagePlainTemplate}(),vn=i("LrgT"),gn=i.n(vn),hn=componentTemplateNameify(o.LINK_TEMPLATE),fn=function(){function LinkTemplate(){this.restrict="EA",this.template=gn.a,this.scope=!0}return LinkTemplate.factory=function(){return function(){return new LinkTemplate}},LinkTemplate.Name=hn,LinkTemplate}(),yn=i("AEnZ"),_n=i.n(yn),Sn=componentTemplateNameify(o.LINK_DESCRIPTION_FIRST_TEMPLATE),bn=function(){function LinkDescriptionfirstTemplate(){this.restrict="EA",this.template=_n.a,this.scope=!0}return LinkDescriptionfirstTemplate.factory=function(){return function(){return new LinkDescriptionfirstTemplate}},LinkDescriptionfirstTemplate.Name=Sn,LinkDescriptionfirstTemplate}(),Tn=i("mOi1"),En=i.n(Tn),Cn=componentTemplateNameify(o.LINK_EMBED_TEMPLATE),wn=function(){function LinkEmbedTemplate(){this.restrict="EA",this.template=En.a,this.scope=!0}return LinkEmbedTemplate.factory=function(){return function(){return new LinkEmbedTemplate}},LinkEmbedTemplate.Name=Cn,LinkEmbedTemplate}(),kn=i("k90U"),In=i.n(kn),xn=componentTemplateNameify(o.LINK_MODAL_THUMB_TEMPLATE),Pn=function(){function LinkModalThumbTemplate(){this.restrict="EA",this.template=In.a,this.scope=!0}return LinkModalThumbTemplate.factory=function(){return function(){return new LinkModalThumbTemplate}},LinkModalThumbTemplate.Name=xn,LinkModalThumbTemplate}(),An=i("kr2K"),$n=i.n(An),Ln=componentTemplateNameify(o.LINK_WITHIMAGE_NOTITLE_TEMPLATE),Nn=function(){function LinkWithimageNotitleTemplate(){this.restrict="EA",this.template=$n.a,this.scope=!0}return LinkWithimageNotitleTemplate.factory=function(){return function(){return new LinkWithimageNotitleTemplate}},LinkWithimageNotitleTemplate.Name=Ln,LinkWithimageNotitleTemplate}(),Mn=i("3/az"),Un=i.n(Mn),On=componentTemplateNameify(o.PULLQUOTE_TEMPLATE),Dn=function(){function PullquoteTemplate(){this.restrict="EA",this.template=Un.a,this.scope=!0}return PullquoteTemplate.factory=function(){return function(){return new PullquoteTemplate}},PullquoteTemplate.Name=On,PullquoteTemplate}(),Fn=i("VCZZ"),Rn=i.n(Fn),Vn=componentTemplateNameify(o.QUESTION_TEMPLATE),Bn=function(){function QuestionMcTemplate(){this.restrict="EA",this.template=Rn.a,this.scope=!0}return QuestionMcTemplate.factory=function(){return function(){return new QuestionMcTemplate}},QuestionMcTemplate.Name=Vn,QuestionMcTemplate}(),jn=i("jiyv"),Hn=i.n(jn),qn=componentTemplateNameify(o.SXS_ANNOTAITON_TEMPLATE),Wn=function(){function SxsAnnotationTemplate(){this.restrict="EA",this.template=Hn.a,this.scope=!0}return SxsAnnotationTemplate.factory=function(){return function(){return new SxsAnnotationTemplate}},SxsAnnotationTemplate.Name=qn,SxsAnnotationTemplate}(),Kn=i("L+g8"),zn=i.n(Kn),Gn=componentTemplateNameify(o.SXS_FILE_TEMPLATE),Qn=function(){function SxsFileTemplate(){this.restrict="EA",this.template=zn.a,this.scope=!0}return SxsFileTemplate.factory=function(){return function(){return new SxsFileTemplate}},SxsFileTemplate.Name=Gn,SxsFileTemplate}(),Yn=i("rw5t"),Xn=i.n(Yn),Jn=componentTemplateNameify(o.SXS_IMAGE_TEMPLATE),Zn=function(){function SxsImageTemplate(){this.restrict="EA",this.template=Xn.a,this.scope=!0}return SxsImageTemplate.factory=function(){return function(){return new SxsImageTemplate}},SxsImageTemplate.Name=Jn,SxsImageTemplate}(),ea=i("g3Y4"),ta=i.n(ea),ia=componentTemplateNameify(o.SXS_LINK_TEMPLATE),na=function(){function SxsLinkTemplate(){this.restrict="EA",this.template=ta.a,this.scope=!0}return SxsLinkTemplate.factory=function(){return function(){return new SxsLinkTemplate}},SxsLinkTemplate.Name=ia,SxsLinkTemplate}(),aa=i("GAbr"),ra=i.n(aa),sa=componentTemplateNameify(o.SXS_QUESTION_TEMPLATE),oa=function(){function SxsQuestionTemplate(){this.restrict="EA",this.template=ra.a,this.scope=!0}return SxsQuestionTemplate.factory=function(){return function(){return new SxsQuestionTemplate}},SxsQuestionTemplate.Name=sa,SxsQuestionTemplate}(),la=i("k5l5"),ca=i.n(la),da=componentTemplateNameify(o.SXS_VIDEO_TEMPLATE),ua=function(){function SxsVideoTemplate(){this.restrict="EA",this.template=ca.a,this.scope=!0}return SxsVideoTemplate.factory=function(){return function(){return new SxsVideoTemplate}},SxsVideoTemplate.Name=da,SxsVideoTemplate}(),pa=i("zSN1"),ma=i.n(pa),va=componentTemplateNameify(o.TEXT_DEFINITION_TEMPLATE),ga=function(){function TextDefinitionTemplate(){this.restrict="EA",this.template=ma.a,this.scope=!0}return TextDefinitionTemplate.factory=function(){return function(){return new TextDefinitionTemplate}},TextDefinitionTemplate.Name=va,TextDefinitionTemplate}(),ha=i("00PB"),fa=i.n(ha),ya=componentTemplateNameify(o.TEXT_TRANSMEDIA_TEMPLATE),_a=function(){function TextTransmediaTemplate(){this.restrict="EA",this.template=fa.a,this.scope=!0}return TextTransmediaTemplate.factory=function(){return function(){return new TextTransmediaTemplate}},TextTransmediaTemplate.Name=ya,TextTransmediaTemplate}(),Sa=i("eHBc"),ba=i.n(Sa),Ta=componentTemplateNameify(o.TRANSCRIPT_TEMPLATE),Ea=function(){function TranscriptTemplate(){this.restrict="EA",this.template=ba.a,this.scope=!0}return TranscriptTemplate.factory=function(){return function(){return new TranscriptTemplate}},TranscriptTemplate.Name=Ta,TranscriptTemplate}(),Ca=i("OklN"),wa=i.n(Ca),ka=function(){function SearchresultsAllTemplate(){this.restrict="EA",this.template=wa.a,this.scope=!0}return SearchresultsAllTemplate.factory=function(){return function(){return new SearchresultsAllTemplate}},SearchresultsAllTemplate.Name="npSearchresultsAllTemplate",SearchresultsAllTemplate}(),Ia=i("d3rl"),xa=i.n(Ia),Pa=componentTemplateNameify(o.USC_BADGES_TEMPLATE),Aa=function(){function UscBadgesTemplate(){this.restrict="EA",this.template=xa.a,this.scope=!0}return UscBadgesTemplate.factory=function(){return function(){return new UscBadgesTemplate}},UscBadgesTemplate.Name=Pa,UscBadgesTemplate}(),$a=angular.module("np.item",[]),La=[Fi,ji,Ki,en,rn,cn,mn,Yi,fn,bn,wn,Pn,Nn,Dn,Bn,Wn,Qn,Zn,na,oa,ua,ga,_a,Ea,ka,Aa];$a.directive("ittItem",ittItem).controller("ItemController",ItemController).directive("ittItemEditor",ittItemEditor).directive("ittItemDetailModal",ittItemDetailModal).directive("ittIframe",ittIframe),La.forEach(function(e){$a.directive(e.Name,e.factory())});autofocus.$inject=["$timeout"],ittDynamicModel.$inject=["$compile","$parse"];var Na='\n<div class="field">\n  <div class="label">Flags</div>\n  <div class="input">\n    <span ng-repeat="flag in $ctrl._flags">\n      <span ng-if="flag !== \'invertColor\'">\n        <label for="{{$ctrl._ids[flag]}}"></label>\n        <input id="{{$ctrl._ids[flag]}}"\n          type="checkbox"\n          itt-dynamic-model="\'$ctrl.data.\' + flag"\n          ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}}\n      </span>\n      <span ng-if="flag === \'invertColor\'">\n        <label for="{{$ctrl._ids[flag]}}"></label>\n        <input id="{{$ctrl._ids[flag]}}"\n          type="checkbox"\n          ng-model="$ctrl.itemForm.color"\n          ng-true-value="\'Invert\'"\n          ng-false-value="\'\'"\n          ng-change="$ctrl.handleChange()"/>{{$ctrl._displays[flag]}}\n      </span>\n    </span>\n  </div>\n</div>\n',Ma=function(){function FlagsController(e,t){this.$timeout=e,this.selectService=t,this._displays={required:"Required",stop:"Stop item",cosmetic:"Cosmetic",chapter_marker:"Chapter Event",invertColor:"Invert Color"},this._ids={required:"itemRequired",stop:"itemStop",cosmetic:"itemCosmetic",chapter_marker:"itemChapter",invertColor:"Invert"}}return FlagsController.prototype.$onInit=function(){this._flags=angular.copy(this.flags)},FlagsController.prototype.$onChanges=function(e){var t=this;if(e.componentName){var i=e.componentName,n=i.previousValue,a=i.currentValue;this.$timeout(function(){return t.setFlags(a,n)})}},FlagsController.prototype.handleChange=function(){this.data.hasOwnProperty("stop")&&this.selectService.onSelectChange(this.data,this.itemForm)},FlagsController.prototype.setFlags=function(e,t){e!==t&&typeof e==typeof t&&(this.itemForm.color=""),e&&(e===o.IMAGE_FILL_TEMPLATE?this._flags=this._flags.filter(function(e){return"stop"!==e}):this._flags=this.flags,FlagsController._h1OrH2(e)?(this._flags=this.flags,this._isEditingItemForm()&&(this.itemForm.color="Invert")):(this._isEditingItemForm()&&(this.itemForm.color=""),this._flags=this._flags.filter(function(e){return"chapter_marker"!==e})))},FlagsController._h1OrH2=function(e){return e===o.HEADER_TWO_TEMPLATE||e===o.HEADER_ONE_TEMPLATE},FlagsController.prototype._isEditingItemForm=function(){return existy(this.itemForm)&&"internal:editing"===this.data._id},FlagsController.$inject=["$timeout","selectService"],FlagsController}(),Ua=function(){function Flags(){this.bindings={flags:"=",data:"=",componentName:"@",itemForm:"=?"},this.template=Na,this.controller=Ma}return Flags.Name="npFlags",Flags}();ittShowFocus.$inject=["$timeout"];var Oa='\n<div class="field" ng-if="$ctrl.isVisible">\n\t<div class="label">{{$ctrl.labelText}}</div>\n\t<div class="input" ng-class="{layouts: $ctrl.labelText === \'Template\' && $ctrl.data.producerItemType === \'scene\'}">\n\t\t<select\n\t\t  ng-if="$ctrl.context === \'event\'"\n\t\t  ng-model="$ctrl.data.template_id"\n\t\t  ng-change="$ctrl.onSelectChange($ctrl.data, $ctrl.itemForm)"\n\t\t  ng-options="option.template_id as option.name disable when option.isDisabled for option in $ctrl.data.templateOpts">\n    </select>\n    \n    <select\n      ng-if="$ctrl.context === \'episode\'"\n\t\t  ng-model="$ctrl.data.template_id"\n\t\t  ng-change="$ctrl.onEpisodeTemplateChange()"\n\t\t  ng-options="option.id as option.name for option in $ctrl.data.templateOpts">\n    </select>\n\t</div>\n</div>',Da=function(){function TemplateSelectController(e,t){this.selectService=e,this.modelSvc=t,this.labelText="Template",this.context="event"}return TemplateSelectController.prototype.$onInit=function(){if(this.isAnnotation=this.data instanceof R,this.isEpisode=this.data instanceof P,this.data instanceof P&&(this.context="episode"),this.isAnnotation){var e=this.selectService.getSceneName(this.modelSvc.scene(this.data.scene_id)),t="centerVV"===e,i="centerVVMondrian"===e;(t||i)&&this.data.templateOpts.forEach(function(e){"Header 1"===e.name&&(e.isDisabled=!0)})}this.data.hasOwnProperty("producerItemType")||(this.data.producerItemType="episode",this.labelText="Theme")},Object.defineProperty(TemplateSelectController.prototype,"isVisible",{get:function(){return this.selectService.getVisibility("templateSelect")},enumerable:!0,configurable:!0}),TemplateSelectController.prototype.onSelectChange=function(e,t){this.selectService.onSelectChange(this.modelSvc.deriveEvent(e),t)},TemplateSelectController.prototype.onEpisodeTemplateChange=function(){var e={$data:{episode:this.data,templateId:this.data.template_id}};this.onEpisodeEdit(e)},TemplateSelectController.$inject=["selectService","modelSvc"],TemplateSelectController}(),Fa=function(){function TemplateSelect(){this.bindings={data:"=",itemForm:"=?",onEpisodeEdit:"&"},this.template=Oa,this.controller=Da}return TemplateSelect.Name="npTemplateSelect",TemplateSelect}();ittValidAsset.$inject=["ittUtils"],ittValidEpisodeUrl.$inject=["urlService","ittUtils","authSvc"],ittValidPathslug.$inject=["modelSvc","ittUtils"],ittValidUrl.$inject=["ittUtils"];var Ra='\n<div class="field" ng-if="$ctrl.selectService.getVisibility(\'videoPosition\')">\n  <div class="label">Video Postion</div>\n  <div class="input">\n    <select\n      ng-model="$ctrl.data.layouts[0]"\n      ng-options="option.value as option.name for option in $ctrl.selectService.getSelectOpts(\'video\')">\n    </select>\n  </div>\n</div>\n',Va=function(){function VideoPositionSelectController(e,t,i){this.$rootScope=e,this.$timeout=t,this.selectService=i}return VideoPositionSelectController.$inject=["$rootScope","$timeout","selectService"],VideoPositionSelectController}(),Ba=function(){function VideoPositionSelect(){this.bindings={data:"="},this.template=Ra,this.controller=Va}return VideoPositionSelect.Name="ittVideoPositionSelect",VideoPositionSelect}(),ja=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function fulfilled(e){try{step(n.next(e))}catch(e){r(e)}}function rejected(e){try{step(n.throw(e))}catch(e){r(e)}}function step(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})},Ha=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(a=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){s.label=r[1];break}if(6===r[0]&&s.label<a[1]){s.label=a[1],a=r;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(r);break}a[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,n,a,r,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},qa='\n<div class="field">\n  <div class="label">{{$ctrl.label || "URL"}}\n    <span ng-repeat="(field, val) in $ctrl.validatedFields">\n      <itt-validation-tip ng-if="val.showInfo" text="{{val.message}}" do-info="val.doInfo"></itt-validation-tip>\n     </span>\n  </div>\n  <div class="input" ng-if="$ctrl.context !== \'episode\'">\n    <div  class="ittUrl__escapeLink">\n      <input\n        id="urlEscapeLink"\n        type="checkbox"\n        ng-change="$ctrl.updateTemplateOpts()"\n        ng-true-value="\'_blank\'"\n        ng-false-value="\'_self\'"\n        ng-disabled="!$ctrl.canEmbed"\n        ng-model="$ctrl.data.target"/>\n      <span class="escapelink"></span>\n      <label for="urlEscapeLink">Force new tab</label>\n\n    </div>\n    <input\n      type="text"\n      name="itemUrl"\n      ng-blur="$ctrl.onUrlFieldChange($ctrl.eventUrl)"\n      ng-focus="$ctrl.onFocused()"\n      ng-model="$ctrl.eventUrl"/>\n  </div>\n  <div class="input" ng-if="$ctrl.context === \'episode\'">\n    <input\n      type="text"\n      ng-model="$ctrl.data"\n      itt-valid-episode-url\n      on-validation-notice="$ctrl.handleEpisodeValidationMessage($notice)"/>\n    <button ng-if="$ctrl.data" ng-click="$ctrl.onAttach({$url: $ctrl.data})">Attach Video</button>\n  </div>\n</div>\n',Wa=function(){function UrlFieldController(e){this.validationSvc=e,this.context="producer",this.validatedFields={url:null,iframeHeaders:null,404:null,301:null,mixedContent:null},this.message={showInfo:!1,message:"",doInfo:!1}}return UrlFieldController.prototype.$onInit=function(){this.eventUrl=this.data.url,"episode"!==this.context&&this.onUrlFieldChange(this.eventUrl,this.data.url_status)},UrlFieldController.prototype.updateTemplateOpts=function(){this.data.templateOpts=this._disableTemplateOpts("_blank"===this.data.target)},UrlFieldController.prototype.onFocused=function(){this._setValidity(!1)},UrlFieldController.prototype.onUrlFieldChange=function(e,t){if("https://"===e)return void this._setValidity(!1);this._itemUrlValidationPipeline(e,t,this.context)},UrlFieldController.prototype.handleEpisodeValidationMessage=function(e){this.validatedFields={kaltura:null,youtube:null,html5:null,error:null},Object.assign(this.validatedFields,e)},UrlFieldController.prototype._inspectHeaders=function(e,t,i){return ja(this,void 0,void 0,function(){var n,a,r,s,o,l;return Ha(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.validationSvc.inspectHeadersAsync(e,this,t,i)];case 1:return n=c.sent(),a=n.canEmbed,r=n.location,s=n.urlStatus,this._setValidity(!0),o=this.validationSvc.mixedContent(r||e,this),this.canEmbed=a&&!o,this.canEmbed||(this.data.target="_blank"),this.data.templateOpts=this._disableTemplateOpts(this.canEmbed),this.data.url_status=Object.assign(new D,s),this.data.url=r||e,this.eventUrl=this.data.url,[3,3];case 2:return l=c.sent(),this._setValidity(!1),[3,3];case 3:return[2]}})})},UrlFieldController.prototype._itemUrlValidationPipeline=function(e,t,i){this._resetFields(),this._setValidity(this.validationSvc.validateUrl(e,this))&&this._inspectHeaders(e,t,i)},UrlFieldController.prototype._disableTemplateOpts=function(e){if(!0===e&&(this.data.showInlineDetail=!1),"editor"!==this.context&&"editor-video"!==this.context)return this.data.templateOpts.map(function(t){return t.component_name!==o.LINK_EMBED_TEMPLATE&&t.component_name!==o.LINK_MODAL_THUMB_TEMPLATE||(t.isDisabled=e),t})},UrlFieldController.prototype._setValidity=function(e,t){return void 0===t&&(t="itemUrl"),null!=this.ittItemForm&&this.ittItemForm.$setValidity(t,e,null),e},UrlFieldController.prototype._resetFields=function(){var e=this;Object.keys(this.validatedFields).forEach(function(t){return e.validatedFields[t]=e.message})},UrlFieldController.$inject=["validationSvc"],UrlFieldController}(),Ka=function(){function UrlField(){this.bindings={data:"=",context:"@?",label:"@",onAttach:"&",ittItemForm:"<?"},this.template=qa,this.controller=Wa}return UrlField.Name="npUrlField",UrlField}(),za=i("45E6"),Ga=i.n(za);sxsAddContent.$inject=["appState","playbackService"];var Qa=i("Ip2Z"),Ya=i.n(Qa);sxsAnnotatorAutocomplete.$inject=["$timeout","modelSvc","appState"];var Xa=i("ibgO"),Ja=i.n(Xa),Za=function(){function SxsAnnotationFieldTemplate(){this.restrict="EA",this.template=Ja.a,this.scope=!0}return SxsAnnotationFieldTemplate.factory=function(){return function(){return new SxsAnnotationFieldTemplate}},SxsAnnotationFieldTemplate.Name="npSxsAnnotationFieldTemplate",SxsAnnotationFieldTemplate}(),er=i("kLTS"),tr=i.n(er),ir=function(){function SxsFileFieldTemplate(){this.restrict="EA",this.template=tr.a,this.scope=!0}return SxsFileFieldTemplate.factory=function(){return function(){return new SxsFileFieldTemplate}},SxsFileFieldTemplate.Name="npSxsFileFieldTemplate",SxsFileFieldTemplate}(),nr=i("EKl2"),ar=i.n(nr),rr=function(){function SxsImageFieldTemplate(){this.restrict="EA",this.template=ar.a,this.scope=!0}return SxsImageFieldTemplate.factory=function(){return function(){return new SxsImageFieldTemplate}},SxsImageFieldTemplate.Name="npSxsImageFieldTemplate",SxsImageFieldTemplate}(),sr=i("sLHl"),or=i.n(sr),lr=function(){function SxsLinkFieldTemplate(){this.restrict="EA",this.template=or.a,this.scope=!0}return SxsLinkFieldTemplate.factory=function(){return function(){return new SxsLinkFieldTemplate}},SxsLinkFieldTemplate.Name="npSxsLinkFieldTemplate",SxsLinkFieldTemplate}(),cr=i("ORN5"),dr=i.n(cr),ur=function(){function SxsQuestionFieldTemplate(){this.restrict="EA",this.template=dr.a,this.scope=!0}return SxsQuestionFieldTemplate.factory=function(){return function(){return new SxsQuestionFieldTemplate}},SxsQuestionFieldTemplate.Name="npSxsQuestionFieldTemplate",SxsQuestionFieldTemplate}(),pr=i("c1a4"),mr=i.n(pr),vr=function(){function SxsVideoFieldTemplate(){this.restrict="EA",this.template=mr.a,this.scope=!0}return SxsVideoFieldTemplate.factory=function(){return function(){return new SxsVideoFieldTemplate}},SxsVideoFieldTemplate.Name="npSxsVideoFieldTemplate",SxsVideoFieldTemplate}(),gr=i("3u31"),hr=i.n(gr);sxsInputI18n.$inject=["$timeout","appState","textAngularManager"];var fr=i("Wu6Y"),yr=i.n(fr);sxsInputTime.$inject=["$rootScope","$timeout","appState","modelSvc","timelineSvc","playbackService","ittUtils"];var _r=i("pkcl"),Sr=i.n(_r),br=function(){function UploadMasterassetTemplate(){this.restrict="EA",this.template=Sr.a,this.scope=!0}return UploadMasterassetTemplate.factory=function(){return function(){return new UploadMasterassetTemplate}},UploadMasterassetTemplate.Name="npUploadMasterassetTemplate",UploadMasterassetTemplate}(),Tr=i("9Hwp"),Er=i.n(Tr),Cr=function(){function UploadPosterTemplate(){this.restrict="EA",this.template=Er.a,this.scope=!0}return UploadPosterTemplate.factory=function(){return function(){return new UploadPosterTemplate}},UploadPosterTemplate.Name="npUploadPosterTemplate",UploadPosterTemplate}(),wr=i("aqvw"),kr=i.n(wr),Ir=function(){function UploadProducerTemplate(){this.restrict="EA",this.template=kr.a,this.scope=!0}return UploadProducerTemplate.factory=function(){return function(){return new UploadProducerTemplate}},UploadProducerTemplate.Name="npUploadProducerTemplate",UploadProducerTemplate}(),xr=i("foaR"),Pr=i.n(xr),Ar=function(){function UploadSxsTemplate(){this.restrict="EA",this.template=Pr.a,this.scope=!0}return UploadSxsTemplate.factory=function(){return function(){return new UploadSxsTemplate}},UploadSxsTemplate.Name="npUploadSxsTemplate",UploadSxsTemplate}(),$r=angular.module("np.inputFields",[]);[Za,ir,rr,lr,ur,vr,br,Cr,Ir,Ar].forEach(function(e){$r.directive(e.Name,e.factory())}),$r.directive("autofocus",autofocus).directive("ittAnnotationField",ittAnnotationField).directive("ittColorSelect",ittColorSelect).directive("ittDescriptionField",ittDescriptionField).directive("ittDisplaySelect",ittDisplaySelect).directive("ittDynamicModel",ittDynamicModel).directive("ittFileField",ittFileField).component(Ua.Name,new Ua).directive("ittHighlightSelect",ittHighlightSelect).directive("ittImageField",ittImageField).directive("ittLanguageFlags",ittLanguageFlags).directive("ittLanguageSelect",ittLanguageSelect).directive("ittShowFocus",ittShowFocus).directive("ittSpeakerField",ittSpeakerField).directive("ittSpeakerThumbField",ittSpeakerThumbField).component(Fa.Name,new Fa).directive("ittTimeField",ittTimeField).directive("ittTimestampSelect",ittTimestampSelect).directive("ittTitleField",ittTitleField).directive("ittTranscriptField",ittTranscriptField).directive("ittTransitionSelect",ittTransitionSelect).directive("ittTypographySelect",ittTypographySelect).component(v.Name,new v).directive("ittValidAsset",ittValidAsset).directive("ittValidEpisodeUrl",ittValidEpisodeUrl).directive("ittValidPathslug",ittValidPathslug).directive("ittValidUrl",ittValidUrl).directive("sxsInputI18n",sxsInputI18n).directive("sxsInputTime",sxsInputTime).directive("sxsAddContent",sxsAddContent).directive("sxsAnnotatorAutocomplete",sxsAnnotatorAutocomplete).component(Ba.Name,new Ba).component(Ka.Name,new Ka);ittScene.$inject=["$timeout","appState"],SceneController.$inject=["$scope","$filter","ittUtils"];var Lr=i("KCjZ"),Nr=i.n(Lr),Mr=componentTemplateNameify(o.CENTER_VV_TEMPLATE),Ur=function(){function CenterVvTemplate(){this.restrict="EA",this.template=Nr.a,this.scope=!0}return CenterVvTemplate.factory=function(){return function(){return new CenterVvTemplate}},CenterVvTemplate.Name=Mr,CenterVvTemplate}(),Or=i("KIuG"),Dr=i.n(Or),Fr=componentTemplateNameify(o.CENTER_VV_MONDRIAN_TEMPLATE),Rr=function(){function CenterVvMondrianTemplate(){this.restrict="EA",this.template=Dr.a,this.scope=!0}return CenterVvMondrianTemplate.factory=function(){return function(){return new CenterVvMondrianTemplate}},CenterVvMondrianTemplate.Name=Fr,CenterVvMondrianTemplate}(),Vr=i("Twex"),Br=i.n(Vr),jr=componentTemplateNameify(o.CENTERED_TEMPLATE),Hr=function(){function CenteredTemplate(){this.restrict="EA",this.template=Br.a,this.scope=!0}return CenteredTemplate.factory=function(){return function(){return new CenteredTemplate}},CenteredTemplate.Name=jr,CenteredTemplate}(),qr=i("k/N7"),Wr=i.n(qr),Kr=componentTemplateNameify(o.CENTERED_PRO_TEMPLATE),zr=function(){function CenteredProTemplate(){this.restrict="EA",this.template=Wr.a,this.scope=!0}return CenteredProTemplate.factory=function(){return function(){return new CenteredProTemplate}},CenteredProTemplate.Name=Kr,CenteredProTemplate}(),Gr=i("sbOf"),Qr=i.n(Gr),Yr=componentTemplateNameify(o.CORNER_H_TEMPLATE),Xr=function(){function CornerHTemplate(){this.restrict="EA",this.template=Qr.a,this.scope=!0}return CornerHTemplate.factory=function(){return function(){return new CornerHTemplate}},CornerHTemplate.Name=Yr,CornerHTemplate}(),Jr=i("Tc0T"),Zr=i.n(Jr),es=componentTemplateNameify(o.CORNER_V_TEMPLATE),ts=function(){function CornerVTemplate(){this.restrict="EA",this.template=Zr.a,this.scope=!0}return CornerVTemplate.factory=function(){return function(){return new CornerVTemplate}},CornerVTemplate.Name=es,CornerVTemplate}(),is=i("lvPu"),ns=i.n(is),as=componentTemplateNameify(o.ENDINGSCREEN_TEMPLATE),rs=function(){function EndingscreenTemplate(){this.restrict="EA",this.template=ns.a,this.scope=!0}return EndingscreenTemplate.factory=function(){return function(){return new EndingscreenTemplate}},EndingscreenTemplate.Name=as,EndingscreenTemplate}(),ss=i("/w+Y"),os=i.n(ss),ls=componentTemplateNameify(o.LANDINGSCREEN_TEMPLATE),cs=function(){function LandingscreenTemplate(){this.restrict="EA",this.template=os.a,this.scope=!0}return LandingscreenTemplate.factory=function(){return function(){return new LandingscreenTemplate}},LandingscreenTemplate.Name=ls,LandingscreenTemplate}(),ds=i("bINW"),us=i.n(ds),ps=componentTemplateNameify(o.MIRRORED_TWOCOL_TEMPLATE),ms=function(){function MirroredTwocolTemplate(){this.restrict="EA",this.template=us.a,this.scope=!0}return MirroredTwocolTemplate.factory=function(){return function(){return new MirroredTwocolTemplate}},MirroredTwocolTemplate.Name=ps,MirroredTwocolTemplate}(),vs=i("6mC1"),gs=i.n(vs),hs=componentTemplateNameify(o.ONECOL_TEMPLATE),fs=function(){function OnecolTemplate(){this.restrict="EA",this.template=gs.a,this.scope=!0}return OnecolTemplate.factory=function(){return function(){return new OnecolTemplate}},OnecolTemplate.Name=hs,OnecolTemplate}(),ys=i("I/G4"),_s=i.n(ys),Ss=componentTemplateNameify(o.PIP_TEMPLATE),bs=function(){function PipTemplate(){this.restrict="EA",this.template=_s.a,this.scope=!0}return PipTemplate.factory=function(){return function(){return new PipTemplate}},PipTemplate.Name=Ss,PipTemplate}(),Ts=angular.module("np.scenes",[]),Es=[Ur,Rr,Hr,zr,Xr,ts,rs,cs,ms,fs,bs];Ts.directive("ittScene",ittScene).controller("SceneController",SceneController),Es.forEach(function(e){Ts.directive(e.Name,e.factory())});timelineSvc_timelineSvc.$inject=["$window","$timeout","$interval","$filter","modelSvc","appState","analyticsSvc","playbackService","ittUtils"];var Cs=i("j8FC"),ws=i.n(Cs);ittTimeline.$inject=["$timeout","appState","timelineSvc","modelSvc","playbackService"],TimelineController.$inject=["$scope","$rootScope","timelineSvc","playbackService","analyticsSvc","appState","modelSvc"];var ks=angular.module("np.timeline",[]);ks.factory("timelineSvc",timelineSvc_timelineSvc).directive("ittTimeline",ittTimeline).controller("TimelineController",TimelineController);var Is=i("CKMt"),xs=i.n(Is);playbackService_playbackService.$inject=["$interval","youTubePlayerManager","html5PlayerManager","kalturaPlayerManager","wistiaPlayerManager","ittUtils","urlService","PLAYERSTATES_WORD","PLAYERSTATES"];var Ps={mainPlayer:!1,playerState:"-1",div:"",ready:!1,startAtTime:0,hasResumedFromStartAt:!1,duration:0,time:0,hasBeenPlayed:!1,bufferedPercent:0,timeMultiplier:1,resetInProgress:!1,autoplay:!1,volume:100,muted:!1};playerManagerCommons.$inject=["ittUtils"],urlService_urlService.$inject=["youtubeUrlService","html5UrlService","kalturaUrlService","wistiaUrlService"],html5PlayerManager.$inject=["$interval","PLAYERSTATES","ittUtils","appState","playerManagerCommons"],html5UrlService_html5UrlService.$inject=["ittUtils"];var As=angular.module("np.html5",[]);As.factory("html5UrlService",html5UrlService_html5UrlService).factory("html5PlayerManager",html5PlayerManager);youTubePlayerManager.$inject=["$location","ittUtils","YTScriptLoader","errorSvc","PLAYERSTATES","youtubeUrlService","playerManagerCommons"],YTScriptLoader.$inject=["$q","$timeout"],youtubeUrlService_youtubeUrlService.$inject=["ittUtils"];angular.module("np.youtube",[]).factory("youTubePlayerManager",youTubePlayerManager).factory("YTScriptLoader",YTScriptLoader).factory("youtubeUrlService",youtubeUrlService_youtubeUrlService);kalturaPlayerManager.$inject=["ittUtils","PLAYERSTATES","playerManagerCommons","kalturaScriptLoader","kalturaUrlService"],kalturaScriptLoader.$inject=["$q","ittUtils"],kalturaUrlService_kalturaUrlService.$inject=[];var $s=angular.module("np.kaltura",[]);$s.factory("kalturaPlayerManager",kalturaPlayerManager).factory("kalturaScriptLoader",kalturaScriptLoader).factory("kalturaUrlService",kalturaUrlService_kalturaUrlService);var Ls=function(){function BasePlayerManager(){this.players={},this.statechangeCallbacks=[]}return BasePlayerManager.createMetaObj=function(e){var t={instance:null,meta:Object.assign({},Ps)};return Object.assign(Ps,e),Object.assign(t.meta,Ps),t},BasePlayerManager.prototype.getPlayer=function(e){if(existy(this.players[e]))return this.players[e]},BasePlayerManager.prototype.setInstance=function(e,t){var i=this.getPlayer(e);existy(i)&&(i.instance=t)},BasePlayerManager.prototype.setPlayer=function(e,t){this.players[e]=t},BasePlayerManager.prototype.getMetaProp=function(e,t){var i=this.getPlayer(e);if(existy(i)&&existy(i.meta))return i.meta[t]},BasePlayerManager.prototype.setMetaProp=function(e,t,i){if(existy(this.players[e])&&this.players[e].meta)try{this.players[e].meta[t]=i}catch(e){}},BasePlayerManager.prototype.getPlayerDiv=function(e){return this.getMetaProp(e,"div")},BasePlayerManager.prototype.getPlayerState=function(e){return""},BasePlayerManager.prototype.pause=function(e){},BasePlayerManager.prototype.stop=function(e){},BasePlayerManager.prototype.freezeMetaProps=function(e){},BasePlayerManager.prototype.unFreezeMetaProps=function(e){},BasePlayerManager.prototype.pauseOtherPlayers=function(e){var t=this;Object.keys(this.players).forEach(function(i){if(i!==e){var n=t.getPlayerState(i);existy(n)&&"playing"===n&&t.pause(i)}})},BasePlayerManager.prototype.registerStateChangeListener=function(e){this.statechangeCallbacks.find(function(t){return e.toString()===t.toString()})||this.statechangeCallbacks.push(e)},BasePlayerManager.prototype.unregisterStateChangeListener=function(e){this.statechangeCallbacks=this.statechangeCallbacks.filter(function(t){return t.toString!==e.toString()})},BasePlayerManager.prototype.renamePid=function(e,t){renameKey(e,t,this.players)},BasePlayerManager.prototype.handleTimelineEnd=function(e){},BasePlayerManager.prototype.resetPlayerManager=function(){var e=this;Object.keys(this.players).forEach(function(t){e.destroyInstance(t,!0)}),this.players={}},BasePlayerManager.prototype.destroyInstance=function(e,t){existy(t)||(t=!1),this.destroySideEffects(e),!0===t&&this.setPlayer(e,{})},BasePlayerManager.prototype.destroySideEffects=function(e){},BasePlayerManager}(),Ns={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued",4:"quality changed",6:"player ready"},Ms=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function __(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)}}(),Us=this&&this.__assign||Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Os={playing:"playing",paused:"paused",beforeplay:"unstarted",ended:"ended"},Ds={videoType:"wistia",lastVol:100,bufferingInterval:null,lastVideoTime:0},Fs=function(e){function WistiaPlayerManager(t,i,n){var a=e.call(this)||this;return a.$interval=t,a.wistiaScriptLoader=i,a.wistiaUrlService=n,a.type="wistia",a._bufferCheckIntervalLength=100,a}return Ms(WistiaPlayerManager,e),WistiaPlayerManager.setPlayerDiv=function(e,t){return'\n<div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;">\n  <div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;">\n    <div id="'+e+'" class="wistia_embed wistia_async_'+t+'" style="height:100%;width:100%">&nbsp;</div>\n  </div>\n</div>\n'},WistiaPlayerManager.formatStateChangeEvent=function(e,t){return{emitterId:t,state:Ns[e]}},WistiaPlayerManager.prototype.seedPlayerManager=function(e,t,i){if(!(existy(this.getPlayer(e))&&this.getMetaProp(e,"startAtTime")>0)){t&&(this.players={},this.mainPlayerId=e);var n=this.wistiaUrlService.extractId(i[0]),a=Us({mainPlayer:t,div:WistiaPlayerManager.setPlayerDiv(e,n),wistiaId:n},Ds);this.setPlayer(e,WistiaPlayerManager.createMetaObj(a))}},WistiaPlayerManager.prototype.create=function(e){var t=this;this.createWpInstance(e).then(function(i){var n=t.$interval(function(){var i=t.getMetaProp(e,"lastVideoTime"),n=t.getMetaProp(e,"time"),a=n-i;a>=1&&a<=2&&(t.setMetaProp(e,"playerState",3),t.setMetaProp(e,"time",i),t.emitStateChange(e))},t._bufferCheckIntervalLength);t.setMetaProp(e,"bufferingInterval",n)})},WistiaPlayerManager.prototype.getPlayerState=function(e){var t=this.getInstance(e);if(t)return Os[t.state()]},WistiaPlayerManager.prototype.getBufferedPercent=function(e){return 0},WistiaPlayerManager.prototype.getCurrentTime=function(e){return this.invokeMethod(e,"time")},WistiaPlayerManager.prototype.play=function(e){this.invokeMethod(e,"play")},WistiaPlayerManager.prototype.pause=function(e){this.invokeMethod(e,"pause")},WistiaPlayerManager.prototype.seekTo=function(e,t){this.invokeMethod(e,"time",t)},WistiaPlayerManager.prototype.setSpeed=function(e,t){this.invokeMethod(e,"playbackRate",t)},WistiaPlayerManager.prototype.toggleMute=function(e){var t=this.getMetaProp(e,"muted");!1===t?(this.setMetaProp(e,"lastVol",this.getMetaProp(e,"volume")),this.setVolume(e,0)):this.setVolume(e,this.getMetaProp(e,"lastVol")),this.setMetaProp(e,"muted",!t)},WistiaPlayerManager.prototype.setVolume=function(e,t){this.invokeMethod(e,"volume",t/100),this.setMetaProp(e,"volume",t)},WistiaPlayerManager.prototype.destroySideEffects=function(e){this.$interval.cancel(this.getMetaProp(e,"bufferingInterval"))},WistiaPlayerManager.prototype.invokeMethod=function(e,t,i){var n=this.getInstance(e);if(existy(n))try{return existy(i)?n[t](i):n[t]()}catch(e){}},WistiaPlayerManager.prototype.getInstance=function(e){if(existy(this.getPlayer(e))&&!0===this.getMetaProp(e,"ready"))return this.getPlayer(e).instance},WistiaPlayerManager.prototype.createWpInstance=function(e){var t=this,i=this.mainPlayerId!==e,n={playbar:i,videoFoam:!1,fullscreenButton:i,controlsVisibleOnLoad:i,playbackRateControl:i,playButton:i,settingsControl:i,qualityControl:i,smallPlayButton:i,volumeControl:i};return this.wistiaScriptLoader.load(e).then(function(i){window.wistiaInitQueue=window.wistiaInitQueue||[],window.wistiaInitQueue.push({id:e,options:n,onReady:function(i){return t.onReady(e,i)}})})},WistiaPlayerManager.prototype.onReady=function(e,t){this.setInstance(e,t),this.attachEventListeners(t,e),this.emitStateChange(e,6),this.setMetaProp(e,"duration",t.duration())},WistiaPlayerManager.prototype.attachEventListeners=function(e,t){var i=this,n=function(e){return function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return t.call.apply(t,[i,e].concat(n))}}(t),a={play:function(e){return n(i.onPlay)},pause:function(e){return n(i.onPause)},seek:function(e,t){return n(i.onSeek,e,t)},timechange:function(e){return n(i.onTimechange,e)}};Object.entries(a).forEach(function(t){var i=t[0],n=t[1];e.bind(i,n)})},WistiaPlayerManager.prototype.onTimechange=function(e,t){var i=this.getMetaProp(e,"time");this.setMetaProp(e,"lastVideoTime",t),i>t&&this.setMetaProp(e,"time",t)},WistiaPlayerManager.prototype.onSeek=function(e,t,i){var n=this.getMetaProp(e,"duration");if(this.setMetaProp(e,"time",t),this.setMetaProp(e,"lastVideoTime",t),Math.floor(n-t)<.3)return this.setMetaProp(e,"playerState",0),void this.emitStateChange(e)},WistiaPlayerManager.prototype.onPlay=function(e){this.setMetaProp(e,"playerState",1),this.emitStateChange(e),e!==this.mainPlayerId&&"unstarted"!==this.getPlayerState(e)&&this.pauseOtherPlayers(e)},WistiaPlayerManager.prototype.onPause=function(e){this.setMetaProp(e,"playerState",2),this.emitStateChange(e)},WistiaPlayerManager.prototype.emitStateChange=function(e,t){var i;i=existy(t)?t:this.getMetaProp(e,"playerState"),this.statechangeCallbacks.forEach(function(t){t(WistiaPlayerManager.formatStateChangeEvent(i,e))})},WistiaPlayerManager.Name="wistiaPlayerManager",WistiaPlayerManager.$inject=["$interval","wistiaScriptLoader","wistiaUrlService"],WistiaPlayerManager}(Ls),Rs=function(){function WistiaScriptLoader(e){this.$q=e,this.WISTIA_HREF="https://fast.wistia.com/assets/external/E-v1.js"}return WistiaScriptLoader.prototype.load=function(e){var t=this;return this.$q(function(i){"undefined"==typeof Wistia?t._appendScript(e,i):i()})},WistiaScriptLoader.prototype._appendScript=function(e,t){var i=document.createElement("script");i.setAttribute("src",this.WISTIA_HREF),i.setAttribute("type","text/javascript"),i.setAttribute("async",""),i.id=e;var n=document.getElementsByTagName("script")[0];n.parentElement.insertBefore(i,n),i.onload=t},WistiaScriptLoader.Name="wistiaScriptLoader",WistiaScriptLoader.$inject=["$q"],WistiaScriptLoader}(),Vs=function(){function WistiaUrlService(){this.type="wistia",this.mimetype="video/x-"+this.type,this.embedUrl="http://fast.wistia.net/embed/iframe/"}return WistiaUrlService.prototype.getMimeType=function(){return this.mimetype},WistiaUrlService.prototype.parseMediaSrc=function(e){return e.reduce(function(e,t){return WistiaUrlService.isWistia(t)&&e.mediaSrcArr.push(t),e},{type:this.type,mediaSrcArr:[]})},WistiaUrlService.prototype.parseInput=function(e){if(WistiaUrlService.isWistia(e)&&!WistiaUrlService.isEmbed(e))return e},WistiaUrlService.prototype.extractId=function(e){if(WistiaUrlService.isWistia(e))return WistiaUrlService.parseIdfromUrl(e)},WistiaUrlService.prototype.canPlay=function(e){return WistiaUrlService.isWistia(e)},WistiaUrlService.prototype.getOutgoingUrl=function(e,t){var i="?autoplay=true&time="+t,n=WistiaUrlService.parseIdfromUrl(e),a=""+n+i;return this.embedUrl+a},WistiaUrlService.isWistia=function(e){return/https?:\/\/(.+)?(wistia\.com|wi\.st)\/.*/.test(e)},WistiaUrlService.isEmbed=function(e){return/<script/i.test(e)},WistiaUrlService.parseIdfromUrl=function(e){var t=e.split("/");return t[t.length-1]},WistiaUrlService.Name="wistiaUrlService",WistiaUrlService}(),Bs=angular.module("np.wistia",[]);[Fs,Rs,Vs].forEach(function(e){Bs.service(e.Name,e)});var js=angular.module("np.playback",["np.html5","np.youtube","np.kaltura","np.wistia"]);js.directive("ittVideo",ittVideo).factory("playbackService",playbackService_playbackService).factory("playerManagerCommons",playerManagerCommons).factory("urlService",urlService_urlService);questionAnswersSvc_questionAnswersSvc.$inject=["$q","analyticsSvc","appState"];var Hs=i("hJPG"),qs=i.n(Hs);ittMcQuestion.$inject=["questionAnswersSvc","analyticsSvc","appState"];var Ws=angular.module("np.question",[]);Ws.factory("questionAnswersSvc",questionAnswersSvc_questionAnswersSvc).directive("ittFlotr2Chart",ittFlotr2Chart).directive("ittQuestionOptions",ittQuestionOptions).directive("ittQuestionTextField",ittQuestionTextField).directive("ittQuestionTypeSelect",ittQuestionTypeSelect).directive("ittMcQuestion",ittMcQuestion);var Ks=angular.module("np.player",["textAngular","ngSanitize","np.episode","np.viewModes","np.item","np.inputFields","np.scenes","np.timeline","np.playback","np.question"]),zs=[Ot,Dt];Ks.factory("selectService",selectService_selectService).directive("ittNarrativeTimeline",ittNarrativeTimeline).directive("ittPlayerContainer",ittPlayerContainer).controller("PlayerController",PlayerController).directive("ittSearchPanel",ittSearchPanel).controller("SearchPanelController",SearchPanelController).directive(zt.Name,zt.factory()).directive("ittTab",ittTab).directive("ittTabs",ittTabs).directive("ittVolumeSlider",ittVolumeSlider).directive(Qt.Name,Qt.factory()).directive(Yt.Name,Yt.factory()).directive("ittShowHideVisualOnly",ittShowHideVisualOnly).animation(".visualHideAnimation",visualHideAnimation).directive("ittWidthWatch",ittWidthWatch).controller("EditController",EditController),zs.forEach(function(e){Ks.service(e.Name,e)}),Ks.config(["$provide",textAngularConfig]);angular.module("np.client",["ngRoute","ngAnimate","ui.tree","720kb.socialshare","np.shared","np.projects","np.stories","np.player"]).constant("MIMES",{assetLib:"image/*,text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf",file:"text/plain,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/rtf",default:"image/*",transcripts:"text/vtt,text/srt"}).constant("PLAYERSTATES",{"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued",4:"quality changed",6:"player ready"}).constant("PLAYERSTATES_WORD",{unstarted:"-1",ended:"0",playing:"1",paused:"2",buffering:"3","quality changed":"4","video cued":"5","player ready":"6"}).config(["$routeProvider",routerConfig]).config(["$sceDelegateProvider",xDomainConfig]).config(["$httpProvider",authInterceptorConfig]).config(["$compileProvider",debugInfoConfig]).run(["$rootScope","errorSvc",runFunction])},zSN1:function(e,t){e.exports='<a class=edit-event ng-click=editItem()> <span>Edit item</span> </a> <div> <div class="itemTemplate definition"> <div class=itemHead> <a role=button aria-label="Seek video to {{item.displayStartTime}}" tabindex=0 class="startTime displayTime" x-ng-click=seek(item.start_time) x-ng-keypress="seekOnKeyPress(item.start_time, $event)">{{item.displayStartTime}}</a> <div class="item__title item__title--definition"> <span ng-if="item.display_title | highlightSubstring: appState.searchText" ng-bind-html="item.display_title | highlightSubstring: appState.searchText"></span> </div> </div> <div class="text item__text item__text--definition" ng-bind-html="item.display_annotation | highlightSubstring: appState.searchText"></div> </div> <div class=clear></div> </div> '}},["zMT9"]);
//# sourceMappingURL=https://localhost.inthetelling.com/sourcemaps/app.e493a0c5ad2d116ef3fc.min.js.map